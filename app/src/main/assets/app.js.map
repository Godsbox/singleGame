{"version":3,"sources":["app/js/AppConstants.js","app/js/ApplicationFacade.js","app/js/common/Base64.js","app/js/common/Dialog.js","app/js/common/FontUtils.js","app/js/common/PhoneUtils.js","app/js/common/RePhaser.js","app/js/common/ShanyiMenu.js","app/js/common/Utils.js","app/js/common/Version.js","app/js/common/XmlHttpRequest.js","app/js/controller/command/PrepareControllerCommand.js","app/js/controller/command/PrepareModelCommand.js","app/js/controller/command/PrepareViewCommand.js","app/js/controller/command/StartupCommand.js","app/js/main.js","app/js/model/proxy/SceneProxy.js","app/js/view/component/Scene.js","app/js/view/mediator/CoverMediator.js","app/js/view/mediator/EndMediator.js","app/js/view/mediator/HtmlTextBox.js","app/js/view/mediator/MainMenuMediator.js","app/js/view/mediator/PlaybackMediator.js","app/js/view/mediator/RecordMediator.js","app/js/view/mediator/SceneMediator.js","app/js/view/mediator/SettingsMediator.js"],"names":["window","diygamePlayer","AppConstants","CMD_STARTUP","CMD_FRAME_ENTER","CMD_SVG_MENU","CMD_LOAD_GAME","CMD_UPDATE_MUSIC_STATE","APP_DEBUG_MODE","APP_LOG","APP_SHOW_INSPECTOR","APP_SHOW_MENUBAR","APP_FPS_UPDATE","STAGE_TRAP_MOUSE","SCENE_SHOW_ERROR","SCENE_SHOW_SAVE_ALERT","SCENE_SHOW_AD","SCENE_TOOGLE_SCREEN_STATE","SCENE_SKIPPING","SCENE_PRELOADING_BEGIN","SCENE_PRELOADING_PROGRESS","SCENE_PRELOADING_COMPLETE","SCENE_LOADING_BEGIN","SCENE_LOADING_PROGRESS","SCENE_LOADING_COMPLETE","SCENE_TEMPLATE_LOADED","SCENE_SHOW_LOGO","SCENE_GOTO_COVERMENU","SCENE_GOTO_MAINMENU","SCENE_GOTO_SETTINGS","SCENE_GOTO_PLAYBACK","SCENE_GOTO_RECORD","SCENE_GOTO_END","SCENE_CLOSE_MENU","SCENE_PLOT_ANIM_BEGIN","SCENE_PLOT_SKIP","SCENE_PLOT_CLOSED","SCENE_PLOT_LOAD_BEGIN","SCENE_PLOT_LOAD_ASSETS_READY","SCENE_PLOT_LOAD_ASSETS_LOADED","SCENE_PLOT_LOAD_END","SCENE_BACKGROUND_COLOR_UPDATE","SCENE_BACKGROUND_UPDATE","SCENE_BACKGROUND_ENTERED","SCENE_BACKGROUND_SWITCH","SCENE_MUSIC_UPDATE","SCENE_SOUND_UPDATE","SCENE_CHARACTER_UPDATE","SCENE_PROP_UPDATE","SCENE_VIEW_UPDATE","SCENE_DIALOG_UPDATE","SCENE_DIALOG_COMPLETE","SCENE_CHECK_IF_SKIP","SCENE_CLICK_ON_SCENE","SCENE_OPTION_UPDATE","SCENE_MENUBUTTON_UPDATE","SCENE_WEATHER_UPDATE","SCENE_EFFECT_SHAKE","SCENE_EFFECT_TWINKLE","SCENE_CLEAR","SCENE_SHOW_GUIDE","ADD_PLAYBACK_CONTENT","SCENE_DESTROY_VIEW","SCENE_SHOW_INPUT_VIEW","_puremvc","require","_puremvc2","define","name","parent","Facade","startup","this","initialized","registerCommand","controller","command","StartupCommand","sendNotification","getInstance","multitonKey","instanceMap","instance","ApplicationFacade","NAME","Base64","_keyStr","encode","input","output","chr1","chr2","chr3","enc1","enc2","enc3","enc4","i","_utf8_encode","length","charCodeAt","isNaN","charAt","decode","replace","indexOf","String","fromCharCode","_utf8_decode","string","utftext","n","c","c2","c3","Dialog","title","data","type","okText","cancelText","isShow","that","Promise","resolve","reject","ok","document","body","removeChild","modalContainer","cancel","createElement","classList","add","modalPortal","clientWidth","clientHeight","style","transform","onresize","appendChild","titleDiv","titleData","innerText","space","close","onclick","content","contentData","buttons","buttonOk","buttonCancel","showDialog","_Utils","FontUtils","baseFonts","testString","testSize","s","fontSize","innerHTML","defaultWidth","defaultHeight","index","fontFamily","offsetWidth","offsetHeight","detected","matched","font","default_font_size","_this","images","size","target","width","charWidth","charHeight","height","widthImg","countPerRow","heightImg","rowPerImg","isFontExist","url","fontChars","chars","ctx","getContext","len","nRow","Math","ceil","drawing","base64","toDataURL","blob","_Utils2","dataURLtoBlob","blobUrl","URL","createObjectURL","fontImage","img","Image","srcHeight","src","onload","drawImage","char","test","undefined","PhoneUtils","key","local","flashvars","client","Arg","audioCountLoadByPhone","total","offline","loadAudioUrl","JSON","stringify","webkit","messageHandlers","postMessage","volume","loop","musicKey","v","l","musicInfo","tweenId","parseInt","random","playAudioUrl","stopAudioUrl","setAudioUrlVolume","duration","delay","nTimers","nStep","nCur","doEase","setTimeout","_this2","_this3","soundsInfo","soundKey","channel","some","k","audioResourceRef","removeAudioUrl","loaded","load","onSoundLoadExtend","dispatch","Rephaser","texture","baseTexture","resolution","_res","context","a","text","wordWrap","runWordWrap","realText","b","split","tabs","d","e","f","determineFontProperties","g","maxLines","_charCount","h","strokeThickness","padding","x","colors","strokeColors","fontWeights","fontStyles","measureLine","measureText","j","Array","isArray","m","game","math","snapToCeil","max","canvas","o","y","p","q","_lineSpacing","abs","scale","navigator","isCocoonJS","clearRect","backgroundColor","fillStyle","fillRect","fill","strokeStyle","stroke","textBaseline","lineWidth","lineCap","lineJoin","r","ascent","align","autoRound","round","updateLine","updateShadow","shadowStroke","strokeText","renderTabLine","shadowFill","fillText","updateTexture","wordWrapWidth","isConnect","reg","combinators","RegExp","terminator","slice","substr","trimLeft","file","onLoad","xhr","arraybuffer","requestObject","response","ArrayBuffer","Uint8Array","isGif","crossOrigin","onComplete","onerror","fileComplete","revokeObjectURL","fileError","spliceGif","then","frames","loopCount","createBlob","transformUrl","complete","xhrLoad","isPlaying","_sound","usingWebAudio","externalNode","endfun","onended","disconnect","gainNode","stop","noteOff","alert","usingAudioTag","pause","currentTime","pendingPlayback","paused","prevMarker","currentMarker","onMarkerComplete","fadeTween","onStop","sound","_this4","soundData","cache","getSoundData","isSoundDecoded","updateSound","handleError","onSoundDecodeError","console","warn","decodeAudioData","buffer","decodedSound","onSoundDecode","_this5","extension","lastIndexOf","Infinity","isDatAudio","toLowerCase","setFileData","touchLocked","AudioTagPool","get","audio","exist","playThroughEvent","removeEventListener","addEventListener","convertDat","device","android","Blob","isDatFile","color","crop","w","rotated","source","globalCompositeOperation","toString","PIXI","CanvasTinter","tintWithMultiply","Phaser","Game","prototype","destroyComponent","Signal","spriteDestroy","Sprite","destroy","apply","arguments","imageDestroy","Loader","loadAudioTag","soundDestroy","Sound","scratchBuffer","createBuffer","Cache","reloadSound","getSound","reloadSoundComplete","Device","canPlayAudio","mp3","ogg","opus","m4a","wav","webm","dolby","SoundManager","setMute","_muted","_muteVolume","masterGain","gain","value","_sounds","iOS","mute","onMute","unsetMute","_codeMuted","resume","onUnMute","ShanyiMenu","back","exit","urlToGo","gameCallback","syMenuBack","syMenuExit","uuid","wap","scrolling","frameBorder","_XmlHttpRequest","_Version","_Base","_cryptoJs","_sparkMd","_PhoneUtils","Utils","substring","resultUrl","parts","shift","join","gid","currentData","currentPos","hdr","tmpCanvas","spliceCanvas","frame","lastDisposalMethod","transparency","disposalMethod","disposalRestoreFromIdx","lastImg","bitsToNum","ba","reduce","byteToBitArr","bite","push","Stream","readByte","Error","readBytes","bytes","read","readUnsigned","lzwDecode","minCodeSize","pos","readCode","code","clearCode","eoiCode","codeSize","outputBlockSize","bufferBlockSize","dict","bufferOffset","outputOffset","clear","keep","splice","enlargeOutput","outputSize","newoutput","set","enlargeBuffer","bufferSize","newbuffer","pushCode","last","newlength","byteLength","newdict","subarray","newsize","setSizes","setTransform","doHdr","_hdr","doGCE","gce","pushFrame","transparencyGiven","transparencyIndex","delayTime","dataUrl","doImg","currIdx","ct","lctFlag","lct","gct","putImageData","leftPos","topPos","imgData","getImageData","pixels","pixel","pix","idx","doNothing","doNetscape","block","iterations","handler","com","app","NETSCAPE","eof","parseGIF","st","parseCT","entries","readSubBlocks","offset","bufsize","resizeBuffer","newdata","parseHeader","sig","ver","bits","gctFlag","colorRes","sorted","gctSize","bgColor","pixelAspectRatio","parseExt","parseGCExt","reserved","userInput","parseComExt","comment","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","parseImg","deinterlace","newPixels","rows","cpRow","toRow","fromRow","_ref","fromPixels","concat","_toConsumableArray","offsets","steps","pass","interlaced","lctSize","lzwMinCodeSize","lzwData","parseBlock","sentinel","parse","stream","err","error","Object","tempColor","match","toHex","hex","time","handle","promise","clearTimeout","xhrGetServerTime","rs","responseText","retData","status","timeStamp","timestamp","timeOffset","floor","Date","getTime","msg","rj","systemValues","now","date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getDay","seperator1","seperator2","toStr","min","currentdate","BlobBuilder","bb","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","append","getBlob","arr","mime","bStr","atob","u8arr","blobObj","message","rawKey","rawVec","_cryptoJs2","enc","Utf8","ivv","encrypted","AES","encrypt","iv","mode","CBC","pad","ZeroPadding","enstr","decrypted","decrypt","deStr","cookie","decodeURI","uid","getCookie","app_version","localStorage","getItem","retValue","localStorage_getItem","returnValue","setItem","localStorage_setItem","arg","removeItem","removeLocalStorage","xhrSend","sensitiveWords","result","userAgent","deviceId","getDeviceId","stime","sSign","aesEncrypt","_sparkMd2","hash","encodeURIComponent","doSend","selOptions","timerHandler","ResourcesManager","fun","keys","refCount","forEach","getCount","_this6","_refCount$audio$key$g","global","_refCount$img$key$glo","_PhoneUtils2","audioTag","free","checkSoundKey","removeSound","image","getImage","removeImage","fKey","fRefType","tKey","tRefType","removeFromCache","_this7","refType","count","_this8","every","_this9","acc","cur","chapter","pIndex","_this10","cmdInfo","cIndex","lastUsedKeyMap","resources","stack","cmdFrame","cmdStack","plots","commands","isMaxSize","isCommand","MaxSize","MaxCount","addResource","preloadType","addRefCount","getResourceSize","addWeatherResource","promises","formatNum","getInCmdInfo","canDeepPreload","getInCommand","_command$args$","args","background","forceDecode","musics","MaxForceDecodeMusic","music","sounds","avatar","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_loop","option","normal","active","disable","_iterator","Symbol","iterator","next","done","preloadOptions","options","_lastUsedKeyMap","_loop2","opIndex","_loop3","opPlotIndex","_options$opIndex$comm","getInNextCommand","loopCondition","parentInfo","parentCmdIndex","_cmdInfo$commands$cIn","getPlotOptionCount","plot","condition_options","getInChapter","call","plot_sound","item","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","characters","character","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","props","prop","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","weather","rp","preloadPlotOptions","_lastUsedKeyMap2","_loop4","optChapter","_loop6","_loop5","_loop7","getInNextPlot","pnPlot","pChapter","all","sizes","usingKeyMap","freeAudio","pool","find","addAudio","play","freeCount","commit","version","serializeQuery","params","map","val","XMLHttpRequest","open","readyState","send","onProgress","timeout","ontimeout","log","onreadystatechange","withCredentials","setRequestHeader","responseType","getJson","getMaterialRedirect","urls","materialRedirect","json","getGame","getTestGame","SimpleCommand","execute","note","facade","registerProxy","model","proxy","SceneProxy","registerMediator","view","mediator","SceneMediator","MacroCommand","initializeMacroCommand","addSubCommand","PrepareControllerCommand","PrepareModelCommand","PrepareViewCommand","_Dialog","_ShanyiMenu","Xhr","_FontUtils","Proxy","chargeMsgReceive","ev","originalEvent","newValue","resumeAudio","bk_music","plotSounds","pauseAudio","preloadingBegin","stringMap","loadMenu","overMenu","settingsMenu","startMenu","menu","mainMenu","save","playback","autoplay","manualPlay","settings","displayHeader","displayCaption","textHeader","textCaption","autoOn","autoOff","windowMode","fullMode","progressTips","recordTipCount","isShowGuide","playbackData","plotViews","prgsViews","plotViewKeys","bViewLoaded","bSignedIn","bCloudSel","visibleLayout","resourceManager","plotIndex","resourceList","baseList","lstDialogInfo","menuInfo","quickPlay","isScreenHold","bCmdAutoText","isGameStarted","usedStarCount","gameStarLimit","lstPlotTweens","twinkleTimer","uiOnLoadQueue","timerCounts","menuTimer","recUidBelongTo","gameUidBelongTo","bSwitchAccInPlot","payValueUid","unlockChapterCallBack","mallPayCallback","isGettingNext","audioMgr","bind","audioCanPlayCallBack","updateAccInfo","unlockChapterFinished","mallPay","stayIfFail","checkIfMallPaySuccess","indentId","getData","serial_num","c_status","u","token","addAssets","isPlot","sKey","viewComponent","checkImageKey","convertToAllowAccessControlOriginUrl","bAutoDecode","addImage","addImageUrl","md5","onabort","parseJsonFile","json_data","template","parseTemplateCoverAssets","parseTemplateDialogAssets","parseTemplateMenuAssets","parseTemplateSyMenuAssets","parseTemplateMainMenuAssets","parseTemplateSettingsAssets","parseTemplateOptionAssets","parseTemplatePlaybackAssets","parseTemplateRecordAssets","parseTemplateSoundAssets","_FontUtils2","logo","cover","addEventAssets","events","subEvent","viewMap","progress","children","child","_json_data$template$j","titleContainer","_json_data$template$j2","dialog","avatarContainer","_json_data$template$j3","shanyiMenu","_json_data$template$j4","_json_data$template$j5","header","_json_data$template$j6","unchecked","checked","_json_data$template$j7","_json_data$template$j8","scrollBox","_json_data$template$j9","record","showLogo","showCover","showMainMenu","onPause","showSettings","callbackInfo","mainMenuLayer","visible","showPlayback","showSave","bLocalCloudSwitch","menuLayer","bToSaveFile","loadData","showRecord","showLoad","getUidByCookie","getPayInfo","showEnd","getOneCommandResourceInfo","lstPlotBkKey","isPlotResourceExist","plotInfo","isNotExist","usingCount","usingResourceCount","_arr","_i","keyMap","imgCount","world","soundCount","resetResources","forEachReCount","getResources","cmdPlotSnap","cmdIndex","cmdScreenSnap","_ResourcesManager$usi","resetReCount","getResourcesByContext","addResources","getMusic","charsAndProps","cp","_cmdPlotSnap$cmdScree","dialogInfo","bk","preloadCommandsAssets","preloadChapterAssets","curChapter","curPlotIndex","enableLayerInput","layer","bEnabled","enableChild","inputEnabled","apToFinalState","charsAndPropsLayer","exists","imgGroup","finalState","alpha","angle","removePlotTweens","tween","playPause","tweens","_tweens","t","onResume","resumeAll","onCoverStartBtnClicked","_this11","findFirstChapter","chapterUuid","downloadUuid","charge","checkIfChapterFree","_Dialog2","info","coverLayer","unlockFinish","bSuccess","unlockChapter","onCoverLoadBtnClicked","onCoverSettingBtnClicked","onCoverOverBtnClicked","opener","top","location","href","onMenuBtnClicked","getSnap","onSyMenuBtnClicked","moreWorks","_ShanyiMenu2","showSyMenu","onMainMenuSaveBtnClicked","disableSaveOrLoad","showToast","onMainMenuLoadBtnClicked","onMainMenuPlaybackBtnClicked","onMainMenuAutoplayBtnClicked","auto","onMainMenuBackBtnClicked","onMainMenuSettingsBtnClicked","curPlotLayer","onChildInputDown","onSettingsFullModeBtnClicked","startFullScreen","fullScreen","onSettingsWindowModeBtnClicked","stopFullScreen","onSettingsAutoOnBtnClicked","onSettingsAutoOffBtnClicked","onSettingsBackBtnClicked","settingsLayer","onRecordBackBtnClicked","recordLayer","showMenu","onRecordLocalBtnClicked","onRecordCloudBtnClicked","curPlotInfo","hidden","showGuideTip","id","isSignedIn","_this12","loadCloudRecord","convertCloudData","cdata","rdata","plotUuid","strTS","time_stamp","plotSnap","plot_snap","cloudPlotsData","getAccountInfo","checkChapter","isFirst","subchapters","chapters","notifyGameStarted","gameStart","isWap3000","bLogout","bEntering","_this13","localRecFileToUidRecFile","doUpdate","getFansInfo","recId","userData","localStorageGetItem","savedData","localStorageSetItem","localStorageRemoveItem","_this14","fans_total","_this15","payment_available","game_coin_available","single_game_star_use","single_game_star","init","_this16","payInfoData","payValues","values","decryptBase64","savePayInfo","aesKeyType","app_name","device_name","deviceOsVer","getPhoneData","_this17","sendData","dataIfFail","str","strBase64","encodeBase64","getDiscounts","gameId","productId","platform","payOperation","price","goodsId","callback","_this18","disCounts","invokeApp","payArg","eid","special_price","balance","starsNeed","stars","starsUsed","starsLimited","worksmall","success","chapterInfoProgress","prgsInfo","group","getByName","graphics","beginFill","drawRect","endFill","boundsAlignH","boundsAlignV","setTextBounds","txt","chapterMd5","_this19","evt","callBack","_this20","discounts","unlockArg","unlock","saveCloudRecord","savedPlotsData","getViewData","items","subView","visitChild","xInfo","yInfo","instanceUuid","eventsInfo","viewType","currentCount","generateType","getViewParentEvents","ref","copyFlashViewData","commandObj","bVisible","historyCommand","hideGlobalViews","dest","getWeatherType","weatherLayer","saveRecord","default_settings","autoSaveOrLoad","globalViews","chAndProps","saveData","bkKey","bkOpacity","lstPlotBkOpacity","bkFlex","lstPlotBkFlex","cmdUuid","curCmdUuid","weatherType","opacity","pivotX","pivot","pivotY","scaleX","scaleY","rotate","zIndex","parentScale","loadRecord","_this21","_savedPlotsData$index","goRecord","nChapter","nPlot","destroyAll","charsAndPropsInfo","endLayer","addPlayBackContent","getCommandByCommandUuid","initContext","commandInserts","goRecordHandle","_getChapterByPlotUuid","getChapterByPlotUuid","_getChapterByPlotUuid2","onRecordItemClicked","iCol","iRow","_this22","itemContent","itemTime","setPreviewImage","loadTexture","snapMd5","strText","getCurrentDateTime","fh","toRealImageFontHeight","fw","toRealImageFontWidth","addImageFontText","backgroundObject","savedValues","stringValues","indexValues","saved","vi","pay","globalViewsData","Expression","safeEval","viewsData","speakings","_cdata$commandObj$his","autoText","commandUuid","onPlaybackBackBtnClicked","playBackLayer","removeAll","showLoadingToast","loadingToastLayer","bringToTop","ss","toastLayer","ee","from","addRetroText","txtData","retroFont","txtImg","fontImg","stamp","setText","addImageFontTextColors","txtObj","iPos","realData","lineBreak","placeholder","parseWaitTime","parseValue","clr","addColor","font_width","font_height","bSpeaking","bSpeakHidden","_this23","charGroup","mask","getChildAt","removeChildren","xPos","yPos","cr","bkWidth","firstMargin","fontHeight","parseFloat","fontWidth","t_h","font_size","sizeRow","seperation","itemChar","charCount","posInfo","getLeftMargin","getCharSpace","bottomInText","charsBk","sprite","imgTxt","tint","addChild","extWidth","extMargin","imgFBottom","maskWidth","maskHeight","rect","_this24","translate","PI","restore","searchChapterByUUID","searchChapter","path","searchPlot","searchPlotByOption","nIndex","searchPlotByChapter","subchapter","searchCommandInOption","ops","pCmdInfo","searchCommand","getCmdScreenSnap","bkInfo","getNextPlot","eArg","preStackFrame","preCmdStackFrame","insert","jump","condOptIndex","findIndex","expression","condOpt","loopCountExpr","jumpUuid","jumpChapter","curCmdInfo","curCmdIndex","pPlotUuid","isMenu","isMainMenu","cmdResult","snap","_context$commandInser","_getChapterByPlotUuid3","getNextCommand","action","rCmdInfo","rIndex","optionLayer","removeInputView","inputElement","removeViewTimer","_this25","timerType","clearInterval","filterInexistentPlotViews","views","isUuidExist","_this26","plotViewsLayer","stopMusic","stopSound","lstPlotLayer","reStart","_this27","workFinished","dialogLayer","valueOperation","bCancelUpload","_this28","isPaying","payValueOperator","indexValueOperator","reference","updateValues","oldContext","tempValues","isLoad","copy","obj","strSavedValues","lstSavedValues","getTimeOffset","updateContextTimeValues","doInCT","func","txtLineSpace","desktop","nextToPlay","decodeCacheAudio","subRefCount","playMusic","playInheritMusic","playSound","playInheritSound","_this29","decoded","isDecoding","countDecoded","audioKeys","getKeys","SOUND","_classCallCheck","_createClass","Number","radix","expr","_this30","evaluate","arg1","arg2","isString","sub","mul","div","mod","toN","start","toInt","range","end","safeInitValue","toWeek","NaN","initValue","onlyRead","_this31","oldValue","newExpr","fixArg1","fix","fixArgs","filter","sort","isGetName","parseValueFormat","exec","nameStr","temp","toFixed","ii","show","parsePauseFormat","timer","_timer$time","countDown","num1","num2","len1","len2","pow","str1","str2","includes","fixed","guideLayer","progressLayer","quickPlayLayer","btn_sound","audioDecodedCount","lstGameBk","Template","space_key","globalViewKeys","cmdPlotNextPromise","cmdPlayHandlerFun","preWaitCmdUuid","_RePhaser","constructor","scene","state","scaleMode","ScaleManager","SHOW_ALL","fullScreenScaleMode","pageAlignVertically","pageAlignHorizontally","stage","disableVisibilityChange","setResizeCallback","scaleManager","rectangle","getElementById","setGameSize","setBounds","refresh","loadImageTag","_RePhaser2","renderer","renderSession","roundPixels","soundDecode","iOSVersion","touch","addTouchLockCallback","preload","create","oncontextmenu","preventDefault","startBk","onRendered","update","phaserRender","CANVAS","agentV","AUTO","preserveDrawingBuffer","_Version2","logo_preloader","anchor","setTo","showOfflineBg","offlinebg","opg","setChildIndex","showLoading","loading_gif","addGifAnimation","destroyLogo","logInfo","preLoadCertainAssets","spritesheet","preLoad","onLoadStart","addOnce","addLog","onFileComplete","cacheKey","totalLoaded","totalFiles","onLoadComplete","getGameJson","lengthComputable","percentComplete","textGroup","addButton","key_normal","key_active","onClick","isCheckBox","changeImageText","textInfo","textObj","txtImgOld","strContent","sceneProxy","rgb","changeBackground","buttonGroup","btnObj","bk_key","fontWeight","btnGroup","bk_key_normal","bk_key_active","btn","button","setOverSound","setDownSound","onInputOut","onInputUp","fontStyle","ff","mouseOut","_pointerData","isOver","isOut","timeOut","useHandCursor","isDragged","cursor","_setHandCursor","onInputOut$dispatch","GROUP","onChildInputOut","onInputOver","onInputDown","_image$data","nCount","setFrame","base","BaseTexture","Texture","setTexture","addFitImageSprint","getAt","removeChildAt","childGroup","TEXT_CHANGED","Mediator","listNotificationInterests","handleNotification","getName","showCoverLayer","onRegister","retrieveProxy","sceneMediator","retrieveMediator","addCover","_sceneProxy$json_data","_template$json$cover","worldWidth","worlHeight","addTextContent","objText","isTitle","onBtnClicked","pointer","pointerMode","PointerMode","CURSOR","blackBk","moveTo","lineTo","backgroundKey","flex","rate","_cover$title","bold","titleText","_sceneProxy$json_data2","showEndLayer","btnStatesChanged","keyBk","buttonKey","addEnd","text_normal","itemBlackBk","bitmapData","item_bk","text_active","btn_load","txt_load","btn_back","txt_back","btn_save","txt_save","HtmlTextBox","family","Group","parentElement","parentNode","textBoxElement","position","margin","border","left","borderColor","outline","insertBefore","_x","_y","_width","_height","_fontSize","isValue","existing","onDestroy","canvasX","offsetLeft","canvasY","offsetTop","canvasWidth","canvasHeight","oldCanvasWidth","oldCanvasHeight","oldCanvasX","oldCanvasY","gameWidth","gameHeight","widthScale","heightScale","xScale","yScale","newX","newY","newWidth","newHeight","setLeft","setTop","setWidth","setHeight","setFontSize","bShow","visibility","setInputCallback","inputUpdate","_text","word","rw","repeat","onblur","setClickCallback","setEnable","readOnly","defineProperty","_style","getBody","showMainMenuLayer","addMainMenu","addImgFontText","head","mainMenuView","registerViewKey","menuView","addView","getTimerInMenu","visitInChild","uiOnLoadInvoker","autoButton","showPlaybackLayer","addPlaybackContent","addPlayback","boxX","boxY","boxWidth","boxHeight","backgroundRect","assign","scrollBk","scrollPane","itemHeight","hSpace","dragStartPointX","dragStartY","wheelEvent","onMove","point","getPoint","mousewheelevt","onMouseWheel","onScroll","onDragUpdate","pt","bFromStart","px","py","worldX","worldY","enableDrag","disableDrag","delta","wheelDelta","detail","allowHorizontalDrag","addMoveCallback","callbackFun","callbackArgs","addPlaybackItem","keyItemBk","keySubItemBk","contentX","contentY","itemGroup","itemBackground","itemText","useAdvancedWrap","updateText","advancedWordWrap","lineSpacing","showRecordLayer","localMode","isChangeClick","onLocalBtnClicked","btnLocal","btnCloud","onCloudBtnClicked","isshow","updateItems","addRecord","boxRect","boxItem","itemsOffsetX","itemsOffsetY","itemSpaceX","vSpace","itemSpaceY","itemRect","hint","hintRect","hintText","contentRect","itemX","itemY","itemWidth","hintX","hintY","hintWidth","hintHeight","contentWidth","contentHeight","scrollX","scrollY","nCol","nLeft","nTop","ptDown","dragBk","scrollHeight","onDragStart","onDragStop","onItemUp","subItem","txtTime","itemMask","autoRecord_Bk","autoRecord","autoRecord_txt","bKey","_HtmlTextBox","TextBox","keyboard","addKey","Keyboard","SPACEBAR","z_key","Z","onDown","onUp","onHold","screenCaptured","screenReleased","generateLayers","addToastLayer","addLoadingToastLayer","remove","assetsLoaderStart","imgContinue","showPlot","destroyView","showInputView","animateTweens","icon","f1","t1","f2","t2","quickPlayHandler","hasView","Pointer","cmdPlotLoadResources","cmd","needLoad","isAudioInCache","assetsLoader","showtype","CloudImg","inputEnableChildren","tweenToPromise","guidedata","tl","toastText","typeSuccess","typeError","bk1","bk2","nextNotifier","curSceneProxy","decodingAudios","loadedFileCount","totalFileCount","_totalFileCount","handleSoundDecode","handleSoundDecodeError","handleSoundLoadExtend","prgs","showProgress","extName","autoDecode","isLoadComplete","_sceneProxy","_logo$background","game_logo","backgroundFlex","isChapter","pushcolors","__text","__info","type0","type1","progressText","progressText2","progressBar","tipText","tipLight","fontSytle","tipInfo","drawRoundedRect","progressBar_overlay","progressBar_mask","newx","progtexts","addDialogLayer","dialog_bk","dialog_bk_title","addMenuLayer","bSetFixed","menuBtnClick","doEffectsAnimation","doAnimation","addRainEffect","rain","rain1","addSnowEffect","snow","snow1","addWindEffect","wind","tileSprite","autoScroll","addFallingLeavesEffect","fLeaves","fLeaves1","addBeachBlossomEffect","beachBlossom","beachBlossom1","addBlossomEffect","blossom","blossom1","addLightningEffect","lightning","lightning1","refUuid","parentEvents","arrKeys","removeKey","keyCode","doReg","removeViewKey","removeViewKeyByInstance","unReg","doUnReg","addGlobalView","refUuidToHide","isGlobal","scaleInputView","parentLayer","isRefresh","containerLayer","viewInfo","_sceneProxy2","pointX","pointY","eventHandler","nextAction","showNextPlot","refreshViews","refreshView","_ret","uuidToClose","objParent","bCloseMainMenu","getCloseUuid","bSingleToClose","diyMainMenu","isParent","realUuid","_typeof","_sceneProxy$getNextCo","_sceneProxy$getNextCo2","_ret2","generateUUID","normalValue","savedValue","stringValue","payValue","preOperation","afterOperation","goNextEvents","operationCallback","loadPayValues","dc","keyUpCallback","event","eventCallback","invokeEventInfo","es","invokeHandler","pausedCallback","_ret4","onViewClicked","isHanding","addItemClickedCallback","onLoadCallback","onKeyUpCallback","object","eventsInfoCopy","clickEvent","bkImg","bkPrgs","hType","vType","basePoint","updateProgressView","inputCallback","updateValue","realV","vv","ri","mgrParent","isStepCanSkip","onStepTimeOut","step","onStepInterval","setInterval","nWidth","nHeight","pWidth","pHeight","isMask","mover","viewLayerName","destroyInChild","bReload","getRefreshViews","newViews","oldView","newView","bExist","oldIndex","bkSprite","properties","ease","autoStart","yoyo","to","tweenFromPromise","titleTxt","contentTxt","isShowAll","sceneShake","offSet","curOffSet","speaking","coverage","isShaking","sceneTwinkle","twinkle","fixColorValue","fadeIn","playEffect","animations","animation","level","_sceneProxy$json_data3","dialog_bk_avatar","dialog_avatar","dialogtitle","_avatarContainer$avat","clip","poly","Polygon","Point","drawPolygon","points","bezierCurveTo","drawCircle","_dialogInfo$dialogtit","titleStyle","titleX","titleY","setStyle","playPlotSound","addBackground","plotLayer","isInherit","bk_alpha","bk_flex","delRefTypeCount","addCharsProps","_i3","ch","mirrorH","mirrorV","cApAnimationIn","trigger","addOptions","txtOptions","hasOption","timerHandles","countDownPromises","_sceneProxy$json_data4","normal_bk_key","active_bk_key","disable_bk_key","_txtOptions$i","hasOwnProperty","disabledTextInfo","op_sound","btng","getGameValueByTimer","hideTimer","timerHandle","Timer","SECOND","alive","results","delByRefType","addWeather","_sceneProxy$weatherLa","addPlotViews","loadSubViews","sView","showGlobalViews","bLoadRec","savedSubView","fixTimerCount","fixViewEventsInfo","_i4","createSubView","itemInfo","parentView","tempRefer","musicIn","tweenFromMusic","musicOut","tweenToMusic","dialogIn","In","From","moveFrom","dialogOut","Out","To","fadeOut","animateIn","animateOut","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","xStep","yStep","pauseSpeaking","remain","contextScrollToBottom","bottom","maxHeight","animationSpeak","current","speed","textShow","nLine","doSpeak","speakInfo","showImmediate","immediate","clickProxy","keyProxy","race","playWait","waitTime","savePlayBackContent","speakData","clearPreloadResources","isTextOption","condOptions","transferByRefCount","playNormal","autotext","wait","playCommands","recoverCmdSnap","snapInfo","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","nextCmdCallback","_ret8","old","lstAlpha","lstAngle","lstX","xRaw","xMoveTo","lstY","yRaw","yMoveTo","lstScaleX","lstScaleY","_ret9","normalPropsTo","scalePropTo","tweenToSound","opt","playHandler","_sceneProxy$getNextCo3","_sceneProxy$getNextCo4","endPlot","_sceneProxy$getNextPl","newContext","goNext","gameOver","_sceneProxy$getNextPl2","cps","nc","np","npc","stayCurrentPlot","_sceneProxy$getNextPl3","setViewComponent","component","Scene","CoverMediator","SettingsMediator","MainMenuMediator","RecordMediator","PlaybackMediator","EndMediator","onRemove","showSettingsLayer","full","on","off","addSettings","_sceneProxy$json_data5","addTextBk","rc","colorS","modeBtnClicked","argv","rectScreenMode","isFullScreen","rectTextMode","fullScreenHandler","onFullScreenChange"],"mappings":"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","file":"build/app.js.map","sourcesContent":["// create the diygamePlayer namespace\r\nwindow.diygamePlayer =\r\n{\r\n    AppConstants: {\r\n        /** Commands */\r\n        CMD_STARTUP: \"CMD_STARTUP\",\r\n        CMD_FRAME_ENTER: \"CMD_FRAME_ENTER\",\r\n        CMD_SVG_MENU: \"CMD_SVG_MENU\",\r\n        CMD_LOAD_GAME: \"CMD_LOAD_GAME\",\r\n        CMD_UPDATE_MUSIC_STATE: \"CMD_UPDATE_MUSIC_STATE\",\r\n\r\n        /** Notification name constants */\r\n        APP_DEBUG_MODE: \"APP_DEBUG_MODE\",\r\n        APP_LOG: \"APP_LOG\",\r\n        APP_SHOW_INSPECTOR: \"APP_SHOW_INSPECTOR\",\r\n        APP_SHOW_MENUBAR: \"APP_SHOW_MENUBAR\",\r\n        APP_FPS_UPDATE: \"APP_FPS_UPDATE\",\r\n\r\n        STAGE_TRAP_MOUSE: \"STAGE_TRAP_MOUSE\",\r\n\r\n        SCENE_SHOW_ERROR: \"SCENE_SHOW_ERROR\",\r\n        SCENE_SHOW_SAVE_ALERT: \"SCENE_SHOW_SAVE_ALERT\",\r\n        SCENE_SHOW_AD: \"SCENE_SHOW_AD\",\r\n        SCENE_TOOGLE_SCREEN_STATE: \"SCENE_TOOGLE_SCREEN_STATE\",\r\n        SCENE_SKIPPING: \"SCENE_SKIPPING\",\r\n        SCENE_PRELOADING_BEGIN: \"SCENE_PRELOADING_BEGIN\",\r\n        SCENE_PRELOADING_PROGRESS: \"SCENE_PRELOADING_PROGRESS\",\r\n        SCENE_PRELOADING_COMPLETE: \"SCENE_PRELOADING_COMPLETE\",\r\n        SCENE_LOADING_BEGIN: \"SCENE_LOADING_BEGIN\",\r\n        SCENE_LOADING_PROGRESS: \"SCENE_LOADING_PROGRESS\",\r\n        SCENE_LOADING_COMPLETE: \"SCENE_LOADING_COMPLETE\",\r\n        SCENE_TEMPLATE_LOADED: \"SCENE_TEMPLATE_LOADED\",\r\n        SCENE_SHOW_LOGO: \"SCENE_SHOW_LOGO\",\r\n        SCENE_GOTO_COVERMENU: \"SCENE_GOTO_COVERMENU\",\r\n        SCENE_GOTO_MAINMENU: \"SCENE_GOTO_MAINMENU\",\r\n        SCENE_GOTO_SETTINGS: \"SCENE_GOTO_SETTINGS\",\r\n        SCENE_GOTO_PLAYBACK: \"SCENE_GOTO_PLAYBACK\",\r\n        SCENE_GOTO_RECORD: \"SCENE_GOTO_RECORD\",\r\n        SCENE_GOTO_END: \"SCENE_GOTO_END\",\r\n        SCENE_CLOSE_MENU: \"SCENE_CLOSE_MENU\",\r\n        SCENE_PLOT_ANIM_BEGIN: \"SCENE_PLOT_ANIM_BEGIN\",\r\n        SCENE_PLOT_SKIP: \"SCENE_PLOT_SKIP\",\r\n        SCENE_PLOT_CLOSED: \"SCENE_PLOT_CLOSED\",\r\n        SCENE_PLOT_LOAD_BEGIN: \"SCENE_PLOT_LOAD_BEGIN\",\r\n        SCENE_PLOT_LOAD_ASSETS_READY: \"SCENE_PLOT_LOAD_ASSETS_READY\",\r\n        SCENE_PLOT_LOAD_ASSETS_LOADED: \"SCENE_PLOT_LOAD_ASSETS_LOADED\",\r\n        SCENE_PLOT_LOAD_END: \"SCENE_PLOT_LOAD_END\",\r\n        SCENE_BACKGROUND_COLOR_UPDATE: \"SCENE_BACKGROUND_COLOR_UPDATE\",\r\n        SCENE_BACKGROUND_UPDATE: \"SCENE_BACKGROUND_UPDATE\",\r\n        SCENE_BACKGROUND_ENTERED: \"SCENE_BACKGROUND_ENTERED\",\r\n        SCENE_BACKGROUND_SWITCH: \"SCENE_BACKGROUND_SWITCH\",\r\n        SCENE_MUSIC_UPDATE: \"SCENE_MUSIC_UPDATE\",\r\n        SCENE_SOUND_UPDATE: \"SCENE_SOUND_UPDATE\",\r\n        SCENE_CHARACTER_UPDATE: \"SCENE_CHARACTER_UPDATE\",\r\n        SCENE_PROP_UPDATE: \"SCENE_PROP_UPDATE\",\r\n        SCENE_VIEW_UPDATE: \"SCENE_VIEW_UPDATE\",\r\n        SCENE_DIALOG_UPDATE: \"SCENE_DIALOG_UPDATE\",\r\n        SCENE_DIALOG_COMPLETE: \"SCENE_DIALOG_COMPLETE\",\r\n        SCENE_CHECK_IF_SKIP: \"SCENE_CHECK_IF_SKIP\",\r\n        SCENE_CLICK_ON_SCENE: \"SCENE_CLICK_ON_SCENE\",\r\n        SCENE_OPTION_UPDATE: \"SCENE_OPTION_UPDATE\",\r\n        SCENE_MENUBUTTON_UPDATE: \"SCENE_MENUBUTTON_UPDATE\",\r\n        SCENE_WEATHER_UPDATE: \"SCENE_WEATHER_UPDATE\",\r\n        SCENE_EFFECT_SHAKE: \"SCENE_EFFECT_SHAKE\",\r\n        SCENE_EFFECT_TWINKLE: \"SCENE_EFFECT_TWINKLE\",\r\n        SCENE_CLEAR: \"SCENE_CLEAR\",\r\n        SCENE_SHOW_GUIDE:\"SCENE_SHOW_GUIDE\",//显示引导层\r\n        ADD_PLAYBACK_CONTENT: \"ADD_PLAYBACK_CONTENT\",\r\n        SCENE_DESTROY_VIEW: \"SCENE_DESTROY_VIEW\",\r\n        SCENE_SHOW_INPUT_VIEW: \"SCENE_SHOW_INPUT_VIEW\"\r\n    }\r\n};\r\n","/**\r\n * @class diygamePlayer.ApplicationFacade\r\n * @extends puremvc.Facade\r\n */\r\nimport puremvc from 'puremvc';\r\npuremvc.define\r\n(\r\n\t// CLASS INFO\r\n\t{\r\n\t\tname: 'diygamePlayer.ApplicationFacade',\r\n\t\tparent: puremvc.Facade\r\n\t}, \r\n\t\r\n\t// INSTANCE MEMBERS\r\n\t{\r\n\t\t/**\r\n\t\t * A convenience method to start the PureMVC apparatus\r\n\t\t * \r\n\t\t * @return {void}\r\n\t\t */\r\n\t\tstartup: function ()\r\n\t\t{\r\n\t\t\tif (!this.initialized)\r\n\t\t\t{\r\n\t\t\t\tthis.initialized= true;\r\n\t\t\t\t// associate the SetupCommand with the STARTUP notification\r\n\t\t\t\tthis.registerCommand( diygamePlayer.AppConstants.CMD_STARTUP, diygamePlayer.controller.command.StartupCommand );\r\n\t\t\t\t// issue the SETUP notification to execute StartupCommand\r\n\t\t\t\tthis.sendNotification( diygamePlayer.AppConstants.CMD_STARTUP );\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// STATIC MEMBERS\r\n\t{\r\n\t\t/**\r\n\t\t * Retrieve an instance of ApplicationFacade. If one has not yet been\r\n\t\t * instantiated, one will be created for you. \r\n\t\t * \r\n\t\t * @static\r\n\t\t * @param {string} multitonKey\r\n\t\t * @return demo.ApplicationFacade\r\n\t\t */\r\n\t\tgetInstance: function (multitonKey)\r\n\t\t{\r\n\t\t\t// all Facade instances, including Facade subclass instances, are stored\r\n\t\t\t// on Facade.instanceMap. When implementing you own #getInstance factory\r\n\t\t\t// method, ensure that follow the general pattern implemented here or else\r\n\t\t\t// puremvc.Facade#hasCore and puremvc.Facade#removeCore will not work if\r\n\t\t\t// you ever need to use them.\r\n\t\t\tvar instanceMap = puremvc.Facade.instanceMap;\r\n\t\t\tconst instance = instanceMap[multitonKey]; // read from the instance map\r\n\t\t\t\r\n\t\t\tif (instance) // if there is an instance...\r\n\t\t\t\treturn instance; // return it\r\n\t\t\t\r\n\t\t\t// otherwise create a new instance and cache it on Facade.instanceMap;\t\r\n\t\t\treturn instanceMap[multitonKey]= new diygamePlayer.ApplicationFacade(multitonKey);\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * @static\r\n\t\t * @type {string}\r\n\t\t */\r\n\t\tNAME: 'diygamePlayer'\r\n\t}\r\n)\r\n","export function Base64() {\r\n    // private property\r\n    let _keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n\r\n    // public method for encoding\r\n    this.encode = function (input) {\r\n        let output = \"\";\r\n        let chr1, chr2, chr3, enc1, enc2, enc3, enc4;\r\n        let i = 0;\r\n        input = _utf8_encode(input);\r\n        while (i < input.length) {\r\n            chr1 = input.charCodeAt(i++);\r\n            chr2 = input.charCodeAt(i++);\r\n            chr3 = input.charCodeAt(i++);\r\n            enc1 = chr1 >> 2;\r\n            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n            enc4 = chr3 & 63;\r\n            if (isNaN(chr2)) {\r\n                enc3 = enc4 = 64;\r\n            } else if (isNaN(chr3)) {\r\n                enc4 = 64;\r\n            }\r\n            output = output +\r\n                _keyStr.charAt(enc1) + _keyStr.charAt(enc2) +\r\n                _keyStr.charAt(enc3) + _keyStr.charAt(enc4);\r\n        }\r\n        return output;\r\n    };\r\n\r\n    // public method for decoding\r\n    this.decode = function (input) {\r\n        let output = \"\";\r\n        let chr1, chr2, chr3;\r\n        let enc1, enc2, enc3, enc4;\r\n        let i = 0;\r\n        input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\r\n        while (i < input.length) {\r\n            enc1 = _keyStr.indexOf(input.charAt(i++));\r\n            enc2 = _keyStr.indexOf(input.charAt(i++));\r\n            enc3 = _keyStr.indexOf(input.charAt(i++));\r\n            enc4 = _keyStr.indexOf(input.charAt(i++));\r\n            chr1 = (enc1 << 2) | (enc2 >> 4);\r\n            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\r\n            chr3 = ((enc3 & 3) << 6) | enc4;\r\n            output = output + String.fromCharCode(chr1);\r\n            if (enc3 != 64) {\r\n                output = output + String.fromCharCode(chr2);\r\n            }\r\n            if (enc4 != 64) {\r\n                output = output + String.fromCharCode(chr3);\r\n            }\r\n        }\r\n        output = _utf8_decode(output);\r\n        return output;\r\n    };\r\n\r\n    // private method for UTF-8 encoding\r\n    const _utf8_encode = function (string) {\r\n        string = string.replace(/\\r\\n/g,\"\\n\");\r\n        let utftext = \"\";\r\n        for (let n = 0; n < string.length; n++) {\r\n            let c = string.charCodeAt(n);\r\n            if (c < 128) {\r\n                utftext += String.fromCharCode(c);\r\n            } else if((c > 127) && (c < 2048)) {\r\n                utftext += String.fromCharCode((c >> 6) | 192);\r\n                utftext += String.fromCharCode((c & 63) | 128);\r\n            } else {\r\n                utftext += String.fromCharCode((c >> 12) | 224);\r\n                utftext += String.fromCharCode(((c >> 6) & 63) | 128);\r\n                utftext += String.fromCharCode((c & 63) | 128);\r\n            }\r\n\r\n        }\r\n        return utftext;\r\n    };\r\n\r\n    // private method for UTF-8 decoding\r\n    const _utf8_decode = function (utftext) {\r\n        let string = \"\";\r\n        let i = 0;\r\n        let c = 0;\r\n        let c1 = 0;\r\n        let c2 = 0;\r\n        let c3 = 0;\r\n        while ( i < utftext.length ) {\r\n            c = utftext.charCodeAt(i);\r\n            if (c < 128) {\r\n                string += String.fromCharCode(c);\r\n                i++;\r\n            } else if((c > 191) && (c < 224)) {\r\n                c2 = utftext.charCodeAt(i+1);\r\n                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\r\n                i += 2;\r\n            } else {\r\n                c2 = utftext.charCodeAt(i+1);\r\n                c3 = utftext.charCodeAt(i+2);\r\n                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n                i += 3;\r\n            }\r\n        }\r\n        return string;\r\n    }\r\n}","/**\r\n * Created by liuE on 2016/10/10.\r\n */\r\nexport default class Dialog {\r\n\r\n    static showDialog(title, data, type, okText, cancelText) {\r\n        !this.isShow && (this.isShow = true);\r\n        const that = this;\r\n        return new Promise((resolve, reject) => {\r\n            const ok = () => {\r\n                document.body.removeChild(modalContainer);\r\n                that.isShow = false;\r\n                resolve('ok');\r\n            };\r\n\r\n            const cancel = () => {\r\n                document.body.removeChild(modalContainer);\r\n                that.isShow = false;\r\n                reject('cancel');\r\n            };\r\n\r\n            const modalContainer = document.createElement('div');\r\n            modalContainer.classList.add('ModalContainer');\r\n            const modalPortal = document.createElement('div');\r\n            modalPortal.classList.add('ModalPortal');\r\n            if (document.body.clientWidth <= document.body.clientHeight) {\r\n                modalPortal.style.transform = 'rotate(90deg)';\r\n            }\r\n            window.onresize = function(){\r\n                if (document.body.clientWidth <= document.body.clientHeight) {\r\n                    modalPortal.style.transform = 'rotate(90deg)';\r\n                }\r\n                else {\r\n                    modalPortal.style.transform = 'rotate(0)';\r\n                }\r\n            }\r\n\r\n            modalContainer.appendChild(modalPortal);\r\n\r\n            const titleDiv = document.createElement('div');\r\n            titleDiv.classList.add('Title');\r\n            const titleData = document.createElement('span');\r\n            titleData.innerText = title;\r\n            const space = document.createElement('span');\r\n            //space.style.flex = 1;\r\n            space.classList.add('spaceSpan');\r\n            const close = document.createElement('span');\r\n            close.classList.add('Close');\r\n            close.innerText = '×';\r\n            close.onclick = cancel;\r\n            titleDiv.appendChild(titleData);\r\n            titleDiv.appendChild(space);\r\n            titleDiv.appendChild(close);\r\n            modalPortal.appendChild(titleDiv);\r\n\r\n            const content = document.createElement('div');\r\n            content.classList.add('Content');\r\n            modalPortal.appendChild(content);\r\n\r\n            const contentData = document.createElement('div');\r\n            contentData.classList.add('ContentData');\r\n            type && contentData.classList.add(type);\r\n            contentData.innerText = data;\r\n            content.appendChild(contentData);\r\n\r\n            const buttons = document.createElement('div');\r\n            buttons.classList.add('Buttons');\r\n            content.appendChild(buttons);\r\n\r\n            const buttonOk = document.createElement('button');\r\n            const buttonCancel = document.createElement('button');\r\n            buttonOk.classList.add('ButtonOk');\r\n            buttonCancel.classList.add('ButtonsCancel');\r\n            buttonOk.innerText = okText || '确定';\r\n            buttonCancel.innerText = cancelText || '取消';\r\n            buttons.appendChild(buttonOk);\r\n            buttons.appendChild(buttonCancel);\r\n\r\n            buttonOk.onclick = ok;\r\n            buttonCancel.onclick = cancel;\r\n\r\n\r\n            document.body.appendChild(modalContainer);\r\n        })\r\n    }\r\n\r\n    static info(data) {\r\n        if (this.isShow)    return;\r\n        return this.showDialog('提示', data, 'Info')\r\n    }\r\n\r\n    static warn(data) {\r\n        if (this.isShow)    return;\r\n        return this.showDialog('警告', data, 'Warn')\r\n    }\r\n\r\n    static error(data) {\r\n        if (this.isShow)    return;\r\n        return this.showDialog('错误', data, 'Error')\r\n    }\r\n}","import Utils from './Utils.js';\r\n\r\nexport default class FontUtils {\r\n    static isFontExist(name){\r\n        const baseFonts = ['Microsoft YaHei', 'Helvetica', 'sans-serif', 'serif'];\r\n        const testString = \"qwertyuiopasdfghjklzxcvbnm\";\r\n        const testSize = '72px';\r\n        const s = document.createElement(\"span\");\r\n        s.style.fontSize = testSize;\r\n        s.innerHTML = testString;\r\n        if (!this.defaultWidth || !this.defaultHeight) {\r\n            this.defaultWidth = {};\r\n            this.defaultHeight = {};\r\n            for (let index in baseFonts) {\r\n                s.style.fontFamily = baseFonts[index];\r\n                document.body.appendChild(s);\r\n                this.defaultWidth[baseFonts[index]] = s.offsetWidth;\r\n                this.defaultHeight[baseFonts[index]] = s.offsetHeight;\r\n                document.body.removeChild(s);\r\n            }\r\n        }\r\n\r\n        let detected = false;\r\n        for (let index in baseFonts) {\r\n            s.style.fontFamily = name + ',' + baseFonts[index];\r\n            document.body.appendChild(s);\r\n            var matched = (s.offsetWidth != this.defaultWidth[baseFonts[index]] || s.offsetHeight != this.defaultHeight[baseFonts[index]]);\r\n            document.body.removeChild(s);\r\n            detected = detected || matched;\r\n        }\r\n\r\n        return detected;\r\n    }\r\n\r\n    static mergeFontImage(font, default_font_size) {\r\n        let images = [];\r\n        if (font.size) {\r\n            if (font.size.target.width) {\r\n                this.charWidth = font.size.target.width;\r\n                this.charHeight = font.size.target.height;\r\n            }\r\n            else {\r\n                this.charWidth = font.size.target;\r\n                this.charHeight = font.size.target;\r\n            }\r\n        }\r\n        else {\r\n            this.charWidth = default_font_size;\r\n            this.charHeight = default_font_size;\r\n        }\r\n        this.widthImg = this.countPerRow * this.charWidth;\r\n        this.heightImg = this.rowPerImg * this.charHeight;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            if (!font) {\r\n                return resolve();\r\n            }\r\n            //font.fontFamily = 'YouYuanY';\r\n            if (this.isFontExist(font.fontFamily)) {\r\n                return resolve();\r\n            }\r\n\r\n            FontUtils.fontFamily = font.fontFamily;\r\n            for (let i=0; i<font.images.length; i++) {\r\n                images[i] = 'https://apppic.3000test.com' + font.images[i].url;\r\n                this.fontChars += font.images[i].chars;\r\n            }\r\n\r\n            // doMerge\r\n            let c = document.createElement('canvas');\r\n            let ctx = c.getContext('2d');\r\n            let len = images.length;                    // 图片数\r\n            let nRow = Math.ceil(this.fontChars.length / this.countPerRow);    // 文字行数\r\n\r\n            c.width = this.widthImg;\r\n            c.height = nRow * this.charHeight;\r\n            //ctx.rect(0, 0, c.width, c.height);\r\n            //ctx.fillStyle='#fff';\r\n            //ctx.fill();\r\n\r\n            const drawing = (n) => {\r\n                if(n < len){\r\n                    let img = new Image;\r\n                    let srcHeight = n === len - 1 ? (nRow % this.rowPerImg) * this.charHeight : this.heightImg;\r\n                    img.src = images[n];\r\n                    img.onload = function(){\r\n                        ctx.drawImage(img, 0, 0, FontUtils.widthImg, srcHeight, 0, n*FontUtils.heightImg, FontUtils.widthImg, srcHeight);\r\n                        return drawing(n+1);\r\n                    }\r\n                }else{\r\n                    //保存生成作品图片\r\n                    let base64 = c.toDataURL(\"image/png\", 1);\r\n                    let blob = Utils.dataURLtoBlob(base64);\r\n                    let blobUrl = blob ? URL.createObjectURL(blob) : base64;\r\n                    this.fontImage = blobUrl;\r\n                    return resolve();\r\n                }\r\n            };\r\n            return drawing(0);\r\n        });\r\n    }\r\n\r\n    // 每个字符宽度\r\n    static getCharSpace(char, fontSize) {\r\n        if (/[a-zA-Z0-9]/.test(char)) {\r\n            return 14 * fontSize / 25;\r\n        }\r\n        else if ('(' === char || ')' === char) {\r\n            return 8 * fontSize / 25;\r\n        }\r\n        else if ('-' === char) {\r\n            return 11 * fontSize / 25;\r\n        }\r\n        else if ('.' === char || ':' === char) {\r\n            return 7;\r\n        }\r\n        else if (32 === char.charCodeAt(0) || 160 === char.charCodeAt(0) || '\\u2002' === char) { // 半角空格 == 半个汉字\r\n            return fontSize >> 1;\r\n        }\r\n        else {\r\n            return fontSize;\r\n        }\r\n    }\r\n\r\n    static getLeftMargin(char, fontSize) {\r\n        if (/[a-zA-Z0-9\\.\\)]/.test(char)) {\r\n            return 0;\r\n        }\r\n        else if ('(' === char || ':' === char) {\r\n            return -(4 * fontSize / 25);\r\n        }\r\n        else if ('-' === char) {\r\n            return -(fontSize / 25);\r\n        }\r\n        return 6 * fontSize / 25;\r\n    }\r\n}\r\n\r\nFontUtils.defaultWidth = undefined;\r\nFontUtils.defaultHeight = undefined;\r\nFontUtils.fontImage = undefined;\r\nFontUtils.fontChars = '';\r\nFontUtils.fontFamily = '';\r\nFontUtils.charWidth = 25;   // 字宽\r\nFontUtils.charHeight = 25;  // 字高\r\nFontUtils.countPerRow = 40; // 一行字数\r\nFontUtils.rowPerImg = 20;   // 每张图片行数\r\nFontUtils.widthImg = 1000;  // 字体图片宽\r\nFontUtils.heightImg = 500;  // 字体图片高","export default class PhoneUtils {\r\n    static loadAudioUrl(key, url, local) {\r\n        if (flashvars.client === 'ios') {\r\n            let Arg = {key:key, url: url, local:local};\r\n            this.audioCountLoadByPhone.total++;\r\n            if(flashvars.offline == 1){\r\n                javascript:loadAudioUrl(JSON.stringify(Arg));\r\n            }else{\r\n                window.webkit && window.webkit.messageHandlers.loadAudioUrl.postMessage(JSON.stringify(Arg));\r\n            }\r\n        }\r\n    }\r\n\r\n    static playMusic(key, volume, loop) {\r\n        const musicKey = key ? key : this.musicKey;\r\n        const v = volume === undefined || volume === null ? 1 : volume;\r\n        const l = loop === undefined || loop === null ? true : loop;\r\n        this.musicInfo.key = musicKey;\r\n        this.musicInfo.volume = v;\r\n        this.musicInfo.tweenId = parseInt(Math.random()*100);\r\n        this.playAudioUrl(musicKey, v, l, 'music');\r\n    }\r\n\r\n    static stopMusic() {\r\n        this.stopAudioUrl('music');\r\n        this.musicInfo.key = '';\r\n    }\r\n\r\n    static playInheritMusic(volume) {\r\n        this.musicInfo.volume = volume;\r\n        this.setAudioUrlVolume('music', volume);\r\n    }\r\n\r\n    static tweenFromMusic(volume, duration, delay) {\r\n        return new Promise((resolve, reject) => {\r\n            if (duration <= 10) {\r\n                this.musicInfo.volume = volume;\r\n                this.setAudioUrlVolume('music', volume);\r\n                return resolve();\r\n            }\r\n\r\n            let nTimers = duration / 20;\r\n            let nStep = (this.musicInfo.volume - volume) / nTimers;\r\n            let nCur = volume;\r\n\r\n            this.musicInfo.tweenId = parseInt(Math.random()*100);\r\n            let tweenId = this.musicInfo.tweenId;\r\n\r\n            const doEase = () => {\r\n                const  that = this;\r\n                return function () {\r\n                    if ((that.musicInfo.volume > nCur && nStep > 0 || that.musicInfo.volume < nCur && nStep < 0)\r\n                        && tweenId === that.musicInfo.tweenId) {\r\n                        nCur += nStep;\r\n                        if (nCur > 1) nCur = 1;\r\n                        else if (nCur < 0) nCur = 0;\r\n                        that.setAudioUrlVolume('music', nCur);\r\n                        that.musicInfo.volume = nCur;\r\n                        setTimeout(doEase(), 20);\r\n                    }\r\n                    else {\r\n                        that.musicInfo.volume = volume;\r\n                        return resolve();\r\n                    }\r\n                }\r\n            };\r\n            setTimeout(doEase(), delay);\r\n        })\r\n    }\r\n\r\n    static tweenToMusic(volume, duration, delay) {\r\n        return new Promise((resolve, reject) => {\r\n            if (duration <= 10) {\r\n                this.musicInfo.volume = volume;\r\n                this.setAudioUrlVolume('music', volume);\r\n                return resolve();\r\n            }\r\n\r\n            let nTimers = duration / 20;\r\n            let nStep = (volume - this.musicInfo.volume) / nTimers;\r\n            let nCur = this.musicInfo.volume;\r\n\r\n            this.musicInfo.tweenId = parseInt(Math.random()*100);\r\n            let tweenId = this.musicInfo.tweenId;\r\n\r\n            const doEase = () => {\r\n                const that = this;\r\n                return function () {\r\n                    if ((nCur > volume && nStep < 0 || nCur < volume && nStep > 0) && tweenId === that.musicInfo.tweenId) {\r\n                        nCur += nStep;\r\n                        if (nCur < 0) nCur = 0;\r\n                        else if (nCur > 1) nCur = 1;\r\n                        that.setAudioUrlVolume('music', nCur);\r\n                        that.musicInfo.volume = nCur;\r\n                        setTimeout(doEase(), 20);\r\n                    }\r\n                    else {\r\n                        that.musicInfo.volume = volume;\r\n                        return resolve();\r\n                    }\r\n                }\r\n            };\r\n            setTimeout(doEase(), delay);\r\n        })\r\n    }\r\n\r\n    static tweenToSound(index, volume, duration, delay) {\r\n        return new Promise((resolve, reject) => {\r\n            if (!this.soundsInfo[index].key) {\r\n                return resolve();\r\n            }\r\n            if (duration <= 10) {\r\n                this.soundsInfo[index].volume = volume;\r\n                this.setAudioUrlVolume('sound'+index, volume);\r\n                return resolve();\r\n            }\r\n\r\n            let nTimers = duration / 20;\r\n            let nStep = (volume - this.soundsInfo[index].volume) / nTimers;\r\n            let nCur = this.soundsInfo[index].volume;\r\n\r\n            this.soundsInfo[index].tweenId = parseInt(Math.random()*100);\r\n            let tweenId = this.soundsInfo[index].tweenId;\r\n\r\n            const doEase = () => {\r\n                const that = this;\r\n                return function () {\r\n                    if ((nCur > volume && nStep < 0 || nCur < volume && nStep > 0) && tweenId === that.soundsInfo[index].tweenId) {\r\n                        nCur += nStep;\r\n                        if (nCur < 0) nCur = 0;\r\n                        else if (nCur > 1) nCur = 1;\r\n                        that.setAudioUrlVolume('sound'+index, nCur);\r\n                        that.soundsInfo[index].volume = nCur;\r\n                        setTimeout(doEase(), 20);\r\n                    }\r\n                    else {\r\n                        that.soundsInfo[index].volume = volume;\r\n                        return resolve();\r\n                    }\r\n                }\r\n            };\r\n            setTimeout(doEase(), delay);\r\n        })\r\n    }\r\n\r\n    static stopSound(index) {\r\n        const key = this.soundsInfo[index].key;\r\n        key && this.stopAudioUrl('sound'+index);\r\n        this.soundsInfo[index].key = '';\r\n    }\r\n\r\n    static playSound(index, key, volume, loop) {\r\n        const soundKey = key ? key : this.soundsInfo[index].key;\r\n        const v = volume === undefined || volume === null ? 1 : volume;\r\n        const l = loop === undefined || loop === null ? true : loop;\r\n        this.soundsInfo[index].key = soundKey;\r\n        this.soundsInfo[index].volume = v;\r\n        this.soundsInfo[index].loop = l;\r\n        this.soundsInfo[index].tweenId = parseInt(Math.random()*100);\r\n        this.playAudioUrl(soundKey, v, l, 'sound'+index);\r\n    }\r\n\r\n    static playInheritSound(index, volume) {\r\n        this.setAudioUrlVolume('sound'+index, volume);\r\n    }\r\n\r\n    static playAudioUrl(key, volume, loop, channel) {\r\n        if (flashvars.client === 'ios') {\r\n            let Arg = {key: key, volume:volume, loop:loop?1:0, channel:channel};\r\n            if(flashvars.offline == 1){\r\n                javascript:playAudioUrl(JSON.stringify(Arg));\r\n            }else{\r\n                window.webkit && window.webkit.messageHandlers.playAudioUrl.postMessage(JSON.stringify(Arg));\r\n            }\r\n        }\r\n    }\r\n\r\n    static stopAudioUrl(channel) {\r\n        if (flashvars.client === 'ios') {\r\n            let Arg = {channel: channel};\r\n            if(flashvars.offline == 1){\r\n                javascript:stopAudioUrl(JSON.stringify(Arg));\r\n            }else{\r\n                window.webkit && window.webkit.messageHandlers.stopAudioUrl.postMessage(JSON.stringify(Arg));\r\n            }\r\n        }\r\n    }\r\n\r\n    static setAudioUrlVolume(channel, volume) {\r\n        if (flashvars.client === 'ios') {\r\n            let Arg = {channel: channel, volume:volume};\r\n            if(flashvars.offline == 1){\r\n                javascript:setAudioUrlVolume(JSON.stringify(Arg));\r\n            }else{\r\n                window.webkit && window.webkit.messageHandlers.setAudioUrlVolume.postMessage(JSON.stringify(Arg));\r\n            }\r\n        }\r\n    }\r\n\r\n    static removeAudioUrl(key) {\r\n        if (key === this.musicInfo.key || this.soundsInfo.some(k => {return key === k})) {\r\n            return;\r\n        }\r\n\r\n        let Arg = {key: key};\r\n        this.audioResourceRef[key] = 0;\r\n        if(flashvars.offline == 1){\r\n            javascript:removeAudioUrl(JSON.stringify(Arg));\r\n        }else{\r\n            window.webkit && window.webkit.messageHandlers.removeAudioUrl.postMessage(JSON.stringify(Arg));\r\n        }\r\n    }\r\n\r\n    static isAudioInCache(key) {\r\n        return !!this.audioResourceRef[key];\r\n    }\r\n\r\n    static audioCanPlayCallBack(key) {\r\n        this.audioCountLoadByPhone.loaded++;\r\n        this.load.onSoundLoadExtend.dispatch(key);\r\n        this.audioResourceRef[key] = 1;\r\n    }\r\n}\r\n\r\nPhoneUtils.audioCountLoadByPhone = {loaded:0, total:0};\r\nPhoneUtils.load = null;\r\nPhoneUtils.musicInfo = {key:'', volume:1, tweenId:0};\r\nPhoneUtils.soundsInfo = [{key:'', volume:1, loop:false, tweenId:0}, {key:'', volume:1, loop:false, tweenId:0}, {key:'', volume:1, loop:false, tweenId:0}\r\n                        , {key:'', volume:1, loop:false, tweenId:0}, {key:'', volume:1, loop:false, tweenId:0}, {key:'',volume:1, loop:false, tweenId:0}\r\n                        , {key:'', volume:1, loop:false, tweenId:0}, {key:'', volume:1, loop:false, tweenId:0}, {key:'', volume:1, loop:false, tweenId:0}\r\n                        , {key:'', volume:1, loop:false, tweenId:0}];\r\nPhoneUtils.audioResourceRef = [];","/**\r\n * Created by liuE on 2016/10/24.\r\n */\r\nimport Utils, { AudioTagPool } from './Utils.js';\r\n\r\nexport default class Rephaser {\r\n    static updateText() {\r\n        this.texture.baseTexture.resolution = this._res,\r\n            this.context.font = this.style.font;\r\n        var a = this.text;\r\n        //this.style.wordWrap && (a = this.runWordWrap(this.text));\r\n        this.style.wordWrap && (a = this.runWordWrap(this.text), this.realText = a);\r\n        var b = a.split(/(?:\\r\\n|\\r|\\n)/)\r\n            , c = this.style.tabs\r\n            , d = []\r\n            , e = 0\r\n            , f = this.determineFontProperties(this.style.font)\r\n            , g = b.length;\r\n        this.style.maxLines > 0 && this.style.maxLines < b.length && (g = this.style.maxLines),\r\n            this._charCount = 0;\r\n        for (var h = 0; h < g; h++) {\r\n            if (0 === c) {\r\n                var i = this.style.strokeThickness + this.padding.x;\r\n                i += this.colors.length > 0 || this.strokeColors.length > 0 || this.fontWeights.length > 0 || this.fontStyles.length > 0 ? this.measureLine(b[h]) : this.context.measureText(b[h]).width\r\n                //,this.style.wordWrap && (i -= this.context.measureText(\" \").width)\r\n            } else {\r\n                var j = b[h].split(/(?:\\t)/)\r\n                    , i = this.padding.x + this.style.strokeThickness;\r\n                if (Array.isArray(c))\r\n                    for (var k = 0, l = 0; l < j.length; l++) {\r\n                        var m = 0;\r\n                        m = this.colors.length > 0 || this.strokeColors.length > 0 || this.fontWeights.length > 0 || this.fontStyles.length > 0 ? this.measureLine(j[l]) : Math.ceil(this.context.measureText(j[l]).width),\r\n                        l > 0 && (k += c[l - 1]),\r\n                            i = k + m\r\n                    }\r\n                else\r\n                    for (var l = 0; l < j.length; l++) {\r\n                        i += this.colors.length > 0 || this.strokeColors.length > 0 || this.fontWeights.length > 0 || this.fontStyles.length > 0 ? this.measureLine(j[l]) : Math.ceil(this.context.measureText(j[l]).width);\r\n                        var n = this.game.math.snapToCeil(i, c) - i;\r\n                        i += n\r\n                    }\r\n            }\r\n            d[h] = Math.ceil(i),\r\n                e = Math.max(e, d[h])\r\n        }\r\n        this.canvas.width =  e * this._res;\r\n        var o = f.fontSize + this.style.strokeThickness + this.padding.y\r\n            , p = o * g\r\n            , q = this._lineSpacing;\r\n        0 > q && Math.abs(q) > o && (q = -o),\r\n        0 !== q && (p += q > 0 ? q * b.length : q * (b.length - 1)),\r\n            this.canvas.height = (p-4) * this._res, // raw: p * this._res,\r\n            this.context.scale(this._res, this._res),\r\n        navigator.isCocoonJS && this.context.clearRect(0, 0, this.canvas.width, this.canvas.height),\r\n        this.style.backgroundColor && (this.context.fillStyle = this.style.backgroundColor,\r\n            this.context.fillRect(0, 0, this.canvas.width, this.canvas.height)),\r\n            this.context.fillStyle = this.style.fill,\r\n            this.context.font = this.style.font,\r\n            this.context.strokeStyle = this.style.stroke,\r\n            this.context.textBaseline = \"alphabetic\",\r\n            this.context.lineWidth = this.style.strokeThickness,\r\n            this.context.lineCap = \"round\",\r\n            this.context.lineJoin = \"round\";\r\n        var r, s, h;\r\n        for (this._charCount = 0,\r\n                 h = 0; g > h; h++)\r\n            r = this.style.strokeThickness / 2,\r\n                s = this.style.strokeThickness / 2 + h * o + f.ascent,\r\n            h > 0 && (s += q * h),\r\n                \"right\" === this.style.align ? r += e - d[h] : \"center\" === this.style.align && (r += (e - d[h]) / 2),\r\n            this.autoRound && (r = Math.round(r),\r\n                s = Math.round(s)),\r\n                this.colors.length > 0 || this.strokeColors.length > 0 || this.fontWeights.length > 0 || this.fontStyles.length > 0 ? this.updateLine(b[h], r, s) : (this.style.stroke && this.style.strokeThickness && (this.updateShadow(this.style.shadowStroke),\r\n                    0 === c ? this.context.strokeText(b[h], r, s) : this.renderTabLine(b[h], r, s, !1)),\r\n                this.style.fill && (this.updateShadow(this.style.shadowFill),\r\n                    0 === c ? this.context.fillText(b[h], r, s) : this.renderTabLine(b[h], r, s, !0)));\r\n        this.updateTexture()\r\n    }\r\n\r\n    static advancedWordWrap(a) {\r\n        for (var b = this.context, c = this.style.wordWrapWidth, d = \"\", e = a.split(/\\r?\\n/gi), f = e.length, g = 0; g < f; g++) {\r\n            let h = e[g];\r\n            var j = b.measureText(h).width;\r\n            if (j < c)\r\n                d += h + \"\\n\";\r\n            else {\r\n                const isConnect = (a, b) => {\r\n                    if (!a || !b || /\\s/.test(a) || /\\s/.test(b)) {\r\n                        return false;\r\n                    }\r\n                    const reg = /[\\u4E00-\\u9FA5\\uF900-\\uFA2D]|\\s/;     //汉字空格\r\n                    const combinators = new RegExp(\"[!！)）|}':;',\\\\].>》/?……）\\\\-|}】‘；：”“’。，、？]\");\r\n                    const terminator = new RegExp(\"[!！?？:：;；.。》』\\\\-\\\\]】）]\");\r\n                    return reg.test(a) && combinators.test(b) || !reg.test(a) && !reg.test(b) && !terminator.test(a)\r\n                };\r\n                let o = h;\r\n                while (1) {\r\n                    let m = -1;\r\n                    let q = '';\r\n                    let p = b.measureText(o).width;\r\n                    if (p > c) {\r\n                        for (let i = 0; o[i] && (q += o[i],\r\n                            p = b.measureText(q).width, m = isConnect(o[i - 1], o[i]) ? m : i - 1, i++,\r\n                            (p < c));)\r\n                            ;\r\n                        if (m !== -1 && m !== (q.length - 1)) {\r\n                            q && (q = q.slice(0, m + 1));\r\n                            o = o.substr(q.length).trimLeft();\r\n                        } else {\r\n                            q && (q = q.slice(0, -1));\r\n                            o = o.substr(q.length).trimLeft()\r\n                        }\r\n                        d += q + '\\n';\r\n                    } else {\r\n                        o && (d += o + '\\n');\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return d = d.replace(/\\n$/gi, \"\")\r\n    }\r\n\r\n    static loadImageTag (file) {\r\n\r\n        const onLoad = xhr => {\r\n            const arraybuffer = xhr.requestObject.response;\r\n            let data;\r\n            if (arraybuffer instanceof ArrayBuffer) {\r\n                data = new Uint8Array(arraybuffer);\r\n            }\r\n            let isGif = false;\r\n            if (data[0] === 'G'.charCodeAt()\r\n                && data[1] === 'I'.charCodeAt()\r\n                && data[2] === 'F'.charCodeAt()\r\n                && data[3] === '8'.charCodeAt()\r\n                && (data[4] === '9'.charCodeAt() || '7'.charCodeAt())\r\n                && data[5] === 'a'.charCodeAt()) {\r\n                isGif = true;\r\n            }\r\n\r\n            file.data = new Image();\r\n            file.data.name = file.key;\r\n\r\n            if (this.crossOrigin)\r\n            {\r\n                file.data.crossOrigin = this.crossOrigin;\r\n            }\r\n\r\n            const onComplete = () => {\r\n                if (file.data.onload)\r\n                {\r\n                    file.data.onload = null;\r\n                    file.data.onerror = null;\r\n                    this.fileComplete(file);\r\n                }\r\n            };\r\n\r\n            file.data.onload = () => {\r\n                URL.revokeObjectURL(file.url);\r\n                onComplete()\r\n            };\r\n\r\n            file.data.onerror = () => {\r\n                URL.revokeObjectURL(file.url);\r\n                if (file.data.onload)\r\n                {\r\n                    file.data.onload = null;\r\n                    file.data.onerror = null;\r\n                    this.fileError(file);\r\n                }\r\n            };\r\n\r\n            if (isGif) {\r\n                Utils.spliceGif(arraybuffer).then(r => {\r\n                    file.data.frames = r.frames;\r\n                    file.data.loopCount = r.loopCount;\r\n                    file.url = URL.createObjectURL(Utils.createBlob(arraybuffer, ''));\r\n                    file.data.src = this.transformUrl(file.url, file);\r\n                }, () => {\r\n                    file.url = URL.createObjectURL(Utils.createBlob(arraybuffer, ''));\r\n                    file.data.src = this.transformUrl(file.url, file);\r\n                });\r\n            } else {\r\n                file.url = URL.createObjectURL(Utils.createBlob(arraybuffer, ''));\r\n                file.data.src = this.transformUrl(file.url, file);\r\n            }\r\n\r\n            // Image is immediately-available/cached\r\n            if (file.data.complete && file.data.width && file.data.height)\r\n            {\r\n                file.data.onload = null;\r\n                file.data.onerror = null;\r\n                this.fileComplete(file);\r\n            }\r\n        };\r\n\r\n        this.xhrLoad(file, this.transformUrl(file.url, file), 'arraybuffer', onLoad);\r\n    }\r\n\r\n    static soundStop() {\r\n\r\n        if (this.isPlaying && this._sound)\r\n        {\r\n            if (this.usingWebAudio)\r\n            {\r\n                if (this.externalNode)\r\n                {\r\n                    const endfun = this._sound.onended;\r\n                    this._sound.onended = () => {\r\n                        this._sound.disconnect(this.externalNode);\r\n                        endfun && endfun();\r\n                    };\r\n                }\r\n                else if (this.gainNode)\r\n                {\r\n                    const endfun = this._sound.onended;\r\n                    this._sound.onended = () => {\r\n                        this._sound.disconnect(this.gainNode);\r\n                        endfun && endfun();\r\n                    };\r\n                }\r\n                if (this._sound.stop === undefined)\r\n                {\r\n                    this._sound.noteOff(0);\r\n                }\r\n                else\r\n                {\r\n                    try {\r\n                        this._sound.stop(0);\r\n                    }\r\n                    catch (e)\r\n                    {\r\n                        alert(e);\r\n                        //  Thanks Android 4.4\r\n                    }\r\n                }\r\n\r\n            }\r\n            else if (this.usingAudioTag)\r\n            {\r\n                this._sound.pause();\r\n                this._sound.currentTime = 0;\r\n            }\r\n        }\r\n\r\n        this.pendingPlayback = false;\r\n        this.isPlaying = false;\r\n\r\n        if (!this.paused)\r\n        {\r\n            const prevMarker = this.currentMarker;\r\n\r\n            if (this.currentMarker !== '')\r\n            {\r\n                this.onMarkerComplete.dispatch(this.currentMarker, this);\r\n            }\r\n\r\n            this.currentMarker = '';\r\n\r\n            if (this.fadeTween !== null)\r\n            {\r\n                this.fadeTween.stop();\r\n            }\r\n\r\n            this.onStop.dispatch(this, prevMarker);\r\n        }\r\n    }\r\n    \r\n    static soundDecode(key, sound) {\r\n        sound = sound || null;\r\n        const soundData = this.game.cache.getSoundData(key);\r\n        if (soundData) {\r\n            if (this.game.cache.isSoundDecoded(key) === false) {\r\n                this.game.cache.updateSound(key, 'isDecoding', true);\r\n                const that = this;\r\n                const handleError = () => {\r\n                    this.onSoundDecodeError.dispatch(key);\r\n                    console.warn('Unable to encode audio ' + key);\r\n                };\r\n                try {\r\n                    this.context.decodeAudioData(soundData, function (buffer) {\r\n                        if (buffer) {\r\n                            that.game.cache.decodedSound(key, buffer);\r\n                            that.onSoundDecode.dispatch(key, sound);\r\n                        }\r\n                    }).catch(handleError);\r\n                }\r\n                catch (e) {\r\n                    handleError();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    static loadAudioTag(file) {\r\n\r\n        let url = file.url;\r\n        if (url.indexOf(\"?\") >= 0){\r\n            url = url.substr(0, url.indexOf(\"?\"));\r\n        }\r\n        let extension = url.substr((Math.max(0, url.lastIndexOf(\".\")) || Infinity) + 1);\r\n        const isDatAudio = extension.toLowerCase() === 'dat';\r\n\r\n        const setFileData = file => {\r\n            if (this.game.sound.touchLocked) {\r\n                //  If audio is locked we can't do this yet, so need to queue this load request. Bum.\r\n                file.data = AudioTagPool.get();\r\n                file.data.name = file.key;\r\n                file.data.src = this.transformUrl(file.url, file);\r\n\r\n                this.fileComplete(file);\r\n            } else {\r\n                var audio = AudioTagPool.get();\r\n                file.data = audio;\r\n                file.data.name = file.key;\r\n\r\n                if (!AudioTagPool.exist(audio)) {\r\n                    this.game.sound.touchLocked = true;\r\n                    file.data.src = this.transformUrl(file.url, file);\r\n                    this.fileComplete(file);\r\n                    return;\r\n                }\r\n\r\n                const playThroughEvent = () => {\r\n                    file.data.removeEventListener('canplaythrough', playThroughEvent, false);\r\n                    file.data.onerror = null;\r\n                    this.fileComplete(file);\r\n                };\r\n\r\n                file.data.onerror = () => {\r\n                    file.data.removeEventListener('canplaythrough', playThroughEvent, false);\r\n                    file.data.onerror = null;\r\n                    this.fileComplete(file);\r\n                };\r\n\r\n                file.data.src = this.transformUrl(file.url, file);\r\n                file.data.addEventListener('canplaythrough', playThroughEvent, false);\r\n                file.data.load();\r\n            }\r\n        };\r\n\r\n        const convertDat = (file) => {\r\n            if(this.game.device.android){\r\n                setFileData(file);\r\n                return;\r\n            }\r\n            this.xhrLoad(file, this.transformUrl(file.url, file), 'arraybuffer', (file, xhr) => {\r\n                file.url = URL.createObjectURL(new Blob([xhr.response], { type: 'audio/mp3' }));\r\n                file.isDatFile = true;\r\n                setFileData(file);\r\n            });\r\n        };\r\n\r\n        if(isDatAudio){\r\n            convertDat(file);\r\n        }else{\r\n            setFileData(file);\r\n        }\r\n    }\r\n\r\n    static tintWithMultiply(texture, color, canvas) {\r\n        let context = canvas.getContext(\"2d\");\r\n\r\n        let crop = texture.crop;\r\n        let w = crop.width;\r\n        let h = crop.height;\r\n\r\n        if (texture.rotated)\r\n        {\r\n            w = h;\r\n            h = crop.width;\r\n        }\r\n\r\n        if (canvas.width !== w || canvas.height !== h)\r\n        {\r\n            canvas.width = w;\r\n            canvas.height = h;\r\n        }\r\n\r\n        context.clearRect(0, 0, w, h);\r\n\r\n        context.drawImage(texture.baseTexture.source, crop.x, crop.y, w, h, 0, 0, w, h);\r\n        context.globalCompositeOperation = \"source-atop\";\r\n\r\n        context.fillStyle = \"#\" + (\"00000\" + (color | 0).toString(16)).substr(-6);\r\n        context.fillRect(0, 0, w, h);\r\n    }\r\n}\r\n\r\n(() => {\r\n    PIXI.CanvasTinter.tintWithMultiply = Rephaser.tintWithMultiply;\r\n    Phaser.Game.prototype.destroyComponent = new Phaser.Signal();\r\n\r\n    const spriteDestroy = Phaser.Sprite.prototype.destroy;\r\n    Phaser.Sprite.prototype.destroy = function () {\r\n        const game = this.game;\r\n        spriteDestroy.apply(this, arguments);\r\n        game && game.destroyComponent && game.destroyComponent.dispatch(this.key || null);\r\n    };\r\n\r\n    const imageDestroy = Phaser.Image.prototype.destroy;\r\n    Phaser.Image.prototype.destroy = function () {\r\n        const game = this.game;\r\n        imageDestroy.apply(this, arguments);\r\n        game && game.destroyComponent && game.destroyComponent.dispatch(this.key || null);\r\n    };\r\n\r\n    Phaser.Loader.prototype.loadAudioTag = Rephaser.loadAudioTag;\r\n    \r\n    const soundDestroy = Phaser.Sound.prototype.destroy;\r\n    Phaser.Sound.prototype.destroy =  function () {\r\n        soundDestroy.apply(this, arguments);\r\n        if (this.usingWebAudio) {\r\n            if (this.game.sound.context && !this.game.sound.scratchBuffer) {\r\n                this.game.sound.scratchBuffer = this.game.sound.context.createBuffer(1, 1, 22050);\r\n            }\r\n            try {this._sound.buffer = this.game.sound.scratchBuffer;} catch (e) {}\r\n        }\r\n        this._sound = null;\r\n    };\r\n\r\n    Phaser.Cache.prototype.reloadSound = function (key) {\r\n        var _this = this;\r\n        var sound = this.getSound(key);\r\n\r\n        if (sound && !AudioTagPool.exist(sound.data)) {\r\n            var audio = AudioTagPool.get();\r\n            if (!AudioTagPool.exist(audio)) {\r\n                return;\r\n            }\r\n            sound.data = audio;\r\n            sound.data.src = sound.url;\r\n            sound.data.addEventListener('canplaythrough', function () {\r\n                return _this.reloadSoundComplete(key);\r\n            }, false);\r\n            sound.data.load();\r\n        }\r\n    };\r\n    \r\n    Phaser.Device.canPlayAudio = function (type) {\r\n        if (type === 'mp3' && this.mp3) {\r\n            return true;\r\n        } else if (type === 'ogg' && (this.ogg || this.opus)) {\r\n            return true;\r\n        } else if (type === 'm4a' && this.m4a) {\r\n            return true;\r\n        } else if (type === 'opus' && this.opus) {\r\n            return true;\r\n        } else if (type === 'wav' && this.wav) {\r\n            return true;\r\n        } else if (type === 'webm' && this.webm) {\r\n            return true;\r\n        } else if (type === 'mp4' && this.dolby) {\r\n            return true;\r\n        }else if (type === 'dat') {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    Phaser.SoundManager.prototype.setMute = function () {\r\n        if (this._muted) {\r\n            return;\r\n        }\r\n        this._muted = true;\r\n\r\n        if (this.usingWebAudio) {\r\n            this._muteVolume = this.masterGain.gain.value;\r\n            this.masterGain.gain.value = 0;\r\n        }\r\n\r\n        for (var i = 0; i < this._sounds.length; i++) {\r\n            if (this._sounds[i].usingAudioTag) {\r\n                //fix iOS audio tag volume always stays set at 1\r\n                this.game.device.iOS && this._sounds[i].pause();\r\n                this._sounds[i].mute = true;\r\n            }\r\n        }\r\n        this.onMute.dispatch();\r\n    };\r\n\r\n    Phaser.SoundManager.prototype.unsetMute = function () {\r\n        if (!this._muted || this._codeMuted) {\r\n            return;\r\n        }\r\n\r\n        this._muted = false;\r\n\r\n        if (this.usingWebAudio) {\r\n            this.masterGain.gain.value = this._muteVolume;\r\n        }\r\n\r\n        for (var i = 0; i < this._sounds.length; i++) {\r\n            if (this._sounds[i].usingAudioTag) {\r\n                //fix iOS audio tag volume always stays set at 1\r\n                this.game.device.iOS && this._sounds[i].resume();\r\n                this._sounds[i].mute = false;\r\n            }\r\n        }\r\n        this.onUnMute.dispatch();\r\n    };\r\n})();\r\n","/**\r\n * Created by 4399-1126 on 2017/7/25.\r\n */\r\nexport default class ShanyiMenu {\r\n    static showSyMenu() {\r\n        !this.isShow && (this.isShow = true);\r\n        const that = this;\r\n        return new Promise((resolve, reject) => {\r\n            const back = () => {\r\n                document.body.removeChild(modalContainer);\r\n                that.isShow = false;\r\n                resolve(1);\r\n            };\r\n            const exit = (urlToGo) => {\r\n                document.body.removeChild(modalContainer);\r\n                that.isShow = false;\r\n                resolve(urlToGo);\r\n            };\r\n\r\n            gameCallback.syMenuBack = back;\r\n            gameCallback.syMenuExit = exit;\r\n\r\n            const modalContainer = document.createElement('div');\r\n            modalContainer.classList.add('syModalContainer');\r\n            const modalPortal = document.createElement('div');\r\n            modalPortal.classList.add('syModalPortal');\r\n            if (document.body.clientWidth <= document.body.clientHeight) {\r\n                modalPortal.style.transform = 'rotate(90deg)';\r\n            }\r\n            window.onresize = function(){\r\n                if (document.body.clientWidth <= document.body.clientHeight) {\r\n                    modalPortal.style.transform = 'rotate(90deg)';\r\n                }\r\n                else {\r\n                    modalPortal.style.transform = 'rotate(0)';\r\n                }\r\n            }\r\n\r\n            modalContainer.appendChild(modalPortal);\r\n\r\n            const content = document.createElement('div');\r\n            content.classList.add('syContent');\r\n            modalPortal.appendChild(content);\r\n\r\n            const contentData = document.createElement('iframe');\r\n            contentData.src = 'https://www.3000.com/popup.html?uuid=' + flashvars.uuid + \"&wap=\" + flashvars.wap;\r\n            contentData.scrolling = 'no';\r\n            contentData.width = '100%';\r\n            contentData.height = '100%';\r\n            contentData.frameBorder = '0';\r\n            content.appendChild(contentData);\r\n\r\n            document.body.appendChild(modalContainer);\r\n        })\r\n    }\r\n}","/**\r\n * Created by liuE on 2016/10/17.\r\n */\r\nimport * as xhr from './XmlHttpRequest.js';\r\nimport commit from './Version.js';\r\nimport {Base64} from './Base64.js';\r\nimport CryptoJS from 'crypto-js';\r\nimport MD5 from 'spark-md5';\r\nimport PhoneUtils from './PhoneUtils.js';\r\n\r\nexport default class Utils {\r\n    static convertToAllowAccessControlOriginUrl(url) {\r\n        if (!url) {\r\n            return Promise.resolve('');\r\n        }\r\n        if (url === \"http://f1.img4399.com/ma~217_20160518155234_573c1f42bb260.jpeg\") {\r\n            //3000logo\r\n            return Promise.resolve(\"https://apppic.3000test.com/m~web/41/2017/02/08/09_j1sGyq.960x540.jpg\");\r\n        }\r\n        if (url[0] === '/') {\r\n            url = url.substring(1);\r\n        }\r\n        if (!/blob:/i.test(url)) {\r\n            let resultUrl;\r\n            let index = url.indexOf(\"://\");\r\n            if (index > -1) {\r\n                const parts = url.split('/');\r\n                parts.shift();\r\n                parts.shift(); // skip\r\n                parts.shift();\r\n                resultUrl = 'https://apppic.3000test.com/' + parts.join('/');\r\n            }\r\n            else {\r\n                resultUrl = 'https://apppic.3000test.com/' + url;\r\n            }\r\n            if (flashvars.offline === '1') {\r\n                resultUrl = 'game' + flashvars.gid + '/' + resultUrl.substring(28);\r\n            }\r\n            return Promise.resolve(resultUrl);\r\n        }\r\n        else {\r\n            return Promise.reject(url);\r\n        }\r\n    }\r\n\r\n    static spliceGif(arraybuffer) {\r\n        return new Promise((resolve, reject) => {\r\n\r\n            let currentData;\r\n            let currentPos = 0;\r\n            let hdr;\r\n            const tmpCanvas = document.createElement('canvas');\r\n            const spliceCanvas = document.createElement('canvas');\r\n            let frame;\r\n            let lastDisposalMethod;\r\n            let transparency = null;\r\n            let delay = null;\r\n            let disposalMethod = null;\r\n            let disposalRestoreFromIdx = null;\r\n            let lastImg = null;\r\n            let loopCount = 1;\r\n            const frames = [];\r\n\r\n            const bitsToNum = ba => {\r\n                return ba.reduce((s, n) => {\r\n                    return s * 2 + n;\r\n                }, 0);\r\n            };\r\n\r\n            const byteToBitArr = bite => {\r\n                const a = [];\r\n                for (let i = 7; i >= 0; i--) {\r\n                    a.push(!!(bite & (1 << i)));\r\n                }\r\n                return a;\r\n            };\r\n\r\n            const Stream = function (data) {\r\n                currentData = data;\r\n                currentPos = 0;\r\n\r\n                this.readByte = function () {\r\n                    if (currentPos >= data.length) {\r\n                        throw new Error('Attempted to read past end of stream.');\r\n                    }\r\n                    if (data instanceof Uint8Array)\r\n                        return data[currentPos++];\r\n                    else\r\n                        return data.charCodeAt(currentPos++) & 0xFF;\r\n                };\r\n\r\n                this.readBytes = function (n) {\r\n                    var bytes = [];\r\n                    for (var i = 0; i < n; i++) {\r\n                        bytes.push(this.readByte());\r\n                    }\r\n                    return bytes;\r\n                };\r\n\r\n                this.read = function (n) {\r\n                    var s = '';\r\n                    for (var i = 0; i < n; i++) {\r\n                        s += String.fromCharCode(this.readByte());\r\n                    }\r\n                    return s;\r\n                };\r\n\r\n                this.readUnsigned = function () { // Little-endian.\r\n                    var a = this.readBytes(2);\r\n                    return (a[1] << 8) + a[0];\r\n                };\r\n            };\r\n\r\n            const lzwDecode = (minCodeSize, data) => {\r\n                let pos = 0; // Maybe this streaming thing should be merged with the Stream?\r\n                let readCode = size => {\r\n                    let code = 0;\r\n                    for (let i = 0; i < size; i++) {\r\n                        if (data[pos >> 3] & (1 << (pos & 7))) {\r\n                            code |= 1 << i;\r\n                        }\r\n                        pos++;\r\n                    }\r\n                    return code;\r\n                };\r\n\r\n\r\n                let clearCode = 1 << minCodeSize;\r\n                let eoiCode = clearCode + 1;\r\n\r\n                let codeSize = minCodeSize + 1;\r\n\r\n                let outputBlockSize = 4096,\r\n                    bufferBlockSize = 4096;\r\n\r\n                let output = new Uint8Array(outputBlockSize),\r\n                    buffer = new Uint8Array(bufferBlockSize),\r\n                    dict = [];\r\n\r\n                let bufferOffset = 0,\r\n                    outputOffset = 0;\r\n\r\n\r\n                const fill = function () {\r\n                    for (let i = 0; i < clearCode; i++) {\r\n                        dict[i] = new Uint8Array(1);\r\n                        dict[i][0] = i;\r\n                    }\r\n                    dict[clearCode] = new Uint8Array(0);\r\n                    dict[eoiCode] = null;\r\n                };\r\n                const clear = function () {\r\n                    const keep = clearCode + 2;\r\n                    dict.splice(keep, dict.length - keep);\r\n                    codeSize = minCodeSize + 1;\r\n                    bufferOffset = 0;\r\n                };\r\n\r\n                // Block allocators, double block size each time\r\n                const enlargeOutput = function () {\r\n                    const outputSize = output.length + outputBlockSize;\r\n                    const newoutput = new Uint8Array(outputSize);\r\n                    newoutput.set(output);\r\n                    output = newoutput;\r\n                    outputBlockSize = outputBlockSize << 1;\r\n                };\r\n                const enlargeBuffer = function () {\r\n                    const bufferSize = buffer.length + bufferBlockSize;\r\n                    let newbuffer = new Uint8Array(bufferSize);\r\n                    newbuffer.set(buffer);\r\n                    buffer = newbuffer;\r\n                    bufferBlockSize = bufferBlockSize << 1;\r\n                };\r\n\r\n                const pushCode = function (code, last) {\r\n                    var newlength = dict[last].byteLength + 1;\r\n                    while (bufferOffset + newlength > buffer.length) enlargeBuffer();\r\n                    var newdict = buffer.subarray(bufferOffset, bufferOffset + newlength);\r\n                    newdict.set(dict[last]);\r\n                    newdict[newlength - 1] = dict[code][0];\r\n                    bufferOffset += newlength;\r\n                    dict.push(newdict);\r\n                };\r\n\r\n                let code;\r\n                let last;\r\n\r\n                fill();\r\n\r\n                while (true) {\r\n                    last = code;\r\n                    code = readCode(codeSize);\r\n\r\n                    if (code === clearCode) {\r\n                        clear();\r\n                        continue;\r\n                    }\r\n                    if (code === eoiCode) break;\r\n\r\n                    if (code < dict.length) {\r\n                        if (last !== clearCode) {\r\n                            pushCode(code, last);\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (code !== dict.length) throw new Error('Invalid LZW code.');\r\n                        pushCode(last, last);\r\n                    }\r\n\r\n                    const newsize = dict[code].length;\r\n                    while (outputOffset + newsize > output.length) enlargeOutput();\r\n                    output.set(dict[code], outputOffset);\r\n                    outputOffset += newsize;\r\n\r\n                    if (dict.length === (1 << codeSize) && codeSize < 12) {\r\n                        // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\r\n                        codeSize++;\r\n                    }\r\n                }\r\n\r\n                // I don't know if this is technically an error, but some GIFs do it.\r\n                //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\r\n                return output.subarray(0, outputOffset);\r\n            };\r\n\r\n            const setSizes = (w, h) => {\r\n                tmpCanvas.width = w;\r\n                tmpCanvas.height = h;\r\n                tmpCanvas.style.width = w + 'px';\r\n                tmpCanvas.style.height = h + 'px';\r\n                tmpCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\r\n                spliceCanvas.width = w;\r\n                spliceCanvas.height = w;\r\n            };\r\n\r\n            const clear = () => {\r\n                transparency = null;\r\n                delay = null;\r\n                lastDisposalMethod = disposalMethod;\r\n                disposalMethod = null;\r\n                frame = null;\r\n            };\r\n\r\n            const doHdr = _hdr => {\r\n                hdr = _hdr;\r\n                setSizes(hdr.width, hdr.height)\r\n            };\r\n\r\n            const doGCE = gce => {\r\n                pushFrame();\r\n                clear();\r\n                transparency = gce.transparencyGiven ? gce.transparencyIndex : null;\r\n                delay = gce.delayTime;\r\n                disposalMethod = gce.disposalMethod;\r\n                // We don't have much to do with the rest of GCE.\r\n            };\r\n\r\n            const pushFrame = () => {\r\n                if (!frame) return;\r\n                let dataUrl = tmpCanvas.toDataURL('image/png');\r\n                let blob = this.dataURLtoBlob(dataUrl);\r\n                frames.push({\r\n                    //base64: dataUrl,\r\n                    blobUrl: blob ? URL.createObjectURL(blob) : dataUrl,\r\n                    delay: Math.max(delay, 10)\r\n                });\r\n            };\r\n\r\n            const doImg = img => {\r\n                if (!frame) frame = tmpCanvas.getContext('2d');\r\n\r\n                const currIdx = frames.length;\r\n\r\n                //ct = color table, gct = global color table\r\n                const ct = img.lctFlag ? img.lct : hdr.gct; // TODO: What if neither exists?\r\n\r\n                if (currIdx > 0) {\r\n                    if (lastDisposalMethod === 3) {\r\n                        // Restore to previous\r\n                        // If we disposed every frame including first frame up to this point, then we have\r\n                        // no composited frame to restore to. In this case, restore to background instead.\r\n                        if (disposalRestoreFromIdx !== null) {\r\n                            if(frames[disposalRestoreFromIdx].data) frame.putImageData(frames[disposalRestoreFromIdx].data, 0, 0);\r\n                        } else {\r\n                            frame.clearRect(lastImg.leftPos, lastImg.topPos, lastImg.width, lastImg.height);\r\n                        }\r\n                    } else {\r\n                        disposalRestoreFromIdx = currIdx - 1;\r\n                    }\r\n\r\n                    if (lastDisposalMethod === 2) {\r\n                        // Restore to background color\r\n                        // Browser implementations historically restore to transparent; we do the same.\r\n                        // http://www.wizards-toolkit.org/discourse-server/viewtopic.php?f=1&t=21172#p86079\r\n                        frame.clearRect(lastImg.leftPos, lastImg.topPos, lastImg.width, lastImg.height);\r\n                    }\r\n                }\r\n                // else, Undefined/Do not dispose.\r\n                // frame contains final pixel data from the last frame; do nothing\r\n\r\n                //Get existing pixels for img region after applying disposal method\r\n                const imgData = frame.getImageData(img.leftPos, img.topPos, img.width, img.height);\r\n\r\n                //apply color table colors\r\n                for (let i = 0; i < img.pixels.length; i++) {\r\n                    const pixel = img.pixels[i];\r\n                    // imgData.data === [R,G,B,A,R,G,B,A,...]\r\n                    if (pixel !== transparency) {\r\n                        const pix = ct[pixel];\r\n                        const idx = i * 4;\r\n                        imgData.data[idx] = pix[0];\r\n                        imgData.data[idx + 1] = pix[1];\r\n                        imgData.data[idx + 2] = pix[2];\r\n                        imgData.data[idx + 3] = 255; // Opaque.\r\n                    }\r\n                }\r\n\r\n                frame.putImageData(imgData, img.leftPos, img.topPos);\r\n\r\n                lastImg = img;\r\n            };\r\n\r\n            const doNothing = function () {\r\n            };\r\n\r\n            const doNetscape = block => {\r\n                loopCount = block.iterations;\r\n            };\r\n\r\n            const handler = {\r\n                hdr: doHdr,\r\n                gce: doGCE,\r\n                com: doNothing,\r\n                // I guess that's all for now.\r\n                app: {\r\n                    // TODO: Is there much point in actually supporting iterations?\r\n                    NETSCAPE: doNetscape\r\n                },\r\n                img: doImg,\r\n                eof: () => {\r\n                    //toolbar.style.display = '';\r\n                    pushFrame();\r\n                }\r\n            };\r\n\r\n            const parseGIF = (st, handler) => {\r\n                handler || (handler = {});\r\n\r\n                // LZW (GIF-specific)\r\n                const parseCT = function (entries) { // Each entry is 3 bytes, for RGB.\r\n                    const ct = [];\r\n                    for (let i = 0; i < entries; i++) {\r\n                        ct.push(st.readBytes(3));\r\n                    }\r\n                    return ct;\r\n                };\r\n\r\n                const readSubBlocks = function () {\r\n                    let size, data, offset = 0;\r\n                    const bufsize = 8192;\r\n                    data = new Uint8Array(bufsize);\r\n\r\n                    const resizeBuffer = function () {\r\n                        const newdata = new Uint8Array(data.length + bufsize);\r\n                        newdata.set(data);\r\n                        data = newdata;\r\n                    };\r\n\r\n                    do {\r\n                        size = st.readByte();\r\n\r\n                        // Increase buffer size if this would exceed our current size\r\n                        while (offset + size > data.length) resizeBuffer();\r\n                        data.set(st.readBytes(size), offset);\r\n                        offset += size;\r\n                    } while (size !== 0);\r\n                    return data.subarray(0, offset); // truncate any excess buffer space\r\n                };\r\n\r\n                const parseHeader = function () {\r\n                    const hdr = {};\r\n                    hdr.sig = st.read(3);\r\n                    hdr.ver = st.read(3);\r\n                    if (hdr.sig !== 'GIF') throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\r\n                    hdr.width = st.readUnsigned();\r\n                    hdr.height = st.readUnsigned();\r\n\r\n                    const bits = byteToBitArr(st.readByte());\r\n                    hdr.gctFlag = bits.shift();\r\n                    hdr.colorRes = bitsToNum(bits.splice(0, 3));\r\n                    hdr.sorted = bits.shift();\r\n                    hdr.gctSize = bitsToNum(bits.splice(0, 3));\r\n\r\n                    hdr.bgColor = st.readByte();\r\n                    hdr.pixelAspectRatio = st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n                    if (hdr.gctFlag) {\r\n                        hdr.gct = parseCT(1 << (hdr.gctSize + 1));\r\n                    }\r\n                    handler.hdr && handler.hdr(hdr);\r\n                };\r\n\r\n                const parseExt = function (block) {\r\n                    const parseGCExt = function (block) {\r\n                        const blockSize = st.readByte(); // Always 4\r\n                        const bits = byteToBitArr(st.readByte());\r\n                        block.reserved = bits.splice(0, 3); // Reserved; should be 000.\r\n                        block.disposalMethod = bitsToNum(bits.splice(0, 3));\r\n                        block.userInput = bits.shift();\r\n                        block.transparencyGiven = bits.shift();\r\n\r\n                        block.delayTime = st.readUnsigned();\r\n\r\n                        block.transparencyIndex = st.readByte();\r\n\r\n                        block.terminator = st.readByte();\r\n\r\n                        handler.gce && handler.gce(block);\r\n                    };\r\n\r\n                    const parseComExt = function (block) {\r\n                        block.comment = readSubBlocks();\r\n                        handler.com && handler.com(block);\r\n                    };\r\n\r\n                    const parsePTExt = function (block) {\r\n                        // No one *ever* uses this. If you use it, deal with parsing it yourself.\r\n                        const blockSize = st.readByte(); // Always 12\r\n                        block.ptHeader = st.readBytes(12);\r\n                        block.ptData = readSubBlocks();\r\n                        handler.pte && handler.pte(block);\r\n                    };\r\n\r\n                    const parseAppExt = function (block) {\r\n                        const parseNetscapeExt = function (block) {\r\n                            const blockSize = st.readByte(); // Always 3\r\n                            block.unknown = st.readByte(); // ??? Always 1? What is this?\r\n                            block.iterations = st.readUnsigned();\r\n                            block.terminator = st.readByte();\r\n                            handler.app && handler.app.NETSCAPE && handler.app.NETSCAPE(block);\r\n                        };\r\n\r\n                        const parseUnknownAppExt = function (block) {\r\n                            block.appData = readSubBlocks();\r\n                            // FIXME: This won't work if a handler wants to match on any identifier.\r\n                            handler.app && handler.app[block.identifier] && handler.app[block.identifier](block);\r\n                        };\r\n\r\n                        const blockSize = st.readByte(); // Always 11\r\n                        block.identifier = st.read(8);\r\n                        block.authCode = st.read(3);\r\n                        switch (block.identifier) {\r\n                            case 'NETSCAPE':\r\n                                parseNetscapeExt(block);\r\n                                break;\r\n                            default:\r\n                                parseUnknownAppExt(block);\r\n                                break;\r\n                        }\r\n                    };\r\n\r\n                    const parseUnknownExt = function (block) {\r\n                        block.data = readSubBlocks();\r\n                        handler.unknown && handler.unknown(block);\r\n                    };\r\n\r\n                    block.label = st.readByte();\r\n                    switch (block.label) {\r\n                        case 0xF9:\r\n                            block.extType = 'gce';\r\n                            parseGCExt(block);\r\n                            break;\r\n                        case 0xFE:\r\n                            block.extType = 'com';\r\n                            parseComExt(block);\r\n                            break;\r\n                        case 0x01:\r\n                            block.extType = 'pte';\r\n                            parsePTExt(block);\r\n                            break;\r\n                        case 0xFF:\r\n                            block.extType = 'app';\r\n                            parseAppExt(block);\r\n                            break;\r\n                        default:\r\n                            block.extType = 'unknown';\r\n                            parseUnknownExt(block);\r\n                            break;\r\n                    }\r\n                };\r\n\r\n                const parseImg = function (img) {\r\n                    const deinterlace = function (pixels, width) {\r\n                        // Of course this defeats the purpose of interlacing. And it's *probably*\r\n                        // the least efficient way it's ever been implemented. But nevertheless...\r\n                        var newPixels = new Array(pixels.length);\r\n                        var rows = pixels.length / width;\r\n                        var cpRow = function (toRow, fromRow) {\r\n                            var fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\r\n                            newPixels.splice.apply(newPixels, [toRow * width, width].concat(...fromPixels));\r\n                        };\r\n\r\n                        // See appendix E.\r\n                        var offsets = [0, 4, 2, 1];\r\n                        var steps = [8, 8, 4, 2];\r\n\r\n                        var fromRow = 0;\r\n                        for (var pass = 0; pass < 4; pass++) {\r\n                            for (var toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\r\n                                cpRow(toRow, fromRow)\r\n                                fromRow++;\r\n                            }\r\n                        }\r\n\r\n                        return newPixels;\r\n                    };\r\n\r\n                    img.leftPos = st.readUnsigned();\r\n                    img.topPos = st.readUnsigned();\r\n                    img.width = st.readUnsigned();\r\n                    img.height = st.readUnsigned();\r\n\r\n                    var bits = byteToBitArr(st.readByte());\r\n                    img.lctFlag = bits.shift();\r\n                    img.interlaced = bits.shift();\r\n                    img.sorted = bits.shift();\r\n                    img.reserved = bits.splice(0, 2);\r\n                    img.lctSize = bitsToNum(bits.splice(0, 3));\r\n\r\n                    if (img.lctFlag) {\r\n                        img.lct = parseCT(1 << (img.lctSize + 1));\r\n                    }\r\n\r\n                    img.lzwMinCodeSize = st.readByte();\r\n\r\n                    var lzwData = readSubBlocks();\r\n\r\n                    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\r\n\r\n                    if (img.interlaced) { // Move\r\n                        img.pixels = deinterlace(img.pixels, img.width);\r\n                    }\r\n\r\n                    handler.img && handler.img(img);\r\n                };\r\n\r\n                const parseBlock = function () {\r\n                    var block = {};\r\n                    block.sentinel = st.readByte();\r\n\r\n                    switch (String.fromCharCode(block.sentinel)) { // For ease of matching\r\n                        case '!':\r\n                            block.type = 'ext';\r\n                            parseExt(block);\r\n                            break;\r\n                        case ',':\r\n                            block.type = 'img';\r\n                            parseImg(block);\r\n                            break;\r\n                        case ';':\r\n                            block.type = 'eof';\r\n                            handler.eof && handler.eof(block);\r\n                            break;\r\n                        default:\r\n                            throw new Error('Unknown block: 0x' + block.sentinel.toString(16)); // TODO: Pad this with a 0.\r\n                    }\r\n\r\n                    if (block.type !== 'eof') {\r\n                        setTimeout(parseBlock, 0);\r\n                    } else {\r\n                        resolve({\r\n                            loopCount: loopCount,\r\n                            frames: frames\r\n                        })\r\n                    }\r\n                };\r\n\r\n                const parse = () => {\r\n                    parseHeader();\r\n                    setTimeout(parseBlock, 0);\r\n                };\r\n\r\n                parse();\r\n            };\r\n\r\n            try {\r\n                const data = new Uint8Array(arraybuffer);\r\n                const stream = new Stream(data);\r\n                setTimeout(parseGIF(stream, handler), 0);\r\n            }\r\n            catch (err) {\r\n                reject(err);\r\n                console.error('parseGIF ERROR!!' + err);\r\n            }\r\n        })\r\n    }\r\n\r\n    static isObject(data) {\r\n        return Object.prototype.toString.apply(data) === '[object Object]';\r\n    }\r\n\r\n    static fixColorValue(color) {\r\n        const tempColor = color.match(/rgb\\([\\s]*(\\d+)[\\s]*,[\\s]*(\\d+)[\\s]*,[\\s]*(\\d+)[\\s]*\\)/i);\r\n        const toHex = value => {\r\n            const hex = parseInt(value, 10).toString(16);\r\n            if (hex.length !== 2) {\r\n                return '0' + hex;\r\n            } else {\r\n                return hex;\r\n            }\r\n        };\r\n\r\n        if (tempColor) {\r\n            color = '#' + toHex(tempColor[1]) + toHex(tempColor[2]) + toHex(tempColor[3]);\r\n            return color;\r\n        }\r\n\r\n        if (color && color[0] !== '#') {\r\n            color = '#' + color;\r\n        }\r\n\r\n        if (isNaN(parseInt(color.slice(1), 16))) {\r\n            color = '#ffffff';\r\n        }\r\n\r\n        return color ? color : '#ffffff';\r\n    }\r\n\r\n    static timeout(time) {\r\n        let handle = null;\r\n        const promise = new Promise((resolve, reject) => handle = setTimeout(resolve, time));\r\n        promise.cancel = () => clearTimeout(handle);\r\n        return promise;\r\n    }\r\n\r\n    static getTimeOffset() {\r\n        let url = 'https://my.3000.com/?m=timestamp&op=index&ac=get&api_v=1.0.0&api_from=webpc';\r\n        return xhr.xhrGetServerTime(url).then(rs => {\r\n            if (rs.responseText.length === 0) {\r\n                return Promise.reject('Get file failed, no response data');\r\n            }\r\n            let retData = JSON.parse(rs.responseText);\r\n            if (retData.status === 0) {\r\n                this.timeStamp = retData.data.timestamp;\r\n                this.timeOffset = this.timeStamp - Math.floor((new Date()).getTime() / 1000);\r\n                return Promise.resolve(this.timeOffset);\r\n            }\r\n            else {\r\n                return Promise.reject(retData.msg + ': ' + retData.status);\r\n            }\r\n        }, rj => {\r\n            return Promise.reject(rj);\r\n        });\r\n    }\r\n\r\n    static updateContextTimeValues(context) {\r\n        if (-1 === this.timeStamp) return;\r\n\r\n        context.systemValues[2].value = Math.floor(Date.now() / 1000) + this.timeOffset;\r\n        let date = new Date(context.systemValues[2].value * 1000);\r\n        context.systemValues[3].value = date.getFullYear();\r\n        context.systemValues[4].value = date.getMonth() + 1;\r\n        context.systemValues[5].value = date.getDate();\r\n        context.systemValues[6].value = date.getHours();\r\n        context.systemValues[7].value = date.getMinutes();\r\n        context.systemValues[8].value = date.getSeconds();\r\n        context.systemValues[10].value = date.getDay();\r\n    }\r\n\r\n    static getCurrentDateTime(timestamp) {\r\n        let date = new Date(timestamp);\r\n        let seperator1 = \"-\";\r\n        let seperator2 = \":\";\r\n        let toStr = function(value, max, min) {\r\n            if (value >= min && value <= max) {\r\n                return ('0' + value);\r\n            }\r\n            else{\r\n                return ('' + value);\r\n            }\r\n        };\r\n        let currentdate = date.getFullYear()\r\n            + seperator1 + toStr(date.getMonth() + 1, 9, 1)\r\n            + seperator1 + toStr(date.getDate(), 9, 0)\r\n            + \" \" + toStr(date.getHours(), 9, 0)\r\n            + seperator2 + toStr(date.getMinutes(), 9, 0)\r\n            + seperator2 + toStr(date.getSeconds(), 9, 0);\r\n        return currentdate;\r\n    }\r\n\r\n    static createBlob(parts, type) {\r\n        let BlobBuilder, bb;\r\n        try {\r\n            return new Blob([parts]);\r\n        } catch (e) {\r\n            BlobBuilder = window.BlobBuilder ||\r\n                window.WebKitBlobBuilder ||\r\n                window.MozBlobBuilder ||\r\n                window.MSBlobBuilder;\r\n            if (BlobBuilder) {\r\n                bb = new BlobBuilder();\r\n                bb.append(parts);\r\n                return bb.getBlob(type);\r\n            } else {\r\n                throw new Error(\"Unable to create blob\");\r\n            }\r\n        }\r\n    }\r\n\r\n    static dataURLtoBlob(dataUrl) {\r\n        let arr = dataUrl.split(','), mime = arr[0].match(/:(.*?);/)[1],\r\n            bStr = atob(arr[1]), n = bStr.length, u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bStr.charCodeAt(n);\r\n        }\r\n        let blobObj = null;\r\n        try {\r\n            blobObj = new Blob([u8arr], {type:mime});\r\n        } catch (err) {\r\n            console.error(err.name + '  ' + err.message);\r\n        }\r\n        return blobObj;\r\n    }\r\n\r\n    static encodeBase64(msg) {\r\n        if (msg === '') return '';\r\n        const base64 = new Base64();\r\n        return base64.encode(msg);\r\n    }\r\n\r\n    static decryptBase64(msg) {\r\n        if (msg === '') return '';\r\n        const base64 = new Base64();\r\n        return base64.decode(msg);\r\n    }\r\n\r\n    static aesEncrypt(msg, type) {\r\n        //msg = JSON.stringify({\"ss\": 1});\r\n        if (msg === '') return '';\r\n        let rawKey = 'de3kt|jq|fdcgj_|';\r\n        let rawVec = 'ff_|pf|#%@fw_j+q';\r\n        if (type === 1) {\r\n            rawKey = 'WDF#$H*#SJN*&G$&';\r\n            rawVec = 'JH&$GF$DR%*K@SC%';\r\n        }\r\n        else if (type === 2) {\r\n            // 获取已收费章节\r\n            rawKey = 'aDF#$HGF$DN*&G$e';\r\n            rawVec = 'bH&$GF$DcF#$HSCf';\r\n        }\r\n        // 密钥\r\n        let key = CryptoJS.enc.Utf8.parse(rawKey);\r\n        // 初始向量\r\n        let ivv = CryptoJS.enc.Utf8.parse(rawVec);\r\n        // 加密\r\n        let encrypted = CryptoJS.AES.encrypt(msg+'', key, {iv: ivv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.ZeroPadding});\r\n        // 转换为字符串\r\n        let enstr = encrypted.toString();\r\n        return enstr;\r\n    }\r\n\r\n    static aesDecrypt(msg, type) {\r\n        //msg = 'b25zHxn+S5dnVOrJPDn6DQ==';\r\n        if (msg === '') return '';\r\n        let rawKey = 'de3kt|jq|fdcgj_|';\r\n        let rawVec = 'ff_|pf|#%@fw_j+q';\r\n        if (type === 1) {\r\n            rawKey = 'WDF#$H*#SJN*&G$&';\r\n            rawVec = 'JH&$GF$DR%*K@SC%';\r\n        }\r\n        else if (type === 2) {\r\n            // 获取已收费章节\r\n            rawKey = 'aDF#$HGF$DN*&G$e';\r\n            rawVec = 'bH&$GF$DcF#$HSCf';\r\n        }\r\n        // 密钥\r\n        let key = CryptoJS.enc.Utf8.parse(rawKey);\r\n        // 初始向量\r\n        let ivv = CryptoJS.enc.Utf8.parse(rawVec);\r\n        //解密\r\n        let decrypted = CryptoJS.AES.decrypt(msg, key, {iv: ivv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.ZeroPadding});\r\n        let deStr = decrypted.toString(CryptoJS.enc.Utf8);\r\n        return deStr;\r\n    }\r\n\r\n    static getCookie(name) {\r\n        let arr,reg = new RegExp(\"(^| )\"+name+\"=([^;]*)(;|$)\");\r\n        if(arr = document.cookie.match(reg))\r\n            return decodeURI(arr[2]);\r\n        else\r\n            return null;\r\n    }\r\n\r\n    static getUidByCookie() {\r\n        let uid = this.getCookie('SYPauth');\r\n        if (uid) {\r\n            let index = uid.indexOf('|');\r\n            uid = uid.substring(0, index);\r\n        }\r\n        return uid ? uid : '';\r\n    }\r\n\r\n    static generateUUID() {\r\n        let d = new Date().getTime();\r\n        let uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n            let r = (d + Math.random()*16)%16 | 0;\r\n            d = Math.floor(d/16);\r\n            return (c=='x' ? r : (r&0x3|0x8)).toString(16);\r\n        });\r\n        return uuid;\r\n    }\r\n\r\n    static localStorageGetItem(key) {\r\n        if (flashvars.app_version < '1.2.0') {\r\n            return window.localStorage.getItem(key);\r\n        }\r\n        if (flashvars.client === 'android' && window.app) {\r\n            const retValue = window.app.localStorage_getItem(key);\r\n            return (retValue === '' ? null : retValue);\r\n        }\r\n        else if (flashvars.client === 'ios') {\r\n            let returnValue = null;\r\n\r\n            if(flashvars.offline == 1){\r\n                returnValue = localStorage_getItem(key);\r\n            } else {\r\n                returnValue = window.localStorage.getItem(key);\r\n            }\r\n\r\n            if (returnValue === '') returnValue = null;\r\n\r\n            return returnValue;\r\n        }\r\n        else if (flashvars.client === '') {\r\n            return window.localStorage.getItem(key);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static localStorageSetItem(key, value) {\r\n        if (flashvars.app_version < '1.2.0') {\r\n            window.localStorage.setItem(key, value);\r\n            /*if (flashvars.client === 'android' || flashvars.client === 'ios') {\r\n                this.uploadLocalStorage(key);\r\n            }*/\r\n            return\r\n        }\r\n        if (flashvars.client === 'android') {\r\n            window.app && window.app.localStorage_setItem(key, value);\r\n        }\r\n        else if (flashvars.client === 'ios') {\r\n            const arg = {key: key, value: value};\r\n            if(flashvars.offline == 1){\r\n                localStorage_setItem(JSON.stringify(arg));\r\n            }else{\r\n                window.webkit && window.webkit.messageHandlers.localStorage_setItem.postMessage(JSON.stringify(arg));\r\n                window.localStorage.setItem(key, value);\r\n            }\r\n        }\r\n        else {\r\n            window.localStorage.setItem(key, value);\r\n        }\r\n    }\r\n\r\n    static localStorageRemoveItem(key) {\r\n        if (flashvars.app_version < '1.2.0') {\r\n            window.localStorage.removeItem(key);\r\n            return;\r\n        }\r\n        if (flashvars.client === 'android') {\r\n            window.app && window.app.removeLocalStorage(key);\r\n        }\r\n        else if (flashvars.client === 'ios') {\r\n            if(flashvars.offline == 1){\r\n                removeLocalStorage(key);\r\n            }else{\r\n                window.webkit && window.webkit.messageHandlers.removeLocalStorage.postMessage(key);\r\n                window.localStorage.removeItem(key);\r\n            }\r\n        }\r\n        else {\r\n            window.localStorage.removeItem(key);\r\n        }\r\n    }\r\n\r\n    static localStorageClear() {\r\n        window.localStorage.clear();\r\n    }\r\n\r\n    static getSensitiveWords() {\r\n        let url = 'https://mapi.3000api.com/apis/soft/v1.0/game-GetSensitiveStr.html';\r\n        let data = 'action=all';\r\n        return xhr.xhrSend(url, data).then(rs => {\r\n            if (rs.responseText.length === 0) {\r\n                return Promise.reject('getSensitiveWords failed, no response data');\r\n            }\r\n            let retData = JSON.parse(rs.responseText);\r\n            if (retData.code == 100) {\r\n                this.sensitiveWords = retData.result.concat();\r\n                return Promise.resolve();\r\n            }\r\n            else {\r\n                return Promise.reject();\r\n            }\r\n        }, rj => {\r\n            return Promise.reject(rj);\r\n        });\r\n    }\r\n\r\n    static getDeviceId() {\r\n        if (flashvars.client === 'android') {\r\n            let uuid = navigator.userAgent.match(/[0-9A-Za-z]{8}-[0-9A-Za-z]{4}-[0-9A-Za-z]{4}-[0-9A-Za-z]{4}-[0-9A-Za-z]{12}/g);\r\n            return uuid ? uuid[0] : '';\r\n        }\r\n        else if (flashvars.client === 'ios') {\r\n            let uuid = navigator.userAgent.match(/[0-9A-Za-z]{40}/g);\r\n            return uuid ? uuid[0] : '';\r\n        }\r\n        return '';\r\n    }\r\n\r\n    static formatNum(n) {\r\n        if (0 === n) return '00000';\r\n        else if (n < 10) return ('0000' + n);\r\n        else if (n < 100) return ('000' + n);\r\n        else return ('00' + n);\r\n    };\r\n\r\n    static sendStatistics() {\r\n        if (flashvars.client !== 'android' && flashvars.client !== 'ios') {\r\n            return Promise.resolve();\r\n        }\r\n\r\n        let deviceId = this.getDeviceId();\r\n        let stime = Math.floor((new Date()).getTime() / 1000) + this.timeOffset;\r\n        let sSign = 'mac_name=' + deviceId + '&time=' + stime + '&uid=' + flashvars.uid + '&v_key=shanyi_WDF#$H*#SJN*&G$&**';\r\n        sSign = this.aesEncrypt(MD5.hash(MD5.hash(sSign)), 1);\r\n        stime = this.aesEncrypt(stime, 1);\r\n\r\n        let url = 'https://app.3000.com/?m=statistics&op=start&ac=h5&v=' + flashvars.v + '&client=' + flashvars.client;\r\n        let data = 'mac_name=' + encodeURIComponent(this.aesEncrypt(deviceId, 1)) + '&uid=' + encodeURIComponent(this.aesEncrypt(flashvars.uid, 1))\r\n            + '&sign=' + encodeURIComponent(sSign) + '&time=' + encodeURIComponent(stime);\r\n        return xhr.xhrSend(url, data);\r\n    }\r\n\r\n    static sendSelOptions() {\r\n        const doSend = () => {\r\n            if (this.selOptions.length === 0) {\r\n                setTimeout(timerHandler(), 30000);\r\n                return Promise.resolve();\r\n            }\r\n\r\n            let url = 'https://www.3000.com/apis/client/v1.0/trace-optionClick.html?';\r\n            let data = 'from=h5&uuid=' + flashvars.uuid + '&optionid=' + JSON.stringify(this.selOptions);\r\n            return xhr.xhrLoad(url + data, '').then(() => {\r\n                this.selOptions.splice(0, this.selOptions.length);\r\n                setTimeout(timerHandler(), 30000);\r\n                return Promise.resolve();\r\n            }, () => {\r\n                setTimeout(timerHandler(), 30000);\r\n                return Promise.reject();\r\n            });\r\n        };\r\n        const timerHandler = () => {\r\n            return function () {\r\n                doSend();\r\n            }\r\n        };\r\n        setTimeout(timerHandler(), 30000);\r\n    }\r\n\r\n    /*static uploadLocalStorage(spKey) {\r\n        if (flashvars.app_version >= '1.2.0') {\r\n            return Promise.resolve();\r\n        }\r\n\r\n        const deviceId = this.getDeviceId();\r\n        const tag = window.localStorage.getItem('syUploaded');\r\n\r\n        const uploadOneItem = (key, value) => {\r\n            const sendData = (url, data) => {\r\n                return xhr.xhrSend(url, data).then(rs => {\r\n                    if (rs.responseText.length === 0) {\r\n                        window.localStorage.removeItem('syUploaded');\r\n                        return Promise.reject('uploadOneItem failed, no response data');\r\n                    }\r\n                    let retData = JSON.parse(rs.responseText);\r\n                    if (retData.status === 0) {\r\n                        return Promise.resolve();\r\n                    }\r\n                    else {\r\n                        window.localStorage.removeItem('syUploaded');\r\n                        return Promise.reject();\r\n                    }\r\n                }, rj => {\r\n                    window.localStorage.removeItem('syUploaded');\r\n                    return Promise.reject(rj);\r\n                });\r\n            };\r\n\r\n            let valueBase64 = this.encodeBase64(value);\r\n            let stime = Math.floor((new Date()).getTime() / 1000) + this.timeOffset;\r\n            let sSign = 'content=' + valueBase64 + '&game_key=' + key + '&h5_version=' + commit + '&mac_name=' + deviceId + '&time=' + stime+ '&v_key=shanyi_WDF#$H*#SJN*&G$&**';\r\n            sSign = this.aesEncrypt(MD5.hash(MD5.hash(sSign)), 1);\r\n            stime = this.aesEncrypt(stime, 1);\r\n\r\n            let url = 'https://app.3000.com/?m=cloud_save&op=back_up&ac=save&v=' + flashvars.v + '&client=' + flashvars.client;\r\n            let data = 'game_key=' + encodeURIComponent(this.aesEncrypt(key, 1)) + '&mac_name=' + encodeURIComponent(this.aesEncrypt(deviceId, 1)) + '&h5_version='\r\n                + encodeURIComponent(this.aesEncrypt(commit, 1)) + '&content=' + encodeURIComponent(this.aesEncrypt(valueBase64, 1))\r\n                + '&sign=' + encodeURIComponent(sSign) + '&time=' + encodeURIComponent(stime);\r\n\r\n            return sendData(url, data);\r\n        };\r\n        const uploadItemOneByOne = (index, times) => {\r\n            if (index >= window.localStorage.length) {\r\n                // 全部上传成功 设置标志\r\n                window.localStorage.setItem('syUploaded', '1');\r\n                return Promise.resolve();\r\n            }\r\n            if (times > 3) {\r\n                // 上传失败只尝试4次\r\n                return Promise.resolve();\r\n            }\r\n            let key = window.localStorage.key(index);\r\n            let data = window.localStorage.getItem(key);\r\n            let check = key.match(/[0-9A-Za-z]{8}-[0-9A-Za-z]{4}-[0-9A-Za-z]{4}-[0-9A-Za-z]{4}-[0-9A-Za-z]{12}/g);\r\n\r\n            if (!check) {\r\n                return uploadItemOneByOne(index+1, 0)\r\n            }\r\n            return uploadOneItem(key, data).then(() => {\r\n                return uploadItemOneByOne(index+1, 0)\r\n            }, () => {\r\n                return uploadItemOneByOne(index, times+1)\r\n            });\r\n        };\r\n\r\n        if (!deviceId) {\r\n            return Promise.resolve();\r\n        }\r\n        if (!spKey && tag !== '1') {\r\n            return uploadItemOneByOne(0, 0);\r\n        }\r\n        else if (spKey) {\r\n            // 上传特定数据\r\n            let data = window.localStorage.getItem(spKey);\r\n            return uploadOneItem(spKey, data);\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n\r\n    static downloadLocalStorage() {\r\n        if (flashvars.app_version < '1.2.0') {\r\n            return Promise.resolve();\r\n        }\r\n        const tag = this.localStorageGetItem('syDownloaded');\r\n        if (tag === '1') {\r\n            return Promise.resolve();\r\n        }\r\n        const deviceId = this.getDeviceId();\r\n        if (!deviceId) {\r\n            return Promise.resolve();\r\n        }\r\n\r\n        let keys = [];\r\n        const getKeys = () => {\r\n            let stime = Math.floor((new Date()).getTime() / 1000) + this.timeOffset;\r\n            let sSign = 'mac_name=' + deviceId + '&time=' + stime + '&v_key=shanyi_WDF#$H*#SJN*&G$&**';\r\n            sSign = this.aesEncrypt(MD5.hash(MD5.hash(sSign)), 1);\r\n            stime = this.aesEncrypt(stime, 1);\r\n\r\n            let url = 'https://app.3000.com/?m=cloud_save&op=back_up&ac=all_key&v=' + flashvars.v + '&client=' + flashvars.client;\r\n            let data = 'mac_name=' + encodeURIComponent(this.aesEncrypt(deviceId, 1)) + '&sign=' + encodeURIComponent(sSign) + '&time=' + encodeURIComponent(stime);\r\n            return xhr.xhrSend(url, data).then(rs => {\r\n                if (rs.responseText.length === 0) {\r\n                    return Promise.reject('getKeys failed, no response data');\r\n                }\r\n                let retData = JSON.parse(rs.responseText);\r\n                if (retData.status === 0) {\r\n                    keys = retData.data.result.concat();\r\n                    return Promise.resolve();\r\n                }\r\n                else {\r\n                    return Promise.reject();\r\n                }\r\n            }, rj => {\r\n                return Promise.reject();\r\n            })\r\n        };\r\n        const getValue = (index) => {\r\n            let stime = Math.floor((new Date()).getTime() / 1000) + this.timeOffset;\r\n            let sSign = 'game_key=' + keys[index] + '&mac_name=' + deviceId + '&time=' + stime + '&v_key=shanyi_WDF#$H*#SJN*&G$&**';\r\n            sSign = this.aesEncrypt(MD5.hash(MD5.hash(sSign)), 1);\r\n            stime = this.aesEncrypt(stime, 1);\r\n\r\n            let url = 'https://app.3000.com/?m=cloud_save&op=back_up&ac=info&v=' + flashvars.v + '&client=' + flashvars.client;\r\n            let data = 'game_key=' + encodeURIComponent(this.aesEncrypt(keys[index], 1)) + '&mac_name=' + encodeURIComponent(this.aesEncrypt(deviceId, 1))\r\n                + '&sign=' + encodeURIComponent(sSign) + '&time=' + encodeURIComponent(stime);\r\n\r\n            return xhr.xhrSend(url, data).then(rs => {\r\n                if (rs.responseText.length === 0) {\r\n                    return Promise.reject('getLocalStorageData failed, no response data');\r\n                }\r\n                let retData = JSON.parse(rs.responseText);\r\n                if (retData.status === 0) {\r\n                    let d = this.decryptBase64(retData.data.content);\r\n                    this.localStorageSetItem(keys[index], d);\r\n                    return Promise.resolve();\r\n                }\r\n                else {\r\n                    return Promise.reject();\r\n                }\r\n            }, rj => {\r\n                return Promise.reject();\r\n            })\r\n        };\r\n        const getItemOneByOne = (index) => {\r\n            if (index >= keys.length) {\r\n                // 数据已全部下载\r\n                this.localStorageSetItem('syDownloaded', '1');\r\n                return Promise.resolve();\r\n            }\r\n            return getValue(index).then(rs => {\r\n                return getItemOneByOne(index+1)\r\n            }, rj => {\r\n                return Promise.reject()\r\n            })\r\n        };\r\n\r\n        return getKeys().then(rs => {\r\n            return getItemOneByOne(0)\r\n        }, rj => {\r\n            return Promise.reject()\r\n        });\r\n    }*/\r\n}\r\n\r\nUtils.timeStamp = -1;        // 服务器时间戳\r\nUtils.timeOffset = 0;       // 与服务器间时间偏移量\r\nUtils.sensitiveWords = [];  // 敏感词\r\nUtils.selOptions = [];      // 游戏经过的选项uuid\r\n\r\nexport class ResourcesManager {\r\n    static forEachReCount(fun) {\r\n        Object.keys(this.refCount.audio).forEach(key => fun && fun('audio', key, this.getCount('audio', key)));\r\n        Object.keys(this.refCount.img).forEach(key => fun && fun('img', key, this.getCount('img', key)));\r\n    }\r\n\r\n    static resetReCount() {\r\n        Object.keys(this.refCount.audio).forEach(key => {\r\n            const { global=0 } = this.refCount.audio[key];\r\n            this.refCount.audio[key] = { global };\r\n        });\r\n        Object.keys(this.refCount.img).forEach(key => {\r\n            const { global=0 } = this.refCount.img[key];\r\n            this.refCount.img[key] = { global };\r\n        });\r\n    }\r\n\r\n    static removeFromCache(type, key) {\r\n        if (!this.refCount[type][key]) {\r\n            return;\r\n        }\r\n        if (this.getCount(type, key)) {\r\n            return;\r\n        }\r\n        if (type === 'audio' && this.cache) {\r\n            if ('ios' === flashvars.client && flashvars.app_version >= '1.5.0') {\r\n                PhoneUtils.removeAudioUrl(key);\r\n            }\r\n            else {\r\n                const sound = this.cache.getSound(key);\r\n                if (sound && sound.audioTag && sound.data) {\r\n                    sound.data.free = true;\r\n                }\r\n                if (sound && /blob:/i.test(sound.url)) {\r\n                    URL.revokeObjectURL(sound.url);\r\n                }\r\n                this.cache.checkSoundKey(key) && this.cache.removeSound(key);\r\n            }\r\n\r\n            delete this.refCount[type][key];\r\n        }\r\n\r\n        if (type === 'img' && this.cache) {\r\n            const image = this.cache.getImage(key, true);\r\n            if(image){\r\n                const { frames } = image.data;\r\n                frames && frames.forEach((frame) => {\r\n                    URL.revokeObjectURL(frame.blobUrl);\r\n                    frame.blobUrl = null;\r\n                });\r\n                /blob:/i.test(image.url) && URL.revokeObjectURL(image.url);\r\n                this.cache.removeImage(key);\r\n            }\r\n            delete this.refCount[type][key];\r\n        }\r\n    }\r\n\r\n    static transferRefCount(type, fKey, fRefType, tKey, tRefType) {\r\n        this.refCount[type][tKey] = this.refCount[type][tKey] || {};\r\n        this.refCount[type][tKey][tRefType] = this.refCount[type][tKey][tRefType] || 0;\r\n        if (!this.refCount[type][fKey]) {\r\n            return;\r\n        }\r\n        this.refCount[type][tKey][tRefType] += this.refCount[type][fKey][fRefType];\r\n        this.refCount[type][fKey][fRefType] = 0;\r\n        this.removeFromCache(type, fKey);\r\n    }\r\n\r\n    static transferByRefCount(fRefType, tRefType) {\r\n        Object.keys(this.refCount.audio).forEach(key => {\r\n            const refCount = this.refCount.audio[key];\r\n            refCount[tRefType] = (refCount[tRefType] || 0)+(refCount[fRefType] || 0);\r\n            refCount[fRefType] = 0;\r\n        });\r\n        Object.keys(this.refCount.img).forEach(key => {\r\n            const refCount = this.refCount.img[key];\r\n            refCount[tRefType] = (refCount[tRefType] || 0)+(refCount[fRefType] || 0);\r\n            refCount[fRefType] = 0;\r\n        });\r\n    }\r\n    \r\n    static addRefCount(type, key, refType='play', count=1) {\r\n        if (!type || !key) {\r\n            return;\r\n        }\r\n        this.refCount[type][key] = this.refCount[type][key] || {};\r\n        this.refCount[type][key][refType] = (this.refCount[type][key][refType] || 0) + count;\r\n    }\r\n\r\n    static subRefCount(type, key, refType='play') {\r\n        if (this.refCount[type][key]) {\r\n            const refCount = this.refCount[type][key];\r\n            refCount[refType] = (refCount[refType] || 0) - 1;\r\n            refCount[refType] = refCount[refType] < 0 ? 0 : refCount[refType];\r\n            this.removeFromCache(type, key);\r\n        }\r\n        else if ('audio' === type && 'ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n            !!key && PhoneUtils.removeAudioUrl(key);\r\n        }\r\n    }\r\n\r\n    static delRefTypeCount(type, key, refType) {\r\n        if (this.refCount[type][key]) {\r\n            const refCount = this.refCount[type][key];\r\n            refCount[refType] = 0;\r\n            this.removeFromCache(type, key);\r\n        }\r\n    }\r\n\r\n    static delByRefType(refType){\r\n        Object.keys(this.refCount.audio).every(key => {\r\n            this.refCount.audio[key][refType] = 0;\r\n            this.removeFromCache('audio', key);\r\n        });\r\n        Object.keys(this.refCount.img).every(key => {\r\n            this.refCount.img[key][refType] = 0;\r\n            this.removeFromCache('img', key);\r\n        });\r\n    }\r\n\r\n    static getCount(type, key, refType = '') {\r\n        return this.refCount[type][key]\r\n            ? (refType ? (this.refCount[type][key][refType] || 0) : Object.keys(this.refCount[type][key]).reduce((acc, cur) => acc + this.refCount[type][key][cur], 0))\r\n            : 0;\r\n    }\r\n\r\n    static getResourcesByContext(context, chapter, pIndex = 0, cmdInfo, cIndex =0) {\r\n        const lastUsedKeyMap = this.lastUsedKeyMap;\r\n        const resources = { data: [], size: 0 };\r\n        let frame = context && context.stack[0];\r\n        let cmdFrame = context && context.cmdStack[0];\r\n\r\n        if (!chapter || !chapter.plots || !chapter.plots[pIndex] || cmdInfo && !cmdInfo.commands[cIndex]) {\r\n            return Promise.resolve(resources);\r\n        }\r\n\r\n        const isMaxSize = (isCommand = false) => resources.size > this.MaxSize || !isCommand && resources.data.length > this.MaxCount;\r\n\r\n        const addResource = (url, type, preloadType) => {\r\n            this.addRefCount(type, url, preloadType);\r\n            if (!resources.data.some(d => d.key === url)) {\r\n                return xhr.getResourceSize(url, type).then(size => {\r\n                    resources.data.push({ key: url, type, size });\r\n                    resources.size += size;\r\n                });\r\n            }\r\n            return Promise.resolve();\r\n        };\r\n\r\n        const addWeatherResource = (type, preloadType) => {\r\n            const promises = [];\r\n            if (type === 'snowy') {\r\n                for (let i=0; i<120; i++) {\r\n                    promises.push(addResource('/weather/snow/xuehua_' + Utils.formatNum(i) + '.png', 'img', preloadType));\r\n                }\r\n            }\r\n            else if (type === 'rainy') {\r\n                for (let i=0; i<50; i++) {\r\n                    promises.push(addResource('/weather/rain/xiayu_' + Utils.formatNum(i) + '.png', 'img', preloadType));\r\n                }\r\n            }\r\n            else if (type === 'defoliation') {\r\n                for (let i=0; i<90; i++) {\r\n                    promises.push(addResource('/weather/mapleLeaves/fengye_' + Utils.formatNum(i) + '.png', 'img', preloadType));\r\n                }\r\n            }\r\n            else if (type === 'fallingPeach') {\r\n                for (let i=0; i<90; i++) {\r\n                    promises.push(addResource('/weather/beachBlossom/taohua_' + Utils.formatNum(i) + '.png', 'img', preloadType));\r\n                }\r\n            }\r\n            else if (type === 'fallingFlower') {\r\n                for (let i=0; i<90; i++) {\r\n                    promises.push(addResource('/weather/blossom/yinghua_' + Utils.formatNum(i) + '.png', 'img', preloadType));\r\n                }\r\n            }\r\n            else if (type === 'lightning') {\r\n                for (let i=0; i<50; i++) {\r\n                    promises.push(addResource('/weather/lightning/shandian_' + Utils.formatNum(i) + '.png', 'img', preloadType));\r\n                }\r\n            }\r\n            return Promise.resolve(promises);\r\n        };\r\n\r\n        const getInCmdInfo = (cmdInfo, cIndex, canDeepPreload, preloadType) => {\r\n            if (cIndex >= cmdInfo.commands.length) {\r\n                return Promise.resolve();\r\n            }\r\n\r\n            const getInCommand = (command, preloadType) => {\r\n                if ('addImage' === command.type) {\r\n                    const { index, url } = command.args[0];\r\n                    if (index === 1) {\r\n                        if ('inherit' === url) {\r\n                            this.addRefCount('img', lastUsedKeyMap.background, preloadType);\r\n                            return Promise.resolve();\r\n                        } else {\r\n                            lastUsedKeyMap.background = url;\r\n                        }\r\n                    }\r\n                    return addResource(url, 'img', preloadType);\r\n                } else if ('addImage' === command.type && 'inherit' !== command.args[0].url) {\r\n                    return addResource(command.args[0].url, 'img', preloadType);\r\n                } else if (('playMusic' === command.type || 'playSound' === command.type) && 'inherit' !== command.args[0].url) {\r\n                    let url = command.args[0].url;\r\n                    if ('playMusic' === command.type) {\r\n                        if (this.forceDecode.musics.length < this.MaxForceDecodeMusic) {\r\n                            this.forceDecode.musics.push(url);\r\n                        }\r\n                        lastUsedKeyMap.music = url;\r\n                    } else {\r\n                        lastUsedKeyMap.sounds[command.args[0].index] = url;\r\n                        (!this.forceDecode.sounds[command.args[0].index]) && (this.forceDecode.sounds[command.args[0].index] = url);\r\n                    }\r\n                    return addResource(url, 'audio', preloadType, preloadType);\r\n                } else if (('playMusic' === command.type || 'playSound' === command.type) && 'inherit' === command.args[0].url) {\r\n                    if ('playMusic' === command.type) {\r\n                        this.addRefCount('audio', lastUsedKeyMap.music, preloadType);\r\n                    } else {\r\n                        this.addRefCount('audio', lastUsedKeyMap.sounds[command.args[0].index], preloadType);\r\n                    }\r\n                    return Promise.resolve();\r\n                } else if ('showDialog' === command.type) {\r\n                    return addResource(command.args[0].avatar.url, 'img', preloadType);\r\n                } else if (canDeepPreload && ('options' === command.type || 'conditionOptions' === command.type)) {\r\n                    let promise = Promise.resolve();\r\n                    for (let option of command.args) {\r\n                        if (option.background) {\r\n                            if (option.background.normal) {\r\n                                promise = promise.then(() => addResource(option.background.normal.url, 'img', preloadType + 'Option'));\r\n                            }\r\n                            if (option.background.active) {\r\n                                promise = promise.then(() => addResource(option.background.active.url, 'img', preloadType + 'Option'));\r\n                            }\r\n                            if (option.background.disable) {\r\n                                promise = promise.then(() => addResource(option.background.disable.url, 'img', preloadType + 'Option'));\r\n                            }\r\n                        }\r\n                        if (option.sound && option.sound.url) {\r\n                            promise = promise.then(() => addResource(option.sound.url, 'audio', preloadType + 'Option'));\r\n                        }\r\n                    }\r\n                    return promise;\r\n                } else if ('weather' === command.type && '1' !== flashvars.offline) {\r\n                    return addWeatherResource(command.args[0], preloadType);\r\n                }\r\n                return Promise.resolve();\r\n            };\r\n\r\n            const preloadOptions = options => {\r\n                let promise = Promise.resolve();\r\n                const { background, music, sounds } = this.lastUsedKeyMap;\r\n                for (let opIndex = 0; options && opIndex < options.length; opIndex++) {\r\n                    for (let opPlotIndex = 0; opPlotIndex < options[opIndex].commands.length && opPlotIndex < 10; opPlotIndex++) {\r\n                        promise = promise.then(() => {\r\n                            this.lastUsedKeyMap = { background, music, sounds: [...sounds] };\r\n                            return getInCommand(options[opIndex].commands[opPlotIndex], 'PreloadOption' + opPlotIndex).then(() => {\r\n                                if (isMaxSize(true)) {\r\n                                    return Promise.resolve();\r\n                                } else {\r\n                                    const {type, args} = options[opIndex].commands[opPlotIndex];\r\n                                    if (type === 'options' || type === 'conditionOptions') {\r\n                                        if (canDeepPreload) {\r\n                                            return preloadOptions(args);\r\n                                        } else {\r\n                                            return Promise.resolve();\r\n                                        }\r\n                                    }\r\n                                }\r\n                            });\r\n                        }).then(() => {\r\n                            this.lastUsedKeyMap = { background, music, sounds: [...sounds] };\r\n                            return Promise.resolve();\r\n                        });\r\n                    }\r\n                }\r\n                return promise;\r\n            };\r\n\r\n            const getInNextCommand = (cmdInfo, cIndex, canDeepPreload, preloadType) => {\r\n                if (cmdInfo.commands.length > cIndex) {\r\n                    return getInCmdInfo(cmdInfo, cIndex, canDeepPreload, preloadType);\r\n                } else if (cmdFrame) {\r\n                    if (cmdFrame.type === 'insert') {\r\n                        return Promise.resolve();\r\n                    } else if (cmdFrame.loopCondition) {\r\n                        if (!cmdInfo.parentInfo) {\r\n                            return Promise.resolve();\r\n                        }\r\n                        cIndex = cmdInfo.parentCmdIndex + 1;\r\n                        cmdInfo = cmdInfo.parentInfo;\r\n                        cmdFrame = null;\r\n                        return getInCmdInfo(cmdInfo, cIndex, false, preloadType);\r\n                    } else {\r\n                        cmdFrame = null;\r\n                        return getInCmdInfo(cmdInfo, 0, false, preloadType);\r\n                    }\r\n                }\r\n                return Promise.resolve();\r\n            };\r\n\r\n            return getInCommand(cmdInfo.commands[cIndex], preloadType).then(() => {\r\n                if (isMaxSize(true)) {\r\n                    return Promise.resolve();\r\n                } else {\r\n                    const { type, args }= cmdInfo.commands[cIndex];\r\n                    if (type === 'back' || type === 'jump' || type === 'insert') {\r\n                        return Promise.resolve();\r\n                    } else if (type === 'options' || type === 'conditionOptions') {\r\n                        if (canDeepPreload) {\r\n                            return preloadOptions(args).then(() => getInNextCommand(cmdInfo, cIndex + 1, false, preloadType));\r\n                        } else {\r\n                            return Promise.resolve();\r\n                        }\r\n                    } else {\r\n                        return getInNextCommand(cmdInfo, cIndex + 1, true, preloadType);\r\n                    }\r\n                }\r\n                return Promise.resolve();\r\n            });\r\n        };\r\n\r\n        const getPlotOptionCount = plot => {\r\n            let count = 0;\r\n            for (let opIndex = 0; plot.options && opIndex < plot.options.length; opIndex++) {\r\n                count += plot.options[opIndex].plots.length;\r\n            }\r\n\r\n            for (let opIndex = 0; plot.condition_options && opIndex < plot.condition_options.length; opIndex++) {\r\n                count += plot.condition_options[opIndex].plots.length;\r\n            }\r\n            return count;\r\n        };\r\n\r\n        const getInChapter = (chapter, pIndex,  canDeepPreload ,preloadType) => {\r\n            const promises = [];\r\n            const plot = chapter.plots[pIndex];\r\n\r\n            if (!plot || plot.commands && !plot.commands.length) {\r\n                return Promise.resolve();\r\n            }\r\n\r\n            if(plot.commands){\r\n                return getInCmdInfo(plot, 0, canDeepPreload, preloadType);\r\n            }\r\n\r\n            // sound\r\n            if (Object.prototype.toString.call(plot.plot_sound) == '[object Array]') {\r\n                for (let i in plot.plot_sound) {\r\n                    let item = plot.plot_sound[i];\r\n                    if (item && 'inherit' !== item.url) {\r\n                        promises.push(addResource(item.url, 'audio', preloadType));\r\n                        lastUsedKeyMap.sounds[i] = item.url;\r\n                        (!this.forceDecode.sounds[i]) && (this.forceDecode.sounds[i] = item.url);\r\n                    } else if (item && item.url === 'inherit') {\r\n                        this.addRefCount('audio', lastUsedKeyMap.sounds[i], preloadType);\r\n                    }\r\n                }\r\n            } else if (plot.plot_sound.url && 'inherit' !== plot.plot_sound.url) {\r\n                promises.push(addResource(plot.plot_sound.url, 'audio'));\r\n            }\r\n            // background\r\n            if (plot.background.url) {\r\n                if (plot.background.url !== 'inherit') {\r\n                    promises.push(addResource(plot.background.url, 'img', preloadType));\r\n                    lastUsedKeyMap.background = plot.background.url;\r\n                } else {\r\n                    this.addRefCount('img', lastUsedKeyMap.background, preloadType);\r\n                }\r\n            }\r\n            // characters\r\n            for (let character of plot.characters) {\r\n                if (character.url) {\r\n                    promises.push(addResource(character.url, 'img', preloadType));\r\n                }\r\n            }\r\n            // avatar\r\n            if (plot.avatar.url) {\r\n                promises.push(addResource(plot.avatar.url, 'img', preloadType));\r\n            }\r\n            // music\r\n            if (plot.music.url && plot.music.url !== 'inherit') {\r\n                if (this.forceDecode.musics.length < this.MaxForceDecodeMusic) {\r\n                    this.forceDecode.musics.push(plot.music.url);\r\n                }\r\n                promises.push(addResource(plot.music.url, 'audio', preloadType));\r\n                lastUsedKeyMap.music = plot.music.url;\r\n            } else if (plot.music.url === 'inherit') {\r\n                this.addRefCount('audio', lastUsedKeyMap.music, preloadType);\r\n            }\r\n            // props\r\n            for (let prop of plot.props) {\r\n                if (prop.url) {\r\n                    promises.push(addResource(prop.url, 'img', preloadType));\r\n                }\r\n            }\r\n            // options\r\n            for (let option of plot.options) {\r\n                if (option.background) {\r\n                    if (option.background.normal) {\r\n                        promises.push(addResource(option.background.normal.url, 'img', preloadType+'Option'));\r\n                    }\r\n                    if (option.background.active) {\r\n                        promises.push(addResource(option.background.active.url, 'img', preloadType+'Option'));\r\n                    }\r\n                    if (option.background.disable) {\r\n                        promises.push(addResource(option.background.disable.url, 'img', preloadType+'Option'));\r\n                    }\r\n                }\r\n                if (option.sound && option.sound.url) {\r\n                    addResource(option.sound.url, 'audio', preloadType+'Option');\r\n                }\r\n            }\r\n            // weather\r\n            if (plot.weather.value && '1' !== flashvars.offline) {\r\n                addWeatherResource(plot.weather.value, preloadType).then(rp => promises.push(...rp));\r\n            }\r\n\r\n            const preloadPlotOptions = () => {\r\n                let promise = Promise.resolve();\r\n                const { background, music, sounds } = this.lastUsedKeyMap;\r\n\r\n                for (let opIndex = 0; plot.options && opIndex < plot.options.length; opIndex++) {\r\n                    const optChapter = {plots: plot.options[opIndex].plots};\r\n                    for (let opPlotIndex = 0; opPlotIndex < plot.options[opIndex].plots.length && opPlotIndex < 2; opPlotIndex++) {\r\n                        promise = promise.then(() => {\r\n                            this.lastUsedKeyMap = { background, music, sounds: [...sounds] };\r\n                            return getInChapter(optChapter, opPlotIndex, false, 'PreloadOption' + opPlotIndex);\r\n                        }).then(() => {\r\n                            this.lastUsedKeyMap = { background, music, sounds: [...sounds] };\r\n                            return Promise.resolve();\r\n                        });\r\n                    }\r\n                }\r\n\r\n                for (let opIndex = 0; plot.condition_options && opIndex < plot.condition_options.length; opIndex++) {\r\n                    const optChapter = {plots: plot.condition_options[opIndex].plots};\r\n                    for (let opPlotIndex = 0; opPlotIndex < plot.condition_options[opIndex].plots.length && opPlotIndex < 3; opPlotIndex++) {\r\n                        promise = promise.then(() => {\r\n                            this.lastUsedKeyMap = { background, music, sounds: [...sounds] };\r\n                            return getInChapter(optChapter, opPlotIndex, false, 'PreloadConOption' + opPlotIndex);\r\n                        }).then(() => {\r\n                            this.lastUsedKeyMap = { background, music, sounds: [...sounds] };\r\n                            return Promise.resolve();\r\n                        });\r\n                    }\r\n                }\r\n\r\n                return promise;\r\n            };\r\n\r\n            const getInNextPlot = (chapter, pIndex, canDeepPreload, preloadType) => {\r\n                if (chapter.plots.length > pIndex) {\r\n                    return getInChapter(chapter, pIndex, canDeepPreload, preloadType);\r\n                } else if (frame) {\r\n                    if (frame.type === 'insert') {\r\n                        return Promise.resolve();\r\n                    } else if (frame.loopCondition) {\r\n                        if (!chapter.parent) {\r\n                            return Promise.resolve();\r\n                        }\r\n                        pIndex = frame.isCommand ? chapter.parent.pnPlot : chapter.parent.pnPlot + 1;\r\n                        chapter = chapter.parent.pChapter;\r\n                        frame = null;\r\n                        return getInChapter(chapter, pIndex, false, preloadType);\r\n                    } else {\r\n                        frame = null;\r\n                        return getInChapter(chapter, 0, false, preloadType);\r\n                    }\r\n                }\r\n                return Promise.resolve();\r\n            };\r\n\r\n            return Promise.all(promises).then(() => {\r\n                if (isMaxSize() || !canDeepPreload) {\r\n                    return Promise.resolve();\r\n                } else {\r\n                    if (getPlotOptionCount(plot)) {\r\n                        return preloadPlotOptions().then(() => getInNextPlot(chapter, pIndex + 1, false, preloadType));\r\n                    } else {\r\n                        return getInNextPlot(chapter, pIndex + 1, true, preloadType);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n\r\n        return cmdInfo\r\n            ? getInCmdInfo(cmdInfo, cIndex, true, 'play').then(() => resources)\r\n            : getInChapter(chapter, pIndex, true, 'play').then(() => resources);\r\n    }\r\n\r\n    static getResourcesSize(resources) {\r\n        const promises = [];\r\n        resources.forEach(r => {\r\n            promises.push(xhr.getResourceSize(r.key, r.type))\r\n        });\r\n        return Promise.all(promises).then(sizes => sizes.reduce((a,b) => a + b, 0));\r\n    }\r\n}\r\n\r\nResourcesManager.MaxSize = 200000000;\r\nResourcesManager.MaxCount = 64;\r\nResourcesManager.MaxForceDecodeMusic = 3;\r\nResourcesManager.refCount = { audio: {}, img: {} };\r\nResourcesManager.usingKeyMap = { background: '', sounds: new Array(10).fill(''), music: '' };\r\nResourcesManager.forceDecode = { musics: [], sounds: new Array(10).fill('') };\r\nResourcesManager.lastUsedKeyMap = { background: '', sounds: new Array(10).fill(''), music: '' };\r\n\r\n\r\nexport class AudioTagPool {\r\n    static get() {\r\n        let freeAudio = AudioTagPool.pool.find(a => a.free);\r\n        if (freeAudio) {\r\n            freeAudio.pause();\r\n            freeAudio.free = false;\r\n        } else {\r\n            freeAudio = document.createElement('audio');\r\n        }\r\n        return freeAudio;\r\n    }\r\n\r\n    static exist(audio){\r\n        return AudioTagPool.pool.some(a => a === audio);\r\n    }\r\n\r\n    static fill() {\r\n        const addAudio = len => {\r\n            for (let i = 0; i < len; i++) {\r\n                let audio = document.createElement('audio');\r\n                audio.free = true;\r\n                audio.loop = false;\r\n                audio.play();\r\n                AudioTagPool.pool.push(audio);\r\n            }\r\n        };\r\n        if (AudioTagPool.pool.length) {\r\n            const freeCount = AudioTagPool.pool.reduce((acc, cur) => acc + (cur && cur.free ? 1 : 0), 0);\r\n            if (freeCount < 10) {\r\n                addAudio(50);\r\n            }\r\n        } else {\r\n            addAudio(100);\r\n        }\r\n    }\r\n}\r\nAudioTagPool.pool = [];","/**\r\n * Created by chenwl on 3/25/16.\r\n */\r\nconst commit = \"80c1685c0d4ca56837a2de9bbcb24806b6c2ae79\";\r\nexport default commit;\r\n\r\nconst version = \"1.0.0\";\r\nexport {version};\r\n","const urls = {\r\n    getGame : \"https://mapi.3000api.com/apis/soft/v1.0/game-info.html\",\r\n    getTestGame: \"https://mapi.3000api.com/apis/soft/v1.0/game-test.html\",\r\n    materialRedirect:\"https://mapi.3000api.com/client/material-redirect.html\"\r\n};\r\n\r\nfunction serializeQuery(params) {\r\n    params['_'] = Date.now();\r\n    return '?' + Object.keys(params).map(key => {\r\n            const val = params[key];\r\n            if (val) {\r\n                return encodeURIComponent(key) + '=' + encodeURIComponent(val)\r\n            }\r\n            else {\r\n                return '';\r\n            }\r\n        }).join('&');\r\n}\r\n\r\nexport function xhrGetServerTime(url) {\r\n    return new Promise((resolve, reject) => {\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", url, true);\r\n\r\n        xhr.onload = function () {\r\n            try {\r\n                if (xhr.readyState === 4 && xhr.status >= 400 && xhr.status <= 599) { // Handle HTTP status codes of 4xx and 5xx as errors, even if xhr.onerror was not called.\r\n                    return reject(`error readyState: ${xhr.readyState}, status: ${xhr.status}`);\r\n                }\r\n                else {\r\n                    return resolve(xhr);\r\n                }\r\n            } catch (e) {\r\n                reject(e)\r\n            }\r\n        };\r\n\r\n        xhr.onerror = reject;\r\n        xhr.send();\r\n    })\r\n}\r\n\r\nexport function xhrSend(url, data, onProgress, timeout) {\r\n    return new Promise((resolve, reject) => {\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.ontimeout = function () {\r\n            console.log(url + ' time out');\r\n        };\r\n        xhr.onreadystatechange = function() {\r\n            switch(xhr.readyState) {\r\n                case 4 :\r\n                    if((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {\r\n                        return resolve(xhr);\r\n                    }\r\n                    else {\r\n                        return reject(`error readyState: ${xhr.readyState}, status: ${xhr.status}`);\r\n                    }\r\n                    break;\r\n            }\r\n        };\r\n        xhr.open(\"post\", url, true);\r\n        xhr.withCredentials = true;\r\n        timeout && (xhr.timeout = timeout);\r\n        onProgress && xhr.addEventListener(\"progress\", onProgress, false);\r\n        xhr.setRequestHeader(\"CONTENT-TYPE\", \"application/x-www-form-urlencoded\");\r\n        xhr.send(data);\r\n        xhr.onerror = reject;\r\n    });\r\n}\r\n\r\nexport function xhrLoad(url, type, onProgress) {\r\n    return new Promise((resolve, reject) => {\r\n\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", url, true);\r\n        xhr.responseType = type;\r\n\r\n        xhr.onload = function () {\r\n            try {\r\n                if (xhr.readyState === 4 && xhr.status >= 400 && xhr.status <= 599) { // Handle HTTP status codes of 4xx and 5xx as errors, even if xhr.onerror was not called.\r\n                    return reject(`error readyState: ${xhr.readyState}, status: ${xhr.status}`);\r\n                }\r\n                else {\r\n                    return resolve(xhr);\r\n                }\r\n            } catch (e) {\r\n                reject(e)\r\n            }\r\n        };\r\n\r\n        onProgress && xhr.addEventListener(\"progress\", onProgress, false);\r\n\r\n        xhr.onerror = reject;\r\n\r\n        xhr.send();\r\n    });\r\n}\r\n\r\nexport function getJson(url, onProgress) {\r\n    return xhrLoad(url, '', onProgress).then(xhr => {\r\n        return JSON.parse(xhr.response);\r\n    });\r\n}\r\n\r\nexport function getMaterialRedirect(url) {\r\n    return getJson(urls.materialRedirect + serializeQuery({url}))\r\n        .then(json => {\r\n            if (json.code == '100') {\r\n                return json.result;\r\n            }\r\n            else {\r\n                return Promise.reject(json.message);\r\n            }\r\n        });\r\n}\r\n\r\nexport function getGame(uuid, onProgress) {\r\n    const url = urls.getGame + '?uuid=' + uuid;\r\n    return getJson(url, onProgress)\r\n        .then(json => {\r\n            if (json.code == '100') {\r\n                return json.result;\r\n            }\r\n            else if (flashvars.offline === '1') {\r\n                return json;\r\n            }\r\n            else {\r\n                return Promise.reject(json.message);\r\n            }\r\n        });\r\n}\r\n\r\nexport function getTestGame(uuid, onProgress) {\r\n    const url = /*'https://www.3000.com/proxy/liuhualin/json.txt';/**/urls.getTestGame + '?uuid=' + uuid;\r\n    return getJson(url, onProgress)\r\n        .then(json => {\r\n            if (json.code == '100') {\r\n                return json.result;\r\n            }\r\n            else if (flashvars.offline === '1') {\r\n                return json;\r\n            }\r\n            else {\r\n                return Promise.reject(json.message);\r\n            }\r\n        });\r\n}\r\n\r\nexport function getResourceSize(url, type) {\r\n    if (type === 'img') {\r\n        return Promise.resolve(200000)\r\n    } else if (type === 'audio') {\r\n        return Promise.resolve(2000000)\r\n    }\r\n}","/**\r\n * @class demo.controller.PrepareControllerCommand.js\r\n */\r\nimport puremvc from 'puremvc';\r\npuremvc.define\r\n(\r\n\t// CLASS INFO\r\n\t{\r\n\t\tname: 'diygamePlayer.controller.command.PrepareControllerCommand',\r\n\t\tparent: puremvc.SimpleCommand\r\n\t},\r\n\t\r\n\t// INSTANCE MEMBERS\t\r\n\t{\r\n\t\t/** @override */\r\n\t\texecute: function (note)\r\n\t\t{\r\n\t\t\t// register teh ProcessTextCommand to handle the PROCESS_TEXT notification \r\n\t\t\t//this.facade.registerCommand( demo.AppConstants.PROCESS_TEXT, diygamePlayer.controller.command.ProcessTextCommand );\r\n\t\t}\r\n\t}\t\r\n);\r\n","/**\r\n * @class demo.controller.PrepareModelCommand.js\r\n */\r\nimport puremvc from 'puremvc';\r\npuremvc.define\r\n(\r\n\t// CLASS INFO\r\n\t{\r\n\t\tname: 'diygamePlayer.controller.command.PrepareModelCommand',\r\n\t\tparent: puremvc.SimpleCommand\r\n\t},\r\n\t\r\n\t// INSTANCE MEMBERS\r\n\t{\r\n\t\t/** @override */\r\n\t\texecute: function (note)\r\n\t\t{\r\n\t\t\t// register the TextProxy \r\n\t\t\tthis.facade.registerProxy( new diygamePlayer.model.proxy.SceneProxy );\r\n\t\t}\r\n\t}\r\n)","/**\r\n * @class demo.controller.PrepareW3CViewCommand\r\n * @extends puremvc.SimpleCommand\r\n */\r\nimport puremvc from 'puremvc';\r\npuremvc.define\r\n(\r\n\t// CLASS INFO\r\n\t{\r\n\t\tname: 'diygamePlayer.controller.command.PrepareViewCommand',\r\n\t\tparent: puremvc.SimpleCommand\r\n\t},\r\n\t\r\n\t// INSTANCE TRAITS\r\n\t{\r\n\t\t/** @override */\r\n\t\texecute: function (note)\r\n\t\t{\r\n\t\t\t// register the TextComponentMediator\r\n\t\t\tthis.facade.registerMediator( new diygamePlayer.view.mediator.SceneMediator );\r\n\t\t}\r\n\t}\r\n);\t\t\t\t","/**\r\n * @class demo.controller.StartupCommand\r\n * @extends puremvc.MacroCommand\r\n */\r\nimport puremvc from 'puremvc';\r\npuremvc.define\r\n(\r\n\t// CLASS INFO\r\n\t{\r\n\t\tname: 'diygamePlayer.controller.command.StartupCommand',\r\n\t\tparent: puremvc.MacroCommand\r\n\t},\r\n\r\n\t// INSTANCE MEMBERS\t\r\n\t{\r\n\t\t/** @override */\r\n\t\tinitializeMacroCommand: function ()\r\n\t\t{\r\n\t\t\t// add the PrepareControllerCommand- it will register Commands with the Facade\r\n\t\t\tthis.addSubCommand( diygamePlayer.controller.command.PrepareControllerCommand );\r\n\r\n\t\t\t// add the PrepareModelCommand- it will register Proxys with the Facade\r\n\t\t\tthis.addSubCommand( diygamePlayer.controller.command.PrepareModelCommand );\r\n\r\n\t\t\t// add the SetupViewsCommand- it will register Mediators with the Facade\r\n\t\t\tthis.addSubCommand( diygamePlayer.controller.command.PrepareViewCommand );\r\n\t\t}\r\n\t}\r\n)","/**\r\n *\r\n * This is a simple state template to use for getting a Phaser game up\r\n * and running quickly. Simply add your own game logic to the default\r\n * state object or delete it and make your own.\r\n *\r\n */\r\n\r\n// initialize the app when all DOM content has loaded.\r\nimport 'babel-polyfill';\r\nimport './AppConstants.js';\r\nimport './ApplicationFacade.js';\r\nimport './controller/command/PrepareControllerCommand.js';\r\nimport './controller/command/PrepareModelCommand.js';\r\nimport './controller/command/PrepareViewCommand.js';\r\nimport './controller/command/StartupCommand.js';\r\nimport './model/proxy/SceneProxy.js';\r\nimport './view/component/Scene.js';\r\nimport './view/mediator/SceneMediator.js';\r\ndocument.addEventListener('DOMContentLoaded', function () {\r\n\r\n    // initialize the facade by retrieving an instance and calling startup\r\n    diygamePlayer.ApplicationFacade.getInstance(diygamePlayer.ApplicationFacade.NAME).startup();\r\n    console.log(\"Initialized\");\r\n});","/**\r\n * @class demo.model.TextProxy\r\n * @extends puremvc.Proxy\r\n */\r\nimport puremvc from 'puremvc';\r\nimport Utils, {ResourcesManager} from '../../common/Utils.js';\r\nimport MD5 from 'spark-md5';\r\nimport Dialog from './../../common/Dialog.js';\r\nimport ShanyiMenu from './../../common/ShanyiMenu.js'\r\nimport * as Xhr from './../../common/XmlHttpRequest.js';\r\nimport PhoneUtils from '../../common/PhoneUtils.js';\r\nimport FontUtils from '../../common/FontUtils.js';\r\n\r\npuremvc.define\r\n(\r\n\t// CLASS INFO\r\n\t{\r\n\t\tname: 'diygamePlayer.model.proxy.SceneProxy',\r\n\t\tparent: puremvc.Proxy\r\n\t},\r\n\r\n\t// INSTANCE MEMBERS\r\n\t{\r\n        chargeMsgReceive: function(ev) {\r\n        \tif (ev.originalEvent.key !== 'msgCharged') return; // ignore other keys\r\n            let message = JSON.parse(ev.originalEvent.newValue);\r\n            if (!message) return; // ignore empty msg or msg reset\r\n\r\n            // here you act on messages.\r\n            // you can send objects like { 'command': 'doit', 'data': 'abcd' }\r\n            if (message.command == 'doit') alert(message.data);\r\n        },\r\n        resumeAudio: function () {\r\n\t\t\tthis.bk_music && this.bk_music.play();\r\n            this.plotSounds && this.plotSounds.forEach(s => s && s.resume());\r\n        },\r\n\t\tpauseAudio: function () {\r\n            this.bk_music && this.bk_music.pause();\r\n            this.plotSounds && this.plotSounds.forEach(s => s && s.pause());\r\n        },\r\n\r\n        /**\r\n\t\t * Set the TextProxy's text.\r\n\t\t *\r\n\t\t * Sends a TextProxy.TEXT_CHANGED notification.\r\n\t\t *\r\n\t\t * @param {string} text\r\n\t\t * @return {void}\r\n\t\t */\r\n\t\tpreloadingBegin: function () {\r\n\t\t\tthis.stringMap = {};\r\n\t\t\tthis.stringMap.loadMenu = \"读档\";\r\n\t\t\tthis.stringMap.overMenu = \"结束\";\r\n\t\t\tthis.stringMap.settingsMenu = \"设置\";\r\n\t\t\tthis.stringMap.startMenu = \"开始\";\r\n\t\t\tthis.stringMap.menu = \"菜单\";\r\n\t\t\tthis.stringMap.mainMenu = \"菜单\";\r\n\t\t\tthis.stringMap.save = \"保存进度\";\r\n\t\t\tthis.stringMap.load = \"读取进度\";\r\n\t\t\tthis.stringMap.playback = \"剧情回放\";\r\n\t\t\tthis.stringMap.autoplay = \"自动播放\";\r\n\t\t\tthis.stringMap.manualPlay = \"手动播放\";\r\n\t\t\tthis.stringMap.settings = \"设置\";\r\n\t\t\tthis.stringMap.displayHeader = \"显示设定\";\r\n\t\t\tthis.stringMap.displayCaption = \"画面模式\";\r\n\t\t\tthis.stringMap.textHeader = \"文字设定\";\r\n\t\t\tthis.stringMap.textCaption = \"自动进行\";\r\n\t\t\tthis.stringMap.autoOn = \"开\";\r\n\t\t\tthis.stringMap.autoOff = \"关\";\r\n\t\t\tthis.stringMap.windowMode = \"窗口模式\";\r\n\t\t\tthis.stringMap.fullMode = \"全屏模式\";\r\n\t\t\tthis.stringMap.back = \"返回\";\r\n\t\t\tthis.progressTips = ['手指右滑就可召唤退出按钮，退出作品时，记得存档哦'\r\n\t\t\t\t, '收藏作品，更新会第一时间通知你'\r\n            \t, '把作品下载到本地，随时随地任性玩'\r\n            \t, '感觉作品很棒，和你的好友分享吧~'\r\n                , '引战、刷屏、作品无关的评论会被删除哦'\r\n\t\t\t\t, '素材库为全站通用，可能发生人物走错片场的情况，请不要慌张'\r\n            \t, '在当前作品的评论中对比其他作品容易给作者大大招黑哦~'\r\n                , '制作辛苦，写下精彩长评支持喜欢的作者吧'\r\n\t\t\t\t, '长按屏幕可以快进剧情'];\r\n\t\t\tthis.recordTipCount = 0;\r\n\t\t\tthis.isShowGuide = true;\r\n\t\t\tthis.plotSounds = [];\r\n\t\t\tthis.playbackData = [];\r\n\t\t\tthis.plotViews = [];\r\n\t\t\tthis.prgsViews = [];\r\n            this.plotViewKeys = [];\r\n\t\t\tthis.bViewLoaded = false;\r\n            this.bSignedIn = false;\r\n            this.bCloudSel = false;\r\n\t\t\tthis.visibleLayout = [];\r\n\t\t\tthis.resourceManager = {plotIndex: 0, resourceList: [], baseList: []};\r\n\t\t\tthis.lstDialogInfo = [];\r\n\t\t\tthis.menuInfo = [];\r\n\t\t\tthis.quickPlay = false;\r\n\t\t\tthis.isScreenHold = false;\r\n\t\t\tthis.bCmdAutoText = false;\r\n\t\t\tthis.isGameStarted = false;\r\n\t\t\tthis.usedStarCount = 0;\r\n\t\t\tthis.gameStarLimit = 0;\r\n\t\t\tthis.lstPlotTweens = [];\r\n\t\t\tthis.twinkleTimer = null;\r\n\t\t\tthis.uiOnLoadQueue = [];\r\n\t\t\tthis.timerCounts = [];\r\n\t\t\tthis.menuTimer = [];\r\n\t\t\tthis.recUidBelongTo = flashvars.uid;\r\n\t\t\tthis.gameUidBelongTo = flashvars.uid;\r\n\t\t\tthis.bSwitchAccInPlot = true;\r\n\t\t\tthis.payValueUid = flashvars.uid;\r\n\t\t\tthis.unlockChapterCallBack = null;\r\n\t\t\tthis.mallPayCallback = null;\r\n\t\t\tthis.isGettingNext = true;\r\n\r\n\t\t\taudioMgr.pause = this.pauseAudio.bind(this);\r\n\t\t\taudioMgr.resume = this.resumeAudio.bind(this);\r\n\t\t\taudioMgr.audioCanPlayCallBack = PhoneUtils.audioCanPlayCallBack.bind(PhoneUtils);\r\n            gameCallback.updateAccInfo = this.updateAccInfo.bind(this);\r\n            gameCallback.unlockChapterFinished = this.unlockChapterFinished.bind(this);\r\n            gameCallback.mallPay = this.mallPay.bind(this);\r\n\r\n\t\t\t//Utils.getTimeOffset();\r\n\t\t\t//Utils.sendSelOptions();\r\n\t\t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_PRELOADING_BEGIN);\r\n\t\t},\r\n\r\n\t\tunlockChapterFinished: function (result, stayIfFail) {\r\n            this.unlockChapterCallBack && this.unlockChapterCallBack(result, stayIfFail);\r\n        },\r\n\r\n        mallPay: function (result) {\r\n\t\t\tthis.mallPayCallback && this.mallPayCallback(result);\r\n\t\t\tthis.mallPayCallback = null;\r\n        },\r\n\r\n\t\tcheckIfMallPaySuccess: function (indentId) {\r\n            const getData = (url, d) => {\r\n                return Xhr.xhrSend(url, d).then(rs => {\r\n                    if (rs.responseText.length === 0) {\r\n                        return Promise.resolve(false);\r\n                    }\r\n                    let retData = JSON.parse(rs.responseText);\r\n                    if (retData.status === 0) {\r\n                        return Promise.resolve(retData.data.serial_num === indentId && retData.data.c_status == '1');\r\n                    }\r\n                    else if (retData.status === 100) {// 不存在此订单的流水号\r\n                    \treturn Promise.resolve(false);\r\n\t\t\t\t\t}\r\n                    else { // status>0 && status<9 账号被踢出\r\n                        return Promise.resolve(false);\r\n                    }\r\n                }, rj => {\r\n                    return Promise.resolve(false); // 请求遭拒  如跨域问题\r\n                });\r\n            };\r\n\r\n            let url = 'https://app.3000.com/?m=consume&op=index&ac=market_order_status&client=' + flashvars.client + '&v=' + flashvars.v +'&app_version=' + flashvars.app_version;\r\n            let data = 'u=' + encodeURIComponent(Utils.aesEncrypt(flashvars.u, 1))\r\n\t\t\t\t+ '&token=' + encodeURIComponent(Utils.aesEncrypt(flashvars.token, 1))\r\n\t\t\t\t+ '&serial_num=' + encodeURIComponent(Utils.aesEncrypt(indentId, 1));\r\n\r\n            return getData(url, data);\r\n        },\r\n\r\n\t\taddAssets: function (url, type, key, isPlot) {\r\n\t\t\tconst sKey = key || url;\r\n\t\t\tif (('img' === type && this.viewComponent.game.load.cache.checkImageKey(sKey)\r\n\t\t\t\t|| 'audio' === type && this.viewComponent.game.load.cache.checkSoundKey(sKey))\r\n\t\t\t\t&& !('ios' === flashvars.client && 'audio' === type && flashvars.app_version >= '1.5.0')) {\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t}\r\n\t\t\treturn Utils.convertToAllowAccessControlOriginUrl(url).then(url => {\r\n\t\t\t\tif (!url) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif ('img' === type) {\r\n\t\t\t\t\tthis.viewComponent.game.load.image(sKey, url);\r\n\t\t\t\t\t!isPlot && ResourcesManager.addRefCount(\"img\", sKey, 'global');\r\n\t\t\t\t}\r\n\t\t\t\telse if ('audio' === type) {\r\n\t\t\t\t\tlet bAutoDecode = ResourcesManager.forceDecode.music === sKey || ResourcesManager.forceDecode.sounds.some(k => k === sKey);\r\n\t\t\t\t\tif ('ios' === flashvars.client && flashvars.app_version >= '1.5.0') {\r\n                        PhoneUtils.loadAudioUrl(sKey, url, flashvars.offline);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.viewComponent.game.load.audio(sKey, url, bAutoDecode);\r\n                    }\r\n                    if ('android' === flashvars.client) {\r\n                        !isPlot && ResourcesManager.addRefCount(\"audio\", sKey, 'global');\r\n\t\t\t\t\t} else {\r\n                        !isPlot && ResourcesManager.addRefCount(\"audio\", sKey, 'global');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}, e => console.error(\"Invalid URL: \" + e))\r\n\t\t},\r\n\r\n\t\taddImage: function (key, url, image) {\r\n\t\t\tthis.viewComponent.game.cache.addImage(key, url || null, image);\r\n\t\t},\r\n\r\n\t\taddImageUrl: function (url, md5) {\r\n\t\t\treturn new Promise((resolve,  reject) => {\r\n\t\t\t\tconst data = new Image();\r\n\t\t\t\tdata.src = url;\r\n\t\t\t\tdata.onload = e => {\r\n\t\t\t\t\tif (!this.viewComponent.game.load.cache.checkImageKey(md5)) {\r\n\t\t\t\t\t\tthis.viewComponent.game.cache.addImage(md5, url, e.target);\r\n\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tdata.onerror = data.onabort = e => reject(e);\r\n\t\t\t})\r\n\t\t},\r\n\r\n\t\t// 解析Json Template\r\n\t\tparseJsonFile: function (game) {\r\n\t\t\tthis.json_data = game;//JSON.parse(JSON.stringify(game));\r\n\t\t\t// load template\r\n\t\t\tconst promises = [];\r\n\t\t\tif (this.json_data.template && this.json_data.template.json) {\r\n\t\t\t\tpromises.push(this.parseTemplateCoverAssets());\r\n\t\t\t\tpromises.push(this.parseTemplateDialogAssets());\r\n\t\t\t\tpromises.push(this.parseTemplateMenuAssets());\r\n\t\t\t\tpromises.push(this.parseTemplateSyMenuAssets());\r\n\t\t\t\tpromises.push(this.parseTemplateMainMenuAssets());\r\n\t\t\t\tpromises.push(this.parseTemplateSettingsAssets());\r\n\t\t\t\tpromises.push(this.parseTemplateOptionAssets());\r\n\t\t\t\tpromises.push(this.parseTemplatePlaybackAssets());\r\n\t\t\t\tpromises.push(this.parseTemplateRecordAssets());\r\n\t\t\t\tpromises.push(this.parseTemplateSoundAssets());\r\n\t\t\t}\r\n\t\t\treturn Promise.all(promises).then(() => {\r\n\t\t\t\tif (false && this.json_data.font) {\r\n                    return FontUtils.mergeFontImage(this.json_data.font, this.json_data.default_settings.font_size);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t}).then(() => {\r\n\t\t\t\t//this.json_data = Utils.fixGame(this.json_data);\r\n\t\t\t\tpromises.length = 0;\r\n\r\n\t\t\t\t// font image\r\n                FontUtils.fontImage && this.viewComponent.game.load.image(FontUtils.fontFamily, FontUtils.fontImage);\r\n\r\n                // load logo\r\n\t\t\t\tif (this.json_data.logo && this.json_data.logo.background && this.json_data.logo.background.url) {\r\n\t\t\t\t\tpromises.push(this.addAssets(this.json_data.logo.background.url, 'img'));\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// load cover\r\n\t\t\t\tif (this.json_data.cover.background && this.json_data.cover.background.url) {\r\n\t\t\t\t\tpromises.push(this.addAssets(this.json_data.cover.background.url, 'img'));\r\n\t\t\t\t}\r\n\t\t\t\tif (this.json_data.cover.music && this.json_data.cover.music.url) {\r\n                    let url = this.json_data.cover.music.url;\r\n\t\t\t\t\tpromises.push(this.addAssets(url, 'audio'));\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// load views\r\n\t\t\t\tconst addEventAssets = (events) => {\r\n\t\t\t\t\tif (Object.prototype.toString.call(events) == '[object Array]') {\r\n\t\t\t\t\t\tevents.forEach(e => {\r\n\t\t\t\t\t\t\te.events.forEach(subEvent => {\r\n\t\t\t\t\t\t\t\tif (subEvent.type === 'playMusic' && subEvent.handle.music.url) {\r\n\t\t\t\t\t\t\t\t\tpromises.push(this.addAssets(subEvent.handle.music.url, 'audio'));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse if (subEvent.type === 'playSound') {\r\n\t\t\t\t\t\t\t\t\tsubEvent.handle.sounds.forEach(sound => {sound && sound.url != 'inherit' && promises.push(this.addAssets(sound.url, 'audio'));});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tfor (let p in this.json_data.viewMap) {\r\n                    if (this.json_data.viewMap[p].type === 'timer') {\r\n                        addEventAssets(this.json_data.viewMap[p].events);\r\n                        continue;\r\n                    }\r\n                    const background = this.json_data.viewMap[p].content.background;\r\n\t\t\t\t\tconst sound = this.json_data.viewMap[p].content.sound;\r\n\t\t\t\t\tif (!background) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (background.url) {\r\n\t\t\t\t\t\tpromises.push(this.addAssets(background.url, 'img'));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (background.normal && background.normal.url) {\r\n\t\t\t\t\t\tpromises.push(this.addAssets(background.normal.url, 'img'));\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (background.active && background.active.url) {\r\n\t\t\t\t\t\tpromises.push(this.addAssets(background.active.url, 'img'));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (background.progress && background.progress.url) {\r\n\t\t\t\t\t\tpromises.push(this.addAssets(background.progress.url, 'img'));\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (sound && sound.url) {\r\n\t\t\t\t\t\tpromises.push(this.addAssets(sound.url, 'audio'));\r\n\t\t\t\t\t}\r\n\t\t\t\t\taddEventAssets(this.json_data.viewMap[p].events);\r\n\t\t\t\t\tthis.json_data.viewMap[p].children.forEach(child => {addEventAssets(child.events)});\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.all(promises).then(() => {\r\n                    return Promise.resolve();\r\n                    //this.sendNotification( diygamePlayer.AppConstants.SCENE_PRELOADING_PROGRESS); // 移至获取闪币数方法中\r\n\t\t\t\t}, e => Promise.reject(e))\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tparseTemplateCoverAssets:function () {\r\n\t\t\tconst promises = [];\r\n\t\t\tconst {titleContainer, startMenu, loadMenu, settingsMenu, overMenu} = this.json_data.template.json.cover;\r\n\r\n\t\t\tif (titleContainer.background.url && titleContainer.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(titleContainer.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (startMenu.normal.background.url && startMenu.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(startMenu.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (startMenu.active.background.url && startMenu.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(startMenu.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (loadMenu.normal.background.url && loadMenu.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(loadMenu.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (loadMenu.active.background.url && loadMenu.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(loadMenu.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (settingsMenu.normal.background.url && settingsMenu.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(settingsMenu.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (settingsMenu.active.background.url && settingsMenu.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(settingsMenu.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (overMenu.normal.background.url && overMenu.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(overMenu.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (overMenu.active.background.url && overMenu.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(overMenu.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\treturn Promise.all(promises)\r\n\t\t},\r\n\r\n\t\tparseTemplateDialogAssets:function () {\r\n\t\t\tconst promises = [];\r\n\t\t\tconst {background, avatarContainer, titleContainer} = this.json_data.template.json.dialog;\r\n\r\n\t\t\tif (background && background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (avatarContainer.background.url && avatarContainer.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(avatarContainer.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (titleContainer.background.url && titleContainer.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(titleContainer.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\treturn Promise.all(promises)\r\n\t\t},\r\n\r\n\t\tparseTemplateMenuAssets:function () {\r\n\t\t\tconst promises = [];\r\n\t\t\tconst {normal, active} = this.json_data.template.json.menu;\r\n\t\t\tif (normal.background && normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (active.background && active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\treturn Promise.all(promises);\r\n\t\t},\r\n\r\n\t\tparseTemplateSyMenuAssets: function () {\r\n\t\t\tif (!this.json_data.template.json.shanyiMenu) return;\r\n\r\n            const promises = [];\r\n            const {normal, active} = this.json_data.template.json.shanyiMenu;\r\n            if (normal.background && normal.background.url) {\r\n                promises.push(this.addAssets(normal.background.url, 'img'));\r\n            }\r\n            if (active.background && active.background.url) {\r\n                promises.push(this.addAssets(active.background.url, 'img'));\r\n            }\r\n            return Promise.all(promises);\r\n        },\r\n\r\n\t\tparseTemplateMainMenuAssets:function () {\r\n\t\t\tconst promises = [];\r\n\t\t\tconst {background, header, save, load, playback, autoplay, settings, back} = this.json_data.template.json.mainMenu;\r\n\r\n\t\t\tif (background.url && background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (header.background && header.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(header.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (save.normal.background && save.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(save.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (save.active.background && save.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(save.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (load.normal.background && load.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(load.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (load.active.background && load.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(load.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (playback.normal.background && playback.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(playback.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (playback.active.background && playback.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(playback.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (autoplay.normal.background && autoplay.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(autoplay.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (autoplay.active.background && autoplay.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(autoplay.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (settings.normal.background && settings.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(settings.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (settings.active.background && settings.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(settings.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (back.normal.background && back.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(back.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (back.active.background && back.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(back.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\treturn Promise.all(promises);\r\n\t\t},\r\n\r\n\t\tparseTemplateSettingsAssets:function () {\r\n\t\t\tconst promises = [];\r\n\t\t\tconst {background, header, displayHeader, textHeader, displayCaption, textCaption, fullMode, windowMode, autoOn, autoOff, back} = this.json_data.template.json.settings;\r\n\t\t\tif (background && background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (header.background && header.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(header.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (displayHeader.background && displayHeader.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(displayHeader.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (textHeader.background && textHeader.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(textHeader.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (displayCaption.background && displayCaption.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(displayCaption.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (textCaption.background.url && textCaption.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(textCaption.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (fullMode.unchecked.background && fullMode.unchecked.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(fullMode.unchecked.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (fullMode.checked.background && fullMode.checked.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(fullMode.checked.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (windowMode.unchecked.background && windowMode.unchecked.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(windowMode.unchecked.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (windowMode.checked.background && windowMode.checked.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(windowMode.checked.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (autoOn.unchecked.background && autoOn.unchecked.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(autoOn.unchecked.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (autoOn.checked.background && autoOn.checked.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(autoOn.checked.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (autoOff.unchecked.background && autoOff.unchecked.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(autoOff.unchecked.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (autoOff.checked.background && autoOff.checked.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(autoOff.checked.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (back.normal.background && back.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(back.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (back.active.background && back.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(back.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\treturn Promise.all(promises);\r\n\t\t},\r\n\r\n\t\tparseTemplateOptionAssets:function () {\r\n\t\t\tconst promises = [];\r\n\t\t\tconst {normal, active} = this.json_data.template.json.option;\r\n\t\t\tif (normal.background && normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (active.background && active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\treturn Promise.all(promises);\r\n\t\t},\r\n\r\n\t\tparseTemplatePlaybackAssets:function () {\r\n\t\t\tconst promises = [];\r\n\t\t\tconst {background, scrollBox, back} = this.json_data.template.json.playback;\r\n\t\t\tif (background && background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (scrollBox.background && scrollBox.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(scrollBox.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (scrollBox.item.background && scrollBox.item.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(scrollBox.item.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (scrollBox.item.content.background && scrollBox.item.content.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(scrollBox.item.content.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (back.normal.background && back.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(back.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (back.active.background.url && back.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(back.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\treturn Promise.all(promises);\r\n\t\t},\r\n\r\n\t\tparseTemplateRecordAssets:function () {\r\n\t\t\tconst promises = [];\r\n\t\t\tconst {background, scrollBox, back} = this.json_data.template.json.record;\r\n\r\n\t\t\tif (background && background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (scrollBox.background && scrollBox.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(scrollBox.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (scrollBox.item.background && scrollBox.item.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(scrollBox.item.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (scrollBox.item.content.background && scrollBox.item.content.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(scrollBox.item.content.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (back.normal.background && back.normal.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(back.normal.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\tif (back.active.background.url && back.active.background.url) {\r\n\t\t\t\tpromises.push(this.addAssets(back.active.background.url, 'img'));\r\n\t\t\t}\r\n\t\t\treturn Promise.all(promises);\r\n\t\t},\r\n\r\n\t\tparseTemplateSoundAssets:function () {\r\n\t\t\tconst promises = [];\r\n\t\t\tif (this.json_data.template.json.sound && this.json_data.template.json.sound.url) {\r\n\t\t\t\tpromises.push(this.addAssets(this.json_data.template.json.sound.url, 'audio'));\r\n\t\t\t}\r\n\t\t\treturn Promise.all(promises);\r\n\t\t},\r\n\r\n\t\tshowLogo: function ()\t{\r\n\t\t\tthis.sendNotification( diygamePlayer.AppConstants.SCENE_SHOW_LOGO);\r\n\t\t},\r\n\t\tshowCover: function () {\r\n\t\t\tconst { music } = this.json_data.cover;\r\n\t\t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_GOTO_COVERMENU);\r\n\t\t},\r\n\t\tshowMainMenu: function (context) {\r\n\t\t\tthis.onPause();\r\n\t\t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_GOTO_MAINMENU, context);\r\n\t\t},\r\n\t\tshowSettings: function (context, callbackInfo) {\r\n            this.onPause();\r\n\t\t\tif (this.mainMenuLayer.visible) {\r\n\t\t\t\tthis.mainMenuLayer.visible = false;\r\n\t\t\t\tthis.visibleLayout = [this.mainMenuLayer, ...this.visibleLayout];\r\n\t\t\t}\r\n\t\t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_GOTO_SETTINGS, {context:context, callbackInfo: callbackInfo});\r\n\t\t},\r\n\t\tshowPlayback: function (callbackInfo) {\r\n            this.onPause();\r\n\t\t\tif (this.mainMenuLayer.visible) {\r\n\t\t\t\tthis.mainMenuLayer.visible = false;\r\n\t\t\t\tthis.visibleLayout = [this.mainMenuLayer, ...this.visibleLayout];\r\n\t\t\t}\r\n\t\t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_GOTO_PLAYBACK, callbackInfo);\r\n\t\t},\r\n\r\n\t\tshowSave: function (bLocalCloudSwitch, callbackInfo) {\r\n\t\t\t// 隐藏菜单层\r\n\t\t\tthis.menuLayer.visible = false;\r\n            this.bToSaveFile = true;\r\n            this.loadData(bLocalCloudSwitch);\r\n            this.showRecord(callbackInfo);\r\n\r\n\t\t},\r\n\r\n\t\tshowLoad: function (bLocalCloudSwitch, callbackInfo) {\r\n            // 隐藏菜单层\r\n            this.menuLayer.visible = false;\r\n            if (flashvars.u==='' && flashvars.token==='' && flashvars.client==='') {\r\n                flashvars.uid = Utils.getUidByCookie();\r\n            }\r\n            this.getPayInfo().then(() => {\r\n                this.bToSaveFile = false;\r\n                this.loadData(bLocalCloudSwitch);\r\n                this.showRecord(callbackInfo);\r\n            })\r\n\t\t},\r\n\r\n\t\tshowRecord: function (callbackInfo) {\r\n            this.onPause();\r\n\t\t\tif (this.mainMenuLayer.visible) {\r\n\t\t\t\tthis.mainMenuLayer.visible = false;\r\n\t\t\t\tthis.visibleLayout = [this.mainMenuLayer, ...this.visibleLayout];\r\n\t\t\t}\r\n\t\t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_GOTO_RECORD, callbackInfo);\r\n\t\t},\r\n\r\n\t\tshowEnd: function () {\r\n            this.sendNotification(diygamePlayer.AppConstants.SCENE_SHOW_INPUT_VIEW, false);\t// 隐藏剧情输入框\r\n\t\t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_GOTO_END);\r\n\t\t},\r\n\r\n\t\tgetOneCommandResourceInfo: function (command) {\r\n            const resources = [];\r\n            let url = '';\r\n            switch (command.type) {\r\n                case 'addImage':\r\n                    if (command.args[0].index === 1) {\r\n                        url = command.args[0].url === 'inherit' ? this.lstPlotBkKey : command.args[0].url;\r\n                    } else {\r\n                        url = command.args[0].url;\r\n                    }\r\n                    resources.push({type:'img', url});\r\n                    break;\r\n                case 'showDialog':\r\n                    resources.push({type:'img', url:command.args[0].avatar.url});\r\n                    break;\r\n                case 'playMusic':\r\n                    url = command.args[0].url === 'inherit' ? ResourcesManager.usingKeyMap.music : command.args[0].url;\r\n                    resources.push({type:'audio', url});\r\n                    break;\r\n                case 'playSound':\r\n                    url = command.args[0].url === 'inherit' ? ResourcesManager.usingKeyMap.sounds[command.args[0].index] : command.args[0].url;\r\n                    resources.push({type:'audio', url});\r\n                    break;\r\n                case 'options':\r\n                    for (let option of command.args) {\r\n                        if (option.background) {\r\n                            if (option.background.normal) {\r\n                                resources.push({ type: 'img', url: option.background.normal.url });\r\n                            }\r\n                            if (option.background.active) {\r\n                                resources.push({ type: 'img', url: option.background.active.url });\r\n                            }\r\n                            if (option.background.disable) {\r\n                                resources.push({ type: 'img', url: option.background.disable.url });\r\n                            }\r\n                        }\r\n                        if (option.sound && option.sound.url) {\r\n                            resources.push({ type: 'audio', url: option.sound.url });\r\n                        }\r\n                    }\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            return resources;\r\n        },\r\n\r\n\t\tisPlotResourceExist: function (plotInfo) {\r\n            if (plotInfo.commands) return false;\r\n            const isNotExist = (type, key) => {\r\n                const count = ResourcesManager.getCount(type, key, 'play');\r\n                const usingCount = this.usingResourceCount(key);\r\n                if (!count || count == usingCount) {\r\n                    return true;\r\n                }\r\n            };\r\n\r\n            if (plotInfo.background.url !== '' && plotInfo.background.url !== 'inherit' && isNotExist('img', plotInfo.background.url)) {\r\n                return false;\r\n            } else if (plotInfo.background.url === 'inherit' && isNotExist('img', this.lstPlotBkKey)) {\r\n                return false;\r\n            }\r\n            if (plotInfo.avatar.url !== '' && isNotExist('img', plotInfo.avatar.url)) {\r\n                return false;\r\n            }\r\n            if (plotInfo.music.url !== '' && plotInfo.music.url !== 'inherit' && (isNotExist('audio', plotInfo.music.url) || 'ios' === flashvars.client && flashvars.app_version >= '1.5.0')) {\r\n                return false;\r\n            } else if (plotInfo.music.url === 'inherit' && this.bk_music && isNotExist('audio', this.bk_music.key)) {\r\n                return false;\r\n            } else if (plotInfo.music.url === 'inherit' && 'ios' === flashvars.client && flashvars.app_version >= '1.5.0') {\r\n                return false;\r\n            }\r\n            if (plotInfo.options.length) {\r\n                for (let item of plotInfo.options) {\r\n                    if (item.background && item.background.normal && item.background.normal.url && isNotExist('img', item.background.normal.url)) {\r\n                        return false;\r\n                    }\r\n                    if (item.background && item.background.active && item.background.active.url && isNotExist('img', item.background.active.url)) {\r\n                        return false;\r\n                    }\r\n                    if (item.background && item.background.disable && item.background.disable.url && isNotExist('img', item.background.disable.url)) {\r\n                        return false;\r\n                    }\r\n                    if (item.sound && item.sound.url && isNotExist('audio', item.sound.url)) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            if (plotInfo.characters.length || plotInfo.props.length) {\r\n                for (let item of [...plotInfo.characters, ...plotInfo.props]) {\r\n                    if (isNotExist('img', item.url)) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            if (plotInfo.weather) {\r\n                if (plotInfo.weather.value === 'snowy' && !this.viewComponent.game.cache.checkImageKey('/weather/snow/xuehua_00119.png')) {\r\n                    return false;\r\n                }\r\n                else if (plotInfo.weather.value === 'rainy' && !this.viewComponent.game.cache.checkImageKey('/weather/rain/xiayu_00049.png')) {\r\n                    return false;\r\n                }\r\n                else if (plotInfo.weather.value === 'defoliation' && !this.viewComponent.game.cache.checkImageKey('/weather/mapleLeaves/fengye_00089.png')) {\r\n                    return false;\r\n                }\r\n                else if (plotInfo.weather.value === 'fallingPeach' && !this.viewComponent.game.cache.checkImageKey('/weather/beachBlossom/taohua_00089.png')) {\r\n                    return false;\r\n                }\r\n                else if (plotInfo.weather.value === 'fallingFlower' && !this.viewComponent.game.cache.checkImageKey('/weather/blossom/yinghua_00089.png')) {\r\n                    return false;\r\n                }\r\n                else if (plotInfo.weather.value === 'lightning' && !this.viewComponent.game.cache.checkImageKey('/weather/lightning/shandian_00049.png')) {\r\n                    return false;\r\n                }\r\n            }\r\n            for (let item in plotInfo.plot_sound) {\r\n                if (plotInfo.plot_sound[item]) {\r\n                    if ((plotInfo.plot_sound[item].url !== 'inherit' && isNotExist('audio', plotInfo.plot_sound[item].url))\r\n                        || ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version)) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n\r\n\t\tusingResourceCount: function (key) {\r\n\t\t\tconst keyMap = { [this.lstPlotBkKey]: 1 };\r\n\t\t\tconst imgCount = (g = this.viewComponent.game.world) => g.children.forEach(r => {\r\n\t\t\t\tkeyMap[r.key] = (keyMap[r.key] || 0) + 1;\r\n\t\t\t\timgCount(r);\r\n\t\t\t});\r\n\t\t\tconst soundCount = () => this.viewComponent.game.sound._sounds.forEach(s => keyMap[s.key] = (keyMap[s.key] || 0) + 1);\r\n\t\t\timgCount();\r\n\t\t\tsoundCount();\r\n\t\t\treturn keyMap[key] || 0;\r\n\t\t},\r\n\r\n        resetResources: function (resources = []) {\r\n\t\t\tResourcesManager.forEachReCount((type, key, count) => {\r\n\t\t\t\tconst usingCount = this.usingResourceCount(key);\r\n\t\t\t\tif (usingCount > 0) {\r\n\t\t\t\t\tResourcesManager.addRefCount(type, key, 'play', usingCount);\r\n\t\t\t\t}\r\n\t\t\t\tif (!resources.some(d => d.key === key)) {\r\n\t\t\t\t\t!count && ResourcesManager.removeFromCache(type, key);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (key === ResourcesManager.usingKeyMap.music) {\r\n\t\t\t\t\t\tResourcesManager.addRefCount(type, key);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (key === ResourcesManager.usingKeyMap.background) {\r\n\t\t\t\t\t\tResourcesManager.addRefCount(type, key);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (ResourcesManager.usingKeyMap.sounds.some(k => k === key)) {\r\n\t\t\t\t\t\tResourcesManager.addRefCount(type, key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n        },\r\n\t\tgetResources: function (context, chapter, plotIndex, cmdPlotSnap={}, loadData) {\r\n\t\t\tconst { cmdInfo, cmdIndex, cmdScreenSnap } = cmdPlotSnap\r\n\t\t\tconst plots = chapter.plots;\r\n\t\t\tlet { music, sounds, background } = ResourcesManager.usingKeyMap;\r\n\t\t\tif(loadData){\r\n\t\t\t\tmusic = loadData.music.url;\r\n\t\t\t\tsounds = loadData.sounds.map(s => s && s.url);\r\n\t\t\t\tbackground = loadData.background;\r\n\t\t\t}\r\n\t\t\tResourcesManager.lastUsedKeyMap = { music, background, sounds: [...sounds] };\r\n\t\t\tResourcesManager.forceDecode = { musics: [], sounds: new Array(10).fill('') };\r\n\t\t\tResourcesManager.resetReCount();\r\n\t\t\treturn ResourcesManager.getResourcesByContext(context, chapter, plotIndex, cmdInfo, cmdIndex).then(resources => {\r\n\t\t\t\tconst addResources = (data) => {\r\n\t\t\t\t\tif (!resources.data.some(d => d.key === data.key)) {\r\n\t\t\t\t\t\tresources.data.push(data);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tResourcesManager.addRefCount(data.type, data.key);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (plotIndex !== undefined && plots[plotIndex] && !plots[plotIndex].commands && plots[plotIndex].music.url === 'inherit') {\r\n\t\t\t\t\tconst music = this.getMusic(chapter, plotIndex);\r\n\t\t\t\t\tif (music) {\r\n\t\t\t\t\t\taddResources({ key: music, type: 'audio' });\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (loadData) {\r\n\t\t\t\t\tconst { music, sounds, charsAndProps, background, images } = loadData;\r\n\t\t\t\t\tif (background && !resources.data.some(d => d.key === background)) {\r\n\t\t\t\t\t\taddResources({ key: background, type: 'img' });\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (music && !resources.data.some(d => d.key === music.url)) {\r\n\t\t\t\t\t\tResourcesManager.forceDecode.musics.push(music.url);\r\n\t\t\t\t\t\taddResources({ key: music.url, type: 'audio' });\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsounds && sounds.forEach((s, i) => {\r\n\t\t\t\t\t\tif (s && !resources.data.some(d => d.key === s.url)) {\r\n\t\t\t\t\t\t\tResourcesManager.forceDecode.sounds[i] = s.url;\r\n\t\t\t\t\t\t\taddResources({ key: s.url, type: 'audio' });\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcharsAndProps && charsAndProps.forEach(cp => {\r\n\t\t\t\t\t\tif (!resources.data.some(d => d.key === cp.url)) {\r\n\t\t\t\t\t\t\taddResources({ key: cp.url, type: 'img' });\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\timages && images.forEach(img => {\r\n\t\t\t\t\t\tif (!resources.data.some(d => d.key === img.url)) {\r\n\t\t\t\t\t\t\taddResources({ key: img.url, type: 'img' });\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (cmdScreenSnap) {\r\n\t\t\t\t\tconst { music, sounds, charsAndProps, dialogInfo, bk } = cmdPlotSnap.cmdScreenSnap;\r\n\t\t\t\t\tif (dialogInfo && dialogInfo[0] && dialogInfo[0].avatar.url) {\r\n\t\t\t\t\t\taddResources({ key: dialogInfo[0].avatar.url, type: 'img' });\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (bk && bk.url) {\r\n\t\t\t\t\t\taddResources({ key: bk.url, type: 'img' });\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (music && music.url) {\r\n\t\t\t\t\t\taddResources({ key: music.url, type: 'audio' });\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsounds && sounds.forEach((s, i) => s && s.url && addResources({ key: s.url, type: 'audio' }));\r\n\t\t\t\t\tcharsAndProps && charsAndProps.forEach(cp => cp && cp.url && addResources({ key: cp.url, type: 'img' }));\r\n\t\t\t\t}\r\n\t\t\t\treturn resources;\r\n\t\t\t});\r\n\t\t},\r\n\t\tpreloadCommandsAssets: function (context, chapter, plotIndex, cmdInfo, cmdIndex, loadData){\r\n\t\t\treturn this.getResources(context, chapter, plotIndex, { cmdInfo, cmdIndex }, loadData).then(resources => {\r\n\t\t\t\tconst promises = [];\r\n\t\t\t\tthis.resetResources(resources.data);\r\n\t\t\t\tresources.data.forEach(d => {\r\n\t\t\t\t\tpromises.push(this.addAssets(d.key, d.type, d.key, true));\r\n\t\t\t\t});\r\n\t\t\t\treturn Promise.all(promises);\r\n\t\t\t});\r\n\t\t},\r\n\t\tpreloadChapterAssets: function (context, chapter, plotIndex, cmdPlotSnap, loadData) {\r\n\t\t\tthis.curChapter = chapter;\r\n\t\t\tthis.curPlotIndex = plotIndex || 0;\r\n\t\t\tthis.cmdPlotSnap = cmdPlotSnap;\r\n\r\n\t\t\treturn this.getResources(context, chapter, plotIndex, cmdPlotSnap, loadData).then(resources => {\r\n\t\t\t\tconst promises = [];\r\n\t\t\t\tthis.resetResources(resources.data);\r\n\t\t\t\tresources.data.forEach(d => {\r\n\t\t\t\t\tpromises.push(this.addAssets(d.key, d.type, d.key, true));\r\n\t\t\t\t});\r\n\t\t\t\treturn Promise.all(promises).then(() => {\r\n\t\t\t\t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_PLOT_LOAD_ASSETS_READY, {context, loadData});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tenableLayerInput: function (layer, bEnabled) {\r\n\t\t\tconst enableChild = function (child, b) {\r\n\t\t\t\tif (child.inputEnabled == !b && !child.text) {\r\n\t\t\t\t\tchild.inputEnabled = b;\r\n\t\t\t\t}\r\n\t\t\t\tif (child.children.length > 0) {\r\n\t\t\t\t\tfor (let i in child.children) {\r\n\t\t\t\t\t\tenableChild(child.children[i], b);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif ('recordLayer' === layer.name) {\r\n\t\t\t\tlayer.visible = bEnabled;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if ('menuLayer' === layer.name) {\r\n\t\t\t\tlayer.children[0].inputEnabled = bEnabled;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let i in layer.children) {\r\n\t\t\t\t\tenableChild(layer.children[i], bEnabled);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tapToFinalState: function () {\r\n            if (this.charsAndPropsLayer && this.charsAndPropsLayer.exists) {\r\n                for (let i=0; i<this.charsAndPropsLayer.children.length; i++) {\r\n                    let imgGroup = this.charsAndPropsLayer.children[i];\r\n                    let img = imgGroup.children[0];\r\n                    if (img && img.finalState) {\r\n                        img.alpha = img.finalState.alpha;\r\n                        img.angle = img.finalState.angle;\r\n                        img.x = img.finalState.x;\r\n                        img.y = img.finalState.y;\r\n                        imgGroup.x = 0;\r\n                        imgGroup.y = 0;\r\n                        imgGroup.scale.x = imgGroup.finalState.scale.x;\r\n                        imgGroup.scale.y = imgGroup.finalState.scale.y;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n\t\tremovePlotTweens: function () {\r\n            // 清理上一剧情动画\r\n            this.twinkleTimer && this.twinkleTimer.cancel() && (this.twinkleTimer=null);\r\n            while (this.lstPlotTweens.length) {\r\n                let tween = this.lstPlotTweens.splice(0, 1);\r\n                tween[0].stop(true);\r\n                if (tween[0].target && tween[0].target.name === 'twinkle') {\r\n                    tween[0].target.destroy();\r\n                }\r\n            }\r\n            this.apToFinalState();\r\n        },\r\n\r\n\t\tonPause: function () {\r\n\t\t\t// 暂停剧情播放\r\n            this.playPause = true;\r\n\r\n\t\t\t// 暂停所有元素的缓动动画\r\n            //this.viewComponent.game.tweens.pauseAll();\r\n            for (let i = this.viewComponent.game.tweens._tweens.length - 1; i >= 0; i--)\r\n            {\r\n            \tlet t = this.viewComponent.game.tweens._tweens[i];\r\n                if (t.name && t.name==='toast') continue;\r\n                t.pause();\r\n            }\r\n            this.sendNotification(diygamePlayer.AppConstants.SCENE_SHOW_INPUT_VIEW, false);\t// 隐藏剧情输入框\r\n        },\r\n\r\n\t\tonResume: function () {\r\n            this.playPause = false;\t\t\t\t\t\t// 唤醒剧情播放\r\n            this.viewComponent.game.tweens.resumeAll();\t\t// 唤醒所有元素的缓动动画\r\n\t\t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_SHOW_INPUT_VIEW, true);\t// 显示剧情输入框UI\r\n        },\r\n\r\n\t\tonCoverStartBtnClicked: function () {\r\n            const chapter = this.findFirstChapter();\r\n            const chapterUuid = chapter.downloadUuid ? chapter.downloadUuid : chapter.uuid;\r\n            if (chapter.md5 && chapter.plots.length === 0) {\r\n                if (chapter.charge && ('android' === flashvars.client || 'ios' === flashvars.client)) {\r\n                    const unlockFinish = (bSuccess, stayIfFail) => {\r\n                        if (bSuccess) {\r\n                            this.checkIfChapterFree(chapterUuid, chapter.md5).then((plots)=>{\r\n                                this.unlockChapterCallBack = null;\r\n                                chapter.plots = plots;\r\n                                this.preloadChapterAssets(this.context, chapter);\r\n                            }, () => {\r\n                            \tDialog.error('获取付费章节信息失败');\r\n                                this.coverLayer.visible = true;\r\n                            })\r\n                        }\r\n                        else if (stayIfFail) {\r\n                            this.coverLayer.visible = true;\r\n                        }\r\n                    };\r\n\r\n                    this.unlockChapter(chapterUuid, chapter.charge, chapter.md5, unlockFinish);\r\n                } else {\r\n                    this.checkIfChapterFree(chapterUuid, chapter.md5).then((plots)=>{\r\n                        chapter.plots = plots;\r\n                        this.preloadChapterAssets(this.context, chapter);\r\n                    }, (msg)=>{\r\n                        if (-1 === msg.indexOf('code=87')) { // 账号未登录\r\n                            Dialog.error(msg);\r\n                        } else { // 未购买此章节\r\n                            Dialog.info('当前为收费章节，请前往闪艺app或电脑端进行购买');\r\n                        }\r\n                        this.coverLayer.visible = true;\r\n                    })\r\n\t\t\t\t}\r\n            } else {\r\n                this.preloadChapterAssets(this.context, chapter);// 播放剧情\r\n\t\t\t}\r\n            this.coverLayer.visible = false;\r\n        },\r\n\t\tonCoverLoadBtnClicked: function () {\r\n\t\t\tthis.showLoad();\r\n\t\t},\r\n\t\tonCoverSettingBtnClicked: function () {\r\n\t\t\tthis.showSettings(this.context)\r\n\t\t},\r\n\t\tonCoverOverBtnClicked: function () {\r\n            if (navigator.userAgent.indexOf(\"MSIE\") > 0) {\r\n                if (navigator.userAgent.indexOf(\"MSIE 6.0\") > 0) {\r\n                    window.opener = null;\r\n                    window.close();\r\n                } else {\r\n                    window.open('', '_top');\r\n                    window.top.close();\r\n                }\r\n            }\r\n            else if (navigator.userAgent.indexOf(\"Firefox\") > 0) {\r\n                window.location.href = 'about:blank ';\r\n            } else {\r\n                //open(location, '_self').close();\r\n                window.opener = null;\r\n                window.open(\"\", \"_self\");\r\n                window.close();\r\n            }\r\n\t\t},\r\n\r\n\t\tonMenuBtnClicked: function () {\r\n\t\t\tthis.getSnap();\r\n\t\t\t//this.onPause();\r\n\t\t\tthis.showMainMenu(this.context)\r\n\t\t},\r\n\t\tonSyMenuBtnClicked: function () {\r\n\t\t\tif (flashvars.client === 'ios' || flashvars.client === 'android') {\r\n\t\t\t\tif (flashvars.app_version < '1.2.0') {\r\n\t\t\t\t\tDialog.info('版本过低，不支持该功能');\r\n\t\t\t\t} else {\r\n                    window.app && window.app.moreWorks();\r\n                }\r\n\t\t\t} else {\r\n                ShanyiMenu.showSyMenu().then(v => {\r\n                \tif (1 !== v) {\r\n                \t\tif (typeof v === 'string' && -1 !== v.indexOf('http')) {\r\n                            window.location.href = v;\r\n                        }\r\n                \t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n        },\r\n\r\n\t\tonMainMenuSaveBtnClicked: function () {\r\n            if (!this.context.disableSaveOrLoad || !this.context.disableSaveOrLoad.save) {\r\n                this.showSave();\r\n            } else {\r\n                this.showToast(1, '抱歉，作者在此设置了禁用存档');\r\n            }\r\n\t\t},\r\n\t\tonMainMenuLoadBtnClicked: function () {\r\n\t\t\tif (!this.context.disableSaveOrLoad || !this.context.disableSaveOrLoad.load) {\r\n                this.showLoad();\r\n\t\t\t} else {\r\n\t\t\t\tthis.showToast(1, '抱歉，作者在此设置了禁用读档');\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMainMenuPlaybackBtnClicked: function () {\r\n\t\t\tthis.showPlayback();\r\n\t\t},\r\n\t\tonMainMenuAutoplayBtnClicked: function () {\r\n\t\t\tthis.context.auto = !this.context.auto;\r\n\t\t\tthis.onMainMenuBackBtnClicked();\r\n\t\t},\r\n\t\tonMainMenuSettingsBtnClicked: function () {\r\n\t\t\tthis.showSettings(this.context);\r\n\t\t},\r\n\t\tonMainMenuBackBtnClicked: function () {\r\n\t\t\tthis.mainMenuLayer.visible = false;\t\t\t// 隐藏主菜单层\r\n\t\t\tthis.onResume();\r\n\t\t\tif (this.context.auto) {\r\n\t\t\t\tthis.curPlotLayer.onChildInputDown.dispatch('auto');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonSettingsFullModeBtnClicked: function () {\r\n\t\t\tthis.viewComponent.game.scale.startFullScreen(false);\r\n\t\t\tthis.context.fullScreen = true;\r\n\t\t},\r\n\t\tonSettingsWindowModeBtnClicked: function () {\r\n\t\t\tthis.viewComponent.game.scale.stopFullScreen();\r\n\t\t\tthis.context.fullScreen = false;\r\n\t\t},\r\n\t\tonSettingsAutoOnBtnClicked: function () {\r\n\t\t\tthis.context.auto = true;\r\n\t\t},\r\n\t\tonSettingsAutoOffBtnClicked: function () {\r\n\t\t\tthis.context.auto = false;\r\n\t\t},\r\n\t\tonSettingsBackBtnClicked: function () {\r\n\t\t\tthis.visibleLayout[0] && (this.visibleLayout[0].visible = true);\r\n            if (this.visibleLayout[0] !== this.mainMenuLayer) {\r\n                this.onResume();\r\n            }\r\n\t\t\tthis.visibleLayout = this.visibleLayout.slice(1);\r\n\t\t\tthis.settingsLayer.visible = false;\r\n\t\t},\r\n\r\n\t\tonRecordBackBtnClicked: function () {\r\n\t\t\tthis.visibleLayout[0] && (this.visibleLayout[0].visible = true);\r\n            if (this.visibleLayout[0] !== this.mainMenuLayer) {\r\n                this.onResume();\r\n            }\r\n\t\t\tthis.visibleLayout = this.visibleLayout.slice(1);\r\n\t\t\tthis.recordLayer.visible = false;\r\n\r\n\t\t\tthis.showMenu();\r\n\t\t},\r\n\t\tonRecordLocalBtnClicked: function () {\r\n\t\t\tthis.bCloudSel = false;\r\n\t\t\tthis.bToSaveFile ? this.showSave(true) : this.showLoad(true);\r\n        },\r\n\t\tonRecordCloudBtnClicked: function () {\r\n\t\t\tthis.bCloudSel = true;\r\n            this.bToSaveFile ? this.showSave(true) : this.showLoad(true);\r\n        },\r\n\r\n\t\tshowMenu: function () {\r\n            // 显示菜单层\r\n            this.menuLayer.visible = true;\r\n            if (this.curPlotInfo && this.curPlotInfo.menu) {\r\n                this.menuLayer.visible = !this.curPlotInfo.menu.hidden;\r\n            }\r\n        },\r\n\r\n\t\tshowGuideTip:function (index) {\r\n\t\t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_SHOW_GUIDE,{id:index})\r\n        },\r\n\r\n\t\tisSignedIn: function () {\r\n\t\t\treturn this.loadCloudRecord(99).then(rs => {\r\n\t\t\t\tconst convertCloudData = (data) => {\r\n\t\t\t\t\tlet cdata = JSON.parse(data);\r\n\t\t\t\t\tlet rdata = Array(12);\r\n\r\n\t\t\t\t\tfor (let i=0; i<cdata.length; i++) {\r\n                        if (!cdata[i].plotUuid) {\r\n                        \trdata[i] = {};\r\n                        \tcontinue;\r\n                        }\r\n                        else {\r\n                        \tlet strTS = '' + cdata[i].time_stamp;\r\n                        \trdata[i] = {};\r\n                        \trdata[i].plotUuid = cdata[i].plotUuid;\r\n                        \trdata[i].timestamp = strTS.length > 10 ? cdata[i].time_stamp : cdata[i].time_stamp * 1000;\r\n                        \trdata[i].plotSnap = 'data:image/jpeg;base64,' + cdata[i].plot_snap;\r\n                        }\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn rdata;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis.bSignedIn = true;\r\n\t\t\t\tthis.cloudPlotsData = rs === ''? Array(12).fill({}) : convertCloudData(rs);\r\n\t\t\t\treturn this.getPayInfo().then(() => this.getAccountInfo()).then(() => {return Promise.resolve()});\r\n\t\t\t\t}\r\n\t\t\t, rj => {\r\n\t\t\t\tthis.bSignedIn = false;\r\n\t\t\t\treturn Promise.reject(rj);\r\n\t\t\t\t});\r\n        },\r\n\r\n\t\tfindFirstChapter: function () {\r\n\t\t\tconst checkChapter = chapter => {\r\n\t\t\t\tif (chapter.plots.length > 0 || chapter.md5) {\r\n\t\t\t\t\tchapter.isFirst = true;\r\n\t\t\t\t\treturn chapter;\r\n                }\r\n\t\t\t\tfor (let i=0; i<chapter.subchapters.length; i++) {\r\n\t\t\t\t\tconst result = checkChapter(chapter.subchapters[i]);\r\n\t\t\t\t\tif (result) {\r\n\t\t\t\t\t\treturn result;\r\n                    }\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t};\r\n\r\n\t\t\tfor (let i=0; i<this.json_data.chapters.length; i++) {\r\n\t\t\t\tconst result = checkChapter(this.json_data.chapters[i]);\r\n\t\t\t\tif (result) return result;\r\n\t\t\t}\r\n\r\n\t\t\treturn this.json_data.chapters[0];\r\n        },\r\n\r\n\t\tnotifyGameStarted: function () {\r\n\t\t\tif (flashvars.app_version && flashvars.app_version < '1.3.0') {\r\n                this.isGameStarted = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.isGameStarted = true;\r\n            if (flashvars.client === 'ios') {\r\n                if(flashvars.offline == 1){\r\n                    javascript:gameStart('1');\r\n                }else{\r\n                    window.webkit && window.webkit.messageHandlers.gameStart.postMessage('1');\r\n                }\r\n            }\r\n            else if (flashvars.client === 'android') {\r\n                window.app && window.app.gameStart('1');\r\n            }\r\n            else if (this.isWap3000()) {\r\n                Xhr.xhrLoad('https://www.3000.com/apis/client/v1.0/trace-play.html?id=' + flashvars.gid + '&from=wap', '', null);\r\n\t\t\t}\r\n        },\r\n\r\n        updateAccInfo: function (bLogout, bEntering) {\r\n            if (bLogout) {\r\n                flashvars.u = '';\r\n                flashvars.token = '';\r\n                this.context.systemValues[0].value = 0;\r\n                this.getPayInfo();\r\n                return;\r\n            }\r\n\r\n            if (!this.context) {\r\n                this.context = {};\r\n            }\r\n\r\n            if (!flashvars.uid && !flashvars.client) {\r\n            \tflashvars.uid = Utils.getUidByCookie();\r\n\t\t\t}\r\n\r\n            this.localRecFileToUidRecFile(false);\r\n\r\n            const doUpdate = () => {\r\n                this.getPayInfo().then((rs) => {\r\n                    if (Object.prototype.toString.apply(rs) !== '[object String]' || bEntering) {\r\n                        this.getAccountInfo().then(() => {\r\n                            this.getFansInfo().then(() => {\r\n                                if (bEntering/*!this.context.values*/) {\r\n                                    this.sendNotification( diygamePlayer.AppConstants.SCENE_PRELOADING_PROGRESS);\r\n                                }\r\n                            })\r\n                        });\r\n                    }\r\n                    else {\r\n                        setTimeout(function() {return doUpdate();}, 1);\r\n                    }\r\n                });\r\n\t\t\t};\r\n            doUpdate();\r\n\t\t},\r\n\r\n\t\tlocalRecFileToUidRecFile: function (bLocalCloudSwitch) {\r\n            const recId = flashvars.uuid + flashvars.uid;\r\n            const userData = Utils.localStorageGetItem(recId);\r\n            const savedData = Utils.localStorageGetItem(flashvars.uuid);\r\n            if (!userData && savedData) {\r\n                Utils.localStorageSetItem(recId, savedData);\r\n                Utils.localStorageRemoveItem(flashvars.uuid);\r\n            }\r\n            if (!bLocalCloudSwitch) {\r\n                if (this.recordLayer && this.recordLayer.visible) {\r\n                    this.bSwitchAccInPlot = false;\r\n                } else {\r\n                    this.bSwitchAccInPlot = true;\r\n                }\r\n            }\r\n            if (this.gameUidBelongTo === '' && flashvars.uid !== '') {\r\n                this.gameUidBelongTo = flashvars.uid;\r\n            }\r\n        },\r\n\r\n\t\tgetFansInfo: function () {\r\n\t\t\tif ('ios' !== flashvars.client && 'android' !== flashvars.client) {\r\n\t\t\t\tflashvars.uid = Utils.getUidByCookie();\r\n\t\t\t}\r\n\r\n            let url = 'https://pay.3000.com/?m=payinterface&op=player_one_opus_fans&opus_id=' + flashvars.gid + '&uid=' + flashvars.uid;\r\n            return Xhr.xhrLoad(url, '').then(rs => {\r\n                if (rs.responseText.length === 0) {\r\n                    return Promise.resolve('Get Fans Count failed, no response data');\r\n                }\r\n            \tconst data = JSON.parse(rs.responseText);\r\n                this.context.systemValues[9].value = data.data.fans_total;\r\n                return Promise.resolve(this.context.systemValues);\r\n            }, rj => {\r\n                return Promise.resolve('跨域了('+rj+')');\r\n\t\t\t})\r\n\t\t},\r\n\r\n        getAccountInfo: function () {\r\n            const getData = (url, d) => {\r\n                return Xhr.xhrSend(url, d, null, 4000).then(rs => {\r\n                    if (rs.responseText.length === 0) {\r\n                        return Promise.resolve('Get AccountInfo failed, no response data');\r\n                    }\r\n                    let retData = JSON.parse(rs.responseText);\r\n                    if (retData.status === 0) {\r\n                        this.context.systemValues[0].value = retData.data.payment_available;\r\n                        this.context.systemValues[1].value = retData.data.game_coin_available ? retData.data.game_coin_available : 0;\r\n                        this.usedStarCount = retData.data.single_game_star_use ? retData.data.single_game_star_use : 0;\r\n                        this.gameStarLimit = retData.data.single_game_star ? retData.data.single_game_star : 0;\r\n                        return Promise.resolve(this.context.systemValues);\r\n                    }\r\n                    else { // status>0 && status<9 账号被踢出\r\n                        this.context.systemValues[0].value = 0;\r\n                        this.context.systemValues[1].value = 0;\r\n                        this.usedStarCount = 0;\r\n                        this.gameStarLimit = 0;\r\n                        return Promise.resolve(retData);\r\n                    }\r\n                }, rj => {\r\n                    this.context.systemValues[0].value = 0;\r\n                    this.context.systemValues[1].value = 0;\r\n                    return Promise.resolve('获取用户信息权限错误(' + rj + ')');\r\n                });\r\n            };\r\n\r\n            let url = 'https://pay.3000.com/?m=player&op=get_account_info';\r\n            let data = 'gid=' + flashvars.gid;\r\n            if (flashvars.client === 'ios' || flashvars.client === 'android') {\r\n                url = 'https://app.3000.com/?m=user&op=index&ac=my_account&client=' + flashvars.client +'&v=' + flashvars.v + '&app_version=' + flashvars.app_version;\r\n                data = 'u=' + encodeURIComponent(Utils.aesEncrypt(flashvars.u, 1)) + '&token=' + encodeURIComponent(Utils.aesEncrypt(flashvars.token, 1))\r\n\t\t\t\t\t+ '&game_id=' + encodeURIComponent(Utils.aesEncrypt(flashvars.gid, 1));\r\n            }\r\n\r\n            if (!this.context.systemValues) {\r\n                this.context.systemValues = [{name: '闪币余额', uuid: '', key:'coinTotal', init: { type: 'system', value: 0 }}\r\n                , {name: '星星余额', uuid: '', key:'starTotal', init: { type: 'system', value: 0}}\r\n                , { name: '时间戳', uuid: '', key:'timestamp', init: { type: 'system', value: -1 }}\r\n                , { name: '当前年', uuid: '', key:'year', init: { type: 'system', value: -1 } }\r\n                , { name: '当前月', uuid: '', key:'month', init: { type: 'system', value: -1 } }\r\n                , { name: '当前日', uuid: '', key:'day', init: { type: 'system', value: -1 } }\r\n                , { name: '当前小时', uuid: '', key:'hour', init: { type: 'system', value: -1 } }\r\n                , { name: '当前分钟', uuid: '', key:'minute', init: { type: 'system', value: -1 } }\r\n                , { name: '当前秒', uuid: '', key:'second', init: { type: 'system', value: -1 } }\r\n                , { name: '贡献值', uuid: '', key:'contribution', init: { type: 'system', value: 0 } }\r\n                , { name: '星期', uuid: '', key:'weekday', init: {type: 'system', value: 0 } } ];\r\n            }\r\n            return getData(url, data);\r\n        },\r\n\r\n        getPayInfo: function () {\r\n            const getData = (url, d) => {\r\n                return Xhr.xhrSend(url, d, null, 4000).then(rs => {\r\n                    if (rs.responseText.length === 0) {\r\n                        return Promise.resolve('Get AccountInfo failed, no response data');\r\n                    }\r\n                    let retData = JSON.parse(rs.responseText);\r\n                    if (retData.status === 0 || retData.status === -1) {\r\n                    \tif (retData.status === -1) {\r\n                            let payInfoData = Utils.localStorageGetItem(flashvars.uuid + 'payInfo'/* + flashvars.uid*/);\r\n                            retData.data.content = payInfoData === null ? '' : payInfoData;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (retData.status === 0 && !retData.data.content) {\r\n                            let payInfoData = Utils.localStorageGetItem(flashvars.uuid + 'payInfo' + flashvars.uid);\r\n                            if (!payInfoData) {\r\n                                payInfoData = Utils.localStorageGetItem(flashvars.uuid + 'payInfo');\r\n                                Utils.localStorageRemoveItem(flashvars.uuid + 'payInfo');\r\n\t\t\t\t\t\t\t}\r\n                            retData.data.content = payInfoData === null ? '' : payInfoData;\r\n\t\t\t\t\t\t}\r\n\r\n                        if (retData.data.content !== '' && this.json_data.payValues) {\r\n                            this.payValueUid = flashvars.uid;\r\n                        \tlet values = JSON.parse(Utils.decryptBase64(retData.data.content));\r\n                        \tfor (let i=0; i<values.length; i++) {\r\n                                for (let j=0; j<this.json_data.payValues.length; j++) {\r\n                                    if (this.json_data.payValues[j].uuid === values[i].uuid) {\r\n                                        this.context.payValues[j] = values[i];\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n                            if (0 === retData.status && -1 !== rs.responseText.indexOf('{\\\"content\\\":\\\"\\\"}')) {\r\n                        \t\treturn this.savePayInfo();\r\n\t\t\t\t\t\t\t}\r\n                            return Promise.resolve(this.context.payValues);\r\n                        }\r\n                        else {\r\n                    \t\tif (this.payValueUid !== flashvars.uid) {\r\n                    \t\t\tthis.context.payValues.forEach(v => {v.value = 0})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn Promise.resolve('');\r\n                            //return this.savePayInfo();\r\n                        }\r\n                    }\r\n                    return Promise.resolve('获取用户信息失败(' + retData.msg + ':' + retData.status + ')');\r\n                }, rj => {\r\n                    return Promise.resolve('获取用户信息权限错误(' + rj + ')');\r\n                });\r\n            };\r\n\r\n            let aesKeyType = flashvars.u && flashvars.token ? 1 : 0;\r\n            let stime = Math.floor((new Date()).getTime() / 1000) + Utils.timeOffset;\r\n            let gid = flashvars.gid === '' ? 1 : parseInt(flashvars.gid);\r\n            let sSign = '';\r\n\r\n            if (aesKeyType) {\r\n                sSign = 'app_name=' + (flashvars.app_name === '' ? 'shanyi' : flashvars.app_name)\r\n                    + '&device_name=' + (flashvars.device_name === '' ? 'Google Nexus S' : flashvars.device_name)\r\n                    + '&device_system_version=' + (flashvars.deviceOsVer === '' ? '4.1.1' : flashvars.deviceOsVer)\r\n                    + '&gid=' + gid + '&time=' + stime + '&token=' + flashvars.token + '&u=' + flashvars.u\r\n                    + '&v_key=shanyi_WDF#$H*#SJN*&G$&**';\r\n            }\r\n            else {\r\n                sSign = 'gid=' + gid + '&time=' + stime + '&v_key=0GjRAtUUoK4BwJGUz73jBa2M';\r\n            }\r\n\r\n            gid = Utils.aesEncrypt(gid, aesKeyType);\r\n            sSign = Utils.aesEncrypt(MD5.hash(MD5.hash(sSign)), aesKeyType);\r\n            stime = Utils.aesEncrypt(stime, aesKeyType);\r\n\r\n            let url = 'https://my.3000.com/?m=pay_value&op=index&ac=info&api_v=1.0.0&api_from=webpc';\r\n            let data = 'gid=' + encodeURIComponent(gid) + '&sign=' + encodeURIComponent(sSign) + '&time=' + encodeURIComponent(stime);\r\n\r\n            if (flashvars.u !== '' && flashvars.token !== '') {\r\n                url = 'https://app.3000.com/?m=pay_value&op=index&ac=info&client=' + flashvars.client +'&v=' + flashvars.v + '&app_version=' + flashvars.app_version;\r\n                data += this.getPhoneData();\r\n            }\r\n\r\n            if (!this.context.payValues) {\r\n                this.context.payValues = [{name: '消费数值1',\r\n                    uuid: '',\r\n                    init: { type: 'const', value: 0 },\r\n\t\t\t\t\tvalue: 0\r\n                }];\r\n            }\r\n            return getData(url, data);\r\n        },\r\n\r\n        savePayInfo: function () {\r\n            const sendData = (url, d, dataIfFail) => {\r\n                return Xhr.xhrSend(url, d, null, 4000).then(rs => {\r\n                    if (rs.responseText.length === 0) {\r\n                    \tthis.showToast(1, '用户数据无法保存，请在网络恢复后重新操作');\r\n                        return Promise.reject('Save file failed, no response data');\r\n                    }\r\n                    let retData = JSON.parse(rs.responseText);\r\n                    if (retData.status === 0) {\r\n                        return Promise.resolve();\r\n                    }\r\n                    else {\r\n                        if (retData.status === -1) { // 未登录，保存本地\r\n                            Utils.localStorageSetItem(flashvars.uuid + 'payInfo' + flashvars.uid, dataIfFail);\r\n                            this.showToast(2, '温馨提醒：登录后才可以同步用户数据哦～');\r\n                        \treturn Promise.resolve();\r\n                        }\r\n                        else if (retData.status === 2) {\r\n                            this.showToast(1, '用户数据保存失败，账号已在其他设备登录');\r\n                            return Promise.reject(retData.msg + ': ' + retData.status);\r\n                        }\r\n                        this.showToast(1, '用户数据无法保存，请在网络恢复后重新操作');\r\n                        return Promise.reject(retData.msg + ': ' + retData.status);\r\n                    }\r\n                }, rj => {\r\n                    this.showToast(1, '用户数据无法保存，请在网络恢复后重新操作');\r\n                    return Promise.reject(rj);\r\n                });\r\n            };\r\n\r\n            let aesKeyType = flashvars.u && flashvars.token ? 1 : 0;\r\n            const str = JSON.stringify(this.context.payValues);\r\n            const strBase64 = Utils.encodeBase64(str);\r\n            const stime = Math.floor((new Date()).getTime() / 1000) + Utils.timeOffset;\r\n            const gid = flashvars.gid === '' ? 1 : parseInt(flashvars.gid);\r\n            let\tsSign = '';\r\n\r\n            if (aesKeyType) {\r\n                sSign = 'app_name=' + (flashvars.app_name === '' ? 'shanyi' : flashvars.app_name)\r\n                    + '&content=' + strBase64\r\n                    + '&device_name=' + (flashvars.device_name === '' ? 'Google Nexus S' : flashvars.device_name)\r\n                    + '&device_system_version=' + (flashvars.deviceOsVer === '' ? '4.1.1' : flashvars.deviceOsVer)\r\n                    + '&gid=' + gid + '&progress=1&time=' + stime + '&token=' + flashvars.token + '&u=' + flashvars.u\r\n                    + '&v_key=shanyi_WDF#$H*#SJN*&G$&**';\r\n            }\r\n            else {\r\n                sSign = 'content=' + strBase64 + '&gid=' + gid + '&progress=1&time=' + stime + '&v_key=0GjRAtUUoK4BwJGUz73jBa2M';\r\n            }\r\n\r\n            let url = 'https://my.3000.com/?m=pay_value&op=index&ac=save&api_v=1.0.0&api_from=webpc';\r\n            let data = 'content=' + encodeURIComponent(Utils.aesEncrypt(strBase64, aesKeyType))\r\n                + '&gid=' + encodeURIComponent(Utils.aesEncrypt(gid, aesKeyType))\r\n                + '&progress=' + encodeURIComponent(Utils.aesEncrypt(1, aesKeyType))\r\n                + '&sign=' + encodeURIComponent(Utils.aesEncrypt(MD5.hash(MD5.hash(sSign)), aesKeyType))\r\n                + '&time=' + encodeURIComponent(Utils.aesEncrypt(stime, aesKeyType));\r\n\r\n            if (flashvars.u !== '' && flashvars.token !== '') {\r\n                url = 'https://app.3000.com/?m=pay_value&op=index&ac=save&client=' + flashvars.client +'&v=' + flashvars.v + '&app_version=' + flashvars.app_version;\r\n                data += this.getPhoneData();\r\n            }\r\n\r\n            return sendData(url, data, strBase64);\r\n        },\r\n\r\n\t\tgetDiscounts: function (gameId, chapterUuid, productId, platform) {\r\n\t\t\tconst getData = (url) => {\r\n                return Xhr.xhrLoad(url, '').then(rs => {\r\n                    if (rs.responseText.length === 0) {\r\n                        return Promise.resolve('Get Discounts failed, no response data');\r\n                    }\r\n                    const data = JSON.parse(rs.responseText);\r\n                    return Promise.resolve(data.result);\r\n                }, rj => {\r\n                    return Promise.resolve('获取商品价格失败！');\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t\tlet data = 'uuid=' + gameId + (chapterUuid ? '&chapter_uuid=' + chapterUuid : '&product_id=' + productId) + '&platform=' + platform;\r\n\t\t\tlet url = 'https://mapi.3000api.com/apis/soft/v1.0/game-getCharge.html?' + data;\r\n\r\n\t\t\treturn getData(url);\r\n        },\r\n\r\n        payOperation: function (price, goodsId, indentId, callback) {\r\n\t\t\tlet disCounts = -1;\r\n\t\t\tconst invokeApp = () => {\r\n                let payArg = {gid: flashvars.gid, eid: goodsId, charge: price\r\n\t\t\t\t\t, special_price: disCounts\r\n                    , balance: this.context.systemValues[0].value\r\n                    , starsNeed: price * 100\r\n                    , stars: this.context.systemValues[1].value\r\n                    , starsUsed: this.usedStarCount\r\n                    , starsLimited: this.gameStarLimit\r\n                    , payValues: Utils.encodeBase64(JSON.stringify(this.context.payValues))\r\n                    , indentId: indentId};\r\n\r\n                if (flashvars.client === 'ios') {\r\n                    this.mallPayCallback = callback;\r\n                    if(flashvars.offline == 1){\r\n                        javascript:worksmall(JSON.stringify(payArg));\r\n                    }else{\r\n                        window.webkit && window.webkit.messageHandlers.worksmall.postMessage(JSON.stringify(payArg));\r\n                    }\r\n                }\r\n                else if (flashvars.client === 'android') {\r\n                    this.mallPayCallback = callback;\r\n                    window.app && window.app.worksmall(JSON.stringify(payArg));\r\n                }\r\n\t\t\t};\r\n\r\n            if (flashvars.client === 'android' || flashvars.client === 'ios') {\r\n                if (flashvars.app_version < '1.2.0') {\r\n                \tDialog.info('版本过低不支持改功能，请先更新版本~');\r\n                \treturn Promise.resolve(disCounts);\r\n                }\r\n            \treturn this.getAccountInfo().then(info => {\r\n            \t\tif (typeof info === 'string') {\r\n            \t\t\tDialog.error('网络异常，请检查您的网络！');\r\n            \t\t\tcallback(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (info.status && info.status>0 && info.status<9) {\r\n            \t\t\tif (flashvars.app_version >= '1.2.0') {\r\n                            window.location.href = 'lzj3000://logout';\r\n\t\t\t\t\t\t}\r\n\r\n                        Dialog.info(info.msg).then(() => {\r\n                            window.location.href = 'lzj3000://login';\r\n                        });\r\n\t\t\t\t\t\tcallback(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (100 === info.status && !info.success) {\r\n                        callback(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n                        return this.getDiscounts(flashvars.uuid, null, goodsId, 'app').then(info => {\r\n                            if (typeof info === 'string') {\r\n                                Dialog.error(info);\r\n                                callback(false);\r\n                            }\r\n                            else {\r\n                            \tprice = info.charge;\r\n                            \tdisCounts = info.special_price;\r\n                                invokeApp();\r\n                            }\r\n                            return Promise.resolve(disCounts);\r\n                        });\r\n\t\t\t\t\t}\r\n                    return Promise.resolve(disCounts);\r\n\t\t\t\t})\r\n            }\r\n            else {\r\n                Dialog.info('请前往APP或电脑端购买~');\r\n                return Promise.resolve(disCounts);\r\n            }\r\n        },\r\n\r\n\t\tchapterInfoProgress: function (prgsInfo) {\r\n            let group = this.viewComponent.game.world.getByName('chapterInfoProgress');\r\n            if (!group) {\r\n                group = this.viewComponent.game.add.group();\r\n                group.name = 'chapterInfoProgress';\r\n\r\n                let background = this.viewComponent.game.add.graphics(0, 0, group);\r\n                background.beginFill(0x0, 0.5);\r\n                background.drawRect(0, 0, 960, 540);\r\n                background.endFill();\r\n                background.name = 'background';\r\n                background.inputEnabled = true;\r\n\r\n                let style = { font: \"16px 宋体\", fill: \"#fff\", boundsAlignH: \"center\", boundsAlignV: \"middle\" };\r\n\t\t\t\tlet text = this.viewComponent.game.add.text(0, 0, \"\", style, group);\r\n\t\t\t\ttext.setTextBounds(0, 0, 960, 540);\r\n\t\t\t\ttext.name = 'chapterInfoProgressText';\r\n            }\r\n            let txt = group.getByName('chapterInfoProgressText');\r\n            if (txt) {\r\n            \ttxt.text = '章节信息获取中...' + prgsInfo;\r\n\t\t\t}\r\n        },\r\n\r\n\t\tcheckIfChapterFree: function (chapterUuid, chapterMd5) {\r\n            const getData = (url, d) => {\r\n            \tconst progress = evt => {\r\n            \t\tif(this.isGameStarted !== true){this.chapterInfoProgress(evt.loaded)};\r\n\t\t\t\t}\r\n                return Xhr.xhrSend(url, d, progress).then(rs => {\r\n                    let group = this.viewComponent.game.world.getByName('chapterInfoProgress');\r\n                    if (group) {\r\n                    \tgroup.destroy();\r\n\t\t\t\t\t}\r\n                    if (rs.responseText.length === 0) {\r\n                        return Promise.reject('Get chapterInfo failed, no response data');\r\n                    }\r\n                    let retData = JSON.parse(rs.responseText);\r\n                    if (retData.code === '100') {\r\n                        return Promise.resolve(retData.result.plots);\r\n                    }\r\n                    else if (flashvars.offline == 1) {\r\n                        return Promise.resolve(retData.plots);\r\n                    }\r\n                    else {\r\n                        return Promise.reject(retData.message + ' code=' + retData.code);\r\n                    }\r\n                }, rj => {\r\n                    let group = this.viewComponent.game.world.getByName('chapterInfoProgress');\r\n                    if (group) {\r\n                        group.destroy();\r\n                    }\r\n                    return Promise.reject(rj);\r\n                });\r\n            };\r\n            if (!flashvars.u && !flashvars.token) {\r\n            \tflashvars.uid = Utils.getUidByCookie();\r\n\t\t\t}\r\n\t\t\tlet data = 'uuid=' + flashvars.uuid + '&uid=' + flashvars.uid + '&chapter_uuid=' + chapterUuid + '&md5=' + chapterMd5 + '&platform=' + (flashvars.client ? 'app' : 'pc');\r\n            let url = 'https://mapi.3000api.com/apis/soft/v1.0/chapter-chapterInfo.html?' + data;\r\n            return getData(url, data);\r\n        },\r\n\r\n        unlockChapter: function (uuid, charge, md5, callBack) {\r\n            if (flashvars.app_version < '1.2.0') {\r\n                Dialog.info('该章节为付费章节，当前版本过低，不支持该功能');\r\n                callBack(false, true);\r\n                return;\r\n            }\r\n            let discounts = -1;\r\n            this.getDiscounts(flashvars.uuid, uuid, null, 'app').then(info => {\r\n            \tif (typeof info !== 'string') {\r\n            \t\tcharge = info.charge;\r\n                    discounts = info.special_price;\r\n\t\t\t\t}\r\n\r\n                if (flashvars.client === 'ios') {\r\n                    let unlockArg = {gid: flashvars.gid, uuid: uuid, charge: charge, md5: md5, special_price: discounts};\r\n                    this.unlockChapterCallBack = callBack;\r\n                    if(flashvars.offline == 1){\r\n                        javascript:unlock(JSON.stringify(unlockArg));\r\n                    }else{\r\n                        window.webkit && window.webkit.messageHandlers.unlock.postMessage(JSON.stringify(unlockArg));\r\n                    }\r\n                }\r\n                else if (flashvars.client === 'android') {\r\n                    window.app && window.app.unlock(flashvars.gid, uuid, charge, md5); // 解锁\r\n                    this.unlockChapterCallBack = callBack;\r\n                }\r\n            });\r\n        },\r\n\r\n\t\tgetPhoneData: function () {\r\n            let u = encodeURIComponent(Utils.aesEncrypt(flashvars.u, 1));\r\n            let token = encodeURIComponent(Utils.aesEncrypt(flashvars.token, 1));\r\n            let app_name = encodeURIComponent(Utils.aesEncrypt(flashvars.app_name === '' ? 'shanyi' : flashvars.app_name, 1));\r\n            let device_name = encodeURIComponent(Utils.aesEncrypt(flashvars.device_name === '' ? 'Google Nexus S' : flashvars.device_name, 1));\r\n            let deviceOsVer = encodeURIComponent(Utils.aesEncrypt(flashvars.deviceOsVer === '' ? '4.1.1' : flashvars.deviceOsVer, 1));\r\n\r\n            return '&u=' + u + '&token=' + token + '&app_name=' + app_name\r\n                + '&device_name=' + device_name + '&device_system_version=' + deviceOsVer;\r\n        },\r\n\r\n\t\tloadCloudRecord: function (index) {\r\n\t\t\tconst getData = (url, d) => {\r\n\t\t\t\treturn Xhr.xhrSend(url, d).then(rs => {\r\n\t\t\t\t\tif (rs.responseText.length === 0) {\r\n\t\t\t\t\t\treturn Promise.reject('Get file failed, no response data');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet retData = JSON.parse(rs.responseText);\r\n\t\t\t\t\tif (retData.status === 0) {\r\n                        let encrypted = retData.data.content || '';\r\n                        let decrypted = Utils.decryptBase64(encrypted);\r\n                        return Promise.resolve(decrypted);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treturn Promise.reject(retData.msg + ' - status:' + retData.status);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, rj => {\r\n\t\t\t\t\treturn Promise.reject(rj);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n            let aesKeyType = flashvars.u && flashvars.token ? 1 : 0;\r\n\t\t\tlet stime = Math.floor((new Date()).getTime() / 1000) + Utils.timeOffset;\r\n\t\t\tlet gid = flashvars.gid === '' ? 1 : parseInt(flashvars.gid);\r\n            let sSign = '';\r\n            let type = index + '';\r\n\r\n            if (aesKeyType) {\r\n                sSign = 'app_name=' + (flashvars.app_name === '' ? 'shanyi' : flashvars.app_name)\r\n\t\t\t\t\t\t+ '&device_name=' + (flashvars.device_name === '' ? 'Google Nexus S' : flashvars.device_name)\r\n\t\t\t\t\t\t+ '&device_system_version=' + (flashvars.deviceOsVer === '' ? '4.1.1' : flashvars.deviceOsVer)\r\n\t\t\t\t\t\t+ '&gid=' + gid + '&time=' + stime + '&token=' + flashvars.token + '&type=' + type + '&u=' + flashvars.u\r\n\t\t\t\t\t\t+ '&v_key=shanyi_WDF#$H*#SJN*&G$&**';\r\n            }\r\n            else {\r\n                sSign = 'gid=' + gid + '&time=' + stime + '&type=' + type + '&v_key=0GjRAtUUoK4BwJGUz73jBa2M';\r\n            }\r\n\r\n\t\t\tgid = Utils.aesEncrypt(gid, aesKeyType);\r\n\t\t\tsSign = Utils.aesEncrypt(MD5.hash(MD5.hash(sSign)), aesKeyType);\r\n\t\t\tstime = Utils.aesEncrypt(stime, aesKeyType);\r\n\t\t\ttype = Utils.aesEncrypt(type, aesKeyType);\r\n\r\n            let url = 'https://my.3000.com/?m=cloud_save&op=index&ac=info&client_type=1&api_v=1.0.0&api_from=webpc';\r\n            let data = 'gid=' + encodeURIComponent(gid) + '&sign=' + encodeURIComponent(sSign) + '&time=' + encodeURIComponent(stime) + '&type=' + encodeURIComponent(type);\r\n\r\n\t\t\tif (flashvars.u !== '' && flashvars.token !== '') {\r\n                url = 'https://app.3000.com/?m=cloud_save&op=index&ac=info&client=' + flashvars.client +'&v=' + flashvars.v + '&app_version=' + flashvars.app_version;\r\n                data += this.getPhoneData();\r\n\t\t\t}\r\n\r\n\t\t\treturn getData(url, data);\r\n        },\r\n\r\n\t\tsaveCloudRecord: function (index) {\r\n            const sendData = (url, d) => {\r\n                return Xhr.xhrSend(url, d).then(rs => {\r\n                    if (rs.responseText.length === 0) {\r\n                        return Promise.reject('Save file failed, no response data');\r\n                    }\r\n                    let retData = JSON.parse(rs.responseText);\r\n                    if (retData.status === 0) {\r\n                        return Promise.resolve();\r\n                    }\r\n                    else {\r\n                        return Promise.reject(retData.msg + ': ' + retData.status);\r\n                    }\r\n                }, rj => {\r\n                    return Promise.reject(rj);\r\n                });\r\n            };\r\n\r\n            let aesKeyType = flashvars.u && flashvars.token ? 1 : 0;\r\n            const str = JSON.stringify(this.savedPlotsData[index]);\r\n            const strBase64 = Utils.encodeBase64(str);\r\n            const stime = Math.floor((new Date()).getTime() / 1000) + Utils.timeOffset;\r\n            const gid = flashvars.gid === '' ? 1 : parseInt(flashvars.gid);\r\n            let\tsSign = '';\r\n\r\n            if (aesKeyType) {\r\n                sSign = 'app_name=' + (flashvars.app_name === '' ? 'shanyi' : flashvars.app_name)\r\n\t\t\t\t\t+ '&content=' + strBase64\r\n                    + '&device_name=' + (flashvars.device_name === '' ? 'Google Nexus S' : flashvars.device_name)\r\n                    + '&device_system_version=' + (flashvars.deviceOsVer === '' ? '4.1.1' : flashvars.deviceOsVer)\r\n\t\t\t\t\t+ '&gid=' + gid + '&progress=1&time=' + stime + '&token=' + flashvars.token + '&type=' + index + '&u=' + flashvars.u\r\n\t\t\t\t\t+ '&v_key=shanyi_WDF#$H*#SJN*&G$&**';\r\n            }\r\n            else {\r\n                sSign = 'content=' + strBase64 + '&gid=' + gid + '&progress=1&time=' + stime + '&type=' + index + '&v_key=0GjRAtUUoK4BwJGUz73jBa2M';\r\n            }\r\n\r\n            let url = 'https://my.3000.com/?m=cloud_save&op=index&ac=save&client_type=1&api_v=1.0.0&api_from=webpc';\r\n            let data = 'content=' + encodeURIComponent(Utils.aesEncrypt(strBase64, aesKeyType))\r\n                + '&gid=' + encodeURIComponent(Utils.aesEncrypt(gid, aesKeyType))\r\n                + '&progress=' + encodeURIComponent(Utils.aesEncrypt(1, aesKeyType))\r\n                + '&sign=' + encodeURIComponent(Utils.aesEncrypt(MD5.hash(MD5.hash(sSign)), aesKeyType))\r\n                + '&time=' + encodeURIComponent(Utils.aesEncrypt(stime, aesKeyType))\r\n                + '&type=' + encodeURIComponent(Utils.aesEncrypt(index+'', aesKeyType));\r\n\r\n            if (flashvars.u !== '' && flashvars.token !== '') {\r\n                url = 'https://app.3000.com/?m=cloud_save&op=index&ac=save&client=' + flashvars.client +'&v=' + flashvars.v + '&app_version=' + flashvars.app_version;\r\n                data += this.getPhoneData();\r\n            }\r\n\r\n            return sendData(url, data);\r\n        },\r\n\r\n        getViewData: function(items, subView) {\r\n            let view = {};\r\n            const visitChild = (children, parent) => {\r\n                for (let i=0; i<children.length; i++) {\r\n                    if (!children[i].xInfo || !children[i].yInfo) {\r\n                        continue;\r\n                    }\r\n                    let child = {name:children[i].name, instanceUuid:children[i].instanceUuid, xInfo:children[i].xInfo, yInfo:children[i].yInfo\r\n\t\t\t\t\t\t, eventsInfo: children[i].eventsInfo, scale:children[i].scale, visible:children[i].visible};\r\n                    child.children = [];\r\n                    if (children[i].viewType === 'TIMER') {\r\n                        view.currentCount = children[i].currentCount;\r\n                    }\r\n                    visitChild(children[i].children, child);\r\n                    parent.children.push(child);\r\n                }\r\n            };\r\n            for (let i=0; items && i<items.length; i++) {\r\n                if (!items[i].parent) {\r\n                    continue;\r\n                }\r\n                view = {name:items[i].name, instanceUuid:items[i].instanceUuid, xInfo:items[i].xInfo, yInfo:items[i].yInfo, eventsInfo:items[i].eventsInfo\r\n\t\t\t\t\t, scale:items[i].scale, parent:items[i].parent.name, x: items[i].x, y: items[i].y, visible:items[i].visible};\r\n                view.children = [];\r\n                if (items[i].viewType === 'TIMER') {\r\n                \tview.currentCount = items[i].currentCount;\r\n\t\t\t\t}\r\n\t\t\t\tif (items[i].generateType) {\r\n                \tview.generateType = items[i].generateType;\r\n\t\t\t\t}\r\n                visitChild(items[i].children, view);\r\n                subView.push(view);\r\n            }\r\n        },\r\n\r\n        getViewParentEvents: function(ref) {\r\n            const viewMap = this.json_data.viewMap;\r\n            for (let i in viewMap) {\r\n                if (i === ref) {\r\n                    return viewMap[i].events.concat();\r\n                }\r\n                else {\r\n                    for (let j in viewMap.children) {\r\n                        if (viewMap.children[j].ref === ref) {\r\n                            return viewMap.children[j].events.concat();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        copyFlashViewData: function(src, commandObj) {\r\n            let bVisible = true;\r\n            if (commandObj && commandObj.historyCommand && commandObj.historyCommand.hideGlobalViews) {\r\n                for (let v=0; v<commandObj.historyCommand.hideGlobalViews.length; v++) {\r\n                    if (src.instanceUuid === commandObj.historyCommand.hideGlobalViews[v]) {\r\n                        bVisible = false;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            let dest = {name: src.ref\r\n                , instanceUuid: src.instanceUuid\r\n                , xInfo: Object.prototype.toString.apply(src.x) === '[object Object]' ? src.x : {type: 'literal', value: src.x}\r\n                , yInfo: Object.prototype.toString.apply(src.y) === '[object Object]' ? src.y : {type: 'literal', value: src.y}\r\n                , scale: {x: src.scale, y: src.scale, type: 25}\r\n                , visible: bVisible};\r\n            src.currentCount && (dest.currentCount = src.currentCount);\r\n            dest.children = [];\r\n            for (let n=0; n<src.children.length; n++) {\r\n                dest.children[n] = this.copyFlashViewData(src.children[n], commandObj);\r\n                dest.children[n].eventsInfo = this.getViewParentEvents(src.ref);\r\n            }\r\n            return dest;\r\n        },\r\n\r\n\t\tgetWeatherType: function() {\r\n            if (!this.weatherLayer.visible) {\r\n                return '';\r\n            }\r\n            let w = this.weatherLayer.getByName('wind');\r\n            if (w && w.visible) {\r\n                return 'wind';\r\n            }\r\n            w = this.weatherLayer.getByName('snow');\r\n            if (w && w.visible) {\r\n                return 'snow';\r\n            }\r\n            w = this.weatherLayer.getByName('rain');\r\n            if (w && w.visible) {\r\n                return 'rain';\r\n            }\r\n            return '';\r\n        },\r\n\r\n\t\tsaveRecord: function (index, auto) {\r\n\t\t\t// 保存进度\r\n\t\t\tif (index === 0 && this.json_data.default_settings.autoSaveOrLoad && !auto) {\r\n\t\t\t\treturn Promise.resolve(null);\r\n\t\t\t}\r\n\t\t\t!this.savedPlotsData && this.loadData();\r\n\t\t\tconst timestamp = Date.now();\r\n\r\n\t\t\tlet globalViews = [];\r\n\t\t\tlet plotViews = [];\r\n\t\t\tlet chAndProps = [];\r\n            this.getViewData(this.globalViews, globalViews);\r\n            this.getViewData(this.plotViews, plotViews);\r\n\r\n\t\t\tconst saveData = {};\r\n\t\t\tsaveData.plotUuid = this.curChapter.plots[this.curPlotIndex].uuid;\r\n\t\t\tsaveData.chapterUuid = this.curChapter.uuid;\r\n\t\t\tsaveData.bkKey = this.lstPlotBkKey;\r\n\t\t\tsaveData.bkOpacity = this.lstPlotBkOpacity;\r\n\t\t\tsaveData.bkFlex = this.lstPlotBkFlex;\r\n\t\t\tsaveData.cmdUuid = this.curCmdUuid;\r\n\t\t\tsaveData.bCmdAutoText = this.bCmdAutoText;\r\n\t\t\tsaveData.timestamp = timestamp;\r\n\t\t\tsaveData.context = JSON.parse(JSON.stringify(this.context));\r\n\t\t\tsaveData.plotSnap = this.plotSnap;\r\n\t\t\tsaveData.weatherType = this.getWeatherType();\r\n\t\t\tsaveData.globalViews = globalViews.concat();\r\n\t\t\tsaveData.plotViews = plotViews.concat();\r\n            saveData.playbackData = this.playbackData.concat();\r\n\r\n            if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n\t\t\t\tsaveData.music = {url: PhoneUtils.musicInfo.key, volume: PhoneUtils.musicInfo.volume};\r\n\t\t\t\tsaveData.sounds = PhoneUtils.soundsInfo.map(s => {\r\n\t\t\t\t\tif (s.key) {\r\n\t\t\t\t\t\treturn {url: s.key, volume: s.value, time: s.loop ? 0 : 1}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n                saveData.music = {url: this.bk_music && this.bk_music.key, volume: this.bk_music && this.bk_music.volume};\r\n                saveData.sounds = this.plotSounds.map(s => {\r\n                    if (s) {\r\n                        return {\r\n                            url: s.key,\r\n                            volume: s.volume,\r\n                            time: s.loop ? 0 : 1\r\n                        }\r\n                    }\r\n                    return null;\r\n                });\r\n\t\t\t}\r\n\r\n            if (this.curCmdUuid !== '') {\r\n                this.charsAndPropsLayer && this.charsAndPropsLayer.children.forEach(g => {\r\n                    let c = g.children[0];\r\n                    let item = {url:c.key, x:c.x, y:c.y, width:c.width, height:c.height, opacity: c.alpha, pivotX: c.pivot.x, pivotY: c.pivot.y\r\n                        , scaleX:c.scale.x, scaleY:c.scale.y, rotate:c.angle, cmdUuid:c.cmdUuid, index:g.zIndex, parentScale: g.scale.x};\r\n\r\n                    if (c.finalState) {\r\n                    \titem.x = c.finalState.x;\r\n                    \titem.y = c.finalState.y;\r\n                    \titem.opacity = c.finalState.alpha;\r\n                    \titem.rotate = c.finalState.angle\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (g.finalState) {\r\n                    \titem.parentScale = g.finalState.scale.x;\r\n\t\t\t\t\t}\r\n                    chAndProps.push(item);\r\n                });\r\n\r\n                let bk = this.curPlotLayer.children[1];\r\n                saveData.bk = {};\r\n                if (bk) {\r\n                    saveData.bk = {url: bk.key, opacity: bk.alpha};\r\n                    bk.finalState && (saveData.bk.opacity = bk.finalState.alpha);\r\n                }\r\n\t\t\t}\r\n\r\n            saveData.charsAndProps = chAndProps.concat();\r\n            saveData.dialogInfo = this.lstDialogInfo.concat();\r\n            saveData.menuInfo = this.menuInfo.concat();\r\n\t\t\tthis.savedPlotsData[index] = JSON.parse(JSON.stringify(saveData));\r\n            this.bSignedIn && this.bCloudSel && (this.cloudPlotsData[index] = JSON.parse(JSON.stringify(saveData)));\r\n            return this.saveData(index, auto).then(rs => {return Promise.resolve(saveData)}, rj => {return Promise.resolve(null)});\r\n\t\t},\r\n\r\n\t\tloadRecord: function (index) {\r\n\t\t\t!this.savedPlotsData && this.loadData();\r\n\t\t\tconst {plotUuid, chapterUuid, context, playbackData} = this.savedPlotsData[index];\r\n            const goRecord = (nChapter, nPlot) => {\r\n                this.destroyAll();\r\n                this.lstPlotBkKey = this.savedPlotsData[index].bkKey;\r\n                this.lstPlotBkOpacity = this.savedPlotsData[index].bkOpacity;\r\n                this.lstPlotBkFlex = this.savedPlotsData[index].bkFlex;\r\n                this.globalViews = this.savedPlotsData[index].globalViews.concat();\r\n                this.plotViews = this.savedPlotsData[index].plotViews.concat();\r\n                this.charsAndPropsInfo = this.savedPlotsData[index].charsAndProps.concat();\r\n                this.lstDialogInfo = this.savedPlotsData[index].dialogInfo ? this.savedPlotsData[index].dialogInfo.concat() : [];\r\n                this.menuInfo = this.savedPlotsData[index].menuInfo ? this.savedPlotsData[index].menuInfo.concat() : [];\r\n                this.curCmdUuid = this.savedPlotsData[index].cmdUuid;\r\n                this.bCmdAutoText = this.savedPlotsData[index].bCmdAutoText;\r\n                this.visibleLayout[0] && (this.visibleLayout[0].visible = true);\r\n                this.visibleLayout = this.visibleLayout.slice(1);\r\n                this.recordLayer.visible = false;\r\n                this.mainMenuLayer.visible = false;\r\n                this.endLayer.visible = false;\r\n                this.onResume();\r\n                this.removePlotTweens();\r\n                playbackData.forEach(d => this.addPlayBackContent(d));\r\n                let cmdPlotSnap = {};\r\n                if (this.curCmdUuid) {\r\n                    cmdPlotSnap = this.getCommandByCommandUuid(chapter.plots[nPlot], this.curCmdUuid);\r\n                    cmdPlotSnap.cmdScreenSnap = {charsAndProps: this.charsAndPropsInfo\r\n                        , sounds: this.savedPlotsData[index].sounds\r\n                        , music: this.savedPlotsData[index].music\r\n                        , plotViews: this.plotViews\r\n                        , dialogInfo: this.lstDialogInfo\r\n                        , menuInfo: this.menuInfo\r\n                        , bk: this.savedPlotsData[index].bk\r\n                        , weatherType: this.savedPlotsData[index].weatherType};\r\n                }\r\n\r\n                this.initContext(context, true);\r\n                context.commandInserts && (this.context.commandInserts = context.commandInserts.concat());\r\n\t\t\t\tconst loadData = {\r\n\t\t\t\t\tmusic: this.savedPlotsData[index].music,\r\n\t\t\t\t\tsounds: this.savedPlotsData[index].sounds,\r\n\t\t\t\t\tcharsAndProps: this.charsAndPropsInfo,\r\n\t\t\t\t\tbackground: this.lstPlotBkKey,\r\n\t\t\t\t\timages: [this.lstDialogInfo && this.lstDialogInfo[0] ? { url: this.lstDialogInfo[0].avatar.url } : {}],\r\n\t\t\t\t};\r\n                this.preloadChapterAssets(this.context, nChapter, nPlot, cmdPlotSnap, loadData);\r\n                this.coverLayer.visible = false;\r\n                !this.isGameStarted && this.notifyGameStarted();\r\n            };\r\n            const goRecordHandle = (chapter, index) => {\r\n            \tif (index < 0) {\r\n            \t\tconst {chapter:c, index:i} = this.getChapterByPlotUuid(this.json_data, plotUuid, chapterUuid);\r\n            \t\tgoRecord(c, i);\r\n\t\t\t\t} else {\r\n                    goRecord(chapter, index);\r\n                }\r\n\t\t\t};\r\n            if (!plotUuid) {\r\n                return false;\r\n            }\r\n\r\n\t\t\tconst {chapter, index: n} = this.getChapterByPlotUuid(this.json_data, plotUuid, chapterUuid);\r\n            if (chapter && chapter.md5 && chapter.plots.length === 0) {\r\n            \tconst chapterUuid = chapter.downloadUuid ? chapter.downloadUuid : chapter.uuid;\r\n                if (chapter.charge && ('android' === flashvars.client || 'ios' === flashvars.client)) {\r\n                    const unlockFinish = (bSuccess) => {\r\n                        if (bSuccess) {\r\n                            this.checkIfChapterFree(chapterUuid, chapter.md5).then((plots)=>{\r\n                                this.unlockChapterCallBack = null;\r\n                                chapter.plots = plots;\r\n                                goRecordHandle(chapter, n);\r\n                            }, () => Dialog.error('获取付费章节信息失败'))\r\n                        }\r\n                    };\r\n\r\n                    this.unlockChapter(chapterUuid, chapter.charge, chapter.md5, unlockFinish);\r\n                } else {\r\n                    this.checkIfChapterFree(chapterUuid, chapter.md5).then((plots)=>{\r\n                        chapter.plots = plots;\r\n                        goRecordHandle(chapter, n);\r\n                    }, (msg)=>{\r\n                        if (-1 === msg.indexOf('code=87')) {\r\n                            Dialog.error(msg);\r\n                        } else { // 未购买此章节\r\n                            Dialog.info('当前为收费章节，请前往闪艺app或电脑端进行购买');\r\n                        }\r\n                    })\r\n\t\t\t\t}\r\n            } else if (chapter && -4 !== n) {\r\n                goRecord(chapter, n);\r\n            }\r\n            return true;\r\n\t\t},\r\n\r\n\t\tonRecordItemClicked: function (iCol, iRow) {\r\n\t\t\tconst index = iRow * 4 + iCol;\r\n\r\n            if (flashvars.u==='' && flashvars.token==='' && flashvars.client==='') {\r\n                let uid = Utils.getUidByCookie();\r\n                flashvars.uid = uid;\r\n            }\r\n\r\n\t\t\tif (this.bToSaveFile) {\r\n                if ((this.gameUidBelongTo === this.recUidBelongTo || this.gameUidBelongTo === '') && this.recUidBelongTo === flashvars.uid) {\r\n                    this.saveRecord(index).then(saveData => {\r\n                        if (!saveData) {\r\n                            return false;\r\n                        }\r\n                        const item = this.recordLayer.getByName('scrollPane').children.find(c => c.name === `recordItem_${index}`);\r\n                        const itemContent = item.getByName('content');\r\n                        const itemTime = item.getByName('textTime');\r\n\r\n                        const setPreviewImage = key => {\r\n                            const {width, height} = itemContent;\r\n                            itemContent.loadTexture(key);\r\n                            itemContent.width = width;\r\n                            itemContent.height = height;\r\n                        };\r\n                        const snapMd5 = MD5.hash(saveData.plotSnap);\r\n                        if (!this.viewComponent.game.load.cache.checkImageKey(snapMd5)) {\r\n                            this.addImageUrl(saveData.plotSnap, snapMd5).then(() => setPreviewImage(snapMd5));\r\n                        } else {\r\n                            setPreviewImage(snapMd5);\r\n                        }\r\n                        const strText = Utils.getCurrentDateTime(saveData.timestamp);\r\n                        if (FontUtils.fontFamily) {\r\n                            const fh = this.json_data.font.size ? this.toRealImageFontHeight(itemTime.fontSize) : itemTime.fontSize;\r\n                            const fw = this.json_data.font.size ? this.toRealImageFontWidth(itemTime.fontSize) : itemTime.fontSize;\r\n                        \tthis.addImageFontText([{data:strText}], fw, fh, itemTime, this.context);\r\n                            itemTime.text = ' ';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n                        \titemTime.text = strText;\r\n\t\t\t\t\t\t}\r\n                    });\r\n                } else {\r\n                    Dialog.info('存档失败，请登录正确的账号后重新尝试');\r\n                }\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (this.recUidBelongTo === flashvars.uid) {\r\n\t\t\t\t\tthis.gameUidBelongTo = this.recUidBelongTo;\r\n\t\t\t\t\tif (this.savedPlotsData && this.savedPlotsData[index].plotUuid && !this.savedPlotsData[index].context) {\r\n\t\t\t\t\t\t// 说明是云存档数据 且还未获取存档内容\r\n\t\t\t\t\t\tthis.loadCloudRecord(index).then(rs => {\r\n                            const convertCloudData = (data) => {\r\n                                let cdata = JSON.parse(data);\r\n\r\n                                if (cdata.context) {\r\n                                    this.savedPlotsData[index] = cdata;\r\n                                }\r\n                                else {\r\n                                    this.savedPlotsData[index].plotUuid = cdata.plotUuid;\r\n                                    this.savedPlotsData[index].chapterUuid = cdata.chapterUuid ? cdata.chapterUuid : undefined;\r\n                                    this.savedPlotsData[index].bkKey = cdata.backgroundObject ? cdata.backgroundObject.url : null;\r\n                                    //let ttt = cdata.date + ' ' + cdata.time;\r\n                                    //let arr = ttt.split(/[- : \\/]/);\r\n                                    //let ss = new Date(arr[0], arr[1]-1, arr[2], arr[3], arr[4], arr[5]);\r\n                                    //this.savedPlotsData[index].timestamp = Date.parse(ss);\r\n                                    //this.savedPlotsData[index].plotSnap = 'data:image/jpeg;base64,' + cdata.thumb;\r\n                                    this.savedPlotsData[index].context = {};\r\n                                    this.savedPlotsData[index].context.auto = false;\r\n                                    this.savedPlotsData[index].context.fullScreen = false;\r\n                                    this.savedPlotsData[index].context.values = [];\r\n                                    this.savedPlotsData[index].context.savedValues = [];\r\n                                    this.savedPlotsData[index].context.stringValues = [];\r\n                                    this.savedPlotsData[index].context.indexValues = [];\r\n                                    for (let j=0; j<cdata.values.length; j++) {\r\n                                        if (cdata.values[j].saved) {\r\n                                            let vi = this.savedPlotsData[index].context.savedValues.length;\r\n                                            for (let n=0; n<this.json_data.savedValues.length; n++) {\r\n                                                if (this.json_data.savedValues[n].uuid === cdata.values[j].key) {\r\n                                                    vi = n;\r\n                                                    break;\r\n                                                }\r\n                                            }\r\n                                            this.savedPlotsData[index].context.savedValues[vi] = {uuid: cdata.values[j].key\r\n                                                , name: cdata.values[j].name\r\n                                                , init: cdata.values[j].init\r\n                                                , value: cdata.values[j].value };\r\n                                        }\r\n                                        else if (cdata.values[j].index) {\r\n                                            let vi = this.savedPlotsData[index].context.indexValues.length;\r\n                                            for (let n=0; n<this.json_data.indexValues.length; n++) {\r\n                                                if (this.json_data.indexValues[n].uuid === cdata.values[j].key) {\r\n                                                    vi = n;\r\n                                                    break;\r\n                                                }\r\n                                            }\r\n                                            this.savedPlotsData[index].context.indexValues[vi] = {uuid: cdata.values[j].key\r\n                                                , name: cdata.values[j].name\r\n                                                , init: cdata.values[j].init\r\n                                                , value: cdata.values[j].value };\r\n\t\t\t\t\t\t\t\t\t\t}\r\n                                        else if (cdata.values[j].init && cdata.values[j].init.type === 'string') {\r\n                                            let vi = this.savedPlotsData[index].context.stringValues.length;\r\n                                            for (let n=0; n<this.json_data.stringValues.length; n++) {\r\n                                                if (this.json_data.stringValues[n].uuid === cdata.values[j].key) {\r\n                                                    vi = n;\r\n                                                    break;\r\n                                                }\r\n                                            }\r\n                                            this.savedPlotsData[index].context.stringValues[vi] = {uuid: cdata.values[j].key\r\n                                                , name: cdata.values[j].name\r\n                                                , init: cdata.values[j].init\r\n                                                , value: cdata.values[j].value };\r\n                                        }\r\n                                        else if (cdata.values[j].key && cdata.values[j].key[2] !== '_' && !cdata.values[j].pay){\r\n                                            let vi = this.savedPlotsData[index].context.values.length;\r\n                                            for (let n=0; n<this.json_data.values.length; n++) {\r\n                                                if (this.json_data.values[n].uuid === cdata.values[j].key) {\r\n                                                    vi = n;\r\n                                                    break;\r\n                                                }\r\n                                            }\r\n                                            this.savedPlotsData[index].context.values[vi] = {uuid: cdata.values[j].key\r\n                                                , name: cdata.values[j].name\r\n                                                , init: cdata.values[j].init\r\n                                                , value: cdata.values[j].value };\r\n                                        }\r\n                                    }\r\n                                    this.savedPlotsData[index].context.stack = (cdata.stack || []).concat();\r\n                                    this.savedPlotsData[index].context.cmdStack = (cdata.cmdStack || []).concat();\r\n                                    this.savedPlotsData[index].globalViews = [];\r\n                                    this.savedPlotsData[index].plotViews = [];\r\n                                    for (let j=0; j<cdata.globalViewsData.length; j++) {\r\n                                        this.savedPlotsData[index].globalViews[j] = this.copyFlashViewData(cdata.globalViewsData[j], cdata.commandObj);\r\n                                        this.savedPlotsData[index].globalViews[j].x = this.Expression.safeEval(cdata.globalViewsData[j].x, this.savedPlotsData[index].context) * (1 - cdata.globalViewsData[j].scale);\r\n                                        this.savedPlotsData[index].globalViews[j].y = this.Expression.safeEval(cdata.globalViewsData[j].y, this.savedPlotsData[index].context) * (1 - cdata.globalViewsData[j].scale);\r\n                                        this.savedPlotsData[index].globalViews[j].parent = '__world';\r\n                                    }\r\n                                    for (let j=0; j<cdata.viewsData.length; j++) {\r\n                                        this.savedPlotsData[index].plotViews[j] = this.copyFlashViewData(cdata.viewsData[j], cdata.commandObj);\r\n                                        this.savedPlotsData[index].plotViews[j].x = this.Expression.safeEval(cdata.viewsData[j].x, this.savedPlotsData[index].context) * (1 - cdata.viewsData[j].scale);\r\n                                        this.savedPlotsData[index].plotViews[j].y = this.Expression.safeEval(cdata.viewsData[j].y, this.savedPlotsData[index].context) * (1 - cdata.viewsData[j].scale);\r\n                                        this.savedPlotsData[index].plotViews[j].parent = 'plotViewsLayer';\r\n                                    }\r\n                                    this.savedPlotsData[index].music = cdata.musics[0] ? {url: cdata.musics[0].url, volume: cdata.musics[0].volume} : {};\r\n                                    this.savedPlotsData[index].sounds = cdata.sounds.concat();\r\n                                    this.savedPlotsData[index].playbackData = cdata.speakings.concat();\r\n                                    this.savedPlotsData[index].bk = {};\r\n                                    this.savedPlotsData[index].charsAndProps = [];\r\n                                    this.savedPlotsData[index].dialogInfo = [];\r\n                                    this.savedPlotsData[index].cmdUuid = '';\r\n                                    this.savedPlotsData[index].weatherType = '';\r\n                                    this.savedPlotsData[index].bCmdAutoText = false;\r\n                                    if (cdata.commandObj && cdata.commandObj.historyCommand) {\r\n                                        let {images, dialog, autoText, weather} = cdata.commandObj.historyCommand;\r\n                                        //this.savedPlotsData[index].bk = cdata.backgroundObject ? {url: cdata.backgroundObject.url, opacity: cdata.backgroundObject.opacity} : {};\r\n                                        this.savedPlotsData[index].cmdUuid = cdata.commandObj.commandUuid;\r\n                                        this.savedPlotsData[index].bCmdAutoText = autoText ? autoText.args[0] : false;\r\n                                        this.savedPlotsData[index].dialogInfo = dialog && dialog.command ? dialog.command.args : [];\r\n                                        this.savedPlotsData[index].weatherType = weather && weather.args[0];\r\n                                        if (images) {\r\n                                            for (let v=0; v<images.length; v++) {\r\n                                                if (images[v].index > 1) {\r\n                                                    let item = {url:images[v].url, x:images[v].x, y:images[v].y, width:images[v].width, height:images[v].height, opacity: images[v].opacity\r\n                                                        , rotate:images[v].rotate, index:images[v].index};\r\n                                                    this.savedPlotsData[index].charsAndProps.push(item);\r\n                                                }\r\n                                                else if (images[v].index === 1) {\r\n                                                \tthis.savedPlotsData[index].bk = {url:images[v].url, opacity:images[v].opacity};\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                    if (cdata.commandInserts && cdata.commandInserts.length) {\r\n                                    \t// 高级剧情有插播\r\n                                    \tthis.savedPlotsData[index].context.commandInserts = cdata.commandInserts.concat();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tthis.cloudPlotsData[index] = JSON.parse(JSON.stringify(this.savedPlotsData[index]));\r\n                                }\r\n\t\t\t\t\t\t\t};\r\n\r\n                            convertCloudData(rs);\r\n                            this.loadRecord(index);\r\n                            this.showMenu();\r\n\t\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\t\tDialog.error('获取存档数据失败')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n                        this.loadRecord(index);\r\n                        this.showMenu();\r\n                    }\r\n                } else {\r\n\t\t\t\t\tDialog.info('读档失败，请登录正确的账号后重新尝试');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tonPlaybackBackBtnClicked: function () {\r\n\t\t\tthis.visibleLayout[0] && (this.visibleLayout[0].visible = true);\r\n            if (this.visibleLayout[0] !== this.mainMenuLayer) {\r\n                this.onResume();\r\n            }\r\n            this.playBackLayer.removeAll(true);\r\n\t\t\tthis.visibleLayout = this.visibleLayout.slice(1);\r\n\t\t\tthis.playBackLayer.visible = false;\r\n\t\t},\r\n\r\n\t\taddPlayBackContent: function (data) {\r\n\t\t\tthis.sendNotification(diygamePlayer.AppConstants.ADD_PLAYBACK_CONTENT, data);\r\n\t\t},\r\n\r\n\t\tshowLoadingToast: function (type) {\r\n\t\t\tif (1 === type) {\r\n\t\t\t\tthis.loadingToastLayer.visible = true;\r\n                this.viewComponent.game.world.bringToTop(this.loadingToastLayer);\r\n\t\t\t}\r\n\t\t\telse if (0 === type) {\r\n                this.loadingToastLayer.visible = false;\r\n\t\t\t}\r\n        },\r\n\r\n        showToast: function (type, text) {\r\n            let ss = this.toastLayer.getByName('typeSuccess');\r\n            let ee = this.toastLayer.getByName('typeError');\r\n            if (ss) {\r\n                if (0 === type) {\r\n                    ss.visible = true;\r\n                    ss.children[2].text = text;\r\n                    ss.children[0].width = ss.children[2].width + 36;\r\n                    ss.x = (960 - ss.children[0].width) / 2;\r\n                    ss.y = 252;\r\n                } else {\r\n                    ss.visible = false;\r\n                }\r\n            }\r\n            if (ee) {\r\n                if (1 === type) {\r\n                    ee.visible = true;\r\n                    ee.children[2].text = text;\r\n                    ee.children[0].width = ee.children[2].width + 36;\r\n                    ee.children[1].visible = true;\r\n                    ee.children[2].x = 30;\r\n                    ee.x = (960 - ee.children[0].width) / 2;\r\n                    ee.y = 252;\r\n                } else if (2 === type) {\r\n                    ee.visible = true;\r\n                    ee.children[2].text = text;\r\n                    ee.children[0].width = ee.children[2].width + 20;\r\n                    ee.children[1].visible = false;\r\n                    ee.children[2].x = 10;\r\n                    ee.x = (960 - ee.children[0].width) / 2;\r\n                    ee.y = 252;;\r\n\t\t\t\t} else {\r\n                    ee.visible = false;\r\n                }\r\n            }\r\n            this.toastLayer.alpha = 0;\r\n            this.viewComponent.game.world.bringToTop(this.toastLayer);\r\n            this.viewComponent.game.add.tween(this.toastLayer).from({alpha: 1}, 2500, null, true).name = 'toast';\r\n        },\r\n\r\n        addRetroText: function (x, y, w, h, txtData) {\r\n            let font = this.viewComponent.game.add.retroFont(FontUtils.fontFamily, FontUtils.charWidth, FontUtils.charHeight, FontUtils.fontChars, FontUtils.countPerRow);\r\n            let txtImg = this.viewComponent.game.add.image(x ? x : 0, y ? y : 0, font);\r\n            txtImg.fontImg = font;\r\n            if (document.body.clientWidth < document.body.clientHeight) {\r\n                font.stamp.angle = -90;\r\n            }\r\n            if (txtData) {\r\n                font.setText(txtData, true, 0, 0, 'center', true);\r\n                if (w) {\r\n                    txtImg.width = w;\r\n                }\r\n                if (h) {\r\n                    txtImg.height = h;\r\n                }\r\n            }\r\n\r\n            return txtImg;\r\n        },\r\n\r\n        addImageFontTextColors: function (data, txtObj, context) {\r\n            // 先清除上一次保存的颜色值\r\n            txtObj.colors.splice(0, txtObj.colors.length);\r\n\r\n            let iPos = 0;\r\n            let color = this.json_data.default_settings.color;\r\n            txtObj.fill = color;\r\n            for (let i=0; i<data.length; i++) {\r\n                let realData = '';\r\n                if (data[i].lineBreak) continue;  // 换行符不计入设置颜色的字符个数\r\n                else if (data[i].placeholder && '\\\\' === data[i].data[0]) {   // 停顿\r\n                    realData = this.Expression.parseWaitTime(data[i].data);\r\n                }\r\n                else {\r\n                    realData = this.Expression.parseValue(data[i].data, context);\r\n                }\r\n                color = data[i].color ? data[i].color : this.json_data.default_settings.color;\r\n                if (color[0] === '#' && color.length === 4) {\r\n                \tlet clr = '#' + color[1] + color[1] + color[2] + color[2] + color[3] + color[3];\r\n                \tcolor = clr;\r\n\t\t\t\t}\r\n                txtObj.addColor(color, iPos);\r\n                iPos += realData.length;\r\n            }\r\n        },\r\n\r\n        addImageFontText: function (data, font_width, font_height, txtObj, context, bSpeaking, bSpeakHidden) {\r\n            const {Expression} = this;\r\n            // 先清除上一剧情fontImage\r\n\t\t\tif (txtObj.children.length) {\r\n                let charGroup = txtObj.children[0];\r\n                let mask = txtObj.children[1];\r\n                for (let i=0; i<charGroup.children.length; i++) {\r\n                    let txtImg = charGroup.getChildAt(i);\r\n                    let fontImg = txtImg.fontImg;\r\n                    fontImg.destroy();\r\n                    txtImg.destroy();\r\n                }\r\n                charGroup.destroy();\r\n                mask && mask.destroy();\r\n                txtObj.removeChildren();\r\n            }\r\n\r\n            let xPos = 0;\r\n            let yPos = 0;\r\n            let cr = '#fffffe';\r\n            let bkWidth = 0;\r\n            let firstMargin = 0;\r\n            let fontHeight = parseFloat(font_height);\r\n            let fontWidth = parseFloat(font_width);\r\n            let t_h = this.json_data.font.size ? (this.json_data.font.size.target.height ? this.json_data.font.size.target.height : this.json_data.font.size.target) : this.json_data.default_settings.font_size;\r\n            let sizeRow = this.json_data.font.size ? (fontHeight * this.json_data.font.size.source / t_h) : fontHeight;\r\n            let seperation = this.json_data.font.size ? (1.5 * sizeRow - fontHeight) : (0.5 * sizeRow);\r\n            let fontChars = [];\r\n            let itemChar = {content:'', color:'#fffffe', x:0, y:0, space:0};\r\n            let charCount = 0;\r\n            let posInfo = [];\r\n            yPos += 0.5 * seperation;\t// 客户端第一行与顶部有0.5个间距 issue8176\r\n\r\n            for (let i=0; i<data.length; i++) {\r\n                let realData = '';\r\n                if (data[i].lineBreak) {\r\n                    if (i === data.length-1) {    // 最后一个换行符不输出\r\n                        break;\r\n                    }\r\n                    yPos += fontHeight + seperation;\r\n                    xPos = 0;\r\n                    continue;\r\n                }\r\n                else if (data[i].placeholder && '\\\\' === data[i].data[0]) {   // 停顿\r\n                    realData = Expression.parseWaitTime(data[i].data);\r\n                }\r\n                else {\r\n                    realData = Expression.parseValue(data[i].data, context);\r\n                }\r\n\r\n                for (let j=0; j<realData.length; j++) {\r\n                    if (txtObj.colors[charCount]) {\r\n                        cr = txtObj.colors[charCount];\r\n                        if (cr === '#ffffff') cr = '#fefefe';\r\n                    }\r\n\r\n                    const m = FontUtils.getLeftMargin(realData[j], fontWidth);\r\n                    const s = FontUtils.getCharSpace(realData[j], fontWidth);\r\n\r\n                    let x = xPos + m;\r\n                    if (x + s > txtObj.style.wordWrapWidth) { // 检测是否还能放下一个字符\r\n                        if (bkWidth < x+s) {\r\n                            bkWidth = x+s;\r\n                        }\r\n                        xPos = 0;\r\n                        x = xPos + m;\r\n                        yPos += fontHeight + seperation;\r\n                        firstMargin = m;\r\n                    }\r\n\r\n                    if (itemChar.space === 0) {\r\n                    \titemChar.space = s;\r\n                    \titemChar.color = cr;\r\n                    \titemChar.x = x;\r\n                    \titemChar.y = yPos;\r\n                    \tif (firstMargin === 0) {\r\n                    \t\tfirstMargin = m;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (32 === realData[j].charCodeAt(0) || 160 === realData[j].charCodeAt(0) || '\\u2002' === realData[j]  // 半角空格\r\n\t\t\t\t\t\t|| '\\u3000' === realData[j] || 8195 === realData[j].charCodeAt(0)) { // 全角空格\r\n                        itemChar.content && fontChars.push(itemChar);\r\n                        fontChars.push({content: realData[j], color:cr, x:x, y:yPos, space:s});\r\n                        itemChar = {content:'', color:'#fffffe', x:0, y:0, space:0};\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (itemChar.space !== s || itemChar.color !== cr || itemChar.y !== yPos || fontWidth !== s) {\r\n                        itemChar.content && fontChars.push(itemChar);\r\n                    \titemChar = {content:realData[j], color:cr, x:x, y:yPos, space:s};\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n                    \titemChar.content += realData[j];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tposInfo.push({x: x, y: yPos, space: s, bottomInText: yPos + fontHeight});\r\n\r\n\t\t\t\t\tcharCount++;\r\n                    xPos += s;\r\n                }\r\n            }\r\n            if (data.length) {\r\n            \tif (itemChar.content) {\r\n                    fontChars[fontChars.length - 1] !== itemChar && fontChars.push(itemChar);\r\n                    if (bkWidth < xPos) {\r\n                    \tbkWidth = xPos;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet charsBk = this.viewComponent.game.add.sprite(0, 0);\r\n                fontChars.forEach(item => {\r\n                \tif (32 === item.content.charCodeAt(0) || 160 === item.content.charCodeAt(0) || '\\u2002' === item.content\r\n\t\t\t\t\t\t|| '\\u3000' === item.content || 8195 === item.content.charCodeAt(0))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n                    let imgTxt = this.addRetroText(item.x, item.y, fontWidth * item.content.length, fontHeight, item.content);\r\n                    imgTxt.tint = parseInt(item.color.replace('#', '0x'));\r\n                    charsBk.addChild(imgTxt);\r\n                });\r\n                charsBk.extWidth = bkWidth;\r\n                charsBk.extMargin = firstMargin;\r\n                txtObj.addChild(charsBk);\r\n                txtObj.posInfo = posInfo;\r\n                fontChars.length && (txtObj.imgFBottom = fontChars[fontChars.length-1].y + fontHeight);\r\n\r\n                if (bSpeaking) {\r\n                    let mask = this.viewComponent.game.add.graphics(0, 0);\r\n                    let maskWidth = txtObj.style.wordWrapWidth;\r\n                    let maskHeight = bSpeakHidden ? 540 : this.json_data.template.json.dialog.rect.height;\r\n                    mask.beginFill(0xffffff);\r\n                    mask.drawRect(-maskWidth, -maskHeight, 2 * maskWidth, maskHeight);\r\n                    mask.drawRect(-maskWidth, 0, maskWidth, fontHeight);\r\n                    mask.endFill();\r\n                    charsBk.mask = mask;\r\n                    txtObj.addChild(mask);\r\n                }\r\n\t\t\t}\r\n        },\r\n\r\n        saveData: function (index, auto) {\r\n            return new Promise((resolve, reject) => {\r\n                if (flashvars.uuid && !this.bCloudSel) {\r\n                    Utils.localStorageSetItem(flashvars.uuid + flashvars.uid, JSON.stringify(this.savedPlotsData));\r\n                    !auto && this.showToast(0, '存档成功，下次可以从这里读档继续哦~');\r\n                    resolve();\r\n                }\r\n                else if (flashvars.gid && this.bCloudSel) {\r\n                \tthis.showLoadingToast(1);\r\n                    this.saveCloudRecord(index).then(rs => {\r\n                    \tthis.showLoadingToast(0);\r\n                        !auto && this.showToast(0, '存档成功，下次可以从这里读档继续哦~');\r\n                        resolve();\r\n                    }, rj => {\r\n                        //Dialog.error(rj)\r\n                        this.showLoadingToast(0);\r\n                        !auto && this.showToast(1, '存档失败，请检查您的网络哦~');\r\n                        reject();\r\n                    });\r\n                }\r\n            })\r\n        },\r\n\r\n\t\tloadData: function (bLocalCloudSwitch) {\r\n            if (flashvars.u==='' && flashvars.token==='' && flashvars.client==='') {\r\n                let uid = Utils.getUidByCookie();\r\n                if ('' !== uid && flashvars.uid !== uid) {\r\n                    flashvars.uid = uid;\r\n                    this.localRecFileToUidRecFile(bLocalCloudSwitch);\r\n                } else {\r\n                \tflashvars.uid = uid;\r\n\t\t\t\t}\r\n            }\r\n\r\n            if (!this.bCloudSel) {\r\n                this.recUidBelongTo = flashvars.uid;\r\n            }\r\n            else if (this.recUidBelongTo === '') {\r\n            \tthis.recUidBelongTo = flashvars.uid;\r\n\t\t\t}\r\n\r\n\t\t\tif (flashvars.uuid) {\r\n\t\t\t\tif (this.bSignedIn && this.bCloudSel) {\r\n\t\t\t\t\tthis.savedPlotsData = JSON.parse(JSON.stringify(this.cloudPlotsData));\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n                    let savedData = Utils.localStorageGetItem(flashvars.uuid + flashvars.uid);\r\n                    if (savedData && 'ios' === flashvars.client) {\r\n                        savedData = savedData.replace(/\\n/g, '');\r\n                        savedData = savedData.replace(/\\r/g, '');\r\n                    }\r\n                    this.savedPlotsData = JSON.parse(savedData);\r\n                }\r\n\t\t\t}\r\n\t\t\tif (!this.savedPlotsData) {\r\n\t\t\t\tthis.savedPlotsData = Array(12).fill({});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetSnap: function () {\r\n            const canvas = document.createElement('canvas');\r\n            canvas.width = this.viewComponent.game.world.width / 3;\r\n            canvas.height = this.viewComponent.game.world.height / 3;\r\n            const ctx = canvas.getContext('2d');\r\n\r\n\t\t\tif (document.body.clientWidth > document.body.clientHeight) {\r\n                ctx.drawImage(this.viewComponent.game.canvas, 0, 0, 960, 540, 0, 0, canvas.width, canvas.height);\r\n                this.plotSnap = canvas.toDataURL(\"image/jpeg\", 0.3);\r\n\t\t\t}\r\n\t\t\telse {\r\n                ctx.save();\r\n                ctx.translate(0, canvas.height);\r\n                ctx.rotate(-90 * Math.PI / 180);\r\n                ctx.drawImage(this.viewComponent.game.canvas, 0, 0);\r\n                ctx.restore();\r\n                this.plotSnap = canvas.toDataURL(\"image/jpeg\", 0.3);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsearchChapterByUUID: function (game, uuid) {\r\n\t\t\tconst searchChapter = (chapter, path, uuid) => {\r\n\t\t\t\tif (chapter.uuid === uuid) {\r\n\t\t\t\t\treturn chapter\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = 0; i < chapter.subchapters.length; ++i) {\r\n\t\t\t\t\tconst result = searchChapter(chapter.subchapters[i], [i, ['subchapters', path]], uuid);\r\n\t\t\t\t\tif (result) {\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tlet result = null;\r\n\t\t\tfor (var i = 0; i < game.chapters.length; ++i) {\r\n\t\t\t\tresult = searchChapter(game.chapters[i], [i, ['chapters', null]], uuid);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetChapterByPlotUuid: function (game, uuid, chapterUuid) {\r\n\t\t\tconst searchPlot = (plots, chapter, uuid, chapterUuid) => {\r\n\t\t\t\tlet result = null;\r\n\t\t\t\tif (chapterUuid && chapter.uuid !== chapterUuid) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\telse if (chapterUuid && chapter.uuid === chapterUuid && chapter.plots.length === 0) {\r\n\t\t\t\t\tresult = {chapter: chapter, index: -4};\r\n\t\t\t\t}\r\n\t\t\t\tplots.find((plot, i) => {\r\n\t\t\t\t\tif (plot.uuid === uuid) {\r\n\t\t\t\t\t\tresult = {chapter: chapter, index: i};\r\n\t\t\t\t\t} else if (chapter.plots[i].options) {\r\n\t\t\t\t\t\tresult = searchPlotByOption(chapter, i, uuid);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn result !== null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t};\r\n\r\n\t\t\tconst searchPlotByOption = (chapter, nIndex, uuid) => {\r\n\t\t\t\tlet result = null;\r\n\t\t\t\tconst plot = chapter.plots[nIndex];\r\n\t\t\t\tplot.options.find((option, i) => {\r\n\t\t\t\t\tresult = searchPlot(option.plots, {plots: option.plots, parent: {pChapter: chapter, pnPlot: nIndex}, uuid: chapter.uuid, md5:chapter.md5, downloadUuid:chapter.downloadUuid}, uuid);\r\n\t\t\t\t\treturn result !== null\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tplot.condition_options && plot.condition_options.find((option, i) => {\r\n\t\t\t\t\tresult = searchPlot(option.plots, {plots: option.plots, parent: {pChapter: chapter, pnPlot: nIndex}, uuid: chapter.uuid, md5:chapter.md5, downloadUuid:chapter.downloadUuid}, uuid);\r\n\t\t\t\t\treturn result !== null\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t};\r\n\r\n\t\t\tconst searchPlotByChapter = (chapter, uuid, chapterUuid) => {\r\n\t\t\t\tlet result = null;\r\n\t\t\t\tresult = searchPlot(chapter.plots, chapter, uuid, chapterUuid);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\tchapter.subchapters.find((subchapter, i) => {\r\n\t\t\t\t\tresult = searchPlotByChapter(chapter.subchapters[i], uuid, chapterUuid);\r\n\t\t\t\t\treturn result !== null\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t};\r\n\r\n\t\t\tlet result = null;\r\n\t\t\tgame.chapters.find((chapter, i) => {\r\n                result = searchPlotByChapter(game.chapters[i], uuid, chapterUuid);\r\n                return result !== null\r\n\t\t\t});\r\n\t\t\tif (!result || -4 === result.index && !result.chapter.md5) {\r\n\t\t\t\tDialog.error('该剧情已被作者删除啦！\\r\\n无法从该剧情继续哦~');\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\r\n\t\tgetCommandByCommandUuid: function (plot, uuid) {\r\n            const searchCommandInOption = (ops, pCmdInfo, pIndex) => {\r\n            \tfor (let i=0; i<ops.length; i++) {\r\n                    let result = null;\r\n                    result = searchCommand({commands: ops[i].commands, parentInfo: pCmdInfo, parentCmdIndex: pIndex});\r\n            \t\tif (result.cmdInfo !== null) return result;\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t};\r\n\r\n            const searchCommand = (cmdInfo) => {\r\n            \tlet result = null;\r\n            \tcmdInfo.commands.find((command, i) => {\r\n            \t\tif (command.uuid === uuid) {\r\n            \t\t\tresult = {cmdIndex: i, uuid: uuid, cmdInfo: {commands: cmdInfo.commands, parentInfo: cmdInfo.parentInfo, parentCmdIndex: cmdInfo.parentCmdIndex}}\r\n                    }\r\n            \t\telse if (command.type === 'options' || command.type === 'conditionOptions') {\r\n            \t\t\tresult = searchCommandInOption(command.args, cmdInfo, i);\r\n                    }\r\n\r\n                    return null !== result;\r\n\t\t\t\t});\r\n            \tif (null === result) {\r\n            \t\treturn {cmdIndex: -1, cmdInfo: null};\r\n                }\r\n                return result;\r\n\t\t\t};\r\n\r\n            let cmdInfo = {commands: plot.commands, parentInfo: null, parentCmdIndex: -1};\r\n            return searchCommand(cmdInfo);\r\n        },\r\n\r\n\t\tgetMusic: function (chapter, nPlot) {\r\n\t\t\tlet url = null;\r\n\t\t\tfor (let i = nPlot; i >= 0; i--) {\r\n\t\t\t\tconst plot = chapter.plots[i];\r\n\t\t\t\tif (plot.music && plot.music.url !== \"inherit\") {\r\n\t\t\t\t\turl = plot.music.url;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!url && chapter.parent) {\r\n\t\t\t\treturn this.getMusic(chapter.parent.pChapter, chapter.parent.pnPlot);\r\n\t\t\t}\r\n\t\t\tif (!url && chapter.isFirst) {\r\n\t\t\t\tif (this.json_data.cover.music && this.json_data.cover.music.url !== 'inherit') {\r\n                    return this.json_data.cover.music.url;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn url;\r\n\t\t},\r\n\r\n\t\tgetCmdScreenSnap: function () {\r\n\t\t\tlet {bk_music, plotSounds, curPlotLayer} = this;\r\n\t\t\tlet bkInfo = curPlotLayer.children[1];\r\n\t\t\tlet chAndProps = [];\r\n            let plotViews = [];\r\n            let dialogInfo = this.lstDialogInfo.concat();\r\n            let menuInfo = this.menuInfo.concat();\r\n            let music = bk_music ? {url: bk_music.key, volume: bk_music.volume} : null;\r\n            let sounds = plotSounds.map(s => {\r\n                if (s) {\r\n                    return {\r\n                        url: s.key,\r\n                        volume: s.volume,\r\n                        time: s.loop ? 0 : 1\r\n                    }\r\n                }\r\n                return null;\r\n            });\r\n            let bk = bkInfo ? {url: bkInfo.key, opacity: bkInfo.alpha, width: bkInfo.width, height: bkInfo.height} : null;\r\n            this.charsAndPropsLayer && this.charsAndPropsLayer.children.forEach(g => {\r\n            \tlet c = g.children[0];\r\n\t\t\t\tlet item = {url:c.key, x:c.x, y:c.y, width:c.width, height:c.height, opacity: c.alpha, pivotX: c.pivot.x, pivotY: c.pivot.y\r\n\t\t\t\t\t, scaleX:c.scale.x, scaleY:c.scale.y, rotate:c.angle, cmdUuid:c.cmdUuid, index:g.zIndex, parentScale: g.scale.x};\r\n\t\t\t\tchAndProps.push(item);\r\n\t\t\t});\r\n            this.getViewData(this.plotViews, plotViews);\r\n            return {bk: bk, charsAndProps: chAndProps, sounds: sounds, music: music, plotViews: plotViews, dialogInfo: dialogInfo, menuInfo: menuInfo, autoText: this.bCmdAutoText, weatherType: this.getWeatherType()};\r\n        },\r\n\r\n\t\tgetNextPlot: function (context, chapter, nPlot, type, eArg) {\r\n\t\t\tlet {json_data, Expression, searchChapterByUUID} = this;\r\n\t\t\tconst game = json_data;\r\n\t\t\tlet cmdPlotSnap = {cmdIndex: 0, cmdInfo: null, cmdScreenSnap: null};\r\n\t\t\tlet nIndex = nPlot;\r\n\t\t\tlet nChapter = chapter;\r\n\t\t\tlet preStackFrame = undefined;\r\n\t\t\tlet preCmdStackFrame = undefined;\r\n\t\t\tconst plot = chapter.plots[nPlot];\r\n\t\t\tnIndex++;\r\n\r\n\t\t\tif (type === 'option') {\r\n\t\t\t\tif (plot.options[eArg]) {\r\n                    const frame = {};\r\n                    frame.loopCondition = null;\r\n                    frame.loopCount = 1;\r\n                    context.stack = [frame, ...context.stack];\r\n                    nChapter = {plots: plot.options[eArg].plots, parent: {pChapter: nChapter, pnPlot: nPlot}, uuid: chapter.uuid};\r\n                    nIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t} else if (plot && !plot.insert && !plot.jump && !plot.back && !type) {\r\n                const condOptIndex = (plot.condition_options || []).findIndex(option => {\r\n                    return Expression.safeEval(option.expression, context)\r\n                        && (option.count ? parseInt(Expression.safeEval(option.count, context)) > 0 : true)\r\n                });\r\n                const condOpt = condOptIndex < 0 ? null : plot.condition_options[condOptIndex];\r\n                if (condOpt) {\r\n                    const frame = {};\r\n                    frame.loopCondition = \"loop\" === condOpt.type || \"countLoop\" === condOpt.type ? condOpt.expression : null;\r\n                    frame.loopCount = 1;\r\n                    frame.loopCountExpr = condOpt.count;\r\n                    context.stack = [frame, ...context.stack];\r\n                    nIndex = 0;\r\n                    nChapter = {plots: condOpt.plots, parent: {pChapter: chapter, pnPlot: nPlot}, uuid: chapter.uuid};\r\n                }\r\n\t\t\t}\r\n\r\n\t\t\tif (plot && ((plot.jump && !type) || (plot.jump && 'nextPlot' === type) || type === 'jump')) {\r\n\t\t\t\tlet jumpUuid = type === 'jump' ? eArg : plot.jump;\r\n\t\t\t\tconst jumpChapter = searchChapterByUUID(game, jumpUuid);\r\n\t\t\t\tif (jumpChapter) {\r\n\t\t\t\t\tnChapter = jumpChapter;\r\n\t\t\t\t\tnIndex = 0;\r\n\t\t\t\t\tcontext.stack = [];\r\n\t\t\t\t\tcontext.cmdStack = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (plot && (plot.back ||  type === 'back')) {\r\n\t\t\t\tnIndex = -2;\r\n\t\t\t\tcontext.stack = [];\r\n\t\t\t}\r\n\r\n            if (plot && type === 'jumpOption') {\r\n                context = JSON.parse(JSON.stringify(this.context));\r\n\r\n                for (let t = 0; t < eArg; t++) {\r\n                    if (!nChapter.parent) {\r\n                        break;//return false;\r\n                    }\r\n                    if (context.stack[0] && context.stack[0].type !== 'insert') {\r\n                        context.stack = context.stack.splice(1);\r\n                        nIndex = nChapter.parent.pnPlot;\r\n                        nChapter = nChapter.parent.pChapter;\r\n                    } else {\r\n                    \tbreak;\r\n\t\t\t\t\t}\r\n                }\r\n                if (-1 !== nIndex) {\r\n                    this.context = context;\r\n                    nIndex++;\r\n                }\r\n            }\r\n\r\n            if (plot && type === 'backOption') {\r\n                context = JSON.parse(JSON.stringify(this.context));\r\n                for (let t = 0; t < eArg; t++) {\r\n                    if (!nChapter.parent) {\r\n                        break;//return false;\r\n                    }\r\n                    if (context.stack[0] && context.stack[0].type !== 'insert') {\r\n                        context.stack = context.stack.splice(1);\r\n                        nIndex = nChapter.parent.pnPlot;\r\n                        nChapter = nChapter.parent.pChapter;\r\n                    } else {\r\n                    \tbreak;\r\n\t\t\t\t\t}\r\n                }\r\n                if (-1 < nIndex) {\r\n                    this.context = context;\r\n                    return {chapter: nChapter, nIndex: nIndex, context: context};\r\n                }\r\n            }\r\n\r\n\t\t\tif (plot && (plot.insert && !type || type === 'insertPlot' && eArg)) {\r\n\t\t\t\tconst chapterUuid = eArg || plot.insert;\r\n\t\t\t\tconst c = searchChapterByUUID(game, chapterUuid);\r\n\t\t\t\tif (c) {\r\n\t\t\t\t\tconst frame = {};\r\n\t\t\t\t\tframe.type = 'insert';\r\n\t\t\t\t\tframe.isCommand = chapter.plots[nPlot].commands ? true : false;\r\n\t\t\t\t\tframe.cmdInfo = frame.isCommand ? this.curCmdInfo : null;\r\n\t\t\t\t\tframe.cmdIndex = frame.isCommand ? this.curCmdIndex : null;\r\n\t\t\t\t\tframe.cmdScreenSnap = frame.isCommand ? this.getCmdScreenSnap() : null;\r\n                    frame.isCommand && (context.cmdStack = [{type:'insert'}, ...context.cmdStack]);\r\n\t\t\t\t\tframe.loopCondition = null;\r\n\t\t\t\t\tframe.loopCount = 1;\r\n\t\t\t\t\tframe.pPlotUuid = nChapter.plots[nIndex-1].uuid;\r\n\t\t\t\t\tframe.chapterUuid = nChapter.uuid;\r\n\t\t\t\t\tcontext.stack = [frame, ...context.stack];\r\n\t\t\t\t\tnChapter = {plots:c.plots, md5:c.md5, uuid:c.uuid, downloadUuid: c.downloadUuid, charge: c.charge, parent:{pChapter:nChapter, pnPlot:nIndex - 1}};\r\n\t\t\t\t\tnIndex = 0;\r\n\r\n\t\t\t\t\tif (this.mainMenuLayer.visible)\r\n            \t    {\r\n            \t    \tif (this.mainMenuLayer.children[1] && this.mainMenuLayer.children[1].isMenu) {\r\n            \t    \t\tthis.sendNotification(diygamePlayer.AppConstants.SCENE_DESTROY_VIEW, {name:this.mainMenuLayer.children[1].name, isMainMenu: true});\r\n\t\t\t\t\t\t}\r\n                \t    this.onMainMenuBackBtnClicked();\r\n                \t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//while ((!nChapter.plots[nIndex] && nIndex !== 0 && nChapter.plots.length && context.stack && 0 < context.stack.length)\r\n\t\t\t//\t\t|| (!nChapter.plots[nIndex] && nIndex === 0 && !nChapter.plots.length && !nChapter.md5 && context.stack && 0 < context.stack.length)) {\r\n            while (!nChapter.plots[nIndex]\r\n\t\t\t\t\t&& (nIndex !== 0 && nChapter.plots.length || nIndex === 0 && !nChapter.plots.length && !nChapter.md5)\r\n             \t\t&& context.stack && 0 < context.stack.length) {\r\n\t\t\t\tconst frame = context.stack[0];\r\n\t\t\t\tif (frame.loopCondition && Expression.safeEval(frame.loopCondition, context)) {\r\n                    //满足循环条件\r\n                    nIndex = 0;\r\n                    if (frame.loopCount) {\r\n                        frame.loopCount++;\r\n                    }\r\n                    if (frame.loopCountExpr) {\r\n                        const count = parseInt(Expression.safeEval(frame.loopCountExpr, context));\r\n                        if (frame.loopCount <= count) {\r\n                            //满足次数循环条件\r\n                            break;\r\n                        }\r\n                    } else {\r\n                    \tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontext.stack = context.stack.splice(1);\r\n                if (frame.type === 'insert' && context.cmdStack.length && context.cmdStack[0].type && context.cmdStack[0].type === 'insert') {\r\n                \tpreCmdStackFrame = context.cmdStack[0];\r\n                    context.cmdStack = context.cmdStack.splice(1);\r\n\r\n                    // 修复flash存档数据高级剧情insert部分\r\n                    if (context.commandInserts) {\r\n                    \tfor (let i=0; i<context.commandInserts.length; i++) {\r\n                    \t\tif (frame.pPlotUuid !== context.commandInserts[i].uuid) {\r\n                    \t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n                            const result = this.getChapterByPlotUuid(this.json_data, frame.pPlotUuid, frame.chapterUuid);\r\n                    \t\tif (null === result || result.chapter && result.index === -4) {\r\n                    \t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n                    \t\tconst cmdResult = this.getCommandByCommandUuid(result.chapter.plots[result.index], context.commandInserts[i].data.commandUuid);\r\n                    \t\tframe.cmdInfo = cmdResult.cmdInfo;\r\n                    \t\tframe.cmdIndex = cmdResult.cmdIndex;\r\n\r\n                            if (context.commandInserts[i].data.historyCommand) {\r\n                            \tlet snap = {charsAndProps:[], sounds: Array(12), music: null, plotViews: [], menuInfo: []};\r\n                                let {images, dialog, autoText, weather, viewsData} = context.commandInserts[i].data.historyCommand;\r\n                                snap.autoText = autoText ? autoText.args[0] : false;\r\n                                snap.dialogInfo = dialog && dialog.command ? dialog.command.args : [];\r\n                                snap.weatherType = weather ? weather.args[0] : '';\r\n                                if (images) {\r\n                                    for (let v=0; v<images.length; v++) {\r\n                                        if (images[v].index > 1) {\r\n                                            let item = {url:images[v].url, x:images[v].x, y:images[v].y, width:images[v].width, height:images[v].height, opacity: images[v].opacity\r\n                                                , rotate:images[v].rotate, index:images[v].index};\r\n                                            snap.charsAndProps.push(item);\r\n                                        }\r\n                                        else if (images[v].index === 1) {\r\n                                            snap.bk = {url:images[v].url, opacity:images[v].opacity};\r\n                                        }\r\n                                    }\r\n                                }\r\n\t\t\t\t\t\t\t\tif (viewsData && viewsData.length) {\r\n                                    for (let j=0; j<viewsData.length; j++) {\r\n                                        snap.plotViews[j] = this.copyFlashViewData(viewsData[j]);\r\n                                        snap.plotViews[j].x = 0;\r\n                                        snap.plotViews[j].y = 0;\r\n                                        snap.plotViews[j].parent = 'plotViewsLayer';\r\n                                    }\r\n\t\t\t\t\t\t\t\t}\r\n                                frame.cmdScreenSnap = snap;\r\n                            }\r\n                    \t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n                }\r\n\r\n                if (nChapter.parent && 'insert' !== frame.type) {\r\n                    cmdPlotSnap.cmdIndex = frame.isCommand ? frame.cmdIndex+1 : -1;\r\n                    cmdPlotSnap.cmdInfo = frame.cmdInfo;\r\n                    cmdPlotSnap.cmdScreenSnap = frame.cmdScreenSnap;\r\n\t\t\t\t\tnIndex = frame.isCommand ? nChapter.parent.pnPlot : nChapter.parent.pnPlot + 1;\r\n\t\t\t\t\tnChapter = nChapter.parent.pChapter;\r\n\t\t\t\t} else if (frame.pPlotUuid && frame.type === 'insert') {\r\n                    cmdPlotSnap.cmdIndex = frame.isCommand ? frame.cmdIndex+1 : -1;\r\n                    cmdPlotSnap.cmdInfo = frame.cmdInfo;\r\n                    cmdPlotSnap.cmdScreenSnap = frame.cmdScreenSnap;\r\n                    const {chapter: c, index: n} = this.getChapterByPlotUuid(this.json_data, frame.pPlotUuid, frame.chapterUuid);\r\n                    nIndex = frame.isCommand ? n : n+1;\r\n                    nChapter = c;\r\n                    preStackFrame = frame;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {chapter: nChapter, nIndex: nIndex, cmdPlotSnap, context, preStackFrame, preCmdStackFrame}\r\n\t\t},\r\n\r\n\t\tgetNextCommand: function (context, cmdInfo, index, action) {\r\n            let {Expression} = this;\r\n            let rCmdInfo = cmdInfo;\r\n            let rIndex = index;\r\n            rIndex++;\r\n\r\n            if ('options' === action.type) {\r\n                const args = cmdInfo.commands[index].args;\r\n                if (action.index >= 0 && args[action.index].commands.length > 0) {\r\n                    const frame = {};\r\n                    frame.loopCondition = null;\r\n                    frame.loopCount = 1;\r\n                    context.cmdStack = [frame, ...context.cmdStack];\r\n\r\n                    rIndex = 0;\r\n                    rCmdInfo = {commands: args[action.index].commands, parentInfo: cmdInfo, parentCmdIndex: index};\r\n                }\r\n                else {\r\n                    this.optionLayer.destroy();\r\n                }\r\n            }\r\n            else if ('cdtOptions' === action.type) {\r\n                const args = cmdInfo.commands[index].args;\r\n                const condOptIndex = (args).findIndex(option => {\r\n                    return Expression.safeEval(option.expression, context)\r\n                        && (option.count ? parseInt(Expression.safeEval(option.count, context)) > 0 : true)\r\n                });\r\n                const condOpt = condOptIndex < 0 ? null : args[condOptIndex];\r\n                if (condOpt) {\r\n                    const frame = {};\r\n                    frame.loopCondition = \"loop\" === condOpt.type || \"countLoop\" === condOpt.type ? condOpt.expression : null;\r\n                    frame.loopCount = 1;\r\n                    frame.loopCountExpr = condOpt.count;\r\n                    context.cmdStack = [frame, ...context.cmdStack];\r\n                    rIndex = 0;\r\n                    rCmdInfo = {commands: condOpt.commands, parentInfo: cmdInfo, parentCmdIndex: index};\r\n\t\t\t\t}\r\n            }\r\n            else if ('backOption' === action.type) {\r\n                for (let i=0; i<action.eArg; i++) {\r\n                \tif (!rCmdInfo.parentInfo) {\r\n                \t\tbreak;\r\n\t\t\t\t\t}\r\n                    if (context.cmdStack[0] && context.cmdStack[0].type !== 'insert') {\r\n                        context.cmdStack = context.cmdStack.splice(1);\r\n                        rIndex = rCmdInfo.parentCmdIndex;\r\n                        rCmdInfo = rCmdInfo.parentInfo;\r\n                    } else {\r\n                        break;\r\n                    }\r\n                }\r\n                if (rIndex > -1 && rCmdInfo.commands) {\r\n                \treturn {info: rCmdInfo, index: rIndex};\r\n                }\r\n            }\r\n            else if ('jumpOption' === action.type) {\r\n                for (let i=0; i<action.eArg; i++) {\r\n                \tif (!rCmdInfo.parentInfo) {\r\n                \t\tbreak;\r\n\t\t\t\t\t}\r\n                    if (context.cmdStack[0] && context.cmdStack[0].type !== 'insert') {\r\n                        context.cmdStack = context.cmdStack.splice(1);\r\n                        rIndex = rCmdInfo.parentCmdIndex;\r\n                        rCmdInfo = rCmdInfo.parentInfo;\r\n                    } else {\r\n                \t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                rIndex++;\r\n\t\t\t}\r\n\r\n            while (rCmdInfo && !rCmdInfo.commands[rIndex] && context.cmdStack && 0 < context.cmdStack.length) {\r\n                const frame = context.cmdStack[0];\r\n                if (frame.loopCondition && Expression.safeEval(frame.loopCondition, context)) {\r\n                    //满足循环条件\r\n                    rIndex = 0;\r\n                    if (frame.loopCount) {\r\n                        frame.loopCount++;\r\n                    }\r\n                    if (frame.loopCountExpr) {\r\n                        const count = parseInt(Expression.safeEval(frame.loopCountExpr, context));\r\n                        if (frame.loopCount <= count) {\r\n                            //满足次数循环条件\r\n                            break;\r\n                        }\r\n                    } else {\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (!frame.type || frame.type !== 'insert') {\r\n                    context.cmdStack = context.cmdStack.splice(1);\r\n                }\r\n\r\n                if (frame.type && frame.type === 'insert') {\r\n                    rIndex = -1;\r\n                    rCmdInfo = null;\r\n\t\t\t\t}\r\n                else if (rCmdInfo.parentInfo) {\r\n                    rIndex = rCmdInfo.parentCmdIndex + 1;\r\n                    rCmdInfo = rCmdInfo.parentInfo;\r\n\t\t\t\t}\r\n            }\r\n\r\n            return {info: rCmdInfo, index: rIndex};\r\n        },\r\n\r\n\t\tremoveInputView: function (layer) {\r\n            if (layer.inputElement) {\r\n                layer.inputElement.destroy();\r\n            }\r\n            else if (layer.children && layer.children.length) {\r\n                for (let i = 0; i < layer.children.length; i++) {\r\n                    this.removeInputView(layer.children[i]);\r\n                }\r\n            }\r\n        },\r\n\r\n        removeViewTimer: function (view) {\r\n            if (view.viewType === 'TIMER') {\r\n                if (view.timerType === 'timeOut') {\r\n                    clearTimeout(view.timerHandler);\r\n                } else {\r\n                    clearInterval(view.timerHandler);\r\n                }\r\n                return;\r\n            }\r\n            else {\r\n                view.children.forEach(v => this.removeViewTimer(v));\r\n            }\r\n        },\r\n\r\n\t\tfilterInexistentPlotViews: function (views, plotInfo) {\r\n\t\t\t// 过滤高级剧情中已移除的高级UI\r\n\t\t\tif (!plotInfo.commands || 0 === plotInfo.commands.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst isUuidExist = (uuid, cmdInfo) => {\r\n\t\t\t\tfor (let i=0; i<cmdInfo.length; i++) {\r\n\t\t\t\t\tif (cmdInfo[i].uuid === uuid) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ('options' === cmdInfo[i].type || 'conditionOptions' === cmdInfo[i].type) {\r\n\t\t\t\t\t\tfor (let j=0; j<cmdInfo[i].args.length; j++) {\r\n\t\t\t\t\t\t\tif (isUuidExist(uuid, cmdInfo[i].args[j].commands)) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\t\t\tfor (let i=0; i<views.length; i++) {\r\n\t\t\t\tif (!views[i].generateType) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tconst cmdUuid = views[i].generateType;\r\n\t\t\t\tif (isUuidExist(cmdUuid, plotInfo.commands)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tviews.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n        },\r\n\r\n\t\tdestroyAll: function () {\r\n            this.playBackLayer.removeAll(true);\r\n            this.globalViews && this.globalViews.forEach(s => {\r\n                this.removeInputView(s);\r\n                s.destroy()\r\n            });\r\n            this.globalViews = null;\r\n            this.plotViewsLayer.children.forEach(c => {\r\n\t\t\t\tthis.removeViewTimer(c);\r\n            \tthis.removeInputView(c)\r\n            });\r\n            this.plotViewsLayer.removeAll(true);\r\n            if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n            \tPhoneUtils.stopMusic();\r\n            \tPhoneUtils.removeAudioUrl(PhoneUtils.musicInfo.key);\r\n            \t\r\n            \tfor (let i=0; i<10; i++) {\r\n            \t\tif (PhoneUtils.soundsInfo[i].key) {\r\n            \t\t\tPhoneUtils.stopSound(i);\r\n            \t\t\tPhoneUtils.removeAudioUrl(PhoneUtils.soundsInfo[i].key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n                this.bk_music && this.bk_music.destroy();\r\n                this.bk_music = null;\r\n                this.plotSounds && this.plotSounds.forEach(s => s && s.destroy());\r\n                this.plotSounds = [];\r\n\t\t\t}\r\n\r\n            if (this.lstPlotLayer) {\r\n                this.lstPlotLayer.destroy();\r\n                this.lstPlotLayer = null;\r\n            }\r\n        },\r\n\r\n\t\treStart: function () {\r\n\t\t\t//重播调用app  结束接口\r\n            if (flashvars.client === 'ios') {\r\n                if(flashvars.offline === 1){\r\n                    javascript:workFinished('1');\r\n                }else{\r\n                    window.webkit && window.webkit.messageHandlers.workFinished.postMessage('1');\r\n                }\r\n            }\r\n            else if (flashvars.client === 'android') {\r\n                window.app && window.app.workFinished('1');\r\n            }\r\n            this.dialogLayer.visible = false;\t\t// 隐藏对话框层\r\n\t\t\tthis.unlockChapterCallBack = null;\t\t// 清除解锁回调\r\n\t\t\tthis.mallPayCallback = null;\r\n\t\t\tthis.destroyAll();\r\n\t\t\tthis.initContext(this.context);\r\n\t\t\tif (!this.json_data.cover.hidden) {\r\n\t\t\t\treturn this.showCover();// 创建封面\r\n\t\t\t} else {\r\n\t\t\t\tconst chapter = this.findFirstChapter();\r\n\t\t\t\tconst chapterUuid = chapter.downloadUuid ? chapter.downloadUuid : chapter.uuid;\r\n                if (chapter.md5 && chapter.plots.length === 0) {\r\n                    if (chapter.charge && ('android' === flashvars.client || 'ios' === flashvars.client)) {\r\n                        const unlockFinish = (bSuccess) => {\r\n                            if (bSuccess) {\r\n                                this.checkIfChapterFree(chapterUuid, chapter.md5).then((plots)=>{\r\n                                    this.unlockChapterCallBack = null;\r\n                                    chapter.plots = plots;\r\n                                    this.preloadChapterAssets(this.context, chapter);\r\n                                }, () => Dialog.error('获取付费章节信息失败'))\r\n                            }\r\n                        };\r\n\r\n                        this.unlockChapter(chapterUuid, chapter.charge, chapter.md5, unlockFinish);\r\n                    } else {\r\n                        this.checkIfChapterFree(chapterUuid, chapter.md5).then((plots)=>{\r\n                            chapter.plots = plots;\r\n                            this.preloadChapterAssets(this.context, chapter);\r\n                        }, (msg)=>{\r\n                            if (-1 === msg.indexOf('code=87')) {\r\n                                Dialog.error(msg);\r\n                            } else { // 未购买此章节\r\n                                Dialog.info('当前为收费章节，请前往闪艺app或电脑端进行购买');\r\n                            }\r\n                        })\r\n\t\t\t\t\t}\r\n                } else {\r\n                    this.preloadChapterAssets(this.context, chapter);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tvalueOperation: function (context, values, bCancelUpload) {\r\n            if (this.isPaying) return;\t// pay操作未完成前不允许数值操作\r\n\t\t\tconst payValueOperator = (index, v) => {\r\n                context.payValues[index].value = v;\r\n\r\n                if (flashvars.u==='' && flashvars.token==='' && flashvars.client==='') {\r\n                    let uid = Utils.getUidByCookie();\r\n                    if (uid !== flashvars.uid && uid !== '') {\r\n                        flashvars.uid = uid;\r\n                        this.localRecFileToUidRecFile(false);\r\n\r\n                        this.getPayInfo().then(() => {\r\n                            this.getAccountInfo();\r\n                        });\r\n                    } else {\r\n                        !bCancelUpload && this.savePayInfo();\r\n                    }\r\n                } else {\r\n                    !bCancelUpload && this.savePayInfo();\r\n                }\r\n\t\t\t};\r\n\r\n\t\t\tconst indexValueOperator = (index, v, reference) => {\r\n\t\t\t\tif (!reference) {\r\n\t\t\t\t\tif (v < 1) {\r\n                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n\t\t\t\t\t}\r\n                    else if (context.indexValues[index].init.type === 'value' && v>context.values.length) {\r\n                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (context.indexValues[index].init.type === 'savedValue' && v>context.savedValues.length) {\r\n                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (context.indexValues[index].init.type === 'stringValue' && v>context.stringValues.length) {\r\n                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (context.indexValues[index].init.type === 'payValue' && v>context.payValues.length) {\r\n                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontext.indexValues[index].value = v;\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n                const i = context.indexValues[index].value === undefined ? context.indexValues[index].init.value-1 : context.indexValues[index].value-1;\r\n\t\t\t\tif (context.indexValues[index].init.type === 'value') {\r\n\t\t\t\t\tif (i<0 || i>=context.values.length) {\r\n\t\t\t\t\t\tDialog.info('出现未知数值操作，请联系作者检查修改');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n                    context.values[i].value = v;\r\n\t\t\t\t}\r\n                else if (context.indexValues[index].init.type === 'savedValue') {\r\n                    if (i<0 || i>=context.savedValues.length) {\r\n                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n                        return;\r\n                    }\r\n                    context.savedValues[i].value = v;\r\n                }\r\n                else if (context.indexValues[index].init.type === 'stringValue') {\r\n                    if (i<0 || i>=context.stringValues.length) {\r\n                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n                        return;\r\n                    }\r\n                    context.stringValues[i].value = v;\r\n                }\r\n                else if (context.indexValues[index].init.type === 'payValue') {\r\n                    if (i<0 || i>=context.payValues.length) {\r\n                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n                        return;\r\n                    }\r\n                    payValueOperator(i, v);\r\n                }\r\n\t\t\t};\r\n\r\n\t\t\tif (values && values.length > 0) {\r\n\t\t\t\tvalues.forEach(value => {\r\n\t\t\t\t\tconst v = this.Expression.safeEval(value.expression, this.context);\r\n\t\t\t\t\tconst uuid = value.uuid;\r\n\t\t\t\t\tlet index;\r\n\t\t\t\t\tif ((index = this.context.values.findIndex(v => v.uuid === uuid)) !== -1) {\r\n\t\t\t\t\t\tcontext.values[index].value = v;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ((index = this.context.savedValues.findIndex(v => v.uuid === uuid)) !== -1) {\r\n\t\t\t\t\t\tcontext.savedValues[index].value = v;\r\n                        Utils.localStorageSetItem(flashvars.uuid + 'savedValues' + flashvars.uid, JSON.stringify(context.savedValues));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ((index = this.context.stringValues.findIndex(v => v.uuid === uuid)) !== -1) {\r\n\t\t\t\t\t\tcontext.stringValues[index].value = v;\r\n\t\t\t\t\t}\r\n                    else if ((index = this.context.payValues.findIndex(v => v.uuid === uuid)) !== -1) {\r\n                        payValueOperator(index, v);\r\n                    }\r\n                    else if ((index = this.context.indexValues.findIndex(v => v.uuid === uuid)) !== -1) {\r\n\t\t\t\t\t\tindexValueOperator(index, v, value.reference);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tconsole.error('Cannot find value/savedValue with uuid = ', uuid);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tupdateValues: function (oldContext) {\r\n\t\t\tlet tempValues = JSON.parse(JSON.stringify(this.json_data.values));\r\n\t\t\tfor (let i=0; i<oldContext.values.length; i++) {\r\n\t\t\t\tfor (let j=0; j<tempValues.length; j++) {\r\n\t\t\t\t\tif (tempValues[j].uuid === oldContext.values[i].uuid) {\r\n\t\t\t\t\t\ttempValues[j].value = oldContext.values[i].value;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\toldContext.values = tempValues.concat();\r\n\r\n\t\t\ttempValues = JSON.parse(JSON.stringify(this.json_data.savedValues));\r\n            for (let i=0; i<oldContext.savedValues.length; i++) {\r\n                for (let j=0; j<tempValues.length; j++) {\r\n                    if (tempValues[j].uuid === oldContext.savedValues[i].uuid) {\r\n                        tempValues[j].value = oldContext.savedValues[i].value;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            oldContext.savedValues = tempValues.concat();\r\n\r\n            tempValues = JSON.parse(JSON.stringify(this.json_data.stringValues));\r\n            for (let i=0; i<oldContext.stringValues.length; i++) {\r\n                for (let j=0; j<tempValues.length; j++) {\r\n                    if (tempValues[j].uuid === oldContext.stringValues[i].uuid) {\r\n                        tempValues[j].value = oldContext.stringValues[i].value;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            oldContext.stringValues = tempValues.concat();\r\n\r\n            if (this.json_data.payValues) {\r\n                tempValues = JSON.parse(JSON.stringify(this.json_data.payValues));\r\n                if (oldContext.payValues) {\r\n                    for (let i=0; i<oldContext.payValues.length; i++) {\r\n                        for (let j=0; j<tempValues.length; j++) {\r\n                            if (tempValues[j].uuid === oldContext.payValues[i].uuid) {\r\n                                tempValues[j].value = oldContext.payValues[i].value;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\t\t\t\t}\r\n                oldContext.payValues = tempValues.concat();\r\n            }\r\n\r\n            if (this.json_data.indexValues) {\r\n                tempValues = JSON.parse(JSON.stringify(this.json_data.indexValues));\r\n                if (oldContext.indexValues) {\r\n                    for (let i=0; i<oldContext.indexValues.length; i++) {\r\n                        for (let j=0; j<tempValues.length; j++) {\r\n                            if (tempValues[j].uuid === oldContext.indexValues[i].uuid) {\r\n                                tempValues[j].value = oldContext.indexValues[i].value;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                oldContext.indexValues = tempValues.concat();\r\n\t\t\t}\r\n        },\r\n\r\n\t\tinitContext: function (oldContext, isLoad) {\r\n\t\t\tconst copy = (obj) => {\r\n\t\t\t\tif (!obj) {\r\n\t\t\t\t\treturn obj;\r\n\t\t\t\t}\r\n\t\t\t\treturn JSON.parse(JSON.stringify(obj))\r\n\t\t\t};\r\n\t\t\tconst context = {};\r\n\t\t\tisLoad && this.updateValues(oldContext);\r\n\t\t\tcontext.auto = this.context && this.context.auto || false;\r\n\t\t\tcontext.fullScreen = this.context && this.context.fullScreen || false;\r\n            context.savedValues = copy(oldContext && oldContext.savedValues || this.json_data.savedValues);\r\n            if (!oldContext && !isLoad) {\r\n                const strSavedValues = Utils.localStorageGetItem(flashvars.uuid + 'savedValues' + flashvars.uid);\r\n                if (strSavedValues) {\r\n                    const lstSavedValues = JSON.parse(strSavedValues);\r\n                    for (let i=0; i<lstSavedValues.length; i++) {\r\n                    \tfor (let j=0; j<context.savedValues.length; j++) {\r\n                    \t\tif (context.savedValues[j].uuid === lstSavedValues[i].uuid) {\r\n                    \t\t\tcontext.savedValues[j].value = lstSavedValues[i].value;\r\n                    \t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n                }\r\n\t\t\t}\r\n            if (isLoad) {\r\n                context.values = copy(oldContext.values);\r\n                context.stringValues = copy(oldContext.stringValues);\r\n                context.payValues = copy(this.context.payValues);\r\n                context.indexValues = copy(oldContext.indexValues);\r\n            }\r\n            else {\r\n                context.values = copy(this.json_data.values);\r\n                context.stringValues = copy(this.json_data.stringValues);\r\n                context.payValues = copy(this.json_data.payValues ? this.json_data.payValues : this.context.payValues);\r\n                context.indexValues = copy(this.json_data.indexValues ? this.json_data.indexValues : this.context.indexValues);\r\n                for (let i=0; i<context.payValues.length; i++) {\r\n                \tfor (let j=0; j<this.context.payValues.length; j++) {\r\n                        if (context.payValues[i].uuid === this.context.payValues[j].uuid) {\r\n                            context.payValues[i].value = this.context.payValues[j].value;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (this.json_data.systemValues) {\r\n                context.systemValues = copy(this.json_data.systemValues);\r\n                if (context.systemValues.length===1) {\r\n                    context.systemValues = context.systemValues.concat([{},{},{},{},{},{},{},{},{},{}]);\r\n\t\t\t\t} else if (context.systemValues.length===9) {\r\n                    context.systemValues = context.systemValues.concat([{},{}]);\r\n\t\t\t\t} else if (context.systemValues.length===10) {\r\n                \tcontext.systemValues = context.systemValues.concat([{}]);\r\n\t\t\t\t}\r\n                context.systemValues[0].value = this.context.systemValues[0].value;\r\n                context.systemValues[1].value = this.context.systemValues[1].value;\r\n                context.systemValues[9].value = this.context.systemValues[9].value;\r\n            }\r\n\t\t\telse {\r\n                context.systemValues = copy(this.context.systemValues);\r\n\t\t\t}\r\n\r\n\t\t\tif (-1 === Utils.timeStamp) {\r\n                Utils.getTimeOffset().then(() => {Utils.updateContextTimeValues(context)}, null);\r\n            }\r\n            else {\r\n                let date = new Date(Utils.timeStamp * 1000);\r\n                context.systemValues[2].value = Utils.timeStamp;\r\n                context.systemValues[3].value = date.getFullYear();\r\n                context.systemValues[4].value = date.getMonth() + 1;\r\n                context.systemValues[5].value = date.getDate();\r\n                context.systemValues[6].value = date.getHours();\r\n                context.systemValues[7].value = date.getMinutes();\r\n                context.systemValues[8].value = date.getSeconds();\r\n                context.systemValues[10].value = date.getDay();\r\n\t\t\t}\r\n\r\n            if (isLoad && oldContext && oldContext.stack) {\r\n                context.stack = copy(oldContext.stack);\r\n\t\t\t\tcontext.cmdStack = copy(oldContext.cmdStack);\r\n            } else {\r\n                context.stack = [];\r\n                context.cmdStack = [];\r\n            }\r\n\t\t\tthis.context = context;\r\n\t\t},\r\n\r\n\t\tdoInCT: function (context, func) {\r\n\t\t\tif (context !== this.context) {\r\n\t\t\t\treturn Promise.reject('timeline changed');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn func();\r\n\t\t\t}\r\n\t\t},\r\n\r\n        txtLineSpace: function (fontSize) {\r\n            let space = 0;\r\n            if (fontSize==12 || fontSize==14 || fontSize==16 || fontSize==18) space = -4 + fontSize / 2;\r\n            else if (fontSize < 19) space = -5 + fontSize / 2;\r\n            else if (fontSize < 28) space = -6 + fontSize / 2;\r\n            else if (fontSize < 37) space = -7 + fontSize / 2;\r\n            else if (fontSize < 46) space = -9 + fontSize / 2;\r\n            else if (fontSize < 56) space = -10 + fontSize / 2;\r\n            else space = (-Math.ceil(fontSize / 5)) + fontSize / 2;\r\n            !this.viewComponent.game.device.desktop && (space -= 2);\r\n            return space;\r\n        },\r\n\r\n\t\tstopMusic: function (nextToPlay, isViewEvent = false) {\r\n            if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n            \tPhoneUtils.stopMusic();\r\n            } else {\r\n                if (nextToPlay && this.bk_music && nextToPlay === this.bk_music.key) {\r\n                    this.bk_music.stop();\r\n                } else if (this.bk_music) {\r\n                    this.bk_music.destroy();\r\n                    this.bk_music = null;\r\n                    this.decodeCacheAudio(nextToPlay);\r\n                }\r\n\t\t\t}\r\n\r\n\t\t\tResourcesManager.subRefCount('audio', ResourcesManager.usingKeyMap.music);\r\n\t\t\tResourcesManager.usingKeyMap.music = '';\r\n        },\r\n\r\n\t\tplayMusic: function (key, volume, loop, isViewEvent = false) {\r\n\t\t\tResourcesManager.usingKeyMap.music = key;\r\n\r\n\t\t\tif ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n\t\t\t\tPhoneUtils.playMusic(key, volume, loop);\r\n\t\t\t} else {\r\n                if (!this.bk_music || key !== this.bk_music.key) {\r\n                    this.bk_music = this.viewComponent.game.add.sound(key, volume, loop);\r\n                }\r\n                this.bk_music.play();\r\n\t\t\t}\r\n        },\r\n\r\n\t\tplayInheritMusic: function (volume) {\r\n\t\t\tResourcesManager.subRefCount('audio', ResourcesManager.usingKeyMap.music);\r\n\r\n            if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n            \tPhoneUtils.playInheritMusic(volume);\r\n            } else {\r\n                if (this.bk_music && volume !== undefined) {\r\n                    this.bk_music.volume = volume;\r\n                }\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tstopSound: function (index, nextToPlay, isViewEvent = false) {\r\n\t\t\tif (null === index || undefined === index) return;\r\n            if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n            \tPhoneUtils.stopSound(index);\r\n            } else {\r\n                if (nextToPlay && this.plotSounds[index] && nextToPlay === this.plotSounds[index].key) {\r\n                    this.plotSounds[index].stop();\r\n                } else if (this.plotSounds[index]) {\r\n                    this.plotSounds[index].destroy();\r\n                    this.plotSounds[index] = null;\r\n                    this.decodeCacheAudio(nextToPlay);\r\n                }\r\n            }\r\n\r\n\t\t\tResourcesManager.subRefCount('audio', ResourcesManager.usingKeyMap.sounds[index]);\r\n\t\t\tResourcesManager.usingKeyMap.sounds[index] = '';\r\n        },\r\n\r\n\t\tplaySound: function (index, key, volume, loop, isViewEvent = false) {\r\n\t\t\tResourcesManager.usingKeyMap.sounds[index] = key;\r\n\r\n\t\t\tif ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n\t\t\t\tPhoneUtils.playSound(index, key, volume, loop);\r\n\t\t\t} else {\r\n                if (!this.plotSounds[index] || this.plotSounds[index].key !== key) {\r\n                    this.plotSounds[index] = this.viewComponent.game.add.sound(key, volume, loop);\r\n                }\r\n                this.plotSounds[index].play();\r\n\t\t\t}\r\n        },\r\n\r\n\t\tplayInheritSound: function (index, volume) {\r\n\t\t\tResourcesManager.subRefCount('audio', ResourcesManager.usingKeyMap.sounds[index]);\r\n\r\n\t\t\tif ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n\t\t\t\tPhoneUtils.playInheritSound(index, volume);\r\n\t\t\t} else {\r\n                if (this.plotSounds[index] && volume !== undefined) {\r\n                    this.plotSounds[index].volume = volume;\r\n                }\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdecodeCacheAudio: function (nextToPlay) {\r\n\t\t\tif (nextToPlay) {\r\n\t\t\t\tlet sound = this.viewComponent.game.load.cache.getSound(nextToPlay);\r\n\t\t\t\tif (sound && !sound.decoded && !sound.isDecoding) {\r\n\t\t\t\t\tthis.viewComponent.game.sound.decode(nextToPlay);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet countDecoded = 0;\r\n            let audioKeys = this.viewComponent.game.load.cache.getKeys(Phaser.Cache.SOUND);\r\n\t\t\tfor (let i in audioKeys) {\r\n\t\t\t\tlet sound = this.viewComponent.game.load.cache.getSound(audioKeys[i]);\r\n\t\t\t\tif (sound.decoded || sound.isDecoding) countDecoded++;\r\n\t\t\t\tif (countDecoded > 4) return;\r\n\t\t\t}\r\n            audioKeys.some(k => {\r\n                let sound = this.viewComponent.game.load.cache.getSound(k);\r\n                if (!sound.decoded && !sound.isDecoding) {\r\n                \tthis.viewComponent.game.sound.decode(k);\r\n                \treturn true;\r\n\t\t\t\t} else {\r\n                \treturn false;\r\n\t\t\t\t}\r\n            })\r\n        },\r\n\r\n\t\ttoRealImageFontHeight: function(size) {\r\n            const t = this.json_data.font.size.target.height ? this.json_data.font.size.target.height : this.json_data.font.size.target;\r\n            return (parseFloat(size) * t / this.json_data.font.size.source);\r\n\t\t},\r\n\r\n\t\ttoRealImageFontWidth: function (size) {\r\n            const t = this.json_data.font.size.target.width ? this.json_data.font.size.target.width : this.json_data.font.size.target;\r\n            return (parseFloat(size) * t / this.json_data.font.size.source);\r\n        },\r\n\r\n        isWap3000: function(){\r\n            return (!flashvars.wap || (flashvars.wap && flashvars.wap === \"3000\"))\r\n        },\r\n\r\n\t\tExpression: class {\r\n\r\n\t\t\tstatic isString(data) {\r\n\t\t\t\treturn Object.prototype.toString.apply(data) === '[object String]';\r\n\t\t\t}\r\n\r\n\t\t\tstatic isArray(data) {\r\n\t\t\t\treturn Object.prototype.toString.apply(data) === '[object Array]';\r\n\t\t\t}\r\n\r\n\t\t\tstatic toN(x) {\r\n\t\t\t\tconst n = Number(x);\r\n\t\t\t\tif (isNaN(n)) {\r\n\t\t\t\t\tconsole.warn(`${x} is not a number`);\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn n;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tstatic toInt(x, radix = 10) {\r\n\t\t\t\tconst n = parseInt(x, radix);\r\n\t\t\t\tif (isNaN(n)) {\r\n\t\t\t\t\tconsole.warn(`${x} is not a int`);\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn n;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tstatic toWeek(x) {\r\n\t\t\t\tswitch (x)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 0: return 7;//'星期天';\r\n\t\t\t\t\tdefault: return x;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tstatic safeEval(expr, context) {\r\n\r\n\t\t\t\tconst evaluate = (expr, context) => {\r\n\t\t\t\t\tlet arg1;\r\n\t\t\t\t\tlet arg2;\r\n\t\t\t\t\tlet value;\r\n\t\t\t\t\tswitch (expr.type) {\r\n\t\t\t\t\t\tcase \"arg1\":\r\n\t\t\t\t\t\t\treturn evaluate(expr.arg1, context);\r\n\t\t\t\t\t\tcase \"+\":\r\n\t\t\t\t\t\t\targ1 = evaluate(expr.arg1, context);\r\n\t\t\t\t\t\t\targ2 = evaluate(expr.arg2, context);\r\n\t\t\t\t\t\t\tif (this.isString(arg1) || this.isString(arg2)) {\r\n\t\t\t\t\t\t\t\treturn ('#' + arg1 + arg2).slice(1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn this.add(evaluate(expr.arg1, context), evaluate(expr.arg2, context));\r\n\t\t\t\t\t\tcase \"-\":\r\n\t\t\t\t\t\t\targ1 = evaluate(expr.arg1, context);\r\n\t\t\t\t\t\t\targ2 = evaluate(expr.arg2, context);\r\n\t\t\t\t\t\t\tif (this.isString(arg1) || this.isString(arg2)) {\r\n\t\t\t\t\t\t\t\treturn (arg1 + '').split(arg2 + '').join('');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn this.sub(evaluate(expr.arg1, context), evaluate(expr.arg2, context));\r\n\t\t\t\t\t\tcase \"*\":\r\n\t\t\t\t\t\t\treturn this.mul(evaluate(expr.arg1, context), evaluate(expr.arg2, context));\r\n\t\t\t\t\t\tcase \"/\":\r\n\t\t\t\t\t\t\treturn this.div(evaluate(expr.arg1, context), evaluate(expr.arg2, context));\r\n\t\t\t\t\t\tcase \"%\":\r\n                            arg1 = parseInt(evaluate(expr.arg1, context));\r\n                            arg2 = parseInt(evaluate(expr.arg2, context));\r\n                            if (arg2 === 0) {\r\n                                Dialog.error('求余除数不能为 0');\r\n                                return 0;\r\n                            }\r\n\r\n                            return this.mod(arg1, arg2);\r\n\t\t\t\t\t\tcase \"==\":\r\n\t\t\t\t\t\t\treturn evaluate(expr.arg1, context) === evaluate(expr.arg2, context);\r\n\t\t\t\t\t\tcase \"!=\":\r\n\t\t\t\t\t\t\treturn evaluate(expr.arg1, context) !== evaluate(expr.arg2, context);\r\n\t\t\t\t\t\tcase \">\":\r\n\t\t\t\t\t\t\treturn evaluate(expr.arg1, context) > evaluate(expr.arg2, context);\r\n\t\t\t\t\t\tcase \"<\":\r\n\t\t\t\t\t\t\treturn evaluate(expr.arg1, context) < evaluate(expr.arg2, context);\r\n\t\t\t\t\t\tcase \">=\":\r\n\t\t\t\t\t\t\treturn evaluate(expr.arg1, context) >= evaluate(expr.arg2, context);\r\n\t\t\t\t\t\tcase \"<=\":\r\n\t\t\t\t\t\t\treturn evaluate(expr.arg1, context) <= evaluate(expr.arg2, context);\r\n\t\t\t\t\t\tcase \"min\":\r\n\t\t\t\t\t\t\treturn Math.min.apply(null,\r\n\t\t\t\t\t\t\t\texpr.args.map(arg => evaluate(arg, context))\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\tcase \"max\":\r\n\t\t\t\t\t\t\treturn Math.max.apply(null,\r\n\t\t\t\t\t\t\t\texpr.args.map(arg => evaluate(arg, context))\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\tcase \"all\":\r\n\t\t\t\t\t\t\treturn expr.args.map(arg => evaluate(arg, context)).every(v => v);\r\n\t\t\t\t\t\tcase \"any\":\r\n\t\t\t\t\t\t\treturn expr.args.map(arg => evaluate(arg, context)).some(v => v);\r\n\t\t\t\t\t\tcase \"literal\":\r\n\t\t\t\t\t\t\treturn Number(expr.value);\r\n                        case \"int\":\r\n                            return parseInt(this.toN(evaluate(expr.arg1, context)));\r\n                        case 'random':\r\n\t\t\t\t\t\t\tconst start = this.toInt(expr.range[0]);\r\n\t\t\t\t\t\t\tconst end = this.toInt(expr.range[1]);\r\n\t\t\t\t\t\t\treturn ~~(Math.random() * (end - start + 1) + start);\r\n\t\t\t\t\t\tcase 'value':\r\n\t\t\t\t\t\tcase 'savedValue':\r\n                        case 'payValue':\r\n                            value = [...context.values, ...context.savedValues, ...context.payValues]\r\n\t\t\t\t\t\t\t\t.find(v => v.uuid === expr.arg1);\r\n\t\t\t\t\t\t\treturn value.value !== undefined ? this.toN(value.value) : this.safeInitValue(value);\r\n                        case 'systemValue':\r\n                            value = context.systemValues.find(v => v.uuid === expr.arg1);\r\n                            if (value.value !== undefined) {\r\n                            \tif (value.uuid !== context.systemValues[0].uuid && value.uuid !== context.systemValues[1].uuid\r\n\t\t\t\t\t\t\t\t\t&& value.uuid !== context.systemValues[9].uuid) {\r\n                                    Utils.updateContextTimeValues(context);\r\n                                    //return this.toN(context.systemValues[2].value);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (value.uuid === context.systemValues[10].uuid) {\r\n                            \t\treturn this.toWeek(value.value);\r\n\t\t\t\t\t\t\t\t} else {\r\n                                    return this.toN(value.value);\r\n                                }\r\n\t\t\t\t\t\t\t} else {\r\n                            \treturn this.safeInitValue(value);\r\n\t\t\t\t\t\t\t}\r\n                        case 'indexValue':\r\n                        \tvalue = context.indexValues.find(v => v.uuid === expr.arg1);\r\n                            return value.value !== undefined ? this.toN(value.value) : this.safeInitValue(value);\r\n                        case \"string\":\r\n\t\t\t\t\t\t\treturn (expr.value + '');\r\n\t\t\t\t\t\tcase \"stringValue\":\r\n\t\t\t\t\t\t\tvalue = context.stringValues.find(v => v.uuid === expr.arg1);\r\n\t\t\t\t\t\t\treturn value.value !== undefined ? (value.value + '') : this.safeInitValue(value);\r\n\t\t\t\t\t\tcase 'reference':\r\n\t\t\t\t\t\t\tvalue = context.indexValues.find(v => v.uuid == expr.arg1);\r\n\t\t\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\t\t\tconst i = (value.value === undefined ? this.safeInitValue(value) : this.toN(value.value)) - 1;\r\n\t\t\t\t\t\t\t\tif (value.init.type === 'value') {\r\n\t\t\t\t\t\t\t\t\tif (i<0 || i>=context.values.length) {\r\n\t\t\t\t\t\t\t\t\t\tDialog.info('出现未知数值操作，请联系作者检查修改');\r\n\t\t\t\t\t\t\t\t\t\treturn '[未知数值]';\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\treturn context.values[i].value !== undefined ? this.toN(context.values[i].value) : this.safeInitValue(context.values[i]);\r\n                                }\r\n                                else if (value.init.type === 'savedValue') {\r\n                                    if (i<0 || i>=context.savedValues.length) {\r\n                                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n                                        return '[未知数值]';\r\n                                    }\r\n\t\t\t\t\t\t\t\t\treturn context.savedValues[i].value !== undefined ? this.toN(context.savedValues[i].value) : this.safeInitValue(context.savedValues[i]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse if (value.init.type === 'payValue') {\r\n                                    if (i<0 || i>=context.payValues.length) {\r\n                                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n                                        return '[未知数值]';\r\n                                    }\r\n                                    return context.payValues[i].value !== undefined ? this.toN(context.payValues[i].value) : this.safeInitValue(context.payValues[i]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse if (value.init.type === 'stringValue') {\r\n                                    if (i<0 || i>=context.stringValues.length) {\r\n                                        Dialog.info('出现未知数值操作，请联系作者检查修改');\r\n                                        return '[未知数值]';\r\n                                    }\r\n                                    return context.stringValues[i].value !== undefined ? (context.stringValues[i].value + '') : this.safeInitValue(context.stringValues[i]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcase \"contain\":\r\n\t\t\t\t\t\t\targ1 = evaluate(expr.arg1, context);\r\n\t\t\t\t\t\t\targ2 = evaluate(expr.arg2, context);\r\n\t\t\t\t\t\t\treturn (arg1 + '').indexOf(arg2 + '') > -1;\r\n\t\t\t\t\t\tcase \"stringLength\":\r\n\t\t\t\t\t\t\targ1 = evaluate(expr.arg1, context);\r\n\t\t\t\t\t\t\treturn arg1 ? arg1.length : 0;\r\n\t\t\t\t\t\tdefault :\r\n\t\t\t\t\t\t\tthrow new error(\"expr type  is  error\");\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn evaluate(expr, context);\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\treturn NaN;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tstatic safeInitValue(value) {\r\n\t\t\t\tfunction initValue(value) {\r\n\t\t\t\t\tif (value.init.type === 'const' || value.init.type === 'system') {\r\n\t\t\t\t\t\tvalue.value  = value.init.value;\r\n\t\t\t\t\t\treturn value.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (value.init.type === 'random') {\r\n\t\t\t\t\t\tconst start = Number(value.init.range[0]);\r\n\t\t\t\t\t\tconst end = Number(value.init.range[1]);\r\n\t\t\t\t\t\tvalue.value = ~~(Math.random() * (end - start + 1) + start);\r\n\t\t\t\t\t\treturn value.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (value.init.type === 'string') {\r\n\t\t\t\t\t\tvalue.value = (value.init.value + '');\r\n\t\t\t\t\t\treturn value.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (value.init.onlyRead) {\t// 索引\r\n\t\t\t\t\t\tvalue.value = value.init.value;\r\n\t\t\t\t\t\treturn value.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tconsole.error('unknown init type');\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn initValue(value);\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tstatic fix(expr, context) {\r\n\t\t\t\tconst {type, arg1, arg2, args, value:oldValue} = expr;\r\n\t\t\t\tconst newExpr = {type};\r\n\t\t\t\tlet value;\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tcase \"arg1\":\r\n\t\t\t\t\tcase \"stringLength\":\r\n\t\t\t\t\t\tconst fixArg1 = this.fix(arg1, context);\r\n\t\t\t\t\t\tif (!fixArg1) {\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnewExpr.arg1 = fixArg1;\r\n\t\t\t\t\t\treturn newExpr;\r\n\t\t\t\t\tcase \"+\":\r\n\t\t\t\t\tcase \"-\":\r\n\t\t\t\t\tcase \"*\":\r\n\t\t\t\t\tcase \"/\":\r\n\t\t\t\t\tcase \"%\":\r\n\t\t\t\t\tcase \"==\":\r\n\t\t\t\t\tcase \"!=\":\r\n\t\t\t\t\tcase \">\":\r\n\t\t\t\t\tcase \"<\":\r\n\t\t\t\t\tcase \">=\":\r\n\t\t\t\t\tcase \"<=\":\r\n\t\t\t\t\tcase \"contain\":\r\n\t\t\t\t\t\tnewExpr.arg1 = this.fix(arg1, context);\r\n\t\t\t\t\t\tnewExpr.arg2 = this.fix(arg2, context);\r\n\t\t\t\t\t\tif (!newExpr.arg1 || !newExpr.arg2) {\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn newExpr;\r\n\t\t\t\t\tcase \"min\":\r\n\t\t\t\t\tcase \"max\":\r\n\t\t\t\t\tcase \"all\":\r\n\t\t\t\t\tcase \"any\":\r\n\t\t\t\t\t\tconst fixArgs = args.map(arg => this.fix(arg, context));\r\n\t\t\t\t\t\tnewExpr.args = fixArgs.filter(arg => arg !== null);\r\n\t\t\t\t\t\treturn newExpr;\r\n\t\t\t\t\tcase \"literal\":\r\n\t\t\t\t\t\tnewExpr.value = Number(oldValue);\r\n\t\t\t\t\t\treturn newExpr;\r\n\t\t\t\t\tcase 'random':\r\n\t\t\t\t\t\tnewExpr.range = (expr.range || [0, 100]).map(value => this.toInt(value));\r\n\t\t\t\t\t\tnewExpr.range.sort();\r\n\t\t\t\t\t\treturn newExpr;\r\n\t\t\t\t\tcase 'value':\r\n\t\t\t\t\tcase 'savedValue':\r\n                    case 'payValue':\r\n                    case 'systemValues':\r\n\t\t\t\t\tcase 'indexValue':\r\n\t\t\t\t\t\tvalue = [...context.values, ...context.savedValues, ...context.payValues, ...context.systemValues, ...context.indexValues]\r\n\t\t\t\t\t\t\t.find(v => v.uuid === expr.arg1);\r\n\t\t\t\t\t\tif (value === undefined) {\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnewExpr.arg1 = arg1;\r\n\t\t\t\t\t\treturn newExpr;\r\n\t\t\t\t\tcase \"string\":\r\n\t\t\t\t\t\tnewExpr.value = (oldValue + '' || '');\r\n\t\t\t\t\t\treturn newExpr;\r\n\t\t\t\t\tcase \"stringValue\":\r\n\t\t\t\t\t\tvalue = context.stringValues.find(v => v.uuid === expr.arg1);\r\n\t\t\t\t\t\tif (value === undefined) {\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnewExpr.arg1 = arg1;\r\n\t\t\t\t\t\treturn newExpr;\r\n\t\t\t\t\tdefault :\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tstatic parseValue(string, context, isGetName) {\r\n\t\t\t\tconst parseValueFormat = /([\\s\\S]*)&(s|v|sv|p|x|i|iv)\\[(\\d+)\\]([\\s\\S]*)/;\r\n\t\t\t\tlet value = parseValueFormat.exec(string), nameStr;\r\n\t\t\t\tlet str = string;\r\n\t\t\t\twhile (value) {\r\n\t\t\t\t\tconst type = value[2];\r\n\t\t\t\t\tconst index = parseInt(value[3]);\r\n\t\t\t\t\tlet temp = '[未知数值]';\r\n\t\t\t\t\tif (type === 's' && context.savedValues[index]) {\r\n\t\t\t\t\t\tnameStr = '[' + 'Y' + (index + 1) + ':' + context.savedValues[index].name + ']';\r\n\t\t\t\t\t\ttemp = context.savedValues[index].value === undefined\r\n\t\t\t\t\t\t\t? this.safeInitValue(context.savedValues[index])\r\n\t\t\t\t\t\t\t: context.savedValues[index].value;\r\n\t\t\t\t\t\tif (isGetName) {\r\n\t\t\t\t\t\t\ttemp = nameStr;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n                            temp = this.toFixed(temp,2);\r\n                        }\r\n                    }\r\n\t\t\t\t\telse if (type === 'v' && context.values[index]) {\r\n\t\t\t\t\t\tnameStr = '[' + 'P' + (index + 1) + ':' + context.values[index].name + ']';\r\n\t\t\t\t\t\ttemp = context.values[index].value === undefined\r\n\t\t\t\t\t\t\t? this.safeInitValue(context.values[index])\r\n\t\t\t\t\t\t\t: context.values[index].value;\r\n\t\t\t\t\t\tif (isGetName) {\r\n\t\t\t\t\t\t\ttemp = nameStr;\r\n\t\t\t\t\t\t}\r\n \t\t\t\t\t\telse {\r\n                            temp = this.toFixed(temp,2);\r\n                        }\r\n                    }\r\n\t\t\t\t\telse if (type === 'sv' && context.stringValues[index]) {\r\n\t\t\t\t\t\tnameStr = '[' + 'Z' + (index + 1) + ':' + context.stringValues[index].name + ']';\r\n\t\t\t\t\t\ttemp = context.stringValues[index].value === undefined\r\n\t\t\t\t\t\t\t? this.safeInitValue(context.stringValues[index])\r\n\t\t\t\t\t\t\t: context.stringValues[index].value;\r\n\t\t\t\t\t\tif (isGetName) {\r\n\t\t\t\t\t\t\ttemp = nameStr;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n                    else if (type === 'p' && context.payValues[index]) {\r\n                        nameStr = '[' + 'X' + (index + 1) + ':' + context.payValues[index].name + ']';\r\n                        temp = context.payValues[index].value === undefined\r\n                            ? this.safeInitValue(context.payValues[index])\r\n                            : context.payValues[index].value;\r\n                        if (isGetName) {\r\n                            temp = nameStr;\r\n                        }\r\n                        else {\r\n                            temp = this.toFixed(temp,2);\r\n                        }\r\n                    }\r\n                    else if (type === 'x' && context.systemValues[index]) {\r\n\t\t\t\t\t\tif (-1 === Utils.timeStamp) {\r\n\t\t\t\t\t\t\tUtils.getTimeOffset().then(() => {\r\n\t\t\t\t\t\t\t\tUtils.updateContextTimeValues(context);\r\n\t\t\t\t\t\t\t}, () => {\r\n                                Dialog.info('当前网络不佳，获取系统时间失败');\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tUtils.updateContextTimeValues(context);\r\n\t\t\t\t\t\t}\r\n\r\n                        nameStr = '[' + 'S' + (index + 1) + ':' + context.systemValues[index].name + ']';\r\n                        temp = context.systemValues[index].value === undefined\r\n                            ? this.safeInitValue(context.systemValues[index])\r\n                            : index === 10 ? this.toWeek(context.systemValues[10].value) : context.systemValues[index].value;\r\n                        if (isGetName) {\r\n                            temp = nameStr;\r\n                        }\r\n                        else {\r\n                            temp = this.toFixed(temp,2);\r\n                        }\r\n                    }\r\n                    else if (type === 'i' && context.indexValues[index]) {\r\n                        nameStr = '[' + 'I' + (index + 1) + ':' + context.indexValues[index].name + ']';\r\n                        temp = context.indexValues[index].value === undefined ? this.safeInitValue(context.indexValues[index]) : context.indexValues[index].value;\r\n                        if (isGetName) {\r\n                            temp = nameStr;\r\n                        }\r\n                        else {\r\n                        \ttemp = this.toFixed(temp, 2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (type === 'iv') {\r\n\t\t\t\t\t\tif (index >= context.indexValues.length) {\r\n\t\t\t\t\t\t\ttemp = '[未知数值]';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n                            nameStr = '[' + 'IV' + (index + 1) + ':' + context.indexValues[index].name + ']';\r\n                            const i = (context.indexValues[index].value === undefined ? this.safeInitValue(context.indexValues[index]) : context.indexValues[index].value) - 1;\r\n                            if (isGetName) {\r\n                                temp = nameStr;\r\n                            }\r\n                            else {\r\n                                const ii = this.toFixed(i, 2);\r\n                                if (context.indexValues[index].init.type === 'value') {\r\n                                    if (i<0 || i>=context.values.length) {\r\n                                        temp = '[未知数值]';\r\n                                    }\r\n                                    else {\r\n                                        temp = context.values[ii].value === undefined ? this.safeInitValue(context.values[ii]) : context.values[ii].value;\r\n                                        temp = this.toFixed(temp, 2);\r\n                                    }\r\n                                }\r\n                                else if (context.indexValues[index].init.type === 'savedValue') {\r\n                                    if (i<0 || i>=context.savedValues.length) {\r\n                                        temp = '[未知数值]';\r\n                                    }\r\n                                    else {\r\n                                        temp = context.savedValues[ii].value === undefined ? this.safeInitValue(context.savedValues[ii]) : context.savedValues[ii].value;\r\n                                        temp = this.toFixed(temp, 2);\r\n                                    }\r\n                                }\r\n                                else if (context.indexValues[index].init.type === 'payValue') {\r\n                                    if (i<0 || i>=context.payValues.length) {\r\n                                        temp = '[未知数值]';\r\n                                    }\r\n                                    else {\r\n                                        temp = context.payValues[ii].value === undefined ? this.safeInitValue(context.payValues[ii]) : context.payValues[ii].value;\r\n                                        temp = this.toFixed(temp, 2);\r\n                                    }\r\n                                }\r\n                                else if (context.indexValues[index].init.type === 'stringValue') {\r\n                                    if (i<0 || i>=context.stringValues.length) {\r\n                                        temp = '[未知数值]';\r\n                                    }\r\n                                    else {\r\n                                        temp = context.stringValues[ii].value === undefined ? this.safeInitValue(context.stringValues[ii]) : context.stringValues[ii].value;\r\n                                    }\r\n                                }\r\n                            }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstr = value[1] + temp + value[4];\r\n\t\t\t\t\tvalue = parseValueFormat.exec(str);\r\n\t\t\t\t}\r\n\t\t\t\treturn str;\r\n\t\t\t}\r\n\r\n\t\t\tstatic parseWaitTime(data, show) {\r\n\t\t\t\tconst parsePauseFormat = /([\\s\\S]*)\\\\(\\d+)\\s([\\s\\S]*)/;\r\n\t\t\t\tlet value = parsePauseFormat.exec(data);\r\n\t\t\t\twhile (value) {\r\n\t\t\t\t\tif (show) {\r\n\t\t\t\t\t\tdata = value[1] + `[停顿:${value[2]}ms]` + value[3]\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata = value[1] + value[3];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalue = parsePauseFormat.exec(data);\r\n\t\t\t\t}\r\n\t\t\t\treturn data;\r\n\t\t\t}\r\n\r\n\t\t\tstatic getGameValueByTimer(timer, context) {\r\n\t\t\t\tlet value = {};\r\n\t\t\t\tif (!timer) {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t}\r\n\t\t\t\tconst { type, arg1 } = timer.time;\r\n\r\n\t\t\t\tif (type === 'value') {\r\n\t\t\t\t\tvalue = context.values.find(v => v.uuid === arg1)\r\n\t\t\t\t} else if (type === 'savedValue') {\r\n\t\t\t\t\tvalue = context.savedValues.find(v => v.uuid === arg1)\r\n\t\t\t\t} else if (type === 'literal') {\r\n\t\t\t\t\tvalue.value = timer.time.value\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t}\r\n\t\t\t\tconst countDown = value && value.value === undefined\r\n\t\t\t\t\t? this.safeInitValue(value)\r\n\t\t\t\t\t: value.value;\r\n\t\t\t\treturn Math.max(countDown, 0);\r\n\t\t\t}\r\n\r\n            static add(num1, num2) {\r\n                let len1 = 0, len2 = 0, m = 1;\r\n                try {\r\n                    len1 = num1.toString().split('.')[1].length;\r\n                } catch (e) {\r\n                }\r\n                try {\r\n                    len2 = num2.toString().split(\".\")[1].length;\r\n                } catch (e) {\r\n                }\r\n                m = Math.max(len1, len2);\r\n                num1 = parseInt(num1.toString().replace(\".\", \"\")) * Math.pow(10, m - len1);\r\n                num2 = parseInt(num2.toString().replace(\".\", \"\")) * Math.pow(10, m - len2);\r\n                return (num1 + num2) / Math.pow(10, m);\r\n            }\r\n\r\n            static sub(num1, num2) {\r\n                let len1 = 0, len2 = 0, m = 1;\r\n                try {\r\n                    len1 = num1.toString().split('.')[1].length;\r\n                } catch (e) {\r\n                }\r\n                try {\r\n                    len2 = num2.toString().split(\".\")[1].length;\r\n                } catch (e) {\r\n                }\r\n                m = Math.max(len1, len2);\r\n                num1 = parseInt(num1.toString().replace(\".\", \"\")) * Math.pow(10, m - len1);\r\n                num2 = parseInt(num2.toString().replace(\".\", \"\")) * Math.pow(10, m - len2);\r\n                return (num1 - num2) / Math.pow(10, m);\r\n            }\r\n\r\n            static div(num1, num2) {\r\n                if (!num2) {\r\n                \tDialog.error('除数不能为 0');\r\n                    return 0;\r\n                }\r\n                let len1 = 0, len2 = 0, temp;\r\n                try {\r\n                    len1 = num1.toString().split('.')[1].length;\r\n                } catch (e) {\r\n                }\r\n                try {\r\n                    len2 = num2.toString().split(\".\")[1].length;\r\n                } catch (e) {\r\n                }\r\n                temp = parseInt(num1.toString().replace(\".\", \"\")) / parseInt(num2.toString().replace(\".\", \"\"));\r\n                if (len2 - len1 < 0 || temp !== parseInt(temp)) {\r\n                    return this.mul(temp, Math.pow(10, len2 - len1));\r\n                }\r\n                return temp * Math.pow(10, len2 - len1);\r\n            }\r\n\r\n            static mul(num1, num2) {\r\n                let m = 0, str1 = num1.toString(), str2 = num2.toString();\r\n                try {\r\n                    m += str1.includes('1e-') ? parseInt(str1.split('1e-')[1]) : str1.split(\".\")[1].length\r\n                } catch (e) {\r\n                }\r\n                try {\r\n                    m += str2.includes('1e-') ? parseInt(str2.split('1e-')[1]) : str2.split(\".\")[1].length\r\n                } catch (e) {\r\n                }\r\n                return parseInt(str1.replace(\".\", \"\")) * parseInt(str2.replace(\".\", \"\")) / Math.pow(10, m);\r\n            }\r\n\r\n            static mod(num1, num2) {\r\n                let len1 = 0, len2 = 0, m = 1;\r\n                try {\r\n                    len1 = num1.toString().split('.')[1].length;\r\n                } catch (e) {\r\n                }\r\n                try {\r\n                    len2 = num2.toString().split(\".\")[1].length;\r\n                } catch (e) {\r\n                }\r\n                m = Math.pow(10, Math.max(len1, len2));\r\n                return ((num1 * m) % (num2 * m)) / m;\r\n            }\r\n\r\n            static toFixed(value = 0, fixed = 2) {\r\n                let len = 0;\r\n                try {\r\n                    len = value.toString().split(\".\")[1].length;\r\n                } catch (e) {\r\n                }\r\n                let str = value.toString();\r\n                if (len > fixed && fixed >= 0) {\r\n                    str = str.substring(0, str.indexOf('.') + fixed + 1);\r\n                    len = fixed;\r\n                }\r\n                value = parseInt(str.replace(\".\", \"\"));\r\n                return value / Math.pow(10, len);\r\n            }\r\n        }\r\n\t},\r\n\r\n\t// CLASS MEMBERS\r\n\t{\r\n\t\t/**\r\n\t\t * The TextProxy's name.\r\n\t\t *\r\n\t\t * @static\r\n\t\t * @type {string}\r\n\t\t */\r\n\t\tNAME: 'SceneProxy'\r\n\t\t, guideLayer:null \t\t//指引层\r\n\t\t, logo: null\t\t\t// Logo层\r\n\t\t, coverLayer: null\t\t// 封面层\r\n\t\t, progressLayer: null\t// 进度条层\r\n\t\t, dialogLayer: null\t\t// 对话框层\r\n\t\t, menuLayer: null\t\t// 菜单层\r\n\t\t, mainMenuLayer: null\t// 主菜单层\r\n\t\t, settingsLayer: null\t// 设置层\r\n\t\t, recordLayer: null\t\t// 保存的进度层\r\n\t\t, playBackLayer: null\t// 回放层\r\n\t\t, weatherLayer: null\t// 天气\r\n\t\t, charsAndPropsLayer: null\t// 角色&道具层\r\n\t\t, optionLayer: null\t\t// 选项层\r\n\t\t, plotViewsLayer: null\t// 剧情高级UI层\r\n\t\t, globalViews: null\t\t// 全局高级UI\r\n\t\t, plotViews: null\t\t// 剧情高级UI\r\n\t\t, prgsViews: null\t\t// 高级UI进度条\r\n\t\t, endLayer: null\t\t// 结尾层\r\n\t\t, toastLayer: null\t\t// toast层\r\n\t\t, loadingToastLayer: null\t// 加载中提示层\r\n\t\t, quickPlayLayer: null\t// 快速播放提示层\r\n\r\n\t\t, bk_music: null\t\t// 背景音乐\r\n\t\t, plotSounds: null\t\t// 剧情音效\r\n\t\t, btn_sound: null\t\t// 按钮音效\r\n\t\t, audioDecodedCount: 0\t// 自动解码的音频数\r\n\r\n\t\t, lstPlotBkKey: null\t// 前一个剧情背景Key\r\n\t\t, lstPlotBkOpacity: 0\t// 前一剧情背景透明度\r\n\t\t, lstPlotBkFlex: 1\t\t// 前一剧情背景flex\r\n\t\t, lstGameBk: null\t\t// 上一张游戏背景\r\n\t\t, curPlotLayer: null\t// 当前播放剧情层\r\n\t\t, lstPlotLayer: null\t// 上一剧情层\r\n\r\n\t\t, viewComponent: null\r\n\r\n\t\t// data\r\n\t\t, json_data: {}\t\t\t// 游戏json数据\r\n\t\t, Template: {}\t\t\t// 游戏中模板数据\r\n\t\t, stringMap: {}\t\t\t// 文本映射\r\n\t\t, progressTips: []\t\t// 加载tip\r\n\t\t, unlockChapterCallBack: null\t// 解锁付费章节回调\r\n\t\t, mallPayCallback: null\t// 商城购买回调\r\n\r\n\t\t, context: {}\t\t\t// 播放过程的数据\r\n\t\t, plotSnap: null\t\t// 剧情快照(可用于存档缩略图)\r\n\t\t, savedPlotsData: null\t// 存档数据\r\n\t\t, cloudPlotsData: null\t// 云端存档数据\r\n\t\t, recUidBelongTo: ''\t// 存档所属UID\r\n\t\t, gameUidBelongTo: ''\t// 游戏所属UID\r\n\t\t, bSwitchAccInPlot: true\t// 是否在剧情中切换账号\r\n\t\t, payValueUid: ''\t\t// payValues所属UID\r\n\t\t, playPause: false\t\t// 是否已暂停播放\r\n\t\t, bViewLoaded: false\t// 全局UI已初始化\r\n\t\t, bSignedIn: false\t\t// 是否已登录\r\n\t\t, bCloudSel: false\t\t// 是否选择云端存档\r\n\r\n\t\t, curChapter: null\t\t// 当前播放的章节信息\r\n\t\t, curPlotInfo: null\t\t// 当前展示的剧情信息\r\n\t\t, curPlotIndex: 0\t\t// 当前播放剧情索引\r\n\t\t, cmdPlotSnap: null\t\t// 高级剧情快照\r\n\t\t, curCmdUuid: ''\t\t// 当前剧情指令UUID\r\n\t\t, bCmdAutoText: false\t// 高级剧情是否自动播放\r\n\t\t, lstDialogInfo: null\t// 高级剧情对话框信息\r\n\t\t, menuInfo: null\t\t// 高级剧情菜单信息\r\n\t\t, charsAndPropsInfo: []\t// 高级剧情人物道具信息\r\n\t\t, bToSaveFile: true\t\t// 是否为保存进度(false = 读取存档)\r\n\r\n\t\t, space_key: null       // 空格键\r\n        , globalViewKeys: null  // 高级UI消息键\r\n        , plotViewKeys: null    // 剧情UI消息键\r\n\t\t, quickPlay: false     // 快速播放\r\n\t\t, isScreenHold: false\t// 屏幕是否按住\r\n\t\t, isShowGuide:true    //是否需要显示引导层（存档提示引导层）\r\n\t\t, recordTipCount:0\t\t//存档引导提示次数\r\n\t\t, visibleLayout: []\t\t// 所有显示层\r\n\t\t, resourceManager: {}\r\n\t\t, lstPlotTweens: []\r\n\t\t, twinkleTimer: null\t// 闪烁计时器\r\n\t\t, uiOnLoadQueue: []\t\t// 高级UIonLoad事件回调队列\r\n\t\t, timerCounts: []\t\t// 计时组件已计时次数(用于读档时恢复计时次数)\r\n\t\t, menuTimer: []\t\t\t// 自制菜单中的计时器\r\n\r\n\t\t, cmdPlotNextPromise: null\t// 高级剧情前一指令Promise处理器\r\n\t\t, cmdPlayHandlerFun: null\t// 高级剧情playHandler函数指针\r\n\t\t, curCmdInfo: null\t\t\t// 当前执行指令信息\r\n\t\t, curCmdIndex: 0\t\t\t// 当前执行指令索引\r\n\t\t, preWaitCmdUuid: ''\t\t// 前一个等待指令uuid\r\n\r\n\t\t, isGameStarted: false\t\t// 记录游戏是否已开始\r\n\t\t, usedStarCount: 0\t\t\t// 已使用的星星数\r\n\t\t, gameStarLimit: 0\t\t\t// 单作品可用星星上限\r\n        , isPaying:\tfalse\t\t\t// 是否正在进行pay操作\r\n\t\t, isGettingNext: false\t\t// 是否正在获取下一剧情信息\r\n\t}\r\n);","/**\r\n * @class demo.view.TextComponent\r\n * @implements EventListener\r\n *\r\n * TextComponent is implemented without any abstract concept of a UiComponent\r\n * or Sprite, and uses standard HTML5 methods to manipulate the DOM. It\r\n * does however implement the {@link #handleEvent W3C EventListener interface}\r\n * which means it can be passed directly to HTMLElement#addEventListener, rather\r\n * than providing a Function, leading to tidier code and no need for Function#bind\r\n * to preserve the execution scope of its methods.\r\n */\r\nimport puremvc from 'puremvc';\r\nimport * as Xhr from '../../common/XmlHttpRequest.js';\r\nimport RePhaser from '../../common/RePhaser.js';\r\nimport Utils, {ResourcesManager, AudioTagPool} from '../../common/Utils.js';\r\nimport commit from '../../common/Version.js';\r\nimport PhoneUtils from '../../common/PhoneUtils.js';\r\nimport FontUtils from '../../common/FontUtils.js';\r\n\r\npuremvc.define\r\n(\r\n    // CLASS INFO\r\n    {\r\n        name: 'diygamePlayer.view.component.Scene',\r\n\r\n        /** @constructor */\r\n        constructor: function () {\r\n            var scene = this;\r\n            var state = {\r\n                init: function () {\r\n                    // Delete this init block or replace with your own logic.\r\n\r\n                    !scene.game.device.desktop && (scene.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL);\r\n                    scene.game.scale.fullScreenScaleMode = Phaser.ScaleManager.SHOW_ALL;\r\n                    scene.game.scale.pageAlignVertically = true;\r\n                    scene.game.scale.pageAlignHorizontally = true;\r\n                    scene.game.stage.disableVisibilityChange = true;\r\n\r\n                    scene.game.scale.setResizeCallback((scaleManager, rectangle) => {\r\n                        const game = document.getElementById(\"game\");\r\n                        game.style.width = document.body.clientWidth + 'px';\r\n                        game.style.height = document.body.clientHeight + 'px';\r\n                        if (document.body.clientWidth > document.body.clientHeight) {\r\n                            if (scene.game.world.angle !== 0) {\r\n                                scene.game.scale.setGameSize(960, 540);\r\n                                scene.game.world.angle = 0;\r\n                                scene.game.world.setBounds(0, 0, 960, 540);\r\n                                scene.game.scale.refresh();\r\n                            }\r\n                        } else {\r\n                            if (scene.game.world.angle !== 90) {\r\n                                scene.game.scale.setGameSize(540, 960);\r\n                                scene.game.world.angle = 90;\r\n                                scene.game.world.setBounds(-960, 0, 960, 540);\r\n                                scene.game.scale.refresh();\r\n                            }\r\n                        }\r\n                    });\r\n                    scene.game.load.loadImageTag = RePhaser.loadImageTag;\r\n                    scene.game.load.onSoundLoadExtend = new Phaser.Signal();\r\n                    PhoneUtils.load = scene.game.load;\r\n                    scene.game.renderer.renderSession.roundPixels = true;\r\n                    scene.game.sound.decode = RePhaser.soundDecode;\r\n                    scene.game.sound.onSoundDecodeError = new Phaser.Signal();\r\n\r\n                    //fix iOS audio tag volume always stays set at 1\r\n\r\n                    const init = () => {\r\n                        scene.game.sound.touchLocked = false;\r\n                        AudioTagPool.fill();\r\n                        const keys = scene.game.cache.getKeys(Phaser.Cache.SOUND);\r\n                        keys.forEach(key => {\r\n                            var sound = scene.game.cache.getSound(key);\r\n                            if (sound && !AudioTagPool.exist(sound.data)) {\r\n                                scene.game.cache.reloadSound(key);\r\n                            }\r\n                        });\r\n                    };\r\n\r\n                    if (scene.game.device.iOS) {\r\n                        if (scene.game.device.iOSVersion > 8) {\r\n                            scene.game.input.touch.addTouchLockCallback(init, scene.game, true);\r\n                        } else {\r\n                            scene.game.input.touch.addTouchLockCallback(init, scene.game);\r\n                        }\r\n                    } else {\r\n                        init();\r\n                    }\r\n\r\n                    ResourcesManager.cache = scene.game.cache;\r\n                    scene.game.destroyComponent.add(key => ResourcesManager.subRefCount('img', key, 'play'));\r\n                    window.ResourcesManager = ResourcesManager;\r\n                },\r\n                preload: function () {\r\n                },\r\n                create: function () {\r\n                    this.game.canvas.oncontextmenu = e => e.preventDefault();\r\n                    // State create logic goes here\r\n                    // Create simple text display for current Phaser version\r\n                    let startBk = scene.game.add.graphics(0, 0);\r\n                    startBk.name = 'startBk';\r\n                    startBk.beginFill(0x62d3d5);\r\n                    startBk.drawRect(0, 0, 960, 540);\r\n                    startBk.endFill();\r\n                    if (scene.onRendered) {\r\n                        scene.onRendered();\r\n                    }\r\n                },\r\n                update: function () {\r\n                    // State Update Logic goes here.\r\n                }\r\n            };\r\n            // 闪退手机浏览器版本: Chrome/50.0.2661.86 & Chrome/51.0.2704.81 渲染方式改为自动\r\n            let phaserRender = Phaser.CANVAS;\r\n            let agentV = navigator.userAgent.match(/chrome\\/((([0-9]*)+(\\.))*)+([0-9]*)/gi);\r\n            if (agentV) {\r\n                if (agentV[0] == 'Chrome/50.0.2661.86' || agentV[0] == 'Chrome/51.0.2704.81') {\r\n                    if (-1 === navigator.userAgent.indexOf('Android 6.0.1; MI 4LTE')\r\n                        && -1 === navigator.userAgent.indexOf('vivo Y67')) {\r\n                        phaserRender = Phaser.AUTO;\r\n                    }\r\n                }\r\n                else if (agentV[0] == 'Chrome/46.0.2490.76' && -1 !== navigator.userAgent.indexOf('OPPO R9s')) {\r\n                    phaserRender = Phaser.AUTO;\r\n                }\r\n            }\r\n            scene.game = new Phaser.Game(\r\n                960,\r\n                540,\r\n                phaserRender,\r\n                'game',\r\n                state\r\n            );\r\n            scene.game.preserveDrawingBuffer = true;\r\n            window.game = scene.game;\r\n            window['AudioContext'] = null;\r\n            window['webkitAudioContext'] = null;\r\n            console.log('versionCommit: ', commit);\r\n        }\r\n    },\r\n\r\n    // INSTANCE MEMBERS\r\n    {\r\n        showLogo: function () {\r\n            let logo_preloader = this.game.world.getByName('logo_preloader');\r\n            if (!logo_preloader) {\r\n                logo_preloader = this.game.add.image(this.game.world.width / 2, this.game.world.height / 2, 'logo_preloader');\r\n                logo_preloader.name = 'logo_preloader';\r\n                logo_preloader.anchor.setTo(0.5, 0.5);\r\n            }\r\n            logo_preloader.visible = true;\r\n        },\r\n\r\n        //离线背景图片\r\n        showOfflineBg:function () {\r\n            let offlinebg = this.game.world.getByName('offlinebg');\r\n            if (!offlinebg) {\r\n                const opg = Utils.localStorageGetItem('shanyi3000opg');\r\n                offlinebg = this.game.add.image(this.game.world.width / 2, this.game.world.height / 2, opg ? 'offlinebg' : 'Operation_tip');\r\n                offlinebg.name = 'offlinebg';\r\n                offlinebg.inputEnabled = true;\r\n                offlinebg.anchor.setTo(0.5, 0.5);\r\n                this.game.world.setChildIndex(offlinebg,1);//放底部\r\n            }\r\n            offlinebg.visible = true;\r\n        },\r\n\r\n        showLoading: function () {\r\n            let logo_preloader = this.game.world.getByName('logo_preloader');\r\n            let loading_gif = this.game.world.getByName('loading_gif');\r\n            if (!loading_gif) {\r\n                loading_gif = this.game.add.image(this.game.world.width / 2, this.game.world.height / 2, 'loading_gif');\r\n                loading_gif.x = 369;\r\n                loading_gif.y = 80;\r\n                loading_gif.name = 'loading_gif';\r\n                this.addGifAnimation(loading_gif);\r\n            }\r\n            if (logo_preloader) {\r\n                logo_preloader.scale.setTo(0.35, 0.35);\r\n                logo_preloader.x = this.game.world.width - logo_preloader.width + 25;\r\n                logo_preloader.y = this.game.world.height - logo_preloader.height + 12;\r\n            }\r\n            loading_gif.visible = true;\r\n            return true;\r\n        },\r\n\r\n        destroyLogo: function () {\r\n            const startBk = this.game.world.getByName('startBk');\r\n            const logo_preloader = this.game.world.getByName('logo_preloader');\r\n            const loading_gif = this.game.world.getByName('loading_gif');\r\n            const logInfo = this.game.world.getByName('logInfo');\r\n            //const offlinebg = this.game.world.getByName(\"offlinebg\");\r\n            startBk && startBk.destroy();\r\n            logo_preloader && logo_preloader.destroy();\r\n            loading_gif && loading_gif.destroy();\r\n            logInfo && logInfo.destroy();\r\n            //offlinebg && offlinebg.destroy();\r\n        },\r\n\r\n        preLoadCertainAssets: function () {\r\n            this.game.load.spritesheet('wind', './img/wind.png', 960, 540);\r\n            this.game.load.image('icon_back', './img/icon_back.png');\r\n            this.game.load.image('icon_back_over_pressed', './img/icon_back_over_pressed.png');\r\n            this.game.load.image('icon_candy', './img/icon_candy.png');\r\n            this.game.load.image('icon_candy_over_pressed', './img/icon_candy_over_pressed.png');\r\n            this.game.load.image('icon_get', './img/icon_get.png');\r\n            this.game.load.image('icon_get_hover_pressed', './img/icon_get_hover_pressed.png');\r\n            this.game.load.image('icon_save', './img/icon_save.png');\r\n            this.game.load.image('icon_save_over_pressed', './img/icon_save_over_pressed.png');\r\n            //this.game.load.image('logo_preloader', './img/logo_preloader.png');\r\n            //this.game.load.image('loading_gif', './img/loading_gif.gif');\r\n            this.game.load.image('cloud', './img/cloud.png');\r\n            this.game.load.image('cloud_hover', './img/cloud_hover.png');\r\n            this.game.load.image('local', './img/local.png');\r\n            this.game.load.image('local_hover', './img/local_hover.png');\r\n            this.game.load.image('icon_success', './img/icon_success.png');\r\n            this.game.load.image('icon_error', './img/icon_error.png');\r\n            this.game.load.image('light', './img/light.png');\r\n            this.game.load.image('toast_loading', './img/toast_loading.gif');\r\n            this.game.load.image('app_button_speed', './img/app_button_speed.png');\r\n            this.game.load.image('app_icon_speed', './img/app_icon_speed.png');\r\n            this.game.load.image('Operation_tip', './img/Operation_tip.png');\r\n            this.game.load.image('Cloud_record_tip', './img/Cloud_record_tip.png');\r\n            this.game.load.image('offlinebg','./img/offlinebg.png');//离线背景图片\r\n            this.game.load.image('Continue', './img/Continue.png');\r\n            this.game.load.image('menuMore', './img/more.png');\r\n            this.game.load.image('menuMoreHover', './img/more_hover.png');\r\n\r\n            if (flashvars.offline === '1') {\r\n                for (let i=0; i<50; i++) {\r\n                    this.game.load.image('/weather/rain/xiayu_' + Utils.formatNum(i) + '.png', './img/rain/xiayu_' + Utils.formatNum(i) + '.png');\r\n                }\r\n                for (let i=0; i<120; i++) {\r\n                    this.game.load.image('/weather/snow/xuehua_' + Utils.formatNum(i) + '.png', './img/snow/xuehua_' + Utils.formatNum(i) + '.png');\r\n                }\r\n                for (let i=0; i<90; i++) {\r\n                    this.game.load.image('/weather/mapleLeaves/fengye_' + Utils.formatNum(i) + '.png', './img/mapleLeaves/fengye_' + Utils.formatNum(i) + '.png');\r\n                }\r\n                for (let i=0; i<90; i++) {\r\n                    this.game.load.image('/weather/beachBlossom/taohua_' + Utils.formatNum(i) + '.png', './img/beachBlossom/taohua_' + Utils.formatNum(i) + '.png');\r\n                }\r\n                for (let i=0; i<90; i++) {\r\n                    this.game.load.image('/weather/blossom/yinghua_' + Utils.formatNum(i) + '.png', './img/blossom/yinghua_' + Utils.formatNum(i) + '.png');\r\n                }\r\n                for (let i=0; i<50; i++) {\r\n                    this.game.load.image('/weather/lightning/shandian_' + Utils.formatNum(i) + '.png', './img/lightning/shandian_' + Utils.formatNum(i) + '.png');\r\n                }\r\n            }\r\n        },\r\n\r\n        preLoad: function () {\r\n            return new Promise((resolve, reject) => {\r\n                this.preLoadCertainAssets();\r\n\r\n                this.game.load.onLoadStart.addOnce(() => {\r\n                    this.addLog('正在准备播放..')\r\n                });\r\n                this.game.load.onFileComplete.add((progress, cacheKey, success, totalLoaded, totalFiles) => {\r\n                    //if ('logo_preloader' === cacheKey) this.showLogo();\r\n                    if(\"offlinebg\" === cacheKey) this.showOfflineBg();\r\n                    this.addLog('正在准备播放.. ' + progress + \"%\", true);\r\n                });\r\n                this.game.load.onLoadComplete.addOnce(() => {\r\n                    this.game.load.onFileComplete.removeAll();\r\n                    this.addLog(\"正在准备播放..【成功】\", true);\r\n                    return resolve();\r\n                });\r\n\r\n                this.game.load.start();\r\n            })\r\n        },\r\n\r\n        getGameJson: function () {\r\n            flashvars.uuid = flashvars.uuid || '41138941-7f1c-4701-9a94-394893483662';\r\n            const uuid = flashvars.uuid;\r\n\r\n            document.title = flashvars.name && decodeURI(flashvars.name) || \"测试\";\r\n\r\n            const onProgress = evt => {\r\n                if (evt.lengthComputable) {\r\n                    const percentComplete = evt.loaded / evt.total;\r\n                    this.addLog(\"加载剧情配置.. \" + ~~percentComplete + '%', true);\r\n                } else {\r\n                    this.addLog(\"加载剧情配置.. \" + evt.loaded, true);\r\n                }\r\n            };\r\n\r\n            this.addLog(\"加载剧情配置..\");\r\n\r\n            const getGame = flashvars.type == 1 ? Xhr.getTestGame : Xhr.getGame;\r\n            return getGame(uuid, onProgress).then(game => {\r\n                this.addLog(\"加载剧情配置..【成功】\", true);\r\n                return game;\r\n            }, e => {\r\n                this.addLog(\"发生错误：\" + e);\r\n                return Promise.reject(e);\r\n            });\r\n        },\r\n\r\n        addLog: function (info, replace) {\r\n            if (!info) {\r\n                return;\r\n            }\r\n            let logInfo = this.game.world.getByName('logInfo');\r\n            if (!logInfo) {\r\n                const style = {font: \"16px 宋体\", fill: \"#fff\"};\r\n                logInfo = this.game.add.text(18, 540 - 36, '', style);\r\n                logInfo.name = 'logInfo';\r\n            }\r\n            let text = logInfo.text;\r\n            const textGroup = text.split(/\\r?\\n/gi).filter(t => !!t);\r\n            if (replace) {\r\n                textGroup[textGroup.length - 1] = info;\r\n            } else {\r\n                textGroup.push(info);\r\n            }\r\n            logInfo.text = '';\r\n            textGroup.slice(-4).map(str => logInfo.text += str + '\\n');\r\n            logInfo.y = 540 - textGroup.length * 26 + 5;\r\n        },\r\n\r\n        addButton: function (x, y, width, height, key_normal, key_active, onClick, text, audio, name, parent, isCheckBox) {\r\n            const changeImageText = (textInfo, content, width, height, textObj) => {\r\n                const txtImgOld = textObj.children[0];\r\n                const strContent = content ? content : txtImgOld ? txtImgOld.text : '';\r\n\r\n                if (!strContent) {\r\n                    return;\r\n                }\r\n\r\n                const fontSize = textInfo.fontSize ? parseInt(textInfo.fontSize) : 25;\r\n                const color = textInfo.color ? textInfo.color : '#fefefe';\r\n                const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(fontSize) : fontSize;\r\n                const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(fontSize) : fontSize;\r\n                if (color.indexOf('rgb') !== -1) {\r\n                    const rgb = color.replace('rgb(', '').replace(')', '').split(',');\r\n                    textObj.addColor('#' + ('00000' + (parseInt(rgb[0]) << 16 | parseInt(rgb[1]) << 8 | parseInt(rgb[2])).toString(16)).substr(-6), 0);\r\n                }\r\n                else {\r\n                    textObj.addColor(color === '#ffffff' ? '#fefefe' : color, 0);\r\n                }\r\n                textObj.wordWrapWidth = 540/*width*/;\r\n                this.sceneProxy.addImageFontText([{data:strContent}], fw, fh, textObj, this.sceneProxy.context);\r\n                const w = textObj.children[0].extWidth ? textObj.children[0].extWidth : fw * strContent.length;\r\n                const x = (width - w) / 2 - (textObj.children[0].extMargin ? textObj.children[0].extMargin : 0);\r\n                const y = (height - fh) / 2;\r\n                textObj.children[0].x = x;\r\n                textObj.children[0].y = y;\r\n                textObj.children[0].text = strContent;\r\n\r\n                if (txtImgOld) {\r\n                    txtImgOld.children.forEach(item => item.fontImg.destroy());\r\n                    txtImgOld.destroy();\r\n                }\r\n\r\n                textObj.text = ' ';\r\n            };\r\n            const changeBackground = (buttonGroup, key, text, clear) => {\r\n                const background = buttonGroup.getByName('background');\r\n                const btnObj = buttonGroup.getByName('button');\r\n                const txtObj = buttonGroup.getByName('text');\r\n                const bk_key = this.game.load.cache.checkImageKey(key) ? key : null;\r\n\r\n                if (!btnObj) {\r\n                    return\r\n                }\r\n\r\n                if (txtObj && text) {\r\n                    if (FontUtils.fontFamily) {\r\n                        changeImageText(text, '', width, height, txtObj);\r\n                    }\r\n                    else {\r\n                        txtObj.font = text.fontFamily　|| txtObj.font;\r\n                        txtObj.fontSize = text.fontSize ||　txtObj.fontSize;\r\n                        txtObj.fontWeight = text.fontWeight || txtObj.fontWeight;\r\n                        txtObj.fill = text.color ||　txtObj.fill;\r\n                    }\r\n\r\n                    txtObj.visible = !text.hidden;\r\n                }\r\n                if (bk_key) {\r\n                    let scale = 1;\r\n                    const {width, height} = btnObj;\r\n                    const image = this.game.cache.getImage(bk_key);\r\n\r\n                    if (!image.delay) {\r\n                        scale = Math.min(width / image.width, height / image.height);\r\n                        background.loadTexture(bk_key);\r\n                        background.scale.setTo(scale, scale);\r\n                        background.x = (width - background.width) / 2;\r\n                        background.y = (height - background.height) / 2;\r\n                    }\r\n                    else if (background.key !== bk_key) {\r\n                        this.addGifAnimation(background, bk_key);\r\n                    }\r\n                } else if (!clear) {\r\n                    background.loadTexture(null);\r\n                }\r\n            };\r\n\r\n            const btnGroup= this.game.add.group();\r\n            btnGroup.name = name;\r\n            parent && parent.add(btnGroup);\r\n            btnGroup.x = x;\r\n            btnGroup.y = y;\r\n\r\n            const bk_key_normal = this.game.load.cache.checkImageKey(key_normal) ? key_normal : null;\r\n            const bk_key_active = this.game.load.cache.checkImageKey(key_active) ? key_active : null;\r\n            const bk = this.game.add.image(0, 0, bk_key_normal, null, btnGroup);\r\n            bk.name = 'background';\r\n            const scale = Math.min(width / bk.width, height / bk.height);\r\n            bk.scale.setTo(scale, scale);\r\n            bk.x = (width - bk.width) / 2;\r\n            bk.y = (height - bk.height) / 2;\r\n            this.addGifAnimation(bk, bk_key_normal);\r\n\r\n            const btn = this.game.add.button(0, 0, null, onClick, this, 0, 0, 0, 0, btnGroup);\r\n            btn.width = width;\r\n            btn.height = height;\r\n            btn.name = \"button\";\r\n            if (audio) {\r\n                this.game.device.desktop ? btn.setOverSound(audio) : btn.setDownSound(audio);\r\n                this.game.device.desktop ? btn.onInputOut.add(() => audio.stop()) : btn.onInputUp.add(() => audio.stop());\r\n            }\r\n\r\n            let textObj = null;\r\n            if (text) {\r\n                const fontStyle = {};\r\n                let ff = '';\r\n                ff += text.normal.fontWeight ? text.normal.fontWeight + ' ' : 'normal ';\r\n                ff += text.normal.fontSize ? parseInt(text.normal.fontSize) + 'px ' : '';\r\n                ff += text.normal.fontFamily ? text.normal.fontFamily : this.sceneProxy.json_data.font ? this.sceneProxy.json_data.font.fontFamily : '';\r\n\r\n                fontStyle.font = ff;\r\n                fontStyle.fill = text.normal.color;\r\n                fontStyle.stroke = text.normal.stroke;\r\n                fontStyle.strokeThickness = text.normal.stroke ? 2 : 0;\r\n\r\n                fontStyle.boundsAlignH = \"center\";\r\n                fontStyle.boundsAlignV = \"middle\";\r\n                textObj = this.game.add.text(0, 0, text.text, fontStyle, btnGroup);\r\n                textObj.name = 'text';\r\n                if (FontUtils.fontFamily) {\r\n                    changeImageText(text.normal, text.text, width, height, textObj);\r\n                }\r\n                else {\r\n                    textObj.setTextBounds(0, (textObj.height - parseInt(text.normal.fontSize || 12)) / 2, width, height);\r\n                }\r\n                text.normal.hidden && (textObj.visible = false);\r\n            }\r\n            btn.input.mouseOut = function () {\r\n                if (this.sprite === null || !this.sprite.inputEnabled)\r\n                {\r\n                    //  Abort. We've been destroyed.\r\n                    return;\r\n                }\r\n                var data = this._pointerData[0];\r\n\r\n                data.isOver = false;\r\n                data.isOut = true;\r\n                data.timeOut = this.game.time.time;\r\n\r\n                if (this.useHandCursor && data.isDragged === false)\r\n                {\r\n                    this.game.canvas.style.cursor = \"default\";\r\n                    this._setHandCursor = false;\r\n                }\r\n\r\n                if (this.sprite && this.sprite.events)\r\n                {\r\n                    this.sprite.events.onInputOut$dispatch(this.sprite, null);\r\n\r\n                    if (this.sprite && this.sprite.parent && this.sprite.parent.type === Phaser.GROUP)\r\n                    {\r\n                        this.sprite.parent.onChildInputOut.dispatch(this.sprite, null);\r\n                    }\r\n                }\r\n            };\r\n            !isCheckBox && btn.onInputOver.add(() => {\r\n                changeBackground(btnGroup, bk_key_active, text && text.normal);\r\n                /*this.game.input.mouse.onMouseOut = () => {\r\n                    btn.input.mouseOut();\r\n                };*/\r\n            });\r\n            !isCheckBox && btn.onInputOut.add(() => changeBackground(btnGroup, bk_key_normal, text && text.normal));\r\n            !isCheckBox && btn.onInputDown.add(() => changeBackground(btnGroup, bk_key_active, text && text.active));\r\n            !isCheckBox && btn.onInputUp.add(() => changeBackground(btnGroup, bk_key_normal, text && text.normal));\r\n\r\n            btnGroup.changeBackground = function (key, text, type) {\r\n                changeBackground(this, key, text, type)\r\n            };\r\n            btnGroup.button = btn;\r\n            btnGroup.text = textObj;\r\n            return btnGroup;\r\n        },\r\n\r\n        addGifAnimation: function(obj, key) {\r\n            const image = this.game.cache.getImage(obj.key, true);\r\n            const {frames, loopCount} = image.data;\r\n            if (frames) {\r\n                let nCount = 1;\r\n                const setFrame = index => {\r\n                    if (!frames[index] || !frames[index].blobUrl) {\r\n                        return;\r\n                    }\r\n                    const img = new Image();\r\n                    img.onload = e => {\r\n                        const base = new PIXI.BaseTexture(e.target);\r\n                        const texture = new PIXI.Texture(base);\r\n                        obj && obj.parent && obj.setTexture(texture);\r\n                    };\r\n                    //img.src = frames[index].base64;\r\n                    img.src = frames[index].blobUrl;\r\n                };\r\n\r\n                const update = index => {\r\n                    Utils.timeout(frames[index].delay * 10).then(() => {\r\n                        setFrame(index);\r\n                        index++;\r\n                        if (index >= frames.length) {\r\n                            if (loopCount && nCount >= loopCount || !obj || !obj.parent) {\r\n                                return;\r\n                            } else {\r\n                                nCount++;\r\n                                update(0)\r\n                            }\r\n                        } else {\r\n                            update(index)\r\n                        }\r\n                    });\r\n                };\r\n                update(0);\r\n            }\r\n        },\r\n\r\n        addFitImageSprint: function (x, y, width, height, key, parent, index) {\r\n            const sKey = this.game.load.cache.checkImageKey(key) ? key : null;\r\n            const sprite = this.game.add.sprite(x, y, sKey);\r\n            if (sKey) {\r\n                const scale = Math.min(width / sprite.width, height / sprite.height);\r\n                sprite.pivot.x = sprite.width / 2;\r\n                sprite.pivot.y = sprite.height / 2;\r\n                sprite.scale.setTo(scale, scale);\r\n                sprite.x += sprite.width / 2;\r\n                sprite.y += sprite.height / 2;\r\n            }\r\n            if (index > 0) {\r\n                let i = 0;\r\n                for (i=0; i<parent.children.length; i++) {\r\n                    let rs = parent.getAt(i);\r\n                    if (-1 === rs) break;\r\n                    if (rs.zIndex === index) {\r\n                        parent.removeChildAt(i);\r\n                        rs.destroy();\r\n                        break;\r\n                    }\r\n                    else if (rs.zIndex > index) {\r\n                        break;\r\n                    }\r\n                }\r\n                let childGroup = this.game.add.group();\r\n                childGroup.add(sprite);\r\n                childGroup.zIndex = index;\r\n                parent.add(childGroup, false, i);\r\n            }\r\n            else {\r\n                parent.add(sprite);\r\n            }\r\n\r\n            return sprite;\r\n        },\r\n\r\n\r\n\r\n        game: null,\r\n        onRendered: null,\r\n        sceneProxy: null\r\n    },\r\n\r\n    // STATIC MEMBERS\r\n    {\r\n        /**\r\n         * @static\r\n         * @type {string}\r\n         */\r\n        TEXT_CHANGED: 'textChanged'\r\n    }\r\n);\r\n","/**\r\n * Created by 4399-1126 on 2016/9/13.\r\n */\r\nimport puremvc from 'puremvc';\r\nimport FontUtils from '../../common/FontUtils.js';\r\n\r\npuremvc.define\r\n(\r\n    {\r\n        name: 'diygamePlayer.view.mediator.CoverMediator',\r\n        parent: puremvc.Mediator\r\n    },\r\n    {\r\n        listNotificationInterests: function () {\r\n            return [\r\n                diygamePlayer.AppConstants.SCENE_GOTO_COVERMENU\r\n            ]\r\n        },\r\n\r\n        handleNotification: function (note) {\r\n            switch (note.getName()) {\r\n                case diygamePlayer.AppConstants.SCENE_GOTO_COVERMENU:\r\n                    this.showCoverLayer();\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        },\r\n\r\n        onRegister: function () {\r\n            this.sceneProxy = this.facade.retrieveProxy(diygamePlayer.model.proxy.SceneProxy.NAME);\r\n            const sceneMediator = this.facade.retrieveMediator(diygamePlayer.view.mediator.SceneMediator.NAME);\r\n            this.game = sceneMediator.viewComponent && sceneMediator.viewComponent.game;\r\n            this.viewComponent = sceneMediator.viewComponent;\r\n        },\r\n\r\n        addCover: function () {\r\n            const {template, cover} = this.sceneProxy.json_data;\r\n            const {titleContainer, startMenu, loadMenu, settingsMenu, overMenu} = template.json.cover;\r\n            const worldWidth = this.game.world.width;\r\n            const worlHeight = this.game.world.height;\r\n\r\n            const addTextContent = (x, y, width, height, content, objText, name, isTitle) => {\r\n                const fontStyle = {};\r\n                let ff = '';\r\n                ff += objText.fontWeight ? objText.fontWeight + ' ' : 'normal ';\r\n                ff += objText.fontSize ? parseInt(objText.fontSize) + 'px ' : '';\r\n                ff += objText.fontFamily ? objText.fontFamily : '';\r\n\r\n                fontStyle.font = ff;\r\n                fontStyle.fill = objText.color;\r\n                fontStyle.stroke = objText.stroke;\r\n                fontStyle.strokeThickness = objText.stroke ? 2 : 0;\r\n\r\n                fontStyle.boundsAlignH = \"center\";\r\n                fontStyle.boundsAlignV = isTitle ? \"bottom\" : \"middle\";\r\n                const txt = this.game.add.text(0, 0, content, fontStyle, this.sceneProxy.coverLayer);\r\n                txt.name = name;\r\n                if (FontUtils.fontFamily) {\r\n                    const color = (objText.color === '#ffffff' ? '#fefefe' : objText.color).replace('#', '0x');\r\n                    const fontSize = objText.fontSize ? parseInt(objText.fontSize) : 25;\r\n                    txt.colors.splice(0, txt.colors.length);\r\n                    txt.text = ' ';\r\n                    txt.fill = color;\r\n                    txt.addColor(color, 0);\r\n                    txt.x = (worldWidth - fontSize * content.length) / 2;\r\n                    txt.y = y;\r\n                    txt.wordWrapWidth = worldWidth;\r\n\r\n                    const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(fontSize) : fontSize;\r\n                    const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(fontSize) : fontSize;\r\n                    this.sceneProxy.addImageFontText([{data:content}], fw, fh, txt, this.sceneProxy.context);\r\n                }\r\n                else {\r\n                    txt.setTextBounds(x, y + (txt.height - parseInt(objText.fontSize)) / 2, width, height);\r\n                }\r\n                objText.hidden && (txt.visible = false);\r\n                return txt;\r\n            };\r\n\r\n            const addButton = (obj, name, text) => {\r\n                const t = {};\r\n                t.normal = obj.normal.text;\r\n                t.active = obj.active.text;\r\n                t.text = text;\r\n                const btnGroup = this.viewComponent.addButton(obj.rect.x,\r\n                    obj.rect.y,\r\n                    obj.rect.width,\r\n                    obj.rect.height,\r\n                    obj.normal.background.url,\r\n                    obj.active.background.url,\r\n                    onBtnClicked,\r\n                    t,\r\n                    this.sceneProxy.btn_sound,\r\n                    name,\r\n                    this.sceneProxy.coverLayer\r\n                );\r\n                btnGroup.button.onInputUp.add(() => this.sceneProxy.btn_sound && this.sceneProxy.btn_sound.stop())\r\n            };\r\n\r\n            const onBtnClicked = (obj, pointer) => {\r\n                if (pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n                    return;\r\n                }\r\n                if (obj.parent.name === 'cover_button_start') {\r\n                    // 开始游戏\r\n                    this.sceneProxy.onCoverStartBtnClicked();\r\n                }\r\n                else if (obj.parent.name === 'cover_button_load') {\r\n                    // 加载按钮\r\n                    this.sceneProxy.onCoverLoadBtnClicked();\r\n                }\r\n                else if (obj.parent.name === 'cover_button_settings') {\r\n                    // 设置按钮\r\n                    this.sceneProxy.onCoverSettingBtnClicked();\r\n                }\r\n                else if (obj.parent.name === 'cover_button_over') {\r\n                    // 游戏结束\r\n                    this.sceneProxy.onCoverOverBtnClicked();\r\n                }\r\n            };\r\n\r\n            let blackBk = this.viewComponent.game.add.graphics(0, 0, this.sceneProxy.coverLayer);\r\n            blackBk.beginFill(0x0);\r\n            blackBk.moveTo(0, 0);\r\n            blackBk.lineTo(worldWidth, 0);\r\n            blackBk.lineTo(worldWidth, worlHeight);\r\n            blackBk.lineTo(0, worlHeight);\r\n            blackBk.lineTo(0, 0);\r\n            blackBk.endFill();\r\n            blackBk.inputEnabled = true;\r\n\r\n            const backgroundKey = cover.background.url;\r\n            const bk = this.sceneProxy.coverLayer.create(0, 0, this.game.load.cache.checkImageKey(backgroundKey) && backgroundKey);\r\n            this.sceneProxy.lstPlotBkKey = cover.background.url;\r\n            this.sceneProxy.lstPlotBkFlex = cover.background.flex;\r\n            this.sceneProxy.lstPlotBkOpacity = cover.background.opacity;\r\n            this.sceneProxy.lstGameBk = this.viewComponent.game.add.sprite(0, 0, this.game.load.cache.checkImageKey(backgroundKey) && backgroundKey);\r\n            bk.inputEnabled = true;\r\n            if (cover.background.flex === 3) {// 填充\r\n                let rate = bk.width / bk.height < worldWidth / worlHeight ? worldWidth / bk.width : worlHeight / bk.height;\r\n                bk.width *= rate;\r\n                bk.height *= rate;\r\n                bk.x = -(bk.width - worldWidth) / 2;\r\n                bk.y = -(bk.height - worlHeight) / 2;\r\n            }\r\n            else if (cover.background.flex === 5) {// 适应\r\n                let rate = 0;\r\n                if (bk.width / bk.height > worldWidth / worlHeight) {\r\n                    rate = worldWidth / bk.width;\r\n                    bk.width *= rate;\r\n                    bk.height *= rate;\r\n                    bk.y = (worlHeight - bk.height) / 2;\r\n                }\r\n                else {\r\n                    rate = worlHeight / bk.height;\r\n                    bk.width *= rate;\r\n                    bk.height *= rate;\r\n                    bk.x = (worldWidth - bk.width) / 2;\r\n                }\r\n            }\r\n            else {\r\n                bk.width = worldWidth;\r\n                bk.height = worlHeight;\r\n            }\r\n            this.sceneProxy.lstGameBk.x = bk.x;\r\n            this.sceneProxy.lstGameBk.y = bk.y;\r\n            this.sceneProxy.lstGameBk.width = bk.width;\r\n            this.sceneProxy.lstGameBk.height = bk.height;\r\n            // 封面标题背景\r\n            if (cover.title.data && !titleContainer.title.text.hidden) {\r\n                this.viewComponent.addFitImageSprint(titleContainer.rect.x,\r\n                    titleContainer.rect.y,\r\n                    titleContainer.rect.width,\r\n                    titleContainer.rect.height,\r\n                    titleContainer.background.url,\r\n                    this.sceneProxy.coverLayer\r\n                );\r\n            }\r\n\r\n            const {font_size, color, bold, fontFamily, hidden} = cover.title;\r\n            const titleText = titleContainer.title.text;\r\n            font_size && (titleText.fontSize = font_size);\r\n            color && (titleText.color = color);\r\n            bold !== undefined && (titleText.fontWeight = bold ? 'bold' : 'normal');\r\n            titleText.fontFamily = this.sceneProxy.json_data.font ? this.sceneProxy.json_data.font.fontFamily : fontFamily ? fontFamily : '';\r\n            hidden !== undefined && (titleText.hidden = hidden);\r\n\r\n            // 封面标题文字\r\n            addTextContent(titleContainer.title.rect.x + titleContainer.rect.x\r\n                , titleContainer.title.rect.y + titleContainer.rect.y\r\n                , titleContainer.title.rect.width\r\n                , titleContainer.title.rect.height\r\n                , cover.title.data\r\n                , titleText\r\n                , 'cover_text_title'\r\n                , true);\r\n\r\n            // 封面菜单-开始游戏\r\n            if (!startMenu.hidden) {\r\n                addButton(startMenu, 'cover_button_start', this.sceneProxy.stringMap.startMenu);\r\n            }\r\n\r\n            // 封面菜单-加载档案\r\n            if (!loadMenu.hidden) {\r\n                addButton(loadMenu, 'cover_button_load', this.sceneProxy.stringMap.loadMenu);\r\n            }\r\n\r\n            // 封面菜单-环境设置\r\n            if (!settingsMenu.hidden) {\r\n                addButton(settingsMenu, 'cover_button_settings', this.sceneProxy.stringMap.settingsMenu);\r\n            }\r\n\r\n            // 封面菜单-游戏结束\r\n            if (!overMenu.hidden) {\r\n                addButton(overMenu, 'cover_button_over', this.sceneProxy.stringMap.overMenu);\r\n            }\r\n            this.sceneProxy.coverLayer.visible = false;\r\n        },\r\n\r\n        showCoverLayer: function () {\r\n            this.sceneProxy.lstPlotLayer && this.sceneProxy.lstPlotLayer.destroy();\r\n            this.sceneProxy.curPlotLayer && this.sceneProxy.curPlotLayer.destroy();\r\n            this.sceneProxy.dialogLayer.visible = false;\r\n            this.sceneProxy.menuLayer.visible = false;\r\n            this.sceneProxy.lstGameBk && (this.sceneProxy.lstGameBk.visible = true);\r\n            if (this.sceneProxy.coverLayer.children.length === 0) {\r\n                this.addCover()\r\n            }\r\n\r\n            // 封面背景音乐\r\n            const {music, background} = this.sceneProxy.json_data.cover;\r\n            if (this.sceneProxy.bk_music) {\r\n                this.sceneProxy.stopMusic();\r\n            }\r\n            if (music && (this.game.load.cache.checkSoundKey(music.url) || flashvars.client === 'ios' && '1.5.0' <= flashvars.app_version)) {\r\n                this.sceneProxy.playMusic(music.url, music.volume, true);\r\n            }\r\n            this.sceneProxy.lstPlotBkKey = background.url;\r\n            this.sceneProxy.lstPlotBkOpacity = background.opacity;\r\n            this.sceneProxy.lstPlotBkFlex = background.flex;\r\n            this.sceneProxy.coverLayer.visible = true;\r\n            this.game.world.bringToTop(this.sceneProxy.coverLayer);\r\n        }\r\n    },\r\n    {\r\n        /**\r\n         * @static\r\n         * @type {string}\r\n         */\r\n        NAME: 'CoverMediator'\r\n    }\r\n);","/**\r\n * Created by liuE on 2016/10/9.\r\n */\r\n/**\r\n * Created by 4399-1126 on 2016/9/13.\r\n */\r\nimport puremvc from 'puremvc';\r\npuremvc.define\r\n(\r\n    {\r\n        name: 'diygamePlayer.view.mediator.EndMediator',\r\n        parent: puremvc.Mediator\r\n    },\r\n    {\r\n        listNotificationInterests: function () {\r\n            return [\r\n                diygamePlayer.AppConstants.SCENE_GOTO_END\r\n            ]\r\n        },\r\n\r\n        handleNotification: function (note) {\r\n            switch (note.getName()) {\r\n                case diygamePlayer.AppConstants.SCENE_GOTO_END:\r\n                    this.showEndLayer();\r\n                default:\r\n                    break;\r\n            }\r\n        },\r\n\r\n        onRegister: function () {\r\n            this.sceneProxy = this.facade.retrieveProxy(diygamePlayer.model.proxy.SceneProxy.NAME);\r\n            const sceneMediator = this.facade.retrieveMediator(diygamePlayer.view.mediator.SceneMediator.NAME);\r\n            this.game = sceneMediator.viewComponent && sceneMediator.viewComponent.game;\r\n        },\r\n\r\n        btnStatesChanged: function (b, p, btnObj, txtObj, keyBk, text, inputEnabled) {\r\n            if (txtObj) {\r\n                txtObj.font = text.fontFamily;\r\n                txtObj.fontSize = text.fontSize;\r\n                txtObj.fontWeight = text.fontWeight;\r\n                txtObj.fill = text.color;\r\n                txtObj.visible = !text.hidden;\r\n                if (inputEnabled !== undefined) {\r\n                    txtObj.inputEnabled = inputEnabled;\r\n                }\r\n            }\r\n\r\n            this.loadTexture(btnObj, keyBk);\r\n        },\r\n\r\n        loadTexture: function (button, key) {\r\n            if (!button) {\r\n                return;\r\n            }\r\n            const {width, height} = button;\r\n            const buttonKey = this.game.load.cache.checkImageKey(key) ? key : null;\r\n            button.loadTexture(buttonKey);\r\n            button.width = width;\r\n            button.height = height;\r\n        },\r\n\r\n        addEnd: function () {\r\n\r\n            const addButton = (x, y, key, width, height, name) => {\r\n                const bk_key = this.game.load.cache.checkImageKey(key) ? key : null;\r\n                const button = this.game.add.button(x, y, bk_key, onBtnClicked, this, 0, 0, 0, 0, this.sceneProxy.endLayer);\r\n                button.width = width;\r\n                button.height = height;\r\n                button.name = name;\r\n                return button;\r\n            };\r\n\r\n            const addTextContent = (x, y, width, height, content, objText, name) => {\r\n                const fontStyle = {};\r\n                let ff = '';\r\n                ff += objText.fontWeight ? objText.fontWeight + ' ' : 'normal ';\r\n                ff += objText.fontSize ? parseInt(objText.fontSize) + 'px ' : '';\r\n                ff += objText.fontFamily ? objText.fontFamily : '';\r\n\r\n                fontStyle.font = ff;\r\n                fontStyle.fill = objText.color;\r\n                fontStyle.boundsAlignH = \"center\";\r\n                fontStyle.boundsAlignV = \"middle\";\r\n                const txt = this.game.add.text(0, 0, content, fontStyle, this.sceneProxy.endLayer);\r\n                txt.name = name;\r\n                txt.setTextBounds(x, y + (txt.height - parseInt(objText.fontSize)) / 2, width, height);\r\n                objText.hidden && (txt.visible = false);\r\n                return txt;\r\n            };\r\n\r\n            /*const giveCandy = () => {\r\n                let text = this.sceneProxy.endLayer.getByName(\"end_text_candy_tip\");\r\n\r\n                !text && (text = addTextContent(144\r\n                    , 220\r\n                    , 96\r\n                    , 20\r\n                    , \"赠送糖果成功(测试)\"\r\n                    , {\r\n                        fontFamily: \"\",\r\n                        fontSize: \"12px\",\r\n                        color: \"#ef7297\"\r\n                    }\r\n                    , 'end_text_candy_tip'));\r\n                text.visible = true;\r\n                this.timer && this.game.time.events.remove(this.timer);\r\n                this.timer = this.game.time.events.add(1000, () => {\r\n                    text.visible = false;\r\n                })\r\n            };*/\r\n\r\n            const onBtnClicked = (obj, pointer) => {\r\n                if (pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n                    return;\r\n                }\r\n                switch (obj.name) {\r\n                    /*case 'end_button_candy':\r\n                        this.btnStatesChanged(null, null, obj, this.sceneProxy.endLayer.getByName(\"end_text_candy\"), 'icon_candy', text_normal);\r\n                        giveCandy();\r\n                        break;*/\r\n                    case 'end_button_get':\r\n                        this.btnStatesChanged(null, null, obj, this.sceneProxy.endLayer.getByName('end_text_gte'), 'icon_get', text_normal);\r\n                        this.sceneProxy.endLayer.visible = false;\r\n                        this.sceneProxy.visibleLayout = [this.sceneProxy.endLayer, ...this.sceneProxy.visibleLayout];\r\n                        this.sceneProxy.showLoad();\r\n                        break;\r\n                    case 'end_button_back':\r\n                        this.sceneProxy.reStart();\r\n                        this.btnStatesChanged(null, null, obj, this.sceneProxy.endLayer.getByName(\"end_text_back\"), 'icon_back', text_normal);\r\n                        this.sceneProxy.endLayer.visible = false;\r\n                        break;\r\n                    case 'end_button_save':\r\n                        this.btnStatesChanged(null, null, obj, this.sceneProxy.endLayer.getByName(\"end_text_save\"), 'icon_save', text_normal);\r\n                        this.sceneProxy.showSave();\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            };\r\n\r\n            const itemBlackBk = this.game.add.bitmapData(this.game.world.width, this.game.world.height);\r\n            itemBlackBk.fill(0, 0, 0, 0.8);\r\n            const item_bk = this.game.add.sprite(0, 0, itemBlackBk);\r\n            item_bk.width = this.game.world.width;\r\n            item_bk.height = this.game.world.height;\r\n            item_bk.inputEnabled = true;\r\n            this.sceneProxy.endLayer.add(item_bk);\r\n\r\n            const text_normal = {\r\n                fontFamily: \"\",\r\n                fontSize: \"14px\",\r\n                color: \"#ffffff\"\r\n            };\r\n\r\n            const text_active = {\r\n                fontFamily: \"\",\r\n                fontSize: \"14px\",\r\n                color: \"#ef7297\"\r\n            };\r\n\r\n            /*const btn_candy = addButton(144, 100, 'icon_candy', 96, 96, 'end_button_candy');\r\n            const txt_candy = addTextContent(144, 200, 96, 30, \"游戏好棒，送颗糖\", text_normal, 'end_text_candy');\r\n\r\n            btn_candy.onInputOver.add(this.btnStatesChanged, this, 0, btn_candy, txt_candy, 'icon_candy_over_pressed', text_active);\r\n            btn_candy.onInputDown.add(this.btnStatesChanged, this, 0, btn_candy, txt_candy, 'icon_candy_over_pressed', text_active);\r\n            btn_candy.onInputOut.add(this.btnStatesChanged, this, 0, btn_candy, txt_candy, 'icon_candy', text_normal);*/\r\n\r\n            const btn_load = addButton(168, 100, 'icon_get', 96, 96, 'end_button_get');\r\n            const txt_load = addTextContent(168, 200, 96, 30, \"读取进度\", text_normal, 'end_text_get');\r\n\r\n            btn_load.onInputOver.add(this.btnStatesChanged, this, 0, btn_load, txt_load, 'icon_get_hover_pressed', text_active);\r\n            btn_load.onInputDown.add(this.btnStatesChanged, this, 0, btn_load, txt_load, 'icon_get_hover_pressed', text_active);\r\n            btn_load.onInputOut.add(this.btnStatesChanged, this, 0, btn_load, txt_load, 'icon_get', text_normal);\r\n\r\n            const btn_back = addButton(432, 100, 'icon_back', 96, 96, 'end_button_back');\r\n            const txt_back = addTextContent(432, 200, 96, 30, \"返回封面\", text_normal, 'end_text_back');\r\n\r\n            btn_back.onInputOver.add(this.btnStatesChanged, this, 0, btn_back, txt_back, 'icon_back_over_pressed', text_active);\r\n            btn_back.onInputDown.add(this.btnStatesChanged, this, 0, btn_back, txt_back, 'icon_back_over_pressed', text_active);\r\n            btn_back.onInputOut.add(this.btnStatesChanged, this, 0, btn_back, txt_back, 'icon_back', text_normal);\r\n\r\n            const btn_save = addButton(696, 100, 'icon_save', 96, 96, 'end_button_save');\r\n            const txt_save = addTextContent(696, 200, 96, 30, \"存个档，下次玩\", text_normal, 'end_text_save');\r\n\r\n            btn_save.onInputOver.add(this.btnStatesChanged, this, 0, btn_save, txt_save, 'icon_save_over_pressed', text_active);\r\n            btn_save.onInputDown.add(this.btnStatesChanged, this, 0, btn_save, txt_save, 'icon_save_over_pressed', text_active);\r\n            btn_save.onInputOut.add(this.btnStatesChanged, this, 0, btn_save, txt_save, 'icon_save', text_normal);\r\n\r\n            this.sceneProxy.endLayer.visible = false;\r\n        },\r\n\r\n        showEndLayer: function () {\r\n            this.sceneProxy.getSnap();\r\n            if (this.sceneProxy.endLayer.children.length === 0) {\r\n                this.addEnd()\r\n            }\r\n\r\n            this.game.world.bringToTop(this.sceneProxy.endLayer);\r\n            this.sceneProxy.endLayer.visible = true;\r\n        }\r\n    },\r\n    {\r\n        /**\r\n         * @static\r\n         * @type {string}\r\n         */\r\n        NAME: 'EndMediator'\r\n    }\r\n);","import Utils from '../../common/Utils.js';\r\n\r\nexport function HtmlTextBox(game,x,y,width,height,text,color,size,family,bold)\r\n{\r\n    Phaser.Group.call(this,game);\r\n\r\n    this.game = game;\r\n    this.name = 'input';\r\n    this.parentElement = game.canvas.parentNode;\r\n\r\n    //创建一个inputElement\r\n    this.textBoxElement = document.createElement('input');\r\n    this.textBoxElement.style.position = 'absolute';\r\n    this.textBoxElement.style.margin = '0';\r\n    this.textBoxElement.style.border = '0';\r\n    this.textBoxElement.style.padding = '0';\r\n    this.textBoxElement.style.left = x+'px';\r\n    this.textBoxElement.style.top = y+'px';\r\n    this.textBoxElement.style.width = width+'px';\r\n    this.textBoxElement.style.height = height+'px';\r\n    this.textBoxElement.style.color = color;\r\n    this.textBoxElement.style.backgroundColor = 'transparent';\r\n    this.textBoxElement.style.borderColor = 'transparent transparent transparent transparent';\r\n    this.textBoxElement.style.outline = 'none';\r\n    this.textBoxElement.style.fontSize = size + 'px';\r\n    this.textBoxElement.style.fontFamily = family;\r\n    this.textBoxElement.style.fontWeight = bold ? 'bold' : 'normal';\r\n    this.parentElement.insertBefore(this.textBoxElement,game.canvas);\r\n\r\n    this._x = x;\r\n    this._y = y;\r\n    this._width = width;\r\n    this._height = height;\r\n    this._fontSize = size;\r\n    this.text = text;\r\n    this.isValue = false;\r\n\r\n    game.add.existing(this);\r\n    this.onDestroy.add(function(group)\r\n    {\r\n        //删除界面上的Element\r\n        this.parentElement.removeChild(this.textBoxElement);\r\n    },this);\r\n    //this.update();\r\n}\r\n\r\nHtmlTextBox.prototype = Object.create(Phaser.Group.prototype);\r\nHtmlTextBox.prototype.constructor = HtmlTextBox;\r\n//更新函数，用来重新计算TextBox的位置\r\nHtmlTextBox.prototype.update  = function()\r\n{\r\n    let canvas = this.game.canvas;\r\n\r\n    let canvasX = canvas.offsetLeft;\r\n    let canvasY =  canvas.offsetTop;\r\n    let canvasWidth = canvas.offsetWidth;\r\n    let canvasHeight = canvas.offsetHeight;\r\n\r\n    if (this.oldCanvasWidth == canvasWidth && this.oldCanvasHeight == canvasHeight\r\n        && this.oldCanvasX == canvasX && this.oldCanvasY == canvasY) {\r\n        return;\r\n    }\r\n\r\n    let gameWidth = this.game.world.width;\r\n    let gameHeight = this.game.world.height;\r\n\r\n    if (canvas.offsetWidth > canvas.offsetHeight) {\r\n        let widthScale = canvasWidth/gameWidth;\r\n        let heightScale = canvasHeight/gameHeight;\r\n\r\n        let xScale = this._x/gameWidth;\r\n        let yScale = this._y/gameHeight;\r\n\r\n        let newX = canvasX + canvasWidth * xScale;\r\n        let newY = canvasY + canvasHeight * yScale;\r\n        let newWidth = this._width * widthScale;\r\n        let newHeight = this._height * heightScale;\r\n        let fontSize = this._fontSize * heightScale;\r\n\r\n        this.setLeft(newX);\r\n        this.setTop(newY);\r\n        this.setWidth(newWidth);\r\n        this.setHeight(newHeight);\r\n        this.setFontSize(fontSize);\r\n        this.textBoxElement.style.transform = 'rotate(0deg)';\r\n    }\r\n    else {\r\n        let widthScale = canvasHeight/gameWidth;\r\n        let heightScale = canvasWidth/gameHeight;\r\n\r\n        let xScale = this._x/gameWidth;\r\n        let yScale = this._y/gameHeight;\r\n\r\n        let newX = canvasX + canvasWidth - canvasWidth * yScale;\r\n        let newY = canvasY + canvasHeight * xScale;\r\n        let newWidth = this._width * widthScale;\r\n        let newHeight = this._height * heightScale;\r\n        let fontSize = this._fontSize * heightScale;\r\n\r\n        this.setLeft(newX - newWidth/2 - newHeight/2);\r\n        this.setTop(newY + newWidth / 2 - newHeight / 2);\r\n        this.setWidth(newWidth);\r\n        this.setHeight(newHeight);\r\n        this.setFontSize(fontSize);\r\n\r\n        this.textBoxElement.style.transform = 'rotate(90deg)';\r\n    }\r\n\r\n    this.oldCanvasWidth = canvasWidth;\r\n    this.oldCanvasHeight = canvasHeight;\r\n    this.oldCanvasX = canvasX;\r\n    this.oldCanvasY = canvasY;\r\n};\r\n\r\nHtmlTextBox.prototype.destroy = function () {\r\n    this.parentElement.removeChild(this.textBoxElement);\r\n};\r\n\r\nHtmlTextBox.prototype.show = function (bShow) {\r\n    this.textBoxElement.style.visibility = bShow ? 'visible' : 'hidden';\r\n};\r\n\r\nHtmlTextBox.prototype.setInputCallback = function (callback) {\r\n    const inputUpdate = () => {\r\n        this._text = this.textBoxElement.value;\r\n        Utils.sensitiveWords.forEach(word => {\r\n            if (word.length === 0) return;\r\n\r\n            let index = this._text.indexOf(word);\r\n            if (index !== -1) {\r\n                let rw = '*'.repeat(word.length);\r\n                this._text = this._text.replace(new RegExp(word, 'gi'), rw);\r\n                this.textBoxElement.value = this._text;\r\n            }\r\n        })\r\n        callback(this._text);\r\n    };\r\n    if (flashvars.client === 'ios' || navigator.userAgent.indexOf('iPhone') > -1) {\r\n        /*this.textBoxElement.addEventListener('compositionstart', ()=>{\r\n            this.textBoxElement.style.backgroundColor = \"black\";\r\n        });\r\n        this.textBoxElement.addEventListener(\"compositionupdate\", () => {\r\n            this.textBoxElement.style.backgroundColor = \"red\"; //开始编辑，背景变成黄色\r\n        });*/\r\n        let agentV = navigator.userAgent.match(/CPU\\siPhone\\sOS\\s((([0-9]*)+(_))*)+([0-9]*)/gi);\r\n        if (agentV && (agentV[0] >= 'CPU iPhone OS 10_3_1' || agentV[0] === 'CPU iPhone OS 10_0_2')) {\r\n            this.textBoxElement.addEventListener(\"input\", inputUpdate, false);\r\n        } else {\r\n            this.textBoxElement.addEventListener('compositionend', () => {\r\n                this.textBoxElement.removeEventListener(\"input\", inputUpdate, false);\r\n                this.textBoxElement.addEventListener(\"input\", inputUpdate, false);\r\n            }, false);\r\n        }\r\n    } else {\r\n        this.textBoxElement.addEventListener(\"input\", inputUpdate, false);\r\n    }\r\n\r\n    this.textBoxElement.onblur = ()=> {\r\n        if (this.isValue) {\r\n            let v = parseFloat(this._text);\r\n            v ? this.text = v + '' : this.text = '0';\r\n        }\r\n    }\r\n};\r\n\r\nHtmlTextBox.prototype.setClickCallback = function (callback) {\r\n    this.textBoxElement.addEventListener('click', () => {callback(this);}, false);\r\n};\r\n\r\n//设置位置X\r\nHtmlTextBox.prototype.setLeft = function (left) {\r\n    this.textBoxElement.style.left = left+'px';\r\n};\r\n\r\nHtmlTextBox.prototype.setTop = function (top) {\r\n    this.textBoxElement.style.top = top+'px';\r\n};\r\n\r\n//设置width\r\nHtmlTextBox.prototype.setWidth = function(width) {\r\n    this.textBoxElement.style.width = width+'px';\r\n};\r\n\r\n//设置height\r\nHtmlTextBox.prototype.setHeight = function(height) {\r\n    this.textBoxElement.style.height = height+'px';\r\n};\r\n\r\n// 设置字体大小\r\nHtmlTextBox.prototype.setFontSize = function (fontSize) {\r\n    this.textBoxElement.style.fontSize = fontSize + 'px';\r\n};\r\n\r\n// Enable\r\nHtmlTextBox.prototype.setEnable = function (bEnabled) {\r\n    this.textBoxElement.readOnly = (!!bEnabled).toString();\r\n};\r\n\r\n//使用属性的方式操作X\r\nObject.defineProperty(HtmlTextBox.prototype,'x',\r\n    {\r\n        get:function()\r\n        {\r\n            return this._x;\r\n        },\r\n        set:function(value)\r\n        {\r\n            this.setLeft(value);\r\n            this._x = value;\r\n        }\r\n    });\r\n//使用属性的方式操作Y\r\nObject.defineProperty(HtmlTextBox.prototype,'y',\r\n    {\r\n        get:function()\r\n        {\r\n            return this._y;\r\n        },\r\n        set:function(value)\r\n        {\r\n            this.setTop(value);\r\n            this._y = value;\r\n        }\r\n    });\r\n\r\n//使用属性的方式操作width\r\nObject.defineProperty(HtmlTextBox.prototype,'width',\r\n    {\r\n        get:function()\r\n        {\r\n            return this._width;\r\n        },\r\n        set:function(value)\r\n        {\r\n            this.setWidth(value);\r\n            this._width = value;\r\n        }\r\n    });\r\n\r\n//使用属性的方式操作height\r\nObject.defineProperty(HtmlTextBox.prototype,'height',\r\n    {\r\n        get:function()\r\n        {\r\n            return this._height;\r\n        },\r\n        set:function(value)\r\n        {\r\n            this.setHeight(value);\r\n            this._height = value;\r\n        }\r\n    });\r\n\r\n//使用属性的方式操作fontSize\r\nObject.defineProperty(HtmlTextBox.prototype,'fontSize',\r\n    {\r\n        get:function () {\r\n            return this._fontSize;\r\n        },\r\n        set:function (value) {\r\n            this.setFontSize(value);\r\n            this._fontSize = value;\r\n        }\r\n    });\r\n\r\n//使用属性的方式操作style\r\nObject.defineProperty(HtmlTextBox.prototype,'style',\r\n    {\r\n        get:function()\r\n        {\r\n            return this._style;\r\n        },\r\n        set:function(value)\r\n        {\r\n            for(var key in value)\r\n            {\r\n                this.textBoxElement.style[key] = value[key];\r\n            }\r\n            this._style = value;\r\n        }\r\n    });\r\n\r\n//设置字体\r\nObject.defineProperty(HtmlTextBox.prototype,'text',\r\n    {\r\n        get:function()\r\n        {\r\n            return this._text;\r\n        },\r\n        set:function(value)\r\n        {\r\n            this.textBoxElement.value = value;\r\n            this._text = value;\r\n        }\r\n    });\r\n\r\n// enable\r\nObject.defineProperty(HtmlTextBox.prototype,'readOnly',\r\n    {\r\n        get:function()\r\n        {\r\n            return this.readOnly;\r\n        },\r\n        set:function(value)\r\n        {\r\n            this.setEnable(value);\r\n            this.textBoxElement.readOnly = (!!value).toString();\r\n        }\r\n    });","/**\r\n * Created by 4399-1126 on 2016/9/13.\r\n */\r\nimport puremvc from 'puremvc';\r\nimport FontUtils from '../../common/FontUtils.js';\r\npuremvc.define\r\n(\r\n    {\r\n        name: 'diygamePlayer.view.mediator.MainMenuMediator',\r\n        parent: puremvc.Mediator\r\n    },\r\n    {\r\n        listNotificationInterests: function () {\r\n            return [\r\n                diygamePlayer.AppConstants.SCENE_GOTO_MAINMENU\r\n            ]\r\n        },\r\n\r\n        handleNotification: function (note) {\r\n            const body = note.getBody();\r\n            switch (note.getName()) {\r\n                case diygamePlayer.AppConstants.SCENE_GOTO_MAINMENU:\r\n                    this.showMainMenuLayer(body);\r\n                default:\r\n                    break;\r\n            }\r\n        },\r\n\r\n        onRegister: function () {\r\n            this.sceneProxy = this.facade.retrieveProxy(diygamePlayer.model.proxy.SceneProxy.NAME);\r\n            this.sceneMediator = this.facade.retrieveMediator(diygamePlayer.view.mediator.SceneMediator.NAME);\r\n            this.game = this.sceneMediator.viewComponent && this.sceneMediator.viewComponent.game;\r\n            this.viewComponent = this.sceneMediator.viewComponent;\r\n        },\r\n\r\n        addMainMenu: function () {\r\n            const {background, header, save, load, playback, settings, autoplay, back} = this.sceneProxy.json_data.template.json.mainMenu;\r\n            const addImgFontText = (textInfo, x, y, width, height, content, textObj) => {\r\n                const fontSize = textInfo.fontSize ? parseInt(textInfo.fontSize) : 25;\r\n                const color = textInfo.color ? textInfo.color : '#fefefe';\r\n\r\n                const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(fontSize) : fontSize;\r\n                const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(fontSize) : fontSize;\r\n                const w = fw * content.length;\r\n                const l = x + (width - w) / 2;\r\n                const t = y + (height - fh) / 2;\r\n                const txtImg = this.sceneProxy.addRetroText(l, t, w, fh, content);\r\n                txtImg.tint = (color === '#ffffff' ? '#fefefe' : color).replace('#', '0x');\r\n\r\n                textObj.addChild(txtImg);\r\n                textObj.text = ' ';\r\n            };\r\n            const addTextContent = (x, y, width, height, content, objText, name) => {\r\n                const fontStyle = {};\r\n                let ff = '';\r\n                ff += objText.fontWeight ? objText.fontWeight + ' ' : 'normal ';\r\n                ff += objText.fontSize ? parseInt(objText.fontSize) + 'px ' : '';\r\n                ff += this.sceneProxy.json_data.font ? this.sceneProxy.json_data.font.fontFamily : objText.fontFamily ? objText.fontFamily : '';\r\n\r\n                fontStyle.font = ff;\r\n                fontStyle.fill = objText.color;\r\n                fontStyle.boundsAlignH = \"center\";\r\n                fontStyle.boundsAlignV = \"middle\";\r\n                fontStyle.stroke = objText.stroke;\r\n                fontStyle.strokeThickness = objText.stroke ? 2 : 0;\r\n\r\n                const txt = this.game.add.text(0, 0, content, fontStyle, this.sceneProxy.mainMenuLayer);\r\n                txt.name = name;\r\n                if (FontUtils.fontFamily) {\r\n                    addImgFontText(objText, x, y, width, height, content, txt);\r\n                }\r\n                else {\r\n                    txt.setTextBounds(x, y + (txt.height - parseInt(objText.fontSize)) / 2, width, height);\r\n                }\r\n\r\n                objText.hidden && (txt.visible = false);\r\n                return txt;\r\n            };\r\n            const addButton = (obj, name, text) => {\r\n                const t = {};\r\n                t.normal = obj.normal.text;\r\n                t.active = obj.active.text;\r\n                t.text = text;\r\n                const btnGroup = this.viewComponent.addButton(obj.rect.x,\r\n                    obj.rect.y,\r\n                    obj.rect.width,\r\n                    obj.rect.height,\r\n                    obj.normal.background.url,\r\n                    obj.active.background.url,\r\n                    onBtnClicked,\r\n                    t,\r\n                    this.sceneProxy.btn_sound,\r\n                    name,\r\n                    this.sceneProxy.mainMenuLayer\r\n                );\r\n                btnGroup.button.onInputUp.add(() => this.sceneProxy.btn_sound && this.sceneProxy.btn_sound.stop())\r\n            };\r\n\r\n            const onBtnClicked = (obj, pointer) => {\r\n                if (pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n                    return;\r\n                }\r\n                if (obj.parent.name === 'mainMenu_button_save') {\r\n                    // 保存进度\r\n                    this.sceneProxy.onMainMenuSaveBtnClicked();\r\n                }\r\n                else if (obj.parent.name === 'mainMenu_button_load') {\r\n                    // 读取进度\r\n                    this.sceneProxy.onMainMenuLoadBtnClicked();\r\n                }\r\n                else if (obj.parent.name === 'mainMenu_button_playback') {\r\n                    // 剧情回放\r\n                    this.sceneProxy.onMainMenuPlaybackBtnClicked();\r\n                }\r\n                else if (obj.parent.name === 'mainMenu_button_autoplay') {\r\n                    // 自动播放\r\n                    this.sceneProxy.onMainMenuAutoplayBtnClicked();\r\n                }\r\n                else if (obj.parent.name === 'mainMenu_button_settings') {\r\n                    // 游戏设置\r\n                    this.sceneProxy.onMainMenuSettingsBtnClicked();\r\n                }\r\n                else if (obj.parent.name === 'mainMenu_button_back') {\r\n                    // 返回\r\n                    this.sceneProxy.onMainMenuBackBtnClicked();\r\n                }\r\n            };\r\n\r\n            const bk = this.game.add.image(0, 0, this.game.load.cache.checkImageKey(background.url) && background.url);\r\n            bk.width = this.game.world.width;\r\n            bk.height = this.game.world.height;\r\n            bk.inputEnabled = true;\r\n            this.sceneProxy.mainMenuLayer.add(bk);\r\n\r\n            // header\r\n            if (this.game.load.cache.checkImageKey(header.background.url)) {\r\n                const head = this.sceneProxy.mainMenuLayer.create(header.rect.x\r\n                    , header.rect.y\r\n                    , header.background.url);\r\n                head.width = header.rect.width;\r\n                head.height = header.rect.height;\r\n            }\r\n            if (!header.title.text.hidden) {\r\n                addTextContent(header.title.rect.x + header.rect.x\r\n                    , header.title.rect.y + header.rect.y\r\n                    , header.title.rect.width\r\n                    , header.title.rect.height\r\n                    , this.sceneProxy.stringMap.mainMenu\r\n                    , header.title.text\r\n                    , 'mainMenu_text_header');\r\n            }\r\n\r\n            // 按钮-保存进度\r\n            if (!save.hidden) {\r\n                addButton(save, 'mainMenu_button_save', this.sceneProxy.stringMap.save);\r\n            }\r\n\r\n            // 按钮-读取进度\r\n            if (!load.hidden) {\r\n                addButton(load, 'mainMenu_button_load', this.sceneProxy.stringMap.load);\r\n            }\r\n\r\n            // 按钮-剧情回放\r\n            if (!playback.hidden) {\r\n                addButton(playback, 'mainMenu_button_playback', this.sceneProxy.stringMap.playback);\r\n            }\r\n\r\n            // 按钮-自动播放\r\n            if (!autoplay.hidden) {\r\n                addButton(autoplay, 'mainMenu_button_autoplay', this.sceneProxy.stringMap.autoplay);\r\n            }\r\n\r\n            // 按钮-游戏设置\r\n            if (!settings.hidden) {\r\n                addButton(settings, 'mainMenu_button_settings', this.sceneProxy.stringMap.settings);\r\n            }\r\n\r\n            // 按钮-返回\r\n            if (!back.hidden) {\r\n                addButton(back, 'mainMenu_button_back', this.sceneProxy.stringMap.back);\r\n            }\r\n            this.sceneProxy.mainMenuLayer.visible = false;\r\n        },\r\n\r\n        showMainMenuLayer: function (context) {\r\n            if (this.sceneProxy.mainMenuLayer.children.length === 0) {\r\n                if (this.sceneProxy.json_data.default_settings.mainMenu) {\r\n                    const {mainMenu: mainMenuView} = this.sceneProxy.json_data.default_settings;\r\n                    let bk = this.viewComponent.game.add.graphics(0, 0, this.sceneProxy.mainMenuLayer);\r\n                    bk.beginFill(0x0, 0);\r\n                    bk.drawRect(0, 0, this.viewComponent.game.world.width, this.viewComponent.game.world.height);\r\n                    bk.endFill();\r\n                    bk.inputEnabled = true;\r\n                    this.sceneMediator.registerViewKey(mainMenuView.ref, mainMenuView.events, this.sceneProxy.plotViewKeys);\r\n                    let menuView = this.sceneMediator.addView(this.sceneProxy.mainMenuLayer, mainMenuView.ref, mainMenuView.instanceUuid\r\n                        , mainMenuView.x, mainMenuView.y, mainMenuView.events);\r\n                    menuView.isMenu = true;\r\n                    // 找出菜单中添加的计时器\r\n                    const getTimerInMenu = ()=> {\r\n                        const visitInChild = view => {\r\n                            if (view.viewType === 'TIMER') {\r\n                                this.sceneProxy.menuTimer[this.sceneProxy.menuTimer.length] = view.name;\r\n                            }\r\n                            view.children.forEach(v => {visitInChild(v)});\r\n                        };\r\n                        menuView.children.forEach(v => {visitInChild(v)});\r\n                    };\r\n                    getTimerInMenu();\r\n                    this.sceneMediator.uiOnLoadInvoker();\r\n                } else {\r\n                    this.addMainMenu();\r\n                }\r\n            }\r\n            const autoButton = this.sceneProxy.mainMenuLayer.getByName('mainMenu_button_autoplay');\r\n            const autoText = autoButton ? autoButton.getByName(\"text\") : undefined;\r\n            if (context.auto) {\r\n                if (autoText) {\r\n                    if (FontUtils.fontFamily) {\r\n                        const txtImgOld = autoText.children[0];\r\n                        if (txtImgOld) {\r\n                            //autoText.children[0].fontImg.text = this.sceneProxy.stringMap.manualPlay;\r\n\r\n                            const {autoplay} = this.sceneProxy.json_data.template.json.mainMenu;\r\n                            const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(autoplay.normal.text.fontSize) : autoplay.normal.text.fontSize;\r\n                            const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(autoplay.normal.text.fontSize) : autoplay.normal.text.fontSize;\r\n                            const w = fw * this.sceneProxy.stringMap.manualPlay.length;\r\n                            const x = (autoplay.rect.width - w) / 2;\r\n                            const y = (autoplay.rect.height - fh) / 2;\r\n                            this.sceneProxy.addImageFontText([{data: this.sceneProxy.stringMap.manualPlay}], fw, fh, autoText, context);\r\n                            autoText.children[0].x = x;\r\n                            autoText.children[0].y = y;\r\n                            txtImgOld.children.forEach(item => item.fontImg.destroy());\r\n                            txtImgOld.destroy();\r\n                            autoText.text = ' ';\r\n                        }\r\n                    }\r\n                    else {\r\n                        autoText.text = this.sceneProxy.stringMap.manualPlay;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                if (autoText) {\r\n                    if (FontUtils.fontFamily) {\r\n                        const txtImgOld = autoText.children[0];\r\n                        if (txtImgOld) {\r\n                            //autoText.children[0].fontImg.text = this.sceneProxy.stringMap.autoplay;\r\n\r\n                            const {autoplay} = this.sceneProxy.json_data.template.json.mainMenu;\r\n                            const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(autoplay.normal.text.fontSize) : autoplay.normal.text.fontSize;\r\n                            const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(autoplay.normal.text.fontSize) : autoplay.normal.text.fontSize;\r\n                            const w = fw * this.sceneProxy.stringMap.autoplay.length;\r\n                            const x = (autoplay.rect.width - w) / 2;\r\n                            const y = (autoplay.rect.height - fh) / 2;\r\n                            this.sceneProxy.addImageFontText([{data: this.sceneProxy.stringMap.autoplay}], fw, fh, autoText, context);\r\n                            autoText.children[0].x = x;\r\n                            autoText.children[0].y = y;\r\n                            txtImgOld.children.forEach(item => item.fontImg.destroy());\r\n                            txtImgOld.destroy();\r\n                            autoText.text = ' ';\r\n                        }\r\n                    }\r\n                    else {\r\n                        autoText.text = this.sceneProxy.stringMap.autoplay;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.game.world.bringToTop(this.sceneProxy.mainMenuLayer);\r\n            this.sceneProxy.mainMenuLayer.visible = true;\r\n        }\r\n    },\r\n    {\r\n        /**\r\n         * @static\r\n         * @type {string}\r\n         */\r\n        NAME: 'MainMenuMediator'\r\n    }\r\n);","/**\r\n * Created by 4399-1126 on 2016/9/13.\r\n */\r\nimport puremvc from 'puremvc';\r\nimport RePhaser from '../../common/RePhaser.js';\r\nimport FontUtils from '../../common/FontUtils.js';\r\n\r\npuremvc.define\r\n(\r\n    {\r\n        name: 'diygamePlayer.view.mediator.PlaybackMediator',\r\n        parent: puremvc.Mediator\r\n    },\r\n    {\r\n        listNotificationInterests: function () {\r\n            return [\r\n                diygamePlayer.AppConstants.SCENE_GOTO_PLAYBACK,\r\n                diygamePlayer.AppConstants.ADD_PLAYBACK_CONTENT\r\n            ]\r\n        },\r\n\r\n        handleNotification: function (note) {\r\n            switch (note.getName()) {\r\n                case diygamePlayer.AppConstants.SCENE_GOTO_PLAYBACK:\r\n                    this.callbackInfo = note.getBody();\r\n                    this.showPlaybackLayer();\r\n                    break;\r\n                case diygamePlayer.AppConstants.ADD_PLAYBACK_CONTENT:\r\n                    const body = note.getBody();\r\n                    this.addPlaybackContent(body);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        },\r\n\r\n        onRegister: function () {\r\n            this.sceneProxy = this.facade.retrieveProxy(diygamePlayer.model.proxy.SceneProxy.NAME);\r\n            const sceneMediator = this.facade.retrieveMediator(diygamePlayer.view.mediator.SceneMediator.NAME);\r\n            this.game = sceneMediator.viewComponent && sceneMediator.viewComponent.game;\r\n            this.viewComponent = sceneMediator.viewComponent;\r\n        },\r\n\r\n        addTextContent: function (x, y, width, height, content, objText) {\r\n            const fontStyle = {boundsAlignH: 'center', boundsAlignV: 'middle', wordWrap: true};\r\n            let ff = '';\r\n            ff += objText.fontWeight ? objText.fontWeight + ' ' : 'normal ';\r\n            ff += objText.fontSize ? parseInt(objText.fontSize) + 'px ' : '';\r\n            ff += objText.fontFamily ? objText.fontFamily : '黑体';\r\n\r\n            fontStyle.font = ff;\r\n            fontStyle.fill = objText.color;\r\n            fontStyle.wordWrapWidth = width;\r\n            if (this.sceneProxy.stringMap.back === content) {\r\n                fontStyle.boundsAlignH = 'center';\r\n                fontStyle.boundsAlignV = \"middle\";\r\n            } else {\r\n                fontStyle.boundsAlignH = 'left';\r\n                fontStyle.boundsAlignV = 'top';\r\n            }\r\n            const txt = this.game.add.text(0, 0, content, fontStyle, this.sceneProxy.playBackLayer);\r\n            txt.setTextBounds(x, y + (txt.height - parseInt(objText.fontSize || 12)) / 2, width, height);\r\n            return txt;\r\n        },\r\n\r\n        addPlayback: function () {\r\n            const {scrollBox, back, background} = this.sceneProxy.json_data.template.json.playback;\r\n\r\n            // 背景\r\n            const bk = this.sceneProxy.playBackLayer.create(0, 0, this.game.load.cache.checkImageKey(background.url) && background.url);\r\n            bk.width = this.game.world.width;\r\n            bk.height = this.game.world.height;\r\n            bk.inputEnabled = true;\r\n            // scrollBox\r\n            const boxX = scrollBox.rect.x;\r\n            const boxY = scrollBox.rect.y;\r\n            const boxWidth = scrollBox.rect.width;\r\n            const boxHeight = scrollBox.rect.height;\r\n            const backgroundRect = Object.assign({x: 0, y: 0, width: boxWidth, height: boxHeight}, scrollBox.background.rect);\r\n\r\n            const scrollBk = this.sceneProxy.playBackLayer.create(boxX + backgroundRect.x,\r\n                boxY + backgroundRect.y,\r\n                this.game.load.cache.checkImageKey(scrollBox.background.url) && scrollBox.background.url);\r\n            scrollBk.width = backgroundRect.width;\r\n            scrollBk.height = backgroundRect.height;\r\n\r\n            const scrollPane = this.game.add.sprite(0, 0);\r\n            scrollPane.x = boxX;\r\n            scrollPane.y = boxY;\r\n            scrollPane.name = 'scrollPane';\r\n            this.sceneProxy.playBackLayer.add(scrollPane);\r\n\r\n            // item\r\n            const itemWidth = scrollBox.item.rect.width;\r\n            const itemHeight = scrollBox.item.rect.height;\r\n            const hSpace = Math.max(itemHeight - scrollBox.item.content.rect.height, 0);\r\n            let dragStartPointX = 0;\r\n            let dragStartY = null;\r\n            let wheelEvent = false;\r\n            const onMove = (pointer, x, y) => {\r\n                const point = getPoint(pointer);\r\n                const mousewheelevt = (/Firefox/i.test(navigator.userAgent)) ? \"DOMMouseScroll\" : \"mousewheel\";\r\n                if (!point) {\r\n                    if (wheelEvent) {\r\n                        document.removeEventListener(mousewheelevt, onMouseWheel);\r\n                        wheelEvent = false;\r\n                    }\r\n                }\r\n                else {\r\n                    if (!wheelEvent) {\r\n                        document.addEventListener(mousewheelevt, onMouseWheel);\r\n                        wheelEvent = true;\r\n                    }\r\n                }\r\n            };\r\n            const onScroll = (x, y) => {\r\n                const height = scrollPane.children.length * itemHeight - hSpace;\r\n                if (height < boxHeight) {\r\n                    scrollPane.y = boxY;\r\n                    return;\r\n                }\r\n                if (x !== boxX) {\r\n                    scrollPane.x = boxX;\r\n                }\r\n                if (y > boxY) {\r\n                    scrollPane.y = boxY;\r\n                }\r\n                else if (y + height < boxY + boxHeight) {\r\n                    scrollPane.y = boxY + boxHeight - height;\r\n                }\r\n                else {\r\n                    scrollPane.y = y;\r\n                }\r\n            };\r\n            const onDragUpdate = (sprite, pointer, x, y, pt, bFromStart) => {\r\n                let px = x;\r\n                let py = y;\r\n                bFromStart && (dragStartPointX = x);\r\n                dragStartY = scrollPane.y;\r\n                if (document.body.clientWidth < document.body.clientHeight && dragStartY !== null) {\r\n                    py = dragStartY - x + dragStartPointX;\r\n                }\r\n                onScroll(px, py);\r\n            };\r\n            const getPoint = (pointer) => {\r\n                let x, y;\r\n\r\n                if (document.body.clientWidth > document.body.clientHeight) {\r\n                    x = pointer.worldX;\r\n                    y = pointer.worldY;\r\n                }\r\n                else {\r\n                    x = pointer.worldY;\r\n                    y = -pointer.worldX;\r\n                }\r\n                if (y < boxY || y > boxY + boxHeight ||\r\n                    x < boxX || x > boxX + boxWidth) {\r\n                    return null;\r\n                }\r\n                return {x, y}\r\n            };\r\n            const onInputDown = (sprite, pointer, x, y) => {\r\n                if (!getPoint(pointer)) {\r\n                    return sprite.input.disableDrag();\r\n                }\r\n                return sprite.input.enableDrag();\r\n            };\r\n            const onMouseWheel = e => {\r\n                const delta = e.wheelDelta ? e.wheelDelta / 120 : -e.detail / 3;\r\n                onScroll(0, scrollPane.y + delta * 100)\r\n            };\r\n\r\n            scrollPane.inputEnabled = true;\r\n            scrollPane.input.enableDrag();\r\n            scrollPane.input.allowHorizontalDrag = false;\r\n            scrollPane.events.onDragUpdate.add(onDragUpdate, this);\r\n            scrollPane.events.onInputDown.add(onInputDown, this);\r\n            this.game.input.addMoveCallback(onMove, this);\r\n            // mask\r\n            const mask = this.game.add.graphics(0, 0);\r\n            mask.beginFill(0xffffff);\r\n            mask.drawRect(boxX, boxY, boxWidth, boxHeight);\r\n            this.sceneProxy.playBackLayer.add(mask);\r\n            scrollPane.mask = mask;\r\n            // 返回按钮\r\n            const onBtnClicked = (obj, pointer) => {\r\n                if (pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n                    return;\r\n                }\r\n                this.sceneProxy.onPlaybackBackBtnClicked();\r\n                if (this.callbackInfo) {\r\n                    this.callbackInfo.callbackFun(this.callbackInfo.callbackArgs);\r\n                    this.callbackInfo = null;\r\n                }\r\n            };\r\n            if (!back.hidden) {\r\n                const t = {};\r\n                t.normal = back.normal.text;\r\n                t.active = back.active.text;\r\n                t.text = this.sceneProxy.stringMap.back;\r\n                const btnGroup = this.viewComponent.addButton(back.rect.x,\r\n                    back.rect.y,\r\n                    back.rect.width,\r\n                    back.rect.height,\r\n                    back.normal.background.url,\r\n                    back.active.background.url,\r\n                    onBtnClicked,\r\n                    t,\r\n                    this.sceneProxy.btn_sound,\r\n                    \"playBack_button_back\",\r\n                    this.sceneProxy.playBackLayer\r\n                );\r\n                btnGroup.button.onInputUp.add(() => this.sceneProxy.btn_sound && this.sceneProxy.btn_sound.stop())\r\n            }\r\n            this.sceneProxy.playBackLayer.visible = false;\r\n        },\r\n\r\n        addPlaybackContent: function (data) {\r\n            this.sceneProxy.playbackData.push(data);\r\n            if (this.sceneProxy.playbackData.length > 100) {\r\n                this.sceneProxy.playbackData.splice(0, 1);\r\n            }\r\n        },\r\n\r\n        addPlaybackItem: function (data) {\r\n            const scrollPane = this.sceneProxy.playBackLayer.getByName('scrollPane');\r\n            const {scrollBox} = this.sceneProxy.json_data.template.json.playback;\r\n\r\n            const keyItemBk = this.game.load.cache.checkImageKey(scrollBox.item.background.url) ? scrollBox.item.background.url : null;\r\n            const keySubItemBk = this.game.load.cache.checkImageKey(scrollBox.item.content.background.url) ? scrollBox.item.content.background.url : null;\r\n            const contentX = scrollBox.item.rect.x + scrollBox.item.content.rect.x;\r\n            const contentY = scrollBox.item.rect.y + scrollBox.item.content.rect.y;\r\n\r\n            const itemGroup = this.game.add.group();\r\n            itemGroup.x = scrollBox.item.rect.x;\r\n            itemGroup.y = scrollBox.item.rect.y + scrollBox.item.rect.height * scrollPane.children.length;\r\n\r\n            const itemBackground = this.game.add.sprite(0, 0, keyItemBk);\r\n            itemBackground.width = scrollBox.item.rect.width;\r\n            itemBackground.height = scrollBox.item.rect.height;\r\n            const itemContent = this.game.add.sprite(contentX, contentY, keySubItemBk);\r\n            itemContent.width = scrollBox.item.content.rect.width;\r\n            itemContent.height = scrollBox.item.content.rect.height;\r\n\r\n            const itemText = this.addTextContent(contentX + 10,\r\n                contentY,\r\n                scrollBox.item.content.rect.width - 10,\r\n                scrollBox.item.content.rect.height,\r\n                \"\",\r\n                scrollBox.item.content.text);\r\n            itemText.useAdvancedWrap = true;\r\n            itemText.updateText = RePhaser.updateText;\r\n            itemText.advancedWordWrap = RePhaser.advancedWordWrap;\r\n            itemText.lineSpacing = -parseInt(scrollBox.item.content.text.fontSize || 12) / 5;\r\n            itemText.text = data;\r\n            itemText.name = 'text';\r\n\r\n            const mask = this.game.add.graphics(0, 0);\r\n            mask.beginFill(0xffffff);\r\n            mask.drawRect(contentX, contentY, itemContent.width, itemContent.height);\r\n            itemText.mask = mask;\r\n            itemGroup.addChild(mask);\r\n\r\n            itemGroup.add(itemBackground);\r\n            itemGroup.add(itemContent);\r\n            itemGroup.add(itemText);\r\n            scrollPane.addChild(itemGroup);\r\n            /*if (scrollPane.children.length > 100) {\r\n                scrollPane.removeChildAt(0);\r\n                scrollPane.children.forEach(c => c.y -= scrollBox.item.rect.height)\r\n            }*/\r\n        },\r\n\r\n        showPlaybackLayer: function () {\r\n            /*if (this.sceneProxy.playBackLayer.children.length === 0) {\r\n                this.addPlayback();\r\n            }*/\r\n            this.sceneProxy.playBackLayer.removeAll(true);\r\n            this.addPlayback();\r\n            this.sceneProxy.playbackData.forEach(d => {this.addPlaybackItem(d)});\r\n            this.game.world.bringToTop(this.sceneProxy.playBackLayer);\r\n            this.sceneProxy.playBackLayer.visible = true;\r\n            // 滚动位置\r\n            const {rect, item} = this.sceneProxy.json_data.template.json.playback.scrollBox;\r\n            const scrollPane = this.sceneProxy.playBackLayer.getByName('scrollPane');\r\n            const hSpace = Math.max(item.rect.height - item.content.rect.height, 0);\r\n            const height = scrollPane.children.length * item.rect.height - hSpace;\r\n            const y = rect.y + item.rect.y;\r\n            if (height < rect.height) {\r\n                scrollPane.y = y;\r\n            } else {\r\n                scrollPane.y = y - height + rect.height;\r\n            }\r\n        }\r\n    },\r\n    {\r\n        /**\r\n         * @static\r\n         * @type {string}\r\n         */\r\n        NAME: 'PlaybackMediator'\r\n    }\r\n);","/**\r\n * Created by 4399-1126 on 2016/9/13.\r\n */\r\nimport puremvc from 'puremvc';\r\nimport MD5 from 'spark-md5';\r\nimport Dialog from './../../common/Dialog.js';\r\nimport Utils from './../../common/Utils.js';\r\nimport FontUtils from '../../common/FontUtils.js';\r\n\r\npuremvc.define\r\n(\r\n    {\r\n        name: 'diygamePlayer.view.mediator.RecordMediator',\r\n        parent: puremvc.Mediator\r\n    },\r\n    {\r\n        listNotificationInterests: function () {\r\n            return [\r\n                diygamePlayer.AppConstants.SCENE_GOTO_RECORD\r\n            ]\r\n        },\r\n\r\n        handleNotification: function (note) {\r\n            const body = note.getBody();\r\n            this.callbackInfo = !!body ? body : (this.sceneProxy.recordLayer ? this.callbackInfo : null);\r\n            switch (note.getName()) {\r\n                case diygamePlayer.AppConstants.SCENE_GOTO_RECORD:\r\n                    this.showRecordLayer();\r\n                    break;\r\n                default:\r\n                    break\r\n            }\r\n        },\r\n\r\n        onRegister: function () {\r\n            this.sceneProxy = this.facade.retrieveProxy(diygamePlayer.model.proxy.SceneProxy.NAME);\r\n            const sceneMediator = this.facade.retrieveMediator(diygamePlayer.view.mediator.SceneMediator.NAME);\r\n            this.game = sceneMediator.viewComponent && sceneMediator.viewComponent.game;\r\n            this.viewComponent = sceneMediator.viewComponent;\r\n            this.localMode = true;\r\n            this.isChangeClick = false;\r\n        },\r\n\r\n        onLocalBtnClicked: function() {\r\n            if (!this.localMode) {\r\n                this.localMode = true;\r\n                this.isChangeClick = true;\r\n                const btnLocal = this.sceneProxy.recordLayer.getByName('local_btn');\r\n                const btnCloud = this.sceneProxy.recordLayer.getByName('cloud_btn');\r\n                btnLocal.changeBackground('local_hover');\r\n                btnCloud.changeBackground('cloud');\r\n                this.sceneProxy.onRecordLocalBtnClicked();\r\n            }\r\n        },\r\n\r\n        onCloudBtnClicked: function(isshow) {\r\n            if (this.localMode) {\r\n                this.sceneProxy.isSignedIn().then(() => {\r\n                    if(!this.sceneProxy.isWap3000()){\r\n                        //用户登入状态，非闪艺来源\r\n                        this.updateItems();\r\n                        this.game.world.bringToTop(this.sceneProxy.recordLayer);\r\n                        this.sceneProxy.recordLayer.visible = true;\r\n                        return;\r\n                    }\r\n                    this.localMode = false;\r\n                    this.isChangeClick = true;\r\n                    const btnLocal = this.sceneProxy.recordLayer.getByName('local_btn');\r\n                    const btnCloud = this.sceneProxy.recordLayer.getByName('cloud_btn');\r\n                    btnLocal.changeBackground('local');\r\n                    btnCloud.changeBackground('cloud_hover');\r\n                    this.sceneProxy.onRecordCloudBtnClicked();\r\n                }, rj => {\r\n                    if(isshow === true){\r\n                        //未登入状态\r\n                        this.updateItems();\r\n                        this.game.world.bringToTop(this.sceneProxy.recordLayer);\r\n                        if(this.sceneProxy.isShowGuide === true && this.sceneProxy.recordLayer.visible !== true && this.sceneProxy.isWap3000()) this.sceneProxy.showGuideTip(1);\r\n                        this.sceneProxy.recordLayer.visible = true;\r\n                        return;\r\n                    }\r\n                    let n = rj.indexOf('- status:-1');\r\n                    n = n >= 0 ? n : rj.indexOf('- status:2');\r\n                    if (n >= 0) {\r\n                        this.sceneProxy.context.fullScreen && this.sceneProxy.onSettingsWindowModeBtnClicked();\r\n\r\n                        //频繁操作，强行切换到本地存档   先切换 再弹窗;\r\n                        if(rj.indexOf('- status:-110') > 0){\r\n                            const btnLocal = this.sceneProxy.recordLayer.getByName('local_btn');\r\n                            const btnCloud = this.sceneProxy.recordLayer.getByName('cloud_btn');\r\n                            btnLocal.changeBackground(\"local_hover\",\"local_btn\");\r\n                            btnCloud.changeBackground(\"cloud\",\"cloud_btn\");\r\n                            this.sceneProxy.onRecordLocalBtnClicked();\r\n                            this.localMode = true;\r\n                        }\r\n                        if (flashvars.app_version >= '1.2.0') {\r\n                            window.location.href = 'lzj3000://logout';\r\n                        }\r\n                        Dialog.error(rj.substr(0, n)).then(()=>{\r\n                            if(rj.indexOf('- status:-110') < 0){ //非操作频繁  跳到登入界面\r\n                                window.location.href = 'lzj3000://login';\r\n                            }\r\n                        })\r\n                    } else if (0 <= rj.indexOf('error')) {\r\n                        this.sceneProxy.context.fullScreen && this.sceneProxy.onSettingsWindowModeBtnClicked();\r\n                        Dialog.error('网络异常，请检查您的网络！');\r\n                    }\r\n                });\r\n            }\r\n        },\r\n\r\n        addRecord: function () {\r\n            const {background, scrollBox, back} = this.sceneProxy.json_data.template.json.record;\r\n            let {rect: boxRect, item: boxItem, itemsOffsetX, itemsOffsetY, itemSpaceX: hSpace, itemSpaceY: vSpace} = scrollBox;\r\n            const {rect: itemRect, hint, content} = boxItem;\r\n            const {rect: hintRect, text: hintText} = hint;\r\n            const {rect: contentRect} = content;\r\n            const {x: boxX, y: boxY, width: boxWidth, height: boxHeight} = boxRect;\r\n            const {x: itemX, y: itemY, width: itemWidth, height: itemHeight} = itemRect;\r\n            const {x: hintX, y: hintY, width: hintWidth, height: hintHeight} = hintRect;\r\n            const {x: contentX, y: contentY, width: contentWidth, height: contentHeight} = contentRect;\r\n            hSpace = hSpace === undefined ? 20 : hSpace;\r\n            vSpace = vSpace === undefined ? 12 : vSpace;\r\n            itemsOffsetX = itemsOffsetX === undefined ? 0 : itemsOffsetX;\r\n            itemsOffsetY = itemsOffsetY === undefined ? 0 : itemsOffsetY;\r\n\r\n            const fontStyle = {boundsAlignH: 'center', boundsAlignV: 'middle'};\r\n            const addTextContent = (x, y, width, height, content, objText) => {\r\n                let txt;\r\n                let ff = '';\r\n                ff += objText.fontWeight ? objText.fontWeight + ' ' : 'normal ';\r\n                ff += objText.fontSize ? parseInt(objText.fontSize) + 'px ' : '';\r\n                ff += this.sceneProxy.json_data.font ? this.sceneProxy.json_data.font.fontFamily : objText.fontFamily ? objText.fontFamily : '';\r\n\r\n                fontStyle.font = ff;\r\n                fontStyle.fill = objText.color;\r\n                txt = this.game.add.text(0, 0, content, fontStyle, this.sceneProxy.recordLayer);\r\n\r\n                if (FontUtils.fontFamily) {\r\n                    const color = (objText.color ? objText.color : this.json_data.default_settings.color).replace('#', '0x');\r\n                    if (color.indexOf('rgb') !== -1) {\r\n                        const rgb = color.replace('rgb(', '').replace(')', '').split(',');\r\n                        txt.addColor('#' + ('00000' + (parseInt(rgb[0]) << 16 | parseInt(rgb[1]) << 8 | parseInt(rgb[2])).toString(16)).substr(-6), 0);\r\n                    }\r\n                    else {\r\n                        txt.addColor(color, 0);\r\n                    }\r\n\r\n                    const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(txt.fontSize) : txt.fontSize;\r\n                    txt.x = x + (width - 14 * 14 * fw / 25 - 21 - 22 * fw / 25) / 2;\r\n                    txt.y = y + (txt.height - parseInt(txt.fontSize)) / 2;\r\n                    txt.wordWrapWidth = 20 * 13 * fw / 25;\r\n                }\r\n                else {\r\n                    txt.setTextBounds(x, y + (txt.height - parseInt(objText.fontSize)) / 2, width, height);\r\n                }\r\n\r\n                return txt;\r\n            };\r\n\r\n            // 背景\r\n            const bk = this.sceneProxy.recordLayer.create(0, 0, this.game.load.cache.checkImageKey(background.url) && background.url);\r\n            bk.width = this.game.world.width;\r\n            bk.height = this.game.world.height;\r\n            bk.inputEnabled = true;\r\n\r\n            // scrollBox\r\n            const scrollPane = this.game.add.sprite(0, 0);\r\n\r\n            const backgroundRect = Object.assign({x: 0, y: 0, width: boxWidth, height: boxHeight}, background.rect);\r\n            const scrollBk = this.sceneProxy.recordLayer.create(boxX + backgroundRect.x,\r\n                boxY + backgroundRect.y,\r\n                this.game.load.cache.checkImageKey(scrollBox.background.url) && scrollBox.background.url);\r\n            scrollBk.width = backgroundRect.width;\r\n            scrollBk.height = backgroundRect.height;\r\n\r\n            const scrollX = boxX + itemsOffsetX;\r\n            const scrollY = boxY + itemsOffsetY;\r\n            scrollPane.x = scrollX;\r\n            scrollPane.y = scrollY;\r\n            scrollPane.name = 'scrollPane';\r\n            this.sceneProxy.recordLayer.add(scrollPane);\r\n            // item\r\n            const nRow = 3;//Math.ceil(boxHeight / itemHeight);\r\n            const nCol = 4;//Math.floor(boxWidth / itemWidth);\r\n            let nLeft = 0;\r\n            let nTop = 0;\r\n            let keyItemBk;\r\n            let ptDown = {x: 0, y: 0};\r\n            const dragBk = this.game.add.sprite(0, 0);\r\n            dragBk.width = (itemWidth + hSpace) * nCol;\r\n            dragBk.height = (itemHeight + vSpace) * nRow;\r\n            scrollPane.addChild(dragBk);\r\n\r\n            let dragStartPointX = 0;\r\n            let dragStartY = null;\r\n\r\n            const onScroll = (x, y) => {\r\n                const scrollHeight = itemHeight * nRow + vSpace * (nRow - 1);\r\n                if (y > scrollY || scrollHeight <= boxHeight) {\r\n                    scrollPane.y = scrollY;\r\n                }\r\n                else if (y + scrollHeight < boxY + boxHeight) {\r\n                    scrollPane.y = boxY + boxHeight - (itemHeight * nRow + vSpace * (nRow - 1));\r\n                }\r\n                else {\r\n                    scrollPane.y = y;\r\n                }\r\n            };\r\n\r\n            const onDragUpdate = (sprite, pointer, x, y, pt, bFromStart) => {\r\n                let px = x;\r\n                let py = y;\r\n                if (document.body.clientWidth < document.body.clientHeight && dragStartY !== null) {\r\n                    py = dragStartY - x + dragStartPointX;\r\n                }\r\n                onScroll(px, py);\r\n            };\r\n\r\n            const onDragStart = (sprite, pointer, x, y, pt, bFromStart) => {\r\n                dragStartPointX = x;\r\n                dragStartY = scrollPane.y;\r\n            };\r\n\r\n            const onDragStop = (sprite, pointer, x, y, pt, bFromStart) => {\r\n                dragStartY = scrollPane.y;\r\n            };\r\n\r\n            const getPoint = (pointer) => {\r\n                let x, y;\r\n\r\n                if (document.body.clientWidth > document.body.clientHeight) {\r\n                    x = pointer.worldX;\r\n                    y = pointer.worldY;\r\n                }\r\n                else {\r\n                    x = pointer.worldY;\r\n                    y = -pointer.worldX;\r\n                }\r\n                if (y < scrollY || y > /*boxY*/scrollY + boxHeight ||\r\n                    x < scrollX || x > /*boxX*/scrollX + boxWidth) {\r\n                    return null;\r\n                }\r\n                return {x, y}\r\n            };\r\n\r\n            const onInputDown = (sprite, pointer, x, y) => {\r\n                if (!getPoint(pointer)) {\r\n                    return sprite.input.disableDrag();\r\n                }\r\n                return sprite.input.enableDrag();\r\n            };\r\n\r\n            const onItemUp = (m, pt) => {\r\n                const point = getPoint(pt);\r\n                if (!point || pt.pointerMode === Phaser.PointerMode.CURSOR && pt.button !== 0) {\r\n                    return;\r\n                }\r\n                ptDown.x = 0;\r\n                ptDown.y = 0;\r\n                const x = point.x - scrollPane.x;\r\n                const y = point.y - scrollPane.y;\r\n                const w = itemWidth + hSpace;\r\n                const h = itemHeight + vSpace;\r\n                if (x % w < itemWidth && y % h < itemHeight) {\r\n                    const iCol = Math.floor(x / w);\r\n                    const iRow = Math.floor(y / h);\r\n                    this.sceneProxy.onRecordItemClicked(iCol, iRow);\r\n                    if (!this.sceneProxy.bToSaveFile) {\r\n                        this.callbackInfo = null;\r\n                    }\r\n                }\r\n            };\r\n\r\n            const onMouseWheel = e => {\r\n                const delta = e.wheelDelta ? e.wheelDelta / 120 : -e.detail / 3;\r\n                onScroll(0, scrollPane.y + delta * 100)\r\n            };\r\n\r\n            let wheelEvent = false;\r\n            const onMove = (pointer, x, y) => {\r\n                const point = getPoint(pointer);\r\n                const mousewheelevt = (/Firefox/i.test(navigator.userAgent)) ? \"DOMMouseScroll\" : \"mousewheel\";\r\n                if (!point) {\r\n                    if (wheelEvent) {\r\n                        document.removeEventListener(mousewheelevt, onMouseWheel);\r\n                        wheelEvent = false;\r\n                    }\r\n                }\r\n                else {\r\n                    if (!wheelEvent) {\r\n                        document.addEventListener(mousewheelevt, onMouseWheel);\r\n                        wheelEvent = true;\r\n                    }\r\n                }\r\n            };\r\n\r\n            keyItemBk = this.game.load.cache.checkImageKey(boxItem.background.url) ? boxItem.background.url : null;\r\n\r\n            for (let r = 0; r < nRow; r++) {\r\n                for (let c = 0; c < nCol; c++) {\r\n                    const itemGroup = this.game.add.group();\r\n                    itemGroup.x = c * (itemWidth + hSpace) + itemX;\r\n                    itemGroup.y = r * (itemHeight + vSpace) + itemY;\r\n                    itemGroup.name = `recordItem_${r * 4 + c}`;\r\n                    const item_bk = this.game.add.sprite(nLeft, nTop, keyItemBk);\r\n                    item_bk.width = itemWidth;\r\n                    item_bk.height = itemHeight;\r\n\r\n                    const subItem = this.sceneProxy.recordLayer.create(contentX, contentY, this.game.load.cache.checkImageKey(content.background.url) && content.background.url);\t\t// content\r\n                    subItem.name = 'content';\r\n                    subItem.width = contentWidth;\r\n                    subItem.height = contentHeight;\r\n\r\n                    const txtTime = addTextContent(hintX\r\n                        , hintY\r\n                        , hintWidth\r\n                        , hintHeight\r\n                        , ''\r\n                        , hintText);\r\n                    txtTime.name = 'textTime';\r\n                    const itemMask = this.game.add.graphics(0, 0);\r\n                    itemMask.beginFill();\r\n                    itemMask.drawRect(0, 0, itemWidth, itemHeight);\r\n                    itemMask.endFill();\r\n                    itemGroup.addChild(itemMask);\r\n                    itemGroup.mask = itemMask;\r\n                    itemGroup.add(item_bk);\r\n                    itemGroup.add(subItem);\r\n                    itemGroup.add(txtTime);\r\n\r\n                    if (this.sceneProxy.json_data.default_settings.autoSaveOrLoad && r === 0 && c === 0) {\r\n                        const autoRecord_Bk = this.game.add.bitmapData(itemWidth, itemHeight);\r\n                        autoRecord_Bk.fill(0, 0, 0, 0.4);\r\n                        const autoRecord = this.game.add.sprite(0, 0, autoRecord_Bk);\r\n                        autoRecord.width = itemWidth;\r\n                        autoRecord.height = itemHeight;\r\n                        const fontStyle = {\r\n                            font: '16px Microsoft YaHei',\r\n                            fill: 'white',\r\n                            boundsAlignH: 'center',\r\n                            boundsAlignV: 'middle'\r\n                        };\r\n                        const autoRecord_txt = this.game.add.text(0, 0, '自动存档', fontStyle, this.sceneProxy.coverLayer);\r\n                        autoRecord_txt.setTextBounds(0, (autoRecord_txt.height - 16) / 2, itemWidth, itemHeight);\r\n                        itemGroup.add(autoRecord);\r\n                        itemGroup.add(autoRecord_txt);\r\n                    }\r\n\r\n                    scrollPane.addChild(itemGroup);\r\n                }\r\n            }\r\n            scrollPane.inputEnabled = true;\r\n            scrollPane.input.enableDrag();\r\n            scrollPane.input.allowHorizontalDrag = false;\r\n            scrollPane.events.onDragUpdate.add(onDragUpdate, this);\r\n            scrollPane.events.onDragStart.add(onDragStart, this);\r\n            scrollPane.events.onDragStop.add(onDragStop, this);\r\n            scrollPane.events.onInputUp.add(onItemUp, this);\r\n            scrollPane.events.onInputDown.add(onInputDown, this);\r\n            this.game.input.addMoveCallback(onMove, this);\r\n\r\n            // mask\r\n            const mask = this.game.add.graphics(0, 0);\r\n            mask.beginFill();\r\n            mask.drawRect(scrollPane.x, scrollPane.y, boxWidth - itemsOffsetX, boxHeight - itemsOffsetY);\r\n            mask.endFill();\r\n            this.sceneProxy.recordLayer.add(mask);\r\n            scrollPane.mask = mask;\r\n\r\n            // 返回按钮\r\n            const t = {};\r\n            t.normal = back.normal.text;\r\n            t.active = back.active.text;\r\n            t.text = this.sceneProxy.stringMap.back;\r\n\r\n            const onBtnClicked = (obj, pointer) => {\r\n                if (pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n                    return;\r\n                }\r\n                if ('record_button_back' === obj.parent.name) {\r\n                    this.sceneProxy.onRecordBackBtnClicked();\r\n                    if (this.callbackInfo) {\r\n                        this.callbackInfo.callbackFun(this.callbackInfo.callbackArgs);\r\n                        this.callbackInfo = null;\r\n                    }\r\n                }\r\n                else if ('local_btn' === obj.parent.name) {\r\n                    this.onLocalBtnClicked();\r\n                }\r\n                else if ('cloud_btn' === obj.parent.name) {\r\n                    this.onCloudBtnClicked();\r\n                }\r\n            };\r\n\r\n            if (!back.hidden) {\r\n                const btnGroup = this.viewComponent.addButton(back.rect.x,\r\n                    back.rect.y,\r\n                    back.rect.width,\r\n                    back.rect.height,\r\n                    back.normal.background.url,\r\n                    back.active.background.url,\r\n                    onBtnClicked,\r\n                    t,\r\n                    this.sceneProxy.btn_sound,\r\n                    \"record_button_back\",\r\n                    this.sceneProxy.recordLayer\r\n                );\r\n                btnGroup.button.onInputUp.add(() => this.sceneProxy.btn_sound && this.sceneProxy.btn_sound.stop())\r\n            }\r\n            // 本地--云 按钮\r\n            /*t.text = '';\r\n            this.viewComponent.addButton(866, 25, 68, 68\r\n                , 'local_hover', null\r\n                , onBtnClicked\r\n                , t, null, 'local_btn'\r\n                , this.sceneProxy.recordLayer\r\n                , true);\r\n\r\n            this.viewComponent.addButton(866, 107, 68, 68\r\n                , 'cloud', null\r\n                , onBtnClicked\r\n                , t, null, 'cloud_btn'\r\n                , this.sceneProxy.recordLayer\r\n                , true);*/\r\n\r\n            this.sceneProxy.recordLayer.visible = false;\r\n        },\r\n\r\n        updateItems: function () {\r\n            this.sceneProxy.savedPlotsData.forEach((data, i) => {\r\n                const setPreviewImage = key => {\r\n                    const bKey = this.game.load.cache.checkImageKey(key) ? key : null;\r\n                    const itemContent = item.getByName('content');\r\n                    const {width, height} = itemContent;\r\n                    itemContent.loadTexture(bKey);\r\n                    itemContent.width = width;\r\n                    itemContent.height = height;\r\n                };\r\n                const {timestamp, plotSnap} = data ? data : {};\r\n                const item = this.sceneProxy.recordLayer.getByName('scrollPane').children.find(c => c.name === `recordItem_${i}`);\r\n                if (!item) {\r\n                    return;\r\n                }\r\n                if (!timestamp) {\r\n                    setPreviewImage(this.sceneProxy.json_data.template.json.record.scrollBox.item.content.background.url);\r\n                    item.getByName('textTime').text = '';\r\n                    return;\r\n                }\r\n                const itemTime = item.getByName('textTime');\r\n                const snapMd5 = MD5.hash(plotSnap);\r\n\r\n                if (!this.game.load.cache.checkImageKey(snapMd5)) {\r\n                    const data = new Image();\r\n                    data.src = plotSnap;\r\n                    data.onload = e => {\r\n                        if (!this.game.load.cache.checkImageKey(snapMd5)) {\r\n                            this.game.cache.addImage(snapMd5, plotSnap, e.target);\r\n                        }\r\n                        setPreviewImage(snapMd5);\r\n                    };\r\n                } else {\r\n                    setPreviewImage(snapMd5);\r\n                }\r\n                const strText = Utils.getCurrentDateTime(timestamp);\r\n                if (FontUtils.fontFamily) {\r\n                    const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(itemTime.fontSize) : itemTime.fontSize;\r\n                    const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(itemTime.fontSize) : itemTime.fontSize;\r\n                    this.sceneProxy.addImageFontText([{data:strText}], fw, fh, itemTime, this.sceneProxy.context);\r\n                    itemTime.text = ' ';\r\n                }\r\n                else {\r\n                    itemTime.text = strText;\r\n                }\r\n            });\r\n        },\r\n\r\n        showRecordLayer: function () {\r\n            if (this.sceneProxy.recordLayer.children.length === 0) {\r\n                this.addRecord();\r\n            }\r\n            /*if(this.isChangeClick !== true){\r\n                this.onCloudBtnClicked(true);\r\n                return;\r\n            }*/\r\n            this.updateItems();\r\n            this.game.world.bringToTop(this.sceneProxy.recordLayer);\r\n            //if(this.sceneProxy.isShowGuide === true && this.sceneProxy.recordLayer.visible !== true) this.sceneProxy.showGuideTip(1);\r\n            this.sceneProxy.recordLayer.visible = true;\r\n        },\r\n    },\r\n\r\n    {\r\n        /**\r\n         * @static\r\n         * @type {string}\r\n         */\r\n        NAME: 'RecordMediator'\r\n        , localMode: true\r\n        , isChangeClick:false //是否已点击切换\r\n    }\r\n);","/**\r\n * @class demo.view.TextComponentMediator\r\n * @extends puremvc.Mediator\r\n */\r\nimport './CoverMediator.js';\r\nimport './MainMenuMediator.js';\r\nimport './SettingsMediator.js';\r\nimport './PlaybackMediator.js';\r\nimport './RecordMediator.js';\r\nimport './EndMediator.js';\r\nimport  * as TextBox from './HtmlTextBox.js';\r\nimport Dialog from './../../common/Dialog.js';\r\nimport RePhaser from '../../common/RePhaser.js';\r\nimport Utils, {ResourcesManager} from '../../common/Utils.js';\r\nimport PhoneUtils from '../../common/PhoneUtils.js';\r\nimport FontUtils from '../../common/FontUtils.js';\r\n\r\nimport puremvc from 'puremvc';\r\n\r\npuremvc.define\r\n(\r\n\t// CLASS INFO\r\n\t{\r\n\t\tname: 'diygamePlayer.view.mediator.SceneMediator',\r\n\t\tparent: puremvc.Mediator\r\n\t},\r\n\r\n\t// INSTANCE MEMBERS\r\n\t{\r\n\t\t/** @override */\r\n\t\tlistNotificationInterests: function ()\r\n\t\t{\r\n\t\t\treturn [\r\n\t\t\t\tdiygamePlayer.AppConstants.SCENE_SHOW_AD,\r\n\t\t\t\tdiygamePlayer.AppConstants.SCENE_PRELOADING_BEGIN,\r\n\t\t\t\tdiygamePlayer.AppConstants.SCENE_PRELOADING_PROGRESS,\r\n\t\t\t\tdiygamePlayer.AppConstants.SCENE_PRELOADING_COMPLETE,\r\n\t\t\t\tdiygamePlayer.AppConstants.SCENE_LOADING_BEGIN,\r\n\t\t\t\tdiygamePlayer.AppConstants.SCENE_LOADING_PROGRESS,\r\n\t\t\t\tdiygamePlayer.AppConstants.SCENE_LOADING_COMPLETE,\r\n\t\t\t\tdiygamePlayer.AppConstants.SCENE_SHOW_LOGO,\r\n                diygamePlayer.AppConstants.SCENE_PLOT_LOAD_ASSETS_READY,\r\n                diygamePlayer.AppConstants.SCENE_PLOT_LOAD_ASSETS_LOADED,\r\n\t\t\t\tdiygamePlayer.AppConstants.SCENE_DESTROY_VIEW,\r\n                diygamePlayer.AppConstants.SCENE_SHOW_GUIDE,\r\n\t\t\t\tdiygamePlayer.AppConstants.SCENE_SHOW_INPUT_VIEW\r\n\t\t\t\t\t]\r\n\t\t},\r\n\r\n\t\t/** @override */\r\n\t\thandleNotification: function (note)\r\n\t\t{\r\n\t\t\tconst body = note.getBody();\r\n\t\t\tswitch ( note.getName() )\r\n\t\t\t{\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_SHOW_AD:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_PRELOADING_BEGIN:\r\n\t\t\t\t\tthis.sceneProxy.viewComponent = this.viewComponent;\r\n\t\t\t\t\tthis.sceneProxy.space_key = this.viewComponent.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);\r\n\t\t\t\t\tconst z_key = this.viewComponent.game.input.keyboard.addKey(Phaser.Keyboard.Z);\r\n\t\t\t\t\tz_key.onDown.add(() => this.sceneProxy.quickPlay = true);\r\n\t\t\t\t\tz_key.onUp.add(() => this.sceneProxy.quickPlay = false);\r\n\r\n\t\t\t\t\tthis.viewComponent.game.input.onHold.add(() => {\r\n\t\t\t\t\t\tthis.screenCaptured();\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.viewComponent.game.input.onUp.add(() => {\r\n\t\t\t\t\t\tthis.screenReleased();\r\n\t\t\t\t\t});\r\n\r\n                    // 创建各个层\r\n\t\t\t\t\tthis.generateLayers();\r\n\t\t\t\t\t// 设置允许跨域\r\n\t\t\t\t\tthis.viewComponent.game.load.crossOrigin = 'anonymous';\r\n\t\t\t\t\t// 加载json\r\n\t\t\t\t\tthis.viewComponent.preLoad()\r\n\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t//Utils.getSensitiveWords();\r\n                            this.addToastLayer();\r\n                            this.addLoadingToastLayer();\r\n                            return this.viewComponent.getGameJson()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.then(game => {\r\n\t\t\t\t\t\t\tif (Object.keys(game).length === 0) {\r\n\t\t\t\t\t\t\t\treturn Promise.reject(\"链接已过期\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.viewComponent.addLog('解析剧情配置...');\r\n\t\t\t\t\t\t\t//this.viewComponent.showLoading();//离线去除 loading 动画\r\n                            this.viewComponent.showOfflineBg();\r\n\t\t\t\t\t\t\treturn this.sceneProxy.parseJsonFile(game).then(() => {\r\n\t\t\t\t\t\t\t\tthis.viewComponent.addLog('解析剧情配置..【成功】', true);\r\n\r\n\t\t\t\t\t\t\t\treturn new Promise((resolve, reject) => {\r\n                                    const offlinebg = this.viewComponent.game.world.getByName('offlinebg');\r\n                                    if (offlinebg && 'Operation_tip' === offlinebg.key) {\r\n                                        const onClick = (obj, pointer) => {\r\n                                            if (pointer && pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n                                                return;\r\n                                            }\r\n                                            offlinebg.events.onInputDown.remove(onClick)\r\n                                            Utils.localStorageSetItem('shanyi3000opg', 'showed');\r\n                                            return resolve();\r\n                                        }\r\n                                        if (this.viewComponent.game.cache.checkImageKey('Continue')) {\r\n                                            this.viewComponent.game.add.image(409, 508, 'Continue').name = 'Continue';\r\n                                        }\r\n                                        offlinebg.events.onInputDown.addOnce(onClick);\r\n                                    }\r\n                                    else {\r\n                                        return resolve();\r\n                                    }\r\n                                });\r\n\t\t\t\t\t\t\t}, e => {\r\n\t\t\t\t\t\t\t\tthis.viewComponent.addLog('剧情配置解析错误:' + e);\r\n\t\t\t\t\t\t\t\treturn Promise.reject(e || \"解析Json错误\")\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n                        .then(() => {\r\n\t\t\t\t\t\t\t\tthis.sceneProxy.updateAccInfo(false,true);\r\n                                //Utils.sendStatistics();\r\n                                //Utils.uploadLocalStorage().then(r => Utils.downloadLocalStorage());\r\n                            }, e => {\r\n\t\t\t\t\t\t\t\treturn Promise.reject(e)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.then(() => null, e => {\r\n\t\t\t\t\t\t\tif (flashvars.client && flashvars.client !== '') {\r\n\t\t\t\t\t\t\t\tDialog.warn(e + '关闭播放器吗？').then(() =>{window.location.href = 'lzj3000://quit'}, () => null)\r\n\t\t\t\t\t\t\t} else {\r\n                                Dialog.warn(e + \"，返回闪艺首页吗？\").then(() => window.location.href = \"http:\\\\\\\\www.3000.com\", () => null)\r\n                            }\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_PRELOADING_PROGRESS:\r\n\t\t\t\t\t// 启动资源加载\r\n\t\t\t\t\tthis.assetsLoaderStart(diygamePlayer.AppConstants.SCENE_PRELOADING_COMPLETE);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_PRELOADING_COMPLETE:\r\n\t\t\t\t\tthis.viewComponent.destroyLogo();\r\n\t\t\t\t\tconst game = this.sceneProxy.json_data;\r\n\t\t\t\t\tthis.sceneProxy.initContext();\r\n\t\t\t\t\tconst {sound} = this.sceneProxy.json_data.template.json;\r\n                    const offlinebg = this.viewComponent.game.world.getByName('offlinebg');\r\n                    const imgContinue = this.viewComponent.game.world.getByName('Continue');\r\n                    offlinebg && offlinebg.destroy();\r\n                    imgContinue && imgContinue.destroy();\r\n                    if (this.viewComponent.game.load.cache.checkSoundKey(sound.url)) {\r\n\t\t\t\t\t\tthis.sceneProxy.btn_sound = this.viewComponent.game.add.sound(sound.url, sound.volume);\r\n\t\t\t\t\t}\r\n                    if (game.logo && !game.logo.background.hidden) {\r\n                        this.sceneProxy.showLogo();// 创建Logo\r\n                    }\r\n                    else if (!game.cover.hidden) {\r\n                        this.sceneProxy.showCover();// 创建封面\r\n                    }\r\n                    else {\r\n                        let chapter = this.sceneProxy.findFirstChapter();\r\n                        const chapterUuid = chapter.downloadUuid ? chapter.downloadUuid : chapter.uuid;\r\n                        if (chapter.md5 && chapter.plots.length === 0) {\r\n                            if (chapter.charge && ('android' === flashvars.client || 'ios' === flashvars.client)) {\r\n                                const unlockFinish = (bSuccess) => {\r\n                                    if (bSuccess) {\r\n                                        this.sceneProxy.checkIfChapterFree(chapterUuid, chapter.md5).then((plots)=>{\r\n                                            this.sceneProxy.unlockChapterCallBack = null;\r\n                                            chapter.plots = plots;\r\n                                            this.sceneProxy.preloadChapterAssets(this.sceneProxy.context, chapter);\r\n                                        }, () => Dialog.error('获取付费章节信息失败'))\r\n                                    } else {\r\n                                        Dialog.error('章节解锁失败');\r\n                                    }\r\n                                };\r\n\r\n                                this.sceneProxy.unlockChapter(chapterUuid, chapter.charge, chapter.md5, unlockFinish);\r\n                            } else {\r\n                                this.sceneProxy.checkIfChapterFree(chapterUuid, chapter.md5).then((plots)=>{\r\n                                    chapter.plots = plots;\r\n                                    this.sceneProxy.preloadChapterAssets(this.sceneProxy.context, chapter);\r\n                                }, (msg)=>{\r\n                                    if (-1 === msg.indexOf('code=87')) {\r\n                                        Dialog.error(msg);\r\n                                    } else { // 未购买此章节\r\n                                        Dialog.info('当前为收费章节，请前往闪艺app或电脑端进行购买');\r\n                                    }\r\n                                })\r\n                            }\r\n                        }\r\n                        else {// 播放剧情\r\n                            this.sceneProxy.preloadChapterAssets(this.sceneProxy.context, chapter);\r\n                        }\r\n                    }\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_LOADING_BEGIN:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_LOADING_PROGRESS:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_LOADING_COMPLETE:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_SHOW_LOGO:\r\n\t\t\t\t\tthis.showLogo();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_PLOT_LOAD_ASSETS_READY:\r\n\t\t\t\t\tthis.assetsLoaderStart(diygamePlayer.AppConstants.SCENE_PLOT_LOAD_ASSETS_LOADED, body);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_PLOT_LOAD_ASSETS_LOADED:\r\n\t\t\t\t\tthis.showPlot(body.context, this.sceneProxy.curChapter, this.sceneProxy.curPlotIndex, this.sceneProxy.cmdPlotSnap, body.loadData);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_DESTROY_VIEW:\r\n\t\t\t\t\tthis.destroyView(body.name, body.isMainMenu);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_SHOW_GUIDE:\r\n\t\t\t\t\tthis.showGuideTip(body.id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase diygamePlayer.AppConstants.SCENE_SHOW_INPUT_VIEW:\r\n\t\t\t\t\tthis.showInputView(this.sceneProxy.plotViewsLayer, !!body);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgenerateLayers: function () {\r\n            this.sceneProxy.coverLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.coverLayer.name = 'coverLayer';\r\n            this.sceneProxy.progressLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.progressLayer.name = 'progressLayer';\r\n            this.sceneProxy.dialogLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.dialogLayer.name = 'dialogLayer';\r\n            this.sceneProxy.dialogLayer.animateTweens = [];\r\n            this.sceneProxy.menuLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.menuLayer.name = 'menuLayer';\r\n            this.sceneProxy.mainMenuLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.mainMenuLayer.name = 'mainMenuLayer';\r\n            this.sceneProxy.mainMenuLayer.visible = false;\r\n            this.sceneProxy.settingsLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.settingsLayer.name = 'settingsLayer';\r\n            this.sceneProxy.settingsLayer.visible = false;\r\n            this.sceneProxy.recordLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.recordLayer.name = 'recordLayer';\r\n            this.sceneProxy.recordLayer.visible = false;\r\n            this.sceneProxy.playBackLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.playBackLayer.name = 'playBackLayer';\r\n            this.sceneProxy.playBackLayer.visible = false;\r\n            this.sceneProxy.weatherLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.weatherLayer.name = 'weatherLayer';\r\n            this.sceneProxy.plotViewsLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.plotViewsLayer.name = 'plotViewsLayer';\r\n            this.sceneProxy.endLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.endLayer.name = 'endLayer';\r\n            this.sceneProxy.toastLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.toastLayer.name = 'toastLayer';\r\n            this.sceneProxy.loadingToastLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.loadingToastLayer.name = 'loadToastLayer';\r\n            this.sceneProxy.quickPlayLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.quickPlayLayer.name = 'quickPlayLayer';\r\n            this.sceneProxy.guideLayer = this.viewComponent.game.add.group();\r\n            this.sceneProxy.guideLayer.name = 'guideLayer';\r\n        },\r\n\r\n\t\tscreenCaptured: function () {\r\n\t\t\tif (!this.sceneProxy.isGameStarted) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n            if (this.sceneProxy.quickPlayLayer.children.length === 0) {\r\n                const bk = this.sceneProxy.quickPlayLayer.create(0, 0, 'app_button_speed');\r\n                const icon = this.sceneProxy.quickPlayLayer.create(0, 0, 'app_icon_speed');\r\n                const f1 = {font: '25px PingFang-SC-Regular', fill: '#333333'};\r\n                const t1 = this.viewComponent.game.add.text(0, 0, '快进中...', f1, this.sceneProxy.quickPlayLayer);\r\n                const f2 = {font: '20px PingFang-SC-Regular', fill: '#aaadb3'};\r\n                const t2 = this.viewComponent.game.add.text(0, 0, '松开手指恢复播放', f2, this.sceneProxy.quickPlayLayer);\r\n\r\n                bk.x = (this.viewComponent.game.world.width - bk.width) / 2;\r\n                bk.y = (this.viewComponent.game.world.height - bk.height) / 2;\r\n                icon.x = bk.x + 90;\r\n                icon.y = bk.y + 25;\r\n                t1.x = icon.x - 10;\r\n                t1.y = icon.y + icon.height + 14;\r\n                t2.x = bk.x + 39;\r\n                t2.y = t1.y + 33;\r\n            }\r\n\r\n            this.sceneProxy.isScreenHold = true;\r\n\t\t\tthis.sceneProxy.quickPlay = true;\r\n\t\t\tthis.sceneProxy.removePlotTweens();\r\n\r\n            const quickPlayHandler = () => {\r\n                const sceneProxy = this.sceneProxy;\r\n                const game = this.viewComponent.game;\r\n                return function () {\r\n                    const hasView = sceneProxy.plotViewsLayer.children.length > 0;\r\n                    if (!hasView) {\r\n                        let pointer = new Phaser.Pointer(game, 1, Phaser.PointerMode.CURSOR);\r\n                        pointer.button = 0;\r\n                        sceneProxy.curPlotLayer.onChildInputDown.dispatch('quickPlayHandler', pointer);\r\n                    }\r\n\r\n                    if (sceneProxy.isScreenHold) {\r\n                        setTimeout(quickPlayHandler(), 500);\r\n                    }\r\n                }\r\n            };\r\n            setTimeout(quickPlayHandler(), 20);\r\n\r\n            this.sceneProxy.quickPlayLayer.alpha = 1;\r\n\t\t\tthis.viewComponent.game.world.bringToTop(this.sceneProxy.quickPlayLayer);\r\n        },\r\n\t\tscreenReleased: function () {\r\n\t\t\tif (this.sceneProxy.isScreenHold) {\r\n\t\t\t\tthis.sceneProxy.isScreenHold = false;\r\n\t\t\t\tthis.sceneProxy.quickPlay = false;\r\n\r\n                this.sceneProxy.quickPlayLayer.alpha = 0;\r\n                //this.viewComponent.game.add.tween(this.sceneProxy.quickPlayLayer).from({alpha: 1}, 800, null, true).name = 'toast';\r\n\t\t\t}\r\n        },\r\n\r\n        cmdPlotLoadResources: function(context, chapter, nPlot, cmdInfo, index) {\r\n            const cache = this.viewComponent.game.load.cache;\r\n            const cmd = cmdInfo.commands[index];\r\n            const resources = this.sceneProxy.getOneCommandResourceInfo(cmd);\r\n\r\n            let needLoad = false;\r\n            resources.forEach(({ type, url })=> {\r\n                if (!url) {\r\n                    return;\r\n                }\r\n                const exist = type === 'img' ? cache.checkImageKey(url) : ('ios' === flashvars.client && flashvars.app_version >= '1.5.0') ? PhoneUtils.isAudioInCache(url) : cache.checkSoundKey(url);\r\n                if (exist) {\r\n                    const count = ResourcesManager.getCount(type, url, 'play');\r\n                    const usingCount = this.sceneProxy.usingResourceCount(url);\r\n                    usingCount === count && ResourcesManager.addRefCount(type, url);\r\n                } else {\r\n                    needLoad = true;\r\n                }\r\n            });\r\n\r\n            if (needLoad) {\r\n                return this.sceneProxy.preloadCommandsAssets(context, chapter, nPlot, cmdInfo, index).then(() => this.assetsLoader());\r\n            }\r\n            return Promise.resolve();\r\n        },\r\n\r\n        //引导层\r\n        showGuideTip:function (showtype) {\r\n\t\t\treturn new Promise((resolve,reject) =>{\r\n                if('android' !== flashvars.client && 'ios' !== flashvars.client){\r\n                    //非移动端 无需引导图\r\n                    this.sceneProxy.guideLayer.visible = false;\r\n                    return resolve();\r\n                }\r\n                const show=(type) =>{\r\n                    if(this.sceneProxy.isShowGuide === true){\r\n                        let CloudImg = this.sceneProxy.guideLayer.getByName(\"Cloud_record_tip\");\r\n                        if(this.sceneProxy.guideLayer.children.length <= 0){\r\n                            this.sceneProxy.guideLayer.inputEnableChildren = true;\r\n                            this.sceneProxy.guideLayer.inputEnabled = true;\r\n                            if(!this.viewComponent.game.load.cache.checkImageKey(\"Cloud_record_tip\") && type === 1){\r\n                                //图片不存在时  不显示引导\r\n                                return resolve();\r\n                            }\r\n                            CloudImg = this.sceneProxy.guideLayer.create(this.viewComponent.game.world.width / 2, this.viewComponent.game.world.height / 2,\"Cloud_record_tip\");\r\n                            CloudImg.name = 'Cloud_record_tip';\r\n                            CloudImg.anchor.setTo(0.5, 0.5);\r\n                            CloudImg.visible =false;\r\n                        }\r\n\r\n                        this.sceneProxy.guideLayer.alpha = 1;\r\n                        this.sceneProxy.guideLayer.visible = true;\r\n                        CloudImg.visible = type === 0 ? false : true;\r\n                        this.viewComponent.game.world.bringToTop(this.sceneProxy.guideLayer);\r\n                        const onClick = (obj, pointer) => {\r\n                            if (pointer && pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n                                return;\r\n                            }\r\n                            this.sceneProxy.guideLayer.onChildInputDown.remove(onClick)\r\n                            this.tweenToPromise(\r\n                                this.sceneProxy.guideLayer,\r\n                                {alpha:0},\r\n                                1000, null, true, 0, 0, false)\r\n                                .then(() =>{\r\n                                    this.sceneProxy.guideLayer.visible = false;\r\n                                    this.sceneProxy.guideLayer.alpha = 0;\r\n                                    if(type !==0 ) this.sceneProxy.isShowGuide = false;\r\n                                    Utils.localStorageSetItem(uuid, JSON.stringify({count:this.sceneProxy.recordTipCount}));\r\n                                    return resolve();\r\n                                })\r\n                        };\r\n                        this.sceneProxy.guideLayer.onChildInputDown.add(onClick);\r\n                    }\r\n                };\r\n\r\n\t\t\t\tconst uuid = \"shanyi3000guide\";//\"guide\" + flashvars.uuid;\r\n\t\t\t\tconst guidedata = JSON.parse(Utils.localStorageGetItem(uuid));\r\n\t\t\t\tif(guidedata !== null && guidedata !== undefined ){\r\n\t\t\t\t\t//存档有值\r\n\t\t\t\t\tthis.sceneProxy.recordTipCount = guidedata.count;\r\n                    if(showtype === 1){\r\n                            //超过10次 无须引导\r\n\t\t\t\t\t\tif(this.sceneProxy.recordTipCount >= 10){\r\n\t\t\t\t\t\t\tthis.sceneProxy.isShowGuide = false;\r\n                            this.sceneProxy.guideLayer.visible = false;\r\n\t\t\t\t\t\t\treturn resolve();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.sceneProxy.recordTipCount ++;\r\n                        show(showtype);\r\n\t\t\t\t\t} else if(showtype === 0){\r\n                    \tthis.sceneProxy.guideLayer.visible = false;\r\n                        return resolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\t//没有存档值，显示0引导图\r\n                    this.sceneProxy.isShowGuide = true;\r\n                    show(showtype);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n        },\r\n\r\n\t\taddLoadingToastLayer: function () {\r\n\t\t\tif (this.sceneProxy.loadingToastLayer.children.length === 0) {\r\n                let g = this.viewComponent.game.add.group();\r\n                this.sceneProxy.loadingToastLayer.add(g);\r\n\r\n                let bk = this.viewComponent.game.add.graphics(/*350*/0, /*252*/0, g);\r\n                bk.beginFill(0x3dc4cc);\r\n                bk.drawRect(0, 0, 135, 36);\r\n                bk.endFill();\r\n\r\n                const tl = g.create(8, 9, 'toast_loading');\r\n                this.viewComponent.addGifAnimation(tl, 'toast_loading');\r\n\r\n                const fontStyle = {font: '16px 微软雅黑', fill: '#ffffff'};\r\n                let toastText = this.viewComponent.game.add.text(/*380*/33, /*260*/8, '保存档案中~', fontStyle, g);\r\n                toastText.name = 'toastText';\r\n                g.x = (this.viewComponent.game.world.width - toastText.width) / 2;\r\n                g.y = 252;\r\n                g.alpha = 0.8;\r\n                this.sceneProxy.loadingToastLayer.visible = false;\r\n            }\r\n        },\r\n\r\n\t\taddToastLayer: function () {\r\n\t\t\tif (this.sceneProxy.toastLayer.children.length === 0) {\r\n\t\t\t\tlet typeSuccess = this.viewComponent.game.add.group();\r\n\t\t\t\tlet typeError = this.viewComponent.game.add.group();\r\n\t\t\t\ttypeSuccess.name = 'typeSuccess';\r\n\t\t\t\ttypeError.name = 'typeError';\r\n\t\t\t\tthis.sceneProxy.toastLayer.add(typeSuccess);\r\n\t\t\t\tthis.sceneProxy.toastLayer.add(typeError);\r\n\r\n\t\t\t\tlet bk1 = this.viewComponent.game.add.graphics(/*320*/0, /*252*/0, typeSuccess);\r\n                let bk2 = this.viewComponent.game.add.graphics(/*350*/0, /*252*/0, typeError);\r\n                bk1.beginFill(0x3dc4cc);\r\n                bk1.drawRect(0, 0, 320, 36);\r\n                bk1.endFill();\r\n                bk2.beginFill(0x3dc4cc);\r\n                bk2.drawRect(0, 0, 260, 36);\r\n                bk2.endFill();\r\n\r\n\t\t\t\ttypeSuccess.create(/*330*/10, /*262*/10, 'icon_success');\r\n\t\t\t\ttypeError.create(/*360*/10, /*262*/10, 'icon_error');\r\n\r\n                const fontStyle = {font: '16px 微软雅黑', fill: '#ffffff'};\r\n                let toastText = this.viewComponent.game.add.text(/*350*/30, /*260*/8, '存档成功，下次可以从这里读档继续哦~', fontStyle, typeSuccess);\r\n                toastText.name = 'toastText';\r\n\r\n                toastText = this.viewComponent.game.add.text(/*380*/30, /*260*/8, '存档失败，请检查您的网络哦~', fontStyle, typeError);\r\n                toastText.name = 'toastText';\r\n\r\n                typeSuccess.visible = false;\r\n                typeError.visible = false;\r\n                this.sceneProxy.toastLayer.alpha = 0;\r\n            }\r\n        },\r\n\r\n\t\tassetsLoaderStart: function (nextNotifier, body) {\r\n\t\t\tlet curSceneProxy;\r\n\t\t\tconst decodingAudios = [];\r\n\t\t\tconst { game } = this.viewComponent;\r\n\t\t\tconst { load, sound, cache } = game;\r\n\r\n            let loadedFileCount = 0;\r\n            let totalFileCount = load._totalFileCount;\r\n\r\n\t\t\tconst sendNotification = () => {\r\n\t\t\t\tif ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n\t\t\t\t    if (curSceneProxy && PhoneUtils.audioCountLoadByPhone.total === PhoneUtils.audioCountLoadByPhone.loaded) {\r\n                        PhoneUtils.audioCountLoadByPhone.total = 0;\r\n                        PhoneUtils.audioCountLoadByPhone.loaded = 0;\r\n                        sound.onSoundDecode.remove(handleSoundDecode);\r\n                        sound.onSoundDecodeError.remove(handleSoundDecodeError);\r\n                        load.onSoundLoadExtend.removeAll();\r\n                        this.sceneProxy.progressLayer.visible = false;\r\n                        curSceneProxy.sendNotification(nextNotifier, body);\r\n                    }\r\n\t\t\t\t}\r\n\t\t\t\telse if (curSceneProxy && decodingAudios.every(sound => sound.decoded)) {\r\n\t\t\t\t\tsound.onSoundDecode.remove(handleSoundDecode);\r\n\t\t\t\t\tsound.onSoundDecodeError.remove(handleSoundDecodeError);\r\n\t\t\t\t\tthis.sceneProxy.progressLayer.visible = false;\r\n\t\t\t\t\tcurSceneProxy.sendNotification(nextNotifier, body);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tconst handleSoundLoadExtend = (key, sceneProxy) => {\r\n                const loaded = PhoneUtils.audioCountLoadByPhone.loaded + loadedFileCount;\r\n                const total = PhoneUtils.audioCountLoadByPhone.total + totalFileCount;\r\n                const prgs = parseInt(loaded * 100 / total);\r\n                this.showProgress(prgs, loaded, total, !!body);\r\n                if (loaded === total && loadedFileCount === totalFileCount) {\r\n                    curSceneProxy = sceneProxy;\r\n                    sendNotification();\r\n                }\r\n\t\t\t};\r\n\t\t\tconst handleSoundDecode = () => sendNotification();\r\n\t\t\tconst handleSoundDecodeError = (key) => {\r\n\t\t\t\tlet index = -1;\r\n\t\t\t\tconst sound = cache.getSound(key);\r\n\t\t\t\tif ((index = decodingAudios.findIndex(s => s === sound)) !== -1) {\r\n\t\t\t\t\tdecodingAudios.splice(index, 1);\r\n\t\t\t\t\tcache.removeSound(key);\r\n\t\t\t\t}\r\n\t\t\t\tsendNotification();\r\n\t\t\t};\r\n\t\t\tsound.onSoundDecode.add(handleSoundDecode);\r\n\t\t\tsound.onSoundDecodeError.add(handleSoundDecodeError);\r\n\t\t\t'ios' === flashvars.client && '1.5.0' <= flashvars.app_version && load.onSoundLoadExtend.add(handleSoundLoadExtend, this, 0, this.sceneProxy);\r\n\r\n\t\t\tload.onLoadStart.addOnce(function() {\r\n\t\t\t\t//load._fileList.length && this.showProgress(0, 0, 0, !!body);\r\n\t\t\t}, this, 0);\r\n\t\t\tload.onFileComplete.add(function (progress, cacheKey, success, totalLoaded, totalFiles) {\r\n\t\t\t\tif ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n\t\t\t\t\tconst loaded = PhoneUtils.audioCountLoadByPhone.loaded + totalLoaded;\r\n\t\t\t\t\tconst total = PhoneUtils.audioCountLoadByPhone.total + totalFiles;\r\n\t\t\t\t\tconst prgs = parseInt(loaded * 100 / total);\r\n                    loadedFileCount = totalLoaded;\r\n                    //this.showProgress(prgs, loaded, total, !!body);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n                    //this.showProgress(progress, totalLoaded, totalFiles, !!body);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst extName = cacheKey.substring(cacheKey.length - 3);\r\n\t\t\t\tif (extName === 'png' || extName === 'jpg' || extName === 'gif' || extName === 'bmp') return;\r\n\t\t\t\tconst sound = cache.getSound(cacheKey);\r\n\t\t\t\tif (sound && sound.autoDecode && sound.isDecoding  && !sound.decoded) {\r\n\t\t\t\t\tdecodingAudios.push(sound);\r\n\t\t\t\t}\r\n\t\t\t}, this, 0);\r\n\t\t\tload.onLoadComplete.addOnce(function(sceneProxy) {\r\n\t\t\t\tload.onFileComplete.removeAll();\r\n\t\t\t\tcurSceneProxy = sceneProxy;\r\n\t\t\t\tsendNotification();\r\n\t\t\t}, this, 0, this.sceneProxy);\r\n\t\t\tthis.viewComponent.game.load.start();\r\n\t\t},\r\n\r\n\t\tassetsLoader: function () {\r\n\t\t\tlet isLoadComplete = false;\r\n\t\t\tconst decodingAudios = [];\r\n\t\t\tconst { game } = this.viewComponent;\r\n\t\t\tconst { load, sound, cache } = game;\r\n            let loadedFileCount = 0;\r\n            let totalFileCount = load._totalFileCount;\r\n\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tconst sendNotification = () => {\r\n                    if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n                        if (isLoadComplete && PhoneUtils.audioCountLoadByPhone.total === PhoneUtils.audioCountLoadByPhone.loaded) {\r\n                            PhoneUtils.audioCountLoadByPhone.total = 0;\r\n                            PhoneUtils.audioCountLoadByPhone.loaded = 0;\r\n                            sound.onSoundDecode.remove(handleSoundDecode);\r\n                            sound.onSoundDecodeError.remove(handleSoundDecodeError);\r\n                            load.onSoundLoadExtend.removeAll();\r\n                            this.sceneProxy.progressLayer.visible = false;\r\n                            resolve();\r\n                        }\r\n                    }\r\n                    else if (isLoadComplete && decodingAudios.every(sound => sound.decoded)) {\r\n\t\t\t\t\t\tsound.onSoundDecode.remove(handleSoundDecode);\r\n\t\t\t\t\t\tsound.onSoundDecodeError.remove(handleSoundDecodeError);\r\n                        this.sceneProxy.progressLayer.visible = false;\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n                const handleSoundLoadExtend = (key) => {\r\n                    const loaded = PhoneUtils.audioCountLoadByPhone.loaded + loadedFileCount;\r\n                    const total = PhoneUtils.audioCountLoadByPhone.total + totalFileCount;\r\n                    const prgs = parseInt(loaded  * 100 / total);\r\n                    //this.showProgress(prgs, loaded, total, true);\r\n                    loaded === total && loadedFileCount === totalFileCount && sendNotification();\r\n                };\r\n\t\t\t\tconst handleSoundDecode = () => sendNotification();\r\n\t\t\t\tconst handleSoundDecodeError = (key) => {\r\n\t\t\t\t\tlet index = -1;\r\n\t\t\t\t\tconst sound = cache.getSound(key);\r\n\t\t\t\t\tif ((index = decodingAudios.findIndex(s => s === sound)) !== -1) {\r\n\t\t\t\t\t\tdecodingAudios.splice(index, 1);\r\n\t\t\t\t\t\tcache.removeSound(key);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsendNotification();\r\n\t\t\t\t};\r\n\t\t\t\tsound.onSoundDecode.add(handleSoundDecode);\r\n\t\t\t\tsound.onSoundDecodeError.add(handleSoundDecodeError);\r\n                'ios' === flashvars.client && '1.5.0' <= flashvars.app_version && load.onSoundLoadExtend.add(handleSoundLoadExtend, this, 0, this.sceneProxy);\r\n\r\n                load.onLoadStart.addOnce(function() {\r\n                    //load._fileList.length && this.showProgress(0, 0, 0, true);\r\n                }, this, 0);\r\n\r\n\t\t\t\tload.onFileComplete.add(function (progress, cacheKey, success, totalLoaded, totalFiles) {\r\n                    if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n                        const loaded = PhoneUtils.audioCountLoadByPhone.loaded + totalLoaded;\r\n                        const total = PhoneUtils.audioCountLoadByPhone.total + totalFiles;\r\n                        const prgs = parseInt(loaded * 100 / total);\r\n                        loadedFileCount = totalLoaded;\r\n                        //this.showProgress(prgs, loaded, total, true);\r\n                    }\r\n                    else {\r\n                        //this.showProgress(progress, totalLoaded, totalFiles, true);\r\n                    }\r\n\t\t\t\t\tconst extName = cacheKey.substring(cacheKey.length - 3);\r\n\t\t\t\t\tif (extName === 'png' || extName === 'jpg' || extName === 'gif' || extName === 'bmp') return;\r\n\t\t\t\t\tconst sound = cache.getSound(cacheKey);\r\n\t\t\t\t\tif (sound && sound.autoDecode && sound.isDecoding  && !sound.decoded) {\r\n\t\t\t\t\t\tdecodingAudios.push(sound);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this, 0);\r\n\t\t\t\tload.onLoadComplete.addOnce(function(sceneProxy) {\r\n\t\t\t\t\tload.onFileComplete.removeAll();\r\n\t\t\t\t\tisLoadComplete = true;\r\n\t\t\t\t\tsendNotification();\r\n\t\t\t\t}, this, 0, this.sceneProxy);\r\n\t\t\t\tthis.viewComponent.game.load.start();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tshowLogo: function () {\r\n\t\t\tconst {json_data, context} = this.sceneProxy;\r\n\t\t\tconst {logo, chapters, cover} = json_data;\r\n\t\t\tif (!logo || !logo.background || logo.background.hidden || !this.viewComponent.game.load.cache.checkImageKey(logo.background.url)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst {flex, opacity} = logo.background;\r\n\r\n            this.sceneProxy.lstPlotBkKey = logo.background.url;\r\n            this.sceneProxy.lstPlotBkOpacity = logo.background.opacity;\r\n            this.sceneProxy.lstPlotBkFlex = flex;\r\n\t\t\tconst game_logo = this.viewComponent.game.add.image(0, 0, logo.background.url);\r\n\t\t\tthis.backgroundFlex(game_logo, flex);\r\n\t\t\tgame_logo.bringToTop();\r\n\t\t\tgame_logo.alpha = 0;\r\n\t\t\tthis.tweenToPromise(game_logo, {alpha: opacity}, 1000, null, true, 0)\r\n\t\t\t\t.then(() => Utils.timeout(1000))\r\n\t\t\t\t.then(() => this.tweenToPromise(game_logo, {alpha: 0}, 1000, null, true, 0).then(() => {\r\n\t\t\t\t\t\tif (!cover.hidden) {\r\n\t\t\t\t\t\t\tthis.sceneProxy.showCover();// 创建封面\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet chapter = this.sceneProxy.findFirstChapter();\r\n\t\t\t\t\t\t\tconst chapterUuid = chapter.downloadUuid ? chapter.downloadUuid : chapter.uuid;\r\n                            if (chapter.md5 && chapter.plots.length === 0) {\r\n                                if (chapter.charge && ('android' === flashvars.client || 'ios' === flashvars.client)) {\r\n                                    const unlockFinish = (bSuccess) => {\r\n                                        if (bSuccess) {\r\n                                            this.sceneProxy.checkIfChapterFree(chapterUuid, chapter.md5).then((plots)=>{\r\n                                                this.sceneProxy.unlockChapterCallBack = null;\r\n                                                chapter.plots = plots;\r\n                                                this.sceneProxy.preloadChapterAssets(context, chapter);\r\n                                            }, () => Dialog.error('获取付费章节信息失败'))\r\n                                        } else {\r\n                                            Dialog.error('章节解锁失败');\r\n                                        }\r\n                                    };\r\n\r\n                                    this.sceneProxy.unlockChapter(chapterUuid, chapter.charge, chapter.md5, unlockFinish);\r\n\t\t\t\t\t\t\t\t} else {\r\n                                    this.sceneProxy.checkIfChapterFree(chapterUuid, chapter.md5).then((plots)=>{\r\n                                        chapter.plots = plots;\r\n                                        this.sceneProxy.preloadChapterAssets(context, chapter);\r\n                                    }, (msg)=>{\r\n                                        if (-1 === msg.indexOf('code=87')) {\r\n                                            Dialog.error(msg);\r\n                                        } else { // 未购买此章节\r\n                                            Dialog.info('当前为收费章节，请前往闪艺app或电脑端进行购买');\r\n                                        }\r\n                                    })\r\n\t\t\t\t\t\t\t\t}\r\n                            }\r\n                            else {// 播放剧情\r\n                            \tthis.sceneProxy.preloadChapterAssets(context, chapter);\r\n                            }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t},\r\n\r\n\t\tshowProgress: function (progress, totalLoaded, totalFiles, isChapter) {\r\n            const pushcolors = (__text,__info)=>{\r\n                let r = /^-?[\\w\\/]\\d*$/; //  匹配 数字 英文字母 和 /\r\n                __text.colors = [];\r\n                let i = 0;\r\n                while (i < __info.length){\r\n                    r.test(__info[i]) ? __text.colors.push(\"#ffae00\") : __text.colors.push(\"#ffffff\");\r\n                    i++\r\n                }\r\n            }\r\n\r\n\t\t\tlet background = this.sceneProxy.progressLayer.getByName(\"background\");\r\n\t\t\tlet type0 = this.sceneProxy.progressLayer.getByName(\"type0\");\r\n\t\t\tlet type1 = this.sceneProxy.progressLayer.getByName(\"type1\");\r\n\t\t\tconst width = this.viewComponent.game.world.width;\r\n\t\t\tconst height = this.viewComponent.game.world.height;\r\n\r\n\t\t\tif (!background) {\r\n\t\t\t\tbackground = this.viewComponent.game.add.graphics(0, 0, this.sceneProxy.progressLayer);\r\n\t\t\t\tbackground.beginFill(0x0);\r\n\t\t\t\tbackground.drawRect(0, 0, width, height);\r\n\t\t\t\tbackground.endFill();\r\n\t\t\t\tbackground.name = 'background';\r\n\t\t\t\tbackground.inputEnabled = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (isChapter) {\r\n\r\n\t\t\t\t//章节素材加载\r\n\t\t\t\tbackground.alpha = 0.5;\r\n\t\t\t\tif (!type1) {\r\n\t\t\t\t\ttype1 = this.viewComponent.game.add.group();\r\n\t\t\t\t\ttype1.name = 'type1';\r\n\t\t\t\t\tthis.sceneProxy.progressLayer.add(type1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet progressText = type1.getByName('progressText');\r\n\t\t\t\tlet progressText2 = type1.getByName('progressText2');\r\n\t\t\t\tlet progressBar = type1.getByName(\"progressBar\");\r\n\t\t\t\tlet tipText = type1.getByName('tipText');\r\n                let tipLight = type1.getByName('tipLight');\r\n\r\n\t\t\t\tif (!tipText) {\r\n\t\t\t\t\tconst fontSytle = {font: '18px 微软雅黑', fill: '#ffffff', boundsAlignH: \"center\", boundsAlignV: \"middle\" };//16px\r\n                    tipText = this.viewComponent.game.add.text(0, 0, \"\", fontSytle, type1);\r\n                    tipText.name = 'tipText';\r\n\t\t\t\t\ttipText.setTextBounds(25, 510, width-25, 22);\r\n\t\t\t\t}\r\n\t\t\t\tif(progress === 0){\r\n                    let tipInfo = \"小贴士：\" + this.sceneProxy.progressTips[Math.floor(Math.random()* this.sceneProxy.progressTips.length)];\r\n                    if(flashvars.client === 'android' || flashvars.client === 'ios'){\r\n                        tipInfo = Math.random() > 0.7 ? tipInfo : \"小贴士：如果加载停止，请右滑退出重新打开\";\r\n                    }else{\r\n                        tipInfo = Math.random() > 0.7 ? tipInfo : \"小贴士：如果加载停止，请按F5刷新页面\";\r\n                    }\r\n                    pushcolors(tipText,tipInfo);\r\n                    tipText.text = tipInfo;\r\n\t\t\t\t}\r\n                if (!tipLight) {\r\n                    tipLight = this.viewComponent.game.add.image((width - tipText.width - 25) / 2, 508, 'light', 0, type1);\r\n                    tipLight.name = 'tipLight';\r\n                }\r\n                tipLight.x = (width - tipText.width - 25) / 2;\r\n\r\n\t\t\t\tif (!progressBar) {\r\n                    //底色\r\n\t\t\t\t\tprogressBar = this.viewComponent.game.add.group();\r\n\t\t\t\t\tprogressBar.name = \"progressBar\";\r\n\t\t\t\t\ttype1.add(progressBar);\r\n\t\t\t\t\tconst bk = this.viewComponent.game.add.graphics(0, 0, progressBar);\r\n\t\t\t\t\tbk.beginFill(0x0cc8c9);\r\n\t\t\t\t\tbk.drawRoundedRect(0,0,width * 0.75,10,5)\r\n\t\t\t\t\tbk.endFill();\r\n\t\t\t\t\tbk.name = 'progressBar';\r\n\t\t\t\t\tbk.inputEnabled = true;\r\n\t\t\t\t\tbk.x = width / 8;\r\n\t\t\t\t\tbk.y = 490;\r\n\t\t\t\t}\r\n\t\t\t\tlet progressBar_overlay = progressBar.getByName(\"progressBar_overlay\");\r\n\t\t\t\tif (!progressBar_overlay) {\r\n\t\t\t\t\tprogressBar_overlay = this.viewComponent.game.add.graphics(0, 0, progressBar);\r\n                    progressBar_overlay.beginFill(0xffffff);\r\n\t\t\t\t\tprogressBar_overlay.drawRect(0, 0, width * 0.75, 10);\r\n\t\t\t\t\tprogressBar_overlay.endFill();\r\n\t\t\t\t\tprogressBar_overlay.name = 'progressBar_overlay';\r\n\t\t\t\t\tprogressBar_overlay.inputEnabled = true;\r\n\t\t\t\t\tprogressBar_overlay.x = width / 8;\r\n\t\t\t\t\tprogressBar_overlay.y = 490;\r\n\t\t\t\t}\r\n\t\t\t\tif(progress === 0){\r\n                    progressBar_overlay.x = width / 8;\r\n\t\t\t\t}\r\n\t\t\t\tlet progressBar_mask = progressBar.getByName(\"progressBar_mask\");\r\n\t\t\t\tif(!progressBar_mask){\r\n                    progressBar_mask = this.viewComponent.game.add.graphics(0, 0, progressBar);\r\n                    progressBar_mask.beginFill(0x000000);\r\n                    progressBar_mask.drawRoundedRect(0, 0, width * 0.75, 10,5);\r\n                    progressBar_mask.endFill();\r\n                    progressBar_mask.name = 'progressBar_mask';\r\n                    progressBar_mask.inputEnabled = true;\r\n                    progressBar_mask.x = width / 8;\r\n                    progressBar_mask.y = 490;\r\n                    progressBar.mask = progressBar_mask;\r\n\t\t\t\t}\r\n\t\t\t\tlet newx = (progressBar_mask.width) * (progress / 100);\r\n                progressBar_overlay.x  =  (width / 8) + newx;\r\n\r\n\t\t\t\tif (!progressText) {\r\n\t\t\t\t\tconst fontSytle = {font: '18px 微软雅黑', fill: '#ffffff', boundsAlignH: \"center\", boundsAlignV: \"middle\" };//16px\r\n\t\t\t\t\tprogressText = this.viewComponent.game.add.text(0, 0, '', fontSytle, type1);\r\n\t\t\t\t\tprogressText.name = 'progressText';\r\n\t\t\t\t\tprogressText.setTextBounds(0, 465, width, 22);\r\n\t\t\t\t}\r\n\t\t\t\tif (!progressText2) {\r\n\t\t\t\t\tconst fontSytle = {font: '24px 微软雅黑', fill: '#ffffff', boundsAlignH: \"center\", boundsAlignV: \"middle\" };\r\n\t\t\t\t\tprogressText2 = this.viewComponent.game.add.text(0, 0, '', fontSytle, type1);\r\n\t\t\t\t\tprogressText2.name = 'progressText2';\r\n\t\t\t\t\tprogressText2.setTextBounds(width * 0.89, 482, 50, 30);\r\n\t\t\t\t}\r\n\t\t\t\tprogressText2.text = progress + '%';\r\n\t\t\t\tlet progtexts = '正在加载' + totalLoaded + '/' + totalFiles + \"个资源\";\r\n\t\t\t\tpushcolors(progressText,progtexts);\r\n                progressText.text =  progtexts;\r\n\r\n\t\t\t\ttype0 && (type0.visible = false);\r\n\t\t\t\ttype1 && (type1.visible = true);\r\n\t\t\t\tthis.sceneProxy.progressLayer.bringToTop(type1);\r\n\t\t\t} else {\r\n\t\t\t    return;//  无需开头加载\r\n\t\t\t\t//开头加载\r\n\t\t\t\tbackground.alpha = 0;\r\n\t\t\t\tif (!type0) {\r\n\t\t\t\t\ttype0 = this.viewComponent.game.add.group();\r\n\t\t\t\t\ttype0.name = 'type0';\r\n\t\t\t\t\tthis.sceneProxy.progressLayer.add(type0);\r\n\t\t\t\t}\r\n\t\t\t\tlet progressText = type0.getByName('progressText');\r\n\t\t\t\tlet tipText = type0.getByName('tipText');\r\n\t\t\t\tlet progressBar = type0.getByName(\"progressBar\");\r\n\t\t\t\tlet tipLight = type0.getByName('tipLight');\r\n\r\n\t\t\t\tif (!progressText) {\r\n\t\t\t\t\tconst fontSytle = {font: '18px 微软雅黑', fill: '#ffffff', boundsAlignH: \"center\", boundsAlignV: \"middle\" };\r\n\t\t\t\t\tprogressText = this.viewComponent.game.add.text(0, 0, '', fontSytle, type0);\r\n\t\t\t\t\tprogressText.name = 'progressText';\r\n                    progressText.setTextBounds(28, 390, width-25, 18);\r\n\t\t\t\t}\r\n                progressText.text === '' && (progressText.text = '小贴士: ' + this.sceneProxy.progressTips[Math.floor(Math.random()*this.sceneProxy.progressTips.length)]);\r\n\r\n\t\t\t\tif (!tipLight) {\r\n\t\t\t\t\ttipLight = this.viewComponent.game.add.image((width - progressText.width - 28) / 2,385 , 'light', 0, type0);\r\n\t\t\t\t\ttipLight.name = 'tipLight';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!tipText) {\r\n\t\t\t\t\ttipText = this.viewComponent.game.add.text(0, 0, '', {font: '28px 微软雅黑', fill: '#ffffff', boundsAlignH: \"center\", boundsAlignV: \"middle\"}, type0);\r\n\t\t\t\t\ttipText.name = 'tipText';\r\n\t\t\t\t}\r\n\t\t\t\ttipText.visible = progress > 0 ? true : false;\r\n\t\t\t\ttipText.setTextBounds(width / 2,350,40,22);\r\n\t\t\t\ttipText.text = progress + '%';\r\n\t\t\t\ttype0 && (type0.visible = true);\r\n\t\t\t\ttype1 && (type1.visible = false);\r\n\t\t\t\tthis.sceneProxy.progressLayer.bringToTop(type0);\r\n\t\t\t}\r\n\t\t\tthis.sceneProxy.progressLayer.visible = true;\r\n\t\t\tthis.viewComponent.game.world.bringToTop(this.sceneProxy.progressLayer);\r\n            this.sceneProxy.quickPlayLayer.alpha && this.viewComponent.game.world.bringToTop(this.sceneProxy.quickPlayLayer);\r\n\t\t},\r\n\r\n\t\taddDialogLayer: function () {\r\n\t\t\tconst {background, rect, avatarContainer, titleContainer, content} = this.sceneProxy.json_data.template.json.dialog;\r\n\r\n\t\t\tif (this.sceneProxy.dialogLayer.children.length === 0) {\r\n\t\t\t\t//this.sceneProxy.dialogLayer.inputEnableChildren = true;\r\n\r\n\t\t\t\tlet x, y, texture;\r\n\r\n\t\t\t\t// 对话框背景\r\n\t\t\t\tif (this.viewComponent.game.load.cache.checkImageKey(background.url)) {\r\n\t\t\t\t\tconst dialog_bk = this.sceneProxy.dialogLayer.create(0, 0, background.url);\r\n\t\t\t\t\tdialog_bk.width = rect.width;\r\n\t\t\t\t\tdialog_bk.height = rect.height;\r\n\t\t\t\t\tdialog_bk.name = 'dialog_bk';\r\n\t\t\t\t}\r\n\t\t\t\t// 标题背景\r\n\t\t\t\tx = titleContainer.rect.x;\r\n\t\t\t\ty = titleContainer.rect.y;\r\n\t\t\t\tif (this.viewComponent.game.load.cache.checkImageKey(titleContainer.background.url)) {\r\n\t\t\t\t\tconst dialog_bk_title = this.sceneProxy.dialogLayer.create(x, y, titleContainer.background.url);\r\n\t\t\t\t\tdialog_bk_title.width = titleContainer.rect.width;\r\n\t\t\t\t\tdialog_bk_title.height = titleContainer.rect.height;\r\n\t\t\t\t\tdialog_bk_title.name = 'dialog_bk_title';\r\n\t\t\t\t}\r\n\t\t\t\t// 标题文本\r\n\t\t\t\tlet txt;\r\n\t\t\t\tx = titleContainer.rect.x + titleContainer.title.rect.x;\r\n\t\t\t\ty = titleContainer.rect.y + titleContainer.title.rect.y;\r\n                txt = this.viewComponent.game.add.text(0, 0, '', {fill:'#fff'}, this.sceneProxy.dialogLayer);\r\n                txt.name = 'dialog_text_title';\r\n                txt.setTextBounds(x + (titleContainer.title.rect.width - titleContainer.rect.width) / 2, y, titleContainer.rect.width, titleContainer.rect.height);\r\n\t\t\t\t// 头像背景\r\n\t\t\t\tif (this.viewComponent.game.load.cache.checkImageKey(avatarContainer.background.url)) {\r\n\t\t\t\t\tx = avatarContainer.rect.x;\r\n\t\t\t\t\ty = avatarContainer.rect.y;\r\n\t\t\t\t\ttexture = this.sceneProxy.dialogLayer.create(x, y, avatarContainer.background.url);\r\n\t\t\t\t\ttexture.width = avatarContainer.rect.width;\r\n\t\t\t\t\ttexture.height = avatarContainer.rect.height;\r\n\t\t\t\t\ttexture.name = 'dialog_bk_avatar';\r\n\t\t\t\t}\r\n\t\t\t\t// 头像\r\n\t\t\t\tx = avatarContainer.rect.x + avatarContainer.avatar.x;\r\n\t\t\t\ty = avatarContainer.rect.y + avatarContainer.avatar.y;\r\n\t\t\t\tconst avatar = this.sceneProxy.dialogLayer.create(x, y);\r\n\t\t\t\tavatar.name = 'dialog_avatar';\r\n\t\t\t\tavatar.width = avatarContainer.avatar.width;\r\n\t\t\t\tavatar.height = avatarContainer.avatar.height;\r\n\t\t\t\t// 对话文本\r\n\t\t\t\ttxt = this.viewComponent.game.add.text(content.rect.x\r\n\t\t\t\t\t, content.rect.y\r\n\t\t\t\t\t, ''\r\n\t\t\t\t\t, {fill:'#fff', boundsAlignH: \"left\", boundsAlignV: \"top\", wordWrap: true, wordWrapWidth: content.rect.width}\r\n\t\t\t\t\t, this.sceneProxy.dialogLayer);\r\n\t\t\t\ttxt.name = 'dialog_text_content';\r\n\t\t\t\ttxt.useAdvancedWrap = true;\r\n\t\t\t\ttxt.updateText = RePhaser.updateText;\r\n\t\t\t\ttxt.advancedWordWrap = RePhaser.advancedWordWrap;\r\n\t\t\t}\r\n\r\n\t\t\tthis.sceneProxy.dialogLayer.x = rect.x;\r\n\t\t\tthis.sceneProxy.dialogLayer.y = rect.y;\r\n\t\t\tthis.sceneProxy.dialogLayer.alpha = 1;\r\n\t\t\tthis.sceneProxy.dialogLayer.visible = true;\r\n\t\t\tthis.viewComponent.game.world.bringToTop(this.sceneProxy.dialogLayer);\r\n\t\t\tthis.viewComponent.game.world.bringToTop(this.sceneProxy.menuLayer);\r\n            this.sceneProxy.quickPlayLayer.alpha && this.viewComponent.game.world.bringToTop(this.sceneProxy.quickPlayLayer);\r\n\t\t},\r\n\r\n\t\taddMenuLayer: function (bSetFixed) {\r\n\t\t\tif (this.sceneProxy.menuLayer.children.length === 0) {\r\n                const {rect, normal, active} = this.sceneProxy.json_data.template.json.menu;\r\n                const menuBtnClick = (obj, pointer) => {\r\n\t\t\t\t\tif (pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (obj.parent.name === 'menu_button') {\r\n                        this.sceneProxy.onMenuBtnClicked();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.sceneProxy.onSyMenuBtnClicked();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconst t = {};\r\n\t\t\t\tt.normal = normal.text;\r\n\t\t\t\tt.active = active.text;\r\n\t\t\t\tt.text = '菜单';\r\n\t\t\t\tthis.viewComponent.addButton(866, 26, rect.width, rect.height, normal.background.url, active.background.url\r\n\t\t\t\t\t, menuBtnClick, t, this.sceneProxy.btn_sound, \"menu_button\", this.sceneProxy.menuLayer);\r\n\r\n                this.viewComponent.addButton(874, 100, 56, 56, 'menuMore', 'menuMoreHover'\r\n                    , menuBtnClick, t, this.sceneProxy.btn_sound, \"menu_button_more\", this.sceneProxy.menuLayer);\r\n\r\n\t\t\t\t/*if (this.sceneProxy.json_data.template.json.shanyiMenu) {\r\n                    const {rect:rectSy, normal:normalSy, active:activeSy} = this.sceneProxy.json_data.template.json.shanyiMenu;\r\n                    t.normal = normalSy.text;\r\n                    t.active = activeSy.text;\r\n                    t.text = '闪艺';\r\n                    this.viewComponent.addButton(rectSy.x, rectSy.y, rectSy.width, rectSy.height, normalSy.background.url, activeSy.background.url\r\n                        , menuBtnClick, t, this.sceneProxy.btn_sound, \"shanyi_menu_button\", this.sceneProxy.menuLayer);\r\n                }*/\r\n\t\t\t}\r\n\t\t\tthis.viewComponent.game.world.bringToTop(this.sceneProxy.menuLayer);\r\n\t\t\tthis.sceneProxy.menuLayer.visible = true;\r\n\t\t},\r\n\r\n        doEffectsAnimation: function (group) {\r\n            const doAnimation = (index) => {\r\n                Utils.timeout(40).then(() => {\r\n                \tif (group.children.length === 0) {\r\n                \t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!group.visible) {\r\n                \t\tdoAnimation(index);\r\n                \t\treturn;\r\n\t\t\t\t\t}\r\n                    if (0 === index) {\r\n                        group.children[group.children.length-1].visible = false;\r\n                    }\r\n                    else {\r\n                        group.children[index-1].visible = false;\r\n                    }\r\n                    group.children[index].visible = true;\r\n                    doAnimation(++index % group.children.length);\r\n                });\r\n            };\r\n\r\n            doAnimation(0);\r\n        },\r\n\r\n\t\taddRainEffect: function () {\r\n\t\t\tlet rain = this.sceneProxy.weatherLayer.getByName('rain');\r\n\t\t\tif (!rain) {\r\n\t\t\t\train = this.viewComponent.game.add.group();\r\n\t\t\t\train.name = 'rain';\r\n\t\t\t\tthis.sceneProxy.weatherLayer.add(rain);\r\n\t\t\t\tconst rain1 = [];\r\n\t\t\t\tfor (let i=0; i<50; i++) {\r\n\t\t\t\t\train1[i] = this.viewComponent.game.add.sprite(0, 0, '/weather/rain/xiayu_' + Utils.formatNum(i) + '.png');\r\n                    rain.add(rain1[i]);\r\n                    rain1[i].visible = false;\r\n                }\r\n                this.doEffectsAnimation(rain);\r\n\t\t\t}\r\n\t\t\tthis.sceneProxy.weatherLayer.visible = true;\r\n\t\t\train.visible = true;\r\n\t\t\tthis.sceneProxy.weatherLayer.bringToTop(rain);\r\n\t\t},\r\n\r\n\t\taddSnowEffect: function () {\r\n\t\t\tlet snow = this.sceneProxy.weatherLayer.getByName('snow');\r\n\t\t\tif (!snow) {\r\n\t\t\t\tsnow = this.viewComponent.game.add.group();\r\n\t\t\t\tsnow.name = 'snow';\r\n\t\t\t\tthis.sceneProxy.weatherLayer.add(snow);\r\n\t\t\t\tconst snow1 = [];\r\n\t\t\t\tfor (let i=0; i<120; i++) {\r\n\t\t\t\t\tsnow1[i] = this.viewComponent.game.add.sprite(0, 0, '/weather/snow/xuehua_' + Utils.formatNum(i) + '.png');\r\n\t\t\t\t\tsnow.add(snow1[i]);\r\n\t\t\t\t\tsnow1[i].visible = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis.doEffectsAnimation(snow);\r\n\t\t\t}\r\n\t\t\tthis.sceneProxy.weatherLayer.visible = true;\r\n\t\t\tsnow.visible = true;\r\n\t\t\tthis.sceneProxy.weatherLayer.bringToTop(snow);\r\n\t\t},\r\n\r\n\t\taddWindEffect: function () {\r\n\t\t\tlet wind = this.sceneProxy.weatherLayer.getByName('wind');\r\n\t\t\tif (!wind) {\r\n\t\t\t\twind = this.viewComponent.game.add.group();\r\n\t\t\t\twind.name = 'wind';\r\n\t\t\t\tthis.sceneProxy.weatherLayer.add(wind);\r\n                this.viewComponent.game.add.tileSprite(0, 0, 960, 540, 'wind', 1, wind).autoScroll(-360, 0);\r\n\t\t\t}\r\n\t\t\tthis.sceneProxy.weatherLayer.visible = true;\r\n\t\t\twind.visible = true;\r\n\t\t\tthis.sceneProxy.weatherLayer.bringToTop(wind);\r\n\t\t},\r\n\r\n        addFallingLeavesEffect: function () {\r\n            let fLeaves = this.sceneProxy.weatherLayer.getByName('fallingLeaves');\r\n            if (!fLeaves) {\r\n                fLeaves = this.viewComponent.game.add.group();\r\n                fLeaves.name = 'fallingLeaves';\r\n                this.sceneProxy.weatherLayer.add(fLeaves);\r\n                const fLeaves1 = [];\r\n                for (let i=0; i<90; i++) {\r\n                    fLeaves1[i] = this.viewComponent.game.add.sprite(0, 0, '/weather/mapleLeaves/fengye_' + Utils.formatNum(i) + '.png');\r\n                    fLeaves.add(fLeaves1[i]);\r\n                    fLeaves1[i].visible = false;\r\n                }\r\n                this.doEffectsAnimation(fLeaves);\r\n            }\r\n            this.sceneProxy.weatherLayer.visible = true;\r\n            fLeaves.visible = true;\r\n            this.sceneProxy.weatherLayer.bringToTop(fLeaves);\r\n        },\r\n\r\n        addBeachBlossomEffect: function () {\r\n            let beachBlossom = this.sceneProxy.weatherLayer.getByName('beachBlossom');\r\n            if (!beachBlossom) {\r\n                beachBlossom = this.viewComponent.game.add.group();\r\n                beachBlossom.name = 'beachBlossom';\r\n                this.sceneProxy.weatherLayer.add(beachBlossom);\r\n                const beachBlossom1 = [];\r\n                for (let i=0; i<90; i++) {\r\n                    beachBlossom1[i] = this.viewComponent.game.add.sprite(0, 0, '/weather/beachBlossom/taohua_' + Utils.formatNum(i) + '.png');\r\n                    beachBlossom.add(beachBlossom1[i]);\r\n                    beachBlossom1[i].visible = false;\r\n\t\t\t\t}\r\n                this.doEffectsAnimation(beachBlossom);\r\n            }\r\n            this.sceneProxy.weatherLayer.visible = true;\r\n            beachBlossom.visible = true;\r\n            this.sceneProxy.weatherLayer.bringToTop(beachBlossom);\r\n        },\r\n\r\n        addBlossomEffect: function () {\r\n            let blossom = this.sceneProxy.weatherLayer.getByName('blossom');\r\n            if (!blossom) {\r\n                blossom = this.viewComponent.game.add.group();\r\n                blossom.name = 'blossom';\r\n                this.sceneProxy.weatherLayer.add(blossom);\r\n                const blossom1 = [];\r\n                for (let i=0; i<90; i++) {\r\n                    blossom1[i] = this.viewComponent.game.add.sprite(0, 0, '/weather/blossom/yinghua_' + Utils.formatNum(i) + '.png');\r\n                    blossom.add(blossom1[i]);\r\n                    blossom1[i].visible = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis.doEffectsAnimation(blossom);\r\n            }\r\n            this.sceneProxy.weatherLayer.visible = true;\r\n            blossom.visible = true;\r\n            this.sceneProxy.weatherLayer.bringToTop(blossom);\r\n        },\r\n\r\n        addLightningEffect: function () {\r\n            let lightning = this.sceneProxy.weatherLayer.getByName('lightning');\r\n            if (!lightning) {\r\n                lightning = this.viewComponent.game.add.group();\r\n                lightning.name = 'lightning';\r\n                this.sceneProxy.weatherLayer.add(lightning);\r\n                const lightning1 = [];\r\n                for (let i=0; i<50; i++) {\r\n                    lightning1[i] = this.viewComponent.game.add.sprite(0, 0, '/weather/lightning/shandian_' + Utils.formatNum(i) + '.png');\r\n                    lightning.add(lightning1[i]);\r\n                    lightning1[i].visible = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis.doEffectsAnimation(lightning);\r\n            }\r\n            this.sceneProxy.weatherLayer.visible = true;\r\n            lightning.visible = true;\r\n            this.sceneProxy.weatherLayer.bringToTop(lightning);\r\n        },\r\n\r\n\t\tregisterViewKey: function (refUuid, parentEvents, arrKeys) {\r\n\t\t\tconst {viewMap} = this.sceneProxy.json_data;\r\n\t\t\tconst reg = events => {\r\n                for (let e in events) {\r\n                    if (events[e].type === 'onKeyUp') {\r\n                        this.viewComponent.game.input.keyboard.removeKey(events[e].keyCode);\r\n                        arrKeys[events[e].keyCode] = this.viewComponent.game.input.keyboard.addKey(events[e].keyCode);\r\n                    }\r\n                }\r\n\t\t\t};\r\n\t\t\tconst doReg = (uuid) => {\r\n\t\t\t\treg(viewMap[uuid].events);\r\n\r\n                for (let i in viewMap[uuid].children) {\r\n                    doReg(viewMap[uuid].children[i].ref);\r\n                    reg(viewMap[uuid].children[i].events);\r\n                }\r\n            };\r\n\r\n\t\t\tdoReg(refUuid);\r\n\t\t\treg(parentEvents);\r\n\t\t},\r\n\r\n\t\tremoveViewKey: function (arrKeys) {\r\n\t\t\tfor (let k in arrKeys) {\r\n\t\t\t\tthis.viewComponent.game.input.keyboard.removeKey(k);\r\n\t\t\t\tarrKeys.splice(k, 1);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tremoveViewKeyByInstance: function (view, arrKeys) {\r\n            const {viewMap} = this.sceneProxy.json_data;\r\n            const unReg = events => {\r\n                for (let e in events) {\r\n                    if (events[e].type === 'onKeyUp') {\r\n                        this.viewComponent.game.input.keyboard.removeKey(events[e].keyCode);\r\n                        arrKeys.splice(events[e].keyCode,1);\r\n                    }\r\n                }\r\n            };\r\n            const doUnReg = (v) => {\r\n                v.name && viewMap[v.name] && unReg(viewMap[v.name].events);\r\n\r\n                for (let i in v.children) {\r\n                    doUnReg(v.children[i]);\r\n                }\r\n            };\r\n\r\n            doUnReg(view);\r\n        },\r\n\r\n\t\taddGlobalView: function (refUuidToHide) {\r\n\t\t\tif (!this.sceneProxy.globalViews) {\r\n\t\t\t\tthis.sceneProxy.globalViews = [];\r\n\t\t\t\tthis.sceneProxy.globalViewKeys = [];\r\n\t\t\t\tconst views = this.sceneProxy.json_data.views;\r\n\t\t\t\tfor (let p in views) {\r\n\t\t\t\t\tthis.registerViewKey(views[p].ref, views[p].events, this.sceneProxy.globalViewKeys);\r\n\t\t\t\t\tthis.sceneProxy.globalViews[p] = this.addView(null, views[p].ref, views[p].instanceUuid, views[p].x, views[p].y, views[p].events);\r\n                    this.sceneProxy.globalViews[p].isGlobal = true;\r\n\t\t\t\t\tif (views[p].scale) {\r\n\t\t\t\t\t\tthis.sceneProxy.globalViews[p].scale.set(views[p].scale, views[p].scale);\r\n\t\t\t\t\t\tthis.sceneProxy.globalViews[p].x += views[p].x.value * (1 - views[p].scale);\r\n\t\t\t\t\t\tthis.sceneProxy.globalViews[p].y += views[p].y.value * (1 - views[p].scale);\r\n\t\t\t\t\t\tthis.scaleInputView(this.sceneProxy.globalViews[p], views[p].scale);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n                this.uiOnLoadInvoker();\r\n\t\t\t}\r\n\t\t\tfor (let p in this.sceneProxy.globalViews) {\r\n\t\t\t\tif (refUuidToHide[this.sceneProxy.globalViews[p].name]) {\r\n\t\t\t\t\tthis.sceneProxy.globalViews[p].visible = false;\r\n                    this.showInputView(this.sceneProxy.globalViews[p], false);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.sceneProxy.globalViews[p].visible = true;\r\n                    this.showInputView(this.sceneProxy.globalViews[p], true);\r\n\t\t\t\t\tthis.viewComponent.game.world.bringToTop(this.sceneProxy.globalViews[p]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddView: function (parentLayer, refUuid, instanceUuid, xInfo, yInfo, eventsInfo, isRefresh) {\r\n\t\t\tif (!refUuid) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tlet result = true;\r\n\t\t\tconst containerLayer = this.viewComponent.game.add.group();\r\n\t\t\tconst viewInfo = this.sceneProxy.json_data.viewMap[refUuid];\r\n\t\t\tif (!viewInfo) {\r\n\t\t\t\tcontainerLayer.destroy();\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tcontainerLayer.name = refUuid;\r\n\t\t\tcontainerLayer.instanceUuid = instanceUuid;\r\n\t\t\tcontainerLayer.xInfo = xInfo;\r\n\t\t\tcontainerLayer.yInfo = yInfo;\r\n\t\t\tcontainerLayer.eventsInfo = eventsInfo;\r\n\t\t\tcontainerLayer.inputEnableChildren = true;\r\n\t\t\tparentLayer && parentLayer.add(containerLayer);\r\n\r\n\t\t\tconst {Expression, context, curChapter, uiOnLoadQueue} = this.sceneProxy;\r\n\t\t\tconst pointX = Expression.safeEval(xInfo, context);\r\n            const pointY = Expression.safeEval(yInfo, context);\r\n\r\n\t\t\tconst eventHandler = (obj, events, type, nextAction) => {\r\n\t\t\t\tlet i=0;\r\n\t\t\t\tfor (i=0; i<events.length; i++) {\r\n\t\t\t\t\tif (events[i].type === 'jump') {\r\n\t\t\t\t\t    if (!this.sceneProxy.isGettingNext) { // 正在获取下一剧情信息时不响应该事件，以免修改context无法正常下一剧情\r\n                            this.sceneProxy.uiOnLoadQueue = [];\r\n                            this.sceneProxy.mainMenuLayer.visible && this.sceneProxy.onMainMenuBackBtnClicked();\t// 主菜单可见 说明是自制菜单的jump事件\r\n                            this.sceneProxy.context = JSON.parse(JSON.stringify(context));\r\n                            this.showNextPlot(this.sceneProxy.context, curChapter, this.sceneProxy.curPlotIndex, events[i].type, events[i].handle.uuid);\r\n                        }\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'playMusic') {\r\n\t\t\t\t\t\tif (this.viewComponent.game.load.cache.checkSoundKey(events[i].handle.music.url)\r\n                            || ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version)) {\r\n\t\t\t\t\t\t\tthis.sceneProxy.stopMusic(events[i].handle.music.url, true);\r\n\t\t\t\t\t\t\tthis.sceneProxy.playMusic(events[i].handle.music.url, events[i].handle.music.volume, true, true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'stopMusic') {\r\n\t\t\t\t\t\tthis.sceneProxy.stopMusic(null, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'playSound') {\r\n\t\t\t\t\t\tfor (let s=0; s<events[i].handle.sounds.length; s++) {\r\n\t\t\t\t\t\t\tlet url = events[i].handle.sounds[s] ? events[i].handle.sounds[s].url : '';\r\n\t\t\t\t\t\t\tif (url === 'inherit') {\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (this.viewComponent.game.load.cache.checkSoundKey(url)) {\r\n\t\t\t\t\t\t\t\tlet volume = events[i].handle.sounds[s].volume === 'inherit' ? this.sceneProxy.plotSounds[s].volume : events[i].handle.sounds[s].volume;\r\n\t\t\t\t\t\t\t\tthis.sceneProxy.stopSound(s, url, true);\r\n\t\t\t\t\t\t\t\tthis.sceneProxy.playSound(s, url, volume, !events[i].handle.sounds[s].time, true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if ('ios' === flashvars.client && flashvars.app_version >= '1.5.0') {\r\n                                let volume = events[i].handle.sounds[s].volume === 'inherit' ? PhoneUtils.soundsInfo[s].volume : events[i].handle.sounds[s].volume;\r\n                                this.sceneProxy.stopSound(s, url, true);\r\n                                this.sceneProxy.playSound(s, url, volume, !events[i].handle.sounds[s].time, true);\r\n                            }\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthis.sceneProxy.stopSound(s);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'stopSound') {\r\n\t\t\t\t\t\tthis.sceneProxy.plotSounds.forEach((s, i) => this.sceneProxy.stopSound(i, null, true));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'callUI') {\r\n\t\t\t\t\t\tif (events[i].handle.id === 'save-record' && events[i].handle.type === 'system') {\r\n                            const disableSaveOrLoad = this.sceneProxy.context.disableSaveOrLoad;\r\n                            if (disableSaveOrLoad && disableSaveOrLoad.save) {\r\n                                this.sceneProxy.showToast(1, '抱歉，作者在此设置了禁用存档');\r\n                                return false;\r\n                            }\r\n                            !this.sceneProxy.mainMenuLayer.visible && this.sceneProxy.getSnap();\r\n                            this.sceneProxy.showSave();\r\n                            return false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (events[i].handle.id === 'load-record' && events[i].handle.type === 'system') {\r\n                            const disableSaveOrLoad = this.sceneProxy.context.disableSaveOrLoad;\r\n                            if (disableSaveOrLoad && disableSaveOrLoad.load) {\r\n                                this.sceneProxy.showToast(1, '抱歉，作者在此设置了禁用读档');\r\n                                return false;\r\n                            }\r\n\t\t\t\t\t\t\tthis.sceneProxy.showLoad();\r\n                            return false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (events[i].handle.id === 'playback' && events[i].handle.type === 'system') {\r\n\t\t\t\t\t\t\tthis.sceneProxy.showPlayback();\r\n                            return false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (events[i].handle.id === 'settings' && events[i].handle.type === 'system') {\r\n\t\t\t\t\t\t\tthis.sceneProxy.showSettings(this.sceneProxy.context);\r\n                            return false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (events[i].handle.uuid){\r\n\t\t\t\t\t\t\tconst xInfo = Object.assign({}, events[i].handle.position.x);\r\n                            const yInfo = Object.assign({}, events[i].handle.position.y);\r\n                            const nCount = events[i].handle.count ? Expression.safeEval(events[i].handle.count, this.sceneProxy.context) : 1;\r\n                            for (let n=0; n<nCount; n++) {\r\n                                this.registerViewKey(events[i].handle.uuid, [], this.sceneProxy.plotViewKeys);\r\n                                const view = this.addView(parentLayer, events[i].handle.uuid, '', xInfo, yInfo);\r\n                                if (!view) {\r\n                                    continue;\r\n                                }\r\n\r\n                                if (!parentLayer) {\r\n                                \tview.isGlobal = true;\r\n                                    this.sceneProxy.globalViews.push(view);\r\n                                }\r\n                                else if (parentLayer.name === 'plotViewsLayer') {\r\n                                    this.sceneProxy.plotViews.push(view);\r\n\t\t\t\t\t\t\t\t}\r\n                                else if (parentLayer.xInfo && parentLayer.yInfo) {\r\n                                    view.x += Expression.safeEval(parentLayer.xInfo, this.sceneProxy.context);\r\n                                    view.y += Expression.safeEval(parentLayer.yInfo, this.sceneProxy.context);\r\n                                }\r\n\r\n                                if ((!parentLayer || !parentLayer.parent || parentLayer.parent.name !== 'mainMenuLayer') && !this.sceneProxy.mainMenuLayer.visible) {\r\n                                    this.viewComponent.game.world.bringToTop(this.sceneProxy.menuLayer);\r\n                                }\r\n\r\n                                // 非onLoad事件触发的 则执行onLoad\r\n                                'onLoad' !== type && this.uiOnLoadInvoker();\r\n\t\t\t\t\t\t\t}\r\n                        }\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'refreshUI') {\r\n                        let refreshViews = this.refreshView(events[i].handle.uuid);\r\n                        if (parentLayer && events[i].handle.uuid === parentLayer.name) {\r\n                            for (let n=0; n<refreshViews.length; n++) {\r\n                                if (refreshViews[n].name === parentLayer.name) {\r\n                                    parentLayer = refreshViews[n];\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n\t\t\t\t\t}\r\n                    else if (events[i].type === 'reload') {\r\n                        let refreshViews = this.refreshView(events[i].handle.uuid, true);\r\n                        if (events[i].handle.uuid === parentLayer.name) {\r\n                            for (let n=0; n<refreshViews.length; n++) {\r\n                            \tif (refreshViews[n].name === parentLayer.name) {\r\n                            \t\tparentLayer = refreshViews[n];\r\n                            \t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 重载组件需要重新调用onLoad事件\r\n                        this.uiOnLoadInvoker();\r\n                    }\r\n\t\t\t\t\telse if (events[i].type === 'closeUI') {\r\n                        let uuidToClose = events[i].handle.uuid;\r\n                        let objParent = obj;\r\n                        let bCloseMainMenu = false;\r\n                        const getCloseUuid = (bSingleToClose) => {\r\n                            objParent = objParent && objParent.parent;\r\n                            while (1) {\r\n                                if (!objParent) {\r\n                                    break;\r\n                                } else if (objParent.viewType) {\r\n                                    if (bSingleToClose) {\r\n                                        objParent.name += '_1';\r\n                                    }\r\n                                    return objParent.name;\r\n                                }\r\n                                objParent = objParent.parent;\r\n                            }\r\n                        };\r\n                        if (events[i].handle.type === 'system' && events[i].handle.id === 'diyMainMenu') {\r\n                            let diyMainMenu = this.sceneProxy.mainMenuLayer.children[1];\r\n                            if (diyMainMenu) {\r\n                                uuidToClose = diyMainMenu.name;\r\n                                bCloseMainMenu = true;\r\n                            }\r\n                            else {\r\n                                uuidToClose = null;\r\n                                this.sceneProxy.onMainMenuBackBtnClicked();\r\n                                this.sceneProxy.mainMenuLayer.removeAll(true, false, true);\r\n                            }\r\n                        } else {\r\n                            if (!uuidToClose) {\r\n                                if (obj.viewType) {\r\n                                    uuidToClose = obj.name;\r\n                                } else {\r\n                                    uuidToClose = getCloseUuid(objParent, true);\r\n                                    events[i].isParent && (uuidToClose = getCloseUuid(objParent, true));\r\n                                }\r\n                            }\r\n                        }\r\n                        if (uuidToClose) {\r\n                            // 关闭组件后 对应的onLoad事件不再执行\r\n                            let realUuid = uuidToClose.substring(0, 36);\r\n                            for (let n=0; n<uiOnLoadQueue.length; n++) {\r\n                                if (uiOnLoadQueue[n].name === realUuid || uiOnLoadQueue[n].instanceUuid === realUuid) {\r\n                                    uiOnLoadQueue.splice(n--, 1);\r\n                                }\r\n                            }\r\n                            // closeUI\r\n                            this.destroyView(uuidToClose, bCloseMainMenu);\r\n                        }\r\n                        if (events[i].handle.type === 'system') {\r\n                            return;\r\n                        }\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'back') {\t// 返回封面\r\n                        this.sceneProxy.uiOnLoadQueue = [];\r\n                        this.sceneProxy.mainMenuLayer.visible && this.sceneProxy.onResume();\r\n                        this.sceneProxy.context = JSON.parse(JSON.stringify(context));\r\n\t\t\t\t\t\tthis.showNextPlot(this.sceneProxy.context, curChapter, this.sceneProxy.curPlotIndex, events[i].type);\r\n                        return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'nextPlot') { // 下个剧情\r\n                        this.sceneProxy.uiOnLoadQueue = [];\r\n\t\t\t\t\t\tif (curChapter.plots[this.sceneProxy.curPlotIndex].commands) {\r\n                            this.sceneProxy.optionLayer.destroy();\r\n                            this.sceneProxy.cmdPlotNextPromise && this.sceneProxy.cmdPlotNextPromise({type: ''});\r\n                            return false;\r\n                        }\r\n\t\t\t\t\t\tthis.sceneProxy.context = JSON.parse(JSON.stringify(context));\r\n                        if (curChapter.plots[this.sceneProxy.curPlotIndex].condition_options.length > 0) {\r\n                            this.showNextPlot(this.sceneProxy.context, curChapter, this.sceneProxy.curPlotIndex);\r\n                            return false;\r\n                        }\r\n\t\t\t\t\t\tthis.showNextPlot(this.sceneProxy.context, curChapter, this.sceneProxy.curPlotIndex, events[i].type);\r\n                        return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'jumpOption') { // 跳出分支\r\n                        this.sceneProxy.uiOnLoadQueue = [];\r\n                        const n = Expression.safeEval(events[i].handle.value, context);\r\n                        if (curChapter.plots[this.sceneProxy.curPlotIndex].commands) {\r\n                            const {info, index} = this.sceneProxy.getNextCommand(context, this.sceneProxy.curCmdInfo, -1, {eArg: n, type: 'jumpOption'});\r\n                            if (index !== -1) {\r\n                                this.sceneProxy.cmdPlayHandlerFun(info, index);\r\n                            }\r\n                            return false;\r\n                        }\r\n\r\n                        this.showNextPlot(this.sceneProxy.context, curChapter, this.sceneProxy.curPlotIndex, events[i].type, n);\r\n                        return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'backOption') {\r\n                        this.sceneProxy.uiOnLoadQueue = [];\r\n                        const n = Expression.safeEval(events[i].handle.value, context);\r\n                        if (curChapter.plots[this.sceneProxy.curPlotIndex].commands) {\r\n                            const {info, index} = this.sceneProxy.getNextCommand(context, this.sceneProxy.curCmdInfo, -1, {eArg: n, type: 'backOption'});\r\n                            if (index !== -1) {\r\n                                this.sceneProxy.cmdPlayHandlerFun(info, index);\r\n                            }\r\n                            return false;\r\n                        }\r\n\r\n                        this.showNextPlot(this.sceneProxy.context, curChapter, this.sceneProxy.curPlotIndex, events[i].type, n);\r\n                        return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'insertPlot') { // 插播剧情\r\n                        this.sceneProxy.uiOnLoadQueue = [];\r\n                        // 先结束当前剧情\r\n\t\t\t\t\t\tlet pointer = new Phaser.Pointer(this.viewComponent.game, 1, Phaser.PointerMode.CURSOR);\r\n\t\t\t\t\t\tpointer.button = 0;\r\n                        this.sceneProxy.curPlotLayer.onChildInputDown.dispatch('insertPlot', pointer);\r\n                        this.sceneProxy.curPlotLayer.onChildInputDown.dispatch('insertPlot', pointer);\r\n                        // 插播\r\n                        this.showNextPlot(this.sceneProxy.context, curChapter, this.sceneProxy.curPlotIndex, events[i].type, events[i].handle.uuid);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'setValue') { // 数值设置\r\n\t\t\t\t\t\tthis.sceneProxy.valueOperation(context, events[i].handle.values);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (events[i].type === 'pay') {\t// 扣费事件\r\n\t\t\t\t\t\tconst price = Expression.safeEval(events[i].handle.price, context);\r\n\t\t\t\t\t\tconst id = events[i].handle.uuid;\r\n\t\t\t\t\t\tconst indentId = flashvars.client + Utils.generateUUID();\r\n\t\t\t\t\t\tlet disCounts = -1; // 优惠价格\r\n\t\t\t\t\t\tlet normalValue = [], savedValue = [], stringValue = [], payValue = [];\r\n\r\n                        const preOperation = () => {\r\n                            if (flashvars.client !== 'ios' && flashvars.client !== 'android')\r\n                                return;\r\n\r\n                            // 记录原数值\r\n                            for (let j=0; j<context.values.length; j++) { normalValue[j] = context.values[j].value }\r\n                            for (let j=0; j<context.savedValues.length; j++) { savedValue[j] = context.savedValues[j].value }\r\n                            for (let j=0; j<context.stringValues.length; j++) { stringValue[j] = context.stringValues[j].value }\r\n                            for (let j=0; j<context.payValues.length; j++) { payValue[j] = context.payValues[j].value }\r\n\r\n                            for (let j=parseInt(i)+1; j<events.length; j++) {\r\n                                if (events[j].type === 'setValue') {\r\n                                    this.sceneProxy.valueOperation(context, events[j].handle.values, true);\r\n                                }\r\n                                else if (events[j].type === 'pay') {\r\n                                    break;\r\n                                }\r\n                            }\r\n\r\n                            // 设置为正在购买状态\r\n                            this.sceneProxy.isPaying = true;\r\n                        };\r\n                        const afterOperation = () => {\r\n                        \tfor (let j=0; j<normalValue.length; j++) { context.values[j].value = normalValue[j] }\r\n                        \tfor (let j=0; j<savedValue.length; j++) { context.savedValues[j].value = savedValue[j] }\r\n                        \tfor (let j=0; j<stringValue.length; j++) { context.stringValues[j].value = stringValue[j] }\r\n                        \tfor (let j=0; j<payValue.length; j++) { context.payValues[j].value = payValue[j] }\r\n\r\n                            // 设置为正在购买状态\r\n                            this.sceneProxy.isPaying = false;\r\n\t\t\t\t\t\t};\r\n                        const goNextEvents = (type) => {\r\n                            const charge = disCounts === -1 ? price : disCounts;\r\n                            if (2 == type) {    // 星星支付\r\n                                this.sceneProxy.context.systemValues[1].value -= charge * 100;\r\n                            } else {\r\n                                this.sceneProxy.context.systemValues[0].value -= charge;\r\n                            }\r\n\r\n                            this.sceneProxy.getAccountInfo(); // 同步闪币余额\r\n                            if (i<events.length-1) {\r\n                                return eventHandler(obj, events.slice(i+1), type, nextAction);\r\n                            }\r\n\t\t\t\t\t\t};\r\n                        const operationCallback = (result) => {\r\n\t\t\t\t\t\t\tthis.sceneProxy.mallPayCallback = null;\r\n\t\t\t\t\t\t\tafterOperation();\r\n\r\n\t\t\t\t\t\t\tthis.sceneProxy.checkIfMallPaySuccess(indentId);\r\n\t\t\t\t\t\t\tif (result) {   // resule:0 失败  1:闪币支付  2:星星支付\r\n\t\t\t\t\t\t\t\tgoNextEvents(result);\r\n                            } else {\r\n\t\t\t\t\t\t\t\t// 从服务端拉取最新数据\r\n\t\t\t\t\t\t\t\tconst loadPayValues = () => {\r\n                                    Utils.timeout(1000).then(() => {\r\n                                        this.sceneProxy.getPayInfo().then(rs => {\r\n                                            if (Object.prototype.toString.call(rs) === \"[object String]\") {\r\n                                                loadPayValues();\r\n                                            }\r\n                                        });\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\tloadPayValues();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\r\n                        nextAction && (nextAction.paused = true);\r\n                        if (!this.sceneProxy.isPaying) {\r\n                            preOperation();\r\n                            this.sceneProxy.payOperation(price, id, indentId, operationCallback).then(dc => disCounts = dc);\r\n                        }\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (nextAction && nextAction.paused && i>=events.length) {\r\n                    // 遇到pay事件需暂停后续事件，所以在pay事件结束，pay所在的动作都完成后需调用后续动作callback\r\n\t\t\t\t\tnextAction.callback();\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\t\t\tconst keyUpCallback = (obj, event) => {\r\n\t\t\t\tif (Expression.safeEval(event.expression, context)) {\r\n\t\t\t\t\teventHandler(obj, event.events, 'onKeyUp');\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tconst eventCallback = (obj, type) => {\r\n\t\t\t\tlet invokeEventInfo = [];\r\n                let events;\r\n                events = viewInfo.events;\r\n                if (eventsInfo) {\r\n                    const parentEvents = Object.assign([], eventsInfo);\r\n                    parentEvents.forEach(es => es.events.forEach(e => e.isParent = true));\r\n                    events = parentEvents.concat(events);\r\n                }\r\n                for (let i in events) {\r\n                    if (events[i].type === type && events[i].type != 'onKeyUp') {\r\n                        invokeEventInfo[invokeEventInfo.length] = events[i];\r\n                    }\r\n                    else if (events[i].type === type && events[i].type === 'onKeyUp') {\r\n                        let code = events[i].keyCode;\r\n                        let key = this.sceneProxy.plotViewKeys && this.sceneProxy.plotViewKeys[code] ? this.sceneProxy.plotViewKeys[code]\r\n\t\t\t\t\t\t\t: this.sceneProxy.globalViewKeys && this.sceneProxy.globalViewKeys[code] ? this.sceneProxy.globalViewKeys[code] : undefined;\r\n                        if (key) {\r\n                            key.onUp.add(() => keyUpCallback(obj, events[i]));\r\n\t\t\t\t\t\t}\r\n                    }\r\n                }\r\n                let result = true;\r\n                const invokeHandler = events => {\r\n                    for (let v=0; v<events.length; v++) {\r\n                        if (Expression.safeEval(events[v].expression, context)) {\r\n                        \tconst pausedCallback = () => { invokeHandler(events.slice(v+1)) };\r\n                        \tlet nextAction = {paused: false, callback: pausedCallback};\r\n\r\n                            // 因遇到pay事件需暂停后续事件，所以在pay事件结束，pay所在的动作都完成后再执行后续动作callback\r\n                            if (!eventHandler(obj, events[v].events, type, nextAction)) {\r\n                                result = false;\r\n                                break;\r\n                            }\r\n                            else if (nextAction.paused) {\r\n                            \tbreak;\r\n\t\t\t\t\t\t\t}\r\n                        }\r\n                    }\r\n\t\t\t\t};\r\n                invokeHandler(invokeEventInfo);\r\n\t\t\t\treturn result;\r\n\t\t\t};\r\n\t\t\tconst onViewClicked = (obj, pointer) => {\r\n\t\t\t    if (obj.isHanding || this.sceneProxy.isPaying) {\r\n\t\t\t        return;\r\n                }\r\n\t\t\t\tif (pointer && pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tobj.isHanding = true;\r\n\t\t\t\teventCallback(obj, 'onClick');\r\n\t\t\t\tobj.isHanding = false;\r\n\t\t\t};\r\n\t\t\tconst addItemClickedCallback = (obj) => {\r\n\t\t\t\tobj.events.onInputDown.add(onViewClicked, this, 0, obj);\r\n\t\t\t};\r\n\t\t\tconst onLoadCallback = (obj) => {\r\n\t\t\t\tif (!isRefresh) {\r\n\t\t\t\t\treturn eventCallback(obj, 'onLoad');\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\t\t\tconst onKeyUpCallback = (obj) => {\r\n\t\t\t\teventCallback(obj, 'onKeyUp');\r\n\t\t\t};\r\n\r\n\t\t\tif ('button' === viewInfo.type) {\r\n                let sound = null;\r\n                if (viewInfo.content.sound && viewInfo.content.sound.url) {\r\n                    sound = this.viewComponent.game.add.sound(viewInfo.content.sound.url, viewInfo.content.sound.volume, false);\r\n                }\r\n\t\t\t\tconst btn = this.viewComponent.addButton(pointX,\r\n\t\t\t\t\tpointY,\r\n\t\t\t\t\tviewInfo.width,\r\n\t\t\t\t\tviewInfo.height,\r\n\t\t\t\t\tviewInfo.content.background.normal.url,\r\n\t\t\t\t\tviewInfo.content.background.active.url,\r\n\t\t\t\t\t(btn, pointer) => onViewClicked(btn.parent, pointer),\r\n\t\t\t\t\tnull,\r\n                    sound,\r\n\t\t\t\t\tnull,\r\n\t\t\t\t\tcontainerLayer\r\n\t\t\t\t);\r\n\t\t\t\tonKeyUpCallback(btn.parent);\r\n                containerLayer.viewType = 'BUTTON';\r\n                //result = onLoadCallback(btn.parent);\r\n                this.sceneProxy.uiOnLoadQueue.push({name: refUuid, instanceUuid: instanceUuid, object: btn.parent, callBack: onLoadCallback});\r\n\t\t\t}\r\n\t\t\telse if ('image' === viewInfo.type) {\r\n\t\t\t\tlet img = this.viewComponent.game.add.image(pointX, pointY, viewInfo.content.background.url);\r\n\t\t\t\timg.width = viewInfo.width;\r\n\t\t\t\timg.height = viewInfo.height;\r\n\t\t\t\tcontainerLayer.add(img);\r\n\t\t\t\taddItemClickedCallback(img);\r\n\t\t\t\tonKeyUpCallback(img);\r\n\t\t\t\tthis.viewComponent.addGifAnimation(img, viewInfo.content.background.url);\r\n                containerLayer.viewType = 'IMAGE';\r\n                //result = onLoadCallback(img);\r\n                this.sceneProxy.uiOnLoadQueue.push({name: refUuid, instanceUuid: instanceUuid, object: img, callBack: onLoadCallback});\r\n\t\t\t}\r\n\t\t\telse if ('text' === viewInfo.type) {\r\n\t\t\t\tlet ff;\r\n\t\t\t\tlet fontStyle = {boundsAlignH: \"left\", boundsAlignV: \"bottom\", wordWrap: true};\r\n\t\t\t\tff = viewInfo.content.font_size + '';\r\n\t\t\t\tif (ff.indexOf('px') < 0) {\r\n\t\t\t\t\tff = ff + 'px';\r\n\t\t\t\t}\r\n                if (viewInfo.content.bold === true) {\r\n                    ff = 'bold ' + ff + ' ' + viewInfo.content.fontFamily;\r\n                }\r\n                else {\r\n\t\t\t\t    if (viewInfo.content.fontFamily) {\r\n                        ff = ff + ' ' + viewInfo.content.fontFamily;\r\n                    }\r\n                    else if (this.sceneProxy.json_data.font) {\r\n                        ff = ff + ' ' + this.sceneProxy.json_data.font.fontFamily;\r\n                    }\r\n                }\r\n\r\n\t\t\t\tfontStyle.font = ff;\r\n\t\t\t\tfontStyle.fill = viewInfo.content.color;\r\n\t\t\t\tfontStyle.wordWrapWidth = viewInfo.width;\r\n\r\n\t\t\t\tlet txt = this.viewComponent.game.add.text(pointX, pointY, '', fontStyle, containerLayer);\r\n\t\t\t\tlet str = '';\r\n                if (Expression.isArray(viewInfo.content.value)) {\r\n                    viewInfo.content.value.forEach(v => str += Expression.parseValue(v.data, context));\r\n                    this.sceneProxy.addImageFontTextColors(viewInfo.content.value, txt, context);\r\n                    if (FontUtils.fontFamily) {\r\n                        const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(viewInfo.content.font_size) : viewInfo.content.font_size;\r\n                        const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(viewInfo.content.font_size) : viewInfo.content.font_size;\r\n                        this.sceneProxy.addImageFontText(viewInfo.content.value, fw, fh, txt, context);\r\n                    }\r\n                }\r\n                else {\r\n                    str = Expression.parseValue(viewInfo.content.value, context);\r\n                }\r\n\t\t\t\ttxt.inputEnabled = true;\r\n                txt.input.useHandCursor = true;\r\n\t\t\t\ttxt.useAdvancedWrap = true;\r\n\t\t\t\ttxt.lineSpacing = this.sceneProxy.txtLineSpace(viewInfo.content.font_size);\r\n\t\t\t\ttxt.updateText = RePhaser.updateText;\r\n\t\t\t\ttxt.advancedWordWrap = RePhaser.advancedWordWrap;\r\n\t\t\t\tif (FontUtils.fontFamily) {\r\n\t\t\t\t    txt.children.forEach(v => {v.visible = true});\r\n\t\t\t\t    txt.text = ' ';\r\n                }\r\n                else {\r\n                    txt.text = str;\r\n                }\r\n                addItemClickedCallback(txt);\r\n                onKeyUpCallback(txt);\r\n                containerLayer.viewType = 'TEXT';\r\n                //result = onLoadCallback(txt);\r\n                this.sceneProxy.uiOnLoadQueue.push({name: refUuid, instanceUuid: instanceUuid, object: txt, callBack: onLoadCallback});\r\n                const eventsInfoCopy = eventsInfo ? eventsInfo : [];\r\n                const clickEvent = [...viewInfo.events, ...eventsInfoCopy].filter(a => a.type === 'onClick');\r\n                !clickEvent.length && (txt.inputEnabled = false);\r\n            }\r\n\t\t\telse if ('bar' === viewInfo.type) {\r\n\t\t\t\tlet bkImg = this.viewComponent.game.add.sprite(pointX, pointY, viewInfo.content.background.normal.url);\r\n\t\t\t\tbkImg.width = viewInfo.width;\r\n\t\t\t\tbkImg.height = viewInfo.height;\r\n\t\t\t\tcontainerLayer.add(bkImg);\r\n\t\t\t\taddItemClickedCallback(bkImg);\r\n                this.viewComponent.addGifAnimation(bkImg, viewInfo.content.background.normal.url);\r\n\r\n\t\t\t\tlet bkPrgs = this.viewComponent.game.add.sprite(pointX// + viewInfo.content.basePoint.x\r\n\t\t\t\t\t, pointY// + viewInfo.content.basePoint.y\r\n\t\t\t\t\t, viewInfo.content.background.progress.url);\r\n\t\t\t\tbkPrgs.width = viewInfo.width;\r\n\t\t\t\tbkPrgs.height = viewInfo.height;\r\n\t\t\t\tcontainerLayer.add(bkPrgs);\r\n\t\t\t\taddItemClickedCallback(bkPrgs);\r\n                this.viewComponent.addGifAnimation(bkPrgs, viewInfo.content.background.progress.url);\r\n\r\n\t\t\t\tlet mask = this.viewComponent.game.add.graphics(pointX, pointY);\r\n\t\t\t\tmask.beginFill(0xffffff);\r\n\t\t\t\tmask.drawRect(0, 0, viewInfo.width, viewInfo.height);\r\n\t\t\t\tmask.endFill();\r\n\t\t\t\tcontainerLayer.add(mask);\r\n\t\t\t\tbkPrgs.mask = mask;\r\n\t\t\t\taddItemClickedCallback(mask);\r\n\t\t\t\tonKeyUpCallback(mask);\r\n\r\n\t\t\t\tlet hType = '';\r\n\t\t\t\tlet vType = '';\r\n\r\n\t\t\t\tif (viewInfo.content.basePoint.x === 0) {hType = 'left';}\r\n\t\t\t\telse if (viewInfo.content.basePoint.x === viewInfo.width) {hType = 'right';}\r\n\t\t\t\telse {hType = 'middle';}\r\n\r\n\t\t\t\tif (viewInfo.content.basePoint.y === 0) {vType = 'top';}\r\n\t\t\t\telse if (viewInfo.content.basePoint.y === viewInfo.height) {vType = 'bottom';}\r\n\t\t\t\telse {vType = 'center';}\r\n\r\n\t\t\t\tconst {prgsViews} = this.sceneProxy;\r\n\t\t\t\tlet index = 0;\r\n\t\t\t\tfor (; index<prgsViews.length; index++) {\r\n\t\t\t\t\tif (prgsViews[index].uuid === viewInfo.uuid && prgsViews[index].layer.children.length === 0) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tprgsViews[index] = {uuid: viewInfo.uuid\r\n\t\t\t\t\t, layer: containerLayer\r\n\t\t\t\t\t, type: hType + '-' + vType\r\n\t\t\t\t\t, content: viewInfo.content};\r\n\r\n\t\t\t\tthis.updateProgressView();\r\n                containerLayer.viewType = 'BAR';\r\n                //result = onLoadCallback(mask);\r\n                this.sceneProxy.uiOnLoadQueue.push({name: refUuid, instanceUuid: instanceUuid, object: mask, callBack: onLoadCallback});\r\n\t\t\t}\r\n\t\t\telse if ('input' === viewInfo.type) {\r\n\t\t\t    const initValue = Expression.safeEval(viewInfo.content.value, context);\r\n                let textBoxElement = new TextBox.HtmlTextBox(this.viewComponent.game\r\n                    , pointX, pointY\r\n                    , viewInfo.width, viewInfo.height\r\n                    , initValue\r\n                    , viewInfo.content.color\r\n                    , viewInfo.content.font_size\r\n                    , viewInfo.content.fontFamily ? viewInfo.content.fontFamily : this.sceneProxy.json_data.font ? this.sceneProxy.json_data.font.fontFamily : ''\r\n                    , viewInfo.content.bold ? viewInfo.content.bold : null);\r\n\r\n                if ('[未知数值]' === initValue) {\r\n                    textBoxElement.setEnable(false);\r\n                }\r\n\r\n                const inputCallback = (text)=>{\r\n\t\t\t\t\tconst v = text;\r\n\t\t\t\t\tconst uuid = viewInfo.content.value.arg1;\r\n\t\t\t\t\tconst updateValue = (index, v, type) => {\r\n                        let realV = '';\r\n                        for (let i=0; i<v.length; i++) {\r\n                            if (v[i]>='0' && v[i]<='9' || v[i] === '.' && i !== 0) {\r\n                                realV += v[i];\r\n                            }\r\n                        }\r\n                        let vv = parseFloat(realV);\r\n                        vv = vv ? vv : 0;\r\n                        if (vv < -99999999999999) {\r\n                            vv = -99999999999999;\r\n                        }\r\n                        else if (vv > 99999999999999) {\r\n                            vv = 99999999999999;\r\n                        }\r\n                        if (type === 'value') {\r\n                            this.sceneProxy.context.values[index].value = vv;\r\n                        } else if (type === 'savedValue') {\r\n                            this.sceneProxy.context.savedValues[index].value = vv;\r\n                        }\r\n                        textBoxElement.isValue = true;\r\n                        if (parseFloat(realV) !== vv && 0 !== vv) {\r\n                            textBoxElement.text = vv + '';\r\n                        }\r\n                        else if (realV !== v) {\r\n                            textBoxElement.text = realV;\r\n                        }\r\n                    };\r\n\t\t\t\t\tlet index;\r\n\t\t\t\t\tif ((index = context.values.findIndex(v => v.uuid === uuid)) !== -1) {\r\n\t\t\t\t\t\tupdateValue(index, v, 'value');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ((index = context.savedValues.findIndex(v => v.uuid === uuid)) !== -1) {\r\n\t\t\t\t\t\tupdateValue(index, v, 'savedValue');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ((index = context.stringValues.findIndex(v => v.uuid === uuid)) !== -1) {\r\n\t\t\t\t\t\tcontext.stringValues[index].value = v;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ((index = context.indexValues.findIndex(v => v.uuid === uuid)) !== -1) {\r\n                        const ri = (context.indexValues[index].value === undefined ? Expression.safeInitValue(context.indexValues[index], context) : context.indexValues[index].value) - 1;\r\n\t\t\t\t\t    if (context.indexValues[index].init.type === 'value') {\r\n\t\t\t\t\t        updateValue(ri, v, 'value');\r\n                        }\r\n                        else if (context.indexValues[index].init.type === 'savedValue') {\r\n                            updateValue(ri, v, 'savedValue');\r\n                        }\r\n                        else if (context.indexValues[index].init.type === 'stringValue') {\r\n                            context.stringValues[ri].value = v;\r\n                        }\r\n                    }\r\n\t\t\t\t};\r\n\r\n\t\t\t\ttextBoxElement.setInputCallback(inputCallback);\r\n\t\t\t\ttextBoxElement.setClickCallback(onViewClicked);\r\n\t\t\t\ttextBoxElement.mgrParent = containerLayer;\r\n\t\t\t\tcontainerLayer.inputElement = textBoxElement;\r\n\t\t\t\tonKeyUpCallback(textBoxElement);\r\n                containerLayer.viewType = 'INPUT';\r\n                //result = onLoadCallback(textBoxElement);\r\n                this.sceneProxy.uiOnLoadQueue.push({name: refUuid, instanceUuid: instanceUuid, object: textBoxElement, callBack: onLoadCallback});\r\n\t\t\t}\r\n\t\t\telse if ('timer' === viewInfo.type) {\r\n                const sceneProxy = this.sceneProxy;\r\n                let img = this.viewComponent.game.add.image(0, 0, null);\r\n                containerLayer.add(img);\r\n                containerLayer.currentCount = 0;\r\n\r\n                const isStepCanSkip = () => {\r\n                \tif (sceneProxy.playPause) {\r\n                \t\t// 菜单可见 则不可跳过菜单中的计时器\r\n                \t\tfor (let i=0; i<sceneProxy.menuTimer.length; i++) {\r\n                \t\t\tif (sceneProxy.menuTimer[i] === containerLayer.name) {\r\n                \t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n                \t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n                \t\t// 菜单不可见  则可跳过菜单中的计时器\r\n                \t\tfor (let i=0; i<sceneProxy.menuTimer.length; i++) {\r\n                \t\t\tif (sceneProxy.menuTimer[i] === containerLayer.name) {\r\n                \t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n                        return false;\r\n                    }\r\n\t\t\t\t};\r\n                const onStepTimeOut = () => {\r\n                \treturn function () {\r\n                \t\tif (isStepCanSkip()) {\r\n                            containerLayer.timerHandler = setTimeout(onStepTimeOut(), viewInfo.content.step.value);\r\n                \t\t\treturn;\r\n\t\t\t\t\t\t}\r\n                        if (containerLayer.currentCount++ < viewInfo.content.count.value) {\r\n                            eventCallback(img, 'onStep');\r\n                            containerLayer.timerHandler = setTimeout(onStepTimeOut(), viewInfo.content.step.value);\r\n                        }\r\n                    }\r\n                };\r\n\r\n                const onStepInterval = () => {\r\n                \treturn function () {\r\n                \t\tif (isStepCanSkip()) {\r\n                \t\t\treturn;\r\n\t\t\t\t\t\t}\r\n                        eventCallback(img, 'onStep');\r\n                    }\r\n\t\t\t\t};\r\n\r\n                if (viewInfo.content.count.value === 0) {\r\n                    containerLayer.timerHandler = setInterval(onStepInterval(), viewInfo.content.step.value);\r\n                    containerLayer.timerType = 'timeInterval';\r\n                } else {\r\n                    containerLayer.timerHandler = setTimeout(onStepTimeOut(), viewInfo.content.step.value);\r\n                    containerLayer.timerType = 'timeOut';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 读档还原计时器已计时次数\r\n\t\t\t\tfor (let i=0; i<this.sceneProxy.timerCounts.length; i++) {\r\n                \tconst item = this.sceneProxy.timerCounts[i];\r\n                \tif (containerLayer.name === item.name && item.parent === parentLayer.name) {\r\n                \t\tcontainerLayer.currentCount = item.currentCount;\r\n                \t\tthis.sceneProxy.timerCounts.splice(i,1);\r\n                \t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 主菜单可见 判断为计时器是主菜单子控件\r\n\t\t\t\tthis.sceneProxy.mainMenuLayer.visible && (this.sceneProxy.menuTimer[this.sceneProxy.menuTimer.length] = refUuid)\r\n                containerLayer.viewType = 'TIMER';\r\n                this.sceneProxy.uiOnLoadQueue.push({name: refUuid, instanceUuid: instanceUuid, object: img, callBack: onLoadCallback});\r\n\t\t\t}\r\n\t\t\telse if ('container' === viewInfo.type) {\r\n\t\t\t\tlet bk = null;\r\n\t\t\t\tif (viewInfo.content.background.url) {\r\n                    bk = this.viewComponent.game.add.image(pointX, pointY, viewInfo.content.background.url);\r\n                    bk.width = viewInfo.width;\r\n                    bk.height = viewInfo.height;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbk = this.viewComponent.game.add.graphics(0, 0);\r\n\t\t\t\t\tbk.beginFill(0x0, 1);\r\n\t\t\t\t\tbk.drawRect(pointX, pointY, viewInfo.width, viewInfo.height);\r\n\t\t\t\t\tbk.endFill();\r\n\t\t\t\t\tbk.alpha = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainerLayer.add(bk);\r\n\t\t\t\taddItemClickedCallback(bk);\r\n\t\t\t\tonKeyUpCallback(bk);\r\n                containerLayer.viewType = 'CONTAINER';\r\n                this.sceneProxy.uiOnLoadQueue.push({name: refUuid, instanceUuid: instanceUuid, object: bk, callBack: onLoadCallback});\r\n                for (let i in viewInfo.children) {\r\n\t\t\t\t\tconst child = this.addView(containerLayer, viewInfo.children[i].ref, viewInfo.children[i].instanceUuid, viewInfo.children[i].x, viewInfo.children[i].y, viewInfo.children[i].events, isRefresh);\r\n\t\t\t\t\tif (!child) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchild.x += pointX;\r\n\t\t\t\t\tchild.y += pointY;\r\n\t\t\t\t\tif (viewInfo.children[i].scale) {\r\n\t\t\t\t\t\tchild.scale.set(viewInfo.children[i].scale, viewInfo.children[i].scale);\r\n\t\t\t\t\t\tchild.x += Expression.safeEval(viewInfo.children[i].x, context) * (1 - viewInfo.children[i].scale);\r\n\t\t\t\t\t\tchild.y += Expression.safeEval(viewInfo.children[i].y, context) * (1 - viewInfo.children[i].scale);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (child.inputElement) {\r\n                        child.inputElement.x += pointX;\r\n                        child.inputElement.y += pointY;\r\n\r\n                        if (viewInfo.children[i].scale) {\r\n                            child.inputElement.fontSize *= viewInfo.children[i].scale;\r\n                            child.inputElement.width *= viewInfo.children[i].scale;\r\n                            child.inputElement.height = child.inputElement.fontSize;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tchild.inputElement.update();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n                //result = onLoadCallback(bk);\r\n\t\t\t}\r\n\r\n\t\t\treturn result ? containerLayer : result;\r\n\t\t},\r\n\r\n\t\tuiOnLoadInvoker: function () {\r\n\t\t\twhile (0 < this.sceneProxy.uiOnLoadQueue.length) {\r\n\t\t\t\tlet item = this.sceneProxy.uiOnLoadQueue[0];\r\n\t\t\t\tthis.sceneProxy.uiOnLoadQueue.splice(0, 1);\r\n\t\t\t\titem.callBack(item.object);\r\n\t\t\t}\r\n        },\r\n\r\n\t\tupdateProgressView: function () {\r\n\t\t\tfor (let i = 0; i < this.sceneProxy.prgsViews.length; i++) {\r\n\t\t\t\tconst prgs = this.sceneProxy.prgsViews[i];\r\n\t\t\t\tif (!prgs.layer.children.length) { continue; }\r\n\r\n\t\t\t\tconst bkImg = prgs.layer.children[0];\r\n\t\t\t\tconst bkPrgs = prgs.layer.children[1];\r\n\t\t\t\tconst mask = prgs.layer.children[2];\r\n\t\t\t\tconst nWidth = this.sceneProxy.Expression.safeEval(prgs.content.value.normal.width, this.sceneProxy.context);\r\n\t\t\t\tconst nHeight = this.sceneProxy.Expression.safeEval(prgs.content.value.normal.height, this.sceneProxy.context);\r\n\t\t\t\tconst pWidth = this.sceneProxy.Expression.safeEval(prgs.content.value.progress.width, this.sceneProxy.context);\r\n\t\t\t\tconst pHeight = this.sceneProxy.Expression.safeEval(prgs.content.value.progress.height, this.sceneProxy.context);\r\n\t\t\t\tconst update = (obj, x, y, width, height) => {\r\n\t\t\t\t\tif (obj.isMask) {\r\n\t\t\t\t\t\tobj.destroy();\r\n\t\t\t\t\t\tobj = this.viewComponent.game.add.graphics(x, y);\r\n\t\t\t\t\t\tobj.beginFill(0xffffff);\r\n\t\t\t\t\t\tobj.drawRect(0, 0, width, height);\r\n\t\t\t\t\t\tobj.endFill();\r\n\t\t\t\t\t\tobj.inputEnabled = false;\r\n\t\t\t\t\t\tprgs.layer.add(obj);\r\n\t\t\t\t\t\tbkPrgs.mask = obj;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj.x = x;\r\n\t\t\t\t\t\tobj.y = y;\r\n\t\t\t\t\t\tobj.width = width;\r\n\t\t\t\t\t\tobj.height = height;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tlet mover = prgs.content.style === 'clip' ? mask : bkPrgs;\r\n\t\t\t\tconst w = Math.min(pWidth * bkImg.width / nWidth, bkImg.width);\r\n\t\t\t\tconst h = Math.min(pHeight * bkImg.height / nHeight, bkImg.height);\r\n\r\n\t\t\t\tswitch (prgs.type) {\r\n\t\t\t\t\tcase 'left-top':\r\n\t\t\t\t\t\tupdate(mover, bkImg.x, bkImg.y, w, h);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'middle-top':\r\n\t\t\t\t\t\tupdate(mover, bkImg.x+(bkImg.width-w)/2, bkImg.y, w, h);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'right-top':\r\n\t\t\t\t\t\tupdate(mover, bkImg.x+bkImg.width-w, bkImg.y, w, h);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'left-center':\r\n\t\t\t\t\t\tupdate(mover, bkImg.x, bkImg.y+(bkImg.height-h)/2, w, h);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'middle-center':\r\n\t\t\t\t\t\tupdate(mover, bkImg.x+(bkImg.width-w)/2, bkImg.y+(bkImg.height-h)/2, w, h);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'right-center':\r\n\t\t\t\t\t\tupdate(mover, bkImg.x+bkImg.width-w, bkImg.y+(bkImg.height-h)/2, w, h);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'left-bottom':\r\n\t\t\t\t\t\tupdate(mover, bkImg.x, bkImg.y+bkImg.height-h, w, h);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'middle-bottom':\r\n\t\t\t\t\t\tupdate(mover, bkImg.x+(bkImg.width-w)/2, bkImg.y+bkImg.height-h, w, h);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'right-bottom':\r\n\t\t\t\t\t\tupdate(mover, bkImg.x+bkImg.width-w,  bkImg.y+bkImg.height-h, w, h);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestroyView: function (viewLayerName, bCloseMainMenu) {\r\n\t\t\tconst destroyInChild = (child, name) => {\r\n\t\t\t\tif (child.name && child.name === name || child.instanceUuid && child.instanceUuid === name) {\r\n                    this.removeViewKeyByInstance(child, this.sceneProxy.plotViewKeys); // 组件销毁前，移除其按键事件\r\n                    this.sceneProxy.removeInputView(child);\r\n                    this.sceneProxy.removeViewTimer(child);\r\n                    child.destroy();\r\n\t\t\t\t\tif (child.isMenu && bCloseMainMenu) {\r\n\t\t\t\t\t\tthis.sceneProxy.onMainMenuBackBtnClicked();\r\n\t\t\t\t\t\tthis.sceneProxy.mainMenuLayer.removeAll(true, false, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\telse if (child.children && child.children.length > 0) {\r\n\t\t\t\t\tfor (let i=0; i<child.children.length; i++) {\r\n\t\t\t\t\t\tdestroyInChild(child.children[i], name) && i--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\t\t\tdestroyInChild(this.viewComponent.game.world, viewLayerName);\r\n\t\t},\r\n\r\n        showInputView: function (layer, bShow) {\r\n            if (layer.inputElement) {\r\n                layer.inputElement.show(bShow);\r\n            }\r\n            else if (layer.children && layer.children.length) {\r\n                for (let i=0; i<layer.children.length; i++) {\r\n                    this.showInputView(layer.children[i], bShow);\r\n                }\r\n            }\r\n        },\r\n\r\n\t\tscaleInputView: function (layer, scale) {\r\n\t\t\tif (layer.inputElement) {\r\n                layer.inputElement.fontSize *= scale;\r\n                layer.inputElement.width *= scale;\r\n\t\t\t\tlayer.inputElement.height = layer.inputElement.fontSize + 6;\r\n\t\t\t\t// 无需移动位置\r\n\t\t\t\t//layer.inputElement.x = layer.inputElement._x + this.sceneProxy.Expression.safeEval(layer.xInfo, this.sceneProxy.context) * (scale - 1);\r\n\t\t\t\t//layer.inputElement.y = layer.inputElement._y + this.sceneProxy.Expression.safeEval(layer.yInfo, this.sceneProxy.context) * (scale - 1);\r\n\t\t\t\tlayer.inputElement.update();\r\n\t\t\t}\r\n\t\t\telse if (layer.children && layer.children.length) {\r\n\t\t\t\tfor (let i=0; i<layer.children.length; i++) {\r\n\t\t\t\t\tthis.scaleInputView(layer.children[i], scale);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\trefreshView: function (refUuid, bReload) {\r\n\t\t\tconst getRefreshViews = (view, refUuid) => {\r\n\t\t\t\tlet views = [];\r\n\t\t\t\tif (view.name && view.name === refUuid) {\r\n\t\t\t\t\tviews.push(view);\r\n\t\t\t\t} else {\r\n                    views = view.children.reduce((r, c) => r.concat(getRefreshViews(c, refUuid)), []);\r\n\t\t\t\t}\r\n\t\t\t\treturn views;\r\n\t\t\t};\r\n\r\n\t\t\tlet newViews = [];\r\n\t\t\tconst refreshViews = getRefreshViews(this.viewComponent.game.world, refUuid);\r\n\r\n\t\t\tif (refreshViews.length > 0) {\r\n                const {viewMap} = this.sceneProxy.json_data;\r\n                const events = viewMap[refUuid].events;\r\n                for (let e in events) {\r\n                    if (events[e].type === 'onKeyUp') {\r\n                        this.sceneProxy.plotViewKeys[events[e].keyCode].onUp.removeAll();\r\n                    }\r\n                }\r\n\t\t\t}\r\n\r\n            refreshViews.forEach(oldView => {\r\n                const {xInfo, yInfo, scale, isGlobal, children, instanceUuid} = oldView;\r\n\r\n                for (let e in oldView.eventsInfo) {\r\n                    if (oldView.eventsInfo[e].type === 'onKeyUp') {\r\n                        this.sceneProxy.plotViewKeys[oldView.eventsInfo[e].keyCode].onUp.removeAll();\r\n                    }\r\n                }\r\n\r\n                const newView = this.addView(oldView.parent, refUuid, instanceUuid, xInfo, yInfo, oldView.eventsInfo, !bReload);\r\n                if (!newView) {\r\n                \treturn;\r\n\t\t\t\t}\r\n\r\n                this.viewComponent.game.world.add(newView);\r\n\r\n                for (let n=0; n<children.length; n++) {\r\n                    let bExist = false;\r\n                    for (let c in newView.children) {\r\n                        if (newView.children[c].name === children[n].name) {\r\n                            bExist = true;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (!bExist && !bReload) {\r\n                        //this.addView(newView, children[n].name, children[n].instanceUuid, children[n].xInfo, children[n].yInfo, null, !bReload);\r\n                        newView.addChild(children[n]);\r\n                        n -= 1;\r\n                    }\r\n                }\r\n\r\n                if (oldView.parent.viewType === 'CONTAINER') {\r\n                    newView.x += this.sceneProxy.Expression.safeEval(oldView.parent.xInfo, this.sceneProxy.context);\r\n                    newView.y += this.sceneProxy.Expression.safeEval(oldView.parent.yInfo, this.sceneProxy.context);\r\n                }\r\n\r\n                if (scale) {\r\n                    newView.scale.set(scale.x, scale.y);\r\n                    newView.x += this.sceneProxy.Expression.safeEval(xInfo, this.sceneProxy.context) * (1 - scale.x);\r\n                    newView.y += this.sceneProxy.Expression.safeEval(yInfo, this.sceneProxy.context) * (1 - scale.y);\r\n                    this.scaleInputView(newView, scale.x);\r\n                }\r\n\r\n                if (isGlobal) {\r\n                    newView.isGlobal = true;\r\n                    const index = this.sceneProxy.globalViews.findIndex(v => v.name === refUuid);\r\n                    this.sceneProxy.globalViews.splice(index, 1, newView);\r\n                }\r\n\r\n                if (oldView.isMenu) {\r\n                    newView.isMenu = true;\r\n                }\r\n\r\n                if (oldView.parent && oldView.parent.name === 'plotViewsLayer') {\r\n                    const oldIndex = this.sceneProxy.plotViews.indexOf(oldView);\r\n                    this.sceneProxy.plotViews.splice(oldIndex, 1, newView);\r\n                }\r\n                this.sceneProxy.removeViewTimer(oldView);\r\n                oldView.parent.replace(oldView, newView).destroy();\r\n                newViews.push(newView);\r\n            });\r\n\r\n\t\t\treturn newViews;\r\n\t\t},\r\n\r\n\t\tbackgroundFlex: function (bkSprite, flex) {\r\n\t\t\tif (flex === 3) {// 填充\r\n\t\t\t\tlet rate = bkSprite.width / bkSprite.height < this.viewComponent.game.world.width / this.viewComponent.game.world.height ? this.viewComponent.game.world.width / bkSprite.width : this.viewComponent.game.world.height / bkSprite.height;\r\n\t\t\t\tbkSprite.width *= rate;\r\n\t\t\t\tbkSprite.height *= rate;\r\n\t\t\t\tbkSprite.x = -(bkSprite.width - this.viewComponent.game.world.width) / 2;\r\n\t\t\t\tbkSprite.y = -(bkSprite.height - this.viewComponent.game.world.height) / 2;\r\n\t\t\t}\r\n\t\t\telse if (flex === 5) {// 适应\r\n\t\t\t\tlet rate = 0;\r\n\t\t\t\tif (bkSprite.width / bkSprite.height > this.viewComponent.game.world.width / this.viewComponent.game.world.height) {\r\n\t\t\t\t\trate = this.viewComponent.game.world.width / bkSprite.width;\r\n\t\t\t\t\tbkSprite.width *= rate;\r\n\t\t\t\t\tbkSprite.height *= rate;\r\n\t\t\t\t\tbkSprite.y = (this.viewComponent.game.world.height - bkSprite.height) / 2;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\trate = this.viewComponent.game.world.height / bkSprite.height;\r\n\t\t\t\t\tbkSprite.width *= rate;\r\n\t\t\t\t\tbkSprite.height *= rate;\r\n\t\t\t\t\tbkSprite.x = (this.viewComponent.game.world.width - bkSprite.width) / 2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbkSprite.width = this.viewComponent.game.world.width;\r\n\t\t\t\tbkSprite.height = this.viewComponent.game.world.height;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ttweenToPromise: function (obj, properties, duration, ease, autoStart, delay, repeat, yoyo) {\r\n\t\t\tduration = Math.max(duration, 1);\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tconst tween = this.viewComponent.game.add.tween(obj).to(properties\r\n\t\t\t\t\t, duration\r\n\t\t\t\t\t, ease, autoStart\r\n\t\t\t\t\t, delay, repeat, yoyo);\r\n\t\t\t\ttween.onComplete.add(() => resolve());\r\n\t\t\t\tthis.sceneProxy.lstPlotTweens.push(tween);\r\n                !obj.animateTweens && (obj.animateTweens = []);\r\n\t\t\t\t/*obj && 'dialogLayer' === obj.name && */obj.animateTweens.push(tween);\r\n\t\t\t})\r\n\t\t},\r\n\r\n\t\ttweenFromPromise: function (obj, properties, duration, ease, autoStart, delay, repeat, yoyo) {\r\n            duration = Math.max(duration, 1);\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tconst tween = this.viewComponent.game.add.tween(obj).from(properties\r\n\t\t\t\t\t, duration\r\n\t\t\t\t\t, ease, autoStart\r\n\t\t\t\t\t, delay, repeat, yoyo);\r\n\t\t\t\ttween.onComplete.add(() => resolve());\r\n                this.sceneProxy.lstPlotTweens.push(tween);\r\n                !obj.animateTweens && (obj.animateTweens = []);\r\n                /*obj && 'dialogLayer' === obj.name && */obj.animateTweens.push(tween);\r\n\t\t\t})\r\n\t\t},\r\n\r\n        showPlot: function (context, chapter, nPlot, cmdPlotSnap, loadData) {\r\n\t\t\tconst {Expression} = this.sceneProxy;\r\n\t\t\tconst plot = chapter.plots[nPlot];\r\n            let bkSprite = null;\t// 背景\r\n\t\t\tlet titleTxt = null;\t// 文本标题\r\n\t\t\tlet contentTxt = null;\t// 文本\r\n\t\t\tlet isShowAll = false;\r\n\r\n\t\t\tif (!this.sceneProxy.isGameStarted && chapter.isFirst && nPlot===0) {\r\n\t\t\t\t// 告知游戏开始\r\n\t\t\t\tthis.sceneProxy.notifyGameStarted();\r\n\t\t\t}\r\n\r\n\t\t\t// 振动效果\r\n\t\t\tconst sceneShake = (offSet/*=18*/, duration/*=600*/, delay) => {\r\n\t\t\t\tconst curOffSet = offSet;\r\n\t\t\t\tconst sceneProxy = this.sceneProxy;\r\n\t\t\t\tconst properties = {\r\n\t\t\t\t\tx: sceneProxy.dialogLayer.x - curOffSet,\r\n\t\t\t\t\ty: sceneProxy.dialogLayer.y - curOffSet\r\n\t\t\t\t};\r\n\t\t\t\tconst promises = [];\r\n\t\t\t\tif (plot.speaking && plot.speaking.coverage === 'bottom') {\r\n\t\t\t\t\tpromises.push(this.tweenToPromise(sceneProxy.dialogLayer, properties, 40, null, true, delay, 0, true));\r\n\t\t\t\t}\r\n\t\t\t\tif (sceneProxy.charsAndPropsLayer) {\r\n                    sceneProxy.charsAndPropsLayer.visible = true;\r\n\t\t\t\t\tpromises.push(this.tweenToPromise(sceneProxy.charsAndPropsLayer,\r\n\t\t\t\t\t\t{x: sceneProxy.charsAndPropsLayer.x - curOffSet, y: sceneProxy.charsAndPropsLayer.y - curOffSet},\r\n\t\t\t\t\t\t40, null, true, delay, 0, true));\r\n\t\t\t\t}\r\n\t\t\t\tpromises.push(this.tweenToPromise(sceneProxy.curPlotLayer, {\r\n\t\t\t\t\tx: -curOffSet,\r\n\t\t\t\t\ty: -curOffSet\r\n\t\t\t\t}, 40, null, true, delay, 0, true)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tif (0 < duration && !sceneProxy.quickPlay && chapter === sceneProxy.curChapter && nPlot === sceneProxy.curPlotIndex) {\r\n\t\t\t\t\t\t\treturn sceneShake(curOffSet, duration-100, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t    sceneProxy.curPlotLayer.isShaking = false;\r\n\t\t\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}));\r\n\t\t\t\treturn Promise.all(promises);\r\n\t\t\t};\r\n\r\n\t\t\t// 闪烁效果\r\n\t\t\tconst sceneTwinkle = (duration, delay, color) => {\r\n\t\t\t\tthis.sceneProxy.twinkleTimer = Utils.timeout(delay || 0);\r\n                return this.sceneProxy.twinkleTimer.then(() => {\r\n                    const twinkle = this.viewComponent.game.add.graphics(0, 0);\r\n                    twinkle.beginFill(Utils.fixColorValue(color).replace('#', '0x'));\r\n                    twinkle.moveTo(0, 0);\r\n                    twinkle.lineTo(this.viewComponent.game.world.width, 0);\r\n                    twinkle.lineTo(this.viewComponent.game.world.width, this.viewComponent.game.world.height);\r\n                    twinkle.lineTo(0, this.viewComponent.game.world.height);\r\n                    twinkle.lineTo(0, 0);\r\n                    twinkle.endFill();\r\n                    twinkle.name = 'twinkle';\r\n                    this.sceneProxy.twinkleTimer = null;\r\n                    return this.tweenToPromise(twinkle, {alpha: 0}, duration, null, true, 0).then(() => twinkle.destroy());\r\n\t\t\t\t})\r\n\t\t\t};\r\n\r\n\t\t\t// 淡入效果\r\n\t\t\tconst fadeIn = (duration, delay) => {\r\n\t\t\t\tif (bkSprite) {\r\n\t\t\t\t\treturn this.tweenFromPromise(bkSprite, {alpha: 0}, duration, null, true, delay);\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t};\r\n\r\n\t\t\t// 展示特效\r\n\t\t\tconst playEffect = animations => {\r\n\t\t\t\tconst promises = [];\r\n\t\t\t\tanimations.forEach(animation => {\r\n\t\t\t\t\tconst delay = this.sceneProxy.quickPlay ? 0 : animation.delay;\r\n\t\t\t\t\tconst duration = this.sceneProxy.quickPlay ? 100 : animation.duration;\r\n\t\t\t\t\tif (animation.type === 'twinkle') {\r\n\t\t\t\t\t\tpromises.push(sceneTwinkle(duration, delay, animation.color));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (animation.type === 'shake') {\r\n                        duration && promises.push(sceneShake(animation.level ? animation.level * 5 : 18, duration, delay));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (animation.type === 'fadein') {\r\n\t\t\t\t\t\tpromises.push(fadeIn(duration, delay).then(() => this.sceneProxy.doInCT(context, () => {\r\n\t\t\t\t\t\t\tthis.sceneProxy.lstPlotLayer && this.sceneProxy.lstPlotLayer.destroy();\r\n\t\t\t\t\t\t\tthis.sceneProxy.lstPlotLayer = null;\r\n\t\t\t\t\t\t\tthis.sceneProxy.lstPlotLayer = this.sceneProxy.curPlotLayer;\r\n\t\t\t\t\t\t})));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn Promise.all(promises)\r\n\t\t\t};\r\n\r\n\t\t\t// 添加对话框\r\n\t\t\tconst addDialogLayer = (dialogInfo) => {\r\n\t\t\t\tconst {dialogLayer} = this.sceneProxy;\r\n\t\t\t\t// 对话框\r\n\t\t\t\tthis.addDialogLayer();\r\n\t\t\t\tconst {avatarContainer, titleContainer, content} = this.sceneProxy.json_data.template.json.dialog;\r\n\t\t\t\tconst dialog_bk = dialogLayer.getByName('dialog_bk');\r\n\t\t\t\tconst dialog_bk_avatar = dialogLayer.getByName('dialog_bk_avatar');\r\n\t\t\t\tconst dialog_avatar = dialogLayer.getByName('dialog_avatar');\r\n\t\t\t\tconst dialog_bk_title = dialogLayer.getByName('dialog_bk_title');\r\n\t\t\t\ttitleTxt = dialogLayer.getByName('dialog_text_title');\r\n\t\t\t\tcontentTxt = dialogLayer.getByName('dialog_text_content');\r\n\r\n\t\t\t\tif (dialog_bk) {\r\n\t\t\t\t\tdialog_bk.visible = !dialogInfo.speaking.hidden;\r\n\t\t\t\t}\r\n\t\t\t\tif (dialog_bk_avatar) {\r\n\t\t\t\t\tdialog_bk_avatar.visible = !dialogInfo.avatar.hidden;\r\n\t\t\t\t}\r\n\t\t\t\tif (dialog_bk_title) {\r\n\t\t\t\t\tdialog_bk_title.visible = !dialogInfo.dialogtitle.hidden;\r\n\t\t\t\t}\r\n\t\t\t\tdialog_avatar.visible = !dialogInfo.avatar.hidden;\r\n\t\t\t\ttitleTxt.visible = !dialogInfo.dialogtitle.hidden;\r\n\r\n\t\t\t\tthis.sceneProxy.dialogLayer.x = dialogInfo.speaking.x;\r\n\t\t\t\tthis.sceneProxy.dialogLayer.y = dialogInfo.speaking.y;\r\n\t\t\t\tthis.sceneProxy.dialogLayer.alpha = undefined === dialogInfo.speaking.opacity ? 1 : dialogInfo.speaking.opacity;\r\n\r\n\t\t\t\tif (this.viewComponent.game.load.cache.checkImageKey(dialogInfo.avatar.url)) {\r\n\t\t\t\t\tlet {x, y, width, height, clip} = avatarContainer.avatar;\r\n\t\t\t\t\tx = x + avatarContainer.rect.x;\r\n\t\t\t\t\ty = y + avatarContainer.rect.y;\r\n\r\n\t\t\t\t\tdialog_avatar.loadTexture(dialogInfo.avatar.url);\r\n\t\t\t\t\t//dialog_avatar.width = width;\r\n\t\t\t\t\t//dialog_avatar.height = height;\r\n\r\n                    const scale = Math.min(width * dialog_avatar.scale.x / dialog_avatar.width, height * dialog_avatar.scale.y / dialog_avatar.height);\r\n                    width = dialog_avatar.width / dialog_avatar.scale.x * scale;\r\n                    height = dialog_avatar.height / dialog_avatar.scale.y * scale;\r\n                    x = avatarContainer.avatar.x + avatarContainer.rect.x + (avatarContainer.avatar.width - width) / 2;\r\n                    y = avatarContainer.avatar.y + avatarContainer.rect.y + (avatarContainer.avatar.height - height) / 2;\r\n                    dialog_avatar.x = x;\r\n                    dialog_avatar.y = y;\r\n                    dialog_avatar.width = width;\r\n                    dialog_avatar.height = height;\r\n\r\n\t\t\t\t\tdialog_avatar.mask && dialog_avatar.mask.destroy();\r\n\t\t\t\t\tconst mask = this.viewComponent.game.add.graphics(0, 0);\r\n\t\t\t\t\tmask.beginFill();\r\n\t\t\t\t\tswitch (clip) {\r\n\t\t\t\t\t\tcase 'square':\r\n\t\t\t\t\t\t\tmask.drawRect(x, y, width, height);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'hexagon':\r\n\t\t\t\t\t\t\tconst poly = new Phaser.Polygon();\r\n\t\t\t\t\t\t\tpoly.setTo([new Phaser.Point(width / 2 + x, y),\r\n\t\t\t\t\t\t\t\tnew Phaser.Point(width / 2 + height / 4 * Math.pow(3, 1 / 2) + x, height / 4 + y),\r\n\t\t\t\t\t\t\t\tnew Phaser.Point(width / 2 + height / 4 * Math.pow(3, 1 / 2) + x, height / 4 * 3 + y),\r\n\t\t\t\t\t\t\t\tnew Phaser.Point(width / 2 + x, height + y),\r\n\t\t\t\t\t\t\t\tnew Phaser.Point(width / 2 - height / 4 * Math.pow(3, 1 / 2) + x, height / 4 * 3 + y),\r\n\t\t\t\t\t\t\t\tnew Phaser.Point(width / 2 - height / 4 * Math.pow(3, 1 / 2) + x, height / 4 + y)]);\r\n\t\t\t\t\t\t\tmask.drawPolygon(poly.points);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'heart':\r\n\t\t\t\t\t\t\tmask.moveTo(width / 2 + x, width / 4 + y);\r\n\t\t\t\t\t\t\tmask.bezierCurveTo(width * 3 / 4 + x, -width / 4 + y, width * 3 / 2 + x, width / 4 + y, width / 2 + x, width + y);\r\n\t\t\t\t\t\t\tmask.bezierCurveTo(-width / 2 + x, width / 4 + y, width / 4 + x, -width / 4 + y, width / 2 + x, width / 4 + y);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'round':\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tmask.drawCircle(x + width / 2, y + height / 2, width);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmask.endFill();\r\n\t\t\t\t\tthis.sceneProxy.dialogLayer.add(mask);\r\n\t\t\t\t\tdialog_avatar.mask = mask;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst {font_size, color, bold, fontFamily, hidden} = dialogInfo.dialogtitle;\r\n\t\t\t\tconst titleStyle = titleContainer.title.text;\r\n\t\t\t\tfont_size && (titleStyle.fontSize = font_size);\r\n\t\t\t\tcolor && (titleStyle.color = color);\r\n\t\t\t\tbold !== undefined && (titleStyle.fontWeight = bold ? 'bold' : 'normal');\r\n                fontFamily ? titleStyle.fontFamily = fontFamily : this.sceneProxy.json_data.font ? titleStyle.fontFamily = this.sceneProxy.json_data.font.fontFamily : '';\r\n\t\t\t\thidden !== undefined && (titleStyle.hidden = hidden);\r\n\r\n\t\t\t\tlet ff = '';\r\n\t\t\t\tif (FontUtils.fontFamily) {\r\n\t\t\t\t    let txtImg = titleTxt.children[0];\r\n\t\t\t\t    let strText = Expression.parseValue(dialogInfo.dialogtitle.data, context);\r\n                    (color === '#ffffff' || color === '#fff') && (titleStyle.color = '#fefefe');\r\n                    if (txtImg) {\r\n                        txtImg.fontImg.destroy();\r\n                        txtImg.destroy();\r\n                    }\r\n                    txtImg = this.sceneProxy.addRetroText();\r\n                    titleTxt.addChild(txtImg);\r\n                    txtImg.fontImg.setText(strText ? strText : ' ', true, 0, 0, 'left', true);\r\n                    txtImg.tint = parseInt(titleStyle.color.replace('#', '0x'));\r\n                    const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(titleStyle.fontSize) : titleStyle.fontSize;\r\n                    const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(titleStyle.fontSize) : titleStyle.fontSize;\r\n\t\t\t\t    txtImg.width = fw * txtImg.fontImg.text.length;\r\n\t\t\t\t    txtImg.height = fh;\r\n\r\n                    const titleX = titleContainer.rect.x + titleContainer.title.rect.x + (titleContainer.title.rect.width - txtImg.width) / 2;\r\n                    const titleY = titleContainer.rect.y + titleContainer.title.rect.y;\r\n                    titleTxt.setTextBounds(titleX, titleY, titleContainer.title.rect.width, titleContainer.title.rect.height);\r\n                    titleTxt.text = ' ';\r\n                }\r\n                else {\r\n                    ff += titleStyle.fontWeight ? titleStyle.fontWeight + ' ' : 'normal ';\r\n                    ff += titleStyle.fontSize ? parseInt(titleStyle.fontSize) + 'px ' : '';\r\n                    ff += titleStyle.fontFamily ? titleStyle.fontFamily : '';\r\n\r\n                    titleTxt.setStyle({\r\n                        font: ff,\r\n                        fill: titleStyle.color,\r\n                        boundsAlignH: \"center\",\r\n                        boundsAlignV: \"middle\"\r\n                    });\r\n                    titleTxt.text = Expression.parseValue(dialogInfo.dialogtitle.data, context);\r\n\r\n                    const titleX = titleContainer.rect.x + titleContainer.title.rect.x;\r\n                    const titleY = titleContainer.rect.y + titleContainer.title.rect.y;\r\n                    titleTxt.setTextBounds(titleX\r\n                        , titleY + (titleTxt.height - parseInt(titleStyle.fontSize || 12)) / 2\r\n                        , titleContainer.title.rect.width\r\n                        , titleContainer.title.rect.height);\r\n\t\t\t\t}\r\n\r\n                ff = dialogInfo.speaking.font_size + '';\r\n\t\t\t\tif (ff.indexOf('px') < 0) {\r\n\t\t\t\t\tff = ff + 'px';\r\n\t\t\t\t}\r\n                if (dialogInfo.speaking.bold === true) {\r\n                    ff = 'bold ' + ff;\r\n                }\r\n\t\t\t\tff = ff + ' ' + (this.sceneProxy.json_data.font ? this.sceneProxy.json_data.font.fontFamily : dialogInfo.speaking.fontFamily ? dialogInfo.speaking.fontFamily : '');\r\n\t\t\t\tcontentTxt.style.font = ff;\r\n\t\t\t\tcontentTxt.style.fill = dialogInfo.speaking.color;\r\n\t\t\t\tcontentTxt.text = '';\r\n\t\t\t\tcontentTxt.top = content.rect.y;\r\n\t\t\t\tcontentTxt.lineSpacing = this.sceneProxy.txtLineSpace(dialogInfo.speaking.font_size);//- parseInt(plot.speaking.font_size) / 5;\r\n\r\n\t\t\t\tcontentTxt.mask && contentTxt.mask.destroy();\r\n\t\t\t\tconst mask = this.viewComponent.game.add.graphics(0, 0);\r\n\t\t\t\tmask.beginFill();\r\n\t\t\t\tmask.drawRect(content.rect.x,\r\n\t\t\t\t\tcontent.rect.y,\r\n\t\t\t\t\tcontent.rect.width,\r\n                    dialogInfo.speaking.hidden ? this.viewComponent.game.world.height : content.rect.height);\r\n\t\t\t\tmask.endFill();\r\n\t\t\t\tthis.sceneProxy.dialogLayer.add(mask);\r\n\t\t\t\tcontentTxt.mask = mask;\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t};\r\n\r\n\t\t\t// 剧情音效\r\n\t\t\tconst playPlotSound = () => {\r\n\t\t\t\tlet sounds = plot.plot_sound;\r\n\t\t\t\tif (loadData) {\r\n                    sounds = loadData.sounds;\r\n\t\t\t\t}\r\n\t\t\t\tif (Object.prototype.toString.call(sounds) === '[object Array]') {\r\n\t\t\t\t\tfor (let item in sounds) {\r\n\t\t\t\t\t\tif (sounds[item]) {\r\n\t\t\t\t\t\t\tif (sounds[item].url === 'inherit') {\r\n\t\t\t\t\t\t\t\tthis.sceneProxy.playInheritSound(item, sounds[item].volume);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (this.viewComponent.game.load.cache.checkSoundKey(sounds[item].url)\r\n                                    || 'ios' === flashvars.client && flashvars.app_version >= '1.5.0') {\r\n\t\t\t\t\t\t\t\tthis.sceneProxy.stopSound(item, sounds[item].url);\r\n\t\t\t\t\t\t\t\tthis.sceneProxy.playSound(item, sounds[item].url, sounds[item].volume, sounds[item].time === 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tthis.sceneProxy.stopSound(item);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.viewComponent.game.load.cache.checkSoundKey(plot.plot_sound.url)\r\n                        || 'ios' === flashvars.client && flashvars.app_version >= '1.5.0') {\r\n\t\t\t\t\tthis.sceneProxy.playSound(0, plot.plot_sound.url, plot.plot_sound.volume, false);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// music\r\n\t\t\tconst playMusic = (music) => {\r\n\t\t\t\tif (!music.url || music.url === '') {\r\n\t\t\t\t\tthis.sceneProxy.stopMusic();\r\n\t\t\t\t}\r\n\t\t\t\telse if (music.url === 'inherit') {\r\n\t\t\t\t\tthis.sceneProxy.playInheritMusic(music.volume);\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.viewComponent.game.load.cache.checkSoundKey(music.url)\r\n                        || 'ios' === flashvars.client && flashvars.app_version >= '1.5.0') {\r\n\t\t\t\t\tthis.sceneProxy.stopMusic(music.url);\r\n\t\t\t\t\tthis.sceneProxy.playMusic(music.url, music.volume, music.time !== 1);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// 背景\r\n\t\t\tconst addBackground = (plotLayer) => {\r\n\t\t\t\t// 填充黑色背景\r\n\t\t\t\tbkSprite = this.viewComponent.game.add.graphics(0, 0, plotLayer);\r\n\t\t\t\tbkSprite.beginFill(0x0, 1);\r\n\t\t\t\tbkSprite.drawRect(0, 0, this.viewComponent.game.world.width, this.viewComponent.game.world.height);\r\n\t\t\t\tbkSprite.endFill();\r\n\r\n                if (plot.commands) {return;}\r\n\r\n                if (this.sceneProxy.lstGameBk && this.sceneProxy.lstGameBk.visible) {\r\n                    !plot.animations.filter(a => a.type === 'fadein').length && (this.sceneProxy.lstGameBk.visible = false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst isInherit = plot.background.url === 'inherit';\r\n\t\t\t\tlet bk_alpha = isInherit ? this.sceneProxy.lstPlotBkOpacity : plot.background.opacity;\r\n                let bk_flex = isInherit ? this.sceneProxy.lstPlotBkFlex : plot.background.flex;\r\n\t\t\t\tlet bk_key = isInherit ? this.sceneProxy.lstPlotBkKey : plot.background.url;\r\n\t\t\t\tResourcesManager.delRefTypeCount('img', ResourcesManager.usingKeyMap.background);\r\n\t\t\t\tResourcesManager.usingKeyMap.background = isInherit? ResourcesManager.usingKeyMap.background: bk_key;\r\n                if (!!bk_key) {\r\n                    this.sceneProxy.lstPlotBkKey = bk_key;\r\n                    this.sceneProxy.lstPlotBkOpacity = bk_alpha;\r\n                    this.sceneProxy.lstPlotBkFlex = bk_flex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.viewComponent.game.load.cache.checkImageKey(bk_key)) {\r\n                \tbkSprite.alpha = 0;\r\n                    bkSprite = plotLayer.create(plot.background.x, plot.background.y, bk_key);\r\n                    bkSprite.alpha = bk_alpha === undefined ? 1 : bk_alpha;\r\n\t\t\t\t\tthis.backgroundFlex(bkSprite, bk_flex);\r\n                    this.viewComponent.addGifAnimation(bkSprite, bk_key);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// 角色 & 道具\r\n\t\t\tconst addCharsProps = (characters, props, cmdUuid) => {\r\n\t\t\t\t/*if (!this.sceneProxy.charsAndPropsLayer || !this.sceneProxy.charsAndPropsLayer.exists) {\r\n                    this.sceneProxy.charsAndPropsLayer = this.viewComponent.game.add.group();\r\n                    this.sceneProxy.charsAndPropsLayer.name = \"charactersAndProps\";\r\n                }*/\r\n\t\t\t\tfor (let item of [...characters, ...props]) {\r\n\t\t\t\t\tconst ch = this.viewComponent.addFitImageSprint(item.x, item.y, item.width, item.height, item.url, this.sceneProxy.charsAndPropsLayer, item.index);\r\n\t\t\t\t\tch.alpha = item.opacity === undefined ? 1 : item.opacity;\r\n\t\t\t\t\tch.angle = parseInt(item.rotate) === 180 ? 179.9 : item.rotate || 0;\r\n\t\t\t\t\tch.data.animations = item.animations;\r\n\t\t\t\t\tch.cmdUuid = cmdUuid;\r\n\t\t\t\t\tthis.viewComponent.addGifAnimation(ch, item.url);\r\n\r\n\t\t\t\t\tif (item.mirrorH) {\r\n\t\t\t\t\t\tch.angle = -ch.angle;\r\n\t\t\t\t\t\tch.scale.x = -ch.scale.x;\r\n\t\t\t\t\t\tch.mirrorH = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (item.mirrorV) {\r\n\t\t\t\t\t\tch.angle = -ch.angle;\r\n\t\t\t\t\t\tch.scale.y = -ch.scale.y;\r\n\t\t\t\t\t\tch.mirrorV = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.viewComponent.game.world.bringToTop(this.sceneProxy.charsAndPropsLayer);\r\n\t\t\t\t//如果天气存在，天气置顶\r\n                if(this.sceneProxy.weatherLayer.visible){this.viewComponent.game.world.bringToTop(this.sceneProxy.weatherLayer)};\r\n\t\t\t};\r\n\r\n\t\t\tconst cApAnimationIn = () => {\r\n\t\t\t\tconst promises = [];\r\n\t\t\t\tfor (let item of this.sceneProxy.charsAndPropsLayer.children) {\r\n\t\t\t\t\tfor (let a of item.data.animations) {\r\n\t\t\t\t\t\tif ((a.trigger === 'in' || a.trigger === 'animateIn') && !this.sceneProxy.quickPlay) {\r\n\t\t\t\t\t\t\tif (a.type === 'fadein') {\r\n\t\t\t\t\t\t\t\tpromises.push(this.tweenFromPromise(item, {alpha: 0}\r\n\t\t\t\t\t\t\t\t\t, a.duration\r\n\t\t\t\t\t\t\t\t\t, null, true\r\n\t\t\t\t\t\t\t\t\t, a.delay, 0, false))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (a.type === 'moveFrom') {\r\n\t\t\t\t\t\t\t\tlet x = item.mirrorH ? a.x - item.width/2 : a.x + item.width/2;\r\n\t\t\t\t\t\t\t\tlet y = item.mirrorV ? a.y - item.height/2 : a.y + item.height/2;\r\n\t\t\t\t\t\t\t\tpromises.push(this.tweenFromPromise(item, {x: x, y: y}\r\n\t\t\t\t\t\t\t\t\t, a.duration\r\n\t\t\t\t\t\t\t\t\t, null, true\r\n\t\t\t\t\t\t\t\t\t, a.delay, 0, false))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.all(promises);\r\n\t\t\t};\r\n\r\n\t\t\t// 选项\r\n\t\t\tconst addOptions = (txtOptions, condition_options) => {\r\n\t\t\t\tlet hasOption = false;\r\n\r\n                return new Promise((resolve, reject) => {\r\n\t\t\t\t\tif (plot.jump || plot.back || plot.insert) {\r\n\t\t\t\t\t\treturn resolve({type: 0})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst condOptIndex = (condition_options || []).findIndex(option => Expression.safeEval(option.expression, context));\r\n\t\t\t\t\tconst condOpt = condOptIndex < 0 ? null : condition_options[condOptIndex];\r\n\t\t\t\t\tif (condOpt) {\r\n\t\t\t\t\t\treturn resolve({type: 2})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet timerHandles = [];\r\n\t\t\t\t\tconst countDownPromises = [];\r\n\t\t\t\t\tfor (let i = 0; i < txtOptions.length; i++) {\r\n\t\t\t\t\t\tconst {rect, normal, active} = this.sceneProxy.json_data.template.json.option;\r\n\t\t\t\t\t\tlet {x, y, width, height} = rect;\r\n\t\t\t\t\t\tlet normal_bk_key = normal.background.url;\r\n\t\t\t\t\t\tlet active_bk_key = active.background.url;\r\n\t\t\t\t\t\tlet disable_bk_key = null;\r\n\t\t\t\t\t\tconst {font, timer, disable} = txtOptions[i];\r\n\r\n\t\t\t\t\t\tif (txtOptions[i].x !== undefined) {\r\n\t\t\t\t\t\t\tx = txtOptions[i].x;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (txtOptions[i].y !== undefined) {\r\n\t\t\t\t\t\t\ty = txtOptions[i].y;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (txtOptions[i].width !== undefined && txtOptions[i].hasOwnProperty(\"background\")) {\r\n\t\t\t\t\t\t\twidth = txtOptions[i].width;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (txtOptions[i].height !== undefined && txtOptions[i].hasOwnProperty(\"background\")) {\r\n\t\t\t\t\t\t\theight = txtOptions[i].height;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (txtOptions[i].background\r\n\t\t\t\t\t\t\t&& this.viewComponent.game.load.cache.checkImageKey(txtOptions[i].background.normal.url)) {\r\n\t\t\t\t\t\t\tnormal_bk_key = txtOptions[i].background.normal.url;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (txtOptions[i].background\r\n\t\t\t\t\t\t\t&& this.viewComponent.game.load.cache.checkImageKey(txtOptions[i].background.active.url)) {\r\n\t\t\t\t\t\t\tactive_bk_key = txtOptions[i].background.active.url;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (txtOptions[i].background && txtOptions[i].background.disable\r\n\t\t\t\t\t\t\t&& this.viewComponent.game.load.cache.checkImageKey(txtOptions[i].background.disable.url)) {\r\n\t\t\t\t\t\t\tdisable_bk_key = txtOptions[i].background.disable.url;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst onBtnClicked = (obj, pointer) => {\r\n\t\t\t\t\t\t\tfor (let t of timerHandles) {\r\n\t\t\t\t\t\t\t\tt.close();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (obj.chapter.plots.length > 0) {\r\n\t\t\t\t\t\t\t\tresolve({type: 1, index: i});\r\n                                this.sceneProxy.optionLayer.destroy();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tresolve({type: 3});\r\n                                this.sceneProxy.optionLayer.destroy();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tUtils.selOptions.push(txtOptions[i].uuid);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tconst textInfo = {\r\n\t\t\t\t\t\t\tfontFamily: font.normal.fontFamily ? font.normal.fontFamily : this.sceneProxy.json_data.font ? this.sceneProxy.json_data.font.fontFamily : ''\r\n\t\t\t\t\t\t\t, fontSize: font.normal.font_size\r\n\t\t\t\t\t\t\t, fontWeight: font.normal.bold ? 'bold' : 'normal'\r\n\t\t\t\t\t\t\t, color: font.normal.color\r\n\t\t\t\t\t\t\t, hidden: font.normal.hidden\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tconst disabledTextInfo = {\r\n\t\t\t\t\t\t\tfontFamily: font.disable.fontFamily ? font.disable.fontFamily : this.sceneProxy.json_data.font ? this.sceneProxy.json_data.font.fontFamily : ''\r\n\t\t\t\t\t\t\t, fontSize: font.disable.font_size\r\n\t\t\t\t\t\t\t, fontWeight: font.disable.bold ? 'bold' : 'normal'\r\n\t\t\t\t\t\t\t, color: font.disable.color\r\n\t\t\t\t\t\t\t, hidden: font.disable.hidden\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tconst t = {};\r\n\t\t\t\t\t\tt.normal = textInfo;\r\n\t\t\t\t\t\tt.active = textInfo;\r\n\t\t\t\t\t\tt.text = txtOptions[i].name;\r\n\t\t\t\t\t\tlet op_sound;\r\n\t\t\t\t\t\tif (txtOptions[i].sound && this.viewComponent.game.load.cache.checkSoundKey(txtOptions[i].sound.url)) {\r\n\t\t\t\t\t\t\top_sound = this.viewComponent.game.add.sound(txtOptions[i].sound.url, txtOptions[i].sound.volume, false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst btng = this.viewComponent.addButton(x,\r\n\t\t\t\t\t\t\ty,\r\n\t\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\t\theight,\r\n\t\t\t\t\t\t\tnormal_bk_key,\r\n\t\t\t\t\t\t\tactive_bk_key,\r\n\t\t\t\t\t\t\tonBtnClicked,\r\n\t\t\t\t\t\t\tt,\r\n\t\t\t\t\t\t\top_sound,\r\n\t\t\t\t\t\t\t'option',\r\n                            this.sceneProxy.optionLayer\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tconst btn = btng.getByName('button');\r\n\t\t\t\t\t\tconst txtObj = btng.getByName('text');\r\n\t\t\t\t\t\tbtn.chapter = {plots: txtOptions[i].plots ? txtOptions[i].plots : txtOptions[i].commands, parent: {pChapter: chapter, pnPlot: nPlot}};\r\n\r\n\t\t\t\t\t\tif (disable) {\r\n\t\t\t\t\t\t\tbtn.inputEnabled = false;\r\n\t\t\t\t\t\t\tbtng.changeBackground(disable_bk_key || normal_bk_key, disabledTextInfo);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (timer) {\r\n\t\t\t\t\t\t\tconst countDown = () => {\r\n\t\t\t\t\t\t\t\treturn new Promise((resolve, reject) => {\r\n                                    let time = Expression.getGameValueByTimer(timer, context);\r\n\t\t\t\t\t\t\t\t\tif (!txtOptions[i].hideTimer) {\r\n                                        txtObj.text = txtOptions[i].name + `(${time})`;\r\n                                        if (FontUtils.fontFamily) {\r\n                                            const txtImgOld = txtObj.children[0];\r\n                                            if (txtImgOld) {\r\n                                                const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(textInfo.fontSize) : textInfo.fontSize;\r\n                                                const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(textInfo.fontSize) : textInfo.fontSize;\r\n                                                const w = fw * txtObj.text.length;\r\n                                                const x = (width - w) / 2;\r\n                                                const y = (height - fh) / 2;\r\n                                                this.sceneProxy.addImageFontText([{data: txtObj.text}], fw, fh, txtObj, context);\r\n                                                txtObj.children[0].x = x;\r\n                                                txtObj.children[0].y = y;\r\n                                                txtImgOld.children.forEach(item => item.fontImg.destroy());\r\n                                                txtImgOld.destroy();\r\n                                                txtObj.text = ' ';\r\n                                            }\r\n                                        }\r\n                                        else {\r\n                                        }\r\n\t\t\t\t\t\t\t\t\t}\r\n                                    const timerHandle = this.viewComponent.game.time.events.loop(Phaser.Timer.SECOND, () => {\r\n                                        time--;\r\n                                        if (!txtOptions[i].hideTimer) {\r\n                                            txtObj.text = txtOptions[i].name + `(${time})`;\r\n                                            if (FontUtils.fontFamily) {\r\n                                                const txtImgOld = txtObj.children[0];\r\n                                                if (txtImgOld) {\r\n                                                    const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(textInfo.fontSize) : textInfo.fontSize;\r\n                                                    const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(textInfo.fontSize) : textInfo.fontSize;\r\n                                                    const w = fw * txtObj.text.length;\r\n                                                    const x = (width - w) / 2;\r\n                                                    const y = (height - fh) / 2;\r\n                                                    this.sceneProxy.addImageFontText([{data: txtObj.text}], fw, fh, txtObj, context);\r\n                                                    txtObj.children[0].x = x;\r\n                                                    txtObj.children[0].y = y;\r\n                                                    txtImgOld.children.forEach(item => item.fontImg.destroy());\r\n                                                    txtImgOld.destroy();\r\n                                                    txtObj.text = ' ';\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                        if (time <= 0) {\r\n                                            txtObj.text = txtOptions[i].name;\r\n                                            if (FontUtils.fontFamily) {\r\n                                                const txtImgOld = txtObj.children[0];\r\n                                                if (txtImgOld) {\r\n                                                    const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(textInfo.fontSize) : textInfo.fontSize;\r\n                                                    const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(textInfo.fontSize) : textInfo.fontSize;\r\n                                                    const w = fw * txtObj.text.length;\r\n                                                    const x = (width - w) / 2;\r\n                                                    const y = (height - fh) / 2;\r\n                                                    this.sceneProxy.addImageFontText([{data: txtObj.text}], fw, fh, txtObj, context);\r\n                                                    txtObj.children[0].x = x;\r\n                                                    txtObj.children[0].y = y;\r\n                                                    txtImgOld.children.forEach(item => item.fontImg.destroy());\r\n                                                    txtImgOld.destroy();\r\n                                                    txtObj.text = ' ';\r\n                                                }\r\n                                            }\r\n                                            this.viewComponent.game.time.events.remove(timerHandle);\r\n                                            if ('disable' === timer.type) {\r\n                                                if (btn.alive) {\r\n                                                    btn.inputEnabled = false;\r\n                                                    btng.changeBackground(disable_bk_key || normal_bk_key, disabledTextInfo);\r\n                                                }\r\n                                                resolve(false);\r\n                                            } else {\r\n                                                if (btn.alive) {\r\n                                                    btn.inputEnabled = true;\r\n                                                    btn.input.useHandCursor = true;\r\n                                                    btng.changeBackground(normal_bk_key, textInfo);\r\n                                                }\r\n                                                resolve(true);\r\n                                            }\r\n                                        }\r\n                                    });\r\n\t\t\t\t\t\t\t\t\tconst close = () => {\r\n                                        this.viewComponent.game.time.events.remove(timerHandle);\r\n\t\t\t\t\t\t\t\t\t\tresolve(true);\r\n                                    };\r\n                                    timerHandles.push({close});\r\n                                    this.viewComponent.game.time.events.start();\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t};\r\n                            countDownPromises.push(countDown())\r\n\t\t\t\t\t\t} else {\r\n                            countDownPromises.push(Promise.resolve(!disable))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thasOption = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!hasOption) {\r\n\t\t\t\t\t\tresolve({type: 0});\r\n                        this.sceneProxy.optionLayer.destroy();\r\n\t\t\t\t\t}\r\n                    Promise.all(countDownPromises).then(results => {\r\n                        if (!results.some(r => !!r)) {\r\n                        \tresolve({type: 3})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}).then(action => {\r\n\t\t\t\t\tResourcesManager.delByRefType('playOption');\r\n\t\t\t\t\tif (action.type === 2 && txtOptions && txtOptions.length) {\r\n\t\t\t\t\t\ttxtOptions.forEach((o, i) => ResourcesManager.delByRefType('PreloadOption' + i));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(action.index !== undefined && condition_options && condition_options){\r\n\t\t\t\t\t\ttxtOptions.forEach((o, i) => ResourcesManager.delByRefType('PreloadCondOption' + i));\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn action;\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t// 天气\r\n\t\t\tconst addWeather = (type) => {\r\n\t\t\t\tthis.sceneProxy.weatherLayer.visible = false;\r\n\r\n\t\t\t\tfor (let n=0; n<this.sceneProxy.weatherLayer.children.length; n++) {\r\n\t\t\t\t\tconst {visible, name} = this.sceneProxy.weatherLayer.children[n];\r\n\t\t\t\t\tif (visible && name !== type) {\r\n                        this.sceneProxy.weatherLayer.children[n].destroy();\r\n                        n--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n                        this.sceneProxy.weatherLayer.children[n].visible = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (type === 'windy') {\r\n\t\t\t\t\tthis.addWindEffect();\r\n\t\t\t\t}\r\n\t\t\t\telse if (type === 'snowy') {\r\n                    this.viewComponent.game.load.cache.checkImageKey('/weather/snow/xuehua_00119.png') && this.addSnowEffect();\r\n\t\t\t\t}\r\n\t\t\t\telse if (type === 'rainy') {\r\n                    this.viewComponent.game.load.cache.checkImageKey('/weather/rain/xiayu_00049.png') && this.addRainEffect();\r\n\t\t\t\t}\r\n                else if (type === 'defoliation') {\r\n                    this.viewComponent.game.load.cache.checkImageKey('/weather/mapleLeaves/fengye_00089.png') && this.addFallingLeavesEffect();\r\n                }\r\n                else if (type === 'fallingPeach') {\r\n                    this.viewComponent.game.load.cache.checkImageKey('/weather/beachBlossom/taohua_00089.png') && this.addBeachBlossomEffect();\r\n                }\r\n                else if (type === 'fallingFlower') {\r\n                    this.viewComponent.game.load.cache.checkImageKey('/weather/blossom/yinghua_00089.png') && this.addBlossomEffect();\r\n                }\r\n                else if (type === 'lightning') {\r\n                    this.viewComponent.game.load.cache.checkImageKey('/weather/lightning/shandian_00049.png') && this.addLightningEffect();\r\n\t\t\t\t}\r\n\t\t\t\tthis.viewComponent.game.world.bringToTop(this.sceneProxy.weatherLayer);\r\n\t\t\t};\r\n\r\n\t\t\t// 剧情高级UI\r\n\t\t\tconst addPlotViews = (views, loadData, cmdUuid) => {\r\n                if (loadData) {\r\n                \t// 先过滤掉已不在剧情中的UI\r\n\t\t\t\t\tfor (let i=0; i<this.sceneProxy.plotViews.length; i++) {\r\n\t\t\t\t\t\tif (this.sceneProxy.plotViews[i].generateType === 'plotInfo') {\r\n\t\t\t\t\t\t\tlet bExist = false;\r\n\t\t\t\t\t\t\tfor (let j=0; j<views.length; j++) {\r\n\t\t\t\t\t\t\t\tif (views[j].ref === this.sceneProxy.plotViews[i].name) {\r\n\t\t\t\t\t\t\t\t\tbExist = true;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!bExist) {\r\n\t\t\t\t\t\t\t\tthis.sceneProxy.plotViews.splice(i, 1);\r\n\t\t\t\t\t\t\t\ti--;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n                    loadSubViews(this.sceneProxy.plotViews);\r\n                    this.sceneProxy.uiOnLoadQueue.splice(0);\r\n                    this.viewComponent.game.world.bringToTop(this.sceneProxy.plotViewsLayer);\r\n                    this.sceneProxy.plotViewsLayer.visible = false;\r\n                    return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let p in views) {\r\n\t\t\t\t\tthis.registerViewKey(views[p].ref, views[p].events, this.sceneProxy.plotViewKeys);\r\n\t\t\t\t\tlet sView = this.addView(this.sceneProxy.plotViewsLayer, views[p].ref, views[p].instanceUuid, views[p].x, views[p].y, views[p].events);\r\n\t\t\t\t\tif (!sView) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (views[p].scale) {\r\n\t\t\t\t\t\tsView.scale.set(views[p].scale, views[p].scale);\r\n\t\t\t\t\t\tsView.x += Expression.safeEval(views[p].x, context) * (1 - views[p].scale);\r\n\t\t\t\t\t\tsView.y += Expression.safeEval(views[p].y, context) * (1 - views[p].scale);\r\n\t\t\t\t\t\tthis.scaleInputView(sView, views[p].scale);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsView.generateType = cmdUuid ? cmdUuid : 'plotInfo';\t// 保存生成UI方式为剧情脚本\r\n                    this.sceneProxy.plotViews.push(sView);\r\n\t\t\t\t}\r\n\r\n                this.viewComponent.game.world.bringToTop(this.sceneProxy.plotViewsLayer);\r\n                this.uiOnLoadInvoker();\r\n\t\t\t\tthis.updateProgressView();\r\n                this.sceneProxy.plotViewsLayer.visible = false;\r\n            };\r\n\r\n\t\t\t// 全局高级UI\r\n\t\t\tconst showGlobalViews = (bLoadRec, hideGlobalViews) => {\r\n                let refUuidToHide = [];\r\n\t\t\t\tfor (let p in hideGlobalViews) {\r\n\t\t\t\t\tfor (let q in this.sceneProxy.json_data.views) {\r\n\t\t\t\t\t\tif (hideGlobalViews[p] === this.sceneProxy.json_data.views[q].instanceUuid) {\r\n\t\t\t\t\t\t\trefUuidToHide[this.sceneProxy.json_data.views[q].ref] = (this.sceneProxy.json_data.views[q].ref);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n                if (bLoadRec && this.sceneProxy.globalViews) {\r\n\t\t\t\t\tlet i=0, j=0;\r\n\t\t\t\t\tfor (; i<this.sceneProxy.globalViews.length; i++) {\r\n\t\t\t\t\t\tfor (; j<this.sceneProxy.json_data.views.length; j++) {\r\n\t\t\t\t\t\t\tif (this.sceneProxy.json_data.views[j].instanceUuid === this.sceneProxy.globalViews[i].instanceUuid) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (j >= this.sceneProxy.json_data.views.length) {\r\n\t\t\t\t\t\t\tthis.sceneProxy.globalViews.splice(i--, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n                    loadSubViews(this.sceneProxy.globalViews);\r\n\r\n                    for (let p in this.sceneProxy.globalViews) {\r\n                    \tthis.viewComponent.game.world.bringToTop(this.sceneProxy.globalViews[p]);\r\n                        if (refUuidToHide[this.sceneProxy.globalViews[p].name]) {\r\n                            this.sceneProxy.globalViews[p].visible = false;\r\n                            this.showInputView(this.sceneProxy.globalViews[p], false);\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    this.addGlobalView(refUuidToHide);\r\n                }\r\n                this.viewComponent.game.world.bringToTop(this.sceneProxy.menuLayer);\r\n\t\t\t};\r\n\r\n\t\t\t// 读档子UI\r\n\t\t\tconst loadSubViews = (savedSubView) => {\r\n\t\t\t\tthis.sceneProxy.timerCounts = [];\t// 清空\r\n\t\t\t\tconst fixTimerCount = (items) => {\r\n\t\t\t\t\tfor (let i=0; i<items.length; i++) {\r\n\t\t\t\t\t\tconst item = items[i];\r\n\t\t\t\t\t\tif (item.currentCount) {\r\n\t\t\t\t\t\t\tthis.sceneProxy.timerCounts[this.sceneProxy.timerCounts.length] = {name: item.name, parent: item.parent, currentCount:item.currentCount};\r\n\t\t\t\t\t\t}\r\n                        fixTimerCount(item.children);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tconst fixViewEventsInfo = (items) => {\r\n\t\t\t\t\t// 还原外部事件\r\n\t\t\t\t\tfor (let i=0; i<items.length; i++) {\r\n\t\t\t\t\t\tif (items[i].eventsInfo) {\r\n\t\t\t\t\t\t\t// 若已有信息，说明是从h5中读取的存档，不需要再获取外部事件\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (let j=0; j<plot.views.length; j++) {\r\n\t\t\t\t\t\t\tif (plot.views[j].ref === items[i].name) {\r\n\t\t\t\t\t\t\t\titems[i].eventsInfo = plot.views[j].events.concat();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tfixTimerCount(savedSubView);\r\n\t\t\t\t!plot.commands && fixViewEventsInfo(savedSubView);\r\n\t\t\t\tfor (let i=0; i<savedSubView.length; i++) {\r\n\t\t\t\t\tconst item = savedSubView[i];\r\n\t\t\t\t\tconst parent = item.parent === '__world' ? null : this.viewComponent.game.world.getByName(item.parent);\r\n\t\t\t\t\tconst view = this.addView(parent, item.name, item.instanceUuid, item.xInfo, item.yInfo, item.eventsInfo);\r\n\r\n\t\t\t\t\tconst createSubView = (itemInfo, parentView) => {\r\n\t\t\t\t\t\tlet tempRefer = parentView.children.concat();\r\n\t\t\t\t\t\tfor (let i=0; i<itemInfo.children.length; i++) {\r\n\t\t\t\t\t\t\tlet bExist = false;\r\n\t\t\t\t\t\t\tfor (let j=0; j<tempRefer.length; j++) {\r\n\t\t\t\t\t\t\t\tif (itemInfo.children[i].name === tempRefer[j].name) {\r\n\t\t\t\t\t\t\t\t\tbExist = true;\r\n\t\t\t\t\t\t\t\t\ttempRefer.splice(j, 1);\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (bExist) {\tcontinue;\t}\r\n\t\t\t\t\t\t\tconst subView = this.addView(parentView, itemInfo.children[i].name, itemInfo.children[i].instanceUuid\r\n\t\t\t\t\t\t\t\t, itemInfo.children[i].xInfo, itemInfo.children[i].yInfo, itemInfo.children[i].eventsInfo);\r\n                            if (parentView.xInfo && parentView.yInfo) {\r\n                                subView.x += this.sceneProxy.Expression.safeEval(parentView.xInfo, this.sceneProxy.context);\r\n                                subView.y += this.sceneProxy.Expression.safeEval(parentView.yInfo, this.sceneProxy.context);\r\n                            }\r\n\t\t\t\t\t\t\tcreateSubView(itemInfo.children[i], subView);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (!view) {\r\n                        savedSubView.splice(i--, 1);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcreateSubView(item, view);\r\n                    view.scale.set(item.scale.x, item.scale.y);\r\n                    view.x = item.x;\r\n                    view.y = item.y;\r\n                    this.scaleInputView(view, item.scale.x);\r\n\r\n                    view.visible = item.visible;\r\n                    savedSubView[i] = view;\r\n\t\t\t\t\tif (parent) {\r\n\t\t\t\t\t\tparent.add(view);\r\n                    }\r\n                    else {\r\n\t\t\t\t\t\tview.isGlobal = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// 音乐淡入\r\n\t\t\tconst musicIn = () => {\r\n\t\t\t\tif (plot.music.animation && (plot.music.animation.type === 'fadeinfadeout' || plot.music.animation.type === 'fadein'))\r\n\t\t\t\t{\r\n                    if (this.sceneProxy.bk_music) {\r\n                        return this.tweenFromPromise(this.sceneProxy.bk_music, {volume:0}, this.sceneProxy.quickPlay ? 10 : 1000, null, true, 0, 0, false);\r\n                    }\r\n                    else if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n                    \treturn PhoneUtils.tweenFromMusic(0, this.sceneProxy.quickPlay ? 10 : 1000, 0);\r\n                    }\r\n                }\r\n\t\t\t\treturn Promise.resolve();\r\n\t\t\t};\r\n\r\n\t\t\t// 音乐淡出\r\n\t\t\tconst musicOut = (action) => {\r\n\t\t\t    if (plot.music.animation && (plot.music.animation.type === 'fadeinfadeout' || plot.music.animation.type === 'fadeout'))\r\n                {\r\n                    if (this.sceneProxy.bk_music) {\r\n                        return new Promise((resolve, reject) => {\r\n                            const tween = this.viewComponent.game.add.tween(this.sceneProxy.bk_music).to({volume:0}, this.sceneProxy.quickPlay ? 10 : 1000, null, true, 0, 0, false);\r\n                            tween.onComplete.add(() => resolve(action));\r\n                        })\r\n                    }\r\n                    else if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n                        return PhoneUtils.tweenToMusic(0, this.sceneProxy.quickPlay ? 10 : 1000, 0);\r\n                    }\r\n                }\r\n\r\n\t\t\t\treturn Promise.resolve(action);\r\n\t\t\t};\r\n\r\n\t\t\tconst dialogIn = (animations) => {\r\n\t\t\t\tif (!animations.length) {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tconst In = animations.filter(a => a.type === 'fadein');\r\n\t\t\t\tconst From = animations.filter(a => a.type === 'moveFrom');\r\n\r\n\t\t\t\tconst fadeIn = () => {\r\n\t\t\t\t\tif (In.length) {\r\n\t\t\t\t\t\treturn this.tweenFromPromise(this.sceneProxy.dialogLayer, {alpha:0}, In[0].duration, null, true, In[0].delay, 0, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tconst moveFrom = () => {\r\n\t\t\t\t\tif (From.length) {\r\n\t\t\t\t\t\treturn this.tweenFromPromise(this.sceneProxy.dialogLayer, {x:From[0].x, y:From[0].y}, From[0].duration, null, true, From[0].delay, 0, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn Promise.all([fadeIn(), moveFrom()]);\r\n\t\t\t};\r\n\r\n\t\t\tconst dialogOut = (animations) => {\r\n\t\t\t\tif (!animations.length) {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tconst Out = animations.filter(a => a.type === 'fadeout');\r\n\t\t\t\tconst To = animations.filter(a => a.type === 'moveTo');\r\n\r\n\t\t\t\tconst fadeOut = () => {\r\n\t\t\t\t\tif (Out.length) {\r\n\t\t\t\t\t\treturn this.tweenToPromise(this.sceneProxy.dialogLayer, {alpha:0}, Out[0].duration, null, true, Out[0].delay, 0, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tconst moveTo = () => {\r\n\t\t\t\t\tif (To.length) {\r\n\t\t\t\t\t\treturn this.tweenToPromise(this.sceneProxy.dialogLayer, {x:To[0].x, y:To[0].y}, To[0].duration, null, true, To[0].delay, 0, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn Promise.all([fadeOut(), moveTo()]);\r\n\t\t\t};\r\n\r\n\t\t\tconst animateIn = () => {\r\n\t\t\t\treturn this.sceneProxy.doInCT(context, () => playEffect(plot.animations.filter(a => a.trigger === 'in')))\r\n\t\t\t\t\t.then(() => {\r\n                        this.sceneProxy.charsAndPropsLayer && (this.sceneProxy.charsAndPropsLayer.visible = true);\r\n                        this.sceneProxy.plotViewsLayer.visible = true;\r\n\t\t\t\t\t\treturn this.sceneProxy.doInCT(context, () => Promise.all([cApAnimationIn(), playEffect(plot.animations.filter(a => a.trigger === 'animateIn'))]))\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(() => this.sceneProxy.doInCT(context, () => playEffect(plot.animations.filter(a => a.trigger === 'animateInEnd'))))\r\n\t\t\t};\r\n\r\n\t\t\tconst animateOut = action => {\r\n\t\t\t\tconst promises = [];\r\n\t\t\t\tfor (let item of this.sceneProxy.charsAndPropsLayer.children) {\r\n\t\t\t\t\tfor (let a of item.data.animations) {\r\n\t\t\t\t\t\tif ((a.trigger === 'out' || a.trigger === 'animateOut') && !this.sceneProxy.quickPlay) {\r\n\t\t\t\t\t\t\tif (a.type === 'fadeout') {\r\n\t\t\t\t\t\t\t\tpromises.push(this.tweenToPromise(item, {alpha: 0}\r\n\t\t\t\t\t\t\t\t\t, a.duration\r\n\t\t\t\t\t\t\t\t\t, null, true\r\n\t\t\t\t\t\t\t\t\t, a.delay, 0, false))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (a.type === 'moveTo') {\r\n\t\t\t\t\t\t\t    let xStep = item.scale.x < 0 ? -item.width/2 : item.width/2;\r\n\t\t\t\t\t\t\t    let yStep = item.scale.y < 0 ? -item.height/2 : item.height/2;\r\n\t\t\t\t\t\t\t\tpromises.push(this.tweenToPromise(item, {x: a.x + xStep, y: a.y + yStep}\r\n\t\t\t\t\t\t\t\t\t, a.duration\r\n\t\t\t\t\t\t\t\t\t, null, true\r\n\t\t\t\t\t\t\t\t\t, a.delay, 0, false))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn this.sceneProxy.doInCT(context, () => Promise.all(promises))\r\n\t\t\t};\r\n\r\n\t\t\tconst pauseSpeaking = remain => {\r\n\t\t\t\tif (\"\\\\\" === remain[0]) {\r\n\t\t\t\t\tlet pause = /\\\\(\\d+)\\s([\\s\\S]*)/.exec(remain);\r\n\t\t\t\t\tif (pause) {\r\n\t\t\t\t\t\treturn Utils.timeout(this.sceneProxy.quickPlay ? 0 : pause[1])\r\n\t\t\t\t\t\t\t.then(() => pauseSpeaking(remain.slice(pause[1].length + 2)));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (this.sceneProxy.playPause) {\r\n\t\t\t\t\treturn Utils.timeout(1000)\r\n\t\t\t\t\t\t.then(() => pauseSpeaking(remain));\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.resolve(remain)\r\n\t\t\t};\r\n\r\n\t\t\tconst contextScrollToBottom = (bSpeakHidden, bottom) => {\r\n\t\t\t\tconst {content} = this.sceneProxy.json_data.template.json.dialog;\r\n\t\t\t\tconst maxHeight = bSpeakHidden ? this.viewComponent.game.world.height : content.rect.height;\r\n\t\t\t\tconst n = bottom - maxHeight;\r\n\t\t\t\tif (n > 0) {\r\n\t\t\t\t\tcontentTxt.top = -n + content.rect.y;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst animationSpeak = (current, remain, context, speed, bSpeakHidden) => {\r\n                if (FontUtils.fontFamily) {\r\n                    const textShow = current;\r\n                    let nLine = 0;      // 换行符数\r\n                    current.replace(/[\\n]/g, function(m, i) {nLine++;});\r\n                    if (textShow.length && textShow.length - nLine > 0) {\r\n                        const index = textShow.length - nLine - 1;\r\n                        const mask = contentTxt.children[1];\r\n                        const posInfo = contentTxt.posInfo;\r\n                        if (posInfo[index]) {\r\n                            mask.x = posInfo[index].x + posInfo[index].space;\r\n                            mask.y = posInfo[index].y;\r\n                            contextScrollToBottom(bSpeakHidden, posInfo[index].bottomInText);\r\n                            contentTxt.setText(' ', true);\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    const textShow = this.viewComponent.game.device.desktop ? current : current.replace(new RegExp(' ', 'gm'), '  ');\r\n                    contentTxt.setText(textShow, true);\r\n                    contextScrollToBottom(bSpeakHidden, contentTxt.height);\r\n                }\r\n\t\t\t\treturn pauseSpeaking(remain)\r\n\t\t\t\t\t.then((remain) => {\r\n\t\t\t\t\t\treturn this.sceneProxy.doInCT(context, () => Utils.timeout(speed).then(() => {\r\n\t\t\t\t\t\t\tif (isShowAll) {\r\n\t\t\t\t\t\t\t\treturn Promise.reject();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (!remain) {\r\n\t\t\t\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn this.sceneProxy.doInCT(context, () => animationSpeak(current + (remain[0] ? remain[0] : ''), remain.slice(1), context, speed, bSpeakHidden))\r\n\t\t\t\t\t\t}))\r\n\t\t\t\t\t})\r\n\t\t\t};\r\n\r\n\t\t\tconst doSpeak = (speakInfo, showImmediate) => {\r\n                let data = '';\r\n                if (Expression.isArray(speakInfo.data)) {\r\n                    for (let i=0; i<speakInfo.data.length; i++) {\r\n                        data += Expression.parseValue(speakInfo.data[i].data, context);\r\n                    }\r\n                    // 设置颜色\r\n                    this.sceneProxy.addImageFontTextColors(speakInfo.data, contentTxt, context);\r\n                }\r\n                else {\r\n                    data = Expression.parseValue(speakInfo.data, context);\r\n                }\r\n                if (data.length && data[data.length-1] === '\\n') {\r\n                    data = data.substring(0, data.length-1);\r\n                }\r\n                if (FontUtils.fontFamily) {\r\n                    const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(speakInfo.font_size) : speakInfo.font_size;\r\n                    const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(speakInfo.font_size) : speakInfo.font_size;\r\n                    this.sceneProxy.addImageFontText(speakInfo.data, fw, fh, contentTxt, context, true, speakInfo.hidden);\r\n                }\r\n                if (showImmediate || speakInfo.immediate) {\r\n                    if (FontUtils.fontFamily) {\r\n                        contentTxt.children[1] && (contentTxt.children[1].y = contentTxt.imgFBottom);\r\n                        contentTxt.text = ' ';\r\n                        contextScrollToBottom(speakInfo.hidden, contentTxt.imgFBottom);\r\n                    }\r\n                    else {\r\n                        let txt = Expression.parseWaitTime(data);\r\n                        contentTxt.text = this.viewComponent.game.device.desktop ? txt : txt.replace(new RegExp(' ', 'gm'), '  ');\r\n                    }\r\n                    return Promise.resolve();\r\n                }\r\n\r\n                isShowAll = false;\r\n                const clickProxy = new Promise((resolve, reject) => {\r\n                    this.sceneProxy.curPlotLayer.onChildInputDown.add((params, pointer) => {\r\n                        if (params === 'auto' || pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n                            return;\r\n                        }\r\n                        resolve()\r\n                    });\r\n                });\r\n                const keyProxy = new Promise((resolve, reject) => {\r\n                    this.sceneProxy.space_key.onDown.add(() => {resolve()});\r\n                });\r\n                return this.sceneProxy.doInCT(context, () => Promise.race([animationSpeak(\"\", data, context, this.sceneProxy.quickPlay ? 0 : parseInt(speakInfo.speed), speakInfo.hidden), clickProxy, keyProxy]))\r\n                    .then(() => {\r\n                        isShowAll = true;\r\n                        this.sceneProxy.curPlotLayer.onChildInputDown.removeAll();\r\n                        this.sceneProxy.space_key.onDown.removeAll();\r\n                        if (FontUtils.fontFamily) {\r\n                            contentTxt.children[1] && (contentTxt.children[1].y = contentTxt.imgFBottom);\r\n                            contextScrollToBottom(speakInfo.hidden, contentTxt.imgFBottom);\r\n                            contentTxt.setText(' ', true);\r\n                        }\r\n                        else {\r\n                            let txt = Expression.parseWaitTime(data);\r\n                            contentTxt.text = this.viewComponent.game.device.desktop ? txt : txt.replace(new RegExp(' ', 'gm'), '  ');\r\n                            contextScrollToBottom(speakInfo.hidden, contentTxt.height);\r\n                        }\r\n                    })\r\n\t\t\t};\r\n\r\n\t\t\tconst playWait = (time, action) => {\r\n\t\t\t\tconst waitTime = this.sceneProxy.quickPlay ? 10 : time;\r\n\t\t\t\treturn Utils.timeout(waitTime).then(() => {\r\n\t\t\t\t\tif (this.sceneProxy.playPause) {\r\n\t\t\t\t\t\treturn playWait(500, action);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn Promise.resolve(action)\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tconst savePlayBackContent = (info) => {\r\n\t\t\t    let speakData = '';\r\n                if (Object.prototype.toString.call(info.speaking.data) === '[object Array]') {\r\n                    for (let i=0; i<info.speaking.data.length; i++) {\r\n                        speakData += info.speaking.data[i].data;\r\n                    }\r\n                }\r\n                else {\r\n                    speakData = info.speaking.data;\r\n                }\r\n\t\t\t\tspeakData = speakData.replace(/\\n/g,\"\");\r\n                let data = info.dialogtitle.hidden || info.dialogtitle.data === '' ? speakData : info.dialogtitle.data + ':' + speakData;\r\n                data && this.sceneProxy.addPlayBackContent(Expression.parseWaitTime(Expression.parseValue(data, context)));\r\n\t\t\t};\r\n\r\n\t\t\tconst clearPreloadResources = (isTextOption, index, options, condOptions) => {\r\n\t\t\t\tif (isTextOption) {\r\n\t\t\t\t\toptions.forEach((o, i) => {\r\n\t\t\t\t\t\tif (i === index) {\r\n\t\t\t\t\t\t\tResourcesManager.transferByRefCount('PreloadOption' + i, 'play');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tResourcesManager.delByRefType('PreloadOption' + i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst condOptIndex = (condOptions || []).findIndex(option => {\r\n\t\t\t\t\t\treturn Expression.safeEval(option.expression, context)\r\n\t\t\t\t\t\t\t&& (option.count ? parseInt(Expression.safeEval(option.count, context)) > 0 : true)\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcondOptions.forEach((o, i) => {\r\n\t\t\t\t\t\tif (i === condOptIndex) {\r\n\t\t\t\t\t\t\tResourcesManager.transferByRefCount('PreloadCondOption' + i, 'play');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tResourcesManager.delByRefType('PreloadCondOption' + i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst play = () => {\r\n\t\t\t\tif (!plot) {\t// 该章节无剧情\r\n\t\t\t\t\treturn this.showNextPlot(context, chapter, nPlot);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst playNormal = () => {\r\n                    this.sceneProxy.curCmdUuid = '';\r\n                    // 保存对话内容\r\n\t\t\t\t\tlet dialogInfo = {avatar: plot.avatar, dialogtitle: plot.dialogtitle, speaking: plot.speaking};\r\n                    if (plot.speaking.data && !loadData) {\r\n                    \tsavePlayBackContent(plot);\r\n                    }\r\n\r\n                    // 显示菜单\r\n                    if (!plot.menu.hidden) {\r\n                    \tif (this.sceneProxy.json_data.template.json.shanyiMenu) {\r\n                            this.addMenuLayer(true);\r\n                        } else {\r\n                    \t\tthis.addMenuLayer(false);\r\n                            this.sceneProxy.menuLayer.x = plot.menu.x;\r\n                            this.sceneProxy.menuLayer.y = plot.menu.y;\r\n\t\t\t\t\t\t}\r\n                    }\r\n                    if (!plot.animations.find(a => a.type === 'fadein')) {\r\n                        this.sceneProxy.lstPlotLayer && this.sceneProxy.lstPlotLayer.destroy();\r\n                        this.sceneProxy.lstPlotLayer = this.sceneProxy.curPlotLayer;\r\n                    }\r\n                    !loadData && this.sceneProxy.valueOperation(context, plot.values);\r\n                    playPlotSound();\r\n                    playMusic(loadData ? loadData.music : plot.music);\r\n                    addBackground(this.sceneProxy.curPlotLayer);\r\n                    if (plot.speaking.coverage === 'bottom') {\r\n                        addDialogLayer(dialogInfo);\r\n                        addCharsProps(plot.characters, plot.props);\r\n                        addWeather(plot.weather.value);\r\n                    } else {\r\n                        addCharsProps(plot.characters, plot.props);\r\n                        addWeather(plot.weather.value);\r\n                        addDialogLayer(dialogInfo);\r\n                    }\r\n                    // 选项置顶\r\n                    this.sceneProxy.optionLayer && this.viewComponent.game.world.bringToTop(this.sceneProxy.optionLayer);\r\n                    this.sceneProxy.charsAndPropsLayer && (this.sceneProxy.charsAndPropsLayer.visible = false);\r\n                    addPlotViews(plot.views, loadData);\r\n                    showGlobalViews(loadData !== null && loadData !== undefined, plot.hideGlobalViews);\r\n                    if (this.sceneProxy.json_data.default_settings && this.sceneProxy.json_data.default_settings.autoSaveOrLoad && plot.autoSaveOrLoad && plot.autoSaveOrLoad.type === 1 && !loadData) {\r\n                        if (this.sceneProxy.loadRecord(0)) {\r\n                            return;\r\n                        } else {\r\n                            return Dialog.warn(\"Sorry~读不到存档内容，即将返回封面\").then(() => {\r\n                                return this.sceneProxy.reStart()\r\n                            }, () => {\r\n                                return this.sceneProxy.reStart()\r\n                            })\r\n                        }\r\n                    }\r\n                    return Promise.all([animateIn(),musicIn(),dialogIn(plot.speaking.animations.filter(a => a.trigger === 'animateIn'))])\r\n                        .then(() => {\r\n                            this.sceneProxy.lstGameBk && (this.sceneProxy.lstGameBk.visible = false);\r\n                            return doSpeak(plot.speaking)\r\n                    \t})\r\n                        .then(() => {return addOptions(plot.options, plot.condition_options)})\r\n                        .then(action => {\r\n                            const hasView = this.sceneProxy.plotViewsLayer.children.length > 0;\r\n                            return new Promise((resolve, reject) => {\r\n                                if (action.type === 0 || action.type === 2) {\r\n                                    if ((plot.autotext || (!hasView && (this.sceneProxy.quickPlay || context.auto))) && !this.sceneProxy.playPause) { // 自动播放下一剧情\r\n                                        resolve(action);\r\n                                    } else {\r\n                                        const onClick = (o, e) => {\r\n                                            if (e && e.pointerMode === Phaser.PointerMode.CURSOR && e.button !== 0 || 'auto' === o && hasView) {\r\n                                                return;\r\n                                            }\r\n                                            this.sceneProxy.curPlotLayer.onChildInputDown.remove(onClick);\r\n                                            if ('insertPlot' === o)  {\r\n                                            \treject();\r\n                                            } else {\r\n                                                resolve(action)\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n                                        };\r\n                                        this.sceneProxy.curPlotLayer.onChildInputDown.add(onClick);\r\n                                        !hasView && this.sceneProxy.space_key.onDown.addOnce(() => resolve(action));\r\n                                    }\r\n                                } else {\r\n                                    resolve(action)\r\n                                }\r\n                            })\r\n                        })\r\n                        .then(action => {\r\n                            if (this.sceneProxy.json_data.default_settings && this.sceneProxy.json_data.default_settings.autoSaveOrLoad && plot.autoSaveOrLoad && plot.autoSaveOrLoad.type === 0) {\r\n                                this.sceneProxy.getSnap();\r\n                                this.sceneProxy.saveRecord(0, true);\r\n                            }\r\n                            return action;\r\n                        })\r\n                        .then(action => playWait(plot.wait.value, action))\r\n                        .then(action => {\r\n                            return Promise.all([animateOut(action), musicOut(action), dialogOut(plot.speaking.animations.filter(a => a.trigger === 'animateOut'))])\r\n                                .then(() => this.sceneProxy.doInCT(context, () => {\r\n                                    return Promise.resolve(action)\r\n                                }))\r\n                        })\r\n                        .then(action => {\r\n\t\t\t\t\t\t\tclearPreloadResources(action.type === 1, action.index, plot.options, plot.condition_options);\r\n                            if (action.type === 1) {\r\n                                this.showNextPlot(context, chapter, nPlot, \"option\", action.index)\r\n                            } else {\r\n                                this.showNextPlot(context, chapter, nPlot)\r\n                            }\r\n                        }, e => {\r\n                            Promise.reject(e);\r\n                        });\r\n\t\t\t\t};\r\n\t\t\t\tconst playCommands = () => {\r\n\t\t\t\t\tlet hideGlobalViews = [];\r\n\t\t\t\t\tconst recoverCmdSnap = (snapInfo, commands, index) => {\r\n                        if (!snapInfo.music) {\r\n                            this.sceneProxy.stopMusic();\r\n                        }\r\n                        else if (this.viewComponent.game.load.cache.checkSoundKey(snapInfo.music.url)\r\n                                || 'ios' === flashvars.client && flashvars.app_version >= '1.5.0') {\r\n                            this.sceneProxy.stopMusic(snapInfo.music.url);\r\n                            this.sceneProxy.playMusic(snapInfo.music.url, snapInfo.music.volume, true);\r\n                        }\r\n\r\n                        for (let item in snapInfo.sounds) {\r\n                            if (snapInfo.sounds[item]) {\r\n                                if (this.viewComponent.game.load.cache.checkSoundKey(snapInfo.sounds[item].url)\r\n                                    || 'ios' === flashvars.client && flashvars.app_version >= '1.5.0') {\r\n                                    this.sceneProxy.stopSound(item, snapInfo.sounds[item].url);\r\n                                    this.sceneProxy.playSound(item, snapInfo.sounds[item].url, snapInfo.sounds[item].volume, snapInfo.sounds[item].time === 0);\r\n                                }\r\n                            }\r\n                            else {\r\n                                this.sceneProxy.stopSound(item);\r\n                            }\r\n                        }\r\n\r\n                        !snapInfo.bk && (snapInfo.bk = {opacity: 0});\r\n                        bkSprite = this.sceneProxy.curPlotLayer.create(0, 0, snapInfo.bk.url);\r\n                        bkSprite.alpha = snapInfo.bk.opacity;\r\n                        bkSprite.width = this.viewComponent.game.world.width;\r\n                        bkSprite.height = this.viewComponent.game.world.height;\r\n                        this.viewComponent.addGifAnimation(bkSprite, snapInfo.bk.url);\r\n\r\n                        if (!this.sceneProxy.charsAndPropsLayer || !this.sceneProxy.charsAndPropsLayer.exists) {\r\n                            this.sceneProxy.charsAndPropsLayer = this.viewComponent.game.add.group();\r\n                            this.sceneProxy.charsAndPropsLayer.name = \"charactersAndProps\";\r\n                        }\r\n                        for (let item of snapInfo.charsAndProps) {\r\n                        \tconst x = item.x;\r\n                        \tconst y = item.y;\r\n                        \tif (item.pivotX && item.pivotY) {\r\n                                item.x -= item.width / 2;\r\n                                item.y -= item.height / 2;\r\n                            }\r\n\r\n                            const ch = this.viewComponent.addFitImageSprint(item.x, item.y, item.width, item.height, item.url, this.sceneProxy.charsAndPropsLayer, item.index);\r\n                            ch.alpha = item.opacity;\r\n                            ch.angle = item.rotate;\r\n                            if (item.pivotX) {\r\n                                ch.scale.x = item.scaleX;\r\n                                ch.scale.y = item.scaleY;\r\n                                ch.x = x;\r\n                                ch.y = y;\r\n                            }\r\n                            ch.cmdUuid = item.cmdUuid;\r\n                            if (item.parentScale) {\r\n                                ch.parent.scale.setTo(item.parentScale, item.parentScale);\r\n                            }\r\n                            this.viewComponent.addGifAnimation(ch, item.url);\r\n                        }\r\n\r\n                        this.sceneProxy.weatherType !== '' && addWeather(snapInfo.weatherType);\r\n                        this.sceneProxy.bCmdAutoText = snapInfo.autoText;\r\n\r\n                        if (snapInfo.dialogInfo[0] && (index >= commands.length || index < commands.length && commands[index].type !== 'showDialog')) {\r\n                            addDialogLayer(snapInfo.dialogInfo[0]);\r\n                            doSpeak(snapInfo.dialogInfo[0].speaking, true);\r\n                            //let txt = Expression.parseWaitTime(Expression.parseValue(snapInfo.dialogInfo[0].speaking.data, context));\r\n                            //contentTxt.text = this.viewComponent.game.device.desktop ? txt : txt.replace(new RegExp(' ', 'gm'), '  ');\r\n\t\t\t\t\t\t} else {\r\n                        \tthis.sceneProxy.dialogLayer.visible = false;\r\n\t\t\t\t\t\t}\r\n\r\n                        this.sceneProxy.removeViewTimer(this.sceneProxy.plotViewsLayer);\r\n                        this.sceneProxy.removeInputView(this.sceneProxy.plotViewsLayer);\r\n                        this.sceneProxy.plotViewsLayer.removeAll(true);\r\n                        this.sceneProxy.filterInexistentPlotViews(snapInfo.plotViews, plot);\r\n                        this.removeViewKey(this.sceneProxy.plotViewKeys);\r\n                        loadSubViews(snapInfo.plotViews);\r\n                        this.viewComponent.game.world.bringToTop(this.sceneProxy.plotViewsLayer);\r\n                        for (let i in this.sceneProxy.globalViews) {\r\n                        \tif (!this.sceneProxy.globalViews[i].visible) {\r\n                                for (let q in this.sceneProxy.json_data.views) {\r\n                                    if (this.sceneProxy.json_data.views[q].ref === this.sceneProxy.globalViews[i].name) {\r\n                                        hideGlobalViews[i] = (this.sceneProxy.json_data.views[q].instanceUuid);\r\n                                        break;\r\n                                    }\r\n                                }\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n                        showGlobalViews(true, hideGlobalViews);\r\n\r\n                        if (snapInfo.menuInfo[0]) {\r\n                            this.addMenuLayer(false);\r\n                            this.sceneProxy.menuLayer.x = snapInfo.menuInfo[0].x;\r\n                            this.sceneProxy.menuLayer.y = snapInfo.menuInfo[0].y;\r\n\t\t\t\t\t\t}\r\n                    };\r\n\t\t\t\t\tconst handle = (cmdInfo, i) =>{\r\n                        let action = {type: ''};\r\n                        this.sceneProxy.curCmdInfo = cmdInfo;\r\n\t\t\t\t\t\tthis.sceneProxy.curCmdIndex = i;\r\n\r\n\t\t\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t\t    if ('systemUI' === cmdInfo.commands[i].type || 'jump' === cmdInfo.commands[i].type\r\n                                || 'back' === cmdInfo.commands[i].type || 'insert' === cmdInfo.commands[i].type) {\r\n\t\t\t\t\t\t\t    this.sceneProxy.cmdPlotNextPromise = null;\r\n                            }\r\n                            else if ('showDialog' === cmdInfo.commands[i].type) {\r\n\t\t\t\t\t\t        const nextCmdCallback = (a) => {\r\n                                    let pointer = new Phaser.Pointer(this.viewComponent.game, 1, Phaser.PointerMode.CURSOR);\r\n                                    pointer.button = 0;\r\n                                    this.sceneProxy.curPlotLayer.onChildInputDown.dispatch('nextCmd', pointer);\r\n                                    this.sceneProxy.curPlotLayer.onChildInputDown.dispatch('nextCmd', pointer);\r\n                                    resolve(a);\r\n                                };\r\n\t\t\t\t\t\t        this.sceneProxy.cmdPlotNextPromise = nextCmdCallback;\r\n                            }\r\n                            else {\r\n                                this.sceneProxy.cmdPlotNextPromise = resolve;\r\n                            }\r\n\r\n                            const commands = cmdInfo.commands;\r\n                            const args = commands[i].args;\r\n                            this.sceneProxy.curCmdUuid = commands[i].uuid;\r\n\r\n                            switch (commands[i].type) {\r\n                                case 'addView':\r\n                                    addPlotViews(args, null, commands[i].uuid);\r\n                                    this.sceneProxy.plotViewsLayer.visible = true;\r\n                                    this.viewComponent.game.world.bringToTop(this.sceneProxy.menuLayer);\r\n                                    break;\r\n                                case 'delView':\r\n                                    this.destroyView(args[0]);\r\n                                    break;\r\n\t\t\t\t\t\t\t\tcase 'systemUI':\r\n\t\t\t\t\t\t\t\t\tif (args[0] === 'save-record') {\r\n                                        const disableSaveOrLoad = this.sceneProxy.context.disableSaveOrLoad;\r\n                                        if (disableSaveOrLoad && disableSaveOrLoad.save) {\r\n                                            this.sceneProxy.showToast(1, '抱歉，作者在此设置了禁用存档');\r\n                                            return resolve(action);\r\n                                        }\r\n                                        !this.sceneProxy.mainMenuLayer.visible && this.sceneProxy.getSnap();\r\n                                        this.sceneProxy.showSave(false, {callbackFun:resolve, callbackArgs: action});\r\n                                        return;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse if (args[0] === 'load-record') {\r\n                                        const disableSaveOrLoad = this.sceneProxy.context.disableSaveOrLoad;\r\n                                        if (disableSaveOrLoad && disableSaveOrLoad.load) {\r\n                                            this.sceneProxy.showToast(1, '抱歉，作者在此设置了禁用读档');\r\n                                            return resolve(action);\r\n                                        }\r\n                                        this.sceneProxy.showLoad(false, {callbackFun:resolve, callbackArgs: action});\r\n                                        return;\r\n\t\t\t\t\t\t\t\t\t}\r\n                                    else if (args[0] === 'settings') {\r\n                                        this.sceneProxy.showPlayback({callbackFun:resolve, callbackArgs: action});\r\n                                        return;\r\n\t\t\t\t\t\t\t\t\t}\r\n                                    else if (args[0] === 'playback') {\r\n                                        this.sceneProxy.showSettings(context, {callbackFun:resolve, callbackArgs: action});\r\n                                        return;\r\n\t\t\t\t\t\t\t\t\t}\r\n                                case 'addImage':\r\n                                \tif (args[0].index === 1) {\r\n                                \t\tconst isInherit = args[0].url === 'inherit';\r\n                                        let bk_key = isInherit ? this.sceneProxy.lstPlotBkKey : args[0].url;\r\n                                        let bk_flex = isInherit ? this.sceneProxy.lstPlotBkFlex : args[0].flex;\r\n                                        let bk_alpha = isInherit ? this.sceneProxy.lstPlotBkOpacity : args[0].opacity;\r\n                                        if (this.viewComponent.game.load.cache.checkImageKey(bk_key)) {\r\n                                            let old = this.sceneProxy.curPlotLayer.children.splice(1, 1);\r\n                                            old.length && old[0].destroy();\r\n                                            bkSprite = this.sceneProxy.curPlotLayer.create(args[0].x, args[0].y, bk_key);\r\n                                            bkSprite.alpha = bk_alpha === undefined ? 1 : bk_alpha;\r\n                                            this.backgroundFlex(bkSprite, bk_flex);\r\n                                            if (this.sceneProxy.lstGameBk && this.sceneProxy.lstGameBk.visible) {this.sceneProxy.lstGameBk.visible = false;}\r\n                                            this.sceneProxy.lstPlotBkKey = bk_key;\r\n                                            this.sceneProxy.lstPlotBkOpacity = bk_alpha;\r\n                                            this.sceneProxy.lstPlotBkFlex = bk_flex;\r\n                                            this.viewComponent.addGifAnimation(bkSprite, args[0].url);\r\n                                        }\r\n\t\t\t\t\t\t\t\t\t}\r\n                                \telse {\r\n                                        addCharsProps(args, [], commands[i].uuid);\r\n\t\t\t\t\t\t\t\t\t}\r\n                                    break;\r\n                                case 'delImage':\r\n                                \tif (1 === args[0]) {\r\n                                        let old = this.sceneProxy.curPlotLayer.children.splice(1, 1);\r\n                                        old.length && old[0].destroy();\r\n\t\t\t\t\t\t\t\t\t} else {\r\n                                        for (let i=0; i<this.sceneProxy.charsAndPropsLayer.children.length; i++) {\r\n                                            let rs = this.sceneProxy.charsAndPropsLayer.getAt(i);\r\n                                            if (-1 === rs) break;\r\n                                            if (rs.zIndex === args[0]) {\r\n                                                this.sceneProxy.charsAndPropsLayer.removeChildAt(i);\r\n                                                rs.destroy();\r\n                                                break;\r\n                                            }\r\n                                        }\r\n\t\t\t\t\t\t\t\t\t}\r\n                                    break;\r\n                                case 'showMenu':\r\n                                    this.sceneProxy.menuInfo = args.concat();\r\n                                    this.addMenuLayer(false);\r\n                                    this.sceneProxy.menuLayer.x = args[0].x;\r\n                                    this.sceneProxy.menuLayer.y = args[0].y;\r\n                                    break;\r\n                                case 'hideMenu':\r\n                                    this.sceneProxy.menuInfo = [];\r\n                                    this.sceneProxy.menuLayer.visible = false;\r\n                                    break;\r\n                                case 'showGlobalView':\r\n                                    for (let i=0; i<hideGlobalViews.length; i++) {\r\n                                        if (hideGlobalViews[i] === args[0]) {\r\n                                            hideGlobalViews.splice(i, 1);\r\n                                            break;\r\n                                        }\r\n                                    }\r\n                                    showGlobalViews(false, hideGlobalViews);\r\n                                    break;\r\n                                case 'hideGlobalView':\t{\r\n                                    let i = 0;\r\n                                    for (; i<hideGlobalViews.length; i++) {\r\n                                        if (hideGlobalViews[i] === args[0]) break;\r\n                                    }\r\n                                    if (i >= hideGlobalViews.length) hideGlobalViews[i] = args[0];\r\n                                }\r\n                                    showGlobalViews(false, hideGlobalViews);\r\n                                    break;\r\n                                case 'showDialog':\r\n                                    this.sceneProxy.lstDialogInfo = args.concat();\r\n                                    this.sceneProxy.dialogLayer.animateTweens.forEach((t,i) => {t.stop()});\r\n                                    this.sceneProxy.dialogLayer.animateTweens.splice(0);\r\n                                    savePlayBackContent(args[0]);\r\n                                    return addDialogLayer(args[0])\r\n                                        .then(() => {\r\n                                            if (args[0].speaking.coverage === 'bottom') {\r\n                                                this.viewComponent.game.world.bringToTop(this.sceneProxy.charsAndPropsLayer);\r\n                                                this.viewComponent.game.world.bringToTop(this.sceneProxy.weatherLayer);\r\n                                            }\r\n                                            this.viewComponent.game.world.bringToTop(this.sceneProxy.plotViewsLayer);\r\n                                            showGlobalViews(false, hideGlobalViews);\r\n                                            return doSpeak(args[0].speaking)\r\n                                        })\r\n                                        .then(() => {\r\n                                            const hasView = this.sceneProxy.plotViewsLayer.children.length > 0;\r\n                                            if ((this.sceneProxy.bCmdAutoText || (!hasView && (this.sceneProxy.quickPlay || this.sceneProxy.context.auto))) && !this.sceneProxy.playPause) { // 自动播放下一指令\r\n                                                return resolve(action);\r\n                                            } else {\r\n                                                const onClick = (o, e) => {\r\n                                                    if (e && e.pointerMode === Phaser.PointerMode.CURSOR && e.button !== 0 || 'auto' === o && hasView) {\r\n                                                        return;\r\n                                                    }\r\n                                                    this.sceneProxy.curPlotLayer.onChildInputDown.remove(onClick);\r\n                                                    if ('insertPlot' === o)  {\r\n                                                        return reject();\r\n                                                    } else {\r\n                                                        return resolve(action)\r\n                                                    }\r\n                                                };\r\n                                                this.sceneProxy.curPlotLayer.onChildInputDown.add(onClick);\r\n                                                !hasView && this.sceneProxy.space_key.onDown.addOnce(() => {return resolve(action)});\r\n                                            }\r\n                                        });\r\n                                case 'hideDialog':\r\n                                    this.sceneProxy.lstDialogInfo = [];\r\n                                    this.sceneProxy.dialogLayer.visible = false;\r\n                                    break;\r\n                                case 'playMusic':\r\n                                    playMusic(args[0]);\r\n                                    break;\r\n                                case 'stopMusic':\r\n                                    this.sceneProxy.stopMusic();\r\n                                    break;\r\n                                case 'playSound':\r\n                                    if (args[0].url === 'inherit') {\r\n                                    \tif (this.sceneProxy.plotSounds[args[0].index]) {\r\n\t\t\t\t\t\t\t\t\t\t\tthis.sceneProxy.playInheritSound(args[0].index, args[0].volume);\r\n                                        }\r\n                                        break;\r\n                                    }\r\n                                    else if (this.viewComponent.game.load.cache.checkSoundKey(args[0].url)\r\n                                            || 'ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n                                        this.sceneProxy.stopSound(args[0].index, args[0].url);\r\n                                        this.sceneProxy.playSound(args[0].index, args[0].url, args[0].volume, args[0].time === 0);\r\n                                    }\r\n                                    break;\r\n                                case 'stopSound':\r\n                                    this.sceneProxy.stopSound(args[0]);\r\n                                    break;\r\n                                case 'animateImage':\r\n                                    const delay = this.sceneProxy.quickPlay ? 0 : args[0].delay;\r\n                                    const duration = this.sceneProxy.quickPlay ? 0 : args[0].duration;\r\n                                    if (args[0].index > 1 && this.sceneProxy.charsAndPropsLayer.exists) {\r\n                                        for (let i=0; i<this.sceneProxy.charsAndPropsLayer.children.length; i++) {\r\n                                            let imgGroup = this.sceneProxy.charsAndPropsLayer.children[i];\r\n                                            if (imgGroup.zIndex === args[0].index) {\r\n                                            \tlet img = imgGroup.children[0];\r\n                                            \tconst doAnimation = () => {\r\n                                            \t\t// begin结束前一次缓动并赋予缓动最终状态\r\n                                                    if (imgGroup.animateTweens) {\r\n                                                    \timgGroup.animateTweens.forEach((t,i) => {t.stop(false)});\r\n                                                        imgGroup.animateTweens.splice(0);\r\n                                                    }\r\n                                                    if (img.animateTweens) {\r\n                                                    \timg.animateTweens.forEach((t,i) => {t.stop(false)});\r\n                                                        img.animateTweens.splice(0);\r\n                                                    }\r\n                                                    if (img.finalState) {\r\n                                                    \timg.alpha = img.finalState.alpha;\r\n                                                        img.angle = img.finalState.angle;\r\n                                                        img.x = img.finalState.x;\r\n                                                        img.y = img.finalState.y;\r\n                                                        imgGroup.x = 0;\r\n                                                        imgGroup.y = 0;\r\n                                                        imgGroup.scale.x = imgGroup.finalState.scale.x;\r\n                                                        imgGroup.scale.y = imgGroup.finalState.scale.y;\r\n                                                    }// -end\r\n\r\n                                                    let alpha = args[0].opacity;\r\n                                                    let angle = parseInt(args[0].rotate) === 180 ? 179.9 : args[0].rotate;\r\n                                                    let x = args[0].x / args[0].scaleX + img.width/2;\r\n                                                    let y = args[0].y / args[0].scaleY + img.height/2;\r\n                                                    let scaleX = args[0].scaleX;\r\n                                                    let scaleY = args[0].scaleY;\r\n\r\n                                                    img.mirrorH && (angle = -angle, x -= img.width);\r\n                                                    img.mirrorV && (angle = -angle, y -= img.height);\r\n\r\n                                                    if (!img.lstAlpha && img.alpha !== alpha || img.lstAlpha !== alpha) {\r\n                                                        img.lstAlpha = alpha;\r\n                                                        this.tweenToPromise(img, {alpha: alpha}, duration, null, true, delay);\r\n                                                    }\r\n                                                    if (!img.lstAngle && img.angle !== angle || img.lstAngle !== angle) {\r\n                                                        img.lstAngle = angle;\r\n                                                        this.tweenToPromise(img, {angle: angle}, duration, null, true, delay);\r\n                                                    }\r\n                                                    if (!img.lstX && img.x !== x || img.lstX !== x) {\r\n                                                        img.lstX = x;\r\n                                                        let xRaw = img.mirrorH ? (img.x + img.width/2)  * imgGroup.scale.x : (img.x - img.width/2)  * imgGroup.scale.x;\r\n                                                        let xMoveTo = args[0].x - xRaw * (args[0].scaleX / imgGroup.scale.x);\r\n                                                        this.tweenToPromise(imgGroup, {x:xMoveTo}, duration, null, true, delay).then(()=>{\r\n                                                            imgGroup.x = 0;\r\n                                                            img.x = img.lstX;\r\n                                                        });\r\n                                                        //this.tweenToPromise(img, {x: x}, args[0].duration, null, true, args[0].delay);\r\n                                                    }\r\n                                                    if (!img.lstY && img.y !== y || img.lstY !== y) {\r\n                                                        img.lstY = y;\r\n                                                        let yRaw = img.mirrorV ? (img.y + img.height/2) * imgGroup.scale.y : (img.y - img.height/2) * imgGroup.scale.y;\r\n                                                        let yMoveTo = args[0].y - yRaw * (args[0].scaleY / imgGroup.scale.y);\r\n                                                        this.tweenToPromise(imgGroup, {y:yMoveTo}, duration, null, true, delay).then(()=>{\r\n                                                            imgGroup.y = 0;\r\n                                                            img.y = img.lstY;\r\n                                                        });\r\n                                                        //this.tweenToPromise(img, {y: y}, args[0].duration, null, true, args[0].delay);\r\n                                                    }\r\n                                                    img.finalState = {alpha:alpha, angle:angle, x:x, y:y};\r\n\r\n                                                    if (!imgGroup.lstScaleX && imgGroup.scale.x !== scaleX || imgGroup.lstScaleX !== scaleX) {\r\n                                                        imgGroup.lstScaleX = scaleX;\r\n                                                        this.tweenToPromise(imgGroup.scale, {x:scaleX}, duration, null, true, delay);\r\n                                                    }\r\n                                                    if (!imgGroup.lstScaleY && imgGroup.scale.y !== scaleY || imgGroup.lstScaleY !== scaleY) {\r\n                                                        imgGroup.lstScaleY = scaleY;\r\n                                                        this.tweenToPromise(imgGroup.scale, {y:scaleY}, duration, null, true, delay);\r\n                                                    }\r\n                                                    imgGroup.finalState = {scale:{x:scaleX, y:scaleY}};\r\n\t\t\t\t\t\t\t\t\t\t\t\t};\r\n                                            \tdoAnimation();\r\n                                                break;\r\n                                            }\r\n                                        }\r\n                                    } else if (args[0].index === 1 && this.sceneProxy.curPlotLayer.children[1]) {\r\n                                    \tthis.tweenToPromise(this.sceneProxy.curPlotLayer.children[1], {alpha: args[0].opacity}, duration, null, true, delay);\r\n                                    \tthis.sceneProxy.curPlotLayer.children[1].finalState = {alpha: args[0].opacity};\r\n                                    \tthis.sceneProxy.lstPlotBkOpacity = args[0].opacity;\r\n\t\t\t\t\t\t\t\t\t}\r\n                                    break;\r\n                                case 'animateDialog':\r\n                                    if (this.sceneProxy.dialogLayer.visible) {\r\n                                    \tlet delay = this.sceneProxy.quickPlay ? 0 : args[0].delay;\r\n                                    \tlet duration = this.sceneProxy.quickPlay ? 0 : args[0].duration;\r\n                                        const normalPropsTo = () => {\r\n                                            let properties = {alpha:args[0].opacity, angle:args[0].rotate, x:parseFloat(args[0].x), y:parseFloat(args[0].y)};\r\n                                            this.sceneProxy.lstDialogInfo[0].opacity = args[0].opacity;\r\n                                            this.sceneProxy.lstDialogInfo[0].rotate = args[0].rotate;\r\n                                            this.sceneProxy.lstDialogInfo[0].x = args[0].x;\r\n                                            this.sceneProxy.lstDialogInfo[0].y = args[0].y;\r\n                                            return this.tweenToPromise(this.sceneProxy.dialogLayer, properties, duration, null, true, delay);\r\n                                        };\r\n                                        const scalePropTo = () => {\r\n                                            return this.tweenToPromise(this.sceneProxy.dialogLayer.scale, {x:args[0].scaleX, y:args[0].scaleY}, duration, null, true, delay);\r\n                                        };\r\n                                        normalPropsTo() && scalePropTo();\r\n                                    }\r\n                                    break;\r\n                                case 'animateScene':\r\n                                \tif (! this.sceneProxy.quickPlay) {\r\n                                        if (args[0].type === 'twinkle') {\r\n                                            sceneTwinkle(args[0].duration, args[0].delay, args[0].color);\r\n                                        }\r\n                                        if (args[0].type === 'shake') {\r\n                                            if (!this.sceneProxy.curPlotLayer.isShaking && args[0].duration) {\r\n                                                sceneShake(args[0].level ? args[0].level * 5 : 18, args[0].duration, args[0].delay);\r\n                                                this.sceneProxy.curPlotLayer.isShaking = true;\r\n                                            }\r\n                                        }\r\n\t\t\t\t\t\t\t\t\t}\r\n                                    break;\r\n                                case 'animateMusic':\r\n                                    if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n                                        PhoneUtils.tweenToMusic(args[0].volume, args[0].duration, args[0].delay);\r\n                                    } else {\r\n                                        this.tweenToPromise(this.sceneProxy.bk_music, {volume: args[0].volume}, args[0].duration, null, true, args[0].delay);\r\n                                    }\r\n                                    break;\r\n                                case 'animateSound':\r\n                                    if ('ios' === flashvars.client && '1.5.0' <= flashvars.app_version) {\r\n                                        PhoneUtils.tweenToSound(args[0].index, args[0].volume, args[0].duration, args[0].delay);\r\n                                    } else {\r\n                                        this.tweenToPromise(this.sceneProxy.plotSounds[args[0].index], {volume: args[0].volume}, args[0].duration, null, true, args[0].delay);\r\n                                    }\r\n                                    break;\r\n                                case 'setValues':\r\n                                    this.sceneProxy.valueOperation(context, args);\r\n                                    break;\r\n                                case 'wait':\r\n                                \tif (this.sceneProxy.quickPlay && this.sceneProxy.preWaitCmdUuid !== commands[i].uuid) { // 上一等待指令与当前等待指令相同，说明作者设置了循环等待\r\n                                \t    this.sceneProxy.preWaitCmdUuid = commands[i].uuid;\r\n                                        return resolve(action);\r\n\t\t\t\t\t\t\t\t\t}\r\n                                    return playWait(args[0].value + 20, {type:0}).then(() => {return resolve(action)});\r\n                                case 'jump':\r\n                                    this.sceneProxy.context = JSON.parse(JSON.stringify(this.sceneProxy.context));\r\n                                    this.showNextPlot(this.sceneProxy.context, this.sceneProxy.curChapter, this.sceneProxy.curPlotIndex, 'jump', args[0]);\r\n                                    return resolve(false);\r\n                                case 'back':\r\n                                    this.sceneProxy.context = JSON.parse(JSON.stringify(this.sceneProxy.context));\r\n                                    this.showNextPlot(this.sceneProxy.context, this.sceneProxy.curChapter, this.sceneProxy.curPlotIndex, 'back');\r\n                                    return resolve(false);\r\n                                case 'insert':\r\n                                    this.showNextPlot(this.sceneProxy.context, this.sceneProxy.curChapter, this.sceneProxy.curPlotIndex, 'insertPlot', args[0]);\r\n                                    return resolve(false);\r\n                                case 'options':\r\n                                    if (!this.sceneProxy.optionLayer || !this.sceneProxy.optionLayer.exists) {\r\n                                        this.sceneProxy.optionLayer = this.viewComponent.game.add.group();\r\n                                    }\r\n                                    this.viewComponent.game.world.bringToTop(this.sceneProxy.optionLayer);\r\n                                    this.viewComponent.game.world.bringToTop(this.sceneProxy.plotViewsLayer);\r\n                                    showGlobalViews(false, hideGlobalViews);\r\n                                    this.sceneProxy.isScreenHold && this.viewComponent.game.world.bringToTop(this.sceneProxy.quickPlayLayer);\r\n\r\n                                    return addOptions(args, null).then(opt => {\r\n                                    \taction.type = 'options';\r\n                                    \taction.index = opt.index;\r\n\t\t\t\t\t\t\t\t\t\tclearPreloadResources(true, action.index, args, []);\r\n                                    \treturn resolve(action);\r\n                                    });\r\n                                case 'conditionOptions':\r\n                                    if (!this.sceneProxy.optionLayer || !this.sceneProxy.optionLayer.exists) {\r\n                                        this.sceneProxy.optionLayer = this.viewComponent.game.add.group();\r\n                                    }\r\n                                    return addOptions([], args).then(opt => {\r\n                                        if (opt.type === 2) {\r\n                                        \taction.type = 'cdtOptions';\r\n                                        }\r\n\t\t\t\t\t\t\t\t\t\tclearPreloadResources(false, 0, [], args);\r\n                                        return resolve(action);\r\n                                    });\r\n                                case 'backOption':\r\n                                \taction.type = 'backOption';\r\n                                    action.eArg = this.sceneProxy.Expression.safeEval(cmdInfo.commands[i].args[0], context);\r\n                                    break;\r\n                                case 'jumpOption':\r\n                                \taction.type = 'jumpOption';\r\n                                    action.eArg = this.sceneProxy.Expression.safeEval(cmdInfo.commands[i].args[0], context);\r\n                                    break;\r\n                                case 'autoSaveOrLoad':\r\n                                    if (this.sceneProxy.json_data.default_settings && this.sceneProxy.json_data.default_settings.autoSaveOrLoad) {\r\n                                        if (args[0].type === 1) {\r\n                                            if (!this.sceneProxy.loadRecord(args[0].index)) {\r\n                                                return Dialog.warn(\"Sorry~读不到存档内容，即将返回封面\").then(() => {\r\n                                                    this.sceneProxy.reStart();\r\n                                                    return Promise.resolve(-1);\r\n                                                }, () => {\r\n                                                    this.sceneProxy.reStart();\r\n                                                    return Promise.resolve(-1);\r\n                                                })\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n                                            return Promise.resolve(-1);\r\n                                        }\r\n                                        else if (args[0].type === 0) {\r\n                                            this.sceneProxy.getSnap();\r\n                                            this.sceneProxy.saveRecord(args[0].index, true);\r\n                                        }\r\n                                    }\r\n                                    break;\r\n                                case 'autotext':\r\n                                    this.sceneProxy.bCmdAutoText = args[0];\r\n                                    break;\r\n                                case 'weather':\r\n                                    if ('none' === args[0]) {\r\n                                        this.sceneProxy.weatherLayer.visible = false;\r\n                                    }\r\n                                    else {\r\n                                        addWeather(args[0]);\r\n                                    }\r\n                                    break;\r\n\t\t\t\t\t\t\t\tcase 'disableSaveOrLoad':\r\n\t\t\t\t\t\t\t\t\tthis.sceneProxy.context.disableSaveOrLoad = args[0];\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n                            }\r\n                            return resolve(action);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tconst playHandler = (cmdInfo, index) => {\r\n\t\t\t\t\t\treturn this.cmdPlotLoadResources(context, chapter, nPlot, cmdInfo, index).then(() => handle(cmdInfo, index).then(r => {\r\n                            this.sceneProxy.cmdPlotNextPromise = null;\r\n\t\t\t\t\t\t\tif (r && context === this.sceneProxy.context) {\r\n                                const {info:info, index:i} = this.sceneProxy.getNextCommand(context, cmdInfo, index, r);\r\n                                info && info.commands[i] ? playHandler(info, i) : this.showNextPlot(context, chapter, nPlot);\r\n                            }\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t};\r\n\r\n                    this.sceneProxy.lstPlotLayer && this.sceneProxy.lstPlotLayer.destroy();\r\n                    this.sceneProxy.lstPlotLayer = this.sceneProxy.curPlotLayer;\r\n\t\t\t\t\tthis.sceneProxy.bCmdAutoText = false;\r\n                    this.sceneProxy.lstDialogInfo = [];\r\n\t\t\t\t\tthis.sceneProxy.cmdPlayHandlerFun = playHandler;\r\n                    addBackground(this.sceneProxy.curPlotLayer);\r\n\r\n\t\t\t\t\tlet cmdInfo = {commands: plot.commands, parentInfo: null, parentCmdIndex: -1};\r\n\t\t\t\t\tlet cmdIndex = 0;\r\n\r\n\t\t\t\t\tif (cmdPlotSnap && cmdPlotSnap.cmdInfo) {\r\n\t\t\t\t\t\tcmdInfo = cmdPlotSnap.cmdInfo;\r\n\t\t\t\t\t\tcmdIndex = cmdPlotSnap.cmdIndex;\r\n\t\t\t\t\t\tif (cmdInfo.commands[cmdIndex] && cmdInfo.commands[cmdIndex].type === 'systemUI') {\r\n\t\t\t\t\t\t\tcmdIndex++;\r\n\t\t\t\t\t\t}\r\n                        if (cmdInfo.commands[cmdIndex] && cmdInfo.commands[cmdIndex].type === 'autoSaveOrLoad') {\r\n                            cmdIndex++;\r\n                        }\r\n                        recoverCmdSnap(cmdPlotSnap.cmdScreenSnap, cmdInfo.commands, cmdIndex);\r\n                        if (!cmdInfo.commands[cmdIndex]) {\r\n                        \tconst {info, index} = this.sceneProxy.getNextCommand(context, cmdInfo, cmdIndex-1, {type:'insert'});\r\n                        \tcmdInfo = info;\r\n                        \tcmdIndex = index;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n                    this.addMenuLayer(!!this.sceneProxy.json_data.template.json.shanyiMenu);\r\n\t\t\t\t\tcmdInfo && cmdInfo.commands[cmdIndex] ? playHandler(cmdInfo, cmdIndex) : this.showNextPlot(context, chapter, nPlot);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis.sceneProxy.isGettingNext = false;\r\n                this.sceneProxy.curPlotLayer = this.viewComponent.game.add.group();\r\n                this.sceneProxy.curPlotLayer.inputEnableChildren = true;\r\n                this.sceneProxy.curPlotLayer.name = 'plotLayer';\r\n                this.sceneProxy.charsAndPropsLayer && this.sceneProxy.charsAndPropsLayer.destroy();\r\n                this.sceneProxy.charsAndPropsLayer = this.viewComponent.game.add.group();\r\n                this.sceneProxy.charsAndPropsLayer.name = \"charactersAndProps\";\r\n                this.sceneProxy.optionLayer && this.sceneProxy.optionLayer.destroy();\r\n                this.sceneProxy.optionLayer = this.viewComponent.game.add.group();\r\n\t\t\t\t// 置顶\r\n                this.viewComponent.game.world.bringToTop(this.sceneProxy.curPlotLayer);\r\n                this.viewComponent.game.world.bringToTop(this.sceneProxy.charsAndPropsLayer);\r\n                this.viewComponent.game.world.bringToTop(this.sceneProxy.dialogLayer);\r\n\r\n                // 清理上一剧情高级UI\r\n\t\t\t\tif (!loadData) {\r\n                    this.sceneProxy.removeViewTimer(this.sceneProxy.plotViewsLayer);\r\n                    this.sceneProxy.removeInputView(this.sceneProxy.plotViewsLayer);\r\n                    this.sceneProxy.plotViewsLayer.removeAll(true);\r\n                    this.sceneProxy.plotViews.splice(0, this.sceneProxy.plotViews.length);\r\n                    this.removeViewKey(this.sceneProxy.plotViewKeys);\r\n                }\r\n\r\n                this.sceneProxy.curPlotInfo = plot;\t\t\t// 保存当前要播放的剧情信息\r\n                this.sceneProxy.curChapter = chapter;\t\t// 保存当前章节信息\r\n                this.sceneProxy.curPlotIndex = nPlot;\t\t// 保存当前剧情索引\r\n\t\t\t\tthis.sceneProxy.context.disableSaveOrLoad = plot.disableSaveOrLoad;\r\n\r\n\t\t\t\tif (plot.commands){\r\n\t\t\t\t\tplayCommands();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tplayNormal();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tplay();\r\n            this.sceneProxy.isScreenHold && this.viewComponent.game.world.bringToTop(this.sceneProxy.quickPlayLayer);\r\n\t\t},\r\n\r\n\t\tendPlot: function () {\r\n\t\t\tthis.sceneProxy.coverLayer.visible = false;\r\n\t\t\tthis.viewComponent.game.input.onDown.removeAll();\t// 移除鼠标点击事件\r\n\t\t\tthis.sceneProxy.dialogLayer.visible = false;\t\t// 隐藏对话框层\r\n\t\t\tthis.sceneProxy.menuLayer.visible = false;\t\t\t// 隐藏菜单层\r\n\t\t\tthis.sceneProxy.space_key.onDown.removeAll();\t\t// 移除空格键\r\n            this.sceneProxy.plotViews.splice(0, this.sceneProxy.plotViews.length);\r\n\t\t\tthis.sceneProxy.removePlotTweens();\r\n\t\t},\r\n\r\n\t\tshowNextPlot: function (context, chapter, nPlot, type, eArg) {\r\n\t\t\tlet {chapter: nChapter, nIndex, cmdPlotSnap, context: newContext, preStackFrame, preCmdStackFrame} = this.sceneProxy.getNextPlot(context, chapter, nPlot, type, eArg);\r\n            const cache = this.viewComponent.game.load.cache;\r\n\r\n            const addRefCount = (plotInfo) => {\r\n\t\t\t\tthis.sceneProxy.resetResources();\r\n\t\t\t\tif (plotInfo.background.url === 'inherit') {\r\n\t\t\t\t\tconst count = ResourcesManager.getCount('img', this.sceneProxy.lstPlotBkKey, 'play');\r\n\t\t\t\t\tconst usingCount = this.sceneProxy.usingResourceCount(this.sceneProxy.lstPlotBkKey);\r\n\t\t\t\t\tcount == usingCount && ResourcesManager.addRefCount('img', this.sceneProxy.lstPlotBkKey);\r\n\t\t\t\t}\r\n\t\t\t\tif (plotInfo.music.url === 'inherit' && this.sceneProxy.bk_music) {\r\n\t\t\t\t\tconst count = ResourcesManager.getCount('audio', this.sceneProxy.bk_music.key, 'play');\r\n\t\t\t\t\tconst usingCount = this.sceneProxy.usingResourceCount(this.sceneProxy.bk_music.key);\r\n\t\t\t\t\tcount == usingCount && ResourcesManager.addRefCount('audio', this.sceneProxy.bk_music.key);\r\n\t\t\t\t}\r\n\t\t\t\tfor (let item in plotInfo.plot_sound) {\r\n\t\t\t\t\tif (plotInfo.plot_sound[item]) {\r\n\t\t\t\t\t\tif (plotInfo.plot_sound[item].url == 'inherit' && this.sceneProxy.plotSounds[item]) {\r\n\t\t\t\t\t\t\tconst count = ResourcesManager.getCount('audio', this.sceneProxy.plotSounds[item].key, 'play');\r\n\t\t\t\t\t\t\tconst usingCount = this.sceneProxy.usingResourceCount(this.sceneProxy.plotSounds[item].key);\r\n\t\t\t\t\t\t\tcount == usingCount && ResourcesManager.addRefCount('audio', this.sceneProxy.plotSounds[item].key);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n            const goNext = () => {\r\n                if (!nChapter.plots[nIndex]) {\r\n                    if (nIndex === -2) {\r\n                        return this.sceneProxy.reStart();\r\n                    }\r\n                    else if (nIndex < -2) {\r\n                        if (preStackFrame) {\r\n                            newContext.stack = [preStackFrame, ...newContext.stack];\r\n                            preCmdStackFrame && (newContext.cmdStack = [preCmdStackFrame, ...newContext.cmdStack]);\r\n                        }\r\n                        const {chapter: c, nIndex: n, cmdPlotSnap: cps, context: nc, preStackFrame:np, preCmdStackFrame:npc} = this.sceneProxy.getNextPlot(context, chapter, nPlot, type, eArg);\r\n                        nChapter = c, nIndex = n, cmdPlotSnap = cps, newContext = nc, preStackFrame = np, preCmdStackFrame = npc;\r\n                        if (nIndex < -2) {\r\n                            if (preStackFrame) {\r\n                                context.stack = [preStackFrame, ...newContext.stack];\r\n                                preCmdStackFrame && (newContext.cmdStack = [preCmdStackFrame, ...newContext.cmdStack]);\r\n                            }\r\n                            return this.showNextPlot(context, chapter, nPlot, type, eArg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (nIndex === 0) {\r\n                    \tthis.showNextPlot(context, nChapter, nIndex);\r\n                    \treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n                        this.sceneProxy.dialogLayer.visible = true;\t\t// 游戏结束不隐藏对话框层\r\n                        this.sceneProxy.menuLayer.visible = true;\t\t\t// 游戏结束不隐藏菜单层\r\n                        return this.gameOver();\r\n                    }\r\n                }\r\n\r\n                if (chapter !== nChapter && nIndex === 0 || !this.sceneProxy.isPlotResourceExist(nChapter.plots[nIndex])) {\r\n                \tthis.sceneProxy.preloadChapterAssets(newContext, nChapter, nIndex, cmdPlotSnap);\r\n                } else {\r\n\t\t\t\t\taddRefCount(nChapter.plots[nIndex]);\r\n                    this.showPlot(newContext, nChapter, nIndex, cmdPlotSnap);\r\n                }\r\n\t\t\t};\r\n            const stayCurrentPlot = () => {\r\n                if (nPlot === 0) {\r\n                    this.showPlot(context, chapter, 0);\r\n                } else {\r\n                \tif (preStackFrame) {\r\n                \t\tnewContext.stack = [preStackFrame, ...newContext.stack];\r\n                        preCmdStackFrame && (newContext.cmdStack = [preCmdStackFrame, ...newContext.cmdStack]);\r\n\t\t\t\t\t}\r\n                    const {chapter: nChapter, nIndex, cmdPlotSnap, context: newContext} = this.sceneProxy.getNextPlot(context, chapter, nPlot-1, type, eArg);\r\n\t\t\t\t\tthis.sceneProxy.preloadChapterAssets(newContext, nChapter, nIndex, cmdPlotSnap);\r\n                }\r\n\t\t\t};\r\n\r\n            this.sceneProxy.isGettingNext = true;\r\n            this.endPlot();\r\n\r\n            if (nChapter.md5 && nChapter.plots.length === 0) {\r\n            \tconst chapterUuid = nChapter.downloadUuid ? nChapter.downloadUuid : nChapter.uuid;\r\n            \tif (nChapter.charge && ('android' === flashvars.client || 'ios' === flashvars.client)) {\r\n                    const unlockFinish = (bSuccess, stayIfFail) => {\r\n                        if (bSuccess) {\r\n                            this.sceneProxy.checkIfChapterFree(chapterUuid, nChapter.md5).then((plots)=>{\r\n                                this.sceneProxy.unlockChapterCallBack = null;\r\n                                nChapter.plots = plots;\r\n                                goNext();\r\n                            }, () => {\r\n                            \tDialog.error('获取付费章节信息失败');\r\n                            \tstayCurrentPlot();\r\n                            })\r\n                        } else if (stayIfFail) {\r\n                            stayCurrentPlot();\r\n                        } else {\r\n                            Dialog.error('章节解锁失败');\r\n                            goNext();\r\n                        }\r\n                    };\r\n\r\n                    this.sceneProxy.unlockChapter(chapterUuid, nChapter.charge, nChapter.md5, unlockFinish);\r\n\t\t\t\t} else {\r\n                    this.sceneProxy.checkIfChapterFree(chapterUuid, nChapter.md5).then((plots)=>{\r\n                        nChapter.plots = plots ? plots : [];\r\n                        goNext();\r\n                    }, (msg)=>{\r\n                        if (-1 === msg.indexOf('code=87')) {\r\n                            Dialog.error(msg);\r\n                        } else { // 未购买此章节\r\n                            Dialog.info('当前为收费章节，请前往闪艺app或电脑端进行购买').then(() => stayCurrentPlot(), () => goNext());\r\n                        }\r\n                    })\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n            \tgoNext();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgameOver: function () {\r\n\t\t    //结束调用app接口\r\n            if (flashvars.client === 'ios') {\r\n                if(flashvars.offline === 1){\r\n                    javascript:workFinished('1');\r\n                }else{\r\n                    window.webkit && window.webkit.messageHandlers.workFinished.postMessage('1');\r\n                }\r\n            }\r\n            else if (flashvars.client === 'android') {\r\n                window.app && window.app.workFinished('1');\r\n            }\r\n\t\t\tthis.sceneProxy.showEnd();\r\n\t\t},\r\n\r\n\t\t/** @override */\r\n\t\tonRegister: function ()\r\n\t\t{\r\n\t\t\t// Initialize the TextComponentMediator's view component when its\r\n\t\t\t// registered with the Facade and listen to its TEXT_CHANGED events\r\n\t\t\tthis.setViewComponent( new diygamePlayer.view.component.Scene );\r\n\t\t\tthis.facade.registerMediator(new diygamePlayer.view.mediator.CoverMediator);\r\n\t\t\tthis.facade.registerMediator(new diygamePlayer.view.mediator.SettingsMediator);\r\n\t\t\tthis.facade.registerMediator(new diygamePlayer.view.mediator.MainMenuMediator);\r\n\t\t\tthis.facade.registerMediator(new diygamePlayer.view.mediator.RecordMediator);\r\n\t\t\tthis.facade.registerMediator(new diygamePlayer.view.mediator.PlaybackMediator);\r\n\t\t\tthis.facade.registerMediator(new diygamePlayer.view.mediator.EndMediator);\r\n\r\n\t\t\tvar that = this;\r\n\t\t\tthis.viewComponent.onRendered =(function(){\r\n                that.viewComponent.sceneProxy = that.sceneProxy;\r\n\t\t\t\tthat.sceneProxy.preloadingBegin();\r\n\t\t\t});\r\n\r\n\t\t\t// add the TextComponentMediator as a listener for TEXT_CHANGED events\r\n\t\t\t// when the\r\n\t\t\t//this.viewComponent.addEventListener( diygamePlayer.view.component.Scene.TEXT_CHANGED, this );\r\n\t\t\tthis.sceneProxy = this.facade.retrieveProxy(diygamePlayer.model.proxy.SceneProxy.NAME);\r\n\t\t},\r\n\r\n\t\t/** @override */\r\n\t\tonRemove: function ()\r\n\t\t{\r\n\t\t\t// The TextComponentMediator has been removed from the Facade, and so is no longer\r\n\t\t\t// in use. Clean up by removing event listeners and dereferencing its viewComponent\r\n\t\t\t//this.viewComponent.removeEventListener( diygamePlayer.view.component.Scene.TEXT_CHANGED, this );\r\n\t\t\tthis.setViewComponent(null);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Handle the W3CTextComponent.TEXT_CHANGED event\r\n\t\t * @param {Event} textChangedEvent\r\n\t\t * @return {void}\r\n\t\t */\r\n\t//handleEvent: function (textChangedEvent)\r\n\t//\t{\r\n\t//\t\tthis.sendNotification( diygamePlayer.AppConstants.PROCESS_TEXT, textChangedEvent.text );\r\n\t//\t}\r\n\r\n\t\t, curChapter: null\r\n\t},\r\n\r\n\t// STATIC MEMBERS\r\n\t{\r\n\t\t/**\r\n\t\t * @static\r\n\t\t * @type {string}\r\n\t\t */\r\n\t\tNAME: 'SceneMediator'\r\n\t}\r\n);","/**\r\n * Created by 4399-1126 on 2016/9/13.\r\n */\r\nimport puremvc from 'puremvc';\r\nimport FontUtils from '../../common/FontUtils.js';\r\npuremvc.define\r\n(\r\n    {\r\n        name: 'diygamePlayer.view.mediator.SettingsMediator',\r\n        parent: puremvc.Mediator\r\n    },\r\n    {\r\n        listNotificationInterests: function () {\r\n            return [\r\n                diygamePlayer.AppConstants.SCENE_GOTO_SETTINGS\r\n            ]\r\n        },\r\n\r\n        handleNotification: function (note) {\r\n            const body = note.getBody();\r\n            switch (note.getName()) {\r\n                case diygamePlayer.AppConstants.SCENE_GOTO_SETTINGS:\r\n                    this.callbackInfo = body.callbackInfo;\r\n                    this.showSettingsLayer(body.context);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        },\r\n\r\n        onRegister: function () {\r\n            this.sceneProxy = this.facade.retrieveProxy(diygamePlayer.model.proxy.SceneProxy.NAME);\r\n            const sceneMediator = this.facade.retrieveMediator(diygamePlayer.view.mediator.SceneMediator.NAME);\r\n            this.game = sceneMediator.viewComponent && sceneMediator.viewComponent.game;\r\n            this.viewComponent = sceneMediator.viewComponent;\r\n        },\r\n\r\n        fullMode: function () {\r\n            const {fullMode, windowMode} = this.sceneProxy.json_data.template.json.settings;\r\n            const full = this.sceneProxy.settingsLayer.getByName('settings_button_fullMode');\r\n            const window = this.sceneProxy.settingsLayer.getByName('settings_button_windowMode');\r\n            full && full.changeBackground(fullMode.checked.background.url, fullMode.checked.text);\r\n            window && window.changeBackground(windowMode.unchecked.background.url, windowMode.unchecked.text);\r\n        },\r\n\r\n        windowMode: function () {\r\n            const {fullMode, windowMode} = this.sceneProxy.json_data.template.json.settings;\r\n            const full = this.sceneProxy.settingsLayer.getByName('settings_button_fullMode');\r\n            const window = this.sceneProxy.settingsLayer.getByName('settings_button_windowMode');\r\n            full && full.changeBackground(fullMode.unchecked.background.url, fullMode.unchecked.text);\r\n            window && window.changeBackground(windowMode.checked.background.url, windowMode.checked.text);\r\n        },\r\n\r\n        autoOn: function () {\r\n            const {autoOn, autoOff} = this.sceneProxy.json_data.template.json.settings;\r\n            const on = this.sceneProxy.settingsLayer.getByName('settings_button_autoOn');\r\n            const off = this.sceneProxy.settingsLayer.getByName('settings_button_autoOff');\r\n            on && on.changeBackground(autoOn.checked.background.url, autoOn.checked.text);\r\n            off && off.changeBackground(autoOff.unchecked.background.url, autoOff.unchecked.text);\r\n        },\r\n\r\n        autoOff: function () {\r\n            const {autoOn, autoOff} = this.sceneProxy.json_data.template.json.settings;\r\n            const on = this.sceneProxy.settingsLayer.getByName('settings_button_autoOn');\r\n            const off = this.sceneProxy.settingsLayer.getByName('settings_button_autoOff');\r\n            on && on.changeBackground(autoOn.unchecked.background.url, autoOn.unchecked.text);\r\n            off && off.changeBackground(autoOff.checked.background.url, autoOff.checked.text);\r\n        },\r\n\r\n        addSettings: function () {\r\n            const {background, header, displayHeader, textHeader, displayCaption, textCaption, fullMode, windowMode, autoOn, autoOff, back} = this.sceneProxy.json_data.template.json.settings;\r\n            \r\n            const addTextBk = (bkKey, rc, name) => {\r\n                const key = this.game.load.cache.checkImageKey(bkKey) ? bkKey : '';\r\n                const bk = this.sceneProxy.settingsLayer.create(rc.x, rc.y, key);\r\n                bk.width = rc.width;\r\n                bk.height = rc.height;\r\n                bk.name = name;\r\n            };\r\n\r\n            const addTextContent = (x, y, width, height, content, objText, name) => {\r\n                const fontStyle = {};\r\n                let ff = '';\r\n                ff += objText.fontWeight ? objText.fontWeight + ' ' : 'normal ';\r\n                ff += objText.fontSize ? parseInt(objText.fontSize) + 'px ' : '';\r\n                ff += this.sceneProxy.json_data.font ? this.sceneProxy.json_data.font.fontFamily : objText.fontFamily ? objText.fontFamily : '';\r\n\r\n                fontStyle.font = ff;\r\n                fontStyle.fill = objText.color;\r\n                fontStyle.boundsAlignH = \"center\";\r\n                fontStyle.boundsAlignV = \"middle\";\r\n                fontStyle.stroke = objText.stroke;\r\n                fontStyle.strokeThickness = objText.stroke ? 2 : 0;\r\n\r\n                const txt = this.game.add.text(0, 0, content, fontStyle, this.sceneProxy.settingsLayer);\r\n                txt.name = name;\r\n                if (FontUtils.fontFamily) {\r\n                    const colorS = objText.color ? objText.color : '#fefefe';\r\n                    const fontSize = objText.fontSize ? parseInt(objText.fontSize) : 25;\r\n                    let color = '';\r\n                    if (colorS.indexOf('rgb') !== -1) {\r\n                        const rgb = colorS.replace('rgb(', '').replace(')', '').split(',');\r\n                        color = '0x' + parseInt(rgb[0], 16) + parseInt(rgb[1], 16) + parseInt(rgb[2], 16);\r\n                        color === '0xffffff' && (color = '0xfefefe');\r\n                    }\r\n                    else {\r\n                        color = (colorS === '#ffffff' ? '#fefefe' : colorS).replace('#', '0x');\r\n                    }\r\n                    const fh = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontHeight(fontSize) : fontSize;\r\n                    const fw = this.sceneProxy.json_data.font.size ? this.sceneProxy.toRealImageFontWidth(fontSize) : fontSize;\r\n                    txt.colors.splice(0, txt.colors.length);\r\n                    txt.text = ' ';\r\n                    txt.fill = color;\r\n                    txt.addColor(color, 0);\r\n                    txt.x = x + (width - fw * content.length) / 2;\r\n                    txt.y = y + (height - fh) / 2;\r\n                    txt.wordWrapWidth = fw * (content.length + 1);\r\n                    this.sceneProxy.addImageFontText([{data:content}], fw, fh, txt, this.sceneProxy.context);\r\n                }\r\n                else {\r\n                    txt.setTextBounds(x, y + (txt.height - parseInt(objText.fontSize)) / 2, width, height);\r\n                }\r\n                objText.hidden && (txt.visible = false);\r\n                return txt;\r\n            };\r\n\r\n            const addButton = (obj, name, text, isCheckBox) => {\r\n                const t = {};\r\n                t.normal = isCheckBox ? obj.unchecked.text : obj.normal.text;\r\n                t.active = isCheckBox ? null : obj.active.text;\r\n                t.text = text;\r\n                const btn = this.viewComponent.addButton(obj.rect.x,\r\n                    obj.rect.y,\r\n                    obj.rect.width,\r\n                    obj.rect.height,\r\n                    isCheckBox ? null : obj.normal.background.url,\r\n                    isCheckBox ? null : obj.active.background.url,\r\n                    modeBtnClicked,\r\n                    t,\r\n                    this.sceneProxy.btn_sound,\r\n                    name,\r\n                    this.sceneProxy.settingsLayer,\r\n                    isCheckBox\r\n                );\r\n                isCheckBox && btn.changeBackground(obj.unchecked.background.url, text);\r\n                return btn;\r\n            };\r\n\r\n            const modeBtnClicked = (argv, pointer) => {\r\n                if (pointer.pointerMode === Phaser.PointerMode.CURSOR && pointer.button !== 0) {\r\n                    return;\r\n                }\r\n                if (argv.parent.name === 'settings_button_fullMode') {\r\n                    this.fullMode();\r\n                    this.sceneProxy.onSettingsFullModeBtnClicked();\r\n                }\r\n                else if (argv.parent.name === 'settings_button_windowMode') {\r\n                    this.windowMode();\r\n                    this.sceneProxy.onSettingsWindowModeBtnClicked();\r\n                }\r\n                else if (argv.parent.name === 'settings_button_autoOn') {\r\n                    this.autoOn();\r\n                    this.sceneProxy.onSettingsAutoOnBtnClicked();\r\n                }\r\n                else if (argv.parent.name === 'settings_button_autoOff') {\r\n                    this.autoOff();\r\n                    this.sceneProxy.onSettingsAutoOffBtnClicked();\r\n                }\r\n                else if (argv.parent.name === 'settings_button_back') {\r\n                    this.sceneProxy.onSettingsBackBtnClicked();\r\n                    if (this.callbackInfo) {\r\n                        this.callbackInfo.callbackFun(this.callbackInfo.callbackArgs);\r\n                        this.callbackInfo = null;\r\n                    }\r\n                }\r\n            };\r\n\r\n            const bk = this.sceneProxy.settingsLayer.create(0, 0, this.game.load.cache.checkImageKey(background.url) && background.url);\r\n            bk.width = this.game.world.width;\r\n            bk.height = this.game.world.height;\r\n            bk.name = 'settings_bk_main';\r\n            bk.inputEnabled = true;\r\n\r\n            // header\r\n            addTextBk(header.background.url, header.rect);\r\n            if (header.title.text.hidden != true) {\r\n                addTextContent(header.title.rect.x\r\n                    , header.title.rect.y\r\n                    , header.title.rect.width\r\n                    , header.title.rect.height\r\n                    , this.sceneProxy.stringMap.settings\r\n                    , header.title.text\r\n                    , 'settings_text_header');\r\n            }\r\n\r\n            // displayHeader\r\n            addTextBk(displayHeader.background.url, displayHeader.rect);\r\n            if (!displayHeader.title.text.hidden) {\r\n                addTextContent(displayHeader.title.rect.x + displayHeader.rect.x\r\n                    , displayHeader.title.rect.y + displayHeader.rect.y\r\n                    , displayHeader.title.rect.width\r\n                    , displayHeader.title.rect.height\r\n                    , this.sceneProxy.stringMap.displayHeader\r\n                    , displayHeader.title.text\r\n                    , 'settings_text_displayHeader');\r\n            }\r\n\r\n            // textHeader\r\n            addTextBk(textHeader.background.url, textHeader.rect);\r\n            if (!textHeader.title.text.hidden) {\r\n                addTextContent(textHeader.title.rect.x + textHeader.rect.x\r\n                    , textHeader.title.rect.y + textHeader.rect.y\r\n                    , textHeader.title.rect.width\r\n                    , textHeader.title.rect.height\r\n                    , this.sceneProxy.stringMap.textHeader\r\n                    , textHeader.title.text\r\n                    , 'settings_text_textHeader');\r\n            }\r\n\r\n            // displayCaption\r\n            addTextBk(displayCaption.background.url, displayCaption.rect);\r\n            if (!displayCaption.text.hidden) {\r\n                addTextContent(displayCaption.rect.x\r\n                    , displayCaption.rect.y\r\n                    , displayCaption.rect.width\r\n                    , displayCaption.rect.height\r\n                    , this.sceneProxy.stringMap.displayCaption\r\n                    , displayCaption.text\r\n                    , 'settings_text_displayCaption');\r\n            }\r\n\r\n            // textCaption\r\n            addTextBk(textCaption.background.url, textCaption.rect);\r\n            if (!textCaption.text.hidden) {\r\n                addTextContent(textCaption.rect.x\r\n                    , textCaption.rect.y\r\n                    , textCaption.rect.width\r\n                    , textCaption.rect.height\r\n                    , this.sceneProxy.stringMap.textCaption\r\n                    , textCaption.text\r\n                    , 'settings_text_textCaption');\r\n            }\r\n\r\n            // fullMode\r\n            if (!fullMode.hidden) {\r\n                addButton(fullMode, 'settings_button_fullMode', this.sceneProxy.stringMap.fullMode, true);\r\n            }\r\n\r\n            // window mode\r\n            if (!windowMode.hidden) {\r\n                addButton(windowMode, 'settings_button_windowMode', this.sceneProxy.stringMap.windowMode, true);\r\n            }\r\n\r\n            // autoOn\r\n            if (!autoOn.hidden) {\r\n                addButton(autoOn, 'settings_button_autoOn', this.sceneProxy.stringMap.autoOn, true);\r\n            }\r\n\r\n            // autoOff\r\n            if (!autoOff.hidden) {\r\n                addButton(autoOff, 'settings_button_autoOff', this.sceneProxy.stringMap.autoOff, true);\r\n            }\r\n\r\n            // back\r\n            if (!back.hidden) {\r\n                const btnGroup = addButton(back, 'settings_button_back', this.sceneProxy.stringMap.back);\r\n                btnGroup.button.onInputUp.add(() => this.sceneProxy.btn_sound && this.sceneProxy.btn_sound.stop())\r\n            }\r\n            this.sceneProxy.settingsLayer.visible = false;\r\n        },\r\n\r\n        showSettingsLayer: function (context) {\r\n            if (this.sceneProxy.settingsLayer.children.length === 0) {\r\n                this.addSettings();\r\n            }\r\n            const rectScreenMode = () => {\r\n                if (this.game.scale.isFullScreen) {\r\n                    this.fullMode();\r\n                    context.fullScreen = true;\r\n                } else {\r\n                    this.windowMode();\r\n                    context.fullScreen = false;\r\n                }\r\n            };\r\n            const rectTextMode = () => {\r\n                if (context.auto) {\r\n                    this.autoOn();\r\n                } else {\r\n                    this.autoOff();\r\n                }\r\n            };\r\n            if (!this.fullScreenHandler) {\r\n                this.fullScreenHandler = this.game.scale.onFullScreenChange.add(e => rectScreenMode());\r\n            }\r\n            rectScreenMode();\r\n            rectTextMode();\r\n            this.sceneProxy.settingsLayer.visible = true;\r\n            this.game.world.bringToTop(this.sceneProxy.settingsLayer);\r\n        }\r\n    },\r\n    {\r\n        /**\r\n         * @static\r\n         * @type {string}\r\n         */\r\n        NAME: 'SettingsMediator'\r\n    }\r\n);"]}