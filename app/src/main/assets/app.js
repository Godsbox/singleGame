!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=166)}([function(e,t,n){"use strict";var r=n(16),a=(n(12),n(38),n(21),n(150),function(e){var t={},n=location.search,o=-1!=n.indexOf("?")?n.substr(1).split("&"):[];return o.length&&o.forEach(function(e){var n=e.split("="),a=Object(r.a)(n,2),o=a[0],i=void 0===o?"":o,u=a[1],c=void 0===u?"":u;t[i.toLowerCase()]=c}),(a=function(e){return t[e.toLowerCase()]||""})(e)}),o={};o.gid=a("gid")||a("gameId"),o.uuid=a("uuid"),o.type=a("type"),o.name=a("name"),o.u=a("u"),o.v=a("v"),o.token=a("token"),o.uid=a("uid"),o.client=a("client"),o.offline=1==a("offline"),o.app_name=a("app_name"),o.app_version=a("app_version"),o.device_name=a("device_name"),o.deviceOsVer=a("device_system_version"),o.wap=a("wap"),o.alpha=1==a("alpha"),o.quality=a("quality"),o.single=1==a("single")||2==a("single"),o.singleoffline=2==a("single"),o.qh_username=a("username"),o.qh_serverid=a("serverid"),o.qh_time=a("time"),o.qh_isadult=a("isadult"),o.qh_flag=a("flag"),o.qh_uid=a("unid"),o.qh_qhchannel=a("qhchannel"),o.qh_qhchannelid=a("qhchannelid"),o.qh_qhgid=a("qhgid"),o.qh_key=a("key"),o.qh_nname=decodeURIComponent(a("nname")),o.vertical=1==a("vertical"),o.extend=decodeURIComponent(a("extend")),o.qz_appid="",o.qz_appkey="",o.qz_openid="",o.qz_openkey="",o.qz_userip="",o.qz_pf="",o.qz_invite="",o.qz_invitecount="",o.qz_receivecount=[],o.qz_appurl="",o.qz_vindex="",o.qz_pindex="",o.qz_sharecount=0;var i=o.wap;o.client,o.app_version;o.isWapOther=i&&"3000"!==i&&"zxwwap"!==i&&"wx"!==i,document.title=o.name&&decodeURI(o.name)||"测试",t.a=o},function(e,t,n){"use strict";n(63),n(64),n(14),n(62),n(80),n(140);var r=n(3),a=(n(81),n(13),n(19),n(12),n(33),n(21),n(47),n(48),n(52),n(53),n(8),n(108),n(55),n(38),n(4)),o=n(6),i=n(98),u=n(27),c=n.n(u),s=(n(9),n(0)),l=(n(152),window.Worker);function d(e,t){var r=!1,a=function(e){e.onmessage=e.onerror=null,e.terminate()},o=[document.createElement("canvas"),document.createElement("canvas")],i=o[0],u=o[1],c=i.getContext("2d"),l=u.getContext("2d"),d=null,h=-1,f=null,p=new Promise(function(o,p){var v="pc"===s.a.client?new n(153)():new n(154)(),m=v.filePath;/blob:/i.test(m)&&URL.revokeObjectURL(m),v.postMessage({type:"decompressGif",value:e},[e]),e=null;var g=[];v.onmessage=function(e){var n=e.data,s=n.index,p=n.hasNext,m=n.frame,y=n.loopCount,w=n.frameLength;if(m.patch=new Uint8ClampedArray(m.patch),!s){var b=m.dims,_=b.width,x=b.height;u.width=_,u.height=x,l.clearRect(0,0,_,x),c.clearRect(0,0,_,x)}(function(e,t){var n=t.dims;return d&&n.width==d.width&&n.height==d.height||(i.width=n.width,i.height=n.height,d=c.createImageData(n.width,n.height)),!e||2!==h&&3!==h||l.clearRect(f.left,f.top,f.width,f.height),h=t.disposalType||-1,d.data.set(t.patch),c.putImageData(d,0,0),l.drawImage(i,n.left,n.top),f=n,new Promise(function(e,t){var n=new Image,r=function(){n.onerror=n.onload=null};n.onerror=function(){r(),t()},n.onload=function(){r(),e(n)},n.src=u.toDataURL("image/png")})})(s,m).then(function(e){g[s]={image:e,delay:Math.max(m.delay,15)},s?t(g[s],p):o({frames:g,loopCount:y,parsed:p,frameLength:w}),r?a(v):p?v.postMessage({type:"getFrame",index:s+1}):a(v)})},v.onerror=function(e){console.warn(e),p("gif解析错误(GifWorker.js)"),a(v)}});return p.cancel=function(){return r=!0},p}l&&(window.Worker=function(e){var t=new l(e);return t.filePath=e,t}),n.d(t,"c",function(){return m}),n.d(t,"a",function(){return g}),n.d(t,"b",function(){return y});var h={rainy:{path:"/weather/rain?/xiayu_*.png",count:50},snowy:{path:"/weather/snow?/xuehua_*.png",count:120},windy:{path:"/weather/wind?/feng_*.png",count:20},defoliation:{path:"/weather/mapleLeaves?/fengye_*.png",count:90},fallingPeach:{path:"/weather/beachBlossom?/taohua_*.png",count:90},fallingFlower:{path:"/weather/blossom?/yinghua_*.png",count:90},lightning:{path:"/weather/lightning?/shandian_*.png",count:50}},f=["","ms","O","Moz","webkit"],p={index:0,count:0},v=["apppic.3000test.com","synpic.3000test.com"],m=function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,null,[{key:"base64DatatoBlob",value:function(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),a=new ArrayBuffer(r.length),o=new Uint8Array(a),i=0;i<r.length;i++)o[i]=r.charCodeAt(i);return this.createBlob(o,{type:n})}},{key:"convert",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e=Math.ceil(e);var n,r,a,o,i,u;switch(n=Math.floor(e/3600),r=Math.floor(e/60-60*n),a=Math.floor(e%60),t){case 0:o="",i="",u=(a=a+60*r+3600*n)<=0?"00":a<10?"0"+a:a.toString();break;case 1:o="",i=(r+=60*n)<=0?"00":r<10?"0"+r:r.toString(),u=a<=0?"00":a<10?"0"+a:a.toString();break;case 2:o=n<=0?"00":n<10?"0"+n:n.toString(),i=r<=0?"00":r<10?"0"+r:r.toString(),u=a<=0?"00":a<10?"0"+a:a.toString()}return""===o?""===i?u:i+":"+u:o+":"+i+":"+u}},{key:"dc",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t="",n=0;n<e.length;n++)t+=String["".concat(String.fromCharCode(102)).concat(String.fromCharCode(114)).concat(String.fromCharCode(111)).concat(String.fromCharCode(109)).concat(String.fromCharCode(67)).concat(String.fromCharCode(104)).concat(String.fromCharCode(97)).concat(String.fromCharCode(114)).concat(String.fromCharCode(67)).concat(String.fromCharCode(111)).concat(String.fromCharCode(100)).concat(String.fromCharCode(101))](e[n]);return t}},{key:"switcLoadDomain",value:function(e){if(e.includes(v[0])){p.count>=4?(p.index=(p.index+1)%v.length,p.count=1):p.count++;var t=e.indexOf("coverran")>-1;e=e.replace(v[0],v[t?0:p.index])}return e}},{key:"setElemetStyle",value:function(e,t,n){f.forEach(function(r){return e.style[r?"".concat(r).concat(t[0].toUpperCase()).concat(t.substr(1)):t]=n})}},{key:"getSnap",value:function(){var e=s.a.vertical,t=s.a.client,n=game,r=n.world,a=r.width,o=r.height,i=n.canvas,u=document.createElement("canvas");u.width=a/5,u.height=o/5,game.lockRender=!0;var c=u.getContext("2d"),l=function(){arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(c.save(),c.translate(0,u.height),c.rotate(-90*Math.PI/180),c.drawImage(i,0,4*o/5,a,o,0,4*u.height/5,u.width,u.height),c.drawImage(i,0,0,a,o,0,0,u.width,u.height),c.restore()):c.drawImage(i,0,0,a,o,0,0,u.width,u.height)};return l((window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)>(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)?!("pc"!==t||!e)||!e:e),game.lockRender=!1,u.toDataURL("image/jpeg",.5)}},{key:"fixVolume",value:function(e){return e=(e=e>1?1:e)<0?0:e}},{key:"getSensitiveWords",value:function(){return[]}},{key:"compareVersions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e=e.split(".").map(function(e){return+e}),t=t.split(".").map(function(e){return+e});for(var n=0,r=e.length,a=t.length;n<r&&n<a;){if(e[n]!==t[n])return e[n]-t[n];n++}return n<r?1:n<a?-1:void 0}},{key:"isString",value:function(e){return"[object String]"===Object.prototype.toString.apply(e)}},{key:"isObject",value:function(e){return"[object Object]"===Object.prototype.toString.apply(e)}},{key:"getWeatherUrls",value:function(t){var n=s.a.vertical,r=s.a.offline,a=h[t];if(!a)return[];var o=a.path,i=a.count;o=(o=o.replace("/weather",r?"./img":"/weather")).replace("?",n?"_1":"");for(var u=[],c=0;c<i;c++)u.push(o.replace("*",e.formatNum(c)));return u}},{key:"convertToFullUrl",value:function(e){if(!e)return"";if(e.indexOf("coverran")>-1)return e.indexOf("file://")>-1&&(e=e.replace(/file:\/\//,"https://")),e;if("medium"===s.a.quality&&-1==e.indexOf(".gif")&&-1==e.indexOf("weather")){var t=-1!==e.indexOf(".mp3");e+=t?"~q32":"~q60"}if("http://f1.img4399.com/ma~217_20160518155234_573c1f42bb260.jpeg"===e)return"//apppic.3000test.com/m~web/41/2017/02/08/09_j1sGyq.960x540.jpg";if("/"===e[0]&&(e=e.substring(1)),!/blob:/i.test(e)){var n,r=s.a.offline,a=s.a.gid,o="//apppic.3000test.com/";if(e.indexOf("://")>-1){var i=e.split("/");i.shift(),i.shift(),i.shift(),n="".concat(o).concat(i.join("/"))}else n="".concat(o).concat(e);return r&&(n="game".concat(a,"/").concat(n.replace(o,""))),n}return e}},{key:"spliceGif",value:function(e,t){if(Worker)return d(e,t);var n=!1,a=new Promise(function(t,n){var a,o,i,u=0,c=document.createElement("canvas"),s=document.createElement("canvas"),l=null,d=null,h=null,f=null,p=null,v=1,m=[],g=function(e){return e.reduce(function(e,t){return 2*e+t},0)},y=function(e){for(var t=[],n=7;n>=0;n--)t.push(!!(e&1<<n));return t},w=function(){if(o){var e=c.toDataURL("image/png"),t=new Image;t.src=e,m.push({image:t,delay:10*Math.max(d,10)})}},b={hdr:function(e){var t,n;t=(a=e).width,n=a.height,c.width=t,c.height=n,c.style.width=t+"px",c.style.height=n+"px",c.getContext("2d").setTransform(1,0,0,1,0,0),s.width=t,s.height=t},gce:function(e){w(),l=null,d=null,i=h,h=null,o=null,l=e.transparencyGiven?e.transparencyIndex:null,d=e.delayTime,h=e.disposalMethod},com:function(){},app:{NETSCAPE:function(e){v=e.iterations}},img:function(e){o||(o=c.getContext("2d"));var t=m.length,n=e.lctFlag?e.lct:a.gct;t>0&&(3===i?null!==f?m[f].data&&o.putImageData(m[f].data,0,0):o.clearRect(p.leftPos,p.topPos,p.width,p.height):f=t-1,2===i&&o.clearRect(p.leftPos,p.topPos,p.width,p.height));for(var r=o.getImageData(e.leftPos,e.topPos,e.width,e.height),u=0;u<e.pixels.length;u++){var s=e.pixels[u];if(s!==l){var d=n[s],h=4*u;r.data[h]=d[0],r.data[h+1]=d[1],r.data[h+2]=d[2],r.data[h+3]=255}}o.putImageData(r,e.leftPos,e.topPos),p=e},eof:function(){w()}};try{var _=new function(e){e,u=0,this.readByte=function(){if(u>=e.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[u++]:255&e.charCodeAt(u++)},this.readBytes=function(e){for(var t=[],n=0;n<e;n++)t.push(this.readByte());return t},this.read=function(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}}(new Uint8Array(e));setTimeout(function(e,n){n||(n={});var a=function(t){for(var n=[],r=0;r<t;r++)n.push(e.readBytes(3));return n},o=function(){var t,n,r,a=0;n=new Uint8Array(8192);do{for(t=e.readByte();a+t>n.length;)r=void 0,(r=new Uint8Array(n.length+8192)).set(n),n=r;n.set(e.readBytes(t),a),a+=t}while(0!==t);return n.subarray(0,a)},i=function(t){t.leftPos=e.readUnsigned(),t.topPos=e.readUnsigned(),t.width=e.readUnsigned(),t.height=e.readUnsigned();var i=y(e.readByte());t.lctFlag=i.shift(),t.interlaced=i.shift(),t.sorted=i.shift(),t.reserved=i.splice(0,2),t.lctSize=g(i.splice(0,3)),t.lctFlag&&(t.lct=a(1<<t.lctSize+1)),t.lzwMinCodeSize=e.readByte();var u=o();t.pixels=function(e,t){var n,r,a,o,i,u=0,c=function(e){for(var n=0,r=0;r<e;r++)t[u>>3]&1<<(7&u)&&(n|=1<<r),u++;return n},s=1<<e,l=s+1,d=e+1,h=4096,f=4096,p=new Uint8Array(h),v=new Uint8Array(f),m=[],g=0,y=0,w=function(e,t){for(var n,r,a=m[t].byteLength+1;g+a>v.length;)n=void 0,r=void 0,n=v.length+f,(r=new Uint8Array(n)).set(v),v=r,f<<=1;var o=v.subarray(g,g+a);o.set(m[t]),o[a-1]=m[e][0],g+=a,m.push(o)};for(function(){for(var e=0;e<s;e++)m[e]=new Uint8Array(1),m[e][0]=e;m[s]=new Uint8Array(0),m[l]=null}();;)if(r=n,(n=c(d))!==s){if(n===l)break;if(n<m.length)r!==s&&w(n,r);else{if(n!==m.length)throw new Error("Invalid LZW code.");w(r,r)}for(var b=m[n].length;y+b>p.length;)a=void 0,o=void 0,a=p.length+h,(o=new Uint8Array(a)).set(p),p=o,h<<=1;p.set(m[n],y),y+=b,m.length===1<<d&&d<12&&d++}else i=void 0,i=s+2,m.splice(i,m.length-i),d=e+1,g=0;return p.subarray(0,y)}(t.lzwMinCodeSize,u),t.interlaced&&(t.pixels=function(e,t){for(var n=new Array(e.length),a=e.length/t,o=function(a,o){var i,u=e.slice(o*t,(o+1)*t);n.splice.apply(n,(i=[a*t,t]).concat.apply(i,Object(r.a)(u)))},i=[0,4,2,1],u=[8,8,4,2],c=0,s=0;s<4;s++)for(var l=i[s];l<a;l+=u[s])o(l,c),c++;return n}(t.pixels,t.width)),n.img&&n.img(t)},u=function r(){var a={};switch(a.sentinel=e.readByte(),String.fromCharCode(a.sentinel)){case"!":a.type="ext",function(t){switch(t.label=e.readByte(),t.label){case 249:t.extType="gce",function(t){e.readByte();var r=y(e.readByte());t.reserved=r.splice(0,3),t.disposalMethod=g(r.splice(0,3)),t.userInput=r.shift(),t.transparencyGiven=r.shift(),t.delayTime=e.readUnsigned(),t.transparencyIndex=e.readByte(),t.terminator=e.readByte(),n.gce&&n.gce(t)}(t);break;case 254:t.extType="com",function(e){e.comment=o(),n.com&&n.com(e)}(t);break;case 1:t.extType="pte",function(t){e.readByte(),t.ptHeader=e.readBytes(12),t.ptData=o(),n.pte&&n.pte(t)}(t);break;case 255:t.extType="app",function(t){switch(e.readByte(),t.identifier=e.read(8),t.authCode=e.read(3),t.identifier){case"NETSCAPE":!function(t){e.readByte(),t.unknown=e.readByte(),t.iterations=e.readUnsigned(),t.terminator=e.readByte(),n.app&&n.app.NETSCAPE&&n.app.NETSCAPE(t)}(t);break;default:!function(e){e.appData=o(),n.app&&n.app[e.identifier]&&n.app[e.identifier](e)}(t)}}(t);break;default:t.extType="unknown",function(e){e.data=o(),n.unknown&&n.unknown(e)}(t)}}(a);break;case",":a.type="img",i(a);break;case";":a.type="eof",n.eof&&n.eof(a);break;default:throw new Error("Unknown block: 0x"+a.sentinel.toString(16))}"eof"!==a.type?setTimeout(r,0):t({loopCount:v,frames:m})};!function(){var t={};if(t.sig=e.read(3),t.ver=e.read(3),"GIF"!==t.sig)throw new Error("Not a GIF file.");t.width=e.readUnsigned(),t.height=e.readUnsigned();var r=y(e.readByte());t.gctFlag=r.shift(),t.colorRes=g(r.splice(0,3)),t.sorted=r.shift(),t.gctSize=g(r.splice(0,3)),t.bgColor=e.readByte(),t.pixelAspectRatio=e.readByte(),t.gctFlag&&(t.gct=a(1<<t.gctSize+1)),n.hdr&&n.hdr(t)}(),setTimeout(u,0)}(_,b),0)}catch(e){n(e),console.error("parseGIF ERROR!!"+e)}}).then(function(e){var r=e.frames;e.frames=r.slice(0,1),e.frameLength=r.length,e.parsed=e.frames<=1;var a=function(e){var t=r[e].image;return t.complete?Promise.resolve():new Promise(function(e,n){var r=function(){return t.onerror=t.onload=null};t.onerror=function(){r(),n()},t.onload=function(){r(),e()}})};return a(0).then(function(){return function e(o){return o>=r.length||n?Promise.resolve():a(o).then(function(){return n?Promise.resolve():(t(r[o],o===r.length-1),e(o+1))})}(1),e})});return a.cancel=function(){return n=!0},a}},{key:"isObject",value:function(e){return"[object Object]"===Object.prototype.toString.apply(e)}},{key:"toColorValue",value:function(t){return parseInt(e.formatColor(t).slice(1),16)}},{key:"formatColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=function(e){return"#ffffff"===e.toLowerCase()?"#fefefe":e};if(Number.isInteger(e))return t("#"+Number(e).toString(16));var n=e.match(/rgb\([\s]*(\d+)[\s]*,[\s]*(\d+)[\s]*,[\s]*(\d+)[\s]*\)/i),r=function(e){var t=parseInt(e,10).toString(16);return 2!==t.length?"0"+t:t};return n?t("#"+r(n[1])+r(n[2])+r(n[3])):(e&&"#"!==e[0]&&(e="#"+e),isNaN(parseInt(e.slice(1),16))?"#fefefe":(4===e.length&&(e="#".concat(e[1]).concat(e[1]).concat(e[2]).concat(e[2]).concat(e[3]).concat(e[3])),t(e||"#fefefe")))}},{key:"timeout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=null,n=new Promise(function(n,r){return t=setTimeout(n,e)});return n.cancel=function(){return clearTimeout(t)},n}},{key:"toArrayForData",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=0,a=!1;do{if("\\"!=e[n+r]&&"&"!=e[n+r]||(a=!0),"\n"==e[n+r]){var o=e.substr(n,r);o&&t.push({data:o,placeholder:void 0}),t.push({lineBreak:!0,data:"\n"});break}if(n+r>e.length-1){t.push({data:e.substr(n),placeholder:void 0});break}if(a){var i=e.substr(n,r+1);if(/\\(\d+)\s$/.test(i)){var u=i.lastIndexOf("\\"),c=i.substring(0,u);c&&t.push({data:c,placeholder:void 0}),t.push({placeholder:!0,data:i.substr(u)});break}if(/&(s|v|sv|p|x|i|iv)\[(\d+)\]$/.test(i)){var s=i.lastIndexOf("&"),l=i.substring(0,s);l&&t.push({data:l,placeholder:void 0}),t.push({placeholder:!0,data:i.substr(s)});break}}}while(n+ ++r<=e.length);n+=r}return t}},{key:"timeoutByPhaser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.game).time.events;return new Promise(function(n,r){return t.add(e,n)})}},{key:"createBlob",value:function(e,t){var n,r;try{return new Blob([e],t)}catch(a){if(n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)return(r=new n).append(e),r.getBlob(t);throw new Error("Unable to create blob")}}},{key:"dataURLtoBlob",value:function(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),a=r.length,o=new Uint8Array(a);a--;)o[a]=r.charCodeAt(a);var i=null;try{i=new Blob([o],{type:n})}catch(e){console.error(e.name+"  "+e.message)}return i}},{key:"encodeBase64",value:function(e){return""===e?"":i.Base64.encode(e)}},{key:"decryptBase64",value:function(e){return""===e?"":i.Base64.decode(e)}},{key:"aesEncrypt",value:function(e,t){if(""===e)return"";var n="de3kt|jq|fdcgj_|",r="ff_|pf|#%@fw_j+q";1===t?(n="WDF#$H*#SJN*&G$&",r="JH&$GF$DR%*K@SC%"):2===t?(n="aDF#$HGF$DN*&G$e",r="bH&$GF$DcF#$HSCf"):3===t&&(n="aDF#$HGF$DN*&G$e",r="bH&$GF$DcF#$HSCf");var a=c.a.enc.Utf8.parse(n),o=c.a.enc.Utf8.parse(r);return c.a.AES.encrypt(e+"",a,{iv:o,mode:c.a.mode.CBC,padding:c.a.pad.ZeroPadding}).toString()}},{key:"aesDecrypt",value:function(e,t){if(""===e)return"";var n="de3kt|jq|fdcgj_|",r="ff_|pf|#%@fw_j+q";1===t?(n="WDF#$H*#SJN*&G$&",r="JH&$GF$DR%*K@SC%"):2===t?(n="aDF#$HGF$DN*&G$e",r="bH&$GF$DcF#$HSCf"):4===t&&(n="xiamenshanyi4399",r="");var a=c.a.enc.Utf8.parse(n),o=c.a.enc.Utf8.parse(r);return c.a.AES.decrypt(e,a,{iv:o,mode:4!==t?c.a.mode.CBC:c.a.mode.ECB,padding:c.a.pad.ZeroPadding}).toString(c.a.enc.Utf8)}},{key:"getCookie",value:function(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?decodeURI(t[2]):null}},{key:"getUidByCookie",value:function(){var e=this.getCookie("SYPauth");if(e){var t=e.indexOf("|");e=e.substring(0,t)}return e||""}},{key:"generateUUID",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}},{key:"getDeviceId",value:function(){if("android"===s.a.client){var e=navigator.userAgent.match(/[0-9A-Za-z]{8}-[0-9A-Za-z]{4}-[0-9A-Za-z]{4}-[0-9A-Za-z]{4}-[0-9A-Za-z]{12}/g);return e?e[0]:""}if("ios"===s.a.client){var t=navigator.userAgent.match(/[0-9A-Za-z]{40}/g);return t?t[0]:""}return""}},{key:"formatNum",value:function(e){return 0===e?"00000":e<10?"0000"+e:e<100?"000"+e:"00"+e}}]),e}();m.hasChangeUserFromePc=!1,m.midWayLoginFromePc=!1,m.preUid="",m.typeUnlockRecords=[],m.typePayCount=[],m.typeUnlockChapters=[];var g=function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,null,[{key:"getDate",value:function(){return e.timeStamp+e.passSeconds}},{key:"format",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new Date(e),n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<10?"0".concat(e):e};return"".concat(t.getFullYear(),"-").concat(n(t.getMonth()+1),"-").concat(n(t.getDate())," ").concat(n(t.getHours()),":").concat(n(t.getMinutes()),":").concat(n(t.getSeconds()))}},{key:"getCurDate",value:function(){return e.timeOffset+e.getDate()}},{key:"startlocal",value:function(t){e.timeOffset=t-Math.floor(Date.now()/1e3),e.passSeconds=0}}]),e}();g.timeStamp=Math.floor(Date.now()/1e3),g.passSeconds=0,g.timeOffset=0,setInterval(function(){return g.passSeconds++},1e3);var y=function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,null,[{key:"is",value:function(e){return"[object Number]"===Object.prototype.toString.apply(e)}},{key:"toN",value:function(e){var t=Number(e);return isNaN(t)?0:t}},{key:"toInt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=parseInt(e,t);return isNaN(n)?0:n}},{key:"roundToInt",value:function(e){return Number(e)+.5|0}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(159),a=Object.prototype.hasOwnProperty,o=Array.prototype.splice,i=Object.prototype.toString;function u(e){return i.call(e).slice(8,-1)}var c=Object.assign||function(e,t){return s(t).forEach(function(n){a.call(t,n)&&(e[n]=t[n])}),e},s="function"==typeof Object.getOwnPropertySymbols?function(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.keys(e)};function l(e){return Array.isArray(e)?c(e.constructor(e.length),e):"Map"===u(e)?new Map(e):"Set"===u(e)?new Set(e):e&&"object"==typeof e?c(Object.create(Object.getPrototypeOf(e)),e):e}var d=function(){function e(){this.commands=c({},h),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(e,t){return e===t},this.update.newContext=function(){return(new e).update}}return Object.defineProperty(e.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(e){this.update.isEquals=e},enumerable:!0,configurable:!0}),e.prototype.extend=function(e,t){this.commands[e]=t},e.prototype.update=function(e,t){var n=this,o="function"==typeof t?{$apply:t}:t;Array.isArray(e)&&Array.isArray(o)||r(!Array.isArray(o),"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."),r("object"==typeof o&&null!==o,"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the following commands: %s.",Object.keys(this.commands).join(", "));var i=e;return s(o).forEach(function(t){if(a.call(n.commands,t)){var r=e===i;i=n.commands[t](o[t],i,o,e),r&&n.isEquals(i,e)&&(i=e)}else{var c="Map"===u(e)?n.update(e.get(t),o[t]):n.update(e[t],o[t]),s="Map"===u(i)?i.get(t):i[t];n.isEquals(c,s)&&(void 0!==c||a.call(e,t))||(i===e&&(i=l(e)),"Map"===u(i)?i.set(t,c):i[t]=c)}}),i},e}();t.Context=d;var h={$push:function(e,t,n){return p(t,n,"$push"),e.length?t.concat(e):t},$unshift:function(e,t,n){return p(t,n,"$unshift"),e.length?e.concat(t):t},$splice:function(e,t,n,a){return function(e,t){r(Array.isArray(e),"Expected $splice target to be an array; got %s",e),m(t.$splice)}(t,n),e.forEach(function(e){m(e),t===a&&e.length&&(t=l(a)),o.apply(t,e)}),t},$set:function(e,t,n){return function(e){r(1===Object.keys(e).length,"Cannot have more than one key in an object with $set")}(n),e},$toggle:function(e,t){v(e,"$toggle");var n=e.length?l(t):t;return e.forEach(function(e){n[e]=!t[e]}),n},$unset:function(e,t,n,r){return v(e,"$unset"),e.forEach(function(e){Object.hasOwnProperty.call(t,e)&&(t===r&&(t=l(r)),delete t[e])}),t},$add:function(e,t,n,r){return g(t,"$add"),v(e,"$add"),"Map"===u(t)?e.forEach(function(e){var n=e[0],a=e[1];t===r&&t.get(n)!==a&&(t=l(r)),t.set(n,a)}):e.forEach(function(e){t!==r||t.has(e)||(t=l(r)),t.add(e)}),t},$remove:function(e,t,n,r){return g(t,"$remove"),v(e,"$remove"),e.forEach(function(e){t===r&&t.has(e)&&(t=l(r)),t.delete(e)}),t},$merge:function(e,t,n,a){var o,i;return o=t,r((i=e)&&"object"==typeof i,"update(): $merge expects a spec of type 'object'; got %s",i),r(o&&"object"==typeof o,"update(): $merge expects a target of type 'object'; got %s",o),s(e).forEach(function(n){e[n]!==t[n]&&(t===a&&(t=l(a)),t[n]=e[n])}),t},$apply:function(e,t){var n;return r("function"==typeof(n=e),"update(): expected spec of $apply to be a function; got %s.",n),e(t)}},f=new d;function p(e,t,n){r(Array.isArray(e),"update(): expected target of %s to be an array; got %s.",n,e),v(t[n],n)}function v(e,t){r(Array.isArray(e),"update(): expected spec of %s to be an array; got %s. Did you forget to wrap your parameter in an array?",t,e)}function m(e){r(Array.isArray(e),"update(): expected spec of $splice to be an array of arrays; got %s. Did you forget to wrap your parameters in an array?",e)}function g(e,t){var n=u(e);r("Map"===n||"Set"===n,"update(): %s expects a target of type Set or Map; got %s",t,n)}t.isEquals=f.update.isEquals,t.extend=f.extend,t.default=f.update,t.default.default=e.exports=c(t.default,t)},function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return i});n(13),n(8);var r=n(4),a=n(6),o=n(0),i=(n(162),function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,null,[{key:"showDialog",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;!this.isShow&&(this.isShow=!0);var s=this;return new Promise(function(l,d){var h=function(){document.body.removeChild(f),s.isShow=!1,d("cancel")},f=document.createElement("div");f.classList.add("ModalContainer");var p=document.createElement("div");if(p.classList.add("ModalPortal"),f.appendChild(p),document.body.appendChild(f),document.body.clientWidth<=document.body.clientHeight){var v=o.a.vertical,m=o.a.client;p.style.transform="pc"===m&&v?"rotate(0)":"rotate(90deg)"}var g=function(){document.documentElement.style.fontSize="";var e=o.a.vertical;"pc"===o.a.client&&e||(document.body.clientWidth<=document.body.clientHeight?p.style.transform=e?"rotate(0)":"rotate(90deg)":p.style.transform=e?"rotate(90deg)":"rotate(0)")};window.onresize=function(){g()};var y=document.createElement("div");y.classList.add("Title");var w=document.createElement("span");w.innerText=e;var b=document.createElement("span");b.classList.add("spaceSpan");var _=document.createElement("span");_.classList.add("Close"),_.innerText="×",_.onclick=i?function(){document.body.removeChild(f),s.isShow=!1,d("close")}:h,y.appendChild(w),y.appendChild(b),y.appendChild(_),p.appendChild(y);var x=document.createElement("div");x.classList.add("Content"),p.appendChild(x);var k=document.createElement("div");k.classList.add("ContentData"),n&&k.classList.add(n),r&&(k.align="center"),k.innerText=t,x.appendChild(k);var P=document.createElement("div");P.classList.add("Buttons"),x.appendChild(P);var C=document.createElement("button"),S=document.createElement("button");if(C.classList.add("ButtonOk"),S.classList.add("ButtonsCancel"),C.innerText=r||"确定",S.innerText=a||"取消",P.appendChild(C),P.appendChild(S),C.onclick=function(){document.body.removeChild(f),s.isShow=!1,l("ok")},S.onclick=h,u>0){var O=function e(t,n,r){n<=0?(t.removeAttribute("disabled"),t.style.background="#00bbb8",t.style.backgroundColor="#00bbb8",t.style.border="#00bbb8",t.style.color="#FFFFFF",t.innerText=r):(t.setAttribute("disabled",!0),t.style.background="#8c8c8c",t.style.backgroundColor="#8c8c8c",t.style.color="#FFFFFF",t.style.border="#8c8c8c",t.innerText=n,n--,setTimeout(function(){e(t,n,r)},1e3))};0===c?O(C,u,C.innerText):1===c?O(S,u,S.innerText):2===c&&(O(C,u,C.innerText),O(S,u,S.innerText))}g()})}},{key:"info",value:function(e){if(!this.isShow)return this.showDialog("提示",e,"Info")}},{key:"warn",value:function(e){if(!this.isShow)return this.showDialog("警告",e,"Warn")}},{key:"error",value:function(e){if(!this.isShow)return this.showDialog("错误",e,"Error")}},{key:"custom",value:function(e,t,n,r,a,o,i,u){return this.isShow?Promise.reject():this.showDialog(n,t,e,r,a,o,i,u)}}]),e}())},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",function(){return a})},function(e,t,n){"use strict";n.d(t,"c",function(){return c}),n.d(t,"b",function(){return s}),n.d(t,"a",function(){return l});n(13),n(21),n(20),n(17),n(8),n(26),n(19),n(63);var r=n(1),a=function(e){return"?".concat(o(Object.assgin({_:Date.now()},e)))},o=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object.keys(e).map(function(n){var r=e[n];return t?"".concat(encodeURIComponent(n),"=").concat(r?encodeURIComponent(r):""):"".concat(n,"=").concat(r||"")}).join("&")},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="?"===t[0],r=e.indexOf("?");if(~r){var a=r+1===e.length;return"".concat(e).concat(a?"":"&").concat(t)}return"".concat(e).concat(n?"":"?").concat(t)},u=function(e){var t=e.url,n=e.data,r=void 0===n?"":n,a=e.type,o=void 0===a?"GET":a,i=e.progress,u=void 0===i?null:i,c=e.timeout,s=void 0===c?0:c;return new Promise(function(e,n){var a=window.navigator.userAgent,i=(a.toLowerCase().indexOf("trident/")>-1||a.toLowerCase().indexOf("msie"),function(){var e=null;try{e=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Msxml12.XMLHTTP")}catch(e){console.warn("创建xhr失败！")}return e}());if(null==i)return Promise.reject("创建xhr失败！");i.ontimeout=function(){return s&&n({code:l.TIMEOUT,message:"TimeOut"})},i.onload=function(){var t=i.readyState,r=i.status;try{return 4===t&&r>=400&&r<=599?n({code:l.ERROR,message:"error readyState: ".concat(t,", status: ").concat(r)}):e(i)}catch(e){return n({code:l.ERROR,message:e})}},i.withCredentials=!0,i.onerror=i.onabort=n,u&&(i.onprogress=u),s&&i.timeout&&(i.timeout=s),i.open(o,t,!0),"POST"===o&&i.setRequestHeader("CONTENT-TYPE","application/x-www-form-urlencoded"),i.send(r)})};function c(e){var t=e.url,n=e.data,a=e.progress,i=void 0===a?null:a,c=e.timeout,s=void 0===c?0:c;return r.c.isObject(n)&&(n=o(n,!1)),u({url:t,type:"POST",data:n,progress:i,timeout:s})}function s(e){var t=e.url,n=e.data,o=e.progress,c=void 0===o?null:o,s=e.timeout,l=void 0===s?0:s;return r.c.isObject(n)&&(n=a(n,!1)),n&&(t=i(t,n)),u({url:t,progress:c,timeout:l})}var l={ERROR:999,TIMEOUT:9999}},function(e,t,n){"use strict";var r=n(56),a={};a[n(15)("toStringTag")]="z",a+""!="[object z]"&&n(35)(Object.prototype,"toString",function(){return"[object "+r(this)+"]"},!0)},function(e,t,n){e.exports=n(49)(44)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",function(){return OtherWap}),__webpack_require__.d(__webpack_exports__,"a",function(){return H54399Api});var core_js_modules_es6_array_for_each__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12),core_js_modules_es6_array_for_each__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es6_array_for_each__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(38),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(64),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_array_index_of__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(21),core_js_modules_es6_array_index_of__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_array_index_of__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(52),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_date_to_string__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(53),core_js_modules_es6_date_to_string__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_date_to_string__WEBPACK_IMPORTED_MODULE_6__),_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(4),_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(6),core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(13),core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(8),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_10__),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(33),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(55),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_12__),immutability_helper__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(2),immutability_helper__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(immutability_helper__WEBPACK_IMPORTED_MODULE_13__),spark_md5__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(9),spark_md5__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(spark_md5__WEBPACK_IMPORTED_MODULE_14__),_common_Utils__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(1),_components_Dialog__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(5),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(0),_common_RequestUtils__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(7),encode=function(e,t){return encodeURIComponent(_common_Utils__WEBPACK_IMPORTED_MODULE_15__.c.aesEncrypt(e,t))},onChangeUrlArg=function onChangeUrlArg(url,arg,val){var pattern=arg+"=([^&]*)",replaceText=arg+"="+val;return url.match(pattern)?url.replace(eval("/("+arg+"=)([^&]*)/gi"),replaceText):url.match("[?]")?url+"&"+replaceText:url+"?"+replaceText},QH_SDK="//port.2r3r.com/game/qhjssdk",QH_PLOGIN="https://ptlogin.3000.com/?m=ptlogin&ac=qhlogin",QH_PAY="https://pay.3000.com/qunhei/paydata.php",WX_SDK="https://res.wx.qq.com/open/js/jweixin-1.3.2.js",USER_IP="https://pv.sohu.com/cityjson?ie=utf-8",QZONE_PLOGIN="https://ptlogin.3000.com/?m=ptlogin&ac=wblogin",QZONE_GETSHARECOUNT="https://my.3000.com/index.php?m=WanBa&op=index&ac=userShareCount&api_v=1.0.0&api_from=webpc",QZONE_POSTSHARECOUNT="https://my.3000.com/index.php?m=WanBa&op=index&ac=userShareToOther&api_v=1.0.0&api_from=webpc",QZONE_GETINTIVE="https://my.3000.com/index.php?m=WanBa&op=index&ac=wanbaUserInfo&api_v=1.0.0&api_from=webpc",QZONE_POSTGETPRIZE="https://my.3000.com/index.php?m=WanBa&op=index&ac=upReceiveCount&api_v=1.0.0&api_from=webpc",QZONE_SHARETITLEBYINVITE=["来玩一场惊心动魄的警匪游戏吧！","我执行任务遇到困难了，请求场外援助！","这是什么神仙探案游戏啊，我为男主哭了！！"],QZONE_SHARETITLE=["我在扮演热血警探，来协助我探寻真相吧……","我是一名卧底，快来帮我摆脱困境吧！"],QZONE_SHAREDESC=["玩TVB大剧《铁探》同名游戏，体验纯正港式警匪剧情，智勇双全的警探，热血善良的卧底，因为一颗子弹命运交织携手抗争，他们需要你的帮助！","《铁探》超好玩！改编自TVB同名电视剧，双男主热血勇敢又帅气，却命途坎坷令人心疼，快来陪我一起哭吧QAQ"],QZONE_DOMAIN="api.urlshare.cn",isinvite=!1,loadJS=function(e){return new Promise(function(t,n){var r=document.getElementsByTagName("head").item(0),a=document.createElement("script");a.type="text/javascript",a.src=e,r.appendChild(a),a.onload=function(){return t({code:0,msg:"LOAD JS ".concat(e," SUCCESS")})},a.onerror=function(){return t({code:-1,msg:"LOAD JS ".concat(e," SUCCESS")})}})},OtherWap=function(){function e(){Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_7__.a)(this,e)}return Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_8__.a)(e,null,[{key:"initQHSdk",value:function(){return loadJS(QH_SDK).then(function(e){var t={username:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_username,gid:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_qhgid,qhchannel:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_qhchannel,qhchannelid:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_qhchannelid};return window.qhsdk.init(t),e})}},{key:"qhpay",value:function(e,t,n,r,a,o,i){var u=spark_md5__WEBPACK_IMPORTED_MODULE_14___default.a.hash(e.toString()+_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_username+n+_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_key),c={userId:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_username,gid:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_qhgid,goodsId:t,goodsName:e+"闪币",money:e,roleName:"3000闪艺",ext:n,serverId:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_serverid,sign:u},s=a.payValues,l=JSON.parse(JSON.stringify(s));1===o&&(l[0].name=encodeURI(l[0].name));var d={game_id:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.gid,uuid:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.uuid,chapter_uuid:r,amount:e,set_value:0===o?"":_common_Utils__WEBPACK_IMPORTED_MODULE_15__.c.encodeBase64(JSON.stringify(l)),payindex:o,ext:n,event_id:t,qh_username:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_username,qh_qhgid:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_qhgid};return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_18__.c)({url:QH_PAY,data:JSON.stringify(d),timeout:4e3}),window.qhsdk.pay(c,function(){return console.log("群黑充值返回")}),_common_Utils__WEBPACK_IMPORTED_MODULE_15__.c.timeout(200).then(function(){return 0===o?_components_Dialog__WEBPACK_IMPORTED_MODULE_16__.a.custom("Info","如果购买成功则点击继续观看作品，如果暂不购买则不能继续。","是否支付成功？","已支付成功","暂不购买",!1).then(function(){return"success"},function(){return"cancel"}):_components_Dialog__WEBPACK_IMPORTED_MODULE_16__.a.custom("Info","若已支付成功，作品将会刷新，可读取存档继续观看。若暂不购买，将返回商城。","是否支付成功？","已支付成功","暂不购买",!1).then(function(){return window.location.reload()},function(){})})}},{key:"sendQHData",value:function(){var e={qh_username:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_username,qh_serverid:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_serverid,qh_time:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_time,qh_isadult:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_isadult,qh_flag:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_flag,qh_uid:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_uid,qh_nname:_common_Utils__WEBPACK_IMPORTED_MODULE_15__.c.encodeBase64(_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_nname),qh_qhchannel:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_qhchannel,qh_qhchannelid:_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qh_qhchannelid,refresh_token:1};return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_18__.c)({url:QH_PLOGIN,data:JSON.stringify(e),timeout:4e3}).then(function(e){if(0===e.responseText.length)return Promise.reject("Get failed, no response data");var t=JSON.parse(e.responseText);return 0===t.status&&!0===t.success&&t.data?(_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.uid=t.data.uid,_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.token=t.data.token,_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.u=t.data.u,!0):void 0})}},{key:"initWx",value:function(){return loadJS(WX_SDK)}},{key:"openWxPage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pop",t=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.gid;wx.miniProgram.getEnv(function(n){"pop"===e?wx.miniProgram.redirectTo({url:"/pages/play/main?id=".concat(t,"&").concat(e,"=1")}):"back"===e&&wx.miniProgram.navigateBack({delta:1})})}},{key:"initQzone",value:function(){try{if(-1!==window.location.hostname.indexOf("urlshare.cn")){var t=function(e,t){var n=t.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return null==n||n.length<1?"":n[1]};e.registerQzone(),e.reportLoginQzone();var n=navigator.userAgent,r=n.indexOf("Android")>-1||n.indexOf("Adr")>-1,a=!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return _common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.wap="qzone",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.client=r?"android":a?"ios":"android",e.getLoginInfoQzone().then(function(){return _common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appurl=window.OPEN_DATA.appurl,_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_vindex=t("valuesindex",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_pindex=t("payvaluesindex",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appid=t("qzone_appid",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appkey=t("qzone_appkey",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.gid=t("gid",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.uuid=t("uuid",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.type=t("type",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.name=t("name",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.vertical=1==t("vertical",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.v="1.0.0",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.app_version="1.0.0",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.isWapOther=!0,_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.shareViewName="g6ShareWoK",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.shareViewName1="SHARmkxnxi",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.inviteViewName="INVImkxnxi",_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.refreshViewName="UGTmkxnxi",!0})}return Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}},{key:"getUserIpInfo",value:function(){return loadJS(USER_IP).then(function(){return returnCitySN?returnCitySN.cip:""})}},{key:"registerQzone",value:function(){try{window.reportRegister()}catch(e){console.warn("请在QQ空间玩吧平台注册")}}},{key:"reportLoginQzone",value:function(){try{window.reportLogin()}catch(e){console.warn("请在玩吧QQ空间玩吧平台登入")}}},{key:"getLoginInfoQzone",value:function(){return new Promise(function(e,t){try{var n=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.client;window.getOpenKey(function(t){window.OPEN_DATA.via.indexOf("SHARE");var r=window.OPEN_DATA.shareurl.match(new RegExp("[?&]invite=([^&]+)","i"));_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_openid=window.OPEN_DATA.openid+"_".concat(n),_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_openkey=window.OPEN_DATA.openkey,_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_pf=window.OPEN_DATA.pf,_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.invite=r?r[1]:"",e(t)})}catch(e){console.warn("请在QQ空间玩吧平台使用"),t()}})}},{key:"postUserInfoQzone",value:function(e){var t=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_openid,n=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.invite,r=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.client,a=spark_md5__WEBPACK_IMPORTED_MODULE_14___default.a.hash(spark_md5__WEBPACK_IMPORTED_MODULE_14___default.a.hash(_common_Utils__WEBPACK_IMPORTED_MODULE_15__.c.dc([100,102,36,37,36,35,53,68,70,115,100,100,102,100])));return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_18__.c)({url:QZONE_PLOGIN,data:{openid:t,token:a,invite_openid:n,refresh_token:e,source:r},timeout:4e3}).then(function(e){if(0===e.responseText.length)return!1;var t=JSON.parse(e.responseText).data,n=t.uid,r=t.token,a=t.u;return _common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.uid=n,_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.token=r,_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.u=a,!0})}},{key:"getShareCountQzone",value:function(){var e=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_openid;return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_18__.c)({url:QZONE_GETSHARECOUNT,data:{openid:e},timeout:4e3}).then(function(e){if(0===e.responseText.length)return!1;var t=JSON.parse(e.responseText).data.share_count;return _common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_sharecount=t||0,!0},function(e){return Promise.resolve(!0)})}},{key:"postShareCountQzone",value:function(){var e=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_openid;return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_18__.c)({url:QZONE_POSTSHARECOUNT,data:{openid:encode(e,0)},timeout:4e3}).then(function(e){if(0===e.responseText.length)return!1;var t=JSON.parse(e.responseText).data.share_count;return _common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_sharecount=t||0,!0},function(e){return Promise.resolve(!0)})}},{key:"getIntiveInfoQzone",value:function(){var e=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_openid;return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_18__.c)({url:QZONE_GETINTIVE,data:{openid:e},timeout:4e3}).then(function(e){if(0===e.responseText.length)return!1;JSON.parse(e.responseText);var t=JSON.parse(e.responseText),n=t.status,r=t.data;if(100===n){var a=r.invited_count,o=r.receive_count;return _common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_invitecount=a,_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_receivecount=o.split(","),!0}return!1})}},{key:"postGetPrizeQzone",value:function(){var e="",t=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_openid;return _common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_receivecount.forEach(function(t){return e+=t+","}),e=e.substring(0,e.length-1),Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_18__.c)({url:QZONE_POSTGETPRIZE,data:{openid:encode(t,0),receive_record:encode(e,0)},timeout:4e3})}},{key:"appointShareMessageQzone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{mqq.ui.shareMessage({title:QZONE_SHARETITLE[Math.floor(Math.random()*QZONE_SHARETITLE.length)],desc:QZONE_SHAREDESC[Math.floor(Math.random()*QZONE_SHAREDESC.length)],share_type:e,share_url:window.OPEN_DATA.shareurl,image_url:window.OPEN_DATA.appicon,back:!0},function(){})}catch(e){}}},{key:"openShareMessageQzone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{isinvite=e;var t=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_openid,n=onChangeUrlArg(window.OPEN_DATA.shareurl,"invite",t);mqq.ui.showShareMenu({title:isinvite?QZONE_SHARETITLEBYINVITE[Math.floor(Math.random()*QZONE_SHARETITLEBYINVITE.length)]:QZONE_SHARETITLE[Math.floor(Math.random()*QZONE_SHARETITLE.length)],desc:QZONE_SHAREDESC[Math.floor(Math.random()*QZONE_SHAREDESC.length)],share_url:n,image_url:window.OPEN_DATA.appicon},function(e){return e&&1===e.retCode?Promise.reject():Promise.resolve()})}catch(e){return Promise.reject()}}},{key:"addEventsSharePanelQzone",value:function(t){var n=[],r=t,a=!1;try{var o=_common_Parameter__WEBPACK_IMPORTED_MODULE_17__.a.qz_openid,i=onChangeUrlArg(window.OPEN_DATA.shareurl,"invite",o),u=function(e){isinvite=!1,e=e&&0===e.retCode,0===n.length?r(e):(n.forEach(function(t){return t&&t(e)}),n.length=0)};mqq.ui.setOnShareHandler(function(e){var t={title:isinvite?QZONE_SHARETITLEBYINVITE[Math.floor(Math.random()*QZONE_SHARETITLEBYINVITE.length)]:QZONE_SHARETITLE[Math.floor(Math.random()*QZONE_SHARETITLE.length)],desc:QZONE_SHAREDESC[Math.floor(Math.random()*QZONE_SHAREDESC.length)],share_type:e,share_url:i,image_url:window.OPEN_DATA.appicon,back:!0};mqq.ui.shareMessage(t,u)})}catch(e){a=!0}return e.addEventsSharePanelQzone=function(e){a?e&&e(!1):e&&n.push(e)},e.addEventsSharePanelQzone(t)}}]),e}(),H54399Api=function(){function e(){Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_7__.a)(this,e)}return Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_8__.a)(e,null,[{key:"init4399Api",value:function(){return loadJS("//h.api.4399.com/h5mini-2.0/h5api-interface.php").then(function(e){return Promise.resolve(e)})}},{key:"playAd",value:function(){try{window.h5api.playAd(function(e){if(1e4!==e.code)return 10001===e.code?resolve(1):resolve(0)})}catch(e){return resolve(0)}}},{key:"canPlayAd",value:function(){return new Promise(function(e,t){try{window.h5api.canPlayAd(function(t){if(t){var n=t.canPlayAd,r=parseInt(t.remain);return e({canplay:n,remain:r})}return e({canplay:!1,remain:0})})}catch(t){return e({canplay:!1,remain:0})}})}}]),e}()},function(e,t,n){var r=n(18),a=n(50),o=n(34),i=n(35),u=n(44),c=function(e,t,n){var s,l,d,h,f=e&c.F,p=e&c.G,v=e&c.S,m=e&c.P,g=e&c.B,y=p?r:v?r[t]||(r[t]={}):(r[t]||{}).prototype,w=p?a:a[t]||(a[t]={}),b=w.prototype||(w.prototype={});for(s in p&&(n=t),n)d=((l=!f&&y&&void 0!==y[s])?y:n)[s],h=g&&l?u(d,r):m&&"function"==typeof d?u(Function.call,d):d,y&&i(y,s,d,e&c.U),w[s]!=d&&o(w,s,h),m&&b[s]!=d&&(b[s]=d)};r.core=a,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,n){"use strict";var r=n(11),a=n(45)(0),o=n(46)([].forEach,!0);r(r.P+r.F*!o,"Array",{forEach:function(e){return a(this,e,arguments[1])}})},function(e,t,n){"use strict";var r,a,o,i,u=n(57),c=n(18),s=n(44),l=n(56),d=n(11),h=n(29),f=n(59),p=n(91),v=n(143),m=n(93),g=n(117).set,y=n(146)(),w=n(118),b=n(147),_=n(148),x=n(149),k=c.TypeError,P=c.process,C=P&&P.versions,S=C&&C.v8||"",O=c.Promise,E="process"==l(P),I=function(){},M=a=w.f,A=!!function(){try{var e=O.resolve(1),t=(e.constructor={})[n(15)("species")]=function(e){e(I,I)};return(E||"function"==typeof PromiseRejectionEvent)&&e.then(I)instanceof t&&0!==S.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),V=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},T=function(e,t){if(!e._n){e._n=!0;var n=e._c;y(function(){for(var r=e._v,a=1==e._s,o=0,i=function(t){var n,o,i,u=a?t.ok:t.fail,c=t.resolve,s=t.reject,l=t.domain;try{u?(a||(2==e._h&&R(e),e._h=1),!0===u?n=r:(l&&l.enter(),n=u(r),l&&(l.exit(),i=!0)),n===t.promise?s(k("Promise-chain cycle")):(o=V(n))?o.call(n,c,s):c(n)):s(r)}catch(e){l&&!i&&l.exit(),s(e)}};n.length>o;)i(n[o++]);e._c=[],e._n=!1,t&&!e._h&&j(e)})}},j=function(e){g.call(c,function(){var t,n,r,a=e._v,o=U(e);if(o&&(t=b(function(){E?P.emit("unhandledRejection",a,e):(n=c.onunhandledrejection)?n({promise:e,reason:a}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",a)}),e._h=E||U(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},U=function(e){return 1!==e._h&&0===(e._a||e._c).length},R=function(e){g.call(c,function(){var t;E?P.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},D=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),T(t,!0))},L=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw k("Promise can't be resolved itself");(t=V(e))?y(function(){var r={_w:n,_d:!1};try{t.call(e,s(L,r,1),s(D,r,1))}catch(e){D.call(r,e)}}):(n._v=e,n._s=1,T(n,!1))}catch(e){D.call({_w:n,_d:!1},e)}}};A||(O=function(e){p(this,O,"Promise","_h"),f(e),r.call(this);try{e(s(L,this,1),s(D,this,1))}catch(e){D.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(90)(O.prototype,{then:function(e,t){var n=M(m(this,O));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=E?P.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&T(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=s(L,e,1),this.reject=s(D,e,1)},w.f=M=function(e){return e===O||e===i?new o(e):a(e)}),d(d.G+d.W+d.F*!A,{Promise:O}),n(78)(O,"Promise"),n(94)("Promise"),i=n(50).Promise,d(d.S+d.F*!A,"Promise",{reject:function(e){var t=M(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(u||!A),"Promise",{resolve:function(e){return x(u&&this===i?O:this,e)}}),d(d.S+d.F*!(A&&n(114)(function(e){O.all(e).catch(I)})),"Promise",{all:function(e){var t=this,n=M(t),r=n.resolve,a=n.reject,o=b(function(){var n=[],o=0,i=1;v(e,!1,function(e){var u=o++,c=!1;n.push(void 0),i++,t.resolve(e).then(function(e){c||(c=!0,n[u]=e,--i||r(n))},a)}),--i||r(n)});return o.e&&a(o.v),n.promise},race:function(e){var t=this,n=M(t),r=n.reject,a=b(function(){v(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return a.e&&r(a.v),n.promise}})},function(e,t,n){var r=n(30).f,a=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in a||n(24)&&r(a,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},function(e,t,n){var r=n(84)("wks"),a=n(58),o=n(18).Symbol,i="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=i&&o[e]||(i?o:a)("Symbol."+e))}).store=r},function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";var r=n(60),a=n(128),o=n(51),i=n(61);e.exports=n(101)(Array,"Array",function(e,t){this._t=i(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){"use strict";var r=n(11),a=n(45)(1);r(r.P+r.F*!n(46)([].map,!0),"Array",{map:function(e){return a(this,e,arguments[1])}})},function(e,t,n){for(var r=n(17),a=n(75),o=n(35),i=n(18),u=n(34),c=n(51),s=n(15),l=s("iterator"),d=s("toStringTag"),h=c.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=a(f),v=0;v<p.length;v++){var m,g=p[v],y=f[g],w=i[g],b=w&&w.prototype;if(b&&(b[l]||u(b,l,h),b[d]||u(b,d,g),c[g]=h,y))for(m in r)b[m]||o(b,m,r[m],!0)}},function(e,t,n){"use strict";var r=n(11),a=n(76)(!1),o=[].indexOf,i=!!o&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(i||!n(46)(o)),"Array",{indexOf:function(e){return i?o.apply(this,arguments)||0:a(this,e,arguments[1])}})},function(e,t,n){var r=n(29);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(37),a=Math.min;e.exports=function(e){return e>0?a(r(e),9007199254740991):0}},function(e,t,n){e.exports=!n(25)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(36),a=n(75);n(131)("keys",function(){return function(e){return a(r(e))}})},function(e,t,n){e.exports=n(49)(14)},function(e,t,n){var r=n(11);r(r.S,"Array",{isArray:n(105)})},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(22),a=n(100),o=n(71),i=Object.defineProperty;t.f=n(24)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),a)try{return i(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){"use strict";var r=n(11),a=n(45)(3);r(r.P+r.F*!n(46)([].some,!0),"Array",{some:function(e){return a(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(11),a=n(45)(6),o="findIndex",i=!0;o in[]&&Array(1)[o](function(){i=!1}),r(r.P+r.F*i,"Array",{findIndex:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),n(60)(o)},function(e,t,n){"use strict";var r=n(22),a=n(36),o=n(23),i=n(37),u=n(83),c=n(68),s=Math.max,l=Math.min,d=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,f=/\$([$&`']|\d\d?)/g;n(69)("replace",2,function(e,t,n,p){return[function(r,a){var o=e(this),i=null==r?void 0:r[t];return void 0!==i?i.call(r,o,a):n.call(String(o),r,a)},function(e,t){var a=p(n,e,this,t);if(a.done)return a.value;var d=r(e),h=String(this),f="function"==typeof t;f||(t=String(t));var m=d.global;if(m){var g=d.unicode;d.lastIndex=0}for(var y=[];;){var w=c(d,h);if(null===w)break;if(y.push(w),!m)break;""===String(w[0])&&(d.lastIndex=u(h,o(d.lastIndex),g))}for(var b,_="",x=0,k=0;k<y.length;k++){w=y[k];for(var P=String(w[0]),C=s(l(i(w.index),h.length),0),S=[],O=1;O<w.length;O++)S.push(void 0===(b=w[O])?b:String(b));var E=w.groups;if(f){var I=[P].concat(S,C,h);void 0!==E&&I.push(E);var M=String(t.apply(void 0,I))}else M=v(P,h,C,S,E,t);C>=x&&(_+=h.slice(x,C)+M,x=C+P.length)}return _+h.slice(x)}];function v(e,t,r,o,i,u){var c=r+e.length,s=o.length,l=f;return void 0!==i&&(i=a(i),l=h),n.call(u,l,function(n,a){var u;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(c);case"<":u=i[a.slice(1,-1)];break;default:var l=+a;if(0===l)return n;if(l>s){var h=d(l/10);return 0===h?n:h<=s?void 0===o[h-1]?a.charAt(1):o[h-1]+a.charAt(1):n}u=o[l-1]}return void 0===u?"":u})}})},function(e,t,n){var r=n(30),a=n(72);e.exports=n(24)?function(e,t,n){return r.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(18),a=n(34),o=n(43),i=n(58)("src"),u=n(127),c=(""+u).split("toString");n(50).inspectSource=function(e){return u.call(e)},(e.exports=function(e,t,n,u){var s="function"==typeof n;s&&(o(n,"name")||a(n,"name",t)),e[t]!==n&&(s&&(o(n,i)||a(n,i,e[t]?""+e[t]:c.join(String(t)))),e===r?e[t]=n:u?e[t]?e[t]=n:a(e,t,n):(delete e[t],a(e,t,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[i]||u.call(this)})},function(e,t,n){var r=n(40);e.exports=function(e){return Object(r(e))}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){"use strict";var r=n(89),a=n(22),o=n(93),i=n(83),u=n(23),c=n(68),s=n(85),l=n(25),d=Math.min,h=[].push,f=!l(function(){RegExp(4294967295,"y")});n(69)("split",2,function(e,t,n,l){var p;return p="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,t){var a=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(a,e,t);for(var o,i,u,c=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),d=0,f=void 0===t?4294967295:t>>>0,p=new RegExp(e.source,l+"g");(o=s.call(p,a))&&!((i=p.lastIndex)>d&&(c.push(a.slice(d,o.index)),o.length>1&&o.index<a.length&&h.apply(c,o.slice(1)),u=o[0].length,d=i,c.length>=f));)p.lastIndex===o.index&&p.lastIndex++;return d===a.length?!u&&p.test("")||c.push(""):c.push(a.slice(d)),c.length>f?c.slice(0,f):c}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var a=e(this),o=null==n?void 0:n[t];return void 0!==o?o.call(n,a,r):p.call(String(a),n,r)},function(e,t){var r=l(p,e,this,t,p!==n);if(r.done)return r.value;var s=a(e),h=String(this),v=o(s,RegExp),m=s.unicode,g=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(f?"y":"g"),y=new v(f?s:"^(?:"+s.source+")",g),w=void 0===t?4294967295:t>>>0;if(0===w)return[];if(0===h.length)return null===c(y,h)?[h]:[];for(var b=0,_=0,x=[];_<h.length;){y.lastIndex=f?_:0;var k,P=c(y,f?h:h.slice(_));if(null===P||(k=d(u(y.lastIndex+(f?0:_)),h.length))===b)_=i(h,_,m);else{if(x.push(h.slice(b,_)),x.length===w)return x;for(var C=1;C<=P.length-1;C++)if(x.push(P[C]),x.length===w)return x;_=b=k}}return x.push(h.slice(b)),x}]})},function(e,t,n){"use strict";var r=n(11),a=n(45)(5),o=!0;"find"in[]&&Array(1).find(function(){o=!1}),r(r.P+r.F*o,"Array",{find:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),n(60)("find")},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){"use strict";var r=n(11),a=n(45)(2);r(r.P+r.F*!n(46)([].filter,!0),"Array",{filter:function(e){return a(this,e,arguments[1])}})},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(59);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(44),a=n(73),o=n(36),i=n(23),u=n(132);e.exports=function(e,t){var n=1==e,c=2==e,s=3==e,l=4==e,d=6==e,h=5==e||d,f=t||u;return function(t,u,p){for(var v,m,g=o(t),y=a(g),w=r(u,p,3),b=i(y.length),_=0,x=n?f(t,b):c?f(t,0):void 0;b>_;_++)if((h||_ in y)&&(m=w(v=y[_],_,g),e))if(n)x[_]=m;else if(m)switch(e){case 3:return!0;case 5:return v;case 6:return _;case 2:x.push(v)}else if(l)return!1;return d?-1:s||l?l:x}}},function(e,t,n){"use strict";var r=n(25);e.exports=function(e,t){return!!e&&r(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,n){"use strict";var r=n(11),a=n(76)(!0);r(r.P,"Array",{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),n(60)("includes")},function(e,t,n){"use strict";var r=n(11),a=n(106);r(r.P+r.F*n(107)("includes"),"String",{includes:function(e){return!!~a(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t){e.exports=vendors_library},function(e,t){var n=e.exports={version:"2.6.5"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports={}},function(e,t,n){"use strict";n(134);var r=n(22),a=n(70),o=n(24),i=/./.toString,u=function(e){n(35)(RegExp.prototype,"toString",e,!0)};n(25)(function(){return"/a/b"!=i.call({source:"a",flags:"b"})})?u(function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?a.call(e):void 0)}):"toString"!=i.name&&u(function(){return i.call(this)})},function(e,t,n){var r=Date.prototype,a=r.toString,o=r.getTime;new Date(NaN)+""!="Invalid Date"&&n(35)(r,"toString",function(){var e=o.call(this);return e==e?a.call(this):"Invalid Date"})},function(e,t,n){var r=n(11);r(r.P,"Array",{fill:n(92)}),n(60)("fill")},function(e,t,n){"use strict";var r=n(22),a=n(23),o=n(83),i=n(68);n(69)("match",1,function(e,t,n,u){return[function(n){var r=e(this),a=null==n?void 0:n[t];return void 0!==a?a.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=u(n,e,this);if(t.done)return t.value;var c=r(e),s=String(this);if(!c.global)return i(c,s);var l=c.unicode;c.lastIndex=0;for(var d,h=[],f=0;null!==(d=i(c,s));){var p=String(d[0]);h[f]=p,""===p&&(c.lastIndex=o(s,a(c.lastIndex),l)),f++}return 0===f?null:h}]})},function(e,t,n){var r=n(42),a=n(15)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?n:o?r(t):"Object"==(i=r(t))&&"function"==typeof t.callee?"Arguments":i}},function(e,t){e.exports=!1},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(15)("unscopables"),a=Array.prototype;null==a[r]&&n(34)(a,r,{}),e.exports=function(e){a[r][e]=!0}},function(e,t,n){var r=n(73),a=n(40);e.exports=function(e){return r(a(e))}},function(e,t,n){"use strict";var r=n(11),a=n(61),o=n(37),i=n(23),u=[].lastIndexOf,c=!!u&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(c||!n(46)(u)),"Array",{lastIndexOf:function(e){if(c)return u.apply(this,arguments)||0;var t=a(this),n=i(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,o(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},function(e,t,n){var r=n(11);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,n){var r=n(18),a=n(116),o=n(30).f,i=n(79).f,u=n(89),c=n(70),s=r.RegExp,l=s,d=s.prototype,h=/a/g,f=/a/g,p=new s(h)!==h;if(n(24)&&(!p||n(25)(function(){return f[n(15)("match")]=!1,s(h)!=h||s(f)==f||"/a/i"!=s(h,"i")}))){s=function(e,t){var n=this instanceof s,r=u(e),o=void 0===t;return!n&&r&&e.constructor===s&&o?e:a(p?new l(r&&!o?e.source:e,t):l((r=e instanceof s)?e.source:e,r&&o?c.call(e):t),n?this:d,s)};for(var v=function(e){e in s||o(s,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},m=i(l),g=0;m.length>g;)v(m[g++]);d.constructor=s,s.prototype=d,n(35)(r,"RegExp",s)}n(94)("RegExp")},function(e,t,n){"use strict";var r=n(99)(!0);n(101)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){var r=n(11);r(r.S+r.F,"Object",{assign:n(160)})},function(e,t,n){"use strict";n(97)("bold",function(e){return function(){return e(this,"b","","")}})},function(e,t,n){"use strict";var r=n(56),a=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var o=n.call(e,t);if("object"!=typeof o)throw new TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return a.call(e,t)}},function(e,t,n){"use strict";n(126);var r=n(35),a=n(34),o=n(25),i=n(40),u=n(15),c=n(85),s=u("species"),l=!o(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),d=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var h=u(e),f=!o(function(){var t={};return t[h]=function(){return 7},7!=""[e](t)}),p=f?!o(function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[s]=function(){return n}),n[h](""),!t}):void 0;if(!f||!p||"replace"===e&&!l||"split"===e&&!d){var v=/./[h],m=n(i,h,""[e],function(e,t,n,r,a){return t.exec===c?f&&!a?{done:!0,value:v.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),g=m[0],y=m[1];r(String.prototype,e,g),a(RegExp.prototype,h,2==t?function(e,t){return y.call(e,this,t)}:function(e){return y.call(e,this)})}}},function(e,t,n){"use strict";var r=n(22);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){var r=n(29);e.exports=function(e,t){if(!r(e))return e;var n,a;if(t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;if("function"==typeof(n=e.valueOf)&&!r(a=n.call(e)))return a;if(!t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(42);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(22),a=n(130),o=n(88),i=n(87)("IE_PROTO"),u=function(){},c=function(){var e,t=n(86)("iframe"),r=o.length;for(t.style.display="none",n(103).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;r--;)delete c.prototype[o[r]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(u.prototype=r(e),n=new u,u.prototype=null,n[i]=e):n=c(),void 0===t?n:a(n,t)}},function(e,t,n){var r=n(102),a=n(88);e.exports=Object.keys||function(e){return r(e,a)}},function(e,t,n){var r=n(61),a=n(23),o=n(77);e.exports=function(e){return function(t,n,i){var u,c=r(t),s=a(c.length),l=o(i,s);if(e&&n!=n){for(;s>l;)if((u=c[l++])!=u)return!0}else for(;s>l;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var r=n(37),a=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?a(e+t,0):o(e,t)}},function(e,t,n){var r=n(30).f,a=n(43),o=n(15)("toStringTag");e.exports=function(e,t,n){e&&!a(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t,n){var r=n(102),a=n(88).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,a)}},function(e,t,n){"use strict";var r=n(18),a=n(43),o=n(42),i=n(116),u=n(71),c=n(25),s=n(79).f,l=n(95).f,d=n(30).f,h=n(138).trim,f=r.Number,p=f,v=f.prototype,m="Number"==o(n(74)(v)),g="trim"in String.prototype,y=function(e){var t=u(e,!1);if("string"==typeof t&&t.length>2){var n,r,a,o=(t=g?t.trim():h(t,3)).charCodeAt(0);if(43===o||45===o){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:r=2,a=49;break;case 79:case 111:r=8,a=55;break;default:return+t}for(var i,c=t.slice(2),s=0,l=c.length;s<l;s++)if((i=c.charCodeAt(s))<48||i>a)return NaN;return parseInt(c,r)}}return+t};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof f&&(m?c(function(){v.valueOf.call(n)}):"Number"!=o(n))?i(new p(y(t)),n,f):y(t)};for(var w,b=n(24)?s(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),_=0;b.length>_;_++)a(p,w=b[_])&&!a(f,w)&&d(f,w,l(p,w));f.prototype=v,v.constructor=f,n(35)(r,"Number",f)}},function(e,t,n){"use strict";var r=n(11),a=n(142);r(r.P+r.F*!n(46)([].reduce,!0),"Array",{reduce:function(e){return a(this,e,arguments.length,arguments[1],!1)}})},function(e,t,n){"use strict";var r=n(11),a=n(23),o=n(106),i="".startsWith;r(r.P+r.F*n(107)("startsWith"),"String",{startsWith:function(e){var t=o(this,e,"startsWith"),n=a(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return i?i.call(t,r,n):t.slice(n,n+r.length)===r}})},function(e,t,n){"use strict";var r=n(99)(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},function(e,t,n){var r=n(50),a=n(18),o=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(57)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){"use strict";var r,a,o=n(70),i=RegExp.prototype.exec,u=String.prototype.replace,c=i,s=(r=/a/,a=/b*/g,i.call(r,"a"),i.call(a,"a"),0!==r.lastIndex||0!==a.lastIndex),l=void 0!==/()??/.exec("")[1];(s||l)&&(c=function(e){var t,n,r,a,c=this;return l&&(n=new RegExp("^"+c.source+"$(?!\\s)",o.call(c))),s&&(t=c.lastIndex),r=i.call(c,e),s&&r&&(c.lastIndex=c.global?r.index+r[0].length:t),l&&r&&r.length>1&&u.call(r[0],n,function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(r[a]=void 0)}),r}),e.exports=c},function(e,t,n){var r=n(29),a=n(18).document,o=r(a)&&r(a.createElement);e.exports=function(e){return o?a.createElement(e):{}}},function(e,t,n){var r=n(84)("keys"),a=n(58);e.exports=function(e){return r[e]||(r[e]=a(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(29),a=n(42),o=n(15)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==a(e))}},function(e,t,n){var r=n(35);e.exports=function(e,t,n){for(var a in t)r(e,a,t[a],n);return e}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){"use strict";var r=n(36),a=n(77),o=n(23);e.exports=function(e){for(var t=r(this),n=o(t.length),i=arguments.length,u=a(i>1?arguments[1]:void 0,n),c=i>2?arguments[2]:void 0,s=void 0===c?n:a(c,n);s>u;)t[u++]=e;return t}},function(e,t,n){var r=n(22),a=n(59),o=n(15)("species");e.exports=function(e,t){var n,i=r(e).constructor;return void 0===i||null==(n=r(i)[o])?t:a(n)}},function(e,t,n){"use strict";var r=n(18),a=n(30),o=n(24),i=n(15)("species");e.exports=function(e){var t=r[e];o&&t&&!t[i]&&a.f(t,i,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(115),a=n(72),o=n(61),i=n(71),u=n(43),c=n(100),s=Object.getOwnPropertyDescriptor;t.f=n(24)?s:function(e,t){if(e=o(e),t=i(t,!0),c)try{return s(e,t)}catch(e){}if(u(e,t))return a(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(11);r(r.S,"Object",{create:n(74)})},function(e,t,n){var r=n(11),a=n(25),o=n(40),i=/"/g,u=function(e,t,n,r){var a=String(o(e)),u="<"+t;return""!==n&&(u+=" "+n+'="'+String(r).replace(i,"&quot;")+'"'),u+">"+a+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(u),r(r.P+r.F*a(function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}),"String",n)}},function(e,t,n){e.exports=n(49)(38)},function(e,t,n){var r=n(37),a=n(40);e.exports=function(e){return function(t,n){var o,i,u=String(a(t)),c=r(n),s=u.length;return c<0||c>=s?e?"":void 0:(o=u.charCodeAt(c))<55296||o>56319||c+1===s||(i=u.charCodeAt(c+1))<56320||i>57343?e?u.charAt(c):o:e?u.slice(c,c+2):i-56320+(o-55296<<10)+65536}}},function(e,t,n){e.exports=!n(24)&&!n(25)(function(){return 7!=Object.defineProperty(n(86)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){"use strict";var r=n(57),a=n(11),o=n(35),i=n(34),u=n(51),c=n(129),s=n(78),l=n(104),d=n(15)("iterator"),h=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,p,v,m,g){c(n,t,p);var y,w,b,_=function(e){if(!h&&e in C)return C[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},x=t+" Iterator",k="values"==v,P=!1,C=e.prototype,S=C[d]||C["@@iterator"]||v&&C[v],O=S||_(v),E=v?k?_("entries"):O:void 0,I="Array"==t&&C.entries||S;if(I&&(b=l(I.call(new e)))!==Object.prototype&&b.next&&(s(b,x,!0),r||"function"==typeof b[d]||i(b,d,f)),k&&S&&"values"!==S.name&&(P=!0,O=function(){return S.call(this)}),r&&!g||!h&&!P&&C[d]||i(C,d,O),u[t]=O,u[x]=f,v)if(y={values:k?O:_("values"),keys:m?O:_("keys"),entries:E},g)for(w in y)w in C||o(C,w,y[w]);else a(a.P+a.F*(h||P),t,y);return y}},function(e,t,n){var r=n(43),a=n(61),o=n(76)(!1),i=n(87)("IE_PROTO");e.exports=function(e,t){var n,u=a(e),c=0,s=[];for(n in u)n!=i&&r(u,n)&&s.push(n);for(;t.length>c;)r(u,n=t[c++])&&(~o(s,n)||s.push(n));return s}},function(e,t,n){var r=n(18).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(43),a=n(36),o=n(87)("IE_PROTO"),i=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?i:null}},function(e,t,n){var r=n(42);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(89),a=n(40);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(a(e))}},function(e,t,n){var r=n(15)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,n){n(109)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){"use strict";if(n(24)){var r=n(57),a=n(18),o=n(25),i=n(11),u=n(110),c=n(135),s=n(44),l=n(91),d=n(72),h=n(34),f=n(90),p=n(37),v=n(23),m=n(111),g=n(77),y=n(71),w=n(43),b=n(56),_=n(29),x=n(36),k=n(112),P=n(74),C=n(104),S=n(79).f,O=n(113),E=n(58),I=n(15),M=n(45),A=n(76),V=n(93),T=n(17),j=n(51),U=n(114),R=n(94),D=n(92),L=n(136),B=n(30),F=n(95),W=B.f,N=F.f,$=a.RangeError,z=a.TypeError,H=a.Uint8Array,q=Array.prototype,G=c.ArrayBuffer,K=c.DataView,J=M(0),Q=M(2),Y=M(3),Z=M(4),X=M(5),ee=M(6),te=A(!0),ne=A(!1),re=T.values,ae=T.keys,oe=T.entries,ie=q.lastIndexOf,ue=q.reduce,ce=q.reduceRight,se=q.join,le=q.sort,de=q.slice,he=q.toString,fe=q.toLocaleString,pe=I("iterator"),ve=I("toStringTag"),me=E("typed_constructor"),ge=E("def_constructor"),ye=u.CONSTR,we=u.TYPED,be=u.VIEW,_e=M(1,function(e,t){return Se(V(e,e[ge]),t)}),xe=o(function(){return 1===new H(new Uint16Array([1]).buffer)[0]}),ke=!!H&&!!H.prototype.set&&o(function(){new H(1).set({})}),Pe=function(e,t){var n=p(e);if(n<0||n%t)throw $("Wrong offset!");return n},Ce=function(e){if(_(e)&&we in e)return e;throw z(e+" is not a typed array!")},Se=function(e,t){if(!(_(e)&&me in e))throw z("It is not a typed array constructor!");return new e(t)},Oe=function(e,t){return Ee(V(e,e[ge]),t)},Ee=function(e,t){for(var n=0,r=t.length,a=Se(e,r);r>n;)a[n]=t[n++];return a},Ie=function(e,t,n){W(e,t,{get:function(){return this._d[n]}})},Me=function(e){var t,n,r,a,o,i,u=x(e),c=arguments.length,l=c>1?arguments[1]:void 0,d=void 0!==l,h=O(u);if(null!=h&&!k(h)){for(i=h.call(u),r=[],t=0;!(o=i.next()).done;t++)r.push(o.value);u=r}for(d&&c>2&&(l=s(l,arguments[2],2)),t=0,n=v(u.length),a=Se(this,n);n>t;t++)a[t]=d?l(u[t],t):u[t];return a},Ae=function(){for(var e=0,t=arguments.length,n=Se(this,t);t>e;)n[e]=arguments[e++];return n},Ve=!!H&&o(function(){fe.call(new H(1))}),Te=function(){return fe.apply(Ve?de.call(Ce(this)):Ce(this),arguments)},je={copyWithin:function(e,t){return L.call(Ce(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return Z(Ce(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return D.apply(Ce(this),arguments)},filter:function(e){return Oe(this,Q(Ce(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return X(Ce(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Ce(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){J(Ce(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ne(Ce(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Ce(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return se.apply(Ce(this),arguments)},lastIndexOf:function(e){return ie.apply(Ce(this),arguments)},map:function(e){return _e(Ce(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return ue.apply(Ce(this),arguments)},reduceRight:function(e){return ce.apply(Ce(this),arguments)},reverse:function(){for(var e,t=Ce(this).length,n=Math.floor(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return Y(Ce(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return le.call(Ce(this),e)},subarray:function(e,t){var n=Ce(this),r=n.length,a=g(e,r);return new(V(n,n[ge]))(n.buffer,n.byteOffset+a*n.BYTES_PER_ELEMENT,v((void 0===t?r:g(t,r))-a))}},Ue=function(e,t){return Oe(this,de.call(Ce(this),e,t))},Re=function(e){Ce(this);var t=Pe(arguments[1],1),n=this.length,r=x(e),a=v(r.length),o=0;if(a+t>n)throw $("Wrong length!");for(;o<a;)this[t+o]=r[o++]},De={entries:function(){return oe.call(Ce(this))},keys:function(){return ae.call(Ce(this))},values:function(){return re.call(Ce(this))}},Le=function(e,t){return _(e)&&e[we]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Be=function(e,t){return Le(e,t=y(t,!0))?d(2,e[t]):N(e,t)},Fe=function(e,t,n){return!(Le(e,t=y(t,!0))&&_(n)&&w(n,"value"))||w(n,"get")||w(n,"set")||n.configurable||w(n,"writable")&&!n.writable||w(n,"enumerable")&&!n.enumerable?W(e,t,n):(e[t]=n.value,e)};ye||(F.f=Be,B.f=Fe),i(i.S+i.F*!ye,"Object",{getOwnPropertyDescriptor:Be,defineProperty:Fe}),o(function(){he.call({})})&&(he=fe=function(){return se.call(this)});var We=f({},je);f(We,De),h(We,pe,De.values),f(We,{slice:Ue,set:Re,constructor:function(){},toString:he,toLocaleString:Te}),Ie(We,"buffer","b"),Ie(We,"byteOffset","o"),Ie(We,"byteLength","l"),Ie(We,"length","e"),W(We,ve,{get:function(){return this[we]}}),e.exports=function(e,t,n,c){var s=e+((c=!!c)?"Clamped":"")+"Array",d="get"+e,f="set"+e,p=a[s],g=p||{},y=p&&C(p),w=!p||!u.ABV,x={},k=p&&p.prototype,O=function(e,n){W(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[d](n*t+r.o,xe)}(this,n)},set:function(e){return function(e,n,r){var a=e._d;c&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),a.v[f](n*t+a.o,r,xe)}(this,n,e)},enumerable:!0})};w?(p=n(function(e,n,r,a){l(e,p,s,"_d");var o,i,u,c,d=0,f=0;if(_(n)){if(!(n instanceof G||"ArrayBuffer"==(c=b(n))||"SharedArrayBuffer"==c))return we in n?Ee(p,n):Me.call(p,n);o=n,f=Pe(r,t);var g=n.byteLength;if(void 0===a){if(g%t)throw $("Wrong length!");if((i=g-f)<0)throw $("Wrong length!")}else if((i=v(a)*t)+f>g)throw $("Wrong length!");u=i/t}else u=m(n),o=new G(i=u*t);for(h(e,"_d",{b:o,o:f,l:i,e:u,v:new K(o)});d<u;)O(e,d++)}),k=p.prototype=P(We),h(k,"constructor",p)):o(function(){p(1)})&&o(function(){new p(-1)})&&U(function(e){new p,new p(null),new p(1.5),new p(e)},!0)||(p=n(function(e,n,r,a){var o;return l(e,p,s),_(n)?n instanceof G||"ArrayBuffer"==(o=b(n))||"SharedArrayBuffer"==o?void 0!==a?new g(n,Pe(r,t),a):void 0!==r?new g(n,Pe(r,t)):new g(n):we in n?Ee(p,n):Me.call(p,n):new g(m(n))}),J(y!==Function.prototype?S(g).concat(S(y)):S(g),function(e){e in p||h(p,e,g[e])}),p.prototype=k,r||(k.constructor=p));var E=k[pe],I=!!E&&("values"==E.name||null==E.name),M=De.values;h(p,me,!0),h(k,we,s),h(k,be,!0),h(k,ge,p),(c?new p(1)[ve]==s:ve in k)||W(k,ve,{get:function(){return s}}),x[s]=p,i(i.G+i.W+i.F*(p!=g),x),i(i.S,s,{BYTES_PER_ELEMENT:t}),i(i.S+i.F*o(function(){g.of.call(p,1)}),s,{from:Me,of:Ae}),"BYTES_PER_ELEMENT"in k||h(k,"BYTES_PER_ELEMENT",t),i(i.P,s,je),R(s),i(i.P+i.F*ke,s,{set:Re}),i(i.P+i.F*!I,s,De),r||k.toString==he||(k.toString=he),i(i.P+i.F*o(function(){new p(1).slice()}),s,{slice:Ue}),i(i.P+i.F*(o(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!o(function(){k.toLocaleString.call([1,2])})),s,{toLocaleString:Te}),j[s]=I?E:M,r||I||h(k,pe,M)}}else e.exports=function(){}},function(e,t,n){for(var r,a=n(18),o=n(34),i=n(58),u=i("typed_array"),c=i("view"),s=!(!a.ArrayBuffer||!a.DataView),l=s,d=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");d<9;)(r=a[h[d++]])?(o(r.prototype,u,!0),o(r.prototype,c,!0)):l=!1;e.exports={ABV:s,CONSTR:l,TYPED:u,VIEW:c}},function(e,t,n){var r=n(37),a=n(23);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=a(t);if(t!==n)throw RangeError("Wrong length!");return n}},function(e,t,n){var r=n(51),a=n(15)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[a]===e)}},function(e,t,n){var r=n(56),a=n(15)("iterator"),o=n(51);e.exports=n(50).getIteratorMethod=function(e){if(null!=e)return e[a]||e["@@iterator"]||o[r(e)]}},function(e,t,n){var r=n(15)("iterator"),a=!1;try{var o=[7][r]();o.return=function(){a=!0},Array.from(o,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!a)return!1;var n=!1;try{var o=[7],i=o[r]();i.next=function(){return{done:n=!0}},o[r]=function(){return i},e(o)}catch(e){}return n}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(29),a=n(137).set;e.exports=function(e,t,n){var o,i=t.constructor;return i!==n&&"function"==typeof i&&(o=i.prototype)!==n.prototype&&r(o)&&a&&a(e,o),e}},function(e,t,n){var r,a,o,i=n(44),u=n(145),c=n(103),s=n(86),l=n(18),d=l.process,h=l.setImmediate,f=l.clearImmediate,p=l.MessageChannel,v=l.Dispatch,m=0,g={},y=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},w=function(e){y.call(e.data)};h&&f||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return g[++m]=function(){u("function"==typeof e?e:Function(e),t)},r(m),m},f=function(e){delete g[e]},"process"==n(42)(d)?r=function(e){d.nextTick(i(y,e,1))}:v&&v.now?r=function(e){v.now(i(y,e,1))}:p?(o=(a=new p).port2,a.port1.onmessage=w,r=i(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",w,!1)):r="onreadystatechange"in s("script")?function(e){c.appendChild(s("script")).onreadystatechange=function(){c.removeChild(this),y.call(e)}}:function(e){setTimeout(i(y,e,1),0)}),e.exports={set:h,clear:f}},function(e,t,n){"use strict";var r=n(59);function a(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new a(e)}},function(e,t,n){"use strict";n(97)("anchor",function(e){return function(t){return e(this,"a","name",t)}})},function(e,t,n){var r=n(11);r(r.S+r.F*!n(24),"Object",{defineProperty:n(30).f})},function(e,t,n){var r=n(11);r(r.P,"String",{repeat:n(163)})},function(e,t,n){"use strict";n(97)("sub",function(e){return function(){return e(this,"sub","","")}})},function(e,t,n){e.exports=n(49)(40)},function(e,t,n){e.exports=n(49)(12)},function(e,t){},function(e,t,n){"use strict";var r=n(85);n(11)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(e,t,n){e.exports=n(84)("native-function-to-string",Function.toString)},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";var r=n(74),a=n(72),o=n(78),i={};n(34)(i,n(15)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(i,{next:a(1,n)}),o(e,t+" Iterator")}},function(e,t,n){var r=n(30),a=n(22),o=n(75);e.exports=n(24)?Object.defineProperties:function(e,t){a(e);for(var n,i=o(t),u=i.length,c=0;u>c;)r.f(e,n=i[c++],t[n]);return e}},function(e,t,n){var r=n(11),a=n(50),o=n(25);e.exports=function(e,t){var n=(a.Object||{})[e]||Object[e],i={};i[e]=t(n),r(r.S+r.F*o(function(){n(1)}),"Object",i)}},function(e,t,n){var r=n(133);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(29),a=n(105),o=n(15)("species");e.exports=function(e){var t;return a(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!a(t.prototype)||(t=void 0),r(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){n(24)&&"g"!=/./g.flags&&n(30).f(RegExp.prototype,"flags",{configurable:!0,get:n(70)})},function(e,t,n){"use strict";var r=n(18),a=n(24),o=n(57),i=n(110),u=n(34),c=n(90),s=n(25),l=n(91),d=n(37),h=n(23),f=n(111),p=n(79).f,v=n(30).f,m=n(92),g=n(78),y="prototype",w="Wrong index!",b=r.ArrayBuffer,_=r.DataView,x=r.Math,k=r.RangeError,P=r.Infinity,C=b,S=x.abs,O=x.pow,E=x.floor,I=x.log,M=x.LN2,A=a?"_b":"buffer",V=a?"_l":"byteLength",T=a?"_o":"byteOffset";function j(e,t,n){var r,a,o,i=new Array(n),u=8*n-t-1,c=(1<<u)-1,s=c>>1,l=23===t?O(2,-24)-O(2,-77):0,d=0,h=e<0||0===e&&1/e<0?1:0;for((e=S(e))!=e||e===P?(a=e!=e?1:0,r=c):(r=E(I(e)/M),e*(o=O(2,-r))<1&&(r--,o*=2),(e+=r+s>=1?l/o:l*O(2,1-s))*o>=2&&(r++,o/=2),r+s>=c?(a=0,r=c):r+s>=1?(a=(e*o-1)*O(2,t),r+=s):(a=e*O(2,s-1)*O(2,t),r=0));t>=8;i[d++]=255&a,a/=256,t-=8);for(r=r<<t|a,u+=t;u>0;i[d++]=255&r,r/=256,u-=8);return i[--d]|=128*h,i}function U(e,t,n){var r,a=8*n-t-1,o=(1<<a)-1,i=o>>1,u=a-7,c=n-1,s=e[c--],l=127&s;for(s>>=7;u>0;l=256*l+e[c],c--,u-=8);for(r=l&(1<<-u)-1,l>>=-u,u+=t;u>0;r=256*r+e[c],c--,u-=8);if(0===l)l=1-i;else{if(l===o)return r?NaN:s?-P:P;r+=O(2,t),l-=i}return(s?-1:1)*r*O(2,l-t)}function R(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function D(e){return[255&e]}function L(e){return[255&e,e>>8&255]}function B(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function F(e){return j(e,52,8)}function W(e){return j(e,23,4)}function N(e,t,n){v(e[y],t,{get:function(){return this[n]}})}function $(e,t,n,r){var a=f(+n);if(a+t>e[V])throw k(w);var o=e[A]._b,i=a+e[T],u=o.slice(i,i+t);return r?u:u.reverse()}function z(e,t,n,r,a,o){var i=f(+n);if(i+t>e[V])throw k(w);for(var u=e[A]._b,c=i+e[T],s=r(+a),l=0;l<t;l++)u[c+l]=s[o?l:t-l-1]}if(i.ABV){if(!s(function(){b(1)})||!s(function(){new b(-1)})||s(function(){return new b,new b(1.5),new b(NaN),"ArrayBuffer"!=b.name})){for(var H,q=(b=function(e){return l(this,b),new C(f(e))})[y]=C[y],G=p(C),K=0;G.length>K;)(H=G[K++])in b||u(b,H,C[H]);o||(q.constructor=b)}var J=new _(new b(2)),Q=_[y].setInt8;J.setInt8(0,2147483648),J.setInt8(1,2147483649),!J.getInt8(0)&&J.getInt8(1)||c(_[y],{setInt8:function(e,t){Q.call(this,e,t<<24>>24)},setUint8:function(e,t){Q.call(this,e,t<<24>>24)}},!0)}else b=function(e){l(this,b,"ArrayBuffer");var t=f(e);this._b=m.call(new Array(t),0),this[V]=t},_=function(e,t,n){l(this,_,"DataView"),l(e,b,"DataView");var r=e[V],a=d(t);if(a<0||a>r)throw k("Wrong offset!");if(a+(n=void 0===n?r-a:h(n))>r)throw k("Wrong length!");this[A]=e,this[T]=a,this[V]=n},a&&(N(b,"byteLength","_l"),N(_,"buffer","_b"),N(_,"byteLength","_l"),N(_,"byteOffset","_o")),c(_[y],{getInt8:function(e){return $(this,1,e)[0]<<24>>24},getUint8:function(e){return $(this,1,e)[0]},getInt16:function(e){var t=$(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=$(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return R($(this,4,e,arguments[1]))},getUint32:function(e){return R($(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return U($(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return U($(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){z(this,1,e,D,t)},setUint8:function(e,t){z(this,1,e,D,t)},setInt16:function(e,t){z(this,2,e,L,t,arguments[2])},setUint16:function(e,t){z(this,2,e,L,t,arguments[2])},setInt32:function(e,t){z(this,4,e,B,t,arguments[2])},setUint32:function(e,t){z(this,4,e,B,t,arguments[2])},setFloat32:function(e,t){z(this,4,e,W,t,arguments[2])},setFloat64:function(e,t){z(this,8,e,F,t,arguments[2])}});g(b,"ArrayBuffer"),g(_,"DataView"),u(_[y],i.VIEW,!0),t.ArrayBuffer=b,t.DataView=_},function(e,t,n){"use strict";var r=n(36),a=n(77),o=n(23);e.exports=[].copyWithin||function(e,t){var n=r(this),i=o(n.length),u=a(e,i),c=a(t,i),s=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===s?i:a(s,i))-c,i-u),d=1;for(c<u&&u<c+l&&(d=-1,c+=l-1,u+=l-1);l-- >0;)c in n?n[u]=n[c]:delete n[u],u+=d,c+=d;return n}},function(e,t,n){var r=n(29),a=n(22),o=function(e,t){if(a(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(44)(Function.call,n(95).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return o(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:o}},function(e,t,n){var r=n(11),a=n(40),o=n(25),i=n(139),u="["+i+"]",c=RegExp("^"+u+u+"*"),s=RegExp(u+u+"*$"),l=function(e,t,n){var a={},u=o(function(){return!!i[e]()||"​"!="​"[e]()}),c=a[e]=u?t(d):i[e];n&&(a[n]=c),r(r.P+r.F*u,"String",a)},d=l.trim=function(e,t){return e=String(a(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(s,"")),e};e.exports=l},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,n){var r=n(11);r(r.S,"Number",{isInteger:n(141)})},function(e,t,n){var r=n(29),a=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&a(e)===e}},function(e,t,n){var r=n(59),a=n(36),o=n(73),i=n(23);e.exports=function(e,t,n,u,c){r(t);var s=a(e),l=o(s),d=i(s.length),h=c?d-1:0,f=c?-1:1;if(n<2)for(;;){if(h in l){u=l[h],h+=f;break}if(h+=f,c?h<0:d<=h)throw TypeError("Reduce of empty array with no initial value")}for(;c?h>=0:d>h;h+=f)h in l&&(u=t(u,l[h],h,s));return u}},function(e,t,n){var r=n(44),a=n(144),o=n(112),i=n(22),u=n(23),c=n(113),s={},l={};(t=e.exports=function(e,t,n,d,h){var f,p,v,m,g=h?function(){return e}:c(e),y=r(n,d,t?2:1),w=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(f=u(e.length);f>w;w++)if((m=t?y(i(p=e[w])[0],p[1]):y(e[w]))===s||m===l)return m}else for(v=g.call(e);!(p=v.next()).done;)if((m=a(v,y,p.value,t))===s||m===l)return m}).BREAK=s,t.RETURN=l},function(e,t,n){var r=n(22);e.exports=function(e,t,n,a){try{return a?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(18),a=n(117).set,o=r.MutationObserver||r.WebKitMutationObserver,i=r.process,u=r.Promise,c="process"==n(42)(i);e.exports=function(){var e,t,n,s=function(){var r,a;for(c&&(r=i.domain)&&r.exit();e;){a=e.fn,e=e.next;try{a()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){i.nextTick(s)};else if(!o||r.navigator&&r.navigator.standalone)if(u&&u.resolve){var l=u.resolve(void 0);n=function(){l.then(s)}}else n=function(){a.call(r,s)};else{var d=!0,h=document.createTextNode("");new o(s).observe(h,{characterData:!0}),n=function(){h.data=d=!d}}return function(r){var a={fn:r,next:void 0};t&&(t.next=a),e||(e=a,n()),t=a}}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(18).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){var r=n(22),a=n(29),o=n(118);e.exports=function(e,t){if(r(e),a(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(22),a=n(151),o=n(68);n(69)("search",1,function(e,t,n,i){return[function(n){var r=e(this),a=null==n?void 0:n[t];return void 0!==a?a.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=i(n,e,this);if(t.done)return t.value;var u=r(e),c=String(this),s=u.lastIndex;a(s,0)||(u.lastIndex=0);var l=o(u,c);return a(u.lastIndex,s)||(u.lastIndex=s),null===l?-1:l.index}]})},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){n(109)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}},!0)},function(e,t,n){e.exports=function(){return new Worker(n.p+"a4f7e10426df3f769131.worker.js")}},function(e,t,n){e.exports=function(){return n(155)('!function(t){var r={};function n(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=r,n.d=function(t,r,e){n.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,r){if(1&r&&(t=n(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)n.d(e,o,function(r){return t[r]}.bind(null,o));return e},n.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(r,"a",r),r},n.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},n.p="",n(n.s=46)}([function(t,r,n){var e=n(22)("wks"),o=n(10),i=n(1).Symbol,u="function"==typeof i;(t.exports=function(t){return e[t]||(e[t]=u&&i[t]||(u?i:o)("Symbol."+t))}).store=e},function(t,r){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,r,n){t.exports=!n(9)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,r,n){var e=n(5),o=n(16);t.exports=n(2)?function(t,r,n){return e.f(t,r,o(1,n))}:function(t,r,n){return t[r]=n,t}},function(t,r,n){var e=n(11),o=Math.min;t.exports=function(t){return t>0?o(e(t),9007199254740991):0}},function(t,r,n){var e=n(15),o=n(31),i=n(20),u=Object.defineProperty;r.f=n(2)?Object.defineProperty:function(t,r,n){if(e(t),r=i(r,!0),e(n),o)try{return u(t,r,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[r]=n.value),t}},function(t,r){var n={}.hasOwnProperty;t.exports=function(t,r){return n.call(t,r)}},function(t,r,n){var e=n(33);t.exports=function(t){return Object(e(t))}},function(t,r){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,r){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,r){var n=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+e).toString(36))}},function(t,r){var n=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:n)(t)}},function(t,r){t.exports={}},function(t,r,n){var e=n(1),o=n(14),i=n(3),u=n(21),a=n(23),s=function(t,r,n){var c,f,l,p,h=t&s.F,v=t&s.G,d=t&s.S,y=t&s.P,g=t&s.B,b=v?e:d?e[r]||(e[r]={}):(e[r]||{}).prototype,w=v?o:o[r]||(o[r]={}),x=w.prototype||(w.prototype={});for(c in v&&(n=r),n)l=((f=!h&&b&&void 0!==b[c])?b:n)[c],p=g&&f?a(l,e):y&&"function"==typeof l?a(Function.call,l):l,b&&u(b,c,l,t&s.U),w[c]!=l&&i(w,c,p),y&&x[c]!=l&&(x[c]=l)};e.core=o,s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,t.exports=s},function(t,r){var n=t.exports={version:"2.6.5"};"number"==typeof __e&&(__e=n)},function(t,r,n){var e=n(8);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,r){t.exports=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}}},function(t,r){t.exports=!1},function(t,r,n){var e=n(26),o=n(33);t.exports=function(t){return e(o(t))}},function(t,r,n){var e=n(11),o=Math.max,i=Math.min;t.exports=function(t,r){return(t=e(t))<0?o(t+r,0):i(t,r)}},function(t,r,n){var e=n(8);t.exports=function(t,r){if(!e(t))return t;var n,o;if(r&&"function"==typeof(n=t.toString)&&!e(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!e(o=n.call(t)))return o;if(!r&&"function"==typeof(n=t.toString)&&!e(o=n.call(t)))return o;throw TypeError("Can\'t convert object to primitive value")}},function(t,r,n){var e=n(1),o=n(3),i=n(6),u=n(10)("src"),a=n(48),s=(""+a).split("toString");n(14).inspectSource=function(t){return a.call(t)},(t.exports=function(t,r,n,a){var c="function"==typeof n;c&&(i(n,"name")||o(n,"name",r)),t[r]!==n&&(c&&(i(n,u)||o(n,u,t[r]?""+t[r]:s.join(String(r)))),t===e?t[r]=n:a?t[r]?t[r]=n:o(t,r,n):(delete t[r],o(t,r,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[u]||a.call(this)})},function(t,r,n){var e=n(14),o=n(1),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(t.exports=function(t,r){return i[t]||(i[t]=void 0!==r?r:{})})("versions",[]).push({version:e.version,mode:n(17)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,r,n){var e=n(24);t.exports=function(t,r,n){if(e(t),void 0===r)return t;switch(n){case 1:return function(n){return t.call(r,n)};case 2:return function(n,e){return t.call(r,n,e)};case 3:return function(n,e,o){return t.call(r,n,e,o)}}return function(){return t.apply(r,arguments)}}},function(t,r){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,r,n){var e=n(18),o=n(4),i=n(19);t.exports=function(t){return function(r,n,u){var a,s=e(r),c=o(s.length),f=i(u,c);if(t&&n!=n){for(;c>f;)if((a=s[f++])!=a)return!0}else for(;c>f;f++)if((t||f in s)&&s[f]===n)return t||f||0;return!t&&-1}}},function(t,r,n){var e=n(27);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,r){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,r,n){var e=n(22)("keys"),o=n(10);t.exports=function(t){return e[t]||(e[t]=o(t))}},function(t,r){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,r,n){var e=n(5).f,o=n(6),i=n(0)("toStringTag");t.exports=function(t,r,n){t&&!o(t=n?t:t.prototype,i)&&e(t,i,{configurable:!0,value:r})}},function(t,r,n){t.exports=!n(2)&&!n(9)(function(){return 7!=Object.defineProperty(n(32)("div"),"a",{get:function(){return 7}}).a})},function(t,r,n){var e=n(8),o=n(1).document,i=e(o)&&e(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,r){t.exports=function(t){if(null==t)throw TypeError("Can\'t call method on  "+t);return t}},function(t,r,n){"use strict";var e=n(9);t.exports=function(t,r){return!!t&&e(function(){r?t.call(null,function(){},1):t.call(null)})}},function(t,r,n){"use strict";if(n(2)){var e=n(17),o=n(1),i=n(9),u=n(13),a=n(36),s=n(50),c=n(23),f=n(38),l=n(16),p=n(3),h=n(37),v=n(11),d=n(4),y=n(39),g=n(19),b=n(20),w=n(6),x=n(43),m=n(8),A=n(7),_=n(51),S=n(44),O=n(45),E=n(40).f,k=n(55),P=n(10),B=n(0),I=n(56),j=n(25),T=n(60),F=n(61),M=n(12),C=n(66),U=n(67),L=n(42),N=n(68),R=n(5),W=n(69),z=R.f,D=W.f,V=o.RangeError,q=o.TypeError,G=o.Uint8Array,Y=Array.prototype,H=s.ArrayBuffer,J=s.DataView,K=I(0),Q=I(2),X=I(3),Z=I(4),$=I(5),tt=I(6),rt=j(!0),nt=j(!1),et=F.values,ot=F.keys,it=F.entries,ut=Y.lastIndexOf,at=Y.reduce,st=Y.reduceRight,ct=Y.join,ft=Y.sort,lt=Y.slice,pt=Y.toString,ht=Y.toLocaleString,vt=B("iterator"),dt=B("toStringTag"),yt=P("typed_constructor"),gt=P("def_constructor"),bt=a.CONSTR,wt=a.TYPED,xt=a.VIEW,mt=I(1,function(t,r){return Et(T(t,t[gt]),r)}),At=i(function(){return 1===new G(new Uint16Array([1]).buffer)[0]}),_t=!!G&&!!G.prototype.set&&i(function(){new G(1).set({})}),St=function(t,r){var n=v(t);if(n<0||n%r)throw V("Wrong offset!");return n},Ot=function(t){if(m(t)&&wt in t)return t;throw q(t+" is not a typed array!")},Et=function(t,r){if(!(m(t)&&yt in t))throw q("It is not a typed array constructor!");return new t(r)},kt=function(t,r){return Pt(T(t,t[gt]),r)},Pt=function(t,r){for(var n=0,e=r.length,o=Et(t,e);e>n;)o[n]=r[n++];return o},Bt=function(t,r,n){z(t,r,{get:function(){return this._d[n]}})},It=function(t){var r,n,e,o,i,u,a=A(t),s=arguments.length,f=s>1?arguments[1]:void 0,l=void 0!==f,p=k(a);if(null!=p&&!_(p)){for(u=p.call(a),e=[],r=0;!(i=u.next()).done;r++)e.push(i.value);a=e}for(l&&s>2&&(f=c(f,arguments[2],2)),r=0,n=d(a.length),o=Et(this,n);n>r;r++)o[r]=l?f(a[r],r):a[r];return o},jt=function(){for(var t=0,r=arguments.length,n=Et(this,r);r>t;)n[t]=arguments[t++];return n},Tt=!!G&&i(function(){ht.call(new G(1))}),Ft=function(){return ht.apply(Tt?lt.call(Ot(this)):Ot(this),arguments)},Mt={copyWithin:function(t,r){return N.call(Ot(this),t,r,arguments.length>2?arguments[2]:void 0)},every:function(t){return Z(Ot(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return L.apply(Ot(this),arguments)},filter:function(t){return kt(this,Q(Ot(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return $(Ot(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return tt(Ot(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){K(Ot(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return nt(Ot(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return rt(Ot(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ct.apply(Ot(this),arguments)},lastIndexOf:function(t){return ut.apply(Ot(this),arguments)},map:function(t){return mt(Ot(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return at.apply(Ot(this),arguments)},reduceRight:function(t){return st.apply(Ot(this),arguments)},reverse:function(){for(var t,r=Ot(this).length,n=Math.floor(r/2),e=0;e<n;)t=this[e],this[e++]=this[--r],this[r]=t;return this},some:function(t){return X(Ot(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return ft.call(Ot(this),t)},subarray:function(t,r){var n=Ot(this),e=n.length,o=g(t,e);return new(T(n,n[gt]))(n.buffer,n.byteOffset+o*n.BYTES_PER_ELEMENT,d((void 0===r?e:g(r,e))-o))}},Ct=function(t,r){return kt(this,lt.call(Ot(this),t,r))},Ut=function(t){Ot(this);var r=St(arguments[1],1),n=this.length,e=A(t),o=d(e.length),i=0;if(o+r>n)throw V("Wrong length!");for(;i<o;)this[r+i]=e[i++]},Lt={entries:function(){return it.call(Ot(this))},keys:function(){return ot.call(Ot(this))},values:function(){return et.call(Ot(this))}},Nt=function(t,r){return m(t)&&t[wt]&&"symbol"!=typeof r&&r in t&&String(+r)==String(r)},Rt=function(t,r){return Nt(t,r=b(r,!0))?l(2,t[r]):D(t,r)},Wt=function(t,r,n){return!(Nt(t,r=b(r,!0))&&m(n)&&w(n,"value"))||w(n,"get")||w(n,"set")||n.configurable||w(n,"writable")&&!n.writable||w(n,"enumerable")&&!n.enumerable?z(t,r,n):(t[r]=n.value,t)};bt||(W.f=Rt,R.f=Wt),u(u.S+u.F*!bt,"Object",{getOwnPropertyDescriptor:Rt,defineProperty:Wt}),i(function(){pt.call({})})&&(pt=ht=function(){return ct.call(this)});var zt=h({},Mt);h(zt,Lt),p(zt,vt,Lt.values),h(zt,{slice:Ct,set:Ut,constructor:function(){},toString:pt,toLocaleString:Ft}),Bt(zt,"buffer","b"),Bt(zt,"byteOffset","o"),Bt(zt,"byteLength","l"),Bt(zt,"length","e"),z(zt,dt,{get:function(){return this[wt]}}),t.exports=function(t,r,n,s){var c=t+((s=!!s)?"Clamped":"")+"Array",l="get"+t,h="set"+t,v=o[c],g=v||{},b=v&&O(v),w=!v||!a.ABV,A={},_=v&&v.prototype,k=function(t,n){z(t,n,{get:function(){return function(t,n){var e=t._d;return e.v[l](n*r+e.o,At)}(this,n)},set:function(t){return function(t,n,e){var o=t._d;s&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),o.v[h](n*r+o.o,e,At)}(this,n,t)},enumerable:!0})};w?(v=n(function(t,n,e,o){f(t,v,c,"_d");var i,u,a,s,l=0,h=0;if(m(n)){if(!(n instanceof H||"ArrayBuffer"==(s=x(n))||"SharedArrayBuffer"==s))return wt in n?Pt(v,n):It.call(v,n);i=n,h=St(e,r);var g=n.byteLength;if(void 0===o){if(g%r)throw V("Wrong length!");if((u=g-h)<0)throw V("Wrong length!")}else if((u=d(o)*r)+h>g)throw V("Wrong length!");a=u/r}else a=y(n),i=new H(u=a*r);for(p(t,"_d",{b:i,o:h,l:u,e:a,v:new J(i)});l<a;)k(t,l++)}),_=v.prototype=S(zt),p(_,"constructor",v)):i(function(){v(1)})&&i(function(){new v(-1)})&&C(function(t){new v,new v(null),new v(1.5),new v(t)},!0)||(v=n(function(t,n,e,o){var i;return f(t,v,c),m(n)?n instanceof H||"ArrayBuffer"==(i=x(n))||"SharedArrayBuffer"==i?void 0!==o?new g(n,St(e,r),o):void 0!==e?new g(n,St(e,r)):new g(n):wt in n?Pt(v,n):It.call(v,n):new g(y(n))}),K(b!==Function.prototype?E(g).concat(E(b)):E(g),function(t){t in v||p(v,t,g[t])}),v.prototype=_,e||(_.constructor=v));var P=_[vt],B=!!P&&("values"==P.name||null==P.name),I=Lt.values;p(v,yt,!0),p(_,wt,c),p(_,xt,!0),p(_,gt,v),(s?new v(1)[dt]==c:dt in _)||z(_,dt,{get:function(){return c}}),A[c]=v,u(u.G+u.W+u.F*(v!=g),A),u(u.S,c,{BYTES_PER_ELEMENT:r}),u(u.S+u.F*i(function(){g.of.call(v,1)}),c,{from:It,of:jt}),"BYTES_PER_ELEMENT"in _||p(_,"BYTES_PER_ELEMENT",r),u(u.P,c,Mt),U(c),u(u.P+u.F*_t,c,{set:Ut}),u(u.P+u.F*!B,c,Lt),e||_.toString==pt||(_.toString=pt),u(u.P+u.F*i(function(){new v(1).slice()}),c,{slice:Ct}),u(u.P+u.F*(i(function(){return[1,2].toLocaleString()!=new v([1,2]).toLocaleString()})||!i(function(){_.toLocaleString.call([1,2])})),c,{toLocaleString:Ft}),M[c]=B?P:I,e||B||p(_,vt,I)}}else t.exports=function(){}},function(t,r,n){for(var e,o=n(1),i=n(3),u=n(10),a=u("typed_array"),s=u("view"),c=!(!o.ArrayBuffer||!o.DataView),f=c,l=0,p="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=o[p[l++]])?(i(e.prototype,a,!0),i(e.prototype,s,!0)):f=!1;t.exports={ABV:c,CONSTR:f,TYPED:a,VIEW:s}},function(t,r,n){var e=n(21);t.exports=function(t,r,n){for(var o in r)e(t,o,r[o],n);return t}},function(t,r){t.exports=function(t,r,n,e){if(!(t instanceof r)||void 0!==e&&e in t)throw TypeError(n+": incorrect invocation!");return t}},function(t,r,n){var e=n(11),o=n(4);t.exports=function(t){if(void 0===t)return 0;var r=e(t),n=o(r);if(r!==n)throw RangeError("Wrong length!");return n}},function(t,r,n){var e=n(41),o=n(29).concat("length","prototype");r.f=Object.getOwnPropertyNames||function(t){return e(t,o)}},function(t,r,n){var e=n(6),o=n(18),i=n(25)(!1),u=n(28)("IE_PROTO");t.exports=function(t,r){var n,a=o(t),s=0,c=[];for(n in a)n!=u&&e(a,n)&&c.push(n);for(;r.length>s;)e(a,n=r[s++])&&(~i(c,n)||c.push(n));return c}},function(t,r,n){"use strict";var e=n(7),o=n(19),i=n(4);t.exports=function(t){for(var r=e(this),n=i(r.length),u=arguments.length,a=o(u>1?arguments[1]:void 0,n),s=u>2?arguments[2]:void 0,c=void 0===s?n:o(s,n);c>a;)r[a++]=t;return r}},function(t,r,n){var e=n(27),o=n(0)("toStringTag"),i="Arguments"==e(function(){return arguments}());t.exports=function(t){var r,n,u;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,r){try{return t[r]}catch(t){}}(r=Object(t),o))?n:i?e(r):"Object"==(u=e(r))&&"function"==typeof r.callee?"Arguments":u}},function(t,r,n){var e=n(15),o=n(52),i=n(29),u=n(28)("IE_PROTO"),a=function(){},s=function(){var t,r=n(32)("iframe"),e=i.length;for(r.style.display="none",n(54).appendChild(r),r.src="javascript:",(t=r.contentWindow.document).open(),t.write("<script>document.F=Object<\\/script>"),t.close(),s=t.F;e--;)delete s.prototype[i[e]];return s()};t.exports=Object.create||function(t,r){var n;return null!==t?(a.prototype=e(t),n=new a,a.prototype=null,n[u]=t):n=s(),void 0===r?n:o(n,r)}},function(t,r,n){var e=n(6),o=n(7),i=n(28)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),e(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,r,n){"use strict";n.r(r);n(47),n(49),n(71),n(72),n(74);function e(t){this.data=t,this.pos=0}function o(t){this.stream=new e(t),this.output={loopCount:1}}e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.peekByte=function(){return this.data[this.pos]},e.prototype.readBytes=function(t){var r=this.data.subarray(this.pos,this.pos+t);return this.pos+=t,r},e.prototype.peekBytes=function(t){return this.data.subarray(this.pos,this.pos+t)},e.prototype.readString=function(t){for(var r="",n=0;n<t;n++)r+=String.fromCharCode(this.readByte());return r},e.prototype.readBitArray=function(){for(var t=[],r=this.readByte(),n=7;n>=0;n--)t.push(!!(r&1<<n));return t},e.prototype.readUnsigned=function(t){var r=this.readBytes(2);return t?(r[1]<<8)+r[0]:(r[0]<<8)+r[1]},o.prototype.parse=function(t){return this.parseParts(this.output,t),this.output},o.prototype.parseParts=function(t,r){for(var n=0;n<r.length;n++){var e=r[n];this.parsePart(t,e)}},o.prototype.parsePart=function(t,r){var n,e=r.label;if(!r.requires||r.requires(this.stream,this.output,t))if(r.loop){for(var o=[];r.loop(this.stream);){var i={};this.parseParts(i,r.parts),o.push(i)}t[e]=o}else r.parts?(n={},this.parseParts(n,r.parts),t[e]=n):r.parser?(n=r.parser(this.stream,this.output,t),r.skip||(t[e]=n)):r.bits&&(t[e]=this.parseBits(r.bits))},o.prototype.parseBits=function(t){var r={},n=this.stream.readBitArray();for(var e in t){var o=t[e];o.length?r[e]=n.slice(o.index,o.index+o.length).reduce(function(t,r){return 2*t+r},0):r[e]=n[o.index]}return r};var i=function(){return function(t){return t.readByte()}},u=function(t){return function(r){return r.readBytes(t)}},a=function(t){return function(r){return r.readString(t)}},s=function(t){return function(r){return r.readUnsigned(t)}},c=function(t,r){return function(n,e,o){for(var i=r(n,e,o),u=new Array(i),a=0;a<i;a++)u[a]=n.readBytes(t);return u}};function f(t){var r=new o(new Uint8Array(t));this.raw=r.parse(y),this.raw.hasImages=!1;for(var n=0;n<this.raw.frames.length;n++)if(this.raw.frames[n].image){this.raw.hasImages=!0;break}}f.prototype.decompressFrame=function(t,r){if(t>=this.raw.frames.length)return null;var n=this.raw.frames[t];if(n.image){var e=n.image.descriptor.width*n.image.descriptor.height,o=function(t,r,n){var e,o,i,u,a,s,c,f,l,p,h,v,d,y,g,b,w=n,x=new Array(n),m=new Array(4096),A=new Array(4096),_=new Array(4097);for(a=1+(o=1<<(v=t)),e=o+2,c=-1,i=(1<<(u=v+1))-1,l=0;l<o;l++)m[l]=0,A[l]=l;for(h=f=d=y=b=g=0,p=0;p<w;){if(0===y){if(f<u){h+=r[g]<<f,f+=8,g++;continue}if(l=h&i,h>>=u,f-=u,l>e||l==a)break;if(l==o){i=(1<<(u=v+1))-1,e=o+2,c=-1;continue}if(-1==c){_[y++]=A[l],c=l,d=l;continue}for(s=l,l==e&&(_[y++]=d,l=c);l>o;)_[y++]=A[l],l=m[l];d=255&A[l],_[y++]=d,e<4096&&(m[e]=c,A[e]=d,0==(++e&i)&&e<4096&&(u++,i+=e)),c=s}y--,x[b++]=_[y],p++}for(p=b;p<w;p++)x[p]=0;return x}(n.image.data.minCodeSize,n.image.data.blocks,e);n.image.descriptor.lct.interlaced&&(o=function(t,r){for(var n=new Array(t.length),e=t.length/r,o=function(e,o){var i=t.slice(o*r,(o+1)*r);n.splice.apply(n,[e*r,r].concat(i))},i=[0,4,2,1],u=[8,8,4,2],a=0,s=0;s<4;s++)for(var c=i[s];c<e;c+=u[s])o(c,a),a++;return n}(o,n.image.descriptor.width));var i={pixels:o,dims:{top:n.image.descriptor.top,left:n.image.descriptor.left,width:n.image.descriptor.width,height:n.image.descriptor.height}};return n.image.descriptor.lct&&n.image.descriptor.lct.exists?i.colorTable=n.image.lct:i.colorTable=this.raw.gct,n.gce&&(i.delay=10*(n.gce.delay||10),i.disposalType=n.gce.extras.disposal,n.gce.extras.transparentColorGiven&&(i.transparentIndex=n.gce.transparentColorIndex)),r&&(i.patch=function(t){for(var r=t.pixels.length,n=new Uint8ClampedArray(4*r),e=0;e<r;e++){var o=4*e,i=t.pixels[e],u=t.colorTable[i];n[o]=u[0],n[o+1]=u[1],n[o+2]=u[2],n[o+3]=i!==t.transparentIndex?255:0}return n}(i)),i}return null},f.prototype.decompressFrames=function(t){for(var r=[],n=0;n<this.raw.frames.length;n++){this.raw.frames[n].image&&r.push(this.decompressFrame(n,t))}return r};var l={label:"blocks",parser:function(t){var r,n=0,e=0,o=new Uint8Array(8192);do{for(n=t.readByte();e+n>o.length;)r=void 0,(r=new Uint8Array(o.length+8192)).set(o),o=r;o.set(t.readBytes(n),e),e+=n}while(0!==n);return o.subarray(0,e)}},p={label:"gce",requires:function(t){var r=t.peekBytes(2);return 33===r[0]&&249===r[1]},parts:[{label:"codes",parser:u(2),skip:!0},{label:"byteSize",parser:i()},{label:"extras",bits:{future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}}},{label:"delay",parser:s(!0)},{label:"transparentColorIndex",parser:i()},{label:"terminator",parser:i(),skip:!0}]},h={label:"image",requires:function(t){return 44===t.peekByte()},parts:[{label:"code",parser:i(),skip:!0},{label:"descriptor",parts:[{label:"left",parser:s(!0)},{label:"top",parser:s(!0)},{label:"width",parser:s(!0)},{label:"height",parser:s(!0)},{label:"lct",bits:{exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}}}]},{label:"lct",requires:function(t,r,n){return n.descriptor.lct.exists},parser:c(3,function(t,r,n){return Math.pow(2,n.descriptor.lct.size+1)})},{label:"data",parts:[{label:"minCodeSize",parser:i()},l]}]},v={label:"text",requires:function(t){var r=t.peekBytes(2);return 33===r[0]&&1===r[1]},parts:[{label:"codes",parser:u(2),skip:!0},{label:"blockSize",parser:i()},{label:"preData",parser:function(t,r,n){return t.readBytes(n.text.blockSize)}},l]},d={label:"frames",parts:[p,{label:"application",requires:function(t,r,n){var e=t.peekBytes(2);return 33===e[0]&&255===e[1]},parts:[{label:"codes",parser:u(2),skip:!0},{label:"blockSize",parser:i()},{label:"id",parser:function(t,r,n){return t.readString(n.blockSize)}},{label:"loopCount",parser:function(t,r,n){if(~n.id.indexOf("NETSCAPE")){var e=t.peekBytes(4);r.loopCount=(e[3]<<8)+e[2]}return null},skip:!0},l]},{label:"comment",requires:function(t,r,n){var e=t.peekBytes(2);return 33===e[0]&&254===e[1]},parts:[{label:"codes",parser:u(2),skip:!0},l]},h,v],loop:function(t){var r=t.peekByte();return 33===r||44===r}},y=[{label:"header",parts:[{label:"signature",parser:a(3)},{label:"version",parser:a(3)}]},{label:"lsd",parts:[{label:"width",parser:s(!0)},{label:"height",parser:s(!0)},{label:"gct",bits:{exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}}},{label:"backgroundColorIndex",parser:i()},{label:"pixelAspectRatio",parser:i()}]},{label:"gct",requires:function(t,r){return r.lsd.gct.exists},parser:c(3,function(t,r){return Math.pow(2,r.lsd.gct.size+1)})},d];function g(t,r){for(var n=-1,e=0;e<t.raw.frames.length;e++){if((o=t.raw.frames[e]).image&&n++,n===r)break;t.raw.frames[e]={image:!!o.image}}var o=t.decompressFrame(e,!0),i={};return i.delay=o.delay,i.dims=o.dims,i.disposalType=o.disposalType,i.patch=o.patch.buffer,i}var b=null,w=0;onmessage=function(t){var r=t.data.type,n=t.data.value,e=t.data.index||0,o=null,i=null;switch(r){case"decompressGif":i=n.slice(0),b=new f(i),w=0;for(var u=0;u<b.raw.frames.length;u++)b.raw.frames[u].image&&w++;o=g(b,e),postMessage({frame:o,index:e,loopCount:b.raw.loopCount,hasNext:w>e+1,frameLength:w},[o.patch]);break;case"getFrame":o=g(b,e),postMessage({frame:o,index:e,loopCount:b.raw.loopCount,hasNext:w>e+1,frameLength:w},[o.patch]),w<=e+1&&(b=null);break;default:console.error("unknown type",t.data.type)}}},function(t,r,n){"use strict";var e=n(13),o=n(25)(!1),i=[].indexOf,u=!!i&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!n(34)(i)),"Array",{indexOf:function(t){return u?i.apply(this,arguments)||0:o(this,t,arguments[1])}})},function(t,r,n){t.exports=n(22)("native-function-to-string",Function.toString)},function(t,r,n){n(35)("Uint8",1,function(t){return function(r,n,e){return t(this,r,n,e)}},!0)},function(t,r,n){"use strict";var e=n(1),o=n(2),i=n(17),u=n(36),a=n(3),s=n(37),c=n(9),f=n(38),l=n(11),p=n(4),h=n(39),v=n(40).f,d=n(5).f,y=n(42),g=n(30),b="prototype",w="Wrong index!",x=e.ArrayBuffer,m=e.DataView,A=e.Math,_=e.RangeError,S=e.Infinity,O=x,E=A.abs,k=A.pow,P=A.floor,B=A.log,I=A.LN2,j=o?"_b":"buffer",T=o?"_l":"byteLength",F=o?"_o":"byteOffset";function M(t,r,n){var e,o,i,u=new Array(n),a=8*n-r-1,s=(1<<a)-1,c=s>>1,f=23===r?k(2,-24)-k(2,-77):0,l=0,p=t<0||0===t&&1/t<0?1:0;for((t=E(t))!=t||t===S?(o=t!=t?1:0,e=s):(e=P(B(t)/I),t*(i=k(2,-e))<1&&(e--,i*=2),(t+=e+c>=1?f/i:f*k(2,1-c))*i>=2&&(e++,i/=2),e+c>=s?(o=0,e=s):e+c>=1?(o=(t*i-1)*k(2,r),e+=c):(o=t*k(2,c-1)*k(2,r),e=0));r>=8;u[l++]=255&o,o/=256,r-=8);for(e=e<<r|o,a+=r;a>0;u[l++]=255&e,e/=256,a-=8);return u[--l]|=128*p,u}function C(t,r,n){var e,o=8*n-r-1,i=(1<<o)-1,u=i>>1,a=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;a>0;f=256*f+t[s],s--,a-=8);for(e=f&(1<<-a)-1,f>>=-a,a+=r;a>0;e=256*e+t[s],s--,a-=8);if(0===f)f=1-u;else{if(f===i)return e?NaN:c?-S:S;e+=k(2,r),f-=u}return(c?-1:1)*e*k(2,f-r)}function U(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function L(t){return[255&t]}function N(t){return[255&t,t>>8&255]}function R(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function W(t){return M(t,52,8)}function z(t){return M(t,23,4)}function D(t,r,n){d(t[b],r,{get:function(){return this[n]}})}function V(t,r,n,e){var o=h(+n);if(o+r>t[T])throw _(w);var i=t[j]._b,u=o+t[F],a=i.slice(u,u+r);return e?a:a.reverse()}function q(t,r,n,e,o,i){var u=h(+n);if(u+r>t[T])throw _(w);for(var a=t[j]._b,s=u+t[F],c=e(+o),f=0;f<r;f++)a[s+f]=c[i?f:r-f-1]}if(u.ABV){if(!c(function(){x(1)})||!c(function(){new x(-1)})||c(function(){return new x,new x(1.5),new x(NaN),"ArrayBuffer"!=x.name})){for(var G,Y=(x=function(t){return f(this,x),new O(h(t))})[b]=O[b],H=v(O),J=0;H.length>J;)(G=H[J++])in x||a(x,G,O[G]);i||(Y.constructor=x)}var K=new m(new x(2)),Q=m[b].setInt8;K.setInt8(0,2147483648),K.setInt8(1,2147483649),!K.getInt8(0)&&K.getInt8(1)||s(m[b],{setInt8:function(t,r){Q.call(this,t,r<<24>>24)},setUint8:function(t,r){Q.call(this,t,r<<24>>24)}},!0)}else x=function(t){f(this,x,"ArrayBuffer");var r=h(t);this._b=y.call(new Array(r),0),this[T]=r},m=function(t,r,n){f(this,m,"DataView"),f(t,x,"DataView");var e=t[T],o=l(r);if(o<0||o>e)throw _("Wrong offset!");if(o+(n=void 0===n?e-o:p(n))>e)throw _("Wrong length!");this[j]=t,this[F]=o,this[T]=n},o&&(D(x,"byteLength","_l"),D(m,"buffer","_b"),D(m,"byteLength","_l"),D(m,"byteOffset","_o")),s(m[b],{getInt8:function(t){return V(this,1,t)[0]<<24>>24},getUint8:function(t){return V(this,1,t)[0]},getInt16:function(t){var r=V(this,2,t,arguments[1]);return(r[1]<<8|r[0])<<16>>16},getUint16:function(t){var r=V(this,2,t,arguments[1]);return r[1]<<8|r[0]},getInt32:function(t){return U(V(this,4,t,arguments[1]))},getUint32:function(t){return U(V(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return C(V(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return C(V(this,8,t,arguments[1]),52,8)},setInt8:function(t,r){q(this,1,t,L,r)},setUint8:function(t,r){q(this,1,t,L,r)},setInt16:function(t,r){q(this,2,t,N,r,arguments[2])},setUint16:function(t,r){q(this,2,t,N,r,arguments[2])},setInt32:function(t,r){q(this,4,t,R,r,arguments[2])},setUint32:function(t,r){q(this,4,t,R,r,arguments[2])},setFloat32:function(t,r){q(this,4,t,z,r,arguments[2])},setFloat64:function(t,r){q(this,8,t,W,r,arguments[2])}});g(x,"ArrayBuffer"),g(m,"DataView"),a(m[b],u.VIEW,!0),r.ArrayBuffer=x,r.DataView=m},function(t,r,n){var e=n(12),o=n(0)("iterator"),i=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||i[o]===t)}},function(t,r,n){var e=n(5),o=n(15),i=n(53);t.exports=n(2)?Object.defineProperties:function(t,r){o(t);for(var n,u=i(r),a=u.length,s=0;a>s;)e.f(t,n=u[s++],r[n]);return t}},function(t,r,n){var e=n(41),o=n(29);t.exports=Object.keys||function(t){return e(t,o)}},function(t,r,n){var e=n(1).document;t.exports=e&&e.documentElement},function(t,r,n){var e=n(43),o=n(0)("iterator"),i=n(12);t.exports=n(14).getIteratorMethod=function(t){if(null!=t)return t[o]||t["@@iterator"]||i[e(t)]}},function(t,r,n){var e=n(23),o=n(26),i=n(7),u=n(4),a=n(57);t.exports=function(t,r){var n=1==t,s=2==t,c=3==t,f=4==t,l=6==t,p=5==t||l,h=r||a;return function(r,a,v){for(var d,y,g=i(r),b=o(g),w=e(a,v,3),x=u(b.length),m=0,A=n?h(r,x):s?h(r,0):void 0;x>m;m++)if((p||m in b)&&(y=w(d=b[m],m,g),t))if(n)A[m]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return m;case 2:A.push(d)}else if(f)return!1;return l?-1:c||f?f:A}}},function(t,r,n){var e=n(58);t.exports=function(t,r){return new(e(t))(r)}},function(t,r,n){var e=n(8),o=n(59),i=n(0)("species");t.exports=function(t){var r;return o(t)&&("function"!=typeof(r=t.constructor)||r!==Array&&!o(r.prototype)||(r=void 0),e(r)&&null===(r=r[i])&&(r=void 0)),void 0===r?Array:r}},function(t,r,n){var e=n(27);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,r,n){var e=n(15),o=n(24),i=n(0)("species");t.exports=function(t,r){var n,u=e(t).constructor;return void 0===u||null==(n=e(u)[i])?r:o(n)}},function(t,r,n){"use strict";var e=n(62),o=n(63),i=n(12),u=n(18);t.exports=n(64)(Array,"Array",function(t,r){this._t=u(t),this._i=0,this._k=r},function(){var t=this._t,r=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,o(1)):o(0,"keys"==r?n:"values"==r?t[n]:[n,t[n]])},"values"),i.Arguments=i.Array,e("keys"),e("values"),e("entries")},function(t,r,n){var e=n(0)("unscopables"),o=Array.prototype;null==o[e]&&n(3)(o,e,{}),t.exports=function(t){o[e][t]=!0}},function(t,r){t.exports=function(t,r){return{value:r,done:!!t}}},function(t,r,n){"use strict";var e=n(17),o=n(13),i=n(21),u=n(3),a=n(12),s=n(65),c=n(30),f=n(45),l=n(0)("iterator"),p=!([].keys&&"next"in[].keys()),h=function(){return this};t.exports=function(t,r,n,v,d,y,g){s(n,r,v);var b,w,x,m=function(t){if(!p&&t in O)return O[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},A=r+" Iterator",_="values"==d,S=!1,O=t.prototype,E=O[l]||O["@@iterator"]||d&&O[d],k=E||m(d),P=d?_?m("entries"):k:void 0,B="Array"==r&&O.entries||E;if(B&&(x=f(B.call(new t)))!==Object.prototype&&x.next&&(c(x,A,!0),e||"function"==typeof x[l]||u(x,l,h)),_&&E&&"values"!==E.name&&(S=!0,k=function(){return E.call(this)}),e&&!g||!p&&!S&&O[l]||u(O,l,k),a[r]=k,a[A]=h,d)if(b={values:_?k:m("values"),keys:y?k:m("keys"),entries:P},g)for(w in b)w in O||i(O,w,b[w]);else o(o.P+o.F*(p||S),r,b);return b}},function(t,r,n){"use strict";var e=n(44),o=n(16),i=n(30),u={};n(3)(u,n(0)("iterator"),function(){return this}),t.exports=function(t,r,n){t.prototype=e(u,{next:o(1,n)}),i(t,r+" Iterator")}},function(t,r,n){var e=n(0)("iterator"),o=!1;try{var i=[7][e]();i.return=function(){o=!0},Array.from(i,function(){throw 2})}catch(t){}t.exports=function(t,r){if(!r&&!o)return!1;var n=!1;try{var i=[7],u=i[e]();u.next=function(){return{done:n=!0}},i[e]=function(){return u},t(i)}catch(t){}return n}},function(t,r,n){"use strict";var e=n(1),o=n(5),i=n(2),u=n(0)("species");t.exports=function(t){var r=e[t];i&&r&&!r[u]&&o.f(r,u,{configurable:!0,get:function(){return this}})}},function(t,r,n){"use strict";var e=n(7),o=n(19),i=n(4);t.exports=[].copyWithin||function(t,r){var n=e(this),u=i(n.length),a=o(t,u),s=o(r,u),c=arguments.length>2?arguments[2]:void 0,f=Math.min((void 0===c?u:o(c,u))-s,u-a),l=1;for(s<a&&a<s+f&&(l=-1,s+=f-1,a+=f-1);f-- >0;)s in n?n[a]=n[s]:delete n[a],a+=l,s+=l;return n}},function(t,r,n){var e=n(70),o=n(16),i=n(18),u=n(20),a=n(6),s=n(31),c=Object.getOwnPropertyDescriptor;r.f=n(2)?c:function(t,r){if(t=i(t),r=u(r,!0),s)try{return c(t,r)}catch(t){}if(a(t,r))return o(!e.f.call(t,r),t[r])}},function(t,r){r.f={}.propertyIsEnumerable},function(t,r,n){n(35)("Uint8",1,function(t){return function(r,n,e){return t(this,r,n,e)}})},function(t,r,n){"use strict";var e=n(13),o=n(73);e(e.P+e.F*!n(34)([].reduce,!0),"Array",{reduce:function(t){return o(this,t,arguments.length,arguments[1],!1)}})},function(t,r,n){var e=n(24),o=n(7),i=n(26),u=n(4);t.exports=function(t,r,n,a,s){e(r);var c=o(t),f=i(c),l=u(c.length),p=s?l-1:0,h=s?-1:1;if(n<2)for(;;){if(p in f){a=f[p],p+=h;break}if(p+=h,s?p<0:l<=p)throw TypeError("Reduce of empty array with no initial value")}for(;s?p>=0:l>p;p+=h)p in f&&(a=r(a,f[p],p,c));return a}},function(t,r,n){var e=n(5).f,o=Function.prototype,i=/^\\s*function ([^ (]*)/;"name"in o||n(2)&&e(o,"name",{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(t){return""}}})}]);',n.p+"a4f7e10426df3f769131.worker.js")}},function(e,t,n){"use strict";var r=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var n;try{(n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),n=n.getBlob()}catch(t){n=new Blob([e])}return new Worker(r.createObjectURL(n))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,n){e.exports=n(49)(45)},function(e,t,n){e.exports=n(49)(46)},function(e,t){Array.prototype.takeWhile||(Array.prototype.takeWhile=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],a=arguments.length>=2?arguments[1]:void 0,o=0;o<n;++o)if(o in t){var i=t[o];if(!e.call(a,i,o,t))break;r.push(i)}return r})},function(e,t,n){"use strict";e.exports=function(e,t,n,r,a,o,i,u){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var s=[n,r,a,o,i,u],l=0;(c=new Error(t.replace(/%s/g,function(){return s[l++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}}},function(e,t,n){"use strict";var r=n(75),a=n(161),o=n(115),i=n(36),u=n(73),c=Object.assign;e.exports=!c||n(25)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r})?function(e,t){for(var n=i(e),c=arguments.length,s=1,l=a.f,d=o.f;c>s;)for(var h,f=u(arguments[s++]),p=l?r(f).concat(l(f)):r(f),v=p.length,m=0;v>m;)d.call(f,h=p[m++])&&(n[h]=f[h]);return n}:c},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t){},function(e,t,n){"use strict";var r=n(37),a=n(40);e.exports=function(e){var t=String(a(this)),n="",o=r(e);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);n(125),n(33);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){return(a="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)})(e)}n(20),n(17),n(8),n(26),n(12),n(52),n(53),n(62),n(21),n(47),n(48),n(19),n(14),n(108),n(54),n(28),n(38);var o=n(4),i=n(6),u=n(1),c=(n(81),n(31),n(39),[]),s=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"get",value:function(){var e=c.find(function(e){return e.free});return e?(e.pause(),e.free=!1):((e=document.createElement("audio")).free=!1,e.loop=!1,e.play(),c.push(e)),e}},{key:"exist",value:function(e){return c.some(function(t){return t===e})}},{key:"free",value:function(t){e.exist(t)&&(t.free=!0)}},{key:"fill",value:function(){var e=function(e){for(var t=0;t<e;t++){var n=document.createElement("audio");n.free=!0,n.loop=!1,n.play(),c.push(n)}};c.length?c.reduce(function(e,t){return e+(t&&t.free?1:0)},0)<10&&e(50):e(100)}}]),e}(),l=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"updateText",value:function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var e=this.text;this.characterLimitSize>-1&&this.characterLimitSize<e.length&&(e=this.text.substring(0,this.characterLimitSize)+this.characterLimitSuffix),this.style.wordWrap&&(e=this.runWordWrap(this.text));var t=e.split(this.splitRegExp),n=this.style.tabs,r=[],a=0,o=this.determineFontProperties(this.style.font),i=t.length;this.style.maxLines>0&&this.style.maxLines<t.length&&(i=this.style.maxLines),this._charCount=0;for(var u=0;u<i;u++){if(0===n){var c=this.style.strokeThickness+this.padding.x;this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?c+=this.measureLine(t[u]):c+=this.context.measureText(t[u]).width}else{var s=t[u].split(/(?:\t)/);c=this.padding.x+this.style.strokeThickness;if(Array.isArray(n))for(var l=0,d=0;d<s.length;d++){var h=0;h=this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.measureLine(s[d]):Math.ceil(this.context.measureText(s[d]).width),d>0&&(l+=n[d-1]),c=l+h}else for(d=0;d<s.length;d++){this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?c+=this.measureLine(s[d]):c+=Math.ceil(this.context.measureText(s[d]).width),c+=this.game.math.snapToCeil(c,n)-c}}r[u]=Math.ceil(c),a=Math.max(a,r[u])}this.canvas.width=a*this._res;var f,p,v=o.fontSize+this.style.strokeThickness+this.padding.y,m=v*i,g=this.lineHeight?this.lineHeight-v:this._lineSpacing;for(g<0&&Math.abs(g)>v&&(g=-v),0!==g&&(m+=g>0?g*t.length:g*(t.length-1)),this.canvas.height=m*this._res,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="middle",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round",this._charCount=0,u=0;u<i;u++)f=this.style.strokeThickness/2,p=this.style.strokeThickness/2+u*v+o.ascent,u>0?p+=g*u+(this.lineHeight?g/2:0):this.lineHeight&&(p+=g/2),"right"===this.style.align?f+=a-r[u]:"center"===this.style.align&&(f+=(a-r[u])/2),this.autoRound&&(f=Math.round(f),p=Math.round(p)),this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.updateLine(t[u],f,p):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===n?this.context.strokeText(t[u],f,p):this.renderTabLine(t[u],f,p,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===n?this.context.fillText(t[u],f,p):this.renderTabLine(t[u],f,p,!0)));this.updateTexture(),this.dirty=!1}},{key:"advancedWordWrap",value:function(e){for(var t=this.context,n=this.style.wordWrapWidth,r="",a=e.split(this.splitRegExp),o=0;o<a.length;o++){var i=a[o];if(t.measureText(i).width<n)r+=i+"\n";else{for(var u="",c=n,s=0;s<i.length;s++){var l=i[s],d=t.measureText(l).width;if(d>c){var h=i.slice(s);a.splice(o+1,0,h);break}u+=l,c-=d}r+=u+"\n"}}return r=r.replace(/[\s|\n]*$/gi,"")}},{key:"loadImageTag",value:function(e){var t=this;e.url=u.c.switcLoadDomain(this.transformUrl(e.url,e)||"");e.url.toLowerCase().includes(".gif")?this.xhrLoad(e,e.url,"arraybuffer",function(n){var r,a=n.requestObject.response;a instanceof ArrayBuffer&&(r=new Uint8Array(a));var o=!1;r[0]!=="G".charCodeAt()||r[1]!=="I".charCodeAt()||r[2]!=="F".charCodeAt()||r[3]!=="8".charCodeAt()||r[4]!=="9".charCodeAt()&&!"7".charCodeAt()||r[5]!=="a".charCodeAt()||(o=!0),e.data=new Image,e.data.name=e.key,t.crossOrigin&&(e.data.crossOrigin=t.crossOrigin);if(e.data.onload=function(){URL.revokeObjectURL(e.url),e.data.onload&&(e.data.onload=null,e.data.onerror=null,t.fileComplete(e))},e.data.onerror=function(){URL.revokeObjectURL(e.url),e.data.onload&&(e.data.onload=null,e.data.onerror=null,t.fileError(e))},o)var i=e.key,c=t.game.cache,s=u.c.spliceGif(a,function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c.checkImageKey(i)?(t.image=new PIXI.Texture(new PIXI.BaseTexture(t.image)),e.data.frames.push(t),e.data.parsed=n):s&&s.cancel&&s.cancel()}).then(function(n){var r=n.frames,a=n.parsed,o=n.frameLength,i=n.loopCount;e.data=r[0].image,e.data.frameLength=o,e.data.parsed=a,e.data.name=e.key,e.data.frames=r.map(function(e){return e.image=new PIXI.Texture(new PIXI.BaseTexture(e.image)),e}),e.data.loopCount=i,t.fileComplete(e)},function(){return t.fileError(e)});else e.url=URL.createObjectURL(u.c.createBlob(a,"")),e.data.src=e.url;e.data.complete&&e.data.width&&e.data.height&&(e.data.onload=null,e.data.onerror=null,t.fileComplete(e))}):Phaser.Loader.prototype.loadImageTag.call(this,e)}},{key:"soundStop",value:function(){var e=this;if(this.isPlaying&&this._sound)if(this.usingWebAudio){if(this.externalNode){var t=this._sound.onended;this._sound.onended=function(){e._sound.disconnect(e.externalNode),t&&t()}}else if(this.gainNode){var n=this._sound.onended;this._sound.onended=function(){e._sound.disconnect(e.gainNode),n&&n()}}if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(e){alert(e)}}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(this.pendingPlayback=!1,this.isPlaying=!1,!this.paused){var r=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",null!==this.fadeTween&&this.fadeTween.stop(),this.onStop.dispatch(this,r)}}},{key:"soundDecode",value:function(e,t){var n=this;t=t||null;var r=this.game.cache.getSoundData(e);if(r&&!1===this.game.cache.isSoundDecoded(e)){this.game.cache.updateSound(e,"isDecoding",!0);var a=this,o=function(){n.onSoundDecodeError.dispatch(e),console.warn("Unable to encode audio "+e)};try{this.context.decodeAudioData(r,function(n){n&&(a.game.cache.decodedSound(e,n),a.onSoundDecode.dispatch(e,t))}).catch(o)}catch(e){o()}}}},{key:"loadAudioTag",value:function(e){var t=this,n=e.url;n.indexOf("?")>=0&&(n=n.substr(0,n.indexOf("?")));var r="dat"===n.substr((Math.max(0,n.lastIndexOf("."))||1/0)+1).toLowerCase();e.url=u.c.switcLoadDomain(e.url);var a=function(e){if(t.game.sound.touchLocked)e.data=s.get(),e.data.name=e.key,e.data.src=t.transformUrl(e.url,e),t.fileComplete(e);else{var n,r=s.get();if(e.data=r,e.data.name=e.key,!s.exist(r))return t.game.sound.touchLocked=!0,e.data.src=t.transformUrl(e.url,e),void t.fileComplete(e);var a=function r(){n&&clearTimeout(n),e.data.removeEventListener("canplaythrough",r,!1),e.data.onerror=null,t.fileComplete(e)};e.data.onerror=function(r){console.error("".concat(e.url," load error")),n&&clearTimeout(n),e.data.removeEventListener("canplaythrough",a,!1),e.data.onerror=null,t.fileComplete(e)},e.data.src=t.transformUrl(e.url,e),e.data.addEventListener("canplaythrough",a,!1);var o=navigator.userAgent.toLowerCase();(o.indexOf("firefox")>-1||o.indexOf("baidu")>-1)&&(e.data.preload="auto",n=setTimeout(function(){n&&clearTimeout(n),t.fileComplete(e)},3e3));try{e.data.load()}catch(r){n&&clearTimeout(n),t.fileComplete(e)}}};r?function(e){t.game.device.android?a(e):t.xhrLoad(e,t.transformUrl(e.url,e),"arraybuffer",function(e,t){e.url=URL.createObjectURL(new Blob([t.response],{type:"audio/mp3"})),e.isDatFile=!0,a(e)})}(e):a(e)}},{key:"tintWithMultiply",value:function(e,t,n){var r=n.getContext("2d"),a=e.crop,o=a.width,i=a.height;e.rotated&&(o=i,i=a.width),n.width===o&&n.height===i||(n.width=o,n.height=i),r.clearRect(0,0,o,i),r.drawImage(e.baseTexture.source,a.x,a.y,o,i,0,0,o,i),r.globalCompositeOperation="source-atop",r.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),r.fillRect(0,0,o,i),r.globalCompositeOperation="source-over"}}]),e}();window.PIXI=n(156),window.Phaser=n(157),PIXI.CanvasTinter.tintWithMultiply=l.tintWithMultiply,Phaser.Text.prototype.updateText=l.updateText,Phaser.Game.prototype.destroyComponent=new Phaser.Signal;var d=PIXI.Sprite.prototype.destroy;PIXI.Sprite.prototype.destroy=function(){var e=this.game;d.apply(this,arguments),e&&e.destroyComponent&&e.destroyComponent.dispatch(this.key||null),Phaser.CanvasPool.remove(this)};var h=Phaser.Sprite.prototype._renderCanvas;Phaser.Sprite.prototype._renderCanvas=function(){try{h.apply(this,arguments)}catch(e){console.log(this.key)}};var f=Phaser.Image.prototype.destroy;Phaser.Image.prototype.destroy=function(){var e=this.game;f.apply(this,arguments),e&&e.destroyComponent&&e.destroyComponent.dispatch(this.key||null),Phaser.CanvasPool.remove(this)};var p=Phaser.Button.prototype.destroy;Phaser.Button.prototype.destroy=function(){var e=this;Object.keys(this).forEach(function(t){e.hasOwnProperty(t)&&e[t]instanceof Phaser.Sound&&e[t].destroy()}),p.apply(this,arguments)};var v={};Phaser.Loader.prototype.forceRemoveFile=function(e,t,n){var r=this,a=this.getAsset(e,t);if(a){var o=a.file;if(o.loaded||o.loading){var i=function(){v[t]&&("audio"===e&&r.cache.checkSoundKey(t)&&n&&n(t),"image"===e&&r.cache.checkImageKey(t)&&n&&n(t),v[t]=null)},u=function e(n,a,o,u,c){a==t&&(i(),r.onFileComplete.remove(e))};v[t]&&this.onFileComplete.remove(v[t]),v[t]=u,a.loaded&&i(),a.loading&&this.onFileComplete.add(u)}else o.loaded=o.error=!0}},Phaser.Loader.prototype.cancelForceRemoveFile=function(e,t){v[t]&&(this.onFileComplete.remove(v[t]),v[t]=null)},Phaser.Loader.prototype.audio=function(e,t,n,r){return this.game.sound.noAudio?this:("string"==typeof t&&(t=[t]),this.addToFileList("audio",e,t,{buffer:null,autoDecode:!1},n,void 0,r))},Phaser.Loader.prototype.image=function(e,t,n,r){return"object"===a(t)?this.texture(e,t,n):this.addToFileList("image",e,t,void 0,n,".png",r)},Phaser.Loader.prototype.addToFileList=function(e,t,n,r,a,o,i){if(void 0===a&&(a=!1),void 0===t||""===t)return console.warn("Phaser.Loader: Invalid or no key given of type "+e),this;if(null==n){if(!o)return console.warn("Phaser.Loader: No URL given for file type: "+e+" key: "+t),this;n=t+o}var u={type:e,key:t,path:this.path,url:n,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1};if(r)for(var c in r)u[c]=r[c];var s=this.getAssetIndex(e,t);if(a&&s>-1){var l=this._fileList[s];l.error||l.loaded?(i?this._fileList.splice(this._processingHead,0,u):this._fileList.push(u),this._totalFileCount++):this._fileList[s]=u}else-1===s&&(i?this._fileList.splice(this._processingHead,0,u):this._fileList.push(u),this._totalFileCount++);return this},Phaser.Loader.prototype.loadAudioTag=l.loadAudioTag;var m=Phaser.Sound.prototype.destroy;Phaser.Sound.prototype.destroy=function(){if(m.apply(this,arguments),this.usingWebAudio){this.game.sound.context&&!this.game.sound.scratchBuffer&&(this.game.sound.scratchBuffer=this.game.sound.context.createBuffer(1,1,22050));try{this._sound.buffer=this.game.sound.scratchBuffer}catch(e){}}this._sound=null},Phaser.Cache.prototype.reloadSound=function(e){var t=this,n=this.getSound(e);if(n&&!s.exist(n.data)){var r=s.get();if(!s.exist(r))return;n.data=r,n.data.src=n.url,n.data.addEventListener("canplaythrough",function(){return t.reloadSoundComplete(e)},!1),n.data.load()}},Phaser.Cache.prototype.removeImage=function(e,t){void 0===t&&(t=!0);var n=this.getImage(e,!0);n.data.frames&&(n.data.frames=null),t&&n.base&&n.base.destroy(),delete this._cache.image[e]},Phaser.Device.canPlayAudio=function(e){return!("mp3"!==(e=e.replace(/\~.*/g,""))||!this.mp3)||(!("ogg"!==e||!this.ogg&&!this.opus)||(!("m4a"!==e||!this.m4a)||(!("opus"!==e||!this.opus)||(!("wav"!==e||!this.wav)||(!("webm"!==e||!this.webm)||(!("mp4"!==e||!this.dolby)||"dat"===e))))))},Phaser.SoundManager.prototype.setMute=function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this.game.device.iOS&&this._sounds[e].pause(),this._sounds[e].mute=!0);this.onMute.dispatch()}},Phaser.SoundManager.prototype.unsetMute=function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this.game.device.iOS&&this._sounds[e].resume(),this._sounds[e].mute=!1);this.onUnMute.dispatch()}};var g=Phaser.RetroFont.prototype;Phaser.RetroFont=function(e,t,n,r,a,o,i,u,c,s){var l=e.cache;if(!l.checkImageKey(t))return!1;var d=l.getImage(t,!0),h=d.data,f=d.grabData,p=void 0===f?[]:f,v=d.frameData;null==o&&(o=h.width/n),this.characterWidth=n,this.characterHeight=r,this.characterSpacingX=i||0,this.characterSpacingY=u||0,this.characterPerRow=o,this.offsetX=c||0,this.offsetY=s||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=h,this._text="",this.grabData=p,this.frameData=v,this.stamp=new Phaser.Image(e,0,0,t,0),Phaser.RenderTexture.call(this,e,100,100,"",Phaser.scaleModes.NEAREST),this.type=Phaser.RETROFONT},Phaser.RetroFont.prototype=g,Phaser.RetroFont.prototype.constructor=Phaser.RetroFont;var y=Phaser.RetroFont.prototype.destroy;Phaser.RetroFont.prototype.destroy=function(){y.call(this,!0),Phaser.CanvasPool.remove(this.stamp)},Phaser.MSPointer.prototype.onPointerOut=function(e){if(this.event=e,this.capture&&e.preventDefault(),"mouse"===e.pointerType||4===e.pointerType)this.input.mousePointer.withinGame=!1,this.input.mousePointer.leave(e);else{var t=this.input.getPointerFromIdentifier(e.identifier);t&&(t.withinGame=!1)}this.input.mouse.mouseOutCallback&&this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,e),this.input.enabled&&this.enabled&&this.input.mouse.stopOnGameOut&&(e.identifier=0,t?t.stop(e):this.input.mousePointer.stop(e))},PIXI.CanvasTinter.getTintedTexture=function(e,t){var n=e.tintedTexture||Phaser.CanvasPool.create(e);return PIXI.CanvasTinter.tintMethod(e.texture,t,n),n},Phaser.Text.prototype.updateTexture=function(){var e=this.texture.baseTexture,t=this.texture.crop,n=this.texture.frame,r=this.canvas.width,a=this.canvas.height;if(e.width=r,e.height=a,t.width=r,t.height=a,n.width=r,n.height=a,this.texture.width=r,this.texture.height=a,this._width=r,this._height=a,this.textBounds){var o=this.textBounds.x,i=this.textBounds.y;"right"===this.style.boundsAlignH?o+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(o+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?i+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(i+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=0|-(o+.5),this.pivot.y=0|-(i+.5)}this.renderable=0!==r&&0!==a,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()};n(158);var w="b4ccec13009d3ea674ee53ccb7f04a51bc4d3f29",b=(n(65),n(96),n(3)),_=(n(13),n(16));function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(55);var k=n(2),P=n.n(k),C=n(0);n(32),n(119),n(120);function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){x(e,t,n[t])})}return e}n(66);var O=function(e,t){var n="趣国囊巍囍WMQybdfgjpqy",r=document.createElement("span");r.style.fontSize=t+"px",r.innerHTML=n[0],r.style.fontFamily=e,r.style.position="absolute",r.style.top="0px",r.style.zIndex=-1,document.body.appendChild(r);for(var a=0,o=r.offsetHeight,i=0;i<n.length;i++)r.innerHTML=n[i],a=a>r.offsetWidth?a:r.offsetWidth;return document.body.removeChild(r),{width:a,height:o}},E=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"init",value:function(t,n){if(t){if(e.options=t,t.size?t.size.target.width?(e.charWidth=t.size.target.width,e.charHeight=t.size.target.height):(e.charWidth=t.size.target,e.charHeight=t.size.target):(e.charWidth=n,e.charHeight=n,e.options=Object.assign({size:{target:n,source:n}},e.options)),e.fontFamily=t.fontFamily,function(e){var t=["Microsoft YaHei","Helvetica","sans-serif","serif"],n=document.createElement("span");n.style.fontSize="72px",n.innerHTML="qwertyuiopasdfghjklzxcvbnm";var r={},a={};return t.forEach(function(e){n.style.fontFamily=t[e],document.body.appendChild(n),r[t[e]]=n.offsetWidth,a[t[e]]=n.offsetHeight,document.body.removeChild(n)}),t.some(function(o){n.style.fontFamily=e+","+t[o],document.body.appendChild(n);var i=n.offsetWidth!=r[t[o]]||n.offsetHeight!=a[t[o]];return document.body.removeChild(n),i})}(t.fontFamily)){var r=t.size?t.size.source:n,a=O(t.fontFamily,r),o=a.width,i=a.height;return e.charWidth=o,void(e.charHeight=i)}var c=e.charWidth,s=e.charHeight,l=e.fontFamily,d=t.images.map(function(e){var t=e.url,n=e.chars;return{url:u.c.convertToFullUrl(t),chars:n}}),h=document.createElement("canvas"),f=h.getContext("2d"),p=d.length;h.width=40*c,h.height=20*s;var v=game.cache.addImage(l,l,h),m=new Phaser.FrameData,g={};!function t(n,r){if(n<p){var a=d[n],o=a.url,i=a.chars,l=new Image;l.crossOrigin="anonymous",l.src=o,l.onerror=function(){return console.error(new Error("".concat(o," load error")))},l.onload=function(){f.clearRect(0,0,h.width,h.height),f.drawImage(l,0,0),function(t,n){for(var r=0,a=0,o=0,i=function(i,u){var l=e.getRealImageCharWidth(t[i]),d=m.addFrame(new Phaser.Frame(n+i,0,0,l,s)),h=~~(r+(c-l)/2),p=~~a;setTimeout(function(){return g[t.charCodeAt(i)]={index:d.index,imageData:f.getImageData(h,p,l,s)}},0),40==++o?(o=0,r=0,a+=s):r+=c},l=0,d=t.length;l<d;l++)i(l);return u.c.timeout(10)}(i,r).then(function(){return t(n+1,r+i.length)})}}else v.frameData=m,v.grabData=g,h.width=c,h.height=s,f.clearRect(0,0,c,s),e.fontImage=h}(0,0)}}},{key:"getRealImageCharWidth",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=e.charWidth,a=0,o=Math.floor(r/4);return/[MWwm]/.test(t)?a=2*(o-4):/[@&]/.test(t)?a=2*(o-3):/[A-Z<>%]/.test(t)?a=2*(o-2):/[iI,.|']/g.test(t)?a=3*o:/[\+=\/\\\+=?~#$:"{}\-*^!`\[\]()]|[a-z]/g.test(t)?a=Math.floor(5*r/8):/[0-9]/.test(t)&&(a=2*o),n*(r-a)}},{key:"getRealImageCharOffset",value:function(t,n){var r=0,a=e.options.size,o=a.target,i=a.source,u=o.width||o;if(/^\u3000|\u2003$/.test(t))r=u*n/i-n;else if(/^\x20|\xA0|\u2002$/.test(t))r=u*n/i-n/2;else if(!/[\+=\/\\——\+=?~#$:"{}\-*^!`\[\]()]|[0-9a-z]/g.test(t)){var c=o.width||o;r=(r=Math.round(n*(c/i-1)))&&r%2==1?r-1:r}return r}},{key:"getSizeScale",value:function(t,n){return n=parseFloat(n),e.fontFamily!==t?1:n/e.options.size.source}},{key:"toRealSize",value:function(t,n){if(n=parseFloat(n),e.fontFamily!==t)return O(t,n);var r=e.options.size,a=r.target,o=r.source;return{height:n*(a&&a.height?a.height:a)/o,width:n*(a&&a.width?a.width:a)/o}}},{key:"lineSpacing",value:function(t,n){return 1.5*n-e.toRealSize(t,n).height}},{key:"getCharWidth",value:function(e,t){return/[a-zA-Z0-9]/.test(e)?14*t/25:"("===e||")"===e?8*t/25:"-"===e?11*t/25:"."===e||":"===e?7:32===e.charCodeAt(0)||160===e.charCodeAt(0)||" "===e?t>>1:t}},{key:"getLeftMargin",value:function(e,t){return/[a-zA-Z0-9\.\)]/.test(e)?0:"("===e||":"===e?-4*t/25:"-"===e?-t/25:6*t/25}},{key:"useFontImage",get:function(){return!!e.fontImage}}]),e}();E.fontImage=void 0,E.fontFamily="",E.charWidth=25,E.charHeight=25;n(64);var I=n(5),M=n(10),A=[],V={resumeAudio:null,pauseAudio:null,unlockChapter:null,mallPay:null,showSave:null,audioCanPlay:null,audioError:null,shanyiMenuBack:null,shanyiMenuExit:null,login:null,logout:null,restart:null,showGameNotice:null,updatevolume:null,setAttribute:null,unlockpayrecord:null,playadBack:null,rechargeback:null,finishedPreferential:function(e){return A.push(e.uuid?e.uuid:e)}},T=function(e,t){return V[e]&&V[e](t)},j=null,U=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"isAppClient",value:function(){var e=C.a.client,t=C.a.offline;return"android"===e?window.app&&window.app.unlock:"ios"===e&&(t||!t&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.unlock)}},{key:"init",value:function(){var t=C.a.app_version,n=C.a.client,r=C.a.single;C.a.useExternalAudioLoader="ios"===n&&(u.c.compareVersions(t,"1.5.0")||r)>=0,C.a.useExternalAudioLoader||(e.loadAudio=!1,e.playAudio=null,e.stopAudio=null,e.removeAudio=null,e.setAudioVolume=null)}},{key:"isFinishedPreferentialChapter",value:function(e){return A.some(function(t){return t===e})}},{key:"removeFinishedPreferentialChapter",value:function(e){var t=A.findIndex(function(t){return t===e});~t&&A.splice(t,1)}},{key:"unlockChapter",value:function(t){var n=function(){return Promise.reject("ExternalShanyiApi unlockChapter is error")},r=C.a.gid,a=C.a.client,o=C.a.offline,i=C.a.uuid,c=C.a.app_version,s=C.a.uid;return u.c.compareVersions(c,"1.2.0")<0&&e.isAppClient()?(e.unlockChapter=function(){return I.a.info("该章节为付费章节，当前版本过低，不支持该功能")},e.unlockChapter(t)):(e.unlockChapter="ios"===a?o?function(t){return unlock?new Promise(function(n,a){var o=t.charge,i=t.uuid,u=t.md5,c=t.discounts;e.setCallback("unlockChapter",n),unlock(JSON.stringify({gid:r,uuid:i,charge:o,md5:u,special_price:c}))}):n}:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.unlock?function(t){return new Promise(function(n,a){var o=t.charge,i=t.uuid,u=t.md5,c=t.discounts;e.setCallback("unlockChapter",n),window.webkit.messageHandlers.unlock.postMessage(JSON.stringify({gid:r,uuid:i,charge:o,md5:u,special_price:c}))})}:n:"android"===a?window.app&&window.app.unlock?function(t){return new Promise(function(n,a){var o=t.charge,i=t.uuid,u=t.md5;e.setCallback("unlockChapter",n),window.app.unlock(r,i,o,u)})}:n:"wap"===a?window.parent&&window.parent.get_account_info?function(t){return new Promise(function(n,a){var o=t.charge,u=t.uuid,c=t.md5,l=t.discounts;e.setCallback("unlockChapter",function(e){game.gameResumed(),n(e)}),window.parent.get_account_info(JSON.stringify({gid:r,md5:c,charge:o,uuid:i,special_price:l,chapter_uuid:u,author_id:s,consume_falg:"chapter"}))})}:n:"pc"===a&&window.parent&&window.parent.H5payFlash?function(t){return new Promise(function(n,r){try{e.setCallback("unlockChapter",function(e){game.gameResumed(),n(e)});var a=t.uuid,o=(t.md5,t.charge),u=(t.discounts,t.charge_app),c=t.charge_pc,s=t.chaptername,l=t.time,d=t.token,h=t.starToken;window.parent.H5payFlash(i,a,s,o,l,d,h,c,u,"unlockChapterFinished")}catch(e){r()}})}:n,e.unlockChapter(t))}},{key:"pay",value:function(t){var n=C.a.client,r=C.a.offline,a=C.a.uuid,o=C.a.app_version,i=C.a.wap,c=function(){return Promise.resolve(-1)};return u.c.compareVersions(o,"1.2.0")<0&&("ios"===n||"android"===n)?I.a.info("版本过低不支该改功能，请先更新版本~").then(function(){return-1},function(){return-1}):(e.pay="ios"===n?r?worksmall?function(t){return new Promise(function(n,r){try{e.setCallback("mallPay",n),worksmall(JSON.stringify(t))}catch(e){n(-1)}})}:c:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.worksmall?function(t){return new Promise(function(n,r){try{e.setCallback("mallPay",n),window.webkit.messageHandlers.worksmall.postMessage(JSON.stringify(t))}catch(e){n(-1)}})}:c:"android"===n?window.app&&window.app.worksmall?function(t){return new Promise(function(n,r){try{e.setCallback("mallPay",n),window.app.worksmall(JSON.stringify(t))}catch(e){n(-1)}})}:c:"wap"===n?"wx"===i?function(){return M.b.openWxPage(),Promise.resolve(-1)}:window.parent&&window.parent.get_account_info?function(t){return new Promise(function(n,r){try{e.setCallback("mallPay",function(e){game.gameResumed(),n(e)}),window.parent.get_account_info(JSON.stringify(S({},t,{uuid:a,consume_falg:"mall"})))}catch(e){n(-1)}})}:c:"pc"===n&&window.parent&&window.parent.H5payEvent?function(t){return new Promise(function(n,r){try{e.setCallback("mallPay",function(e){game.gameResumed(),n(e)});var a=t.uuid,o=t.eid,i=t.charge,u=t.charge_pc,c=t.charge_app,s=t.time,l=t.token,d=t.payValues,h=t.name,f=t.starToken,p=t.indentId;window.parent.H5payEvent(a,o,i,s,l,p,d,h,"mallPay",f,u,c)}catch(e){n(-1)}})}:c,e.pay(t))}},{key:"notifyGameStarted",value:function(){var t=function(){},n=C.a.client,r=C.a.offline,a=C.a.app_version,o=C.a.wap;C.a.single||u.c.compareVersions(a,"1.3.0")<0&&e.isAppClient()?e.notifyGameStarted=t:"ios"===n?r?gameStart&&gameStart("1"):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.gameStart&&window.webkit.messageHandlers.gameStart.postMessage("1"):"android"===n?window.app&&window.app.gameStart&&window.app.gameStart("1"):"pc"===n?window.parent&&window.parent.clickFlash&&window.parent.clickFlash():(!o||o&&"3000"===o)&&j&&j(),e.notifyGameStarted=t}},{key:"localStorageSetItem",value:function(t,n){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var r=function(e,t){return window.localStorage.setItem(e,t)},a=C.a.client,o=C.a.offline,i=C.a.app_version,c=C.a.wap;if(u.c.compareVersions(i,"1.2.0")<0&&e.isAppClient())e.localStorageSetItem=r;else if("ios"===a)e.localStorageSetItem=o?localStorage_setItem?function(e,t){return localStorage_setItem(JSON.stringify({key:e,value:t}))}:r:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.localStorage_setItem?function(e,t){window.webkit.messageHandlers.localStorage_setItem.postMessage(JSON.stringify({key:e,value:t})),window.localStorage.setItem(e,t)}:r;else if("android"===a)e.localStorageSetItem=window.app&&window.app.localStorage_setItem?function(e,t){return window.app.localStorage_setItem(e,t)}:r;else if("wap"===a&&"wx"===c)try{e.localStorageSetItem=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=new Date(1e3*(u.a.getCurDate+24*n*60*60));document.cookie="".concat(e,"=").concat(escape(t),";expires=").concat(r.toGMTString())}}catch(t){e.localStorageSetItem=r}else e.localStorageSetItem=r;return e.localStorageSetItem(t,n)}},{key:"localStorageGetItem",value:function(t){var n=function(e){return window.localStorage.getItem(e)||null},r=C.a.client,a=C.a.offline,o=C.a.app_version,i=C.a.wap;C.a.single;return u.c.compareVersions(o,"1.2.0")<0&&e.isAppClient()?e.localStorageGetItem=n:e.localStorageGetItem="ios"===r?a&&localStorage_getItem?function(e){return localStorage_getItem(e)||null}:n:"android"===r?window.app&&window.app.localStorage_getItem?function(e){return window.app.localStorage_getItem(e)||null}:n:"wap"===r&&"wx"===i?function(e){try{var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=document.cookie.match(t);return n?unescape(n[2]):""}catch(e){return""}}:n,e.localStorageGetItem(t)}},{key:"localStorageRemoveItem",value:function(t){var n=function(e){return window.localStorage.removeItem(e)},r=C.a.client,a=C.a.offline,o=C.a.app_version,i=C.a.wap;C.a.single;if(u.c.compareVersions(o,"1.2.0")<0&&e.isAppClient())e.localStorageRemoveItem=n;else if("ios"===r)e.localStorageRemoveItem=a?removeLocalStorage?function(e){return removeLocalStorage(e)}:n:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.localStorage_setItem?function(e){return window.webkit.messageHandlers.removeLocalStorage.postMessage(e)}:n;else if("android"===r)e.localStorageRemoveItem=window.app&&window.app.removeLocalStorage?function(e){return window.app.removeLocalStorage(e)}:n;else if("wap"===r&&"wx"===i)try{e.localStorageRemoveItem=function(t){e.localStorageSetItem(t,"",-1)}}catch(t){e.localStorageRemoveItem=n}else e.localStorageRemoveItem=n;return e.localStorageRemoveItem(t)}},{key:"setCallback",value:function(e,t){void 0!==V[e]?"function"==typeof t?V[e]=t:console.warn("callback not function"):console.warn("callback key is error")}},{key:"loadAudio",value:function(t){var n=C.a.client,r=C.a.offline,a=C.a.app_version;C.a.single;return u.c.compareVersions(a,"1.5.0")<0||"ios"!==n?e.loadAudio=null:e.loadAudio=r?loadAudioUrl?function(e){return loadAudioUrl(JSON.stringify(e))}:null:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.loadAudioUrl?function(e){return window.webkit.messageHandlers.loadAudioUrl.postMessage(JSON.stringify(e))}:null,e.loadAudio&&e.loadAudio(t)}},{key:"playAudio",value:function(t){var n=C.a.client,r=C.a.offline,a=C.a.app_version;return u.c.compareVersions(a,"1.5.0")<0||"ios"!==n?e.playAudio=null:e.playAudio=r?playAudioUrl?function(e){return playAudioUrl(JSON.stringify(e))}:null:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.playAudioUrl?function(e){return window.webkit.messageHandlers.playAudioUrl.postMessage(JSON.stringify(e))}:null,e.playAudio&&e.playAudio(t)}},{key:"stopAudio",value:function(t){var n=C.a.client,r=C.a.offline,a=C.a.app_version;return u.c.compareVersions(a,"1.5.0")<0||"ios"!==n?e.playAudio=null:e.stopAudio=r?stopAudioUrl?function(e){return stopAudioUrl(JSON.stringify(e))}:null:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.stopAudioUrl?function(e){return window.webkit.messageHandlers.stopAudioUrl.postMessage(JSON.stringify(e))}:null,e.stopAudio&&e.stopAudio(t)}},{key:"setAudioVolume",value:function(t){var n=C.a.client,r=C.a.offline,a=C.a.app_version;return u.c.compareVersions(a,"1.5.0")<0||"ios"!==n?e.setAudioVolume=null:e.setAudioVolume=r?setAudioUrlVolume?function(e){return setAudioUrlVolume(JSON.stringify(e))}:null:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.setAudioUrlVolume?function(e){return window.webkit.messageHandlers.setAudioUrlVolume.postMessage(JSON.stringify(e))}:null,e.setAudioVolume&&e.setAudioVolume(t)}},{key:"removeAudio",value:function(t){var n=C.a.client,r=C.a.offline,a=C.a.app_version;return u.c.compareVersions(a,"1.5.0")<0||"ios"!==n?e.removeAudio=null:e.removeAudio=r?removeAudioUrl?function(e){return removeAudioUrl(JSON.stringify(e))}:null:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.removeAudioUrl?function(e){return window.webkit.messageHandlers.removeAudioUrl.postMessage(JSON.stringify(e))}:null,e.removeAudio&&e.removeAudio(t)}},{key:"switchAppBack",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=C.a.app_version,r=C.a.client,a=C.a.offline,o=function(){};return u.c.compareVersions(n,"1.8.1")>=0?e.switchAppBack="ios"===r?a?setVolumeState?function(e){return setVolumeState(JSON.stringify({state:!e}))}:o:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.setVolumeState?function(e){return window.webkit.messageHandlers.setVolumeState.postMessage(JSON.stringify({state:!e}))}:o:"android"===r&&window.app&&window.app.setVolumeState?function(e){return window.app.setVolumeState(e?"false":"true")}:o:e.switchAppBack=o,e.switchAppBack(t)}},{key:"login",value:function(){var t=function(){},n=C.a.client,r=C.a.single;return e.login=r?"ios"===n&&appLogin?function(){return appLogin()}:t:"android"===n||"ios"===n?function(){return window.location.href="lzj3000://login"}:"wap"===n?window.parent&&window.parent.playLogin?function(){return window.parent.playLogin()}:t:"pc"===n&&window.parent&&window.parent.playerIslogin?function(){return window.parent.playerIslogin()}:t,e.login()}},{key:"logout",value:function(){var t=function(){},n=C.a.app_version,r=C.a.client;return C.a.single?e.logout="ios"===r&&appLogout?function(){return appLogout()}:t:("android"===r||"ios"===r)&&u.c.compareVersions(n,"1.2.0")>=0?e.logout=function(){return window.location.href="lzj3000://logout"}:e.logout=t,e.logout()}},{key:"openShanyiMenu",value:function(){var t=C.a.client,n=C.a.app_version;return u.c.compareVersions(n,"1.2.0")<0&&e.isAppClient()?I.a.info("版本过低，不支持该功能"):e.openShanyiMenu="pc"===t?window.parent&&window.parent.infoFlash?function(){window.parent.infoFlash()}:function(){}:function(){return window.location.href="lzj3000://menu"},e.openShanyiMenu()}},{key:"refreshApp",value:function(){var t=function(){},n=C.a.app_version,r=C.a.client,a=C.a.offline;return u.c.compareVersions(n,"1.11.0")<0?I.a.info("版本过低，不支持刷新功能"):"android"===r?e.refreshApp=window.app&&window.app.refresh?function(){return window.app.refresh()}:t:"ios"===r&&(a?refresh:e.refreshApp=window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.refresh?function(){return window.webkit.messageHandlers.refresh.postMessage()}:t),e.refreshApp()}},{key:"toOpenNotice",value:function(){var t=C.a.client;return e.toOpenNotice="pc"===t&&window.parent&&window.parent.toOpenNotice?function(){window.parent.toOpenNotice()}:function(){},e.toOpenNotice()}},{key:"gameReady",value:function(){"pc"===C.a.client&&window.parent&&window.parent.game_ready&&window.parent.game_ready()}},{key:"urlExpire",value:function(){var t=C.a.client;return e.urlExpire="pc"===t&&window.parent&&window.parent.urlExpire?function(){window.parent.urlExpire()}:function(){},e.urlExpire()}},{key:"gameQuit",value:function(){var t=C.a.client,n=C.a.single,r=function(){};return"ios"===t&&n?e.gameQuit=appQuit?function(){return appQuit()}:r:"pc"===t&&(e.gameQuit=window.parent&&window.parent.game_quit?function(){window.parent.game_quit()}:r),e.gameQuit()}},{key:"fullScreenFromPc",value:function(){var t=C.a.client;return e.fullScreenFromPc="pc"===t&&window.parent&&window.parent.gameFlashFullScreen&&window.parent.gameFlashFullScreen.fullFunc?function(){window.parent.gameFlashFullScreen.fullFunc("h5")}:function(){},e.fullScreenFromPc()}},{key:"exitFullScreenFromPc",value:function(){var t=C.a.client;return e.exitFullScreenFromPc="pc"===t&&window.parent&&window.parent.gameFlashFullScreen&&window.parent.gameFlashFullScreen.outFullFunc?function(){window.parent.gameFlashFullScreen.outFullFunc()}:function(){},e.exitFullScreenFromPc()}},{key:"singlePlayAd",value:function(){var t=C.a.client,n=C.a.wap,r=C.a.singleoffline,a=function(){return Promise.reject()};return r||(e.singlePlayAd=a),r&&("android"==t?e.singlePlayAd=window.app&&window.app.playAdVideo?function(){return new Promise(function(t,n){e.setCallback("playadBack",t),window.app.playAdVideo()})}:a:"4399"==n&&(e.singlePlayAd=function(){return new Promise(function(e,t){M.a.playAd(function(t){return e(t)})})})),e.singlePlayAd()}},{key:"singleSaveValue",value:function(t,n){var r=C.a.client,a=function(t,n){return e.localStorageSetItem(t,n)};return e.singleSaveValue="android"==r&&window.app&&window.app.saveGameValue?function(e,t){return window.app.saveGameValue(e,t)}:a,e.singleSaveValue(t,n)}},{key:"singleGetValue",value:function(t){var n=C.a.client,r=function(t){return e.localStorageGetItem(t)};return e.singleGetValue="android"==n&&window.app&&window.app.readGameValue?function(e){return window.app.readGameValue(e)}:r,e.singleGetValue(t)}},{key:"singleRecharge",value:function(){var t=C.a.client,n=C.a.single,r=function(){return Promise.reject()};return e.singleRecharge=n&&"ios"==t&&appRecharge?function(){return new Promise(function(e,t){appRecharge()})}:r,e.singleRecharge()}},{key:"gameStartedApi",set:function(e){j=e}}]),e}();window.resumeAudio=function(){return T("resumeAudio")},window.pauseAudio=function(){return T("pauseAudio")},window.setLoginInfo=function(e){"wap"===e.client?e.uid&&(C.a.uid=e.uid):(e.token&&(C.a.token=e.token),e.u&&(C.a.u=e.u),e.uid&&(C.a.uid=e.uid)),T("login")},window.logoutAccount=function(){"wap"===C.a.client?C.a.uid="":(C.a.token="",C.a.u="",C.a.uid=""),T("logout")},window.unlockChapterFinished=function(e){return T("unlockChapter",e)},window.mallPay=function(e){return T("mallPay",e)},window.preferentialFinished=function(e){return T("finishedPreferential",e)},window.showSave=function(){return T("showSave")},window.audioCanPlayCallBack=function(e){return T("audioCanPlay",e)},window.audioErrorCallBack=function(e){return T("audioError",e)},window.localStorage_getItem=function(e){return""},window.localStorage_setItem=function(e,t){},window.removeLocalStorage=function(e){},window.syMenuBack=function(){return T("shanyiMenuBack")},window.syMenuExit=function(e){return T("shanyiMenuExit",e)},window.restart=function(e){return T("restart",!0)},window.showGameNotice=function(){return T("showGameNotice",!0)},window.volume=function(e){return T("updatevolume",e)},window.setAttribute=function(e){return T("setAttribute",e)},window.unlockpayrecord=function(e){return T("unlockpayrecord",e)},window.playadBack=function(e){return T("playadBack",e)},window.rechargeback=function(e){return T("rechargeback",e)};for(var R={},D={},L={},B={},F=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"getLoadingCount",value:function(){return Object.keys(R).length}},{key:"load",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;e.inCache(t)||(r||n.includes("https")||n.includes("http")||(n="https:".concat(n)),R[t]=!0,L[t]=!1,U.loadAudio&&U.loadAudio({url:n,key:t,local:r}))}},{key:"play",value:function(t){var n=t.key,r=t.volume,a=void 0===r?1:r,o=t.loop,i=void 0===o||o,u=t.channel;B[u]&&e.stop(u),n&&D[n]&&U.playAudio&&(U.playAudio({volume:a,channel:u,key:n,loop:i?1:0}),B[u]={channel:u,key:n,volume:a,loop:i})}},{key:"stop",value:function(e){B[e]&&(B[e].tween&&B[e].tween.cancel(!0),B[e].tween=null,B[e].key&&U.stopAudio&&U.stopAudio({channel:e})),delete B[e]}},{key:"setVolume",value:function(e){var t=e.channel,n=e.volume,r=void 0===n?1:n,a=e.tweening,o=void 0!==a&&a;U.setAudioVolume&&U.setAudioVolume({channel:t,volume:r}),B[t]&&(B[t].volume=r,o||(B[t].tween&&B[t].tween.cancel(!0),B[t].tween=null))}},{key:"free",value:function(e){delete D[e],U.removeAudio&&U.removeAudio({key:e})}},{key:"tweenFrom",value:function(e){var t=e.channel,n=e.volume,r=void 0===n?1:n,a=e.duration,o=void 0===a?10:a,i=e.delay;return W({channel:t,volume:r,duration:o,delay:void 0===i?0:i,type:"from"})}},{key:"tweenTo",value:function(e){var t=e.channel,n=e.volume,r=void 0===n?1:n,a=e.duration,o=void 0===a?10:a,i=e.delay;return W({channel:t,volume:r,duration:o,delay:void 0===i?0:i,type:"to"})}},{key:"inCache",value:function(e){return!!D[e]||!!L[e]}},{key:"isLoading",value:function(e){return!!L[e]}},{key:"loadedCallBack",value:function(e){delete R[e],delete L[e],D[e]=!0;var t=game.load.onSoundExtendLoad;t&&t.dispatch(e)}},{key:"faultCallBack",value:function(e){delete R[e],delete D[e],L[e]=!0;var t=game.load.onSoundExtendLoadError;t&&t.dispatch(e)}}]),e}(),W=function(e){var t=e.channel,n=e.volume,r=void 0===n?1:n,a=e.duration,o=void 0===a?10:a,i=e.delay,c=void 0===i?0:i,s=e.type,l=void 0===s?"to":s,d=!1,h=B[t];if(!h)return Promise.resolve();h.tween&&h.tween.cancel();var f=Math.ceil(o/20),p=("from"===l?h.volume-r:r-h.volume)/f,v="from"===l?h.volume:r,m="from"===l?r:h.volume,g=new Promise(function(e,n){if(o<=20)return F.setVolume({channel:t,volume:r,tweening:!0}),e();u.c.timeout(c).then(function(){return function n(){return d?e():v>m&&p>0||v<m&&p<0?(m+=p,m=u.c.fixVolume(m),F.setVolume({channel:t,volume:m,tweening:!0}),void u.c.timeout(20).then(function(){return n()})):(F.setVolume({channel:t,volume:v,tweening:!0}),e())}()})});return g.cancel=function(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&F.setVolume({channel:t,volume:v}),d=!0},h.tween=g,g},N={buttonSoundUrl:"",autoPlay:!1,fastPlay:!1,soundVolume:1,musicVolume:1,full:!1,records:[]},$=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"getFastPlayAnimationInfo",value:function(e){return{delay:0,duration:Math.min(e,100)}}},{key:"buttonSoundUrl",set:function(e){N.buttonSoundUrl=e},get:function(){return N.buttonSoundUrl}},{key:"autoPlay",set:function(e){N.autoPlay=e},get:function(){return N.autoPlay}},{key:"fastPlay",set:function(e){N.fastPlay=e},get:function(){return N.fastPlay}},{key:"soundVolume",set:function(e){N.soundVolume=u.c.fixVolume(e)},get:function(){return N.soundVolume}},{key:"musicVolume",set:function(e){N.musicVolume=u.c.fixVolume(e)},get:function(){return N.musicVolume}},{key:"full",set:function(e){N.full=e},get:function(){return N.full}},{key:"records",set:function(e){N.records=e},get:function(){return N.records}}]),e}(),z=(n(121),function(e){var t=e.color,n=void 0===t?0:t,r=e.alpha,a=void 0===r?1:r,o=e.x,i=void 0===o?0:o,c=e.y,s=void 0===c?0:c,l=e.rect,d=l.x,h=void 0===d?0:d,f=l.y,p=void 0===f?0:f,v=l.width,m=l.height,g=game.make.graphics(i,s);return g.beginFill(u.c.toColorValue(n),a),g.drawRect(h,p,v,m),g.endFill(),g}),H=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"to",value:function(e){var t=e.target,n=void 0===t?{}:t,r=e.properties,a=e.duration,o=void 0===a?0:a,i=e.ease,u=e.autoStart,c=void 0===u||u,s=e.delay,l=e.repeat,d=e.yoyo,h=e.game,f=void 0===h?window.game:h;if(!o){Object.keys(r).forEach(function(e){return n[e]=r[e]});var p=Promise.resolve();return p.cancel=function(){return Object.keys(r).forEach(function(e){return n[e]=r[e]})},p}var v=null,m=new Promise(function(e,t){(v=f.add.tween(n).to(r,o,i,c,s,l,d)).onComplete.add(e)});return m.cancel=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];v.stop(),e&&Object.keys(r).forEach(function(e){return n[e]=r[e]})},m}},{key:"from",value:function(e){var t=e.target,n=void 0===t?{}:t,r=e.properties,a=e.duration,o=void 0===a?0:a,i=e.ease,u=e.autoStart,c=void 0===u||u,s=e.delay,l=e.repeat,d=e.yoyo,h=e.game,f=void 0===h?window.game:h,p={};if(Object.keys(r).forEach(function(e){return p[e]=n[e]}),!o){var v=Promise.resolve();return v.cancel=function(){return Object.keys(r).forEach(function(e){return n[e]=p[e]})},v}o=Math.max(o,1);var m=null,g=new Promise(function(e,t){(m=f.add.tween(n).from(r,o,i,c,s,l,d)).onComplete.add(e)});return g.cancel=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];m.stop(),e&&Object.keys(r).forEach(function(e){return n[e]=p[e]})},g}},{key:"shake",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.offSet,o=t.duration,i=t.delay,u=t.repeat,c=void 0===u?0:u;c=0!=c?c:Math.ceil(o/100*.6);var s={x:-a,y:-a},l=e.from({target:r,properties:s,delay:i,repeat:c,yoyo:!0,duration:50}),d=l.cancel;return l.cancel=function(){d&&d(),r.y=r.x=0},l}},{key:"twinkle",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.duration,o=t.delay,i=t.color,u=game.world,c=u.width,s=u.height,l=z({color:i,rect:{width:c,height:s}});r.add(l);var d=e.to({target:l,properties:{alpha:0},delay:o,duration:a}),h=function(){return r.remove(l,!0)};d.then(h);var f=d.cancel;return d.cancel=function(){h(),f()},d}},{key:"curtain",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.duration,o=t.delay,i=game.world,u=i.width,c=i.height,s=z({rect:{width:u/2,height:c}}),l=z({rect:{width:u/2,height:c},x:u/2});r.add(s),r.add(l);var d=e.to({target:s,properties:{x:-u/2},delay:o,duration:a}),h=e.to({target:l,properties:{x:u},delay:o,duration:a}),f=function(){d.cancel(),h.cancel(),r.remove(s,!0),r.remove(l,!0)},p=Promise.all([d,h]);return p.cancel=f,p.then(f),p}},{key:"interlacing",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.duration,o=t.delay,i=game.world,u=i.width,c=i.height,s=c/6,l=function(){var e=z({alpha:0,rect:{width:u,height:c}});return e.addChild(z({rect:{width:u,height:s},y:0})),e.addChild(z({rect:{width:u,height:s},y:2*s})),e.addChild(z({rect:{width:u,height:s},y:4*s})),e},d=l(),h=l();h.y=s,r.add(d),r.add(h);var f=e.to({target:d,properties:{x:-u},delay:o,duration:a}),p=e.to({target:h,properties:{x:u},delay:o,duration:a}),v=function(){f.cancel(),p.cancel(),r.remove(d,!0),r.remove(h,!0)},m=Promise.all([f,p]);return m.cancel=v,m.then(v),m}},{key:"coverblack",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.duration,o=t.delay,i=game.world,u=i.width,c=i.height,s=z({rect:{width:u,height:c},x:-u});r.add(s);var l=e.to({target:s,properties:{x:u},delay:o,duration:a}),d=function(){return r.remove(s,!0)};l.then(d);var h=l.cancel;return l.cancel=function(){d(),h()},l}},{key:"spread",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.duration,o=t.delay,i=game.world,u=i.centerX,c=i.centerY,s=e.from({target:r,properties:{x:u,y:c},delay:o,duration:a}),l=e.from({target:r.scale,properties:{x:0,y:0},delay:o,duration:a}),d=Promise.all([s,l]);return d.cancel=function(){s.cancel(),l.cancel(),r.x=r.y=0},d}}]),e}(),q={url:"",volume:1},G=[],K=0;K<10;K++)G.push({url:"",volume:1,loop:!1});var J={url:"",volume:1,loop:!1},Q=[],Y=function(e){if(C.a.useExternalAudioLoader)Y=function(e){var t=e.url,n=e.volume,r=void 0===n?1:n,a=e.channel,o=e.loop,i=void 0!==o&&o,c=e.target,s=e.percent,l=void 0===s?1:s;try{"inherit"===r&&(r=c.volume||1),r=u.c.fixVolume(r),F.play({key:t,volume:r*l,loop:i,channel:a}),c.url=t,c.volume=r,c.loop=i}catch(e){console.error(e)}};else{var t=game.add;Y=function(e){var n=e.url,r=e.volume,a=void 0===r?1:r,o=e.loop,i=void 0!==o&&o,c=e.target,s=e.percent,l=void 0===s?1:s;try{"inherit"===a&&(a=c.volume||1),a=u.c.fixVolume(a);var d=t.sound(n,a*l,i);d.play(),c.url=n,c.volume=a,c.audio=d,c.loop=i,re.externalProhibitVolume&&(re.updateMusicVolume(0,!0),re.updateSoundsVolume(0,!0))}catch(e){console.error(e)}}}Y(e)},Z=function(e){var t=C.a.useExternalAudioLoader;(Z=t?function(e){var t=e.channel,n=e.target;F.stop(t),n.url=""}:function(e){var t=e.target,n=t.audio;n&&n.destroy(),t.audio=null,t.url=""})(e)},X=function(e){var t=C.a.useExternalAudioLoader;(X=t?function(e){var t=e.channel,n=e.target,r=e.volume,a=void 0===r?1:r,o=e.percent,i=void 0===o?1:o;a=u.c.fixVolume(a),F.setVolume({channel:t,volume:a*i}),n.volume=a}:function(e){var t=e.target,n=e.volume,r=void 0===n?1:n,a=e.percent,o=void 0===a?1:a;r=u.c.fixVolume(r);var i=t.audio;i&&(i.volume=r*o),t.volume=r})(e)},ee=function(e){if(C.a.useExternalAudioLoader)ee=function(e){return F.free(e)};else{var t=game.cache;ee=function(e){if(t.checkSoundKey(e)){/blob:/i.test(e)&&URL.revokeObjectURL(e);var n=t.getSound(e);s.free(n.data),t.removeSound(e)}}}ee(e)},te=function(e){var t=C.a.useExternalAudioLoader;return(te=t?function(e){var t=e.volume,n=void 0===t?1:t,r=e.channel,a=e.target,o=e.percent,i=void 0===o?1:o,c=e.duration,s=void 0===c?10:c,l=e.delay,d=void 0===l?0:l;return re.externalProhibitVolume?Promise.resolve():(n=u.c.fixVolume(n),a.volume=n,F.tweenTo({volume:n*i,channel:r,duration:s,delay:d}))}:function(e){var t=e.volume,n=void 0===t?1:t,r=e.target,a=e.percent,o=void 0===a?1:a,i=e.duration,c=void 0===i?10:i,s=e.delay,l=void 0===s?0:s;if(re.externalProhibitVolume)return Promise.resolve();n=u.c.fixVolume(n);var d=r.audio;return r.volume=n,H.to({target:d||{volume:0},properties:{volume:n*o},duration:c,delay:l})})(e)},ne=function(e){var t=C.a.useExternalAudioLoader;return(ne=t?function(e){var t=e.volume,n=void 0===t?1:t,r=e.channel,a=e.percent,o=void 0===a?1:a,i=e.duration,c=void 0===i?10:i,s=e.delay,l=void 0===s?0:s;return re.externalProhibitVolume?Promise.resolve():(n=u.c.fixVolume(n),F.tweenFrom({volume:n*o,channel:r,duration:c,delay:l}))}:function(e){var t=e.volume,n=void 0===t?1:t,r=e.target,a=e.percent,o=void 0===a?1:a,i=e.duration,c=void 0===i?10:i,s=e.delay,l=void 0===s?0:s;if(re.externalProhibitVolume)return Promise.resolve();n=u.c.fixVolume(n);var d=r.audio;return H.from({target:d||{volume:0},properties:{volume:n*o},duration:c,delay:l})})(e)},re=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"inCache",value:function(t){if(C.a.useExternalAudioLoader)e.inCache=function(e){return F.inCache(e)};else{var n=game.cache;e.inCache=function(e){return n.checkSoundKey(e)}}return e.inCache(t)}},{key:"isLoading",value:function(t){if(C.a.useExternalAudioLoader)e.isLoading=function(e){return!!F.isLoading(e)};else{var n=game.load;e.isLoading=function(e){var t=(n.getAsset("audio",e)||{}).file;return t&&t.loading&&!t.loaded&&!t.error}}return e.isLoading(t)}},{key:"load",value:function(t,n,r){var a=C.a.useExternalAudioLoader,o=C.a.offline;if(a)e.load=function(e,t,n){return F.load(e,t,o)};else{var i=game.load;e.load=function(e,t,n){return i.audio(e,t,!0,n)}}e.load(t,n,r)}},{key:"playMusic",value:function(e){var t=e.url,n=void 0===t?"":t,r=e.volume,a=void 0===r?1:r;"inherit"!==n?(q.url&&Z({channel:"music",target:q}),Y({url:n,volume:a,percent:$.musicVolume,channel:"music",target:q,loop:!0})):this.setMusicVolume(a)}},{key:"stopMusic",value:function(){Z({channel:"music",target:q})}},{key:"setMusicVolume",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e.externalProhibitVolume||X({channel:"music",target:q,volume:t,percent:$.musicVolume})}},{key:"updateMusicVolume",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])X({channel:"music",target:q,volume:t,percent:$.musicVolume});else{if($.musicVolume=t,!1!==e.externalProhibitVolume)return;X({channel:"music",target:q,volume:q.volume,percent:$.musicVolume})}}},{key:"tweenToWithMusic",value:function(e){var t=e.volume,n=void 0===t?1:t,r=e.duration,a=void 0===r?10:r,o=e.delay;return te({volume:n,channel:"music",target:q,duration:a,delay:void 0===o?0:o,percent:$.musicVolume})}},{key:"tweenFromWithMusic",value:function(e){var t=e.volume,n=void 0===t?1:t,r=e.duration,a=void 0===r?10:r,o=e.delay;return ne({volume:n,channel:"music",target:q,duration:a,delay:void 0===o?0:o,percent:$.musicVolume})}},{key:"playSound",value:function(e){var t=e.url,n=void 0===t?"":t,r=e.volume,a=void 0===r?1:r,o=e.channel,i=void 0===o?0:o,u=e.loop;"inherit"!==n?(G[i].url&&Z({channel:"sound".concat(i),target:G[i]}),Y({url:n,volume:a,percent:$.soundVolume,channel:"sound".concat(i),target:G[i],loop:u})):this.setSoundVolume({volume:a,channel:i})}},{key:"stopSound",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;G[e]&&Z({channel:"sound".concat(e),target:G[e]})}},{key:"stopAllSound",value:function(){for(var e=0;e<G.length;e++)Z({channel:"sound".concat(e),target:G[e]})}},{key:"setSoundVolume",value:function(t){var n=t.volume,r=void 0===n?1:n,a=t.channel,o=void 0===a?0:a;e.externalProhibitVolume||X({channel:"sound".concat(o),target:G[o],volume:r,percent:$.soundVolume})}},{key:"updateSoundsVolume",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])G.forEach(function(e,n){return e.url&&X({channel:"sound".concat(n),target:e,volume:t,percent:$.soundVolume})});else{if($.soundVolume=t,!1!==e.externalProhibitVolume)return;G.forEach(function(e,t){return e.url&&X({channel:"sound".concat(t),target:e,volume:e.volume,percent:$.soundVolume})})}}},{key:"tweenToWithSound",value:function(t){var n=t.volume,r=void 0===n?1:n,a=t.duration,o=void 0===a?10:a,i=t.delay,u=void 0===i?0:i,c=t.channel,s=void 0===c?0:c;if(!e.externalProhibitVolume)return te({volume:r,channel:"sound".concat(s),target:G[s],duration:o,delay:u,percent:$.soundVolume})}},{key:"tweenFromWithSound",value:function(t){var n=t.volume,r=void 0===n?1:n,a=t.duration,o=void 0===a?10:a,i=t.delay,u=void 0===i?0:i,c=t.channel,s=void 0===c?0:c;if(!e.externalProhibitVolume)return ne({volume:r,channel:"sound".concat(s),target:G[s],duration:o,delay:u,percent:$.soundVolume})}},{key:"playButtonSound",value:function(){var e=J.audio,t=J.volume,n=$.buttonSoundUrl,r=$.soundVolume;e?e.play():n&&Y({url:n,channel:"button-sound",target:J,volume:t,percent:r})}},{key:"play",value:function(t){var n,r=t.url,a=t.volume,o=void 0===a?1:a,i=t.loop,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c={url:r,volume:o};~(n=Q.findIndex(function(e){return e.url===r&&e.volume===o}))?c=Q[n]:Q.push(c),Y({url:r,volume:e.externalProhibitVolume&&u?0:o,percent:$.soundVolume,channel:"temp-sound",target:c,loop:i})}},{key:"stop",value:function(e){var t,n=e.url,r=e.volume,a=void 0===r?1:r,o=null;~(t=Q.findIndex(function(e){return e.url===n&&e.volume===a}))&&(o=Q[t],Q.splice(t,1),Z({channel:"temp-sound",target:o}))}},{key:"free",value:function(e){ee(e);for(var t=0;Q.length>t;){var n=Q[t];n.url!==e?t++:(n.audio&&n.audio.destroy(),n.audio=null,Q.splice(t,1))}}},{key:"getUsingUrls",value:function(){var e=[];return q.url&&e.push(q.url),J.url&&e.push(J.url),G.forEach(function(t){var n=t.url;return n&&e.push(n)}),Q.forEach(function(t){var n=t.url;return n&&e.push(n)}),e}},{key:"music",get:function(){return{url:q.url,volume:q.volume}}},{key:"sounds",get:function(){return G.map(function(e,t){return{url:e.url,volume:e.volume,loop:e.loop,index:t}})}}]),e}(),ae=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=q.audio;t&&(e?t.play():t.pause()),G.forEach(function(t){var n=t.audio;n&&(e?n.resume():n.pause())})};function oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ie(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?oe(e):t}function ue(e){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ce(e,t,n){return(ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ue(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}U.setCallback("resumeAudio",function(){return ae(!0)}),U.setCallback("pauseAudio",function(){return ae()}),U.setCallback("audioCanPlay",function(e){return F.loadedCallBack(e)}),U.setCallback("audioError",function(e){return F.faultCallBack(e)}),re.externalProhibitVolume=!1;n(63),n(82),n(41),n(122);var de=function(){function e(){}return e.generate=function(){var t=e._getRandomInt,n=e._hexAligner;return n(t(32),8)+"-"+n(t(16),4)+"-"+n(16384|t(12),4)+"-"+n(32768|t(14),4)+"-"+n(t(48),12)},e._getRandomInt=function(e){if(e<0||e>53)return NaN;var t=0|1073741824*Math.random();return e>30?t+1073741824*(0|Math.random()*(1<<e-30)):t>>>30-e},e._hexAligner=function(e,t){for(var n=e.toString(16),r=t-n.length,a="0";r>0;r>>>=1,a+=a)1&r&&(n=a+n);return n},e.generate}(),he=function(e,t,n,r){e&&!r[e]&&(n.push({url:e,type:t}),r[e]=t)},fe=[{uuid:de(),key:"coinTotal",init:{type:"system",value:0}},{uuid:de(),key:"starTotal",init:{type:"system",value:0}},{uuid:de(),key:"timestamp",init:{type:"system",value:-1}},{uuid:de(),key:"year",init:{type:"system",value:-1}},{uuid:de(),key:"month",init:{type:"system",value:-1}},{uuid:de(),key:"day",init:{type:"system",value:-1}},{uuid:de(),key:"hour",init:{type:"system",value:-1}},{uuid:de(),key:"minute",init:{type:"system",value:-1}},{uuid:de(),key:"second",init:{type:"system",value:-1}},{uuid:de(),key:"contribution",init:{type:"system",value:0}},{uuid:de(),key:"week",init:{type:"system",value:-1}}],pe=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"getAssets",value:function(e){var t={},n=[],r=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return he(e,r,n,t)},a=e.cover||{},o=a.music,i=a.background;return o&&r(o.url,"audio"),i&&r(i.url),n}},{key:"getViewAssets",value:function(e){var t={},n=[],r=e.motionImgMap,a=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";if(u.c.isObject(e)){if(!r||!e.uuid||!r[e.uuid])return;r[e.uuid].images.forEach(function(e){var r=e.url;return he(r,a,n,t)})}else e&&u.c.isString(e)&&"inherit"!==e&&he(e,a,n,t)},o=e.viewMap,i=e.views,c=function(e){Array.isArray(e)&&e.forEach(function(e){return e.events.forEach(function(e){if(e){var t=e.type,n=e.handle;"playMusic"===t&&n.music?a(n.music.url,"audio"):"playSound"===t&&n.sounds&&n.sounds.forEach(function(e){return e&&"inherit"!=e.url&&a(e.url,"audio")})}})})},s=function(e){var t=e.type,n=e.events,r=e.content,o=void 0===r?{}:r,i=e.children,u=void 0===i?[]:i;if(c(n),u.forEach(function(e){var t=e.events;return c(t)}),"timer"!==t){var s=o.background,l=o.sound;s&&(a(s.url),s.normal&&a(s.normal.url),s.active&&a(s.active.url),s.progress&&a(s.progress.url),l&&a(l.url,"audio"))}};return Object.keys(o).forEach(function(e){return s(o[e])}),i.forEach(function(e){return s(e)}),n}},{key:"getFirstChapter",value:function(e){return function e(t){for(var n=t.length,r=0;r<n;r++){var a=t[r],o=a.plots,i=void 0===o?[]:o,u=a.md5;if(i.length||u)return a;if(a.subchapters.length){var c=e(a.subchapters);if(c)return c}}}(e.chapters)}},{key:"getChapterByUUID",value:function(t,n){var r={};return t.chapters.forEach(function e(t){r[t.uuid]=t,(t.subchapters||[]).forEach(e)}),e.getChapterByUUID=function(e,t){return r[t]},e.getChapterByUUID(t,n)}},{key:"fix",value:function(e){return e.systemValues=e.systemValues||[],e.systemValues=fe.map(function(t,n){return e.systemValues[n]?Object.assign({},t,e.systemValues[n]):t}),e.indexValues=e.indexValues||[],e}},{key:"getJumpAndInsertChapterUuids",value:function(e){var t={},n=function e(n){for(var r=0,a=n.length;r<a;r++){var o=n[r],i=o.type,u=o.args;if("insert"===i||"jump"===i)t[u[0]]=i;else if("options"===i||"conditionOptions"===i)for(var c=0,s=u.length;c<s;c++)e(u[c].commands)}};return function e(r){for(var a=0,o=r.length;a<o;a++){var i=r[a],u=i.jump,c=i.insert,s=i.commands,l=i.options,d=void 0===l?[]:l,h=i.condition_options,f=void 0===h?[]:h;if(s)n(s);else{u&&(t[u]="jump"),c&&(t[c]="insert");for(var p=0,v=d.length;p<v;p++)e(d[p].plots);for(var m=0,g=f.length;m<g;m++)e(f[m].plots)}}}(e.plots),Object.keys(t)}}]),e}(),ve=n(9),me=n.n(ve),ge=n(123),ye=n.n(ge),we=n(7),be=(n(80),function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"strip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return+parseFloat(e.toPrecision(t))}},{key:"digitLength",value:function(e){var t=e.toString().split(/[eE]/),n=(t[0].split(".")[1]||"").length-+(t[1]||0);return n>0?n:0}},{key:"float2Fixed",value:function(t){if(-1===t.toString().indexOf("e"))return Number(t.toString().replace(".",""));var n=e.digitLength(t);return n>0?e.strip(t*Math.pow(10,n)):t}},{key:"limitRange",value:function(e){return e>99999999999999?99999999999999:e<-99999999999999?-99999999999999:e}},{key:"mul",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];if(a.length>0)return mul.apply(void 0,[mul(t,n),a[0]].concat(Object(b.a)(a.slice(1))));var i=e.float2Fixed(t),u=e.float2Fixed(n),c=e.digitLength(t)+e.digitLength(n),s=i*u/Math.pow(10,c);return e.limitRange(s)})},{key:"add",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];if(a.length>0)return add.apply(void 0,[add(t,n),a[0]].concat(Object(b.a)(a.slice(1))));var i=Math.pow(10,Math.max(e.digitLength(t),e.digitLength(n))),u=(e.mul(t,i)+e.mul(n,i))/i;return e.limitRange(u)})},{key:"sub",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];if(a.length>0)return sub.apply(void 0,[sub(t,n),a[0]].concat(Object(b.a)(a.slice(1))));var i=Math.pow(10,Math.max(e.digitLength(t),e.digitLength(n))),u=(e.mul(t,i)-e.mul(n,i))/i;return e.limitRange(u)})},{key:"div",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];if(a.length>0)return div.apply(void 0,[div(t,n),a[0]].concat(Object(b.a)(a.slice(1))));var i=e.float2Fixed(t),u=e.float2Fixed(n),c=e.mul(i/u,Math.pow(10,e.digitLength(n)-e.digitLength(t)));return e.limitRange(c)})},{key:"mod",value:function(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=e.float2Fixed(r),i=e.float2Fixed(a);t=e.digitLength(r),n=e.digitLength(a);var u=Math.pow(10,Math.abs(t-n));return t>n&&(i*=u),t<n&&(o*=u),o%i/Math.pow(10,Math.max(t,n))}},{key:"round",value:function(t,n){var r=Math.pow(10,n);return e.div(Math.round(e.mul(t,r)),r)}},{key:"toFixed",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=0,a=e.float2Fixed(t);r=e.digitLength(t);var o=a.toString();return r>n&&n>=0&&(o=o.slice(0,n-r),r=n,o=""===o||"-"===o?"0":o),parseInt(o)/Math.pow(10,r)}}]),e}()),_e=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"safeEval",value:function(t,n){function r(t,n){var r=n.find(function(e){return e.uuid===t.arg1})||{value:0};return void 0!==r.value?u.b.toN(r.value):e.safeInitValue(r)}try{return function t(n,a){var o,i,c;switch(n.type){case"arg1":return t(n.arg1,a);case"+":return o=t(n.arg1,a),i=t(n.arg2,a),u.b.is(o)&&u.b.is(i)?be.toFixed(be.add(o,i)):("#"+o+i).slice(1);case"-":return o=t(n.arg1,a),i=t(n.arg2,a),u.b.is(o)&&u.b.is(i)?be.toFixed(be.sub(o,i)):(o+"").split(i+"").join("");case"*":return be.toFixed(be.mul(t(n.arg1,a),t(n.arg2,a)));case"/":return 0===i?(I.a.error("求余除数不能为 0"),0):be.toFixed(be.div(t(n.arg1,a),t(n.arg2,a)));case"%":return o=parseInt(t(n.arg1,a)),0===(i=parseInt(t(n.arg2,a)))?(I.a.error("求余除数不能为 0"),0):be.toFixed(be.mod(o,i));case"==":return t(n.arg1,a)===t(n.arg2,a);case"!=":return t(n.arg1,a)!==t(n.arg2,a);case">":return t(n.arg1,a)>t(n.arg2,a);case"<":return t(n.arg1,a)<t(n.arg2,a);case">=":return t(n.arg1,a)>=t(n.arg2,a);case"<=":return t(n.arg1,a)<=t(n.arg2,a);case"min":return Math.min.apply(null,n.args.map(function(e){return t(e,a)}));case"max":return Math.max.apply(null,n.args.map(function(e){return t(e,a)}));case"all":return n.args.map(function(e){return t(e,a)}).every(function(e){return e});case"any":return n.args.map(function(e){return t(e,a)}).some(function(e){return e});case"literal":return u.b.toN(n.value);case"int":return u.b.toInt(t(n.arg1,a));case"random":var s=u.c.isObject(n.range[0])?t(n.range[0],a):u.b.toInt(n.range[0]),l=u.c.isObject(n.range[1])?t(n.range[1],a):u.b.toInt(n.range[1]);return s=Math.min(s,l),l=Math.max(s,l),parseInt(Math.random()*(l-s+1)+s);case"value":case"payValue":case"savedValue":case"indexValue":case"systemValue":return r(n,a["".concat(n.type,"s")]);case"reference":var d=(void 0!==(c=a.indexValues.find(function(e){return e.uuid===n.arg1})).value?u.b.toN(c.value):e.safeInitValue(c))-1,h=c.init.type+"s";return void 0===a[h][d]?(I.a.info("出现未知数值操作，请联系作者检查修改"),"[未知数值]"):"stringValues"===h?void 0!==a[h][d].value?a[h][d].value+"":e.safeInitValue(a[h][d]):be.toFixed(r({arg1:a[h][d].uuid},a[h]),2);case"string":return n.value+"";case"stringValue":return void 0!==(c=a.stringValues.find(function(e){return e.uuid===n.arg1})).value?c.value+"":e.safeInitValue(c);case"contain":return o=t(n.arg1,a),i=t(n.arg2,a),(o+"").indexOf(i+"")>-1;case"stringLength":return(o=t(n.arg1,a))?o.length:0;default:throw new Error("expr type  is  error")}}(t,n)}catch(e){return console.error(e),NaN}}},{key:"safeInitValue",value:function(e){try{return function(e){if(e.init||console.log(1),"const"===e.init.type)return e.init.value;if("system"===e.init.type)return function(e){var t,n=new Date(1e3*u.a.getDate()+Date.now()%1e3);switch(e.key){case"coinTotal":case"starTotal":return u.b.toInt(e.init.value);case"timestamp":return null!==n?u.b.toInt(n.getTime()/1e3):e.init.value;case"year":return null!==n?n.getFullYear():e.init.value;case"month":return null!==n?n.getMonth()+1:e.init.value;case"day":return null!==n?n.getDate():e.init.value;case"hour":return null!==n?n.getHours():e.init.value;case"minute":return null!==n?n.getMinutes():e.init.value;case"second":return null!==n?n.getSeconds():e.init.value;case"week":return null!==n?0===(t=n.getDay())?7:t:e.init.value;case"contribution":default:return e.init.value}}(e);if("random"===e.init.type){var t=Number(e.init.range[0]),n=Number(e.init.range[1]);return parseInt(Math.random()*(n-t+1)+t)}return"string"===e.init.type?e.init.value+"":["value","savedValue","stringValue","payValue"].includes(e.init.type)?e.init.value:(console.error("unknown init type"),0)}(e)}catch(e){return console.error(e),0}}},{key:"parseValue",value:function(t,n){var r=/([\s\S]*)&(s|v|sv|p|x|i|iv)\[(\d+)\]([\s\S]*)/,a=function(t){return void 0===t.value?e.safeInitValue(t):t.value},o=function(e){for(var t=r.exec(e),o=e;t;){var i=t[2],u=parseInt(t[3]),c="[未知数值]";if("s"===i&&n.savedValues[u])c=be.toFixed(a(n.savedValues[u]));else if("v"===i&&n.values[u])c=be.toFixed(a(n.values[u]));else if("sv"===i&&n.stringValues[u])c=a(n.stringValues[u])+"";else if("p"===i&&n.payValues[u])c=be.toFixed(a(n.payValues[u]));else if("x"===i&&n.systemValues[u])c=be.toFixed(a(n.systemValues[u]));else if("i"===i&&n.indexValues[u])c=a(n.indexValues[u]);else if("iv"===i&&n.indexValues[u]){var s=a(n.indexValues[u]),l=n.indexValues[u].init.type,d=n[l+"s"][s-1];void 0!==d&&(c="stringValue"!==l?be.toFixed(a(d)):a(d))}o=t[1]+c+t[4],t=r.exec(o)}return o};return Array.isArray(t)?P()(t,{$apply:function(e){return e.map(function(e){return P()(e,{data:{$set:o(e.data)}})})}}):o(t)}},{key:"parseWaitTime",value:function(e){for(var t=/([\s\S]*)\\(\d+)\s([\s\S]*)/,n=t.exec(e);n;)e=n[1]+n[3],n=t.exec(e);return e}},{key:"setContextByValueHandles",value:function(t,n){return n.forEach(function(n){var r,a=e.safeEval(n.expression,t),o=n.uuid,i=n.reference;if(-1!==(r=t.values.findIndex(function(e){return e.uuid===o})))t=P()(t,{values:x({},r,{value:{$set:a}})});else if(-1!==(r=t.savedValues.findIndex(function(e){return e.uuid===o})))t=P()(t,{savedValues:x({},r,{value:{$set:a}})});else if(-1!==(r=t.payValues.findIndex(function(e){return e.uuid===o})))t=P()(t,{payValues:x({},r,{value:{$set:a}})});else if(-1!==(r=t.stringValues.findIndex(function(e){return e.uuid===o}))){var c=u.b.is(a)?be.toFixed(a):a;t=P()(t,{stringValues:x({},r,{value:{$set:c}})})}else if(-1!==(r=t.indexValues.findIndex(function(e){return e.uuid===o}))){var s=t.indexValues[r].init.type+"s",l=(i?t.indexValues[r].value:a)-1,d=!1;void 0===t[s][l]&&(d=!0,I.a.info("出现未知数值操作，请联系作者检查修改")),i?!d&&(t=P()(t,x({},s,x({},l,{value:{$set:a}})))):t=P()(t,{indexValues:x({},r,{value:{$set:a}})})}else console.error("Cannot find value/savedValue with uuid = ",o)}),t}}]),e}(),xe=/([\s\S]*)\\(\d+)\s([\s\S]*)/,ke=function e(t,n,r){var a=n.viewMap;return t.map(function(t){return function(t){var o=t.ref,i=t.instanceUuid,c=t.scale,s=t.x,l=t.y,d=t.children,h=t.values,f=void 0===h?{}:h,p=t.currentCount,v=a[o];if(!v)return null;var m=v,g=m.content,y=m.type;(d=e(d,n,r)).forEach(function(e){var t=v.children.findIndex(function(t){return t.instanceUuid===e.instanceUuid});~t&&(e.events=v.children[t].events)});var w=function(e){var t=e.type,n=e.arg1,a=e.value;return"literal"!==t?void 0!==f[n]?f[n]:_e.safeEval({type:t,arg1:n},r):a},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u.c.isObject(e)?void 0===e.value?P()(s,{value:{$set:w(e)}}):e:{type:"literal",value:e}};if("text"===y){var _=g,k=_.value,C=_.color;Array.isArray(k)||(k=u.c.toArrayForData(k).map(function(e){return S({},e,{color:C})}));for(var O=0;O<k.length;O++){var E=k[O],I=E.data;E.placeholder&&!xe.test(I)&&(k=P()(k,x({},O,{data:{$set:void 0!==f[I]?f[I]:_e.parseValue(I,r)}})))}g=P()(g,{value:{$set:k}})}else if("bar"===y){var M=g.value,A=M.normal,V=M.progress;g=P()(g,{value:{normal:{width:{value:{$set:w(A.width)}},height:{value:{$set:w(A.height)}}},progress:{width:{value:{$set:w(V.width)}},height:{value:{$set:w(V.height)}}}}})}else"input"===y&&(g=P()(g,{value:{value:{$set:w(g.value)}}}));return v=P()(v,{content:{$set:g},children:{$set:d}}),s=b(s),l=b(l),{ref:o,instanceUuid:i||"lv_".concat(de()),scale:c,x:s,y:l,calledViews:[],events:[],view:v,currentCount:p}}(t)}).filter(function(e){return e})},Pe=function e(t,n){return t.map(function(t){var r=t.ref,a=t.instanceUuid,o=t.scale,i=t.x,c=t.y,s=t.view,l=t.calledViews,d=t.currentCount,h=n.viewMap[r].content,f=h.value,p=h.color,v=s.children,m=s.type,g=s.content,y=g.value,w={},_=function(e){return"literal"!==e.type?w[e.arg1]=e.value:void 0};if(_(i),_(c),"text"===m){Array.isArray(f)||(f=u.c.toArrayForData(f).map(function(e){return S({},e,{color:p})}));for(var x=0;x<f.length;x++){var k=f[x],P=k.data;k.placeholder&&!xe.test(P)&&(w[P]=y[x].data)}}else if("bar"===s.type){var C=g.value,O=C.normal,E=C.progress;_(O.width),_(O.height),_(E.width),_(E.height)}else"input"===s.type&&_(g.value);return{ref:r,instanceUuid:a,scale:o,x:i,y:c,children:v=e([].concat(Object(b.a)(v),Object(b.a)(l)),n),values:w,currentCount:d}})},Ce=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"totransDatabyBubble",value:function(e){var t=[];return e.forEach(function(e){var n=e.bubble,r={bubble:[],currentCount:e.currentCount,index:e.index,show:e.show,uuid:e.uuid,remove:e.remove,rect:e.rect,scale:e.scale};n&&n.forEach(function(e){var t=e.avatar,n=e.content,a=e.role,o=e.type,i=e.position,u=[];if("image"==o)u=[n.url,n.view,n.viewMode];else if("text"==o){var c="center"==i?"#dadada":"right"==i?"#98e165":"#ffffff";u=[n.data,n.background?n.background:{color:c},n.font_size]}r.bubble.push([o,i,[t.rect.x,t.rect.y,t.rect.width,t.rect.height,t.url,t.hidden||!1],[a.rect.x,a.rect.y,a.rect.width,a.rect.height,a.data,a.font_size,a.color,a.hidden||!1],[n.rect.x,n.rect.y,n.rect.width,n.rect.height,n.opacity||1].concat(u)])}),t.push(r)}),t}},{key:"recoveryDatabyBubble",value:function(e){var t=[];return e.length>0&&void 0!==e.find(function(e){return e.bubble.find(function(e){return void 0!==e.type})})?e:(e&&e.forEach(function(e){var n=e.bubble,r={bubble:[],currentCount:e.currentCount,index:e.index,show:e.show,uuid:e.uuid,remove:e.remove,rect:e.rect,scale:e.scale};n&&n.forEach(function(e){var t={};t.type=e[0],t.position=e[1],t.avatar={rect:{x:e[2][0],y:e[2][1],width:e[2][2],height:e[2][3]},url:e[2][4],hidden:e[2][5]||!1},t.role={rect:{x:e[3][0],y:e[3][1],width:e[3][2],height:e[3][3]},data:e[3][4],font_size:e[3][5],color:e[3][6],hidden:e[3][7]||!1},t.content={rect:{x:e[4][0],y:e[4][1],width:e[4][2],height:e[4][3]},opacity:e[4][4]||1},"image"==e[0]?(t.content.url=e[4][5],t.content.view=e[4][6],t.content.viewMode=e[4][7]):"text"==e[0]&&(t.content.data=e[4][5],t.content.background=e[4][6],t.content.font_size=e[4][7]),r.bubble.push(t)}),t.push(r)}),t)}},{key:"getChapterUuids",value:function(e){var t=[],n=e.historyCommand,r=e.context,a=e.chapterUuid,o=e.inserts;return t.push(a),n?o.forEach(function(e){var n=e.chapterUuid;return t.push(n)}):r?(r.stack||[]).forEach(function(e){return"insert"===e.type&&t.push(e.chapterUuid)}):o.forEach(function(e){var n=e.chapterUuid;return t.push(n)}),t}},{key:"to",value:function(t){var n=t.context,r=t.playContext,a=t.viewContext,o=t.plotSnap,i=t.background,u=t.game,c=t.commandState,s=r.playback,l=r.values,d=r.savedValues,h=r.stringValues,f=r.indexValues,p=r.stack,v=n.commands,m=n.plots,g=n.plotIndex,y=n.chapter,w=n.cmdIndex,_=function(e){var t=e.uuid,n=e.value;return{uuid:t,value:void 0===n?_e.safeInitValue(e):n}},x=[],k={},P=function(t){var n=function(e){return e?e.uuid?e.uuid:e:void 0},r=t.images,a=t.dialog,o=t.weather,i=t.autotext,c=t.disableSaveOrLoad,s=t.animateScene,l=t.views,d=t.hideGlobalViews,h=t.plotViews,f=t.calledViews,p=t.bubbleMode,v=void 0===p?[]:p,m=t.bubbleCount,g=void 0===m?[]:m;return{images:r.map(function(e,t){if(e){var r=e.command,a=e.animate;return{commandUuid:n(r),animateUuid:n(a)}}}).filter(function(e){return e}),dialog:{commandUuid:n(a.command),animateUuid:n(a.animate)},weather:n(o),autotext:n(i),disableSaveOrLoad:n(c),animateScene:{shake:n(s)},views:l.map(function(e){return{commandUuid:e.uuid,instanceUuid:e.args[0].instanceUuid}}),hideGlobalViews:d||[],viewsData:Pe([].concat(Object(b.a)(h),Object(b.a)(f)),u),bubbleMode:e.totransDatabyBubble(v).concat(),bubbleCount:g.concat()}},C=function(){var t=r.bubbleMode,n=r.bubbleCount;return{bubbleMode:e.totransDatabyBubble(t).concat(),bubbleCount:n.concat()}};!function e(t){for(var n=t.length-1;n>=0;n--){var r=t[n],a=r.commands,o=r.plots,i=r.plotIndex,u=r.chapter,c=r.cmdIndex,s=r.type,l=r.loop,d=r.commandState;if(l){var h=l.breakNext,f=h.commands,p=h.plots,v=h.plotIndex,m=h.cmdIndex,g=l.count,y=f?f[m-1].uuid:p[v-1].uuid;k["cl_".concat(y)]={value:g}}else if("insertPlot"===s){var w={chapterUuid:u.uuid,plotUuid:o[i].uuid};a?(w.commandUuid=a[c-1].uuid,w.historyCommand=P(d),e(d.playStack)):w.historyCommand=C(),x.push(w)}}}(p);var O=s.length;return{inserts:x,countLoop:k,chapterUuid:y.uuid,plotUuid:m[g].uuid,commandUuid:v&&v[w]?v[w].uuid:void 0,speakings:Object(b.a)(s.slice(O-100,O)),thumb:o,values:{values:l.map(_),savedValues:d.map(_),stringValues:h.map(_),indexValues:f.map(_)},viewsData:Pe([].concat(Object(b.a)(a.plotViews),Object(b.a)(a.calledViews)),u),globalViewsData:Pe([].concat(Object(b.a)(a.globalViews),Object(b.a)(a.globalCalledViews)),u),historyCommand:c?P(c):C(),musics:[re.music],sounds:re.sounds.map(function(e,t){return e&&e.url?S({},e,{index:t}):null}).filter(function(e){return e}),backgroundObject:S({},i),timestamp:Date.now(),type:"h5"}}},{key:"restore",value:function(t,n,r){for(var o,i=t.countLoop,c=t.inserts,s=[],l=[],d=[],h=function e(t){for(var n=t.chapter,r=t.plots,a=t.plotIndex,o=t.commands,u=t.plotUuid,c=t.commandUuid,s=t.commandMap,l=t.playStack,d=0,h=o.length;d<h;d++){var f=o[d],p=f.type,v=f.uuid,m=f.args;if(v===c)return l.unshift({chapter:n,plots:r,plotIndex:a,commands:o,cmdIndex:d}),!0;if(null===s[v]&&(s[v]=o[d]),"options"===p)for(var g=0,y=m.length;g<y;g++){var w=m[g];if(w.commands.length){if(l.unshift({chapter:n,plots:r,plotIndex:a,commands:o,cmdIndex:d+1,type:"option"}),e({chapter:n,plots:r,plotIndex:a,plotUuid:u,commands:w.commands,commandUuid:c,commandMap:s,playStack:l}))return!0;l.shift()}}else if("conditionOptions"===p)for(var b=0,_=m.length;b<_;b++){var x=m[b];if(x.commands.length){var k={chapter:n,plots:r,plotIndex:a,commands:o,cmdIndex:d+1};if("loop"===x.type||"countLoop"===x.type){var P={count:i["cl_".concat(v)]?i["cl_".concat(v)].value:1,countExpr:x.count,condition:x.expression,breakNext:k};k={chapter:n,plots:r,plotIndex:a,commands:x.commands,cmdIndex:0,loop:P}}if(l.unshift(S({},k,{type:"condition_option"})),e({chapter:n,plots:r,plotIndex:a,plotUuid:u,commands:x.commands,commandUuid:c,commandMap:s,playStack:l}))return!0;l.shift()}}}},f=function(e,t){var n=t.findIndex(function(t){return t.instanceUuid===e.instanceUuid});~n&&(e.events=t[n].events)},p=function(e,t){return e.filter(function(e){if(!e.instanceUuid)return!0;var n=e.instanceUuid.indexOf("lv_");return~n||-1===n&&t[e.instanceUuid]})},v=[].concat(Object(b.a)(c),[t]),m=function(a){var c=v[a],m={},g=c.chapterUuid,y=c.plotUuid,w=c.commandUuid,b=c.historyCommand,_=void 0===b?{}:b,x=_.images,k=void 0===x?[]:x,P=_.dialog,C=void 0===P?{}:P,O=_.views,E=void 0===O?[]:O,M=_.weather,A=_.autotext,V=_.disableSaveOrLoad,T=_.animateScene,j=void 0===T?{}:T,U=_.viewsData,R=void 0===U?[]:U,D=_.hideGlobalViews,L=void 0===D?[]:D,B=_.bubbleMode,F=void 0===B?[]:B,W=_.bubbleCount,N=void 0===W?[]:W;k.forEach(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.commandUuid,n=e.animateUuid;return m[t]=m[n]=null}),E.forEach(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).commandUuid;return m[e]=null});var $=C||{},z=$.commandUuid,H=$.animateUuid;z&&(m[z]=null),H&&(m[H]=null);var q=j.shake;q&&(m[q]=null),[M,A,V].forEach(function(e){return e&&(m[e]=null)});var G=pe.getChapterByUUID(n,g);if(!G)return{v:void 0};if(!function e(t){for(var n=t.chapter,r=t.plots,a=t.plotUuid,o=t.commandUuid,u=t.commandMap,c=0,l=r.length;c<l;c++){var d=r[c];if(d.uuid===a){if(d.commands&&o){var f=[],p=h({chapter:n,plots:r,plotIndex:c,commands:d.commands,plotUuid:a,commandUuid:o,commandMap:u,playStack:f});if(p){var v=f.shift();v.commandState={playStack:f},s.unshift(v)}return p}return s.unshift({chapter:n,plots:r,plotIndex:c}),!0}if(d.options&&d.options.length)for(var m=d.options,g=0,y=m.length;g<y;g++)if(m[g].plots.length){if(s.unshift({chapter:n,plots:r,plotIndex:c+1,type:"option"}),e({chapter:n,plots:m[g].plots,plotUuid:a,commandUuid:o,commandMap:u}))return!0;s.shift()}if(d.condition_options&&d.condition_options.length)for(var w=d.condition_options,b=d.uuid,_=0,x=w.length;_<x;_++){var k=w[_];if(k.plots.length){var P={chapter:n,plots:r,plotIndex:c+1};if("loop"===k.type||"countLoop"===k.type){var C={count:i["cl_".concat(b)]?i["cl_".concat(b)].value:1,countExpr:k.count,condition:k.expression,breakNext:P};P={chapter:n,plots:k.plots,plotIndex:0,loop:C}}if(s.unshift(S({},P,{type:"condition_option"})),e({chapter:n,plots:w[_].plots,plotUuid:a,commandUuid:o,commandMap:u}))return!0;s.shift()}}}return!1}({chapter:G,plots:G.plots,plotUuid:y,commandUuid:w,commandMap:m}))return I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),{v:{stack:s,plotViews:l,globalViews:d,context:o}};if(w){var K=s[0].commandState,J=function(e){return u.c.isObject(e)?e:e&&m[e]?m[e]:null},Q=[];k.forEach(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.commandUuid,n=e.animateUuid,r=e.command;r=r||J(t);var a=J(n);r&&(Q[r.args[0].index]={command:r,animate:a})}),K.images=Q;var Y={};K.views=E.map(function(e){var t=e.commandUuid,n=e.instanceUuid,r=J(t);return n&&(Y[n]=!0),r||null}).filter(function(e){return e}),R=p(R,Y),K.dialog={command:C&&C.command||J(z),animate:J(H)},K.animateScene=J(q),K.weather=J(M),K.autotext=J(A),K.disableSaveOrLoad=J(V),K.hideGlobalViews=L,K.calledViews=[],K.plotViews=ke(R,n,r),K.bubbleMode=e.recoveryDatabyBubble(F).concat(),K.bubbleCount=N.concat();var Z=K.views.map(function(e){return e.args[0]});K.plotViews.forEach(function(e){return f(e,Z)})}if(c!==t)return s[0].type="insertPlot",s[0].cmdIndex++,"continue";o=s.shift(),l=ke(c.viewsData,n,r);var X={};if(w){var ee=o.commandState;E=ee.views,L=ee.hideGlobalViews,E=E.map(function(e){return e.args[0]})}else{var te=o,ne=te.plots[te.plotIndex],re=ne.views;E=void 0===re?[]:re;var ae=ne.hideGlobalViews;L=void 0===ae?[]:ae}E.forEach(function(e){return X[e.instanceUuid]=!0}),(l=p(l,X)).forEach(function(e){return f(e,E)}),w&&(o.commandState.plotViews=l),!w&&(o.bubbleMode=e.recoveryDatabyBubble(F).concat(),o.bubbleCount=N.concat());var oe={};n.views.forEach(function(e){return oe[e.instanceUuid]=!0}),(d=ke(p(c.globalViewsData,oe),n,r)).forEach(function(e){f(e,n.views),~L.findIndex(function(t){return t===e.instanceUuid})&&(e.visible=!1)})},g=0;g<v.length;g++){var y=m(g);switch(y){case"continue":continue;default:if("object"===a(y))return y.v}}return{stack:s,plotViews:l,globalViews:d,context:o}}},{key:"format",value:function(e,t){var n=function e(t){for(var n=t.commands,r=t.commandUuid,a=t.playStack,o=t.plots,i=t.plotIndex,u=0,c=n.length;u<c;u++){var s=n[u],l=s.type,d=s.uuid,h=s.args;if(d===r)return!0;if("options"===l)for(var f=0,p=h.length;f<p;f++){var v=h[f];if(v.commands.length){if(a.unshift({commands:n,cmdIndex:u+1,plots:o,plotIndex:i}),e({commands:v.commands,commandUuid:r,playStack:a,plots:o,plotIndex:i}))return!0;a.shift()}}else if("conditionOptions"===l)for(var m=0,g=h.length;m<g;m++){var y=h[m];if(y.commands.length){var w={commands:n,cmdIndex:u+1,plots:o,plotIndex:i};if("loop"!==y.type&&"countLoop"!==y.type||(w={commands:y.commands,cmdIndex:0,loop:{breakNext:w},type:"condition_option"}),a.unshift(w),e({commands:y.commands,commandUuid:r,playStack:a,plots:o,plotIndex:i}))return!0;a.shift()}}}},r=function e(t){for(var r=t.plots,a=t.plotUuid,o=t.commandUuid,i=t.playStack,u=0,c=r.length;u<c;u++){var s=r[u];if(s.uuid===a)return o&&s.commands&&n({commands:s.commands,commandUuid:o,playStack:i,plots:r,plotIndex:u}),!0;if(s.options&&s.options.length)for(var l=s.options,d=0,h=l.length;d<h;d++){if(l[d].plots.length){if(i.unshift({plots:r,plotIndex:u+1}),e({plots:l[d].plots,plotUuid:a,commandUuid:o,playStack:i}))return!0;i.shift()}}if(s.condition_options&&s.condition_options.length)for(var f=s.condition_options,p=0,v=f.length;p<v;p++){var m=f[p];if(m.plots.length){var g={plots:r,plotIndex:u+1};if("loop"!==m.type&&"countLoop"!==m.type||(g={plots:m.plots,plotIndex:0,loop:{breakNext:g},type:"condition_option"}),i.unshift(g),e({plots:f[p].plots,plotUuid:a,commandUuid:o,playStack:i}))return!0;i.shift()}}}return!1};return!e||e.historyCommand?e:e.context?function(e){var n=function(e,t){var n=[],r=[];return{viewsData:e.map(function e(a){var o=a.name,i=a.x,u=(a.y,a.scale),c=a.instanceUuid,s=a.currentCount,l=a.generateType,d=a.children,h=a.xInfo,f=a.yInfo,p=a.visible;if(l&&"plotInfo"!==l&&n.push({commandUuid:l,instanceUuid:c}),void 0!==p&&!p&&r.push(c),void 0===h.value){var v=_e.safeEval(h,t);h=P()(h,{value:{$set:isNaN(v)?i||0:v}})}if(void 0===f.value){var m=_e.safeEval(f,t);f=P()(f,{value:{$set:isNaN(m)?i||0:m}})}return{x:h,y:f,scale:u.x,ref:o,instanceUuid:c||"lv_".concat(de()),currentCount:s,children:d.map(e)}}),cmdViews:n}},a=function(e){var t=[];return e.forEach(function(e){var n=e.bubbleMode,r=e.bubble,a=e.curbubble,o=e.ishide,i=(e.iscurrent,!o),u=n.args,c=(n.type,n.uuid),s=u[0],l=s.index,d=s.rect,h=(s.url,s.remove),f=s.scale,p=void 0===f?1:f,v=a.length||0,m={bubble:r.map(function(e){return e.args?e.args[0]:e})||[],currentCount:v,index:l,show:i,uuid:c,remove:h,rect:d,scale:p};t.push(m)}),t},o=function(e){var t=e.bubble,n=void 0===t?[]:t,r=e.bubbleCount,o=void 0===r?[]:r,i=e.cmdUuid,u=e.bk,c=e.bkFlex,s=e.bCmdAutoText,l=e.weatherType,d=e.animateScene,h=e.dialogInfo,f=e.charsAndProps,p={bubbleMode:a(n).concat(),bubbleCount:o.concat(),viewsData:[]};if(i){var v=u?{args:[{index:1,url:u.url,opacity:u.opacity,flex:c}]}:void 0;p.autotext={args:[s]},p.weather={args:[l]},p.animateScene={shake:d&&d.shake&&d.shake.uuid||void 0},p.views=y,p.hideGlobalViews=w,p.dialog={command:h&&h.length?{args:[h[0]]}:void 0};var m=f.map(function(e){if(!e)return e;var t=e.x,n=e.width,r=e.y,a=e.height,o=e.mirrorH,i=e.mirrorV,u=e.index,c=e.opacity,s=e.rotate;return{command:{args:[{url:e.url,x:t-=(n=Math.abs(n))/2,width:n,y:r-=(a=Math.abs(a))/2,height:a,mirrorH:o,mirrorV:i,index:u,opacity:c,rotate:s}]}}});p.images=[void 0,{command:v}].concat(Object(b.a)(m))}return p},i=e.plotUuid,u=e.chapterUuid,c=e.cmdUuid,s=e.bkKey,l=e.bkOpacity,d=e.bkFlex,h=e.playbackData,f=e.plotSnap,p=e.context,v={plotUuid:i,chapterUuid:u,commandUuid:c,backgroundObject:{url:s,flex:d,opacity:l},speakings:h,thumb:f},m=n(e.plotViews,e.context),g=m.viewsData,y=m.cmdViews,w=m.hideViews,_=p.values,x=p.savedValues,k=p.stringValues,C=p.indexValues,O=p.stack,E=p.cmdStack,M=void 0===E?[]:E,A=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return void 0===e.value?P()(e,{value:{$set:_e.safeInitValue(e)}}):e})};v.viewsData=g;var V=n(e.globalViews,e.context);g=V.viewsData,w=V.hideViews,v.globalViewsData=g,v.musics=[e.music],v.sounds=e.sounds.map(function(e){return e?S({},e,{loop:0===e.time}):e}),v.values={values:A(_),savedValues:A(x),stringValues:A(k),indexValues:A(C)},v.historyCommand=o(e),v.inserts=[],v.countLoop={},M=Object(b.a)(M),O=Object(b.a)(O);var T=pe.getChapterByUUID(t,u);if(T){var j=[];if(r({plots:T.plots,plotUuid:i,commandUuid:c,playStack:j})){var U=function e(n){for(var a=n.pop();a;){var i=a,u=i.type,c=i.chapterUuid,s=i.pPlotUuid,l=i.loopCount,d=i.isCommand,h=i.cmdInfo,f=i.cmdIndex,p=i.cmdScreenSnap;if(i.loopCondition){var m=j[0];if(!m||"condition_option"!==m.type){j.shift(),a=n.pop();continue}var g=m.loop.breakNext,y=g.plots,w=g.plotIndex,b=g.commands,_=g.cmdIndex,x=b?b[_-1].uuid:y[w-1].uuid;v.countLoop["cl_".concat(x)]={value:l}}else if("insert"===u){if(n===M)break;var k=pe.getChapterByUUID(t,c);if(!k)return I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),void(v=null);j=[];var P=h&&h.commands[f]&&h.commands[f].uuid;if(!r({plots:k.plots,plotUuid:s,commandUuid:d?P:void 0,playStack:j}))return I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),void(v=null);var C={chapterUuid:c,plotUuid:s,historyCommand:{}};if(d){C.commandUuid=P;var S=Object.assign({},p);S.cmdUuid=P,S.lstDialogInfo=p.dialogInfo,S.animateScene=p.animateScene||{},C.historyCommand=o(S),e(M)}if(v.inserts.push(C),!(a=n.pop()))break;if("insert"===a.type){var O=a,E=O.chapterUuid,A=O.pPlotUuid,V=pe.getChapterByUUID(t,E);if(!V)return I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),void(v=null);if(j=[],!r({plots:V.plots,plotUuid:A,playStack:j}))return I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),void(v=null)}continue}j.shift(),a=n.pop()}};return U(O),v&&U(M),v}I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~")}else I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~")}(e):function(e){var n=e.thumb,a=e.plotUuid,o=e.chapterUuid,i=e.commandObj,u=e.backgroundObject,c=void 0===u?{}:u,s=e.values,l=void 0===s?[]:s,d=e.musics,h=void 0===d?[]:d,f=e.sounds,p=void 0===f?[]:f,v=e.speakings,m=void 0===v?[]:v,g=e.inserts,y=void 0===g?[]:g,w=e.commandInserts,_=void 0===w?[]:w,x=e.viewsData,k=void 0===x?[]:x,C=e.globalViewsData,S=void 0===C?[]:C,O=e.cmdStack,E=void 0===O?[]:O,M=e.stack,A=void 0===M?[]:M,V={},T={},j={plotUuid:a,chapterUuid:o,backgroundObject:c,speakings:m,thumb:n,values:l=function(e){var n=[],r=[],a=[],o=[],i=function(e,t,n){var r=n.length;return t.forEach(function(t){return t.uuid===e.key?n.push(P()(t,{value:{$set:e.value}})):void 0}),n.length>r},u=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return void 0===e.value?P()(e,{value:{$set:_e.safeInitValue(e)}}):e})};return e.forEach(function(e,u){(e.key||"").startsWith("cl_")&&(V[e.key]=e.value),i(e,t.values,n)||i(e,t.savedValues,r)||i(e,t.stringValues,a)||i(e,t.indexValues,o)}),{values:u(n),savedValues:u(r),stringValues:u(a),indexValues:u(o)}}(l),musics:h,inserts:y,viewsData:k,globalViewsData:S,historyCommand:T,countLoop:V};if(j.sounds=Array(10).fill(null),p.forEach(function(e,t){return e&&(j.sounds[null!=e.index?e.index:t]=e)}),i){j.commandUuid=i.commandUuid;var U=i.historyCommand,R=U.images,D=void 0===R?[]:R,L=U.dialog,B=U.autotext,F=U.weather,W=U.animateScene,N=U.views,$=void 0===N?[]:N,z=U.hideGlobalViews,H=void 0===z?[]:z,q=U.viewsData,G=void 0===q?[]:q,K=U.bubbleMode,J=void 0===K?[]:K,Q=U.bubbleCount,Y=void 0===Q?[]:Q;T.autotext=B&&B.uuid,T.weather=F&&F.uuid,T.animateScene={shake:W&&W.shake&&W.shake.uuid||void 0},T.views=$.map(function(e){return{instanceUuid:e[0],commandUuid:e[1]}}),T.hideGlobalViews=H,T.dialog={command:L&&L.command},T.viewsData=G,T.images=D.map(function(e){return{command:{args:[e]}}}),T.bubbleMode=function(e){var t=[];return e.length>0&&!e[0].args?e:(e.forEach(function(e){var n=e.args,r=(e.type,e.uuid),a=e.show,o=e.bubble,i=e.currentCount,u=n[0],c=u.index,s=u.rect,l=(u.url,u.remove),d=u.scale,h=void 0===d?1:d,f={bubble:o.map(function(e){return e.args?e.args[0]:e})||[],currentCount:i,index:c,show:a,uuid:r,remove:l,rect:s,scale:h};t.push(f)}),t)}(J).concat(),T.bubbleCount=Y.concat()}y=y?Object(b.a)(y):[],_=_?Object(b.a)(_):[],E=E?Object(b.a)(E):[],A=A?Object(b.a)(A):[];var Z=pe.getChapterByUUID(t,o);if(Z){var X=[];if(r({plots:Z.plots,plotUuid:a,commandUuid:i&&i.commandUuid,playStack:X}))return function(e){for(var n=e.pop();n;){var a=n,o=a.chapterUuid,i=a.plotUuid,u=!1,c=void 0,s=null,l=_.length-1;if(_[l]&&i===_[l].uuid){u=!0;var d=_.pop().data,h=void 0===d?{}:d;c=h.commandUuid,s=h.historyCommand}var f=pe.getChapterByUUID(t,o);if(!f)return void I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~");if(X=[],!r({plots:f.plots,plotUuid:i,commandUuid:c,playStack:X}))return void I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~");var p={chapterUuid:o,plotUuid:i,historyCommand:{}};if(u){p.commandUuid=c;var v=p.historyCommand,m=s,g=m.images,y=void 0===g?[]:g,w=m.dialog,b=m.autotext,x=m.weather,k=m.animateScene,P=m.views,C=void 0===P?[]:P,S=m.hideGlobalViews,O=void 0===S?[]:S,E=m.viewsData,M=void 0===E?[]:E;v.autotext=b&&b.uuid,v.weather=x&&x.uuid,v.animateScene={shake:k&&k.shake&&k.shake.uuid||void 0},v.views=C.map(function(e){return{instanceUuid:e[0],commandUuid:e[1]}}),v.hideGlobalViews=O,v.dialog={command:w&&w.command},v.images=y.map(function(e){return{command:{args:[e]}}}),v.viewsData=M}j.inserts.push(p),n=e.pop()}}(y),j;I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~")}else I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~")}(e)}}]),e}();Ce.cover_url="";var Se={game:"//mapi.3000api.com/apis/soft/v1.0/game-info.html",testGame:"//mapi.3000api.com/apis/soft/v1.0/game-test.html",otherGame:"//mapi.3000api.com/apis/soft/v1.0/game-external.html",serverTime:"//my.3000.com/?m=timestamp&op=index&ac=get&api_v=1.0.0&api_from=webpc",sensitiveWord:"//mapi.3000api.com/apis/soft/v1.0/game-GetSensitiveStr.html",statistics:"//app.3000.com/?m=statistics&op=start&ac=h5",appCheckPay:"//app.3000.com/?m=consume&op=index&ac=market_order_status",wapChackPay:"//pay.3000.com/?m=consume&op=h5_flash_request",userInfoFromWap:"//ptlogin.3000.com/?m=ptlogin&ac=cookieuid",userInfoFromPc:"//www.3000.com/apis/client/v1.0/user-login.html",appUserInfo:"//app.3000.com/?m=user&op=index&ac=my_account",wapUserInfo:"//pay.3000.com/?m=player&op=h5_get_account_info",appGetRecord:"//app.3000.com/?m=cloud_save&op=index&ac=info",wapGetRecord:"//my.3000.com/?m=cloud_save&op=index&ac=info&client_type=1&api_v=1.0.0&api_from=webpc",appSaveRecord:"//app.3000.com/?m=cloud_save&op=index&ac=save",wapSaveRecord:"//my.3000.com/?m=cloud_save&op=index&ac=save&client_type=1&api_v=1.0.0&api_from=webpc",checkUserAlpha:"//app.3000.com/?m=game_info&op=index&ac=alpha_status",getFansInfo:"//pay.3000.com/?m=payinterface&op=player_one_opus_fans",optionClick:"//www.3000.com/apis/client/v1.0/trace-optionClick.html",gameStarted:"//www.3000.com/apis/client/v1.0/trace-play.html",wapGetPlayValues:"//my.3000.com/?m=pay_value&op=index&ac=info&api_v=1.0.0&api_from=webpc",appGetPlayValues:"//app.3000.com/?m=pay_value&op=index&ac=info",getAuthorGameNotice:"//my.3000.com/index.php?m=message&op=authorNotice&ac=getAuthorGameNotice&api_v=1.0.0&api_from=webpc",showGameNotice:"//my.3000.com/?m=rim&op=notice&ac=notice&gid=",wapSavePlayValues:"//my.3000.com/?m=pay_value&op=index&ac=save&api_v=1.0.0&api_from=webpc",appSavePlayValues:"//app.3000.com/?m=pay_value&op=index&ac=save",wapGetGoodInfo:"//pay.3000.com/?m=player&op=h5_purchase_market_count",appGetGoodInfo:"https://app.3000.com/?m=consume&op=index&ac=h5_purchase_market_count",getChapter:"//mapi.3000api.com/apis/soft/v1.0/chapter-chapterInfo.html",getChapterDiscounts:"https://mapi.3000api.com/apis/soft/v1.0/game-getCharge.html",getFlashAdv:"//www.3000.com/apis/client/v1.0/client-flashAdv.html",sendPlayTime:"//my.3000.com/?m=user_info&op=index&ac=add_user_play_time&api_v=1.0.0&api_from=webpc",getAppUnlockRecord:"//app.3000.com/?m=cloud_save&op=index&ac=get_archive_record",getWapUnlockRecord:"//my.3000.com/?m=cloud_save&op=index&ac=getArchiveRecord&api_v=1.0.0&api_from=webpc",singleConfig:"./config.json",logError:"//mapi.3000api.com/upload/index-clientLog.html"};C.a.offline&&U.isAppClient()&&Object.keys(Se).forEach(function(e){return-1===Se[e].indexOf("https")&&(Se[e]="https:".concat(Se[e]))}),U.gameStartedApi=function(){var e=C.a.gid;Object(we.b)({url:Se.gameStarted,data:"id=".concat(e,"&from=wap")})};var Oe=function(e,t){return encodeURIComponent(u.c.aesEncrypt(e,t))},Ee=function(e,t){var n=JSON.parse(e.response);if("100"==n.code){if(!u.c.isObject(n.result)&&(n.result.indexOf("http")>-1||n.result.indexOf("https")>-1)){var r=window.location.href.split("://")[0],a="".concat(r,"://")+n.result.replace(/(http|https):\/\//,"");return Object(we.b)({url:a,onProgress:t}).then(function(e){return JSON.parse(e.response)})}return Promise.resolve(n)}return Promise.reject(n.message)},Ie=function(){return Object(we.b)({url:Se.serverTime}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"getServerTime failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.data,o=n.msg;return 0==r?a.timestamp:Promise.reject(o+": "+r)})},Me=function(e,t){var n,r,a=C.a.singleoffline,o=C.a.gid;if(a){var i=(n="uuid",null==(r=e.match(new RegExp("[?&]"+n+"=([^&]+)","i")))||r.length<1?"":r[1]);e="game".concat(o,"/json/").concat(i,".json")}return Object(we.b)({url:e,onProgress:t}).then(function(e){var n=C.a.offline;return Ee(e,t).then(function(e){return"100"==e.code?e.result:n?e:Promise.reject(e.message)})})},Ae=function(e,t){return Me("".concat(Se.game,"?uuid=").concat(e),t)},Ve=function(e,t){return Me("".concat(Se.otherGame,"?uuid=").concat(e),t)},Te=function(e,t,n){var r="SYConformTime".concat(e),a=C.a.uid||u.c.getUidByCookie(),o=U.localStorageGetItem(r);return o&&(o=u.c.aesDecrypt(o,1)),Object(we.c)({url:"".concat(Se.testGame,"?uuid=").concat(e).concat(t),progress:n,data:{uid:a,time:o}}).then(function(e){var t=C.a.offline;return Ee(e,n).then(function(e){var n=e.code,a=e.message,o=e.result;if(t)return e;switch(parseInt(n)){case 90:return U.localStorageRemoveItem(r),Promise.reject("很抱歉，预览码已过期~");case 91:return Promise.reject("很抱歉，预览码输入错误，请重新输入");case 101:return Promise.reject("作品含有敏感词，暂时没有办法查看哦~");case 100:return o;default:return Promise.reject(a)}})})},je=function(){return new Promise(function(e,t){return ye()(Se.userInfoFromWap,{},function(t,n){if(t)return C.a.uid="",e(!1);if(n){var r=n.data;return 0==n.success?(C.a.uid="",e(!1)):(C.a.uid=r.uid,e(!0))}return e(!1)})})},Ue=function(){return new Promise(function(e,t){return Object(we.b)({url:Se.userInfoFromPc,data:"t=".concat(1e6*Math.random())}).then(function(n){var r=n.responseText;if(0===r.length)return t({status:-2,msg:"用户信息获取失败！"});var a=JSON.parse(r).result.uid;return a?(!0!==u.c.hasChangeUserFromePc&&""!==u.c.preUid&&u.c.preUid!=a&&(u.c.hasChangeUserFromePc=!0),u.c.midWayLoginFromePc=!1,u.c.preUid!=a&&(u.c.midWayLoginFromePc=!0),""!=a&&""==u.c.preUid&&(u.c.preUid=a),C.a.uid=a,e()):(C.a.uid="",t({status:-1,msg:"您还没有登录！"}))},function(){return C.a.uid="",t({status:999,msg:"当前网络不稳定"})})})},Re={time:null,requestPromise:null},De=function(){var e=C.a.client,t=C.a.wap;if("pc"===e)return Ue().then(function(){return!0},function(e){return Promise.reject(e)});if("wap"===e)return"wx"===t?Promise.resolve():je().then(function(e){return 0==e?Promise.reject({status:-1,msg:"您还没有登录！"}):Promise.resolve()});var n=Re,r=n.time,a=n.requestPromise;return r&&u.a.getDate()-r<=5?a:(Re.time=u.a.getDate(),Re.requestPromise=Be(99),Re.requestPromise)},Le=function(){var e=C.a.u,t=C.a.token,n=C.a.app_name,r=C.a.device_name,a=C.a.deviceOsVer;return"u=".concat(Oe(e,1),"&token=").concat(Oe(t,1),"&app_name=").concat(Oe(n||"shanyi",1),"&device_name=").concat(Oe(r||"Google Nexus S",1),"&device_system_version=").concat(Oe(a||"4.1.1",1))},Be=function(e){var t=C.a.client,n=C.a.u,r=C.a.v,a=C.a.token,o=C.a.app_name,i=C.a.device_name,c=C.a.deviceOsVer,s=C.a.gid,l=C.a.app_version,d=function(e,t){return Object(we.c)({url:e,data:t}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"Get loadSaveRecord failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.data,o=n.msg;if(0===r){if(a.cover_url){var i=window.location.href.split("://")[0];Ce.cover_url="".concat(i,"://")+a.cover_url.replace(/(http|https):\/\//,"")||""}else Ce.cover_url="";var c=u.c.decryptBase64(a.content||"");return c&&"{}"!==c?c:null}return Promise.reject({status:r,msg:o})},function(e){return Promise.reject({status:999,msg:e})})},h=n&&a?1:0,f=u.a.getCurDate(),p=""===s?1:parseInt(s),v="",m=e+"";v=h?"app_name=".concat(o||"shanyi","&device_name=").concat(i||"Google Nexus S","&device_system_version=").concat(c||"4.1.1")+"&gid=".concat(p,"&time=").concat(f,"&token=").concat(a,"&type=").concat(m,"&u=").concat(n,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"):"gid=".concat(p,"&time=").concat(f,"&type=").concat(m,"&v_key=0GjRAtUUoK4BwJGUz73jBa2M");var g="gid=".concat(Oe(p,h),"&sign=").concat(Oe(me.a.hash(me.a.hash(v)),h),"&time=").concat(Oe(f,h),"&type=").concat(Oe(m,h));return""!==n&&""!==a?d("".concat(Se.appGetRecord,"&client=").concat(t,"&v=").concat(r,"&app_version=").concat(l),"".concat(g,"&").concat(Le())):d(Se.wapGetRecord,g)},Fe=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"app",a=C.a.isWapOther;r="pc"===C.a.client?"all":r;var o="uuid=".concat(e,"&").concat(t?"chapter_uuid=".concat(t):"product_id=".concat(n),"&platform=").concat(r).concat(a?"&key=external":"");return Object(we.b)({url:Se.getChapterDiscounts,data:o}).then(function(e){var t=e.responseText;return 0===t.length?Promise.reject({code:we.a.ERROR,message:"Get Discounts failed, no response data"}):JSON.parse(t).result})},We=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return Promise.resolve();var t=C.a.uuid;return Object(we.b)({url:Se.optionClick,data:"from=h5&uuid=".concat(t,"&optionid=").concat(JSON.stringify(e))})},Ne=function(e,t,n){var r=C.a.client,a=C.a.offline,o=(C.a.token,C.a.isWapOther),i=(C.a.u,C.a.wap),c=(C.a.single,C.a.gid),s=C.a.singleoffline,l=C.a.type,d=C.a.uuid,h=function(e,t){return Object(we.c)({url:e,data:t,progress:n}).then(function(e){return 0===e.responseText.length?Promise.reject({code:we.a.ERROR,message:"Get chapterInfo failed, no response data"}):Ee(e,n).then(function(e){var t=e.code,n=e.result,r=e.message,o=e.plots;return 100==t?n.plots:a?o:Promise.reject({code:t,message:r})})},function(e){return Promise.reject({code:999,message:"当前网络不稳定，请检查你的网络！"})})};if(s){var f="game".concat(c,"/json/").concat(e,".json");return h(f,"")}"ios"!==r&&"android"!==r&&"wap"!==r&&"pc"!==r&&(C.a.uid=u.c.getUidByCookie());var p="uuid=".concat(1==l?36==d.length&&(d+="2"):d,"&uid=").concat(C.a.uid,"&chapter_uuid=").concat(e,"&md5=").concat(t,"&platform=").concat(r?"app":"pc").concat(o?"&key=external":"").concat(1==l?"&action=test":""),v="".concat(Se.getChapter,"?").concat(p);return"wap"===r?C.a.uid&&"wx"!==i?je().then(function(){return h(v,p)}):h(v,p):"pc"===r?Ue().then(function(){return h(v,p)},function(){return h(v,p)}):h(v,p)},$e={time:null,requestPromise:null},ze=function(){var e=C.a.u,t=C.a.v,n=C.a.client,r=C.a.app_version,a=C.a.token,o=C.a.gid,i=C.a.alpha,c=C.a.single;if(!i||c)return Promise.resolve(!1);if("wap"===n)return Promise.resolve(!1);if("pc"===n)return Promise.resolve(i);var s=$e.time,l=$e.requestPromise;if(s&&u.a.getDate()-s<=5)return l;$e.time=u.a.getDate();var d="u=".concat(Oe(e,1),"&token=").concat(Oe(a,1),"&game_id=").concat(Oe(o,1)),h="".concat(Se.checkUserAlpha,"&client=").concat(n,"&v=").concat(t,"&app_version=").concat(r);return $e.requestPromise=Object(we.c)({url:h,data:d}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"checkUserAlpha failed, no response data"});var n=JSON.parse(t),r=n.success,a=n.status,o=n.data;return 0===a&&r&&o&&1==o.status}),$e.requestPromise},He=function(){var e=C.a.gid;return e?Object(we.c)({url:Se.getAuthorGameNotice,data:"game_id=".concat(e)}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"Get chapterInfo failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.data,o=void 0===a?{}:a;return 100==r&&1==o.status?Promise.resolve(o.pass_time):Promise.reject()}):Promise.reject()},qe=function(){var e=C.a.uuid;return"pc"!==C.a.client?Promise.resolve():Object(we.b)({url:Se.getFlashAdv,data:"?uuid=".concat(e,"&dynamic=").concat(1e17*Math.random())}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.resolve();var n=JSON.parse(t),r=n.code,a=(n.message,n.result);return 100==r?a:Promise.resolve()},function(){return Promise.resolve()})},Ge=function(e){var t=C.a.gid;if("pc"===C.a.client){var n=u.a.getCurDate();Object(we.c)({url:Se.sendPlayTime+"&gid=".concat(t,"&t=").concat(n),data:"gid=".concat(t,"&minute=").concat(Math.round(e/60))})}},Ke=function(){var e=C.a.client,t=C.a.v,n=C.a.u,r=C.a.token,a=C.a.app_name,o=C.a.device_name,i=C.a.deviceOsVer,c=C.a.gid,s=C.a.app_version,l=function(e,t){return Object(we.c)({url:e,data:t}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"Get loadSaveRecord failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.data,o=n.msg;return 100===r?a||[]:Promise.reject({status:r,msg:o})})},d=n&&r?1:0,h=""===c?1:parseInt(c),f=u.a.getCurDate(),p="";p=d?"app_name=".concat(a||"shanyi","&device_name=").concat(o||"Google Nexus S","&device_system_version=").concat(i||"4.1.1")+"&gid=".concat(h,"&time=").concat(f,"&token=").concat(r,"&u=").concat(n,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"):"gid=".concat(h,"&time=").concat(f,"&v_key=0GjRAtUUoK4BwJGUz73jBa2M");var v="gid=".concat(Oe(h,d),"&sign=").concat(Oe(me.a.hash(me.a.hash(p)),d),"&time=").concat(Oe(f,d));return""!==n&&""!==r?l("".concat(Se.getAppUnlockRecord,"&client=").concat(e,"&v=").concat(t,"&app_version=").concat(s),"".concat(v,"&").concat(Le())):l(Se.getWapUnlockRecord,v)},Je=(S({},we.a),null),Qe=null,Ye=["jump","insert","back"].concat(["options","conditionOptions","addImage","showDialog","playMusic","playSound","weather"]),Ze=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"subRef",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"play";et.sub(e,t,n)}},{key:"addRef",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"play";et.add(e,t,n),"image"===e&&tt.pop(t)}},{key:"addRefTo",value:function(e,t,n,r){var a=et.count(e,t,n);a<r&&et.add(e,t,n,r-a)}},{key:"isSafeRef",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"play",a=et.count(e,t),o=et.count(e,t,r);return a-o>0||o>=n}},{key:"inCache",value:function(e,t){return"image"===e?Qe.checkImageKey(t):re.inCache(t)}},{key:"isLoading",value:function(e,t){return"image"===e?Je.getAsset("image",t):re.inCache(t)}},{key:"load",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=n;if(e.inCache(t,o))return!1;if(!(n=u.c.convertToFullUrl(n)))return!1;var i=!0;if("image"===t){var c=(Je.getAsset("image",o)||{}).file;i=!(c&&c.loading&&!c.loaded&&!c.error)}else i=!re.isLoading(o);return"image"===t?(i&&Je.image(o,n,!0,a),!r&&et.add("image",o,"global")):"audio"===t&&(i&&re.load(o,n,a),!r&&et.add("audio",o,"global")),i}},{key:"removeCache",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!et.absent(t,n)&&!et.count(t,n)){var a=function(){if(!et.count(t,n)){var r=e.getUsing().filter(function(e){return e.url===n});if(r.length)et.add(t,n,"play",r.length);else{var a=Qe.getImage(n,!0);if(a){var o=a.data.frames;o&&o.forEach(function(e){return e.image=null}),/blob:/i.test(a.url)&&URL.revokeObjectURL(a.url),Qe.removeImage(n)}}}};if("audio"===t)re.free(n),Xe.state.size+=e.getSize(n,t);else if("image"===t){if(!r)return tt.push(n),void Xe.start();Qe.checkImageKey(n)?a():Je.forceRemoveFile("image",n,function(){return a()}),Xe.state.size+=e.getSize(n,t)}delete et[t][n],Xe.start()}}},{key:"startLoadThread",value:function(){Xe.start()}},{key:"getCommandsPreloadType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=[];return t.forEach(function(t){var r=t.type,a=t.args,o=t.uuid;if("options"===r||"conditionOptions"===r)for(var i=0,u=a.length;i<u;i++)"options"===r?n.push("$".concat(o,"o").concat(i,"-")):(n.push("$".concat(o,"c").concat(i,"-")),n.push("$".concat(o,"l").concat(i,"-"))),n.push.apply(n,Object(b.a)(e.getCommandsPreloadType(a[i].commands)))}),n}},{key:"getPlotPreloadType",value:function(t){var n=[],r=t.uuid,a=t.commands,o=t.options,i=void 0===o?[]:o,u=t.condition_options,c=void 0===u?[]:u;a&&n.push.apply(n,Object(b.a)(e.getCommandsPreloadType(a)));for(var s=0,l=i.length;s<l;s++)n.push("$".concat(r,"o").concat(s,"-")),n.push.apply(n,Object(b.a)(e.getPlotsPreloadType(i[s].plots)));for(var d=0,h=c.length;d<h;d++)n.push("$".concat(r,"c").concat(d,"-")),n.push("$".concat(r,"l").concat(d,"-")),n.push.apply(n,Object(b.a)(e.getPlotsPreloadType(c[d].plots)));return n}},{key:"getPlotsPreloadType",value:function(t){var n=[];return t.forEach(function(t){return n.push.apply(n,Object(b.a)(e.getPlotPreloadType(t)))}),n}},{key:"resetInsertAfter",value:function(t,n){Xe.state.loadingChapterMap[t.uuid]=!1,e.getPlotsPreloadType(t.plots).forEach(function(e){et.transfer(e,!1),Xe.kill(e)});var r={};pe.getJumpAndInsertChapterUuids(n).map(function(e){return r[e]=!0}),pe.getJumpAndInsertChapterUuids(t).map(function(e){return r[e]?null:"$".concat(e)}).filter(function(e){return e}).forEach(function(e){return Xe.kill(e)})}},{key:"resetInsert",value:function(e){var t="$".concat(e.uuid);Xe.state.loadingChapterMap[e.uuid]=!0,et.transfer(t),Xe.update(t,!0),Xe.start()}},{key:"resetJump",value:function(t){var n="$".concat(t.uuid),r=pe.getJumpAndInsertChapterUuids(t).map(function(e){return"$".concat(e)});Xe.state.loadingChapterMap[t.uuid]=!0,et.clear([n].concat(Object(b.a)(r))),et.transfer(n);var a={};e.getUsing().forEach(function(e){var t=e.url;return a[t]=(a[t]||0)+1}),et.forEach(function(t,n,r){a[n]?et.add(t,n,"play",a[n]):0===r&&e.removeCache(t,n)}),Xe.update(n,!1,r),Xe.start()}},{key:"resetCommandOption",value:function(e,t){var n=e.type,r=e.args,a=e.uuid;if("options"===n||"conditionOptions"===n){var o="options"===n?"o":"c",i="$".concat(a).concat(o).concat(t,"-");et.transfer(i),r.forEach(function(e,n){if(n!==t){var r="$".concat(a).concat(o).concat(n,"-");et.transfer(r,!1),Xe.kill(r)}}),Xe.update(i),Xe.start()}}},{key:"resetComandAfter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Xe.start();var t=e.uuid,n=e.type,r=e.args;n&&Ye.some(function(e){return e===n})&&Xe.state.loaded--,"conditionOptions"===n&&r.forEach(function(e,n){return et.transfer("$".concat(t,"l").concat(n,"-"),!1)})}},{key:"resetPlotOption",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=e.uuid,a=e.options,o=void 0===a?[]:a,i=e.condition_options,u=void 0===i?[]:i;if(o.length||u.length){var c="$".concat(r).concat(t).concat(n,"-");et.transfer(c),o.forEach(function(e,t){if(t!==n){var a="$".concat(r,"o").concat(t,"-");et.transfer(a,!1),Xe.kill(a)}}),u.forEach(function(e,t){if(t!==n){var a="$".concat(r,"c").concat(t,"-");et.transfer(a,!1),Xe.kill(a)}}),Xe.update(c,!0),Xe.start()}}},{key:"resetPlotAfter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Xe.start(),Xe.state.loaded--;var n=t.uuid,r=t.commands,a=void 0===r?[]:r,o=t.condition_options;o&&o.length?o.forEach(function(e,t){return et.transfer("$".concat(n,"l").concat(t,"-"),!1)}):e.getCommandsPreloadType(a).forEach(function(e){et.transfer(e,!1),Xe.kill(e)})}},{key:"getUsing",value:function(){for(var e=[],t=function t(n){return n.children.forEach(function(n){if("MotionImage"===n.name){var r=n.motionImageData;r&&r.images.forEach(function(t){var n=t.url;return e.push({url:n,type:"image"})})}else n.key&&u.c.isString(n.key)&&e.push({url:n.key,type:"image"});t(n)})},n=game.world.children,r=0,a=n.length;r<a;r++)"scene"===n[r].name&&t(n[r]);return re.getUsingUrls().forEach(function(t){return e.push({url:t,type:"audio"})}),e.filter(function(e){return e.url&&"__default"!==e.url&&"__missing"!==e.url})}},{key:"needLoadByPlot",value:function(t){return t.commands?e.needLoadByCommands(t.commands):e.getPlot(t)}},{key:"needLoadByCommands",value:function(t){var n=[],r=0;return function t(a){for(var o=0;o<a.length&&r<20;o++){var i=a[o],u=e.getCommand(i);if(u.length&&(n.push.apply(n,Object(b.a)(u)),r++),"options"===i.type||"conditionOptions"===i.type)for(var c=0;c<i.args.length&&r<20;c++)t(i.args[c].commands)}}(t),n}},{key:"getCommandState",value:function(t){var n=[],r=e.gameJson.motionImgMap,a=function(e,t){if(u.c.isObject(e)){if(!r||!e.uuid||!r[e.uuid])return;r[e.uuid].images.forEach(function(e){var t=e.url;return n.push({type:"image",url:t})})}else e&&u.c.isString(e)&&"inherit"!==e&&n.push({type:t,url:e})},o=t.weather,i=t.images,c=t.bubbleMode;return o&&e.getWeather(o.args[0]).forEach(function(e){var t=e.url,n=e.type;return a(t,n)}),i&&i.forEach(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).command;return e&&a(e.args[0].url,"image")}),c&&c.length>0&&c.forEach(function(e){return e&&e.bubble.forEach(function(e){if(e){var t=e.avatar,n=e.content;t.url&&"inherit"!==t.url&&a(t.url,"image"),n.url&&"inherit"!==n.url&&a(n.url,"image"),n.background&&n.background.url&&a(n.background.url,"image")}})}),n}},{key:"getWeather",value:function(e){return u.c.getWeatherUrls(e).map(function(e){return{type:"image",url:e}})}},{key:"getCommand",value:function(t){var n=[],r=t.args,a=t.type,o=e.gameJson.motionImgMap,i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(u.c.isObject(e)){if(!o||!e.uuid||!o[e.uuid])return;o[e.uuid].images.forEach(function(e){var t=e.url;return n.push({type:"image",url:t})})}else e&&u.c.isString(e)&&"inherit"!==e&&n.push({type:"image",url:e})};switch(a){case"addView":r.forEach(function(e){return e.events.forEach(function(e){return e.events.forEach(function(e){var t=e.type,r=e.handle;"playMusic"===t&&r.music?r.music.url&&n.push({url:r.music.url,type:"audio"}):"playSound"===t&&r.sounds&&r.sounds.forEach(function(e){return e&&e.url&&"inherit"!=e.url&&n.push({url:e.url,type:"audio"})})})})});case"addImage":i(r[0].url);break;case"showDialog":i(r[0].avatar.url);break;case"playMusic":case"playSound":r[0].url&&"inherit"!==r[0].url&&n.push({type:"audio",url:r[0].url});break;case"options":for(var c=0,s=r.length;c<s;c++){var l=r[c],d=l.background,h=l.sound;if(d){var f=d.normal,p=d.active,v=d.disable;f&&f.url&&i(f.url),p&&p.url&&i(p.url),v&&v.url&&i(v.url)}h&&h.url&&n.push({type:"audio",url:h.url})}break;case"weather":C.a.offline||n.push.apply(n,Object(b.a)(e.getWeather(t.args[0])));break;case"showBubble":i(r[0].url);break;case"emitBubble":var m=r[0],g=m.avatar,y=m.content,w=y.background;i(g.url),i(y.url),w&&i(w.url)}return n}},{key:"getPlot",value:function(t){var n=t.plot_sound,r=t.background,a=t.avatar,o=t.music,i=t.characters,c=t.props,s=t.options,l=t.weather,d=t.views,h=[],f=e.gameJson.motionImgMap,p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(u.c.isObject(e)){if(!f||!e.uuid||!f[e.uuid])return;f[e.uuid].images.forEach(function(e){var t=e.url;return h.push({type:"image",url:t})})}else e&&u.c.isString(e)&&"inherit"!==e&&h.push({type:"image",url:e})};if(Array.isArray(n))for(var v=0,m=n.length;v<m;v++){var g=n[v];g&&g.url&&"inherit"!==g.url&&h.push({url:g.url,type:"audio"})}else n.url&&"inherit"!==n.url&&h.push({url:n.url,type:"audio"});r.url&&"inherit"!==r.url&&p(r.url),a.url&&p(a.url),o.url&&"inherit"!==o.url&&h.push({url:o.url,type:"audio"});for(var y=0,w=i.length;y<w;y++)i[y].url&&p(i[y].url);for(var _=0,x=c.length;_<x;_++)c[_].url&&p(c[_].url);for(var k=0,P=s.length;k<P;k++){var S=s[k],O=S.background,E=S.sound;if(O){var I=O.normal,M=O.active,A=O.disable;I&&I.url&&p(I.url),M&&M.url&&p(M.url),A&&A.url&&p(A.url)}E&&E.url&&h.push({type:"audio",url:E.url})}return d.forEach(function(e){return e.events.forEach(function(e){return e.events.forEach(function(e){var t=e.type,n=e.handle;"playMusic"===t&&n.music?n.music.url&&h.push({url:n.music.url,type:"audio"}):"playSound"===t&&n.sounds&&n.sounds.forEach(function(e){return e&&e.url&&"inherit"!=e.url&&h.push({url:e.url,type:"audio"})})})})}),l.value&&(C.a.offline||h.push.apply(h,Object(b.a)(e.getWeather(t.weather.value)))),h}},{key:"countOptionAssets",value:function(t){var n={},r=0,a=function(e){var t=e.url;n[t]||(r++,n[t]=!0)},o=function(t){for(var n=t.plots,r=0,o=n.length;r<o;r++){var u=n[r],s=[];u.commands?s=u.commands.map(function(t){var n=t.args,r=t.type;return"options"!==r&&"conditionOptions"!==r||c(n),e.getCommand(t)}).reduce(function(e,t){return[].concat(Object(b.a)(t),[e])},[]):(u.options.length&&i(u.options),u.condition_options.length&&i(u.condition_options),s=e.getPlot(u)),s.forEach(function(e){return a(e)})}},i=function(e){return e.forEach(function(e){return o(e)})},u=function(t){for(var n=t.commands,r=0,o=n.length;r<o;r++){var i=n[r];e.getCommand(i).forEach(function(e){return a(e)}),"options"!==i.type&&"conditionOptions"!==i.type||c(i.args)}},c=function(e){return e.forEach(function(e){return u(e)})};return t.plots?o(t):u(t),r}},{key:"clearPreload",value:function(){Xe.queue.length=[],Xe.state.loadingChapterMap={},Xe.state.loaded=0,et.clear(),e.getUsing().forEach(function(t){var n=t.url,r=t.type;return e.addRef(r,n)})}},{key:"clearUselessRef",value:function(){et.forEach(function(t,n,r){return r<=0&&e.removeCache(t,n)})}},{key:"getPreload",value:function(t){var n=t.stack,r=void 0===n?[]:n,a=t.chapter,o=t.plots,i=t.plotIndex,c=void 0===i?0:i,s=t.commands,l=t.cmdIndex,d=void 0===l?0:l,h=t.commandState;e.clearPreload();var f={data:[],size:0};r=Object(b.a)(r);var p=e.gameJson.motionImgMap,v=function(t,n,r){if(t){var a=function(t,n,r){if(et.add(t,n,r),!f.data.some(function(e){return e.url===n})){var a=e.getSize(n,t);f.data.push({url:n,type:t,size:a}),f.size+=a}};if(t&&u.c.isString(t)&&"inherit"!==t)a(n,t,r);else if(u.c.isObject(t)){if(!p||!t.uuid||!p[t.uuid])return;var o=p[t.uuid].images;(void 0===o?[]:o).forEach(function(e){var t=e.url;return a(n,t,r)})}}};if(h&&e.getCommandState(h).forEach(function(e){var t=e.type,n=e.url;return v(n,t,"play")}),s&&!s[d]||o&&!o[c])return Promise.resolve(f.data);var m=function(){return f.size>2e7||f.data.length>30},g=function(t,n,r){var a=t.loadType,o=pe.getChapterByUUID(e.gameJson,r);if(o)return a="$".concat(o.uuid),Xe.fixTask({stack:[],chapter:o,plots:o.plots,plotIndex:0,commands:null,cmdIndex:0,loadType:a})},y=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t.stack,a=t.commands,o=t.plotIndex,i=t.cmdIndex,u=a[i]||{},c=u.type,s=u.args;if("jump"===c)return Xe.pushTasks([g(t,0,s[0])]),Promise.resolve();if("insert"===c)return Xe.pushTasks([g(t,0,s[0])]),w(S({},t,{cmdIndex:i+1}));if("back"===c)return Promise.resolve();if("options"===c||"conditionOptions"===c)return function t(n){for(var r=n.commands,a=n.cmdIndex,o=n.loadType,i=r[a],u=i.type,c=i.args,s=i.uuid,l=[],d=[],h=function(e){return S({},n,{stack:[]},e)},f=function(n,r){for(var a=c[n],i="options"===u?"o":"branch"!==a.type&&e.countOptionAssets(a)<=50?"l":"c",f="".concat("play"===o?"":o,"$").concat(s).concat(i).concat(n,"-"),p=Promise.resolve(),y=a.commands,w=function(n){var r=a.commands[n],o=r.type,i=r.args;if(p=p.then(function(){if(m())return Promise.reject(n);var a=h({commands:y,cmdIndex:n,loadType:f});return e.getCommand(r).forEach(function(e){var t=e.url,n=e.type;return v(t,n,f)}),"options"===o||"conditionOptions"===o?t(a):"jump"===o?(Xe.pushTasks([g(a,0,i[0])]),Promise.reject(-1)):"insert"===o?(Xe.pushTasks([g(a,0,i[0])]),Promise.reject(n+1)):"back"===o?Promise.reject(-1):Promise.resolve()}),"options"===o||"conditionOptions"===o)return n+1<a.commands.length&&(p=p.then(function(){return Promise.reject(n)})),"break"},b=0;b<a.commands.length&&b<10&&"break"!==w(b);b++);p=p.then(function(){a.commands.length>10&&d.push(h({commands:y,cmdIndex:10,loadType:f}))},function(e){e>=0&&a.commands.length>e&&d.push(h({commands:y,cmdIndex:e,loadType:f}))}),l.push(p)},p=0,y=c.length;p<y;p++)f(p);return Promise.all(l).then(function(){return d.length&&Xe.pushTasks(d),Promise.resolve()})}(t).then(function(){return w(S({},t,{cmdIndex:i+1}),n)});if(a.length>i+1)return w(S({},t,{cmdIndex:i+1}),n);if(n&&r.length){var l=r[0];if(r=r.slice(1),l.commands)return w(S({},l,{stack:r,loadType:"play"}),n);var d=r,h=d.condition,f=d.breakNext;return _(S({},h?f:l,{stack:r,loadType:"play"}))}return n?_(S({},t,{plotIndex:o+1,commands:null})):Promise.resolve()},w=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t.commands,a=t.cmdIndex,o=t.loadType;return a>=r.length?y(t,n):m()?(Xe.pushTasks([Xe.cloneTask(t)]),Promise.resolve()):(e.getCommand(r[a]).forEach(function(e){var t=e.url,n=e.type;return v(t,n,o)}),y(t,n))},_=function(t){var n=t.plots,r=t.plotIndex,a=t.loadType,o=n[r];if(!o||o.commands&&!o.commands.length)return Promise.resolve();if(o.commands)return w(S({},t,{commands:o.commands,cmdIndex:0}));return m()?(Xe.pushTasks([Xe.cloneTask(t)]),Promise.resolve()):(e.getPlot(o).forEach(function(e){var t=e.url,n=e.type;return v(t,n,a)}),function t(n){var r=n.plotIndex,a=n.plots,o=n.loadType,i=a[r],u=i.uuid,c=i.options,s=i.condition_options,l=function(e){return S({},n,{stack:[]},e)},d=function(n,r){for(var a=[],i=[],c=function(c,s){for(var d=n[c],h="options"===r?"o":"branch"!==d.type&&e.countOptionAssets(d)<=50?"l":"c",f="".concat("play"===o?"":o,"$").concat(u).concat(h).concat(c,"-"),p=Promise.resolve(),y=d.plots,b=function(n){var r=y[n];p=p.then(function(){return m()?Promise.reject(n):r.commands?w(l({loadType:f,commands:r.commands,cmdIndex:0,plots:y,plotIndex:n})):void e.getPlot(r).forEach(function(e){var t=e.url,n=e.type;return v(t,n,f)})}).then(function(){var e=l({loadType:f,plots:y,plotIndex:n,commands:null});return function(e){for(var t=e.options,n=e.condition_options,r=0,a=0,o=t.length;a<o;a++)r+=t[a].plots.length;for(var i=0,u=n.length;i<u;i++)r+=n[i].plots.length;return r}(r)?t(e):r.jump?(Xe.pushTasks([g(e,0,r.jump)]),Promise.reject(-1)):r.insert?(Xe.pushTasks([g(e,0,r.insert)]),Promise.reject(n+1)):r.back?Promise.reject(-1):Promise.resolve()})},_=0;_<y.length&&_<5;_++)b(_);p=p.then(function(){y.length>5&&i.push(l({loadType:f,plots:y,plotIndex:5,commands:null}))},function(e){return e>=0&&d.plots.length>e&&!d.plots[e].commands&&i.push(l({loadType:f,plots:y,plotIndex:e,commands:null})),Promise.resolve()}),a.push(p)},s=0,d=n.length;s<d;s++)c(s);return Promise.all(a).then(function(){return i.length&&Xe.pushTasks(i)})};return Promise.all([d(c,"options"),d(s,"condition_options")])}(t).then(function(){return x(t)}))},x=function(e){var t=e.stack,n=e.plots,r=e.plotIndex,a=n[r];if(a.back)return Promise.resolve();if(a.jump)return Xe.pushTasks([g(e,0,a.jump)]),Promise.resolve();if(a.insert)return Xe.pushTasks([g(e,0,a.insert)]),_(S({},e,{plotIndex:r+1}));if(n.length>r+1)return _(S({},e,{plotIndex:r+1}));if(t.length){var o=t[0];if(t=t.slice(1),o.commands)return w(S({},o,{stack:t,loadType:"play"}));var i=t,u=i.condition,c=i.breakNext;return _(S({},u?c:o,{stack:t,loadType:"play"}))}return Promise.resolve()},k=function(){return f.size<1e8&&(Xe.state.size=1e8-f.size),Xe.state.loadingChapterMap[a.uuid]=!0,f.data},P={stack:r,chapter:a,plots:o,plotIndex:c,commands:s,cmdIndex:d,loadType:"play"};return s?w(P).then(function(){return k()}):_(P).then(function(){return k()})}},{key:"getSize",value:function(e,t){return"image"===t?"gif"===e.substr((Math.max(0,e.lastIndexOf("."))||1/0)+1).toLowerCase()?1e6:2e5:"audio"===t?2e6:void 0}},{key:"loader",set:function(e){Je=e}},{key:"cache",set:function(e){Qe=e}}]),e}();Ze.gameJson=null;var Xe=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"start",value:function(){var t=e.state;if(!(t.loading||t.size<0)){t.loading=!0;setTimeout(function n(){var r=[],a=e.queue,o=15;t.loaded>50&&t.loaded<80?o+=2:t.loaded>=80&&(o+=4*Math.floor(t.loaded/40));for(var i=function(n){for(var i=[],c=a[n],s=function(r){var a=c[r];if(a.lock)return i.push(Promise.resolve()),"continue";var s=u.c.timeout(0).then(function(){return e.queue[n]&&e.queue[n][r]&&a===e.queue[n][r]?e.getChapter(a):Promise.reject()}).then(function(t){return e.getAssets(t)}).then(function(e){return e.map(function(e){return S({},e,{needLoad:Ze.load(e.type,e.url,!0)})})}).then(function(e){var n=e.filter(function(e){return e.needLoad}),r=n.reduce(function(e,t){return e+t.size},0);t.size-=r,n.length&&Je.start()}).then(function(){return u.c.timeout(o)});i.push(s)},l=0;l<c.length;l++)s(l);r.push(Promise.all(i).then(null,function(e){return e&&console.warn(e)}))},c=0;c<a.length&&t.loaded<200;c++)i(c);var s=function(){e.updateQueue(),t.loaded++,t.size<=0||!e.queue.length||t.loaded>=200?t.loading=!1:setTimeout(n,0)};r.length?Promise.all(r).then(s,s):t.loading=!1},0)}}},{key:"update",value:function(t){for(var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=e.queue,o=0;o<a.length;o++){for(var i=function(e){var i=a[o][e],c=i.loadType;if(c.startsWith(t))c=c.substring(t.length),i.loadType=c||"play";else if(!n){if(r.some(function(e){return c.startsWith(e)}))return u=e,"continue";a[o].splice(e--,1)}u=e},u=0;u<a[o].length;u++)i(u);a[o].length||a.splice(o--,1)}}},{key:"kill",value:function(t){for(var n=e.queue,r=0;r<n.length;r++){for(var a=0;a<n[r].length;a++){n[r][a].loadType.startsWith(t)&&n[r].splice(a--,1)}n[r].length||n.splice(r--,1)}}},{key:"getAssets",value:function(e){var t=e.commands,n=e.plots,r=e.plotIndex,a=void 0===r?0:r,o=e.cmdIndex,i=void 0===o?0:o,u=e.loadType,c=void 0===u?"play":u,s=[],l=function(e){var t=e.url,n=e.type;et.add(n,t,c),s.some(function(e){return e.url===t})||s.push({url:t,type:n,size:Ze.getSize(t,n)})};if(t){var d=t[i];(d?Ze.getCommand(d):[]).forEach(function(e){return l(e)})}else{(n[a]?Ze.getPlot(n[a]):[]).forEach(function(e){return l(e)})}return s}},{key:"getTaskPriority",value:function(e){for(var t=e.loadType,n=(void 0===t?"play":t).split("$").slice(1).map(function(e){var t=e.slice(36);return/o\d-$/.test(t)?"option":/(c|l)\d-$/.test(t)?"condOption":"chapter"}),r=0,a=0;a<n.length;a++)switch(n[a]){case"chapter":case"option":r+=2;break;case"condOption":r+=1}return r}},{key:"cloneTask",value:function(e){return S({},e,{stack:Object(b.a)(e.stack||[])})}},{key:"createTask",value:function(t){var n=t.task,r=t.type,a=t.chapter,o=n=e.cloneTask(n),i=o.stack,u=(o.loadType,null);switch(r){case"pop":u=i.pop(),Object.assign(n,u,{loadType:"play",stack:i}),u&&"insert"===u.type&&(u=i.pop(),Object.assign(n,u,{loadType:u.loadType||"play",stack:i}));break;case"jump":case"insert":n.stack=[],n.chapter=a,n.plots=a.plots,n.commands=null,n.plotIndex=0,n.cmdIndex=0,n.loadType="$".concat(a.uuid),e.state.loadingChapterMap[a.uuid]=!0}return e.fixTask(n)}},{key:"fixTask",value:function(e){var t=e.plots,n=e.commands,r=e.plotIndex,a=void 0===r?0:r;if(!n&&t&&t[a]){var o=t[a];if(o.commands)return S({},e,{commands:o.commands,cmdIndex:0})}return e}},{key:"createTasksByPlotOption",value:function(t){for(var n=t.task,r=t.plot,a=t.optionType,o=n.loadType,i=[],u=r[a],c=0;c<u.length;c++){var s=u[c];if(s.plots.length){var l=Ze.countOptionAssets(s);if(!(l<1)){var d=S({},n,{stack:[],plots:s.plots,plotIndex:0,commands:null}),h="options"===a?"o":"branch"!==s.type&&l<=50?"l":"c";d.loadType="".concat("play"===o?"":o,"$").concat(r.uuid).concat(h).concat(c,"-"),i.push(e.fixTask(d))}}}return i}},{key:"createTasksByCommandOption",value:function(e){for(var t=e.task,n=e.command,r=t.loadType,a=[],o=n.args,i=0;i<o.length;i++){var u=o[i];if(u.commands.length){var c=S({},t,{stack:[],commands:u.commands,cmdIndex:0}),s="options"===n.type?"o":"branch"!==u.type&&Ze.countOptionAssets(u)?"l":"c";c.loadType="".concat("play"===r?"":r,"$").concat(n.uuid).concat(s).concat(i,"-"),a.push(c)}}return a}},{key:"updateQueue",value:function(){for(var t=e.queue,n=0,r=t.length;n<r;n++)for(var a=t[n],o=function(n){var r=a[n],o=r.stack,c=r.plots,s=r.plotIndex,l=void 0===s?0:s,d=r.commands,h=r.cmdIndex,f=void 0===h?0:h;if(r.lock)return r.lockTotal--,r.lockTotal||(r.lock=!1,r.loaded=0),i=n,"continue";var p=e.getTaskPriority(r);if(p){var v=0;if(d){var m=d[f]||{},g=m.type,y=m.args;v="options"===g||"conditionOptions"===g?y.length:0}else{var w=c[l]||{},b=w.options,_=void 0===b?[]:b,x=w.condition_options,k=void 0===x?[]:x;v=Math.max(_.length,k.length)}if(r.loaded=r.loaded||0,r.loaded>40||2===p&&r.loaded>10||p>=3||v>5)return r.lock=!0,r.lockTotal=10,i=n,"continue";r.loaded++}if(d)if(d.length<=f){if(c.length>l+1&&d===c[l].commands)return r.plotIndex+=1,r.commands=c[r.plotIndex].commands||null,r.cmdIndex=0,i=n,"continue";a.splice(n--,1),o.length&&t.push([e.createTask({task:r,type:"pop"})])}else{var P=d[f],C=P.type;if("options"===C||"conditionOptions"===C){var S=e.createTasksByCommandOption({command:P,task:r});S.length&&t.push(S),r.cmdIndex++}else if("back"===C||"jump"===C||"insert"===C){"insert"!==C&&a.splice(n--,1);var O=P.args[0];if("back"!==C&&!e.state.loadingChapterMap[O]){var E=pe.getChapterByUUID(Ze.gameJson,P.args[0]);E&&t.push([e.createTask({task:r,type:C,chapter:E})])}r.cmdIndex++}else!function(){for(var n=(d[++r.cmdIndex]||{}).type;n&&!Ye.some(function(e){return e===n});){var a=d[++r.cmdIndex]||{};n=a.type}d[r.cmdIndex]?Ze.getCommand(d[r.cmdIndex]).forEach(function(e){var t=e.url;t&&u.c.isString(t)&&t.toLowerCase().includes(".gif")&&(r.loaded=(r.loaded||0)+10)}):o.length&&t.push([e.createTask({task:r,type:"pop"})])}()}else if(c.length<=l)a.splice(n--,1),o.length&&t.push([e.createTask({task:r,type:"pop"})]);else{var I=c[l],M=I.options,A=void 0===M?[]:M,V=I.condition_options,T=void 0===V?[]:V;if(A.length||T.length){var j=e.createTasksByPlotOption({plot:I,optionType:"options",task:r}),U=e.createTasksByPlotOption({plot:I,optionType:"condition_options",task:r});j.length&&t.push(j),U.length&&t.push(U)}else if(I.back||I.jump||I.insert){if(I.insert||a.splice(n--,1),I.jump){var R=I.jump;if(!e.state.loadingChapterMap[R]){var D=pe.getChapterByUUID(Ze.gameJson,R);D&&t.push([e.createTask({task:r,type:"jump",chapter:D})])}}if(I.insert){var L=I.insert;if(!e.state.loadingChapterMap[L]){var B=pe.getChapterByUUID(Ze.gameJson,L);B&&t.push([e.createTask({task:r,type:"insert",chapter:B})])}}}r.plotIndex++,a[n]=e.fixTask(r)}i=n},i=0;i<a.length;i++)o(i);for(var c=0;c<t.length;c++)t[c]&&!t[c].length&&t.splice(c--,1)}},{key:"getChapter",value:function(t){var n=t.chapter,r=n.md5,a=n.downloadUuid,o=n.uuid,i=n.plots,u=n.charge,c=C.a.client,s=C.a.type;if(r&&!i.length){var l=a||o,d=function(){var r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];a.length&&!n.plots.length&&((r=n.plots).push.apply(r,Object(b.a)(a)),t.plots=n.plots);return delete e.loadingChapterMap[l],Object.assign(t,e.fixTask(t))};if(e.loadingChapterMap[l])return e.loadingChapterMap[l].then(d);var h="ios"!==c&&"android"!==c&&1!=s&&"pc"!==c||!u?Ne(l,r).then(null,function(){return[]}):Promise.reject([]);return e.loadingChapterMap[l]=h,h.then(d)}return Promise.resolve(t)}},{key:"pushTasks",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(t=t.map(function(t){if(!t)return null;var n=t.chapter,r=t.plots,a=t.plotIndex,o=t.commands,i=t.cmdIndex;if(r===n.plots&&0===a&&r.length){var u=r[0];if(e.state.loadingChapterMap[n.uuid])return null;(!u.commands||u.commands&&o===u.commands&&0===i)&&(e.state.loadingChapterMap[n.uuid]=!0)}return e.fixTask(t)}).filter(function(e){return e})).length&&e.queue.push(t)}}]),e}();Xe.state={size:0,loading:!1,loaded:0,loadingChapterMap:{}},Xe.loadingChapterMap={},Xe.queue=[],window.LoadThread=Xe;var et=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"absent",value:function(t,n){return!e[t][n]}},{key:"count",value:function(t,n,r){return e[t][n]?r?e[t][n][r]||0:Object.keys(e[t][n]).reduce(function(r,a){return r+e[t][n][a]},0):0}},{key:"add",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"play",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;game.load.cancelForceRemoveFile(t,n),e[t][n]=e[t][n]||{},e[t][n][r]=(e[t][n][r]||0)+a}},{key:"sub",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"play",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=e[t][n]||{};o[r]=(o[r]||0)-a,o[r]=o[r]<0?0:o[r],0===e.count(t,n)&&Ze.removeCache(t,n)}},{key:"del",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"play";e[t][n][r]=0}},{key:"forEach",value:function(t){[e.image,e.audio].forEach(function(n,r){return Object.keys(n).forEach(function(n){t&&t(r?"audio":"image",n,e.count(r?"audio":"image",n))})})}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];[e.image,e.audio].forEach(function(e,n){return Object.keys(e).forEach(function(n){var r=e[n],a=r.global,o=void 0===a?0:a,i=r.cache,u=void 0===i?0:i,c=r.using,s={global:o,cache:u,using:void 0===c?0:c},l=Object.keys(e[n]);t.forEach(function(e){return l.forEach(function(t){return~t.indexOf(e)?s[t]=r[t]:void 0})}),e[n]=s})})}},{key:"move",value:function(t,n){[e.image,e.audio].forEach(function(e){Object.keys(e).forEach(function(r){var a=e[r];a[n]=(a[n]||0)+(a[t]||0),delete a[t]})})}},{key:"transfer",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];[e.image,e.audio].forEach(function(e,r){Object.keys(e).forEach(function(a){e.hasOwnProperty(a)&&Object.keys(e[a]).forEach(function(o){if(o.startsWith(t)){var i=o.indexOf(t),u=o.slice(i+t.length)||"play",c=e[a][o]||0;delete e[a][o],n?e[a][u]=(e[a][u]||0)+c:Ze.removeCache(r?"audio":"image",a)}})})})}}]),e}();et.image={},et.audio={},window.RefManager=et;var tt=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"push",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=e.gifs,r=e.images,a="gif"===t.substr((Math.max(0,t.lastIndexOf("."))||1/0)+1).toLowerCase(),o=a?n:r,i=function(){var e=o.findIndex(function(e){var t=e.url;return 1===et.count("image",t)});if(~e){var t=o[e].url;o.splice(e,1),et.del("image",t,"cache"),Ze.removeCache("image",t,!0)}},u=o.findIndex(function(e){return e.url===t});if(~u){var c=o[u];c.timestamp=Date.now(),o.splice(u,1),o.push(c)}else o.push({url:t,timestamp:Date.now()}),et.add("image",t,"cache");a&&n.length>10&&i(),!a&&r.length>50&&i()}},{key:"pop",value:function(t){var n=e.gifs,r=e.images,a="gif"===t.substr((Math.max(0,t.lastIndexOf("."))||1/0)+1).toLowerCase()?n:r,o=a.findIndex(function(e){return e.url===t});~o&&(a.splice(o,1),et.sub("image",t,"cache"))}}]),e}();tt.gifs=[],tt.images=[],window.DelayRemoveUtils=tt;var nt=83,rt=function(e){function t(e,n,r,a,i){var u;Object(o.a)(this,t),(u=ie(this,ue(t).call(this,a,e,n))).name="MotionImage";var c=t.gameJson.motionImgMap;if(!(c&&r&&r.uuid&&c[r.uuid]))return ie(u);var s=t.gameJson.motionImgMap[r.uuid],l=s.width,d=s.height,h=s.timelines,f=s.frames,p=s.loop,v=s.images;u.motionImageData=s;var m=new PIXI.BaseTexture;m.width=l,m.height=d,m._glTextures=[],m.resolution=1,m.scaleMode=Phaser.scaleModes.DEFAULT,m.hasLoaded=!0,u.texture=new PIXI.Texture(m,new Phaser.Rectangle(0,0,l,d));var g=i.rectMask({alpha:0,rect:{width:l,height:d}});u.addChild(g);for(var y=[],w=function(e,t){var n=e.rotate,r=void 0===n?0:n;r=parseInt(r);var a=i.image(v[e.image].url,e);a.anchor.setTo(.5,.5),a.x+=a.width/2,a.y+=a.height/2,a.angle=180===r?179.9:r,a.frameData=e,a.key=null,t.add(a)},_=0,x=h.length;_<x;_++){var k=i.group(),P=h[_][0];P&&!P.frame&&w(P,k),k.mask=g,y.push(k),u.addChild(k)}var C=0,S=0;return u.timeoutID=setTimeout(function e(){if(++C>=f){if(S++,p&&S>=p)return;C=0}y.forEach(function(e,t){!C&&e.removeAll(!0);for(var n=e.children,r=0,a=(n=Object(b.a)(n)).length;r<a;r++){var o=n[r].frameData,i=o.frame;(i+o.during<=C||i>C)&&n[r].destroy()}h[t].forEach(function(t){t.frame===C&&w(t,e)})}),u.timeoutID=setTimeout(e,nt)},nt),u}return le(t,Phaser.Image),Object(i.a)(t,[{key:"destroy",value:function(e,n){var r=this.motionImageData;r&&r.images&&r.images.forEach(function(e){var t=e.url;return Ze.subRef("image",t,"play")}),clearTimeout(this.timeoutID),ce(ue(t.prototype),"destroy",this).call(this,e,n)}}]),t}(),at=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"findImage",value:function(t){var n=e.gameJson.valueImgs,r=void 0===n?[]:n,a=_e.safeEval(t,e.playContext);return~a&&a>0?r[a-1]:(console.warn("未再图片库中找到对应内容".concat(JSON.stringify(t))),null)}}]),e}();at.playContext=null,at.gameJson=null;var ot={boundsAlignH:"center",boundsAlignV:"middle",align:"center"},it=function(e){var t=e.forceFontFamily,n=e.fontWeight,r=e.fontSize,a=void 0===r?12:r,o=e.color,i=void 0===o?"#000000":o,c=e.stroke,s=e.boundsAlignH,l=void 0===s?"left":s,d=e.boundsAlignV,h=void 0===d?"top":d,f=e.align;a=parseInt(a);var p=t||E.fontFamily||e.fontFamily||"宋体";return{font:"".concat(n||"normal"," ").concat(a?a+"px":""," ").concat(p),stroke:c,strokeThickness:c?2:0,fill:u.c.formatColor(i||"#000000"),boundsAlignH:l,boundsAlignV:h,align:f,fontSize:a,fontFamily:p}},ut=function(e,t){var n=t.width,r=t.height,a=Math.min(n/e.width,r/e.height);e.scale.setTo(a,a),e.x=(n-e.width)/2,e.y=(r-e.height)/2},ct=function(e){return function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=this.game.world.angle,i=this.characterWidth,c=this.characterHeight,s=this.stamp;s.angle=-o;for(var l=0;l<t.length;l++){var d=E.getRealImageCharOffset(t[l],e);if(ht.test(t[l]))n+=i-d+a;else{var h=E.getRealImageCharWidth(t[l])*s.scale.x-d;if(this.grabData[t.charCodeAt(l)]){var f=this.grabData[t.charCodeAt(l)],p=f.index,v=f.imageData;s.frame=p;var m=s.texture.baseTexture.source.getContext("2d");m.clearRect(0,0,i,c);var g=s.scale.x,y=v,w=y.width,b=y.height,_=y.data;if(g>1.3&&this.game.device.desktop){for(var x=m.createImageData(w,b),k=x.data,P=0;P<b;P++)for(var C=0;C<w;C++){var S=4*(P*w+C),O=Math.floor(1.5*_[S+3]);O=O>255?255:O,k.set([_[S],_[S+1],_[S+2],O],S)}v=x}m.putImageData(v,0,0),this.renderXY(this.stamp,n,r,!1)}else{for(var I=1;void 0===this.grabData[t.charCodeAt(l+I)]&&l+I<=t.length;)h+=E.getRealImageCharWidth(t[l+I])*s.scale.x-d,I++;var M=ft.text({width:h,height:c},{fontSize:e,forceFontFamily:"宋体",text:t.substr(l,I),color:u.c.formatColor(s.tint)});this.renderXY(M,n,r,!1),l+=I-1}if((n+=h+a)>this.width)break}}}},st=function(e){var t=e.fontFamily,n=e.fontSize,r=Phaser.Text.fontPropertiesCache,a="".concat(n,"px '").concat(t,"'");if(!r[a]){var o=E.toRealSize(t,n).height;r[a]={fontSize:o,ascent:o/2,descent:0}}},lt=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=0,a=E.getSizeScale(t,n),o=0;o<e.length;o++)r+=Math.round(E.getRealImageCharWidth(e[o])*a-E.getRealImageCharOffset(e[o],n));return r},dt=/(?:\r\n|\r|\n)/,ht=/^[\s\x20\xA0\u2002\u2003\u3000]+$/,ft=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"group",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=game.make.group(void 0,e);if(t){var r=t.x,a=t.y,o=t.width,i=t.height;n.x=r,n.y=a,n.width=o,n.height=i}return n}},{key:"textarea",value:function(t,n){var r=t.x,a=void 0===r?0:r,o=t.y,i=void 0===o?0:o,c=t.width,s=void 0===c?0:c,d=(t.height,n.forceFontFamily),h=n.color,f=void 0===h?"#fefefe":h,p=n.fontSize,v=void 0===p?12:p,m=n.name,g=void 0===m?"":m;i=u.b.roundToInt(i),f=u.c.formatColor(f||"#000000");var y=game,w=y.make,b=y.add;if(d||!E.useFontImage){st(it(n));var _=w.text(a,i);return g&&(_.name=g),_.fill=f,_.useAdvancedWrap=!0,_.advancedWordWrap=l.advancedWordWrap,_.lineHeight=1.5*parseInt(v),_.setStyle=function(e){e=it(e),st(e),_.lineHeight=1.5*parseInt(e.fontSize),Phaser.Text.prototype.setStyle.call(_,S({},e,{wordWrap:!0,wordWrapWidth:s}),!0)},_.setTexts=function(e){_.clearColors();for(var t=0,n="",r=0;r<e.length;r++){var a=e[r],o=a.data,i=void 0===o?"":o,c=a.lineBreak,s=a.color,l=void 0===s?f:s;n+=i,l=l?u.c.formatColor(l):f,_.addColor(l,t),t+=c?0:i.length}_.setText(n,!0)},_.getLines=function(){return _.advancedWordWrap(_.text).split(dt)},_.getCharsWidth=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return _.context.measureText(e).width},_.setStyle(n),_}var x=E.fontFamily,k=E.charWidth,P=E.charHeight,C=e.group("textarea");C.x=a,C.y=i,C.texts=[];return C.setStyle=function(e){f=e.color||f,v=parseFloat(e.fontSize)},C.setTexts=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];C.removeAll(!0,!1,!0);for(var t=1.5*v,n=[""],r=0,a=0,o=0,i=(t-E.toRealSize(x,v).height)/2-.5|0,c=e[0]&&e[0].color||f,l="",d=function(e){l&&(!function(e){var t=e.text,n=e.color,r=e.x,a=e.y,o=b.retroFont(x,k,P),i=E.getSizeScale(x,v);o.characterWidth=k*i,o.characterHeight=P*i,o.stamp.scale.setTo(i,i),o.stamp.tint=u.c.toColorValue(n),o.pasteLine=ct(v),o.setFixedWidth(lt(t,x,v)),o.setText(t,!1,0,0,"left",!0);var c=b.image(r,a,o);c.destroy=function(){return Phaser.Image.prototype.destroy.call(c,!0,!0)},C.add(c)}({text:l,color:c,x:o,y:u.b.roundToInt(i)}),o+=lt(l,x,v)),l="",c=e},h=0;h<e.length;h++){var p=e[h],m=p.data,g=p.lineBreak,y=p.color,w=void 0===y?f:y;if(c!==w&&l&&d(w),g)!ht.test(l)&&d(e[h+1]&&e[h+1].color||f),o=a=0,i+=t,l=n[++r]="";else for(var _=0;_<m.length;_++){var S=lt(m[_],x,v);a+S>s?(d(w),o=0,a=S,i+=t,l=n[++r]=m[_]):(a+=S,n[r]+=m[_],l+=m[_])}}for(!ht.test(l)&&d(c);n.length&&(ht.test(n[n.length-1])||!n[n.length-1]);)n.splice(n.length-1,1);C.lines=n},C.getLines=function(){return C.lines},C.getCharsWidth=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return lt(e,x,v)},C.setStyle(n),C}},{key:"text",value:function(e,t){var n=this,r=e.x,a=void 0===r?0:r,o=e.y,i=void 0===o?0:o,c=e.width,s=void 0===c?0:c,l=e.height,d=void 0===l?0:l,h=t.forceFontFamily,f=t.hidden,p=t.text,v=void 0===p?"":p,m=t.name,g=void 0===m?"":m;if(f)return null;var y=game,w=y.make,b=y.add;if(h||!E.useFontImage){i=u.b.roundToInt(i),st(it(t));var _=w.text(0,0);return _.setTextBounds(a,i,s,d),g&&(_.name=g),_.setStyle=function(e){e=it(e),st(e),Phaser.Text.prototype.setStyle.call(_,e,!0)},_.setText=function(e){Phaser.Text.prototype.setText.call(_,e,!0);var t=_.width-s,n=_.style,r=n.align,o=n.boundsAlignH;"center"===r&&"center"===o&&t>0?_.setTextBounds(a-t/2,i,_.width,d):_.setTextBounds(a,i,s,d)},_.setStyle(t),_.setText(v),_}var x=E.fontFamily,k=E.charWidth,P=E.charHeight,C=b.retroFont(x,k,P),S=b.image(0,0,C);return g&&(S.name=g),S.setStyle=function(e){var t=it(e),r=t.fill,a=t.boundsAlignH,o=t.boundsAlignV,i=t.align,c=void 0===i?"left":i,s=t.fontSize,l=E.getSizeScale(x,s);C.characterWidth=k*l,C.characterHeight=P*l,C.stamp.scale.setTo(l,l),C.stamp.tint=u.c.toColorValue(r),C.pasteLine=ct(s),C.setFixedWidth(lt(v,x,s)),C.setText=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Phaser.RetroFont.prototype.setText.apply(C,t),t[0]===C._text&&(C.removeUnsupportedCharacters(n.multiLine),C.buildRetroFontText())},C.align=c,S.fontStyle={boundsAlignH:a,boundsAlignV:o,fontSize:s}},S.setText=function(e){C.setText(e||" ",!1,0,0,"left",!0);for(var t=S.fontStyle,n=t.boundsAlignH,r=t.boundsAlignV,o=t.fontSize,c=0,l=E.getSizeScale(x,o),h=0;h<e.length;h++)c+=E.getRealImageCharWidth(e[h])*l-E.getRealImageCharOffset(e[h],o);var f=0;"center"===n?f=(s-c)/2:"right"===n&&(f=s-c),S.x=u.b.roundToInt(a+f);var p=0;"middle"===r?p=(d-C.height)/2:"bottom"===r&&(p=d-C.height),S.y=u.b.roundToInt(i+p)},S.setStyle(t),S.setText(v),Object.defineProperty(S,"text",{get:function(){return C.text},set:function(e){C.setText(e)}}),S.destroy=function(){return Phaser.Image.prototype.destroy.call(S,!0,!0)},S}},{key:"image",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=u.c.isObject(t),o=a&&t.type,i=r.x,c=void 0===i?0:i,s=r.y,l=void 0===s?0:s,d=r.centre,h=void 0!==d&&d,f=r.width,p=r.height,v=r.name,m=void 0===v?"":v,g=r.opacity,y=void 0===g?1:g,w=game,b=w.make,_=w.cache,x=w.time.events,k=null;if(a)if(o){var P=at.findImage(t),C=P&&P.url?P.url:"";t=_.checkImageKey(C)?C:null,k=b.image(c,l,t,null)}else k=new rt(c,l,t,game,e);else t=_.checkImageKey(t)?t:null,k=b.image(c,l,t,null);if(k.alpha=y,m&&(k.name=m),h&&k.anchor.setTo(.5,.5),void 0!==f&&(k.width=f),void 0!==p&&(k.height=p),t&&(!a||o)){var S=_.getImage(t,!0).data,O=S.frameLength,E=S.loopCount,I=S.frames;if(I&&O>1){var M=0,A=0,V=0,T=function(e){I[e]&&(k.parent||k.game)&&k.setTexture(I[e].image)};!function e(){if(k.parent||k.game)if(I[M]){var t=x._now;x.add(I[M].delay,function(){var n=M;for(A+=x._now-t;I[M]&&A>=I[M].delay;)A-=I[M].delay,M+1>=O?(M=0,V++):M++;I[M]?E&&V>=E||!k.parent&&!k.game?n!=O-1&&T(O-1):(e(),n!==M&&T(M)):e()},n)}else setTimeout(e,10)}()}}return k}},{key:"button",value:function(t,n){var r=game,a=r.cache,o=r.make,i=t.x,u=t.y,c=t.width,s=t.height,l=n.normalUrl,d=n.activeUrl,h=n.disableUrl,f=n.audio,p=n.onClick,v=n.name,m=void 0===v?"":v,g=n.textOptions,y=void 0===g?{}:g,w=y.normal,b=y.active,_=y.disable,x=y.center,k=void 0===x||x,P=e.group(m,t);P.x=i,P.y=u;var C=[l,d,h],O=[e.image(l),e.image(d),e.image(h)];O.forEach(function(e,n){e.visible=!n,ut(e,t),P.add(e)});var E=o.button(0,0,null,p,this);E.width=c,E.height=s,P.add(E);var I=null;if(w){var M=k?S({},t,{x:0,y:0}):y.rect;(I=e.text(M,S({},w,ot)))&&P.add(I)}var A=function(e,t){I&&t&&I.setStyle(t);var n=C.findIndex(function(t){return t===e});O.forEach(function(e){return e.visible=!1}),O[n].visible=!0},V=function(){E.inputEnabled&&A(d,S({},b||{},ot)),f&&a.checkSoundKey(f.url)&&re.play(f,!0)},T=function(){E.inputEnabled&&A(l,S({},w||{},ot)),f&&a.checkSoundKey(f.url)&&re.stop(f)};E.onInputOver.add(V),E.onInputDown.add(V),E.onInputOut.add(T),E.onInputUp.add(T),P.disable=function(){E.inputEnabled=!1,A(h,S({},_||{},ot))},P.enable=function(){E.inputEnabled=!0,E.input.useHandCursor=!0,A(l,S({},w||{},ot))},P.setText=function(e){return I&&I.setText(e,!0)},P.showText=function(e){return I.visible=!!e};var j=P.destroy;return P.destroy=function(){p=null,P.setText=null,P.disable=null,P.enable=null,E.input.mouseOut=null;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];j.apply(P,t)},P}},{key:"checkbox",value:function(t,n){var r=game.make,a=t.x,o=t.y,i=t.width,u=t.height,c=n.uncheckedUrl,s=n.checkedUrl,l=n.onClick,d=n.name,h=void 0===d?"":d,f=n.textOptions,p=void 0===f?{}:f,v=p.unchecked,m=p.checked,g=e.group(h,t);g.x=a,g.y=o;var y=[c,s],w=[e.image(c),e.image(s)];w.forEach(function(e,n){e.visible=!n,ut(e,t),g.add(e)});var b=r.button(0,0,null,l,this);b.width=i,b.height=u,g.add(b);var _=null;v&&(_=e.text(S({},t,{x:0,y:0}),S({},v,ot)))&&g.add(_);var x=function(e,t){_&&t&&_.setStyle(t);var n=y.findIndex(function(t){return t===e});w.forEach(function(e){return e.visible=!1}),w[n].visible=!0};g.check=function(e){return e?x(s,S({},m||{},ot)):x(c,S({},v||{},ot))};var k=g.destroy;return g.destroy=function(){b.check=null;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];k.apply(g,t)},g}},{key:"sprite",value:function(e){var t=game.make,n=e.x,r=void 0===n?0:n,a=e.y,o=void 0===a?0:a;return t.sprite(r,o)}},{key:"rectMask",value:function(e){var t=e.color,n=void 0===t?0:t,r=e.alpha,a=void 0===r?1:r,o=e.x,i=void 0===o?0:o,c=e.y,s=void 0===c?0:c,l=e.rect,d=l.x,h=void 0===d?0:d,f=l.y,p=void 0===f?0:f,v=l.width,m=l.height,g=game.make.graphics(i,s);return g.beginFill(u.c.toColorValue(n),a),g.drawRect(h,p,v,m),g.endFill(),g}},{key:"tileSprite",value:function(e){var t=e.x,n=e.y,r=e.width,a=e.height,o=e.url;return game.make.tileSprite(t,n,r,a,o)}}]),e}(),pt=function(e,t,n,r){e&&!r[e]&&(n.push({url:e,type:t}),r[e]=t)},vt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=[],r=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return pt(e,r,n,t)},a=e.normal,o=e.active;return a&&a.background&&r(a.background.url),o&&o.background&&r(o.background.url),n},mt=function(e,t,n){return t.forEach(function(t){var r=e[t];r.normal&&r.normal.background&&n(r.normal.background.url),r.active&&r.active.background&&n(r.active.background.url)})},gt=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"getCoverAssets",value:function(e){var t=e.titleContainer,n={},r=[],a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return pt(e,t,r,n)};return t&&t.background&&a(t.background.url),mt(e,["startMenu","loadMenu","settingsMenu","overMenu"],a),r}},{key:"getDialogAssets",value:function(e){var t=e.background,n=e.avatarContainer,r=e.titleContainer,a={},o=[],i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return pt(e,t,o,a)};return t&&i(t.url),n&&n.background&&i(n.background.url),r&&r.background&&i(r.background.url),o}},{key:"getMainMenuAssets",value:function(e){var t=e.background,n=e.header,r={},a=[],o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return pt(e,t,a,r)};return t&&o(t.url),n&&n.background&&o(n.background.url),mt(e,["save","load","playback","autoplay","settings","back"],o),a}},{key:"getSettingsAssets",value:function(e){var t=e.background,n=e.header,r={},a=[],o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return pt(e,t,a,r)};return t&&o(t.url),n&&n.background&&o(n.background.url),mt(e,["back"],o),["musicVolume","soundVolume"].forEach(function(t){var n=e[t];n&&n.normal&&n.normal.background&&o(n.normal.background.url),n&&n.progress&&n.progress.background&&o(n.progress.background.url)}),["fullMode","windowMode","autoOn","autoOff"].forEach(function(t){var n=e[t];n&&n.checked&&n.checked.background&&o(n.checked.background.url),n&&n.unchecked&&n.unchecked.background&&o(n.unchecked.background.url)}),["header","displayHeader","textHeader","displayCaption","textCaption","soundCaption","musicCaption","volumeHeader"].forEach(function(t){var n=e[t];n&&n.background&&o(n.background.url)}),a}},{key:"getPlaybackAssets",value:function(e){var t={},n=[],r=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return pt(e,r,n,t)},a=e.background,o=e.scrollBox,i=(o||{}).item,u=(i||{}).content;return a&&r(a.url),o&&o.background&&r(o.background.url),i&&i.background&&r(i.background.url),u&&u.background&&r(u.background.url),mt(e,["back"],r),n}},{key:"getRecordAssets",value:function(e){var t={},n=[],r=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return pt(e,r,n,t)},a=e.background,o=e.scrollBox,i=(o||{}).item,u=(i||{}).content;return a&&r(a.url),o&&o.background&&r(o.background.url),i&&i.background&&r(i.background.url),u&&u.background&&r(u.background.url),mt(e,["back"],r),n}},{key:"getSoundAssets",value:function(e){var t=[],n=e.sound;return n&&n.url&&t.push({url:n.url,type:"audio"}),t}}]),e}();x(gt,"getMenuAssets",function(e){return vt(e)}),x(gt,"getShanyiMenuAssets",function(e){return vt(e)}),x(gt,"getOptionAssets",function(e){return vt(e)});var yt=n(124),wt=n.n(yt),bt=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"flex",value:function(e,t,n){var r=n.width,a=n.height,o=5;if(e===3){var i=t.width/t.height<r/a?r/t.width:a/t.height;t.width*=i,t.height*=i,t.x=-(t.width-r)/2,t.y=-(t.height-a)/2}else if(e===o){var u=0;t.width/t.height>r/a?(u=r/t.width,t.width*=u,t.height*=u,t.y=(a-t.height)/2):(u=a/t.height,t.width*=u,t.height*=u,t.x=(r-t.width)/2)}else t.width=r,t.height=a}},{key:"fullScreenTip",value:function(e){var t=e.text,n=void 0===t?"":t,r=e.alpha,a=void 0===r?1:r,o=e.fontSize,i=void 0===o?24:o,u=game.world,c=u.width,s=u.height,l=ft.group(),d=ft.rectMask({alpha:a,rect:{width:c,height:s}});return d.inputEnabled=!0,l.add(d),l.add(ft.text({width:c,height:s},{text:n,name:"text",fontSize:i,forceFontFamily:"宋体",color:"#fff",boundsAlignH:"center",boundsAlignV:"middle"})),l}}]),e}(),_t=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"get",value:function(t,n){if(n&&2===n.length){var r=e.get(t,n[1]);return void 0!==r&&r.hasOwnProperty(n[0])?r[n[0]]:void 0}return t}},{key:"toArray",value:function(t){if(t&&2===t.length){var n=e.toArray(t[1]);return n.push(t[0]),n}return[]}},{key:"fromArray",value:function(e){var t=null;return e.forEach(function(e){t=[e,t]}),t}},{key:"stringify",value:function(e){for(var t="";e&&e.length>0;)t="/"+e[0]+t,e=e[1];return t&&(t+="/"),t}},{key:"isSame",value:function(t,n){return e.stringify(t)===e.stringify(n)}},{key:"merge",value:function(t,n){return n&&2===n.length?[n[0],e.merge(t,n[1])]:t}},{key:"createQuery",value:function(t,n){return t&&2===t.length?e.createQuery(t[1],x({},t[0],n)):n}},{key:"mergeQuerys",value:function(e){var t=["$push","$set","$unshift","$splice","$merge","$apply"],n={};return e.forEach(function(e){return n=function e(n,r){return"object"!==a(n)||null===n?r:"object"!==a(r)||null===r?n:(Object.keys(r).forEach(function(a){var o=null;o=t.some(function(e){return a===e})?n.hasOwnProperty(a)?n[a]:r[a]:e(n[a],r[a]),n=update(n,x({},a,{$set:o}))}),n)}(n,e)}),n}},{key:"compare",value:function(t,n){if(e.isSame(t,n))return 0;for(var r=[],a=[];t&&t.length;)r.unshift(t[0]),t=t[1];for(;n&&n.length;)a.unshift(n[0]),n=n[1];var o=(r.length>a.length?r.map(function(e,t){return t>=a.length?1:e===a[t]?0:e>a[t]?1:-1}):a.map(function(e,t){return t>=r.length?-1:e===r[t]?0:e>r[t]?-1:1})).find(function(e){return 0!==e});return void 0===o?0:o}},{key:"getTopPaths",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter(function(n){return!t.some(function(t){return e.stringify(n).startsWith(e.stringify(t))&&!e.isSame(t,n)})})}}]),e}(),xt=(n(67),function(e){for(var t=e.x,n=e.y,r=e.width,a=e.height,o=e.view,i=game,u=i.canvas,c=i.world,s=u.getBoundingClientRect(),l=c.width,d=c.height,h=C.a.vertical,f=[],p=o.parent;p!==c;)f.unshift(p),p=p.parent;for(var v=0,m=0,g=1,y=1,w=0;w<f.length;w++){var b=f[w],_=b.scale,x=b.x,k=b.y;v+=x*g,m+=k*y,g*=_.x,y*=_.y}var P=1,S=1;t=t*g+v,n=n*y+m;var O=function(){r*=g,a*=y};if(s.width>s.height){P=(h?s.height:s.width)/l,S=(h?s.width:s.height)/d,O();var E=t,I=n;t=h?s.left+s.width-I*S:s.left+E*P,n=h?s.top+E*P:s.top+I*S}else{P=(h?s.width:s.height)/l,S=(h?s.height:s.width)/d,O();var M=t,A=n;t=h?s.left+M*P:s.left+s.width-A*S,n=h?s.top+A*S:s.top+M*P}return{x:t,y:n+=s.top<0?-s.top:0,width:r,height:a,scale:y*S*o.scale.y}});function kt(e){var t=this,n=e.game,r=e.x,a=e.y,o=e.width,i=e.height,c=e.text,s=e.color,l=e.fontSize,d=e.fontFamily,h=e.bold;Phaser.Group.call(this,n,null),this.game=n,this.name="input";var f=document.createElement("input");f.style.position="absolute",f.style.margin="0",f.style.border="0",f.style.padding="0",f.style.left=r+"px",f.style.top=a+"px",f.style.width=o+"px",f.style.height=l+6+"px",f.style.color=s,f.style.backgroundColor="transparent",f.style.borderColor="transparent transparent transparent transparent",f.style.outline="none",f.style.fontSize=l+"px",f.style.fontFamily=d,f.style.fontWeight=h?"bold":"normal",f.style.visibility="hidden",u.c.setElemetStyle(f,"transformOrigin","left top"),document.body.appendChild(f),this.element=f,this._x=r,this._y=a,this._width=o,this._height=i,this._fontSize=l,this.text=c,this.isNumber=!1,this.onDestroy.add(function(){return document.body.removeChild(t.element)},this)}kt.prototype=Object.create(Phaser.Group.prototype),kt.prototype.constructor=kt,kt.prototype.update=function(){var e=this.game.canvas,t=C.a.vertical,n=e.getBoundingClientRect();if(!this.oldRect||this.oldRect.width!=n.width||this.oldRect.height!=n.height||this.oldRect.left!=n.left||this.oldRect.top!=n.top){this.oldRect={left:n.left,top:n.top,width:n.width,height:n.height},this.visible&&this.parent&&"visible"!==this.element.style.visibility&&this.show(!0);var r,a=this._x,o=this._y,i=this._width,c=this._height,s=this.scale,l=xt({x:a,y:o,width:i,height:c,view:this});a=l.x,o=l.y,i=l.width,c=l.height,r=l.scale,n.width>n.height?u.c.setElemetStyle(this.element,"transform","".concat(t?"rotate(90deg)":"rotate(0deg)"," scale(").concat(r,")")):u.c.setElemetStyle(this.element,"transform","".concat(t?"rotate(0deg)":"rotate(90deg)"," scale(").concat(r,")")),this.setLeft(a),this.setTop(o),this.setWidth(i)}},kt.prototype.destroy=function(){game.gameResumed(),document.body.removeChild(this.element)},kt.prototype.show=function(e){this.visible=e,this.element.style.visibility=e?"visible":"hidden"},kt.prototype.setInputCallback=function(e){var t=this,n=function(){var n=t.element.value;t.element.focus(),t._text=n,u.c.getSensitiveWords().forEach(function(e){if(0!==e.length&&-1!==t._text.indexOf(e)){var n="*".repeat(e.length);t.element.value=t._text=t._text.replace(new RegExp(e,"gi"),n)}}),t.isNumber&&(/^(\-|\+)?\d*(\.)?(\d)*?$/.test(n)||(n=parseFloat(n)||0),t.element.value=t._text=be.limitRange(n)),e(!1)};if("ios"===C.a.client||navigator.userAgent.indexOf("iPhone")>-1){var r=navigator.userAgent.match(/CPU\siPhone\sOS\s((([0-9]*)+(_))*)+([0-9]*)/gi);r&&(r[0]>="CPU iPhone OS 10_3_1"||"CPU iPhone OS 10_0_2"===r[0])?this.element.addEventListener("input",n,!1):this.element.addEventListener("compositionend",function(){t.element.removeEventListener("input",n,!1),t.element.addEventListener("input",n,!1)},!1)}else this.element.addEventListener("input",n,!1);this.element.addEventListener("mousedown",function(){return e(!1)},!1),this.element.addEventListener("touchstart",function(){return e(!1)},!1),this.element.onblur=function(){if(game.gameResumed(),t.isNumber){var n=parseFloat(t._text);t.text=be.toFixed(n||0,2)}e(!0);var r=t.game,a=r.device.iOS,o=r.scale;a&&setTimeout(function(){game.gameResumed(),o.updateLayout(),o.signalSizeChange(),(t.oldRect={})&&t.parent&&t.update()},20)}},kt.prototype.setClickCallback=function(e){var t=this;this.element.addEventListener("click",function(){return e(t)},!1)},kt.prototype.setLeft=function(e){this.element.style.left=e+"px"},kt.prototype.setTop=function(e){this.element.style.top=e+"px"},kt.prototype.setWidth=function(e){this.element.style.width=e+"px"},kt.prototype.setFontSize=function(e){e=e<10?10:e,this.element.style.fontSize=e+"px",this.element.style.height=e+6+"px"},kt.prototype.setEnable=function(e){this.element.readOnly=(!!e).toString()},Object.defineProperty(kt.prototype,"x",{get:function(){return this._x},set:function(e){var t=xt({x:e,view:this}).x;this.setLeft(t),this._x=e}}),Object.defineProperty(kt.prototype,"y",{get:function(){return this._y},set:function(e){var t=xt({y:e,view:this}).y;this.setTop(t),this._y=e}}),Object.defineProperty(kt.prototype,"width",{get:function(){return this._width},set:function(e){var t=xt({width:e,view:this}).width;this.setWidth(t),this._width=e}}),Object.defineProperty(kt.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e}}),Object.defineProperty(kt.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this.setFontSize(fontSize),this._fontSize=e}}),Object.defineProperty(kt.prototype,"style",{get:function(){return this._style},set:function(e){for(var t in e)this.element.style[t]=e[t];this._style=e}}),Object.defineProperty(kt.prototype,"text",{get:function(){return this._text},set:function(e){this.element.value=e,this._text=e,"[未知数值]"===e&&this.setEnable(!1)}}),Object.defineProperty(kt.prototype,"readOnly",{get:function(){return this.readOnly},set:function(e){this.setEnable(e),this.element.readOnly=(!!e).toString()}});var Pt=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"container",value:function(t){var n=t.data,r=t.path,a=t.onMount,o=n.x.value,i=n.y.value,u=n.view,c=n.calledViews,s=n.scale,l=void 0===s?1:s,d=u.width,h=u.height,f=u.content.background,p=u.children,v=ft.group("",{x:o,y:i}),m=ft.image(f.url,{name:"background"});m.key?bt.flex(5,m,{width:d,height:h}):(m.width=d,m.height=h),m.inputEnabled=!0,m.input.useHandCursor=!0,v.add(m);for(var g=["children",["view",r]],y=0,w=p.length;y<w;y++){e[k=p[y].view.type]&&v.add(e[k]({data:p[y],path:[y,g],onMount:a}))}var b=ft.group("calledViews");g=["calledViews",r];for(var _=0,x=c.length;_<x;_++){var k;e[k=c[_].view.type]&&b.add(e[k]({data:c[_],path:[_,g],onMount:a}))}return v.add(b),v.scale.setTo(l,l),a(v,n,r),v}},{key:"button",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,o=t.y.value,i=t.view,u=t.scale,c=void 0===u?1:u,s=i.width,l=i.height,d=i.content,h=d.background,f=d.sound,p=ft.button({x:a,y:o,width:s,height:l},{normalUrl:h.normal.url,activeUrl:h.active.url,audio:f});return p.scale.setTo(c,c),r(p,t,n),p}},{key:"text",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,o=t.y.value,i=t.view,c=t.scale,s=void 0===c?1:c,l=i.width,d=i.height,h=i.content,f=h.color,p=h.bold,v=h.font_size,m=h.value,g=ft.group("",{x:a,y:o});g.add(ft.rectMask({alpha:0,rect:{width:l,height:d}}));var y=ft.textarea({width:l,height:d},{fontSize:v,color:f,fontWeight:p?"bold":"normal"});y.inputEnabled=!0,y.input&&(y.input.useHandCursor=!0);var w=m;return Array.isArray(w)||(w=u.c.toArrayForData(w).map(function(e){return S({},e,{color:f})})),y.setTexts(w),g.add(y),g.scale.setTo(s,s),g.setTexts=function(){return y.setTexts.apply(y,arguments)},r(g,t,n),g}},{key:"input",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,o=t.y.value,i=t.view,u=t.scale,c=void 0===u?1:u,s=i.width,l=i.height,d=i.content,h=d.color,f=d.font_size,p=d.bold,v=d.value.value,m=d.fontFamily,g=new kt({game:game,x:a,y:o,width:s,height:l,text:v,color:h,bold:p,fontSize:f,fontFamily:m||E.fontFamily});return g.scale.setTo(c,c),r(g,t,n),g}},{key:"image",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,o=t.y.value,i=t.view,u=t.scale,c=void 0===u?1:u,s=i.width,l=i.height,d=i.content.background,h=ft.image(d.url,{width:s,height:l}),f=ft.group("",{x:a,y:o});return h.inputEnabled=!0,h.input.useHandCursor=!0,f.add(h),f.scale.setTo(c,c),r(f,t,n),f}},{key:"bar",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,o=t.y.value,i=t.view,u=t.scale,c=void 0===u?1:u,s=i.width,l=i.height,d=i.content,h=d.background,f=d.value,p=f.normal,v=f.progress,m=d.basePoint,g=d.style,y=ft.group(),w=ft.image(h.normal.url,{width:s,height:l}),b=ft.image(h.progress.url,{width:s,height:l});w.inputEnabled=!0,w.input.useHandCursor=!0,w.key||(w.width=s,w.height=l),y.add(w),y.add(b);var _,x,k=p.width.value,P=p.height.value,C=v.width.value,S=v.height.value;_=(k<=0||C<0?0:C>k?1:1*C/k)*s,x=(P<=0||S<0?0:S>P?1:1*S/P)*l;var O=m.x>0?m.x==s?m.x-_:m.x-_/2:m.x,E=m.y>0?m.y==l?m.y-x:m.y-x/2:m.y;if("clip"===g){var I=ft.rectMask({color:16777215,rect:{x:O,y:E,width:_,height:x}});y.add(I),b.mask=I}else b.x=O,b.y=E,b.width=_,b.height=x;return y.x=a,y.y=o,y.scale.setTo(c,c),r(y,t,n),y}},{key:"timer",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,o=t.y.value,i=ft.image(null,{x:a,y:o});return r(i,t,n),i}}]),e}(),Ct=null,St=1,Ot=0,Et=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(Ct?Ct.update(e):Ct=new It(e)).show()},It=function(){function e(t){var n=t.type,r=t.text;Object(o.a)(this,e),this.container=ft.group(),this.render(),this.update({type:n,text:r})}return Object(i.a)(e,[{key:"show",value:function(){var e=C.a.vertical,t=game.world,n=this.animating,r=this.container;r.x=(t.width-this.text.width)/2,r.y=e?100:252;var a=r.parent;a&&a.remove(r),t.add(r),a=t,n&&n.cancel&&n.cancel(),r.alpha=1,this.animating=H.to({target:r,properties:{alpha:0},duration:2500}),this.animating.then(function(){a.remove(r),r.visible=!1})}},{key:"update",value:function(e){var t=e.type,n=e.text,r=void 0===n?"":n,a=this.icon,o=this.background,i=this.text,u=this.container;try{u.visible=!0,game.cache.checkKey(Phaser.Cache.IMAGE,t===St?"icon_success":"icon_error")&&a.loadTexture(t===St?"icon_success":"icon_error"),i.setText(r),o.clear(),o.beginFill(4048076),o.drawRect(0,0,i.width+40,32),o.endFill()}catch(e){var c=u.parent;c&&c.remove(u),u.visible=!1}return this}},{key:"render",value:function(){this.background=game.make.graphics(),this.container.add(this.background),this.icon=ft.image("icon_success",{x:10,y:8}),this.container.add(this.icon),this.text=ft.text({x:30,y:8},{fontSize:16,forceFontFamily:"宋体",color:"#ffffff"}),this.container.add(this.text)}}]),e}(),Mt="".concat(C.a.uuid,"payInfo").concat(C.a.uid),At=!1,Vt=-2,Tt=""!==C.a.u&&""!==C.a.token&&""!==C.a.uid,jt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||0==t.length)return!1;for(var r=function(r){var a=t[r],o=-1;return-1!==e.payValues.findIndex(function(e){return e.uuid===a.uuid})?(n&&(At=!0),{v:!0}):e.indexValues&&-1!==(o=e.indexValues.findIndex(function(e){return e.uuid===a.uuid}))&&"payValue"===e.indexValues[o].init.type&&a.reference?(n&&(At=!0),{v:!0}):void 0},o=0;o<t.length;o++){var i=r(o);if("object"===a(i))return i.v}return!1},Ut=function e(){Object(o.a)(this,e)};x(Ut,"updateFansInfo",function(e){return C.a.singleoffline?Promise.resolve(e):function(){var e=C.a.client,t=C.a.gid,n=C.a.wap;if("wap"===e&&"wx"===n)return Promise.resolve(0);"ios"!==e&&"android"!==e&&"wap"!==e&&"pc"!==e&&(C.a.uid=u.c.getUidByCookie());var r=function(){return Object(we.b)({url:Se.getFansInfo,data:"opus_id=".concat(t,"&uid=").concat(C.a.uid)}).then(function(e){var t=e.responseText;return 0===t.length?Promise.resolve("Get getFansInfo failed, no response data"):JSON.parse(t).data.fans_total||0})};return"wap"===e?je().then(function(){return C.a.uid?r():Promise.resolve(0)}):"pc"===e?Ue().then(function(){return r()},function(){return Promise.resolve(0)}):C.a.uid?r():Promise.resolve(0)}().then(function(t){return u.c.isString(t)?e:P()(e,{systemValues:x({},9,{value:{$set:t}})})},function(){return Promise.resolve(e)})}),x(Ut,"updateAccinfo",function(e,t){var n=C.a.singleoffline,r=C.a.uuid;if(n){var a=U.singleGetValue("".concat(r,"usersysteminfo"));return a?Promise.resolve(P()(e,{systemValues:{$set:JSON.parse(u.c.decryptBase64(a))}})):Promise.resolve(e)}return function(){var e=C.a.client,t=C.a.u,n=C.a.v,r=C.a.app_version,a=C.a.token,o=C.a.gid,i=C.a.wap;if("wap"===e&&"wx"===i)return Promise.reject();var u=function(e,t){return Object(we.c)({url:e,data:t,timeout:4e3}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"Get AccountInfo failed, no response data"});var n={};try{n=JSON.parse(t)}catch(e){return Promise.reject({code:we.a.ERROR,message:"Get AccountInfo failed, no response data"})}var r=n,a=r.status,o=r.data;return 0===a?{coinTotal:o.payment_available||0,starTotal:o.game_coin_available||0,usedStarCount:o.single_game_star_use||0,gameStarLimit:o.single_game_star||0}:Promise.reject(n)},function(e){return Promise.reject({status:100,msg:e})})};if("ios"===e||"android"===e){var c="".concat(Se.appUserInfo,"&client=").concat(e,"&v=").concat(n,"&app_version='").concat(r),s="u=".concat(Oe(t,1),"&token=").concat(Oe(a,1),"&game_id=").concat(Oe(o,1));return u(c,s)}return"wap"===e?je().then(function(){return u(Se.wapUserInfo,"gid=".concat(o))}):"pc"===e?Ue().then(function(){return u(Se.wapUserInfo,"gid=".concat(o))}):De().then(function(){return u(Se.wapUserInfo,"gid=".concat(o))})}().then(function(n){var r;return t&&t(n),P()(e,{systemValues:(r={},x(r,0,{value:{$set:n.coinTotal||0}}),x(r,1,{value:{$set:n.starTotal||0}}),r)})},function(){return Promise.resolve(e)})}),x(Ut,"saveAccinfo",function(e){var t=C.a.uuid;C.a.singleoffline&&U.singleSaveValue("".concat(t,"usersysteminfo"),u.c.encodeBase64(JSON.stringify(e)))}),x(Ut,"updatePayValues",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=C.a.offline,i=C.a.app_version,c=C.a.client,s=C.a.wap,l=C.a.singleoffline,d=C.a.type,h=C.a.single,f=!(u.c.compareVersions(i,"1.11.0")<0);if(1==d)return Promise.resolve(e);var p=function(){a?I.a.info("pc"===c?"商城操作失败，请登录正确的账号后重新尝试":"当前网络信号差，商城".concat(h?"":"、成就等账号","功能无法正常使用，请检查网络设置后，重新打开作品")).then(function(){},function(){}):1==focus&&0==t.length&&I.a.custom("Info",r?"登录账号后值与本地不一致，继续会造成数值错误，建议刷新作品！":"当前网络不稳定，继续可能造成数据丢失，建议刷新作品！","警告",f?"刷新":"确定","取消",!1).then(function(){return f?U.refreshApp():{}},function(){}),Ut.uploadPayValues=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Promise.resolve(!1)},Ut.updatePayValues=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4]);return(jt(e,t)||n)&&(r?I.a.info("pc"===c?"商城操作失败，请登录正确的账号后重新尝试":"当前网络信号差，商城".concat(h?"":"、成就等账号","功能无法正常使用，请检查网络设置后，重新打开作品")).then(function(){},function(){}):I.a.custom("Info","当前网络不稳定，请刷新作品重新获取数据，继续会造成数据错误！","警告",f?"刷新":"确定","取消",!1).then(function(){return f?U.refreshApp():{}},function(){})),Ut.fristUpdateSuccess=!1,Ut.updatePayValueError=!0,Promise.resolve(e)},Ut.fristUpdateSuccess=!1,Ut.updatePayValueError=!0},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(""===e)return Promise.resolve(t);var n=JSON.parse(u.c.decryptBase64(e));return function e(r){if(r>=n.length)return Promise.resolve(t);var a=n[r],o=a.value,i=a.uuid,u=t.payValues.findIndex(function(e){return e.uuid==i});return~u&&(t=P()(t,{payValues:x({},u,{value:{$set:void 0===o?_e.safeInitValue(n[r]):o}})})),e(++r)}(0)},m=function(){I.a.info("当前网络不稳定，继续玩可能会造成数据丢失，请在网络良好的情况下重新打开作品！").then(function(){},function(){}),Ut.uploadPayValues=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Promise.resolve(!1)},Ut.updatePayValues=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(jt(e,t)||n)&&I.a.info("当前网络不稳定，继续玩可能会造成数据丢失，请在网络良好的情况下重新打开作品！").then(function(){},function(){}),Ut.fristUpdateSuccess=!1,Ut.updatePayValueError=!0,Promise.resolve(e)},Ut.fristUpdateSuccess=!1,Ut.updatePayValueError=!0};if(n||jt(e,t)){var g="";if(l){var y=U.singleGetValue("".concat(C.a.uuid,"payInfo"));return v(g=null===y?"":y,e).then(function(e){return e})}if("wap"===c&&"wx"===s){var w=U.localStorageGetItem("".concat(C.a.uuid,"payInfo").concat(C.a.uid));return v(g=null===w?"":w,e).then(function(e){return e})}return!1!==Ut.updatePayValueError?(o?m():p(),Promise.resolve(e)):("pc"===c?Ue().then(function(){return!0},function(){return!0}):Promise.resolve()).then(function(){return function(){var e=C.a.client,t=C.a.v,n=C.a.u,r=C.a.token,a=C.a.app_name,o=C.a.device_name,i=C.a.deviceOsVer,c=C.a.gid,s=C.a.app_version,l=function(e,t){return Object(we.c)({url:e,data:t,timeout:4e3}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"Get AccountInfo failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.data,o=n.msg;if(a){var i=a.content;if(-1==r||0==r)return-1==r?Promise.resolve({code:-1,data:null}):0!=r||a&&i&&""!=i?Promise.resolve({code:1,data:i}):Promise.resolve({code:0,data:null});if(-2==r)return Promise.resolve({code:-2,data:null});if(r>0&&r<9)return Promise.resolve({code:-3,data:null});if(-12==r||100==r)return Promise.resolve({code:-1,data:null})}return Promise.reject("获取用户信息失败("+o+":"+r+")")},function(e){return Promise.reject("获取用户信息权限错误(".concat(e,")"))})},d=n&&r?1:0,h=u.a.getCurDate(),f=""===c?1:parseInt(c),p="";p=d?"app_name=".concat(a||"shanyi","&device_name=").concat(o||"Google Nexus S","&device_system_version=").concat(i||"4.1.1")+"&gid=".concat(f,"&time=").concat(h,"&token=").concat(r,"&u=").concat(n,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"):"gid=".concat(f,"&time=").concat(h,"&v_key=0GjRAtUUoK4BwJGUz73jBa2M");var v="gid=".concat(Oe(f,d),"&sign=").concat(Oe(me.a.hash(me.a.hash(p)),d),"&time=").concat(Oe(h,d));try{return n&&r?l("".concat(Se.appGetPlayValues,"&client=").concat(e,"&v=").concat(t,"&app_version=").concat(s),"".concat(v,"&").concat(Le())):l(Se.wapGetPlayValues,v)}catch(e){return console.error("update payvalue error ",e),Promise.reject("获取用户信息失败!")}}()}).then(function(t){if("pc"==c&&(r=u.c.midWayLoginFromePc),-2==t.code)return Ut.uploadPayValues=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Promise.resolve(!1)},Ut.updatePayValues=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Promise.resolve(e)},e;if("pc"===c&&!1!==u.c.hasChangeUserFromePc&&At)return p(),e;if(o){if(!(-2!==Vt||At||Tt&&-3!==t.code||(Vt=0,r))){var n=U.localStorageGetItem("offline".concat(C.a.uuid,"payInfo"));return v(g=null==n?"":n,e).then(function(e){return e})}if(-1===Vt){if((Tt||r)&&At)return m(),Promise.resolve(e);if(!Tt&&!r)return Promise.resolve(e)}else if(0===Vt){if(!r)return Promise.resolve(e);if(At)return m(),Promise.resolve(e)}}if(Vt=1,0==t.code){var a=U.localStorageGetItem(Mt);U.localStorageRemoveItem(Mt),null==a&&(a=U.localStorageGetItem("".concat(C.a.uuid,"payInfo")),U.localStorageRemoveItem("".concat(C.a.uuid,"payInfo"))),g=null==a?"":a}else if(-1==t.code||-3==t.code){var i=U.localStorageGetItem(Mt);if(g=null==i?"":i,At&&Ut.fristUpdateSuccess)return p(),e}else if(1==t.code&&(g=null==t.data?"":t.data,r&&At))return p(),v(g,e).then(function(e){return e});return-1==t.code&&""!==C.a.uid?(p(),e):""!==g?v(g,e).then(function(e){return 0==t.code?Ut.uploadPayValues(e,[],!0).then(function(t){return!1===t&&p(),Ut.fristUpdateSuccess=t,e}):(1==t.code&&(Ut.fristUpdateSuccess=!0),e)}):-1===t.code?e:Ut.uploadPayValues(e,[],!0).then(function(t){return!1===t&&p(),e})},function(t){if(Ut.fristUpdateSuccess=!1,o){if(!At){var n=U.localStorageGetItem("offline".concat(C.a.uuid,"payInfo"));return Vt=-1,v(g=null==n?"":n,e).then(function(e){return e})}(0===Vt&&Tt||1===Vt)&&m()}else p();return Promise.resolve(e)}).catch(function(){return Promise.resolve(e)})}return Promise.resolve(e)}),x(Ut,"uploadPayValues",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=C.a.offline,a=C.a.client,o=C.a.wap,i=C.a.uuid,c=C.a.uid,s=C.a.singleoffline;if(1==C.a.type)return Promise.resolve(!0);if(jt(e,t,!0)||n){if(s)return U.singleSaveValue("".concat(i,"payInfo"),u.c.encodeBase64(JSON.stringify(e.payValues))),Promise.resolve(!0);if("wap"===a&&"wx"===o){var l=u.c.encodeBase64(JSON.stringify(e.payValues));return U.localStorageSetItem("".concat(i,"payInfo").concat(c),l,365),Promise.resolve(!0)}return function(e){var t=C.a.uuid,n=C.a.uid,r=C.a.client,a=C.a.u,o=C.a.v,i=C.a.token,c=C.a.app_name,s=C.a.device_name,l=C.a.deviceOsVer,d=C.a.gid,h=C.a.app_version,f=C.a.offline,p=u.c.encodeBase64(JSON.stringify(e)),v=function(e,r){return Object(we.c)({url:e,data:r,timeout:4e3}).then(function(e){var r=e.responseText;if(0===r.length)return Promise.reject({error:"用户数据无法保存，请在网络恢复后重新操作"});var a=JSON.parse(r).status;return 0===a?{succee:!0,msg:"用户数据保存成功！"}:-1===a?(f?U.localStorageSetItem("offline".concat(t,"payInfo"),p):U.localStorageSetItem("".concat(t,"payInfo").concat(n),p),Promise.reject({error:"温馨提醒：登录后才可以同步用户数据哦～",status:a})):2===a?Promise.reject({error:"用户数据保存失败，账号已在其他设备登录",status:a}):Promise.reject({error:"用户数据无法保存，请在网络恢复后重新操作",status:a})},function(e){return f?U.localStorageSetItem("offline".concat(t,"payInfo"),p):U.localStorageSetItem("".concat(t,"payInfo"),p),Promise.reject({error:"用户数据无法保存，请在网络恢复后重新操作",status:999})})},m=a&&i?1:0,g=u.a.getCurDate(),y=""===d?1:parseInt(d),w="";w=m?"app_name=".concat(c||"shanyi","&content=").concat(p,"&device_name=").concat(s||"Google Nexus S","&device_system_version=").concat(l||"4.1.1")+"&gid=".concat(y,"&progress=1&time=").concat(g,"&token=").concat(i,"&u=").concat(a,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"):"content=".concat(p,"&gid=").concat(y,"&progress=1&time=").concat(g,"&v_key=0GjRAtUUoK4BwJGUz73jBa2M");var b="content=".concat(Oe(p,m),"&gid=").concat(Oe(y,m),"&progress=").concat(Oe(1,m),"&sign=").concat(Oe(me.a.hash(me.a.hash(w)),m),"&time=").concat(Oe(g,m));try{return a&&i?v("".concat(Se.appSavePlayValues,"&client=").concat(r,"&v=").concat(o,"&app_version=").concat(h),"".concat(b,"&").concat(Le())):v(Se.wapSavePlayValues,b)}catch(e){return console.error("upload payvalue error ",e),Promise.reject({error:"用户数据保存失败！",status:999})}}(e.payValues).then(function(e){return!0},function(e){var t=e.status,n=e.error;return!r||999!==t&&-1!==t||!0,Et({type:Ot,text:n}),!0!==Ut.updatePayValueError&&-1!==t&&(r?1===Vt&&(Ut.updatePayValueError=!0):Ut.updatePayValueError=!0),Promise.resolve(!1)})}return Promise.resolve(!1)}),x(Ut,"updateUserAccInfo",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ut.updatePayValues(e,[],!0,t).then(function(e){return Ut.updateAccinfo(e)}).then(function(e){return Ut.updateFansInfo(e)}).then(function(e){return Ut.fristUpdateSuccess?Ut.uploadPayValues(e,[],!0).then(function(t){return e}):e})}),Ut.updatePayValueError=!1,Ut.fristUpdateSuccess=!1;var Rt=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"updateViews",value:function(t){var n=t.nodes,r=t.viewDatas,a=t.parent,o=t.path,i=t.onMount,u=t.onUpdate;n=Object(b.a)(n);for(var c=0;c<n.length;){var s=n[c],l=s.viewData,d=void 0===l?{}:l,h=r[c]||{};h.instanceUuid===d.instanceUuid?(h!==d&&e.updateView({node:s,viewData:h,path:[c,o],onMount:i,onUpdate:u}),c++):(s.parent.remove(s,!0),n.splice(c,1))}for(;c<r.length;){var f=r[c],p=f.view.type,v=f.visible,m=void 0===v||v;if(Pt[p]){var g=Pt[p]({data:r[c],path:[c,o],onMount:i,onUpdate:u});a.add(g),g.visible=m,"input"===p&&g.update(),g.updateTransform()}c++}}},{key:"updateView",value:function(t){var n=t.node,r=t.viewData,a=t.path,o=t.onMount,i=t.onUpdate,c=n.viewData,s=r.x.value,l=r.y.value,d=r.view,h=r.calledViews,f=r.visible,p=void 0===f||f,v=d.type,m=d.width,g=d.height,y=d.content,w=d.children;switch(n.x=s,n.y=l,v){case"container":var b=n.children.find(function(e){return"calledViews"===e.name});if(c.calledViews!==h){var _=["calledViews",a],x=b.children;e.updateViews({nodes:x,viewDatas:h,parent:b,path:_,onMount:o,onUpdate:i})}if(c.view.children!==w){var k=n.children.filter(function(e){return"calledViews"!==e.name&&"background"!==e.name}),P=["children",["view",a]];e.updateViews({nodes:k,viewDatas:w,parent:n,path:P,onMount:o,onUpdate:i})}n.bringToTop(b);break;case"text":if(c.view.content!==y){var C=y.value,O=y.color;Array.isArray(C)||(C=u.c.toArrayForData(C).map(function(e){return S({},e,{color:O})})),n.setTexts(C)}break;case"input":c.view.content!==y&&(n.text=y.value.value);break;case"bar":if(c.view.content!==y){var E,I,M=y.value,A=M.normal,V=M.progress,T=y.basePoint,j=y.style,U=n.children[1],R=A.width.value,D=A.height.value,L=V.width.value,B=V.height.value;E=(R<=0||L<0?0:L>R?1:1*L/R)*m,I=(D<=0||B<0?0:B>D?1:1*B/D)*g;var F=T.x>0?T.x==m?T.x-E:T.x-E/2:T.x,W=T.y>0?T.y==g?T.y-I:T.y-I/2:T.y,N="clip"===j?U.mask.graphicsData[0].shape:U;N.x=F,N.y=W,N.width=E,N.height=I}}n.visible=p,i(n,r,a)}},{key:"getViewPathInfos",value:function(e,t){for(var n=_t.toArray(e),r=[],a=[null,null],o=t;n.length;){var i=n.shift();a[0]=i,o[i].instanceUuid&&r.push({instanceUuid:o[i].instanceUuid,path:a}),o=o[i],a=[null,a]}return r}},{key:"updateViewPathInfos",value:function(e,t){for(var n=!1,r=function(r){if(n)e[r].path[0]=-1;else{var a=e[r].path,o=(_t.get(t,a[1])||[]).findIndex(function(t){return t.instanceUuid===e[r].instanceUuid});-1===o&&(n=!0),e[r].path[0]=o}},a=0;a<e.length;a++)r(a);return e}},{key:"instanceView",value:function(t,n,r){var a=t.ref,o=n.viewMap,i=n.default_settings.color,u=Object.assign({},o[a]),c=S({instanceUuid:"lv_".concat(de())},t,{view:u,calledViews:[],visible:!0}),s=u.content;if("text"===u.type){var l=s.value;s=P()(s,{value:{$set:_e.parseValue(l,r)},color:{$apply:function(e){return e||i}}})}else if("bar"===u.type){var d=s.value,h=d.normal,f=d.progress;s=P()(s,{value:{normal:{width:{value:{$set:_e.safeEval(h.width,r)}},height:{value:{$set:_e.safeEval(h.height,r)}}},progress:{width:{value:{$set:_e.safeEval(f.width,r)}},height:{value:{$set:_e.safeEval(f.height,r)}}}}})}else if("input"===u.type){var p=s.value;s=P()(s,{value:{value:{$set:_e.safeEval(p,r)}}})}return P()(c,{x:{value:{$set:_e.safeEval(t.x,r)}},y:{value:{$set:_e.safeEval(t.y,r)}},view:{children:{$apply:function(t){return t.map(function(t){return e.instanceView(t,n,r)})}},content:{$set:s}}})}},{key:"fixInstanceView",value:function(t,n,r,a){var o=r.viewMap,i=n.x,u=n.y,c=n.events,s=n.ref,l=Object.assign({},o[s]),d=t.view.children,h=P()(l,{children:{$apply:function(t){return t.map(function(t){var n=d.find(function(e){return e.ref===t.ref});return n?e.fixInstanceView(n,t,r,a):e.instanceView(t,r,a)})}}});return P()(t,{x:{$set:i},y:{$set:u},events:{$set:c},view:{$set:h}})}},{key:"runEventInView",value:function(t,n,r,a){r=e.fixContext(r);var o=e.getViewPathInfos(n,r.viewContext),i=_t.get(r.viewContext,n),u=i.events,c=void 0===u?[]:u,s=i.view.events,l=void 0===s?[]:s,d=["back","jump","nextPlot","jumpOption","backOption","insertPlot"],h=function(t){return(o=e.updateViewPathInfos(o,t.viewContext))[o.length-1].path},f=function e(n,r,o){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=n[r];return n.length<=r?Promise.resolve(o):("onKeyUp"===t&&u.keyCode===a||"onKeyUp"!==t)&&u.type===t&&_e.safeEval(u.expression,o.playContext)?function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!n)return Promise.resolve(e);return function e(a,o){var i=n[o];return a.openPages.length||a.closePages.length||a.controlPlay?Promise.reject(a):n.length<=o?Promise.resolve(a):d.some(function(e){return e===i.type})?"onLoad"===t?e(a,o+1):Ft({event:i,path:h(a),isInnerEvent:r,context:a,events:n,index:o}).then(function(e){return Promise.reject(e)}):Ft({event:i,path:h(a),isInnerEvent:r,context:a,events:n,index:o}).then(function(t){return e(t,o+1)})}(e,0)}(o,u.events,i).then(function(t){return e(n,r+1,t,i)}):e(n,r+1,o,i)};return f(c,0,r).then(function(e){return f(l,0,e,!0)}).then(function(e){return e},function(e){return e}).then(function(n){switch(t){case"onLoad":var r=h(n),a=["children",["view",r]],o=_t.get(n.viewContext,a);if(r&&o&&o.length)return e.runOnLoadEventInViews(a,n);break;default:return e.runOnLoadEventInCalledUI(n)}return n})}},{key:"runOnLoadEventInViews",value:function(t,n){return function n(r,o){var i=[o,t],u=_t.get(r.viewContext,t)||[];if(u.length<=o)return Promise.resolve(r);if(_t.get(r.viewContext,i)){var c=e.getViewPathInfos(i,r.viewContext);return e.runEventInView("onLoad",i,r).then(function(r){var i=(c=e.updateViewPathInfos(c,r.viewContext))[c.length-1].path;if(t=i[1],~i[0])return n(r,i[0]+1);for(var s=_t.get(r.viewContext,t)||[],l=-1,d=function(e){if(-1!==(l=s.findIndex(function(t){return t.instanceUuid===u[e].instanceUuid})))return{v:n(r,l)}},h=o+1;h<u.length;h++){var f=d(h);if("object"===a(f))return f.v}return n(r,s.length)})}return n(r,o+1)}(n=e.fixContext(n),0)}},{key:"runOnLoadEvent",value:function(t,n){return function n(r,o){var i=[o,t],u=_t.get(r.viewContext,t);if(u.length<=o)return Promise.resolve(r);if(_t.get(r.viewContext,i)){var c=e.getViewPathInfos(i,r.viewContext);return e.runOnLoadEventInView(i,r).then(function(r){var i=(c=e.updateViewPathInfos(c,r.viewContext))[c.length-1].path;if(t=i[1],~i[0])return n(r,i[0]+1);for(var s=_t.get(r.viewContext,t)||[],l=-1,d=function(e){if(-1!==(l=s.findIndex(function(t){return t.instanceUuid===u[e].instanceUuid})))return{v:n(r,l)}},h=o+1;h<u.length;h++){var f=d(h);if("object"===a(f))return f.v}return n(r,s.length)})}return n(r,o+1)}(n=e.fixContext(n),0)}},{key:"runOnLoadEventInView",value:function(t,n){return n=e.fixContext(n),_t.get(n.viewContext,t)?(n=P()(n,{callUIRecordQueue:{$set:[]}}),e.runEventInView("onLoad",t,n).then(function(t){return e.runOnLoadEventInCalledUI(t)})):Promise.resolve(n)}},{key:"runOnLoadEventInCalledUI",value:function(t){var n=(t=e.fixContext(t)).callUIRecordQueue;return function t(r,a){if(n.length<=a)return r.callUIRecordQueue=[],Promise.resolve(r);var o=function(e,t){var n=null,r=function(t,n){var r=null;return t.instanceUuid===e.instanceUuid?n:(t.calledViews.length&&(r=a(t.calledViews,["calledViews",n])),!r&&t.view.children.length&&(r=a(t.view.children,["children",["view",n]])),r)},a=function(e,t){for(var n=null,a=0;a<e.length&&!n;a++)n=r(e[a],[a,t]);return n};return Object.keys(t).forEach(function(e){n||(n=a(t[e],[e,null]))}),n}(n[a].view,r.viewContext);return o?e.runEventInView("onLoad",o,r).then(function(e){return n.length!==e.callUIRecordQueue.length&&(n=n.concat(e.callUIRecordQueue.slice(n.length))),t(e,a+1)}):t(r,a+1)}(t,0)}},{key:"fixContext",value:function(e){return P()(e,{controlPlay:{$apply:function(e){return e||null}},openPages:{$apply:function(e){return e||[]}},closePages:{$apply:function(e){return e||[]}},controlAudio:{$apply:function(e){return e||{updateSounds:!1,sounds:new Array(10).fill({url:"inherit"}),stopMusic:!1,stopSound:!1}}},callUIRecordQueue:{$apply:function(e){return e||[]}}})}},{key:"runSpecialEvents",value:function(e,t){return function t(n,r){var a=e[r];return e.length<=r?Promise.resolve(n):Ft({event:a,path:[],isInnerEvent:!1,context:n,events:e,index:r}).then(function(e){return t(e,r+1)})}(t,0)}}]),e}(),Dt=!1,Lt=!1,Bt=!1,Ft=function(e){var t,n,r,a,o,i,c,s=e.event,l=e.path,d=e.isInnerEvent,h=void 0!==d&&d,f=e.context,p=e.events,v=e.index,m=s.type,g=s.handle,y=f.viewContext,w=f.playContext,_=f.controlAudio,k=f.controlPlay,O=f.game,E=f.openPages,A=f.callUIRecordQueue,V=f.closePages,T=f.handleShare,j=function(){var e=window.game.world,t=e.width,n=e.height,r=ft.rectMask({rect:{width:t,height:n},alpha:0});r.name="paymask",r.inputEnabled=!0,e.addChild(r)},R=function(){var e=window.game.world,t=e.getByName("paymask");t&&e.remove(t,!0)};switch(m){case"callUI":!function(){var e=O.viewMap,t=g.uuid,n=g.type,r=g.position,a=g.count,o=g.id;if("system"===n&&o)E=P()(E,{$push:[o]});else{var i=_e.safeEval(a,w);if(i=i<0?0:i>10?10:i,!((i=u.b.toInt(i))<=0)){for(var c=[],s=0;s<i;s++)if(e[t]){var d={ref:t,instanceUuid:"lv_".concat(de()),x:r.x,y:r.y,scale:1,events:[]},h=Rt.instanceView(d,O,w);c.push(h)}if(null===l[1][1]){var f=_t.stringify(l);y=f.indexOf("global")>=0?P()(y,{globalCalledViews:{$push:c}}):f.indexOf("menu")>=0?P()(y,{menuCalledViews:{$push:c}}):P()(y,{calledViews:{$push:c}})}else if("number"==typeof l[0]&&("children"===l[1][0]||"calledViews"===l[1][0])){var p="children"===l[1][0]?l[1][1][1]:l[1][1];if(!_t.get(y,p))return;var v=_t.createQuery(p,{calledViews:{$push:c}});y=P()(y,v)}A=P()(A,{$push:c.reduce(function(e,t){return[].concat(Object(b.a)(e),[{view:t}])},[])})}}}();break;case"reload":return function(){var e=[];["menuCalledViews","menuViews","calledViews","plotViews","globalCalledViews","globalViews"].forEach(function(t){!function t(n,r){return n.forEach(function(n,a){var o=[a,r],i=n.ref,u=n.view,c=n.calledViews,s=void 0===c?[]:c;if(i===g.uuid){var l=Rt.getViewPathInfos(o,y);e.push(l)}else"container"===u.type&&(t(u.children,["children",["view",o]]),t(s,["calledViews",o]))})}(f.viewContext[t],[t,null])});return function t(n,r){if(e.length<=r)return Promise.resolve(n);var a=n.callUIRecordQueue,o=n.playContext,i=n.viewContext,u=Rt.updateViewPathInfos(e[r],i),c=u[u.length-1].path;if(~c[0]){var s=_t.get(i,c),l=P()(i,_t.createQuery(c,{$set:Rt.instanceView(s,O,o)}));return Rt.runOnLoadEventInView(c,P()(n,{viewContext:{$set:l}})).then(function(e){return t(P()(e,{callUIRecordQueue:{$set:a}}),r+1)})}return t(n,r+1)}(f,0)}();case"refreshUI":o=O.viewMap,i=function e(t){for(var n=function(t){var n=t.ref,r=t.x,a=t.y,i=o[n],c=i.type,s=i.content,l={calledViews:{$apply:e},view:{children:{$apply:e}}};if(n!==g.uuid)return P()(t,l);if("text"===c){var d=s,h=d.value,f=d.color;Array.isArray(h)||(h=u.c.toArrayForData(h).map(function(e){return S({},e,{color:f})})),s=P()(s,{value:{$set:_e.parseValue(h,w)}})}else if("bar"===c){var p=s.value,v=p.normal,m=p.progress;s=P()(s,{value:{normal:{width:{value:{$set:_e.safeEval(v.width,w)}},height:{value:{$set:_e.safeEval(v.height,w)}}},progress:{width:{value:{$set:_e.safeEval(m.width,w)}},height:{value:{$set:_e.safeEval(m.height,w)}}}}})}else if("input"===c){var y=s.value;s=P()(s,{value:{value:{$set:_e.safeEval(y,w)}}})}return l=Object.assign(l,{view:{content:{$set:s}},x:{value:{$set:_e.safeEval(r,w)}},y:{value:{$set:_e.safeEval(a,w)}}}),P()(t,l)},r=0,a=t.length;r<a;r++)t=P()(t,x({},r,{$apply:n}));return t},c={globalViews:{$apply:i},plotViews:{$apply:i},calledViews:{$apply:i},globalCalledViews:{$apply:i},menuViews:{$apply:i},menuCalledViews:{$apply:i}},y=P()(y,c);break;case"closeUI":!function(){var e=g.type,t=g.id;if("system"===e&&t)V=P()(V,{$push:[t]});else{var n=null;if(g&&g.uuid){var r=function e(t){return t.map(function(t){return t.ref===g.uuid?null:P()(t,{calledViews:{$apply:e},view:{children:{$apply:e}}})}).filter(function(e){return null!==e})};y=P()(y,{globalViews:{$apply:r},plotViews:{$apply:r},calledViews:{$apply:r},globalCalledViews:{$apply:r},menuViews:{$apply:r},menuCalledViews:{$apply:r}})}else h?n=_t.createQuery(l[1],{$splice:[[l[0],1]]}):"number"==typeof l[0]&&"children"===l[1][0]&&(n=_t.createQuery(l[1][1][1][1],{$splice:[[l[1][1][1][0],1]]})),n&&_t.get(y,h?l:l[1][1][1])&&(y=P()(y,n))}}();break;case"setValue":return function(){if(!1!==Bt)return Promise.reject(f);Bt=!0;var e=Promise.resolve(w);return Dt||(e=Ut.updatePayValues(w,g.values)),e.then(function(e){return w=_e.setContextByValueHandles(e,g.values),Ut.uploadPayValues(w,g.values,Dt).then(function(e){return Dt&&!1===e&&(Ut.updatePayValueError=!0),Dt=!1,Bt=!1,P()(f,{playContext:{$set:w}})})})}();case"playMusic":_=P()(_,{music:{$set:g.music},stopMusic:{$set:!1}});break;case"stopMusic":_=P()(_,{stopMusic:{$set:!0}});break;case"playSound":_=P()(_,{updateSounds:{$set:!0},stopSound:{$set:!1}}),g.sounds&&g.sounds.forEach(function(e,t){return _=P()(_,{sounds:x({},t,{$apply:function(t){return e&&"inherit"===e.url?t:e}})})});break;case"stopSound":_=P()(_,{stopSound:{$set:!0}});break;case"back":case"jump":case"jumpOption":case"backOption":case"nextPlot":case"insertPlot":r=g.uuid,a=g.value,"jumpOption"!==m&&"backOption"!==m||(a=_e.safeEval(a,w)),k={type:m,control:{uuid:r,value:a}};break;case"openUrl":g.urlId;break;case"pay":return function(){if(Lt)return Promise.reject(f);Lt=!0;var e=C.a.gid,t=C.a.uuid,n=C.a.client,r=C.a.wap,a=C.a.isWapOther,o=C.a.qz_pindex,i=C.a.type,c=C.a.single,s=g.hasOwnProperty("values");if("zxwwap"===r)return I.a.info("商城功能尚未开启，是否前往闪艺抢先体验？").then(function(){window.location.href="https://wap.3000.com/?m=detail&op=index&ac=index&id=".concat(e)},function(){}),Lt=!1,Dt=!1,Promise.reject(f);if(1==i){var l=g.price,d=g.count,h=g.values;Lt=!1,Dt=!1;var m=u.c.typePayCount.findIndex(function(e){return e.uuid==g.uuid&&e.count>0})>-1;return-1!==d&&m?I.a.info("该商品只可购买一次！").then(function(){return Promise.reject(f)},function(){return Promise.reject(f)}):I.a.info("购买操作执行成功（闪币-".concat(_e.safeEval(l,w),"）,测试阶段不会扣除账户余额")).then(function(){var e,t,n=g.chapters,r=g.records;return n&&(e=u.c.typeUnlockChapters).push.apply(e,Object(b.a)(n)),r&&(t=u.c.typeUnlockRecords).push.apply(t,Object(b.a)(r)),h&&(w=_e.setContextByValueHandles(w,h)),-1!==d&&u.c.typePayCount.push({uuid:g.uuid,count:1}),s?P()(f,{playContext:{$set:w}}):f},function(){return Promise.reject(f)})}if("ios"!==n&&"android"!==n&&"wap"!==n&&"pc"!==n)return Lt=!1,Dt=!1,I.a.info("请前往APP或电脑端购买~").then(function(){return Promise.reject(f)},function(){return Promise.reject(f)});if("wap"===n&&"wx"===r)return I.a.custom("Info","请在应用商店下载闪艺app，阅读完整版作品","提示","知道了","取消",!1),Lt=!1,Dt=!1,Promise.reject(f);g.hasOwnProperty("records")||g.hasOwnProperty("chapters")||g.hasOwnProperty("values");var y=g.hasOwnProperty("values"),_=!1,k=g.uuid,S=g.price,O=g.count,E=void 0===O?-1:O,A=g.name,V=0,T=0,D=_e.safeEval(S,w),L=u.c.generateUUID(),B=n+L;Dt=!1;var F=function(){return R(),Lt=!1,Dt=!1,Promise.reject(f)},W=function(e){return"ios"!==n&&"android"!==n&&"wap"!==n&&"pc"!==n?Promise.resolve(!0):(t=e,De().then(function(){var e=C.a.client,n=C.a.v,r=C.a.u,a=C.a.token,o=C.a.gid,i=C.a.app_version,u=function(e,t){return Object(we.c)({url:e,data:t,timeout:4e3}).then(function(e){var t=e.responseText;if(0===t.length)return{status:"error",msg:"获取商品支付信息失败",count:0};var n=JSON.parse(t),r=n.status,a=n.success,o=n.data,i=n.msg;return 0===r&&a&&o?{status:"success",msg:i,count:o.count}:{status:"fail",msg:i,count:0}},function(e){return{status:"error",msg:"获取商品支付信息失败",count:0}})};return"ios"===e||"android"===e?u("".concat(Se.appGetGoodInfo,"&client=").concat(e,"&v=").concat(n,"&app_version=").concat(i),"u=".concat(Oe(r,1),"&token=").concat(Oe(a,1),"&event_id=").concat(Oe(t,1),"&game_id=").concat(Oe(o,1))):u(Se.wapGetGoodInfo,"event_id=".concat(Oe(t,3),"&game_id=").concat(Oe(o,3)))})).then(function(e){if(e&&"success"===e.status)return-1===E||1===E&&0===e.count||Promise.reject()},function(e){return Promise.resolve()});var t},N=function(e){return"pc"===n?Promise.resolve(e):Ut.updateAccinfo(e,function(e){V=e.usedStarCount,T=e.gameStarLimit}).then(function(e){return e})},$=function(e,t,n){return R(),0==e||void 0===e||-1===e?F():Promise.resolve(!0).then(function(r){if(Lt=!1,void 0!==r&&!1!==r){Dt=!0;var a=Promise.resolve(!0);return y&&!_&&(t=n,a=Ut.uploadPayValues(t,[],!0)),N(t).then(function(e){return a.then(function(t){return!1===t&&(Ut.updatePayValueError=!0),Promise.resolve(P()(f,{playContext:{$set:e}}))})},function(){return 2==parseInt(e)?t=P()(t,{systemValues:x({},1,{value:{$apply:function(e){return e-100*D}}})}):1==parseInt(e)&&(t=P()(t,{systemValues:x({},0,{value:{$apply:function(e){return e-D}}})})),a.then(function(e){return!1===e&&(Ut.updatePayValueError=!0),P()(f,{playContext:{$set:t}})})})}return Promise.reject()}).then(function(e){return e},F)};if(j(),"qzone"===r){var z=o||134;return(w.payValues[z].value||w.payValues[z].init.value)>=D?(w=P()(w,{systemValues:x({},z,{value:{$apply:function(e){return e-D}}})}),Promise.resolve(P()(f,{playContext:{$set:w}}))):(I.a.custom("Warn","闪币余额不足，快去分享获得闪币","温馨提示","分享","取消",!0).then(function(){return M.b.openShareMessageQzone()}),Promise.reject(f))}return ze().then(function(e){return!e||(I.a.info("内测作品，暂不支持购买~我们将在内测结束后清空数值。").then(function(){},function(){}),F())},function(){return Promise.resolve(!0)}).then(function(){return De().then(function(e){return!0},function(e){if(e){var t=e.msg,n=e.status;C.a.alpha?I.a.warn("内测作品，请登录内测账号试玩！").then(function(){return U.login()},function(e){return U.login()}):999===n?I.a.error("当前网络信号差，商城".concat(c?"":"、成就等账号","功能无法正常使用，请检查网络设置后，重新打开作品")).then(function(e){},function(e){}):I.a.error(t).then(function(){return U.login()},function(e){})}return F()}).then(function(e){return N(w)})}).then(function(e){return function(e){return Ut.updatePayValues(e,[],!0,!1,!0).then(function(e){return!0!==Ut.updatePayValueError?e:F()})}(e)}).then(function(e){return W(k).then(function(t){return!0!==t?(I.a.error("网络不稳定，请重试~").then(function(e){},function(e){}),F()):e},function(e){return window.game.gameResumed&&window.game.gameResumed(),I.a.info("该商品只可购买一次！").then(F,F)})}).then(function(e){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"app";return Fe(e,t,n,r).then(function(e){return{charge:e.charge,special_price:e.special_price||e.charge_pc,charge_app:e.charge_app}},function(e){return Promise.resolve({charge:S,special_price:-1,charge_app:-1})})}(t,null,k,"app").then(function(t){return function(e){var t=e;if(y){var n=g.values;t=_e.setContextByValueHandles(t,n);var r=p.filter(function(e,t){return"setValue"===e.type&&t>v});_=r.length>0}else p.filter(function(e,t){return"setValue"===e.type&&t>v}).forEach(function(e){t=_e.setContextByValueHandles(t,e.handle.values)});return Promise.resolve(t)}(e).then(function(n){return{playContext:e,newplayContext:n,disCounts:t}})})}).then(function(o){var i=o.newplayContext,c=o.disCounts,s=o.playContext,l=i.payValues,d=i.systemValues,h={gid:e,eid:k,charge:D,special_price:c.special_price,balance:d[0].value,starsNeed:100*D,stars:d[1].value,starsUsed:V,starsLimited:T,payValues:u.c.encodeBase64(JSON.stringify(l)),indentId:B};if(a)return"qh"===r?u.c.timeout(100).then(function(){return I.a.custom("Info","支付过程将导致作品重启。请确保您已存档。选择已存档将继续支付，未存档将前往存档界面","作品存档提示","已存档","未存档",!0).then(function(){return M.b.qhpay(D,k,L,"",i,1).then(function(){return $(0,s,i)})},function(e){return"cancel"===e&&window.showSave(),F()})}):$(0,s,i);if("pc"===n){var f=u.a.getCurDate(),p=D;-1!==c.special_price&&(p=c.special_price);var v=me.a.hash(t+p+f+"4shan3yi9xia9men"),m=me.a.hash(t+100*D+f+"4shan3yi9xia9men");h={uuid:t,eid:k,charge:D,charge_pc:c.special_price,charge_app:c.charge_app,time:f,token:v,payValues:u.c.encodeBase64(JSON.stringify(l)),name:A,callback:"mallPay",starToken:m,indentId:B}}return U.pay(h).then(function(e){return $(e,s,i)})}).catch(function(e){return F()})}();case"share":return t=s.handle.uuid,n=C.a.inviteViewName,T?u.c.timeout(100).then(function(){return T({isInvite:t===n,context:f})}):Promise.reject(f);case"playad":return function(){j();C.a.single,C.a.client,C.a.wap;var e=C.a.singleoffline;return U.singlePlayAd().then(function(t){return R(),1==t?e&&(w=P()(w,{systemValues:x({},0,{value:{$apply:function(e){return e+1}}})})):I.a.info("广告播放失败！"),P()(f,{playContext:{$set:w}})})}();case"loginout":I.a.info("确定退出当前账号么？").then(function(){return U.logout()},function(){});break;case"recharge":U.singleRecharge();break;default:console.error("error event type",s)}return Promise.resolve(P()(f,{playContext:{$set:w},viewContext:{$set:y},controlAudio:{$set:_},openPages:{$set:E},closePages:{$set:V},controlPlay:{$set:k},callUIRecordQueue:{$set:A}}))},Wt=null,Nt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Wt?Wt.update(e):Wt=new $t(e)},$t=function(){function e(t){var n=this,r=t.callbacks,a=t.gameJson;Object(o.a)(this,e),x(this,"handleButtonClick",function(e,t){if(t.pointerMode!==Phaser.PointerMode.CURSOR||0===t.button){n.container;"cover_button_start"===e.parent.name?(n.callbacks&&n.callbacks.start&&n.callbacks.start(),n.close()):"cover_button_load"===e.parent.name?n.callbacks&&n.callbacks.load&&n.callbacks.load():"cover_button_settings"===e.parent.name?n.callbacks&&n.callbacks.settings&&n.callbacks.settings():"cover_button_over"===e.parent.name&&(n.callbacks&&n.callbacks.over&&n.callbacks.over(),U.gameQuit())}}),this.callbacks=r,this.container=ft.group(),this.render(a),game.onRestart.add(function(){return n.close()})}return Object(i.a)(e,[{key:"update",value:function(e){var t=e.callbacks;return this.callbacks=t,this.container.visible=!0,this}},{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"render",value:function(e){var t=this,n=e.template,r=e.cover,a=e.default_settings,o=n.json.cover,i=o.titleContainer,u=o.startMenu,c=o.loadMenu,s=o.settingsMenu,l=o.overMenu,d=function(e,n,r){var a=e.rect,o=e.normal,i=e.active;if(!e.hidden){var u={name:n,normalUrl:o.background.url,activeUrl:i.background.url,onClick:t.handleButtonClick,textOptions:{normal:S({},o.text,{text:r}),active:S({},i.text,{text:r})},audio:{url:$.buttonSoundUrl,volume:1}};t.container.add(ft.button(a,u))}},h=r.title,f=h.data,p=h.font_size,v=h.color,m=h.bold,g=h.fontFamily,y=void 0===g?a.fontFamily:g;if(!h.hidden||!f){var w=i.title,b=w.rect,_=w.text,x=_.color,k=_.fontSize,P=i.rect;this.container.add(ft.text(S({},b,{x:b.x+P.x,y:b.y+P.y}),{text:f,color:v||x,fontWeight:m?"bold":"normal",fontSize:p||k,fontFamily:y,boundsAlignH:"center",boundsAlignV:"bottom"}))}d(u,"cover_button_start","开始"),d(c,"cover_button_load","读档"),d(s,"cover_button_settings","设置"),d(l,"cover_button_over","结束")}}]),e}(),zt=null,Ht=0,qt=0,Gt=["settings_button_fullMode","settings_button_windowMode"],Kt=["settings_button_autoOn","settings_button_autoOff"],Jt=navigator.userAgent,Qt=/MicroMessenger/gi.test(Jt),Yt=/QQ/gi.test(Jt),Zt=function(){function e(t){var n=this,r=t.callback,a=t.template;Object(o.a)(this,e),x(this,"handleClick",function(e,t){if(t.pointerMode!==Phaser.PointerMode.CURSOR||0===t.button){var r=n.container,a=C.a.client,o=function(e,t){return t.forEach(function(t){return r.getByName(t).check(e===t)})};e.parent.name===Gt[0]?(o(Gt[0],Gt),U.isAppClient()||Qt||Yt||"pc"===a||game.scale.startFullScreen(!0),"pc"===a&&!0!==$.full&&U.fullScreenFromPc(),$.full=!0):e.parent.name===Gt[1]?(o(Gt[1],Gt),U.isAppClient()||Qt||Yt||"pc"===a||game.scale.stopFullScreen(),"pc"===a&&!1!==$.full&&U.exitFullScreenFromPc(),$.full=!1):e.parent.name===Kt[0]?(o(Kt[0],Kt),$.autoPlay=!0):e.parent.name===Kt[1]?(o(Kt[1],Kt),$.autoPlay=!1):"settings_button_back"===e.parent.name&&(n.hasProgress&&U.switchAppBack(!0),n.close(),n.backCallback&&n.backCallback())}});C.a.vertical;var i=C.a.client;if(this.container=ft.group(),"pc"===i){var c=window.innerWidth||window.documentElement.clientWidth||window.document.body.clientWidth,s=window.innerHeight||window.documentElement.clientHeight||window.document.body.clientHeight,l=Math.min(c,s),d=Math.max(c,s);$.full=l>window.originalWidth||d>window.originalHeight}this.render(a.json.settings),this.update({callback:r}),U.setCallback("setAttribute",function(e){var t=e.width,r=e.height;Ht==t&&qt==r||(Ht=t,qt=r,u.c.timeout(50).then(function(){var e=window.innerWidth||window.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.documentElement.clientHeight||window.document.body.clientHeight,r=Math.min(e,t),a=Math.max(e,t);$.full=r>window.originalWidth||a>window.originalHeight;var o,i=n.container;o=Gt[$.full?0:1],Gt.forEach(function(e){return i.getByName(e).check(o===e)})}))}),game.onRestart.add(function(){return n.close()})}return Object(i.a)(e,[{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"update",value:function(e){var t=e.callback;this.hasProgress&&U.switchAppBack(!1),this.container.visible=!0,this.backCallback=t;var n=this.container.getByName(Gt[0]),r=this.container.getByName(Gt[1]),a=this.container.getByName(Kt[0]),o=this.container.getByName(Kt[1]),i=this.container.getByName("music_progress"),u=this.container.getByName("sound_progress"),c=$.musicVolume,s=$.soundVolume,l=$.full,d=$.autoPlay;return n&&n.check(l),r&&r.check(!l),a&&a.check(d),o&&o.check(!d),i&&(i.mask.width=c<=0?.01:c*i.width),u&&(u.mask.width=s<=0?.01:s*u.width),this}},{key:"addProgressEventHandle",value:function(e,t,n){var r=this,a=game,o=a.input,i=a.world,u=t.x,c=t.width,s=function(e){return e<0&&(e=0),e>1&&(e=1),e},l=function(t){var r=(t=s(t))<=0?.01:t*c;n.graphicsData[0].shape.width=r,"music_progress"===e.name?re.updateMusicVolume(t):re.updateSoundsVolume(t)},d=function(e){return l(((i.angle?e.y:e.x)-u)/c)};e.events.onInputDown.add(function(e,t){var n=Math.abs(i.angle?t.y:t.x);l((n-u)/c),o.addMoveCallback(d,r)},this),e.events.onInputUp.add(function(e,t){var n=Math.abs(i.angle?t.y:t.x);l(s((n-u)/c)),o.deleteMoveCallback(d,r)},this)}},{key:"renderProgress",value:function(e,t,n,r){var a=game.load.cache;t=a.checkImageKey(t)?t:"",n=a.checkImageKey(n)?n:"",this.container.add(ft.image(t,r));var o=ft.image(n,r);o.name="".concat(e,"_progress"),o.inputEnabled=!0,this.container.add(o);var i=ft.rectMask({color:16773120,alpha:.5,rect:S({},r)});return this.container.add(i),o.mask=i,this.addProgressEventHandle(o,r,i),o}},{key:"render",value:function(e){var t=this,n=e.background,r=e.header,a=e.displayHeader,o=e.textHeader,i=e.displayCaption,u=e.textCaption,c=e.fullMode,s=e.windowMode,l=e.autoOn,d=e.autoOff,h=e.back,f=e.musicCaption,p=e.musicVolume,v=e.soundCaption,m=e.soundVolume,g=e.volumeHeader,y=game.world,w=y.width,b=y.height,_=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=e.rect,a=e.background.url,o=e.title,i=ft.group();if(a&&i.add(ft.image(a,S({},r,{x:0,y:0}))),o&&!o.text.hidden){var u=o.rect,c=u.x,s=u.y,l=u.width,d=u.height;i.add(ft.text({x:c+r.x,y:s+r.y,width:l,height:d},S({},o.text,{text:n,boundsAlignH:"center",boundsAlignV:"middle"})))}e.text&&!e.text.hidden&&i.add(ft.text(S({},r,{x:0,y:0}),S({},e.text,{text:n,boundsAlignH:"center",boundsAlignV:"middle"})));var h=ft.rectMask({alpha:0,rect:S({},r,{x:0,y:0})});i.mask=h,i.add(h),i.x=r.x,i.y=r.y,t.container.add(i)},x=function(e,n,r){var a=e.rect,o=e.checked,i=e.unchecked,u=e.hidden;if(!(void 0!==u&&u)){var c={name:n,checkedUrl:o.background.url,uncheckedUrl:i.background.url,onClick:t.handleClick,textOptions:{checked:S({},o.text,{text:r}),unchecked:S({},o.text,{text:r})}};t.container.add(ft.checkbox(a,c))}},k=ft.image(n.url,{x:0,y:0,width:w,height:b});if(k.inputEnabled=!0,this.container.add(k),_(r,"设置"),!a.hidden&&_(a,"显示设定"),!o.hidden&&_(o,"文字设定"),_(i,"画面模式"),_(u,"自动进行"),x(c,Gt[0],"全屏模式"),x(s,Gt[1],"窗口模式"),x(l,Kt[0],"开"),x(d,Kt[1],"关"),function(e,n,r){var a=e.rect,o=e.normal,i=e.active;if(!e.hidden){var u={name:n,normalUrl:o.background.url,activeUrl:i.background.url,onClick:t.handleClick,textOptions:{normal:S({},o.text,{text:r}),active:S({},i.text,{text:r})},audio:{url:$.buttonSoundUrl,volume:1}};t.container.add(ft.button(a,u))}}(h,"settings_button_back","返回"),f&&_(f,"音乐音量"),p){this.hasProgress=!0;var P=p.normal,C=p.progress,O=p.rect;this.renderProgress("music",P.background.url,C.background.url,O)}if(v&&_(v,"音效音量"),m){this.hasProgress=!0;var E=m.normal,I=m.progress,M=m.rect;this.renderProgress("sound",E.background.url,I.background.url,M)}g&&_(g,"音量设置")}}]),e}(),Xt=null,en=function(){function e(t){var n=this,r=t.callbacks,a=t.template;Object(o.a)(this,e),x(this,"handleClick",function(e,t){if(t.pointerMode!==Phaser.PointerMode.CURSOR||0===t.button){var r=function(e){n.close(),n.callbacks&&n.callbacks[e]&&n.callbacks[e]()};"mainMenu_button_save"===e.parent.name?r("save"):"mainMenu_button_load"===e.parent.name?r("load"):"mainMenu_button_playback"===e.parent.name?r("playback"):"mainMenu_button_autoplay"===e.parent.name?($.autoPlay=!$.autoPlay,r("autoplay")):"mainMenu_button_settings"===e.parent.name?r("settings"):"mainMenu_button_back"===e.parent.name&&r("back")}}),this.callbacks=r,this.container=ft.group(),this.render(a.json.mainMenu),game.onRestart.add(function(){return n.close()})}return Object(i.a)(e,[{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"update",value:function(e){var t=e.callbacks;return this.autoPlay&&this.autoPlay.setText($.autoPlay?"手动播放":"自动播放"),this.callbacks=t,this.container.visible=!0,this}},{key:"render",value:function(e){var t,n,r,a=this,o=e.background,i=e.header,u=e.save,c=e.load,s=e.playback,l=e.settings,d=e.autoplay,h=e.back,f=game.world,p=f.width,v=f.height,m=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e||!e&&n){var r=ft.image(e,t);r.inputEnabled=n,a.container.add(r)}},g=function(e,t,n){var r=e.rect,o=e.normal,i=e.active;if(!e.hidden){var u={name:t,normalUrl:o.background.url,activeUrl:i.background.url,onClick:a.handleClick,textOptions:{normal:S({},o.text,{text:n}),active:S({},i.text,{text:n})},audio:{url:$.buttonSoundUrl,volume:1}},c=ft.button(r,u);return a.container.add(c),c}};m(o.url,{x:0,y:0,width:p,height:v},!0),m(i.background.url,i.rect),t=i.title.rect,n=S({},i.title.text,{text:"菜单"}),(r=ft.text(t,S({},n,{boundsAlignH:"center",boundsAlignV:"middle"})))&&a.container.add(r),g(u,"mainMenu_button_save","保存进度"),g(c,"mainMenu_button_load","读取进度"),g(s,"mainMenu_button_playback","剧情回放"),this.autoPlay=g(d,"mainMenu_button_autoplay","自动播放"),g(l,"mainMenu_button_settings","设置"),g(h,"mainMenu_button_back","返回")}}]),e}(),tn=null,nn=function(){function e(t){var n=this,r=t.callback,a=t.template,i=t.records,u=void 0===i?[]:i;Object(o.a)(this,e),x(this,"handleClick",function(e,t){t.pointerMode===Phaser.PointerMode.CURSOR&&0!==t.button||"playback_button_back"===e.parent.name&&(n.close(),n.backCallback&&n.backCallback())}),this.records=u,this.backCallback=r,this.container=ft.group(),this.render(a.json.playback),this.update({callback:r,records:u,template:a}),game.onRestart.add(function(){return n.close()})}return Object(i.a)(e,[{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"update",value:function(e){var t=e.callback,n=e.records,r=e.template;return this.itemHeight=r.json.playback.scrollBox.item.rect.height,this.records=n,this.backCallback=t,this.container.visible=!0,this.scrollPane.scrollY(-this.itemHeight*n.length),this}},{key:"updateItems",value:function(e){for(var t=this,n=0;e>(n+1)*this.itemHeight;)n++;var r=this.records.length;this.items.forEach(function(e,a){e.visible=n<r,e.y=n*t.itemHeight,e.getByName("text").setTexts(u.c.toArrayForData(n<r&&t.records[n]||"")),n++})}},{key:"renderItems",value:function(e,t){this.items=[];for(var n=e.rect,r=e.content,a=e.background,o=r.text,i=Math.round(t/n.height)+2,u=function(){var e=n.x+r.rect.x,t=n.y+r.rect.y,i=ft.group();i.add(ft.image(a.url,S({},n,{x:0,y:0})));var u=ft.image(r.background.url,S({},r.rect,{x:e,y:t}));i.add(u);var c=ft.textarea({x:e,y:t,width:r.rect.width,height:r.rect.height},S({},o,{forceFontFamily:"宋体",boundsAlignH:"left",boundsAlignV:"top"}));return c.name="text",c.mask=ft.rectMask({rect:S({},r.rect)}),i.add(c),i.add(c.mask),i},c=0;c<i;c++){var s=u();s.x=n.x,s.y=n.y+n.height*c,this.items.push(s),this.scrollPane.addChild(s)}}},{key:"renderScrollBox",value:function(e){var t=this,n=C.a.vertical,r=e.rect,a=e.item,o=ft.sprite(r);this.container.add(o);var i=a.rect.height,u=r.x,c=r.y,s=r.width,l=r.height;o.scrollY=function(e){e=e+.5|0;var n=t.records.length*i;o.y=n<l?c:e>c?c:e+n<c+l?c+l-n:e,t.updateItems(c-o.y)};var d=function(e){var t,r,a=e.worldX,o=e.worldY,i=game.world.angle;if(n&&90===i||!n&&0===i){var d=n?[o,-a]:[a,o],h=Object(_.a)(d,2);t=h[0],r=h[1]}else{var f=n?[a,o]:[o,-a],p=Object(_.a)(f,2);t=p[0],r=p[1]}return r<c||r>c+l||t<u||t>u+s?null:{x:t,y:r}};o.inputEnabled=!0;var h=o.input,f=o.events;h.enableDrag(),h.allowHorizontalDrag=!1,f.onDragUpdate.add(function(e,t,n,r,a,i){return o.scrollY(r)},this),f.onInputDown.add(function(e,t,n,r){return d(t)?e.input.enableDrag():e.input.disableDrag()});var p=!1,v=function(e){var t=e.wheelDelta?e.wheelDelta/120:-e.detail/3;o.scrollY(o.y+100*t)};game.input.addMoveCallback(function(e,t,n){var r=d(e),a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";!r&&p?(document.removeEventListener(a,v),p=!1):r&&!p&&(document.addEventListener(a,v),p=!0)},this);var m=ft.rectMask({color:16777215,rect:r});this.container.add(m),o.mask=m,this.scrollPane=o,this.renderItems(a,r.height)}},{key:"render",value:function(e){var t=this,n=e.scrollBox,r=e.back,a=e.background,o=game.world,i=o.width,u=o.height,c=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e||!e&&r){var a=ft.image(e,n);a.inputEnabled=r,t.container.add(a)}};c(a.url,{x:0,y:0,width:i,height:u},!0),c(n.background.url,n.rect),this.renderScrollBox(n),function(e,n,r){var a=e.rect,o=e.normal,i=e.active;if(!e.hidden){var u={name:n,normalUrl:o.background.url,activeUrl:i.background.url,onClick:t.handleClick,textOptions:{normal:S({},o.text,{text:r}),active:S({},i.text,{text:r})},audio:{url:$.buttonSoundUrl,volume:1}};t.container.add(ft.button(a,u))}}(r,"playback_button_back","返回")}}]),e}(),rn=["record_check_local","record_ckeck_cloud"],an=C.a.isWapOther||"zxwwap"===C.a.wap||1==C.a.type||"wx"===C.a.wap&&"wap"===C.a.client,on=0,un=null,cn=function(){function e(t){var n=this,r=t.mode,a=void 0===r?"load":r,i=t.callback,c=t.gameJson,s=t.getLocal,l=t.getCloud,d=t.clickRecord,h=t.lockRecord,f=t.getPlayContext;Object(o.a)(this,e),x(this,"handleClick",function(e,t){if(t.pointerMode!==Phaser.PointerMode.CURSOR||0===t.button){var r=n.container,a=function(e,t){n.checked=t,rn.forEach(function(e){return r.getByName(e)&&r.getByName(e).check(t===e)}),o(),n.updateRecords(e)},o=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.loadingTipText.setText("加载存档中..."),n.loadingTip.visible=n.state.getting=e};if("record_button_back"===e.parent.name)n.close(),n.backCallback&&n.backCallback();else if(e.parent.name!==rn[0]||n.state.getting){if(e.parent.name===rn[1]&&!n.state.getting){if(!n.clickInterval(1))return void Et({type:Ot,text:"操作太频繁，稍后重试~"});on=u.a.passSeconds,o(!0),n.getCloud(!0).then(function(e){n.lockVector=[],n.getlock().then(function(t){var r;(r=n.lockVector).push.apply(r,Object(b.a)(t)),a(e,rn[1])})},function(){return o()})}}else{if(!n.clickInterval(1))return void Et({type:Ot,text:"操作太频繁，稍后重试~"});on=u.a.passSeconds,n.checkUserAlpha("内测期间，暂不支持本地存储").then(function(){o(!0),n.getLocal().then(function(e){return a(e,rn[0])},function(){return o()})})}}}),x(this,"clickInterval",function(e){return 0==on?(on=u.a.passSeconds,!0):u.a.passSeconds-on>=e}),x(this,"checkUserAlpha",function(e){return ze().then(function(t){return!t||(I.a.info(e).then(function(){},function(){}),Promise.reject())},function(){return Promise.resolve(!0)})}),this.container=ft.group(),this.autoSaveOrLoad=c.default_settings.autoSaveOrLoad,this.backCallback=i,this.getLocal=s,this.getCloud=l,this.clickRecord=d,this.getlock=h,this.getPlayContext=f,this.checked=null,this.owner=C.a.uid,this.lockVector=[],this.testLockVector=[],this.state={mode:a,getting:!1},this.records=[];var p=C.a.vertical,v=c.template.json.record.scrollBox.column;this.row=p?12:void 0!==v?12/v:3,this.column=p?1:void 0!==v?v:4,this.render(c),this.getRecords(),game.onRestart.add(function(){return n.close()})}return Object(i.a)(e,[{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"getRecords",value:function(){var e=this;this.loadingTipText.setText("加载存档中..."),this.loadingTip.visible=this.state.getting=!0;var t=function(t,n){e.loadingTip.visible=!1,e.checked=n,rn.forEach(function(t){return e.container.getByName(t)&&e.container.getByName(t).check(n===t)}),e.state.getting=!1,e.updateRecords(t)};this.getlock().then(function(n){var r;(r=e.lockVector).push.apply(r,Object(b.a)(n));var a=function(){return e.getLocal().then(function(e){return t(e,rn[0])})};!an&&e.showGuide(),an||e.checked!==rn[1]&&null!==e.checked?a():e.getCloud().then(function(e){return t(e,rn[1])},a)})}},{key:"update",value:function(e){var t=this,n=e.mode,r=void 0===n?"load":n,a=e.callback,o=e.getLocal,i=e.getCloud,u=e.clickRecord,c=e.lockRecord,s=e.getPlayContext,l=C.a.client,d=C.a.wap,h=Promise.resolve();return"wap"===l?"wx"!==d&&(h=je()):"pc"===l&&(h=Ue().then(function(){return!0},function(){return!1})),h.then(function(e){var n=C.a.uid,l=t.owner!=n;t.records=[],1==e&&l&&(t.checked=null),t.state={mode:r,getting:!1},t.owner=n,t.backCallback=a,t.getLocal=o,t.getCloud=i,t.clickRecord=u,t.getlock=c,t.getPlayContext=s,t.lockVector=[],t.container.visible=!0,t.getRecords()}),this}},{key:"showGuide",value:function(){var e=this,t=game,n=t.world,r=t.cache,a=U.localStorageGetItem("shanyi3000guide")||"",o=""==a?null:JSON.parse(a),i=function(){return r.checkKey(Phaser.Cache.IMAGE,"Cloud_record_tip")&&r.removeImage("Cloud_record_tip"),e.showGuide=function(){return Promise.resolve()},e.showGuide()};if(o&&o.count>10)return i();U.localStorageSetItem("shanyi3000guide",JSON.stringify({count:(o&&o.count||0)+1}));var u=n.width,c=n.height;return new Promise(function(t,n){var r=ft.image("Cloud_record_tip",{x:u/2,y:c/2,centre:!0});r.inputEnabled=!0,e.container.add(r);r.events.onInputUp.add(function n(a,o){o&&o.pointerMode===Phaser.PointerMode.CURSOR&&0!==o.button||(H.to({target:r,properties:{alpha:0},duration:1e3}).then(function(){e.container.remove(r,!0),i().then(function(){return t()})}),r.events.onInputUp.remove(n,e))},e)})}},{key:"handleRecordClick",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.state.mode,a=n*this.column+t,o=this.checked===rn[0];if(!(this.autoSaveOrLoad&&"save"===r&&!a||this.state.getting)){var i=this.getRecordItem(a),c=(this.container,function(t){s(),e.updateRecords(t)}),s=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.loadingTipText.setText("load"===r?"加载存档中...":"保存档案中..."),e.loadingTip.visible=e.state.getting=t};("load"===r?Promise.resolve():new Promise(function(e,t){i&&1==i.lock?t():e()})).then(function(){if("load"===r&&e.records[a]&&Object.keys(e.records[a]).length)e.clickRecord(r,a,o).then(function(){return e.close()});else if("save"===r){if(!e.clickInterval(2))return void Et({type:Ot,text:"存档操作太频繁，稍后重试~"});var t=!1;on=u.a.passSeconds,s(!0),e.clickRecord(r,a,o).then(function(){return o?e.getLocal():e.getCloud()},function(){return t=!0}).then(function(e){return c(e)},function(){return c()}).then(function(e){return!t&&Et({type:St,text:"存档成功，下次可以从这里读档继续哦~"})},function(e){t||Et(o?{type:Ot,text:"存档失败，".concat(e)}:{type:Ot,text:"存档失败，请检查您的网络哦~"})})}},function(){var t=C.a.client,n=C.a.wap,r=C.a.gid,o=C.a.uuid,c=C.a.type,s=0,l=0,d=e.getPlayContext(),h=u.c.generateUUID(),f=t+h,p=i.price;if(1!=c)if("zxwwap"!==n)if("ios"===t||"android"===t||"wap"===t||"pc"===t)if("wap"!==t||"wx"!==n){var v=function(){var e=window.game.world,t=e.getByName("paymask");t&&e.remove(t,!0)};e.checkUserAlpha("内测作品，暂不支持购买~我们将在内测结束后清空数值。").then(function(){return De().then(function(e){return!0},function(e){if(e){var t=e.msg,n=e.status;C.a.alpha?I.a.warn("内测作品，请登录内测账号试玩！").then(function(){return U.login()},function(e){return U.login()}):999===n?I.a.error("当前网络信号差，商城、成就等账号功能无法正常使用，请检查网络设置后，重新打开作品").then(function(e){},function(e){}):I.a.error(t).then(function(){return U.login()},function(e){})}return Promise.reject()}).then(function(){var n,c,h,m;n=window.game.world,c=n.width,h=n.height,(m=ft.rectMask({rect:{width:c,height:h},alpha:0})).name="paymask",m.inputEnabled=!0,n.addChild(m),function(e){return"pc"===t?Promise.resolve(e):Ut.updateAccinfo(e,function(e){s=e.usedStarCount,l=e.gameStarLimit}).then(function(e){return e})}(d).then(function(e){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"app";return Fe(e,t,n,r).then(function(e){return{charge:e.charge,special_price:e.special_price||e.charge_pc,charge_app:e.charge_app}},function(e){return Promise.resolve({charge:p,special_price:-1,charge_app:-1})})}(o,null,i.uuid,"app").then(function(t){return{playContext:e,disCounts:t}})}).then(function(n){var c=n.disCounts,d=n.playContext.systemValues,h={};if("pc"===t){var m=u.a.getCurDate(),g=p;-1!==c.special_price&&(g=c.special_price);var y=me.a.hash(o+g+m+"4shan3yi9xia9men"),w=me.a.hash(o+100*p+m+"4shan3yi9xia9men");h={uuid:o,eid:i.uuid,charge:p,charge_pc:c.special_price,charge_app:c.charge_app,time:m,token:y,payValues:"",name:"档位",callback:"mallPay",starToken:w,indentId:f}}else"ios"!==t&&"android"!==t&&"wap"!==t||(h={gid:r,eid:i.uuid,charge:p,special_price:c.special_price,balance:d[0].value,starsNeed:100*p,stars:d[1].value,starsUsed:s,starsLimited:l,payValues:"",indentId:f});U.pay(h).then(function(t){if(1==t||2==t){e.renderLock(e.getRecordItem(a));e.lockVector=function(e,t){for(var n=[],r=function(r){var a=t[r];n.push(e.filter(function(e){return e.uuid==a}))},a=0;a<t.length;a++)r(a);return e.concat.apply(e,n).filter(function(e,t,n){return n.indexOf(e)===n.lastIndexOf(e)})}(e.lockVector,[i.uuid])}v()})}).catch(function(e){return v()})},function(){return v()})}).catch(function(e){return v()})}else I.a.custom("Info","请在应用商店下载闪艺app，阅读完整版作品","提示","知道了","取消",!1);else I.a.info("请前往APP或电脑端购买~").then(function(){},function(){});else I.a.info("商城功能尚未开启，是否前往闪艺抢先体验？").then(function(){window.location.href="https://wap.3000.com/?m=detail&op=index&ac=index&id=".concat(r)},function(){});else I.a.info("购买存档操作（闪币-".concat(p,"）,测试阶段不会扣除账户余额")).then(function(){e.renderLock(e.getRecordItem(a)),u.c.typeUnlockRecords.push(i.uuid)})})}}},{key:"updateRecords",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=game.cache,r=this.state.mode;t.forEach(function(t,a){var o=Math.floor(a/e.column),i=Math.floor(a%e.column),c=e.items[o][i];"save"!==r||(0==o&&0==i||!e.autoSaveOrLoad)&&e.autoSaveOrLoad||(e.lockVector.some(function(e){return e.uuid==c.uuid})?e.renderLock(c,c.rect):e.renderLock(c)),"load"===r&&e.renderLock(c);var s=c.getByName("content"),l=c.getByName("time"),d=s.width,h=s.height,f=function(e){s.loadTexture(e),s.width=d,s.height=h};if(!t)return l.setText(""),void f(e.defaultItemUrl);var p=t.thumb,v=t.timestamp,m=p.indexOf("coverran")>-1,g=me.a.hash(p);if(n.checkImageKey(g))f(g);else{var y=new Image;m&&y.setAttribute("crossOrigin","anonymous"),y.src=p,y.onload=function(e){n.checkImageKey(g)||n.addImage(g,p,e.target),f(g)}}l.setText(u.a.format(v))}),this.records=t}},{key:"renderRecords",value:function(e,t){var n=t.itemSpaceX,r=void 0===n?20:n,a=t.itemSpaceY,o=void 0===a?12:a,i=e.rect,u=e.background,c=e.content,s=e.hint,l=i.x,d=i.y,h=i.height,f=i.width,p=this.row,v=this.column;this.items=[],this.defaultItemUrl=c.background.url;for(var m=0,g=0;g<p;g++){this.items[g]=[];for(var y=0;y<v;y++){var w=ft.group();w.x=y*(f+r)+l,w.y=g*(h+o)+d,w.id=m,m++,w.rect={x:w.x,y:w.y,width:f,height:h};var b=$.records[w.id];w.uuid=b?b.uuid:"",w.price=b?b.price:0,w.lock=!1,w.add(ft.image(u.url,{height:h,width:f}));var _=ft.image(c.background.url,S({},c.rect,{name:"content"}));w.add(_);var x=ft.text(s.rect,S({},s.text,{name:"time",boundsAlignH:"center",boundsAlignV:"middle"}));x&&w.add(x);var k=ft.rectMask({rect:{height:h,width:f}});if(w.addChild(k),w.mask=k,this.autoSaveOrLoad&&!g&&!y){var P=ft.rectMask({rect:{height:h,width:f},alpha:.4});w.addChild(P),w.addChild(ft.text({x:0,y:0,height:h,width:f},{fontSize:16,color:"white",fontFamily:"Microsoft YaHei",text:"自动存档",boundsAlignH:"center",boundsAlignV:"middle"}))}this.scrollPane.addChild(w),this.items[g][y]=w}}}},{key:"renderLock",value:function(e,t){if(e){var n=!t,r=e.getByName("lockmask"),a=e.getByName("locktext"),o=e.getByName("locakimg");if(n)o&&e.remove(o,!0),r&&e.remove(r,!0),a&&e.remove(a,!0),e.lock=!1;else{var i=t.width,u=t.height;r||((r=ft.rectMask({rect:{height:u,width:i},alpha:.8})).name="lockmask",e.addChild(r)),o||((o=ft.image("lock",{x:i/2,y:u/2-30,centre:!0})).name="locakimg",e.addChild(o)),a||((a=ft.text({x:0,y:20,height:u,width:i},{fontSize:16,color:"white",forceFontFamily:"Microsoft YaHei",text:"".concat(e.price,"闪币解锁"),boundsAlignH:"center",boundsAlignV:"middle"})).name="locktext",e.addChild(a)),e.lock=!0}}}},{key:"getRecordItem",value:function(e){var t,n=0;for(t=0;t<this.items.length;t++)for(n=0;n<this.items[t].length;n++){var r=this.items[t][n];if(r.id==e)return r}return null}},{key:"renderScrollBox",value:function(e){var t=this,n=C.a.vertical,r=e.rect,a=e.item,o=e.itemsOffsetX,i=void 0===o?0:o,u=e.itemsOffsetY,c=void 0===u?0:u,s=e.itemSpaceX,l=void 0===s?20:s,d=e.itemSpaceY,h=void 0===d?12:d,f=r.x,p=r.y,v=r.width,m=r.height,g=a.rect,y=g.height,w=g.width,b=f+i,x=p+c,k=ft.sprite({x:b,y:x});this.container.add(k);var P=y*this.row+h*(this.row-1),S=!1;k.scrollY=function(e){e=e+.5|0,null!=M&&Math.abs(k.y-M)>5&&(S=!0),k.y=e>x||P<=m?x:e+P<p+m?p+m-P:e};var O=function(e){var t,r,a=e.worldX,o=e.worldY,i=game.world.angle;if(n&&90===i||!n&&0===i){var u=n?[o,-a]:[a,o],c=Object(_.a)(u,2);t=c[0],r=c[1]}else{var s=n?[a,o]:[o,-a],l=Object(_.a)(s,2);t=l[0],r=l[1]}return r<x||r>x+m||t<b||t>b+v?null:{x:t,y:r}};k.inputEnabled=!0;var E=k.input,I=k.events;E.enableDrag(),E.allowHorizontalDrag=!1;var M=null;I.onDragUpdate.add(function(e,t,n,r,a,o){return k.scrollY(r)},this),I.onDragStart.add(function(e,t,n,r,a,o){return M=k.y},this),I.onDragStop.add(function(e,t,n,r,a,o){return M=k.y},this),I.onInputDown.add(function(e,t,n,r){S=!1,O(t)?e.input.enableDrag():e.input.disableDrag()}),I.onInputUp.add(function(e,n){var r=O(n);if(!S&&r&&(n.pointerMode!==Phaser.PointerMode.CURSOR||0===n.button)){var a=r.x-k.x,o=r.y-k.y,i=w+l,u=y+h;a%i<w&&o%u<y&&a<=T&&t.handleRecordClick(Math.floor(a/i),Math.floor(o/u))}},this);var A=!1,V=function(e){var t=e.wheelDelta?e.wheelDelta/120:-e.detail/3;k.scrollY(k.y+100*t)};game.input.addMoveCallback(function(e,t,n){var r=O(e),a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";!r&&A?(document.removeEventListener(a,V),A=!1):r&&!A&&(document.addEventListener(a,V),A=!0)},this);var T=v-i,j=m-c,U=ft.rectMask({rect:{x:b,y:x,width:T,height:j}});this.container.add(U),k.mask=U,this.scrollPane=k,this.renderRecords(a,e);var R=ft.group("",{x:b,y:x}),D=ft.rectMask({rect:{width:T,height:j},alpha:.5});D.inputEnabled=!0,R.add(D),this.loadingTipText=ft.text({width:T,height:j},{fontSize:16,forceFontFamily:"宋体",color:"#fff",boundsAlignH:"center",boundsAlignV:"middle"}),R.add(this.loadingTipText),this.loadingTip=R,this.container.add(R)}},{key:"render",value:function(e){var t=this,n=e.template.json.record,r=n.scrollBox,a=n.back,o=n.background,i=game.world,u=i.width,c=i.height,s=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e||!e&&r){var a=ft.image(e,n);a.inputEnabled=r,t.container.add(a)}};s(o.url,{x:0,y:0,width:u,height:c},!0),s(r.background.url,r.rect),this.renderScrollBox(r),function(e,n,r){var a=e.rect,o=e.normal,i=e.active;if(!e.hidden){var u={name:n,normalUrl:o.background.url,activeUrl:i.background.url,onClick:t.handleClick,textOptions:{normal:S({},o.text,{text:r}),active:S({},i.text,{text:r})},audio:{url:$.buttonSoundUrl,volume:1}};t.container.add(ft.button(a,u))}}(a,"record_button_back","返回");var l={x:u-74,y:25,width:68,height:68},d={name:rn[0],onClick:this.handleClick,checkedUrl:"local_hover",uncheckedUrl:"local",textOptions:{checked:S({},a.active.text),unchecked:S({},a.normal.text)}};this.container.add(ft.checkbox(l,d)),an||(d.name=rn[1],l.y=107,d.uncheckedUrl="cloud",d.checkedUrl="cloud_hover",this.container.add(ft.checkbox(l,d)))}}]),e}(),sn=null,ln=function(){function e(t){var n=this,r=t.callbacks;Object(o.a)(this,e),x(this,"handleButtonClick",function(e,t){t.pointerMode===Phaser.PointerMode.CURSOR&&0!==t.button||("end_button_back"===e.parent.name?(n.close(),n.callbacks&&n.callbacks.back&&n.callbacks.back()):"end_button_load"===e.parent.name?n.callbacks&&n.callbacks.load&&n.callbacks.load():"end_button_save"===e.parent.name&&n.callbacks&&n.callbacks.save&&n.callbacks.save())}),this.callbacks=r,this.container=ft.group(),this.render(),game.onRestart.add(function(){return n.close()})}return Object(i.a)(e,[{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"update",value:function(e){var t=e.callbacks;return this.callbacks=t,this.container.visible=!0,this}},{key:"render",value:function(){var e=this,t=C.a.vertical,n=game.world,r=n.width,a=n.height,o=ft.rectMask({rect:{width:r,height:a},alpha:.8});o.inputEnabled=!0,this.container.add(o);var i=function(t,n,r){var a=t.rect,o=t.normal,i=t.active,u={name:n,normalUrl:o.url,activeUrl:i.url,onClick:e.handleButtonClick,textOptions:{center:!1,normal:S({},o.text,{text:r}),active:S({},i.text,{text:r}),rect:{width:96,height:30,x:0,y:100}},audio:{url:$.buttonSoundUrl,volume:1}};e.container.add(ft.button(a,u))},u={width:96,height:96},c={text:{forceFontFamily:"宋体",fontSize:14,color:"#ffffff"}},s={text:{forceFontFamily:"宋体",fontSize:14,color:"#ef7297"}},l=t?[55,427]:[168,100],d=Object(_.a)(l,2);u.x=d[0],u.y=d[1];var h=["icon_get","icon_get_hover_pressed"];c.url=h[0],s.url=h[1],i({rect:u,normal:c,active:s},"end_button_load","读取进度");var f=t?[216,427]:[432,100],p=Object(_.a)(f,2);u.x=p[0],u.y=p[1];var v=["icon_back","icon_back_over_pressed"];c.url=v[0],s.url=v[1],i({rect:u,normal:c,active:s},"end_button_back","返回封面");var m=t?[377,427]:[696,100],g=Object(_.a)(m,2);u.x=g[0],u.y=g[1];var y=["icon_save","icon_save_over_pressed"];c.url=y[0],s.url=y[1],i({rect:u,normal:c,active:s},"end_button_save","存个档，下次玩")}}]),e}(),dn=(n(164),null),hn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(dn?dn.update(e):dn=new pn(e)).container};function fn(){return new Promise(function(e,t){var n=C.a.uuid,r=C.a.vertical,a=C.a.wap;window.gameCallback={syMenuBack:function(){document.body.removeChild(o),e()},syMenuExit:function(t){"string"!=typeof t||-1===t.indexOf("http")?(document.body.removeChild(o),e()):window.location.href=t}};var o=document.createElement("div");o.classList.add("syModalContainer");var i=document.createElement("div");i.classList.add("syModalPortal"),document.body.clientWidth<=document.body.clientHeight&&(i.style.transform=r?"rotate(0)":"rotate(90deg)"),window.onresize=function(){document.body.clientWidth<=document.body.clientHeight?i.style.transform=r?"rotate(0)":"rotate(90deg)":i.style.transform=r?"rotate(90deg)":"rotate(0)"},o.appendChild(i);var u=document.createElement("div");u.classList.add("syContent"),i.appendChild(u),r&&(u.style.width="320px",u.style.height="510px");var c=document.createElement("iframe");c.src="https://www.3000.com/popup.html?uuid="+n+"&wap="+a+"&vertical="+(r?1:0),c.scrolling="no",c.width="100%",c.height="100%",c.frameBorder="0",u.appendChild(c),document.body.appendChild(o)})}var pn=function(){function e(t){var n=this,r=t.callbacks,a=t.template;Object(o.a)(this,e),x(this,"handleClick",function(e,t){if(t.pointerMode!==Phaser.PointerMode.CURSOR||0===t.button)if("qzone"!==C.a.wap)if("menu_button"===e.parent.name)n.callbacks&&n.callbacks.menu&&n.callbacks.menu();else if("shanyiMenu_button"===e.parent.name){var r=C.a.client,a=C.a.isWapOther,o=C.a.type,i=C.a.wap,u=C.a.single,c=C.a.singleoffline;if(1==o)return void I.a.info("作品发布上线后才可以召唤闪艺菜单哦~~");var s=function(){$.full&&(!U.isAppClient()&&game.scale.stopFullScreen(),$.full=!1)};if(u)return s(),void(c?window.app&&window.app.moreWorks():U.gameQuit());if("wap"===r)return s(),void("wx"===i?M.b.openWxPage("back"):window.parent&&window.parent.closGame());"ios"===r||"android"===r?a?(s(),fn()):U.openShanyiMenu():"pc"===r?(s(),U.openShanyiMenu()):(s(),fn())}else"packdown_button"===e.parent.name?(n.packdown.visible=!1,n.packup.visible=!0,n.showList.forEach(function(e){return e.visible=!0})):"packup_button"===e.parent.name&&(n.packdown.visible=!0,n.packup.visible=!1,n.showList.forEach(function(e){return e.visible=!1}));else switch(e.parent.name){case"invite_button":n.callbacks&&n.callbacks.share&&n.callbacks.share(!0);break;case"share_button":n.callbacks&&n.callbacks.share&&n.callbacks.share();break;case"help_button":n.callbacks&&n.callbacks.menu&&n.callbacks.menu()}}),this.callbacks=r,this.container=ft.group(),this.packup=null,this.packdown=null,this.showList=[],this.render(a.json)}return Object(i.a)(e,[{key:"update",value:function(e){var t=e.callbacks;return this.callbacks=t,this.container.visible=!0,this}},{key:"render",value:function(e){var t=this,n=C.a.client,r=C.a.vertical,a=C.a.wap,o=C.a.single,i=C.a.singleoffline,u=e.menu,c=e.shanyiMenu,s=function(e,n){var r=e.rect,a=e.normal,o=e.active,i={name:n,normalUrl:a.background.url,activeUrl:o.background.url,onClick:t.handleClick,audio:{url:$.buttonSoundUrl,volume:1}},u=ft.button(r,i);return t.container.add(u),u};if("qzone"===a){var l=r?442:886,d={rect:{x:l,y:100,width:44,height:69},normal:{background:{url:"share"}},active:{background:{url:"share"}}},h={rect:{x:l,y:180,width:44,height:69},normal:{background:{url:"help"}},active:{background:{url:"help"}}};s({rect:{x:l,y:20,width:44,height:69},normal:{background:{url:"invite"}},active:{background:{url:"invite"}}},"invite_button"),s(d,"share_button"),s(h,"help_button")}else if(this.showList.push(s(u,"menu_button")),c){if("wap"!==n&&!o){var f={rect:{x:u.rect.x+5,y:0,width:61,height:26},normal:{background:{url:"packup"}},active:{background:{url:"packup-hover"}}};this.packup=s(f,"packup_button");var p={rect:{x:u.rect.x+5,y:0,width:61,height:26},normal:{background:{url:"packdown"}},active:{background:{url:"packdown-hover"}}};this.packdown=s(p,"packdown_button"),this.packdown.visible=!1}var v=c,m=v.rect,g=v.normal,y=v.active,w={rect:m,normal:{background:{url:o?i?"menumore":"wapback":"wap"===n?"wapback":g.background.url}},active:{background:{url:o?i?"menumore_hover":"wapback":"wap"===n?"wapback":y.background.url}}};this.showList.push(s(w,"shanyiMenu_button"))}else if("wap"===n){var b=r?[442,30]:[886,26],x=Object(_.a)(b,2);c={rect:{x:x[0],y:x[1],width:68,height:68},normal:{background:{url:"wapback"}},active:{background:{url:"wapback"}}},this.showList.push(s(c,"shanyiMenu_button"))}}}]),e}(),vn=null,mn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return vn?vn.update(e):vn=new yn(e)},gn=/([\s\S]*)\\(\d+)\s([\s\S]*)/,yn=function(){function e(t){var n=this,r=t.gameJson,a=t.settings;Object(o.a)(this,e),this.gameJson=r,this.container=ft.group(),this.containerVector=[];var i=this.gameJson,u=i.template.json.dialog,c=i.dialogs;this.containerVector.push(this.render(u,0)),c&&c.forEach(function(e){n.containerVector.push(n.render(e,e.id))}),this.update({settings:a})}return Object(i.a)(e,[{key:"clear",value:function(){var e=this.container,t=e.parent;t&&t.remove(e,!1),this.animating&&this.animating.cancel&&this.animating.cancel()}},{key:"pause",value:function(){this.paused=!0}},{key:"proceed",value:function(){this.paused=!1}},{key:"update",value:function(e){var t,n,r,a,o=e.settings,i=o.dialogid,u=this.gameJson,c=(u.dialogs,u.default_settings.color),s=this.container.children[0]||null;this.container.alpha=1,this.container.visible=!0;var l=null;s?i!==s.id?(l=this.containerVector.find(function(e){return e.id==i})||this.containerVector[0],this.container.replace(s,l)):l=s:(l=this.containerVector[i]||this.containerVector[0],this.container.add(l)),t=l.json.content.rect.width,n=l.json.content.rect.height,r=l.json.titleContainer.title,a=l.json.avatarContainer,c=l.json.content.text.color||c,this.background=l.background,this.titleContainer=l.titleContainer,this.titleText=l.titleText,this.avatarContainer=l.avatarContainer,this.avatar=l.avatar,this.textarea=l.textarea;var d={width:t,height:n,title:r,avatarContainer:a,color:c};return this.setting(o,d),this}},{key:"setting",value:function(e,t){var n=t.width,r=t.height,a=t.title,o=t.avatarContainer,i=t.color,c=o.avatar,s=o.rect,l=e.speaking,d=l.fontFamily,h=l.font_size,f=void 0===h?12:h,p=l.data,v=l.immediate,m=l.hidden,g=l.speed,y=e.avatar,w=e.dialogtitle;if(this.avatarContainer.visible=!y.hidden,!y.hidden){var b=c.x,_=c.y,x=c.width,k=c.height;b+=s.x,_+=s.y,this.avatar.loadTexture(y.url||"");var P=this.avatar.texture,C=Math.min(x/P.width,k/P.height);x=P.width*C,k=P.height*C,this.avatar.x=b+(c.width-x)/2,this.avatar.y=_+(c.height-k)/2,this.avatar.width=x,this.avatar.height=k}this.background.visible=!m,this.titleContainer.visible=!w.hidden,this.titleText.setStyle({align:"center",boundsAlignH:"center",boundsAlignV:"middle",fontFamily:d,color:w.color||a.text.color,fontSize:Number(w.font_size||a.text.fontSize)}),this.titleText.setText(w.data);var O=m?game.world.height:r;this.textarea.setStyle({fontFamily:d,fontSize:f}),Array.isArray(p)||(p=u.c.toArrayForData(p).map(function(t){return S({},t,{color:e.speaking.color||i})})),this.state={data:p,immediate:v,speed:parseInt(g,10),lineHeight:1.5*f,maxHeight:O},this.textarea.setTexts(p.map(function(e){for(var t=e.data,n=void 0===t?"":t,r=gn.exec(n);r;)n=r[1]+r[3],r=gn.exec(n);return S({},e,{data:n})})),this.textarea.y=0,v||(O=0);var E=this.textarea.mask;E.clear(),E.beginFill();var I=new Phaser.Polygon;I.setTo([new Phaser.Point(0,0),new Phaser.Point(n,0),new Phaser.Point(n,O),new Phaser.Point(0,O)]),E.drawPolygon(I.points),E.endFill()}},{key:"animate",value:function(e){var t=this,n=this.state,r=n.data,a=n.speed,o=n.lineHeight,i=n.maxHeight,c=o/3,s=!1,l=this.textarea.getLines(),d=l.length,h=this.container.children[0],f=h?h.json.content.rect.width:this.gameJson.template.json.dialog.content.rect.width,p=this.textarea.mask,v=function(e){var n=e.lineIndex,r=e.lineCharIndex;n>=d&&(n=d?d-1:d,r=d?l[d-1].length:0);var a=i-(n+1)*o;t.textarea.y=a+c>0||!n?0:a,p.clear(),p.beginFill();var u=new Phaser.Polygon,s=(n+1)*o;s=s>i?i:s;var h=t.textarea.getCharsWidth((l[n]||"").slice(0,r));u.setTo([new Phaser.Point(0,0),new Phaser.Point(0,s),new Phaser.Point(h,s),new Phaser.Point(h,s-o),new Phaser.Point(f,s-o),new Phaser.Point(f,0)]),p.drawPolygon(u.points),p.endFill()},m=function(){return v({lineIndex:d,lineCharIndex:0})};return e||this.state.immediate?(m(),Promise.resolve()):(this.animating&&this.animating.cancel&&this.animating.cancel(),this.animating=new Promise(function(e,n){!function n(o){var i=o.lineIndex,c=o.lineCharIndex,h=o.dataIndex,f=o.dataCharIndex;if(!s)if(t.paused)u.c.timeout(100).then(function(){return n({lineIndex:i,lineCharIndex:c,dataIndex:h,dataCharIndex:f})});else{if(h>=r.length||i>=d)return m(),void e();var p=r[h],g=p.data,y=p.placeholder,w=a,b=null;do{if(y&&(b=gn.exec(g))){w=b[2],h++,f=0;break}f++,++c>=l[i].length&&(i++,c=0),f>=g.length&&(h++,f=0)}while(0);v({lineIndex:i,lineCharIndex:c}),u.c.timeout($.fastPlay?0:w).then(function(){return n({lineIndex:i,lineCharIndex:c,dataIndex:h,dataCharIndex:f})})}}({lineIndex:0,lineCharIndex:0,dataIndex:0,dataCharIndex:0})}),this.animating.cancel=function(){s=!0,m()},this.animating)}},{key:"render",value:function(e,t){var n=ft.group();n.id=t,n.json=e;var r=game.make,a=this.gameJson.default_settings.color,o=e.background,i=e.rect,c=e.avatarContainer,s=e.titleContainer,l=e.content;n.background=ft.image(o.url,S({},i,{x:0,y:0})),n.add(n.background),n.titleContainer=ft.group(),s.background.url&&n.titleContainer.add(ft.image(s.background.url,s.rect));var d=s.rect.x+s.title.rect.x,h=s.rect.y+s.title.rect.y;n.titleText=ft.text(S({},s.title.rect,{x:d,y:h}),{}),n.titleContainer.add(n.titleText),n.add(n.titleContainer),n.avatarContainer=ft.group(),c.background.url&&n.avatarContainer.add(ft.image(c.background.url,c.rect)),d=c.rect.x+c.avatar.x,h=c.rect.y+c.avatar.y;var f=c.avatar,p=f.width,v=f.height,m=f.clip;n.avatar=ft.image("",{width:p,height:v,x:d,y:h});var g=r.graphics(0,0);switch(g.beginFill(),m){case"square":g.drawRect(d,h,p,v);break;case"hexagon":var y=new Phaser.Polygon;y.setTo([new Phaser.Point(p/2+d,h),new Phaser.Point(p/2+v/4*Math.pow(3,.5)+d,v/4+h),new Phaser.Point(p/2+v/4*Math.pow(3,.5)+d,v/4*3+h),new Phaser.Point(p/2+d,v+h),new Phaser.Point(p/2-v/4*Math.pow(3,.5)+d,v/4*3+h),new Phaser.Point(p/2-v/4*Math.pow(3,.5)+d,v/4+h)]),g.drawPolygon(y.points);break;case"heart":g.moveTo(p/2+d,p/4+h),g.bezierCurveTo(3*p/4+d,-p/4+h,3*p/2+d,p/4+h,p/2+d,p+h),g.bezierCurveTo(-p/2+d,p/4+h,p/4+d,-p/4+h,p/2+d,p/4+h);break;case"round":default:g.drawCircle(d+p/2,h+v/2,p)}g.endFill(),n.avatar.mask=g,n.avatarContainer.add(n.avatar),n.add(g),n.add(n.avatarContainer);var w=l.rect;d=w.x,h=w.y,p=w.width,v=w.height,d=u.b.roundToInt(d),h=u.b.roundToInt(h);var b=ft.group("textareaContainer",{x:d,y:h,width:p,height:v});n.add(b);var _=r.graphics(0,0);_.beginFill();var x=new Phaser.Polygon;return _.drawPolygon(x.points),_.endFill(),n.textarea=ft.textarea({width:p,height:v},{color:0!==t?l.text.color:a}),n.textarea.mask=_,b.add(_),b.add(n.textarea),n}}]),e}(),wn=["background","bottomDialog","images","weather","topDialog","click2continue","options","animations"],bn=function(){function e(t){var n=this,r=t.game,a=t.json,i=t.getPlayContext,u=t.setBackground,c=t.getInheritBackground,s=t.showPlotViews,l=t.hideBackground,d=t.noShowingViews,h=t.autoSaveRecord,f=t.resetPlayCount;Object(o.a)(this,e),this.game=r,this.json=a,this.props={getPlayContext:i,setBackground:u,getInheritBackground:c,showPlotViews:s,hideBackground:l,noShowingViews:d,autoSaveRecord:h,resetPlayCount:f};var p=ft.group("scene");this.container=p,wn.forEach(function(e){return n[e]=p.add(ft.group(e))}),this.tweens=[],this.optionsTimeoutHandles=[]}return Object(i.a)(e,[{key:"renderBackground",value:function(e){var t=this.props.getInheritBackground,n=e.animations,r=e.background,a=r.flex,o=r.url,i=r.opacity,u=void 0===i?1:i,c=n.some(function(e){return"fadein"===e.type||"coverblack"===e.type})?0:u,s=this.game.world,l=s.width,d=s.height,h=null;if("inherit"===o){var f=t();a=f.flex,o=f.url;var p=f.opacity;u=void 0===p?1:p,c=n.some(function(e){return"fadein"===e.type||"coverblack"===e.type})?0:u}o?(h=ft.image(o),bt.flex(a,h,{width:l,height:d})):h=ft.rectMask({rect:{width:l,height:d}}),h.alpha=c,this.background.add(h)}},{key:"renderWeather",value:function(){var e=this,t=C.a.vertical,n=this.plot.weather.value,r=this.game,a=r.cache,o=r.time.events,i=r.world,c=i.width,s=i.height;if(!t&&"windy"===n){var l=ft.tileSprite({x:0,y:0,width:c,height:s,url:"wind"});return l.autoScroll(-360,0),void this.weather.add(l)}var d=u.c.getWeatherUrls(n),h=d.length;if(h&&a.checkImageKey(d[0])){var f=ft.image();this.weather.add(f);var p=0;!function t(){return o.add(40,function(){var e=d[p];f.parent&&a.checkImageKey(e)&&(f.loadTexture(e),p=++p%h,t())},e)}()}else this.weather.removeAll(!0)}},{key:"renderDialog",value:function(){var e=this.plot,t=e.speaking,n=e.dialogtitle,r=e.avatar,a=e.dialogid,o=void 0===a?0:a,i=t.coverage,c=t.x,s=t.y,l=t.opacity,d=void 0===l?1:l,h=t.animations,f=void 0===h?[]:h;if(this.dialogView=mn({gameJson:this.json,settings:{speaking:t,dialogtitle:n,avatar:r,dialogid:o}}),f.length){d=f.some(function(e){return"fadein"===e.type})?0:1;var p=f.find(function(e){return"moveFrom"===e.type});c=p?p.x:c,s=p?p.y:s}var v=this.dialogView.container;v.x=u.b.roundToInt(c),v.y=u.b.roundToInt(s),v.alpha=d,("bottom"===i?this.bottomDialog:this.topDialog).add(v)}},{key:"renderImages",value:function(){var e=this,t=this.plot,n=t.characters,r=t.props,a=t.animations,o=function(t){var n=t.url,r=t.width,a=t.height,o=t.rotate,i=void 0===o?0:o,c=t.mirrorH,s=t.mirrorV,l=t.animations,d=t.x,h=t.y,f=t.opacity,p=void 0===f?1:f;p=l.some(function(e){return"fadein"===e.type&&"animateIn"===e.trigger})?0:p;var v=l.find(function(e){return"moveFrom"===e.type&&"animateIn"===e.trigger});v&&(d=isNaN(parseFloat(v.x))?d:parseFloat(v.x),h=isNaN(parseFloat(v.y))?h:parseFloat(v.y));var m=u.c.isObject(n)&&n.type,g=e.props.getPlayContext;m&&(at.playContext=g());var y=ft.image(n,{x:d,y:h}),w=m?Math.min(r/100,a/100):Math.min(r/y.width,a/y.height);return y.pivot.x=y.width/2,y.pivot.y=y.height/2,y.scale.setTo(w,w),y.sourceScale=w,y.x+=y.width/2,y.y+=y.height/2,y.alpha=p,y.angle=180===parseInt(i)?179.9:-180===parseInt(i)?-179.9:i,y.info=t,c&&(y.angle=-y.angle,y.scale.x=-y.scale.x),s&&(y.angle=-y.angle,y.scale.y=-y.scale.y),y};n.forEach(function(t){return e.images.add(o(t))}),r.forEach(function(t){return e.images.add(o(t))}),this.images.visible=!a.some(function(e){return"in"===e.trigger&&e.duration>0})}},{key:"renderOptions",value:function(e){var t=this;this.options.removeAll(!0);for(var n=this.props.getPlayContext,r=this.game.time.events,a=this.plot.options,o=this.json.template.json.option,i=o.rect,c=o.normal,s=o.active,l=[],d=[],h=n(),f=function(n,o){var f=a[n],p=f.font,v=f.timer,m=f.background,g=f.hideTimer,y=f.disable,w=void 0!==y&&y,b=f.name,_=f.condition,x=f.sound,k=f.uuid;if(b=_e.parseValue(b,h),_){var P=_.disable,C=_.enable,S=_.expression,O=_e.safeEval(S,h);if(w=O?"disable"===C.type:"disable"===P.type,O?"hidden"===C.type:"hidden"===P.type)return d.push(Promise.resolve(!1)),"continue"}var E=i.x,I=i.y,M=i.width,A=i.height,V=c.background.url,T=c.background.url,j=s.background.url;E=null!=f.x?f.x:E,I=null!=f.y?f.y:I,E=u.b.roundToInt(E),I=u.b.roundToInt(I),m&&(M=null!=f.width?f.width:M,A=null!=f.height?f.height:A,j=m.active.url,V=m.normal.url,T=m.disable?m.disable.url:V);var U={fontSize:p.normal.font_size,fontWeight:p.normal.bold,color:p.normal.color},R={fontSize:p.disable.font_size,fontWeight:p.disable.bold,color:p.disable.color},D=ft.button({x:E,y:I,width:M,height:A},{normalUrl:V,activeUrl:j,disableUrl:T,audio:x,onClick:function(t,r){r.pointerMode===Phaser.PointerMode.CURSOR&&0!==r.button||(l.forEach(function(e){return e()}),e({type:"option",control:{index:n}}),We([k]))},textOptions:{disable:R,normal:U,active:U}});if(t.options.add(D),D.showText(!p.normal.hidden),w&&(D.disable(),D.showText(!p.disable.hidden)),D.setText(b),v){var L=_e.safeEval(v.time,h);!g&&D.setText("".concat(b,"(").concat(L,")")),d.push(new Promise(function(e,n){var a=r.loop(Phaser.Timer.SECOND,function(){t.paused||(L--,g||D.setText("".concat(b,"(").concat(L,")")),L<=0&&(r.remove(a),"disable"===v.type?(D.showText(!p.disable.hidden),D.disable(),e(!1)):(D.showText(!p.normal.hidden),D.enable(),e(!0)),D.setText(b)))});t.optionsTimeoutHandles.push(function(){r.remove(a)}),l.push(function(){r.remove(a),e(!0)})}))}else w&&d.push(Promise.resolve(!1))},p=0,v=a.length;p<v;p++)f(p);Promise.all(d).then(function(t){return t.length!==a.length||t.some(function(e){return e})?void 0:e()})}},{key:"doInTL",value:function(e){var t=this;return e!==this.timeline?Promise.reject("timeline changed"):this.paused?new Promise(function(n,r){!function a(){t.paused?t.setTimeoutId=setTimeout(a,50):e!==t.timeline?r("timeline changed"):n()}()}):Promise.resolve()}},{key:"pause",value:function(){this.paused=!0,this.dialogView&&this.dialogView.pause()}},{key:"proceed",value:function(){this.paused=!1,this.dialogView&&this.dialogView.proceed()}},{key:"playMusic",value:function(){var e=this.plot.music,t=e.url,n=e.volume;t?"inherit"===t?re.setMusicVolume(n):re.playMusic({url:t,volume:n}):re.stopMusic()}},{key:"playSounds",value:function(){var e=this.plot.plot_sound,t=function(e,t){var n=t||{},r=n.url,a=n.volume,o=n.time,i=void 0===o?1:o;r?re.playSound({channel:e,url:r,volume:a,loop:1!==i}):re.stopSound(e)};Array.isArray(e)?e.forEach(function(e,n){return t(n,e)}):t(0,e)}},{key:"fadeinMusic",value:function(e){var t=this,n=this.plot.music.animation;if(!n||!n.type.includes("fadein"))return Promise.resolve();var r=$.fastPlay||this.restore?10:1e3;return re.tweenFromWithMusic({volume:0,duration:r}).then(function(){return t.doInTL(e)})}},{key:"fadeOutMusic",value:function(e){var t=this,n=this.plot.music.animation;if(!n||!n.type.includes("fadeout"))return Promise.resolve();var r=$.fastPlay?10:1e3;return re.tweenToWithMusic({volume:0,duration:r}).then(function(){return t.doInTL(e)})}},{key:"transform",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"in",n=arguments.length>1?arguments[1]:void 0,r=this.plot,a=r.animations,o=r.background.opacity,i=void 0===o?1:o;return a=a.filter(function(e){return e.trigger===t}).map(function(t){var n=t.type,r=t.duration,a=t.delay,o=t.color,u=t.level;if($.fastPlay){var c=$.getFastPlayAnimationInfo(r);a=c.delay,r=c.duration}switch(e.restore&&(a=r=0),n){case"fadein":return H.to({target:e.background.children[0],properties:{alpha:i},duration:r,delay:a});case"twinkle":return H.twinkle({target:e.animations,duration:r,delay:a,color:o});case"shake":if(!r)return Promise.resolve();var s=u?5*u:0;return Promise.all(wn.slice(0,3).map(function(t){return H.shake({target:e[t],duration:r,delay:a,offSet:s})}));case"curtain":return H.curtain({target:e.animations,duration:r,delay:a});case"interlacing":return H.interlacing({target:e.animations,duration:r,delay:a});case"coverblack":return Promise.all([H.coverblack({target:e.animations,duration:r,delay:a}),H.to({target:e.background.children[0],properties:{alpha:i},duration:1,delay:a+r/2})]);case"spread":var l=e.game.world,d=l.width,h=l.height,f=ft.rectMask({rect:{width:d,height:h}});return e.container.add(f,!0,0),Promise.all(wn.slice(0,7).map(function(t){return H.spread({target:e[t],duration:r,delay:a})})).then(function(){return f.destroy()})}}),Promise.all(a).then(function(){return e.doInTL(n)})}},{key:"animateImages",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"animateIn",n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.images.visible=!0;var a=this.images.children,o=[];return a.forEach(function(n){var r=n.info,a=n.sourceScale,i=n.texture.frame,u=i.width,c=i.height,s=r.opacity,l=void 0===s?1:s,d=r.animations,h=void 0===d?[]:d,f=r.x,p=r.y;h.filter(function(e){return e.trigger===t}).forEach(function(t){var r=t.type,i=t.duration,s=t.delay,d=t.x,h=t.y;if($.fastPlay){var v=$.getFastPlayAnimationInfo(i);s=v.delay,i=v.duration}switch(e.restore&&(s=i=0),r){case"fadein":o.push(H.to({target:n,properties:{alpha:l},duration:i,delay:s}));break;case"fadeout":o.push(H.to({target:n,properties:{alpha:0},duration:i,delay:s}));break;case"moveFrom":d=f+a*u/2,h=p+a*c/2,o.push(H.to({target:n,properties:{x:d,y:h},duration:i,delay:s}));break;case"moveTo":d+=a*u/2,h+=a*c/2,o.push(H.to({target:n,properties:{x:d,y:h},duration:i,delay:s}))}})}),Promise.all(o).then(function(){return e.doInTL(n)}).then(function(){return r})}},{key:"animateDialog",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"animateIn",n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=this.plot.speaking,o=a.animations,i=void 0===o?[]:o,u=a.x,c=a.y,s=this.dialogView.container,l=i.filter(function(e){return e.trigger===t}).map(function(t){var n=t.type,r=t.duration,a=t.delay,o=t.x,i=t.y;if($.fastPlay){var l=$.getFastPlayAnimationInfo(r);a=l.delay,r=l.duration}switch(e.restore&&(a=r=0),n){case"fadein":return H.to({target:s,properties:{alpha:1},duration:r,delay:a});case"fadeout":return H.to({target:s,properties:{alpha:0},duration:r,delay:a});case"moveFrom":return H.to({target:s,properties:{x:u,y:c},duration:r,delay:a});case"moveTo":return H.to({target:s,properties:{x:o,y:i},duration:r,delay:a})}});return Promise.all(l).then(function(){return e.doInTL(n)}).then(function(){return r})}},{key:"animateSpeak",value:function(e){var t=this;if((0,this.props.setBackground)(this.plot.background),this.restore)return this.dialogView.animate(!0);var n=this.dialogView.animate(),r=new Promise(function(n,r){t.handleContinue(e).then(function(){return n()}),t.setControlPlay(n)});return Promise.race([n,r]).then(function(e){return n.cancel&&n.cancel(),e}).then(function(n){return t.doInTL(e).then(function(){return t.handleClearContinue()}).then(function(){return n})})}},{key:"waitTime",value:function(e,t){var n=this,r=this.plot.wait.value;return $.fastPlay&&(r=Math.min(r,10)),u.c.timeout(r).then(function(){return n.doInTL(e)}).then(function(){return t})}},{key:"setControlPlay",value:function(e){this.controlPlay=function(t){return e(t)}}},{key:"dispatchContinueClick",value:function(){var e=this.click2continue.children;e[0]&&($.fastPlay||$.autoPlay)&&e[0].events.onInputUp.dispatch()}},{key:"handleContinue",value:function(e){var t=this,n=this.props,r=n.noShowingViews,a=n.resetPlayCount,o=this.game,i=o.input,u=i.keyboard,c=i.onHold,s=o.device.desktop,l=new Promise(function(e,n){return!s&&r()&&c.addOnce(function(){return e()},t)}),d=new Promise(function(e,n){return r()&&u.addKey(Phaser.Keyboard.Z).onDown.add(function(){return e()},t)}),h=new Promise(function(e,n){return r()&&u.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(function(){return e()},t)}),f=new Promise(function(e,n){t.click2continue.removeAll(!0);var r=t.game.world,o=r.width,i=r.height,u=ft.rectMask({rect:{width:o,height:i},alpha:0});u.inputEnabled=!0;var c={};u.events.onInputDown.add(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c={x:t.x,y:t.y}}),u.events.onInputUp.add(function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r||r.pointerMode!==Phaser.PointerMode.CURSOR||0===r.button){var o=Math.abs(c.x-r.x),i=Math.abs(c.y-r.y);Math.max(o,i)>60&&U.isAppClient()||(a(),t.click2continue.removeAll(!0),e())}}),t.click2continue.add(u)});return Promise.race([f,d,h,l]).then(function(){return t.doInTL(e)}).then(function(){return t.handleClearContinue()})}},{key:"handleClearContinue",value:function(){var e=this.game.input,t=e.keyboard,n=e.onHold;this.click2continue.removeAll(!0),n.removeAll(this),t.addKey(Phaser.Keyboard.Z).onDown.removeAll(this),t.addKey(Phaser.Keyboard.SPACEBAR).onDown.removeAll(this)}},{key:"play",value:function(e){var t=this,n=this.props,r=n.getPlayContext,a=n.showPlotViews,o=n.hideBackground,i=n.noShowingViews,c=n.autoSaveRecord,s=e.plots,l=e.plotIndex,d=e.load,h=e.restore;this.restore=h;var f=r(),p=this.plot=P()(s[l],{speaking:{data:{$apply:function(e){return _e.parseValue(e,f)}}},dialogtitle:{data:{$apply:function(e){return _e.parseValue(e,f)}}}});this.renderWeather(),this.renderDialog(),this.renderImages(),this.playMusic(),this.playSounds();var v={};return this.timeline=v,this.transform("in",v).then(function(){return Promise.all([a(),o(),t.transform("animateIn",v),t.animateImages("animateIn",v),t.animateDialog("animateIn",v),t.fadeinMusic(v)])}).then(function(){return Promise.all([t.transform("animateInEnd",v),t.animateDialog("animateInEnd",v)])}).then(function(){return t.animateSpeak(v)}).then(function(e){0===(p.autoSaveOrLoad||{}).type&&!d&&!h&&c();var n=!!e;if(e&&"nextPlot"!==e.type)return Promise.resolve(e);e={};var a=$.fastPlay&&i(),o=p.autotext||$.autoPlay&&i();if(p.insert)e={type:"insertPlot",control:{uuid:p.insert,from:"scene"}};else if(p.back)e={type:"back"};else if(p.jump)e={type:"jump",control:{uuid:p.jump}};else if(!n){var s=r(),l=(p.condition_options||[]).findIndex(function(e){return _e.safeEval(e.expression,s)});if(l<0?null:p.condition_options[l]){var f=a||o?Promise.resolve():t.handleContinue(v);return new Promise(function(e,n){var r=function(){f.cancel&&f.cancel(),e({type:"condition_option",control:{index:l}})};t.setControlPlay(e);var i=function(){return f.then(r)};a?i():o?u.c.timeout(p.speaking.immediate?400:0).then(function(){return t.doInTL(v)}).then(function(){return i()}):i()})}if(p.options.length>0&&p.options.some(function(e){var t=e.condition;if(!t)return!0;var n=t.disable,r=t.enable,a=t.expression;return!(_e.safeEval(a,s)?"hidden"===r.type:"hidden"===n.type)}))return t.game.input.onUp.dispatch(),new Promise(function(e,n){t.renderOptions(e),t.setControlPlay(e)})}var m=n||a||o?Promise.resolve():t.handleContinue(v);return new Promise(function(n,r){t.setControlPlay(function(t){return n("nextPlot"===t.type?e:t)});var i=function(){return m.then(function(){return n(e)})};a?i():o?u.c.timeout(p.speaking.immediate?400:0).then(function(){return t.doInTL(v)}).then(function(){return i()}):i()})}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.options.removeAll(!0),t.handleClearContinue();var n=r(),a=(p.condition_options||[]).findIndex(function(e){return _e.safeEval(e.expression,n)}),o=a<0?null:p.condition_options[a];return e.type&&"nextPlot"!==e.type&&"condition_option"!==e.type||p.back||p.jump||p.insert?S({},e):o?{type:"condition_option",control:{index:a}}:{}}).then(function(e){return t.waitTime(v,e)}).then(function(e){return Promise.all([t.animateImages("animateOut",v,e),t.animateDialog("animateOut",v,e),t.fadeOutMusic(v)])}).then(function(e){return e[0]})}},{key:"clear",value:function(){var e=this;for(this.proceed(),this.dialogView&&this.dialogView.clear(),this.handleClearContinue();this.optionsTimeoutHandles.length>0;){this.optionsTimeoutHandles.pop()()}wn.forEach(function(t){var n=e[t];n.removeAll(!0),n.y=n.x=0})}}]),e}(),_n=function(e){function t(e,n,r,a){var i;Object(o.a)(this,t),(i=ie(this,ue(t).call(this,a))).game=a;var u=n.args,c=n.uuid,s=C.a.vertical,l=u[0],d=l.index,h=l.rect,f=void 0===h?{x:0,y:0,width:s?540:960,height:s?960:540}:h,p=l.remove,v=void 0===p?0:p,m=l.scale,g=void 0===m?1:m,y=l.show,w=void 0===y||y,b=f.x,_=f.y,x=f.width,k=f.height;return i.x=b,i.y=_,i.width=x,i.height=k,e&&e.addChild(oe(i)),i.uuid=c,i.remove=v,i.index=parseInt(d),i.rect=f,i.bubbleHeight=0,i.saveVector=[],i.count=0,i.runNextCommand=r,i.scalenum=g,i.container=i.addContainer(f),i.scale.set(g,g),i.display(w),i}return le(t,Phaser.Group),Object(i.a)(t,[{key:"updateState",value:function(e,t){var n=e.args,r=e.uuid,a=n[0],o=a.rect,i=a.remove,u=a.scale,c=void 0===u?1:u;this.uuid=r,this.remove=i,this.count=0,this.clear(),this.resetSize(o,c,t)}},{key:"display",value:function(e){this.show=this.visible=e}},{key:"addContainer",value:function(e){var t=this,n=C.a.vertical,r=ft.sprite({x:0,y:0});r.name="scrollPane",this.add(r),r.inputEnabled=!0,r.input.enableDrag(),r.input.allowHorizontalDrag=!1;var a=ft.rectMask({alpha:0,rect:S({},e,{x:0,y:0})});r.addChildAt(a,0);var o=!1,i=0,u=0,c=0,s=0,l=!1,d=r.events;r.onUpdate=function(e,t){a.clear(),a.beginFill(0,0),a.drawRect(0,0,e,t),a.endFill()},this.onScorll=r.onScroll=function(n,a){a=a+.5|0,t.bubbleHeight<e.height?r.input.disableDrag():a>0?r.y=0:a<=-(t.bubbleHeight-e.height)?r.y=-(t.bubbleHeight-e.height):r.y=a};var h=function(r){var a,o,i=r.worldX,u=r.worldY,c=game.world.angle;if(n&&90===c||!n&&0===c){var s=n?[u,-i]:[i,u],l=Object(_.a)(s,2);a=l[0],o=l[1]}else{var d=n?[i,u]:[u,-i],h=Object(_.a)(d,2);a=h[0],o=h[1]}return o<e.y||o>e.y+t.bubbleHeight||a<e.x||a>e.x+e.width?null:{x:a,y:o}};d.onDragUpdate.add(function(e,t,n,a,o,i){return r.onScroll(n,a)},this),d.onInputUp.add(function(){!0===l&&(c=t.game.input.x,s=t.game.input.y,Math.abs(i-c)<=2&&Math.abs(u-s)<=2&&t.runNextCommand&&t.runNextCommand(),l=!1,i=u=c=s=0)}),d.onInputDown.add(function(e,n){l=!0,i=t.game.input.x,u=t.game.input.y,h(n)?e.input.enableDrag():e.input.disableDrag()},this);var f=function(e){var t=e.wheelDelta?e.wheelDelta/120:-e.detail/3;r.onScroll(0,r.y+100*t)},p=function(e,t,n){var r=h(e),a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";!r&&o?(document.removeEventListener(a,f),o=!1):r&&!o&&(document.addEventListener(a,f),o=!0)};this.clearMoveCallback=function(){var e=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.removeEventListener(e,f),t.game.input.deleteMoveCallback(p,t)},this.game.input.addMoveCallback(p,this);var v=ft.rectMask({alpha:0,rect:S({},e,{x:0,y:0})});return this.addChild(v),this.mask=v,r}},{key:"save",value:function(e){this.saveVector.push(e),this.count++}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(this.visible=!1;this.container.children.length>1;)this.container.removeChildAt(this.container.children.length-1).destroy();if(this.bubbleHeight=0,this.container.y=this.container.x=0,2==this.remove||1==e){for(;this.saveVector.length>0;)this.saveVector.pop();if(this.count=0,e&&this.parent){for(;this.container.children.length>0;)this.container.removeChildAt(0).destroy();this.runNextCommand=null,this.parent.remove(this),this.clearMoveCallback(),this.destroy()}}else if(1==this.remove){for(var t=0;t<this.count&&this.count>0;)this.saveVector.pop(),t++;this.count=0}}},{key:"resetSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,width:C.a.vertical?540:960,height:C.a.vertical?960:540},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=e.x,a=void 0===r?0:r,o=e.y,i=void 0===o?0:o,u=e.width,c=e.height;this.x=a,this.y=i,this.rect=e,this.scalenum=t,this.scale.set(t,t),this.container.onUpdate(u,c),this.runNextCommand=n,this.parent&&this.parent.bringToTop(this);var s=this.mask;s.clear(),s.beginFill(0,0),s.drawRect(0,0,u,c),s.endFill()}}]),t}(),xn=["background","bottomDialog","images","weather","click2continue","bubbles","topDialog","options","animations"],kn=function(){function e(t){var n=this,r=t.game,a=t.json,i=t.getPlayContext,u=t.setBackground,c=t.getInheritBackground,s=t.noShowingViews,l=t.addViews,d=t.pushPlayback,h=t.existPlotViews,f=t.resetPlayCount;Object(o.a)(this,e),this.game=r,this.json=a,this.props={getPlayContext:i,setBackground:u,getInheritBackground:c,noShowingViews:s,addViews:l,pushPlayback:d,existPlotViews:h,resetPlayCount:f};var p=ft.group("scene");this.container=p,xn.forEach(function(e){return n[e]=p.add(ft.group(e))}),this.tweens=[],this.optionsTimeoutHandles=[],this.bubbleBorderVector=[],this.state={playStack:[],images:[],dialog:{},weather:null,autotext:null,disableSaveOrLoad:null,animateScene:null,views:[],hideGlobalViews:[],bubbleMode:[],bubbleCount:[]}}return Object(i.a)(e,[{key:"getContext",value:function(){return this.context}},{key:"getState",value:function(){return this.state}},{key:"recoverBubbleContent",value:function(e,t){var n=this;if(0===e.length)return Promise.resolve();return function r(a){var o,i=e[a],u=i.index,c=i.rect,s=i.remove,l=i.scale,d=i.show,h=i.uuid,f=i.bubble,p=void 0===f?[]:f,v={uuid:h,args:[{index:u,rect:c,remove:s,scale:l,show:d}]},m=n.bubbleBorderVector.findIndex(function(e){return e.index===parseInt(u)});return n.bubbleBorder=-1!==m?n.bubbleBorderVector[m]:n.renderBubbleBorder(v),-1!==m?(n.bubbleBorder.updateState(v),n.bubbleBorder.display(d)):n.bubbleBorderVector.push(n.bubbleBorder),p.length>0&&t&&(o=n.bubbleBorder.saveVector).push.apply(o,Object(b.a)(p)),function e(t){if(0==n.bubbleBorder.saveVector.length)return Promise.resolve(!0);var r=n.bubbleBorder.saveVector[t];return n.renderBubble(r,n.bubbleBorder,!0).then(function(r){return t++,n.bubbleBorder.count++,t>=n.bubbleBorder.saveVector.length||e(t)})}(0).then(function(){return++a>=e.length||r(a)})}(0)}},{key:"getBubbleState",value:function(){var e=this.state,t=e.bubbleMode,n=void 0===t?[]:t,r=e.bubbleCount;return{bubbleMode:n,bubbleCount:void 0===r?[]:r}}},{key:"setBubbleState",value:function(e,t){return this.state=P()(this.state,{bubbleMode:{$set:e},bubbleCount:{$set:t}}),this.recoverBubbleContent(e,!0)}},{key:"setState",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.playStack,a=void 0===r?[]:r,o=e.images,i=void 0===o?[]:o,u=e.dialog,c=void 0===u?{}:u,s=e.weather,l=void 0===s?null:s,d=e.autotext,h=void 0===d?null:d,f=e.disableSaveOrLoad,p=void 0===f?null:f,v=e.animateScene,m=void 0===v?null:v,g=e.views,y=void 0===g?[]:g,w=e.hideGlobalViews,b=void 0===w?[]:w,_=e.bubbleMode,x=void 0===_?[]:_,k=e.bubbleCount,C=void 0===k?[]:k,O=Promise.resolve();if(i.forEach(function(e){if(e){var n=e.command,r=e.animate;t.renderImage(r?S({},n.args[0],r.args[0]):n.args[0])}}),l&&this.renderWeather(l.args[0]),m&&this.animateScene(m.args[0]),c.command){var E=S({},c.command.args[0]);c.animate&&(E=P()(E,{speaking:{$apply:function(e){return S({},e,c.animate.args[0])}}})),this.renderDialog(E),this.dialogView.animate(!0)}return O=this.recoverBubbleContent(x,n),this.state={playStack:a,images:i,dialog:c,weather:l,autotext:h,disableSaveOrLoad:p,animateScene:m,views:y,hideGlobalViews:b,bubbleMode:x,bubbleCount:C},this.autoPlay=h&&h.args&&h.args[0],O}},{key:"renderBackground",value:function(e){var t=this.props,n=t.getInheritBackground,r=t.setBackground;this.background.removeAll(!0);var a=e.flex,o=e.url,i=e.opacity,u=void 0===i?1:i;if("inherit"===o){var c=n();a=c.flex,o=c.url;var s=c.opacity;u=void 0===s?1:s}else r(e);var l=this.game.world,d=l.width,h=l.height,f=ft.image(o);bt.flex(a,f,{width:d,height:h}),f.alpha=u,this.background.add(f)}},{key:"renderWeather",value:function(e){var t=this;this.weather.removeAll(!0);var n=C.a.vertical,r=this.game,a=r.cache,o=r.time.events,i=r.world,c=i.width,s=i.height;if(!n&&"windy"===e){var l=ft.tileSprite({x:0,y:0,width:c,height:s,url:"wind"});return l.autoScroll(-360,0),void this.weather.add(l)}var d=u.c.getWeatherUrls(e),h=d.length;if(h&&a.checkImageKey(d[0])){var f=ft.image();this.weather.add(f);var p=0;!function e(){return o.add(40,function(){var t=d[p];f.parent&&a.checkImageKey(t)&&(f.loadTexture(t),p=++p%h,e())},t)}()}else this.weather.removeAll(!0)}},{key:"renderDialog",value:function(e){var t=this.tweens,n=this.props,r=t.findIndex(function(e){return"animateDialog"===e.name});if(~r){var a=t[r];a.cancel&&a.cancel(),t.splice(r,1)}var o=e.speaking,i=e.dialogtitle,c=e.avatar,s=e.dialogid,l=void 0===s?0:s,d=n.getPlayContext,h=o.coverage,f=o.x,p=o.y,v=o.opacity,m=void 0===v?1:v,g=o.data;g=_e.parseValue(g,d());var y=_e.parseValue(i.data,d());this.dialogView=mn({gameJson:this.json,settings:{speaking:S({},o,{data:g}),dialogtitle:S({},i,{data:y}),avatar:c,dialogid:l}});var w=this.dialogView.container;w.x=u.b.roundToInt(f),w.y=u.b.roundToInt(p),w.alpha=m,("bottom"===h?this.bottomDialog:this.topDialog).add(w)}},{key:"renderImage",value:function(e){var t=e.url,n=e.width,r=e.height,a=e.rotate,o=void 0===a?0:a,i=e.mirrorH,c=e.mirrorV,s=e.x,l=e.y,d=e.opacity,h=void 0===d?1:d,f=e.index,p=e.scaleX,v=void 0===p?1:p,m=e.scaleY,g=void 0===m?1:m;if(1!==f){var y=u.c.isObject(t)&&t.type,w=this.props.getPlayContext;y&&(at.playContext=w());var b=ft.image(t,{x:s,y:l}),_=b.texture.frame,x=y?Math.min(n/100,r/100):Math.min(n/b.width,r/b.height);b.pivot.x=b.width/2,b.pivot.y=b.height/2,b.sourceScale=x,b.width=Math.abs(v*x*_.width),b.height=Math.abs(g*x*_.height),b.x+=b.width/2,b.y+=b.height/2,b.alpha=h,b.angle=180===parseInt(o)?179.9:o,b.zIndex=f,b.tweenPromises=[];var k=b.destroy;b.destroy=function(){b.tweenPromises.forEach(function(e){return e.cancel&&e.cancel()}),b.tweenPromises=null;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];k.apply(b,t)},i&&(b.angle=-b.angle,b.scale.x=-b.scale.x,b.mirrorH=!0),c&&(b.angle=-b.angle,b.scale.y=-b.scale.y,b.mirrorV=!0);for(var P=this.images.children,C=0;C<P.length;C++){var S=P[C];if(S.zIndex===f){this.images.removeChildAt(C),S.destroy();break}if(S.zIndex>f)break}this.images.add(b,!1,C)}else this.renderBackground(e)}},{key:"removeImage",value:function(e){if(1===e)(0,this.props.setBackground)({}),this.background.removeAll(!0);else for(var t=this.images.children,n=0;n<t.length;n++){var r=t[n];if(r.zIndex===e){this.images.removeChildAt(n),r.destroy();break}}}},{key:"renderOptions",value:function(e,t){var n=this;this.options.removeAll(!0);for(var r=(0,this.props.getPlayContext)(),a=this.game.time.events,o=this.json.template.json.option,i=o.rect,c=o.normal,s=o.active,l=[],d=[],h=function(o,h){var f=e[o],p=f.font,v=f.timer,m=f.background,g=f.hideTimer,y=f.disable,w=void 0!==y&&y,b=f.name,_=f.condition,x=f.sound,k=f.uuid;if(b=_e.parseValue(b,r),_){var P=_.disable,C=_.enable,S=_.expression,O=_e.safeEval(S,r);if(w=O?"disable"===C.type:"disable"===P.type,O?"hidden"===C.type:"hidden"===P.type)return d.push(Promise.resolve(!1)),"continue"}var E=i.x,I=i.y,M=i.width,A=i.height,V=c.background.url,T=c.background.url,j=s.background.url;E=null!=f.x?f.x:E,I=null!=f.y?f.y:I,E=u.b.roundToInt(E),I=u.b.roundToInt(I),m&&(M=null!=f.width?f.width:M,A=null!=f.height?f.height:A,j=m.active.url,V=m.normal.url,T=m.disable?m.disable.url:V);var U={fontSize:p.normal.font_size,fontWeight:p.normal.bold,color:p.normal.color},R={fontSize:p.disable.font_size,fontWeight:p.disable.bold,color:p.disable.color},D=ft.button({x:E,y:I,width:M,height:A},{normalUrl:V,activeUrl:j,disableUrl:T,audio:x,onClick:function(e,n){n.pointerMode===Phaser.PointerMode.CURSOR&&0!==n.button||(l.forEach(function(e){return e()}),t({type:"options",index:o}),We([k]))},textOptions:{disable:R,normal:U,active:U}});if(n.options.add(D),D.showText(!p.normal.hidden),w&&(D.disable(),D.showText(!p.disable.hidden)),D.setText(b),v){var L=_e.safeEval(v.time,r);!g&&D.setText("".concat(b,"(").concat(L,")")),d.push(new Promise(function(e,t){var r=a.loop(Phaser.Timer.SECOND,function(){n.paused||(L--,g||D.setText("".concat(b,"(").concat(L,")")),L<=0&&(a.remove(r),"disable"===v.type?(D.showText(!p.disable.hidden),D.disable(),e(!1)):(D.showText(!p.normal.hidden),D.enable(),e(!0)),D.setText(b)))});n.optionsTimeoutHandles.push(function(){a.remove(r)}),l.push(function(){a.remove(r),e(!0)})}))}else w&&d.push(Promise.resolve(!1))},f=0,p=e.length;f<p;f++)h(f);Promise.all(d).then(function(n){return n.length!==e.length||n.some(function(e){return e})?void 0:t()})}},{key:"renderBubbleBorder",value:function(e,t){return this.handleClearContinue(),new _n(this.bubbles,e,t,this.game)}},{key:"renderBubble",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.game,o=a.cache,i=a.world,c=i.width,s=i.height,l=this.props,d=l.getPlayContext,h=l.addViews,f=l.existPlotViews,p=e.type,v=e.content,m=e.avatar,g=e.role,y=e.position,w=e.animation,b=t.container,_=t.bubbleHeight,x=t.rect,k=0,P=0,C=0,O=[],E=!(g.animations&&!g.hidden||"center"!==y||m.animations&&!m.hidden),I=function(){var e=0,t=0;switch(y){case"left":e=0,t=_;break;case"center":e=x.width/2,t=_;break;case"right":var n=[x.width,_];e=n[0],t=n[1]}return{x:e,y:t,width:0,height:0}}(),M=ft.group("bubblegroup",I);b.addChild(M);var A=function(e,t){if(r)return Promise.resolve();var n=[],a=[];u.c.isObject(t)?"fadein"==t.type&&n.push(t):(n=t.filter(function(e){return"fadein"===e.type}),a=t.filter(function(e){return"moveFrom"===e.type}));var o=0,i=0,c=$.fastPlay;if(c){var s=$.getFastPlayAnimationInfo(i);o=s.delay,i=s.duration}return Promise.all([n.length>0&&H.from({target:e,properties:{alpha:0},duration:c?i:n[0].duration,ease:null,autoStart:!0,delay:c?o:n[0].delay}),a.length>0&&H.from({target:e,properties:{x:a[0].x,y:a[0].y},duration:c?i:a[0].duration,ease:null,autoStart:!0,delay:c?o:a[0].delay})])};!function(){var e=m.url,n=m.rect,r=m.hidden,a=void 0!==r&&r,i=m.animations,u=m.view,c=n.x,s=n.y,l=n.width,d=n.height;if(o.checkImageKey(e)&&"center"!==y&&!a){var p=ft.image(e),v=Math.min(l/p.width,d/p.height);p.width*=v,p.height*=v,p.x=c+(l-p.width)/2,p.y=s+(d-p.height)/2,u&&(p.inputEnabled=!0,p.events.onInputDown.add(function(e,n){n&&n.pointerMode===Phaser.PointerMode.CURSOR&&0!==n.button||!0===t.show&&(f(u)||h&&h([u]))})),i&&O.push(A(p,i)),M.add(p)}P=s+d}(),function(){var e=g.rect,t=g.data,n=g.fontFamily,r=void 0===n?"黑体":n,a=g.font_size,o=g.color,i=g.hidden,u=void 0!==i&&i,c=g.animations,s=ft.group("rolegroup",e);if(M.add(s),void 0!==c&&!u||"center"!==y&&!c&&!u){var l=_e.parseValue(t,d()),h=ft.text({x:0,y:0,width:e.width,height:e.height},{fontSize:a,forceFontFamily:r,color:o||"#000000",text:l});c&&O.push(A(s,c)),s.add(h)}k=e.y+e.height}(),function(){var e=v.url,r=v.rect,a=v.animations,i=v.viewMode,l=v.view,m=v.opacity,g=void 0===m?1:m,w=v.font_size,b=(v.fontFamily,v.background),_=v.data,x=r.x,k=r.y,P=r.width,I=r.height,V=ft.group("contentgroup",{x:x,y:E?0:k,width:P,height:I});if(M.addChild(V),"image"==p){var T=!1,j=n.json.motionImgMap,U=void 0===j?{}:j;if(u.c.isString(e)&&o.checkImageKey(e)?T=!0:u.c.isObject(e)&&e.uuid&&U[e.uuid]&&(T=U[e.uuid].images.map(function(e){return e.url}).every(function(e){return o.checkImageKey(e)})),T){var R=ft.image(e),D=Math.min(P/R.width,I/R.height);R.width*=D,R.height*=D,R.x+=(P-R.width)/2,R.y+=(I-R.height)/2,R.alpha=g,i&&0!==i&&(R.inputEnabled=!0,R.events.onInputDown.add(function(n,r){if((!r||r.pointerMode!==Phaser.PointerMode.CURSOR||0===r.button)&&!0===t.show)if(1==i){var a=ft.sprite({x:0,y:0,width:c,height:s});game.world.addChild(a),a.addChild(ft.rectMask({color:0,alpha:.5,x:0,y:0,rect:{x:0,y:0,width:c,height:s}}));var o=ft.image(e,{x:0,y:0});if(o.width>c||o.height>s){var u=Math.min(o.width/c,o.height/s);o.width*=u,o.height*=u}o.x=(c-o.width)/2,o.y=(s-o.height)/2,o.alpha=g,a.addChild(o),a.inputEnabled=!0,a.events.onInputDown.addOnce(function(){for(;a.children.length>0;)a.removeChildAt(0);game.world.remove(a),a=null})}else if(2==i){if(f(l))return;h&&h([l])}else console.warn("图片气泡未知点击类型模式！")},n)),V.add(R)}}else if("text"==p){var L="",B=1,F="center"==y?"#dadada":"right"==y?"#98e165":"#ffffff",W=!1;b&&(void 0!==b.url?(W=!0,L=b.url||"",B=b.flex||1):b.color&&(F=b.color));var N=ft.textarea({x:6,y:1,width:P+w/6-2,height:I},{color:"#000000",fontSize:w,name:"bubbledialog",forceFontFamily:"黑体"});_=_e.parseValue(_,d()),Array.isArray(_)||(_=u.c.toArrayForData(_).map(function(e){return S({},e,{color:F})}));var $=/([\s\S]*)\\(\d+)\s([\s\S]*)/;N.setTexts(_.map(function(e){for(var t=e.data,n=void 0===t?"":t,r=$.exec(n);r;)n=r[1]+r[3],r=$.exec(n);return S({},e,{data:n})}));var z=N.height>I?N.height:I;_&&_.length>0&&function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ffffff",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(""!==t){e=ft.image(t,{opacity:o});var i=a>I?a:I;i=i<35?35:i,bt.flex(r,e,{width:P,height:I});var c=ft.rectMask({rect:{width:P,height:I},alpha:0});V.addChild(c),V.mask=c}else if(!W&&((e=game.add.graphics()).beginFill(u.c.toColorValue(n),o),e.drawRoundedRect(0,0,P,a,6,6),e.endFill(),"center"!==y)){var s="left"===y?-8:8,l="left"===y?0:P,d=game.add.graphics();d.beginFill(u.c.toColorValue(n),o),d.moveTo(l,4.5),d.lineTo(l+s,12.5),d.lineTo(l,24.5),d.endFill(),V.addChildAt(d,0)}e&&V.addChildAt(e,0)}(L,F,B,z,g),N.alpha=g,I=z,V.addChild(N)}else console.warn("未知气泡内容类型！");a&&O.push(A(V,a)),C=(E?2:k)+I}();var V=E?C:Math.max(Math.max(P,k),C);return t.bubbleHeight+=V+20,t.bubbleHeight>t.rect.height&&t.onScorll(0,-(t.bubbleHeight-t.rect.height)),t.container.onUpdate(t.rect.width,t.bubbleHeight),!r&&t.save(e),Promise.all(O).then(function(){return Promise.all(void 0===w||r?[]:[A(M,w)])}).then(function(){return M})}},{key:"updateBubbleState",value:function(e){this.updateBubbleCount();var t=e.index,n=e.uuid,r=e.saveVector,a=e.show,o=e.remove,i=e.rect,u=e.scalenum,c=e.count,s=this.state.bubbleMode.findIndex(function(e){return e.index===parseInt(t)});this.state=~s?P()(this.state,{bubbleMode:x({},s,{uuid:{$set:n},index:{$set:t},show:{$set:a},currentCount:{$set:c},remove:{$set:o},rect:{$set:i},scale:{$set:u},bubble:{$set:r}})}):P()(this.state,{bubbleMode:{$push:[{bubble:[],uuid:n,index:t,show:a,currentCount:c,remove:o,rect:i,scale:u}]}})}},{key:"updateBubbleCount",value:function(){var e=this;this.state.bubbleCount=[];var t=0,n=0;for(this.bubbleBorderVector.forEach(function(t){var n=t.saveVector,r=t.index;n.forEach(function(t){return e.state=P()(e.state,{bubbleCount:{$push:[r]}})})});this.state.bubbleCount.length>1e3;)this.state.bubbleCount.shift(),t++;this.bubbleBorderVector.forEach(function(e){++n>=t||e.saveVector.shift()})}},{key:"doInTL",value:function(e){var t=this;return e!==this.timeline?Promise.reject("timeline changed"):this.paused?new Promise(function(n,r){!function a(){t.paused?t.setTimeoutId=setTimeout(a,50):e!==t.timeline?r("timeline changed"):n()}()}):Promise.resolve()}},{key:"pause",value:function(){this.paused=!0,this.dialogView&&this.dialogView.pause()}},{key:"proceed",value:function(){this.paused=!1,this.dialogView&&this.dialogView.proceed()}},{key:"playMusic",value:function(e){var t=e.url,n=e.volume;t?"inherit"===t?re.setMusicVolume(n):re.playMusic({url:t,volume:n}):re.stopMusic()}},{key:"playSound",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})||{},t=e.index,n=e.url,r=e.volume,a=e.time,o=void 0===a?1:a;n?re.playSound({channel:t,url:n,volume:r,loop:1!==o}):re.stopSound(t)}},{key:"animateScene",value:function(e){var t=this,n=this.tweens,r=e.type,a=e.duration,o=e.delay,i=e.color,u=e.level,c=e.loop,s=void 0!==c&&c;if($.fastPlay){var l=$.getFastPlayAnimationInfo(a);o=l.delay,a=l.duration}switch(this.tweens=n.filter(function(e){return e.type!==r||(e.cancel&&e.cancel(),!1)}),r){case"twinkle":var d=H.twinkle({target:this.animations,duration:a,delay:o,color:i});return d.type=r,this.tweens.push(d),d;case"shake":if(!a)return Promise.resolve();var h=u?5*u:0;return Promise.all(xn.slice(0,3).map(function(e){var n=H.shake({target:t[e],duration:a,delay:o,offSet:h,repeat:s?1/0:0});n.type=r,t.tweens.push(n)}));case"spread":var f=this.game.world,p=f.width,v=f.height,m=ft.rectMask({rect:{width:p,height:v}});return this.container.add(m,!0,0),Promise.all(xn.slice(0,7).map(function(e){var n=H.spread({target:t[e],duration:a,delay:o});n.type=r,t.tweens.push(n)})).then(function(){return m.destroy()})}}},{key:"animateImage",value:function(e){var t=this.props.getInheritBackground,n=e.index,r=e.duration,a=e.delay,o=e.x,i=e.y,u=e.opacity,c=void 0===u?1:u,s=e.scaleX,l=void 0===s?1:s,d=e.scaleY,h=void 0===d?1:d,f=e.rotate;if(1===n)return t().opacity=c,H.to({target:this.background.children[0],properties:{alpha:c},duration:r,delay:a});f=180===f?179.9:-180===f?-179.9:f;for(var p=this.images.children,v=null,m=0;m<p.length;m++){var g=p[m];if(g.zIndex===n){v=g;break}}if(v){v.tweenPromises.forEach(function(e){return e.cancel&&e.cancel()}),v.tweenPromises=[];var y=v,w=y.sourceScale,b=y.texture.frame;o+=l*w*b.width/2,i+=h*w*b.height/2,l*=w,h*=w,v.mirrorH&&(f=-f,l=-l),v.mirrorV&&(f=-f,h=-h);var _={alpha:c,angle:f,x:o,y:i,width:l*b.width,height:h*b.height},x=Object.keys(_);if($.fastPlay){var k=$.getFastPlayAnimationInfo(r);a=k.delay,r=k.duration}x.some(function(e){return v[e]!==_[e]})&&v.tweenPromises.push(H.to({target:v,properties:_,duration:r,delay:a}))}}},{key:"animateDialog",value:function(e){var t=this,n=e.duration,r=e.delay,a=e.opacity,o=void 0===a?1:a,i=e.rotate,u=e.x,c=e.y;if(this.dialogView){if($.fastPlay){var s=$.getFastPlayAnimationInfo(n);r=s.delay,n=s.duration}var l=this.dialogView.container,d=H.to({target:l,properties:{x:u,y:c,alpha:o,rotate:i},duration:n,delay:r});d.name="animateDialog",this.tweens.push(d),d.then(function(){var e=t.tweens.findIndex(function(e){return e===d});~e&&t.tweens.splice(e,1)})}}},{key:"animateSpeak",value:function(e){var t=this,n=this.dialogView.animate(),r=this.handleContinue(e);return Promise.race([n,r]).then(function(){return n.cancel&&n.cancel()}).then(function(){return t.doInTL(e)}).then(function(){return t.handleClearContinue()})}},{key:"dispatchContinueClick",value:function(){var e=this.click2continue.children;e[0]&&($.fastPlay||$.autoPlay)&&e[0].events.onInputUp.dispatch()}},{key:"handleContinue",value:function(e){var t=this,n=this.props,r=n.noShowingViews,a=n.resetPlayCount,o=this.game,i=o.input,u=i.keyboard,c=i.onHold,s=o.device.desktop,l=new Promise(function(e,n){return!s&&r()&&c.addOnce(function(){return e()},t)}),d=new Promise(function(e,n){return r()&&u.addKey(Phaser.Keyboard.Z).onDown.add(function(){return e()},t)}),h=new Promise(function(e,n){return r()&&u.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(function(){return e()},t)}),f=new Promise(function(e,n){t.click2continue.removeAll(!0);var r=t.game.world,o=r.width,i=r.height,u=ft.rectMask({rect:{width:o,height:i},alpha:0});u.inputEnabled=!0;var c={};u.events.onInputDown.add(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c={x:t.x,y:t.y}}),u.events.onInputUp.add(function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r||r.pointerMode!==Phaser.PointerMode.CURSOR||0===r.button){var o=Math.abs(c.x-r.x),i=Math.abs(c.y-r.y);Math.max(o,i)>60&&U.isAppClient()||(a(),t.click2continue.removeAll(!0),e())}}),t.click2continue.add(u)});return Promise.race([f,d,h,l]).then(function(){return t.doInTL(e)}).then(function(){return t.handleClearContinue()})}},{key:"handleClearContinue",value:function(){var e=this.game.input,t=e.keyboard,n=e.onHold;this.click2continue.removeAll(!0),n.removeAll(this),t.addKey(Phaser.Keyboard.Z).onDown.removeAll(this),t.addKey(Phaser.Keyboard.SPACEBAR).onDown.removeAll(this)}},{key:"getNextContextInStack",value:function(){for(var e=(0,this.props.getPlayContext)(),t=this.state.playStack;t&&t.length;){var n=t[0],r=n.loop,a=n.chapter,o=n.plotIndex,i=n.plots,u=n.commands,c=n.cmdIndex;if(r){var s=r.countExpr,l=r.count,d=r.condition,h=r.breakNext;if(_e.safeEval(d,e)){if(!s)return{chapter:a,plotIndex:o,plots:i,commands:u,cmdIndex:c};this.state=P()(this.state,{playStack:{0:{loop:{count:{$set:l+1}}}}});var f=parseInt(_e.safeEval(s,e),10);if(l<(f=f>=1?f:1))return{chapter:a,plotIndex:o,plots:i,commands:u,cmdIndex:c}}a=h.chapter,o=h.plotIndex,i=h.plots,u=h.commands,c=h.cmdIndex}if(t=t.slice(1),this.state=P()(this.state,{playStack:{$set:t}}),u[c])return{chapter:a,plotIndex:o,plots:i,commands:u,cmdIndex:c}}return null}},{key:"setControlPlay",value:function(e,t){var n=this;this.controlPlay=function(r){var a=r.type,o=r.control;switch(a){case"nextPlot":n.timeline={},t(P()(n.context,{cmdIndex:{$apply:function(e){return e+1}}}));break;case"back":return n.timeline={},e({type:a});case"jump":case"insertPlot":return n.timeline={},e(r);case"jumpOption":case"backOption":var i=n.state.playStack,u=parseInt(o.value)>0?o.value:0,c=i.takeWhile(function(e){return"condition_option"===e.type||"option"===e.type}).length,s=null;u>0&&c&&(c>u?(s=i[u-1],n.state=P()(n.state,{playStack:{$splice:[[0,u]]}})):(s=i[c-1],n.state=P()(n.state,{playStack:{$splice:[[0,c]]}})),s.loop&&(s=s.loop.breakNext),"backOption"===a&&(s=P()(s,{cmdIndex:{$apply:function(e){return e-1}}}))),s&&(n.timeline={},t(s));break;default:console.warn("".concat(a," is error"))}}}},{key:"play",value:function(e,t){var n=this,r=this.props,a=r.getPlayContext,o=r.noShowingViews,i=r.pushPlayback;this.context=e;var c={},s=e.load;this.timeline=c,this.controlPlay=null,s||(this.autoPlay=!1);var l=null,d=!1,h=function(e,t,r){if("loop"===t.type||"countLoop"===t.type){var a={count:1,countExpr:t.count,condition:t.expression,breakNext:r},o=S({},r,{commands:t.commands,cmdIndex:0,loop:a,type:e});n.state=P()(n.state,{playStack:{$set:[o].concat(Object(b.a)(n.state.playStack))}})}else n.state=P()(n.state,{playStack:{$set:[S({},r,{type:e})].concat(Object(b.a)(n.state.playStack))}})},f=function(e,r){var a=n.context,o=a.commands,i=a.cmdIndex,u=o[i]||{},d=u,h=d.type,f=d.args,v="autoSaveOrLoad"===h&&1===f[0].type,m=l;o=m.commands,i=m.cmdIndex;var g="setValues"==h;(g?t(u):Promise.resolve()).then(function(){u=g?null:u,o&&o[i]||(l=n.getNextContextInStack()||{});var a=l;if(o=a.commands,i=a.cmdIndex,n.timeline=c={},!o||!o[i])return t(u).then(function(){return v?null:e({})});t(u,S({},l,{load:s})).then(function(){s=!1,v||(n.context=l,p(e,r))})})},p=function e(t,r){if(c===n.timeline){if(n.paused)return n.setTimeoutId=setTimeout(function(){return e(t,r)},50);var p=n.context,v=p.commands,m=p.cmdIndex,g=v[m];if(l=S({},n.context,{cmdIndex:m+1}),!g)return f(t,r);d=!1;var y=g.type,w=g.args,_=c,k=function(){if(_===c){if(!d)return f(t,r);var e=n.click2continue.children[0];e&&e.events.onInputUp.dispatch()}};switch(n.bubbleBorderVector.forEach(function(e){return e.runNextCommand=k}),n.handleClearContinue(),y){case"animateScene":n.state=P()(n.state,{animateScene:{$set:"shake"===w[0].type&&w[0].loop?g:void 0}}),n.animateScene(w[0]);break;case"animateDialog":n.state=P()(n.state,{dialog:{animate:{$set:g}}}),n.animateDialog(w[0]);break;case"showDialog":return!s&&i(w[0]),n.renderDialog(w[0]),d=!0,n.animateSpeak(_).then(function(){var e=function(){return e=null,n.state=P()(n.state,{dialog:{$set:{command:g}}}),f(t,r)},a=function(){return e&&e()};return $.fastPlay&&o()?a():n.autoPlay||$.autoPlay&&o()?u.c.timeout(w[0].speaking.immediate?400:0).then(function(){return n.doInTL(_)}).then(function(){return a()}):n.handleContinue(_).then(a)});case"hideDialog":n.dialogView&&n.dialogView.clear(),n.dialogView=null,n.state=P()(n.state,{dialog:{$set:{}}});break;case"options":if(!w.length)break;if(!w.some(function(e){var t=e.condition;if(!t)return!0;var n=t.disable,r=t.enable,o=t.expression;return!(_e.safeEval(o,a())?"hidden"===r.type:"hidden"===n.type)}))break;return d=!0,n.game.input.onUp.dispatch(),new Promise(function(e,t){return n.renderOptions(w,e)}).then(function(e){if(n.options.removeAll(!0),e&&w[e.index].commands){var t=e.index;h("option",w[t],l),l=S({},l,{commands:w[t].commands,cmdIndex:0}),Ze.resetCommandOption(g,t)}}).then(function(){return n.doInTL(_)}).then(function(){return f(t,r)});case"conditionOptions":if(w.length){var C=a(),O=w.findIndex(function(e){return _e.safeEval(e.expression,C)});O>-1&&w[O].commands.length&&(h("condition_option",w[O],l),l=S({},l,{commands:w[O].commands,cmdIndex:0}),Ze.resetCommandOption(g,O))}break;case"autotext":n.autoPlay=w[0],n.state=P()(n.state,{autotext:{$set:g}});break;case"disableSaveOrLoad":n.state=P()(n.state,{disableSaveOrLoad:{$set:g}});break;case"wait":return d=!0,u.c.timeout(w[0].value&&$.fastPlay?10:w[0].value).then(function(){return n.doInTL(_)}).then(function(){return f(t,r)});case"hideMenu":case"showMenu":break;case"weather":n.state=P()(n.state,{weather:{$set:g}}),n.renderWeather(w[0]);break;case"back":return t({type:y});case"jump":case"insert":var E=function(){return t({type:y,control:{uuid:w[0]}})};return s?n.handleContinue(_).then(E):E();case"jumpOption":case"backOption":var I=n.state.playStack,M=parseInt(w[0].value)>0?w[0].value:0,A=I.takeWhile(function(e){return"condition_option"===e.type||"option"===e.type}).length;M>0&&A&&(A>M?(l=I[M-1],n.state=P()(n.state,{playStack:{$splice:[[0,M]]}})):(l=I[A-1],n.state=P()(n.state,{playStack:{$splice:[[0,A]]}})),l.loop&&(l=l.loop.breakNext),"backOption"===y&&(l=P()(l,{cmdIndex:{$apply:function(e){return e-1}}})));break;case"showBubble":var V=n.bubbleBorderVector.findIndex(function(e){return e.index===parseInt(w[0].index)});n.bubbleBorder=-1!==V?n.bubbleBorderVector[V]:n.renderBubbleBorder(g,k),-1==V&&n.bubbleBorderVector.push(n.bubbleBorder),-1!==V&&n.bubbleBorder.updateState(g,k),n.bubbleBorder.display(!0);return n.updateBubbleState(n.bubbleBorder),function e(t){if(0==n.bubbleBorder.saveVector.length)return Promise.resolve(!0);var r=n.bubbleBorder.saveVector[t];return n.renderBubble(r,n.bubbleBorder,!0).then(function(r){return++t>=n.bubbleBorder.saveVector.length||e(t)})}(0).then(function(){return f(t,r)});case"emitBubble":if(s)return n.handleContinue(_).then(function(){return f(t,r)});if(n.bubbleBorder){if(1!=n.bubbleBorder.show){if(n.bubbleBorder=function(){for(var e=n.bubbleBorderVector.length-1;e>=0;e--)if(1==n.bubbleBorderVector[e].show)return n.bubbleBorderVector[e];return null}(),null==n.bubbleBorder)return f(t,r)}return n.bubbleBorder.display(!0),n.renderBubble(w[0],n.bubbleBorder,!1).then(function(e){return n.updateBubbleState(n.bubbleBorder),"text"==w[0].type&&i(w[0],!0),$.fastPlay&&o()?f(t,r):n.autoPlay||$.autoPlay&&o()?u.c.timeout(400).then(function(){return n.doInTL(_)}).then(function(){return f(t,r)}):n.handleContinue(_).then(function(){return k()})})}break;case"hideBubble":var T=n.bubbleBorderVector.find(function(e){return e.index===parseInt(w[0])})||n.bubbleBorder;if(!T)break;T.clear(),T.display(!1),n.updateBubbleState(T);break;case"playSound":n.playSound(w[0]);break;case"stopSound":re.stopSound(w[0]);break;case"playMusic":n.playMusic(w[0]);break;case"stopMusic":re.stopMusic();break;case"animateSound":var j=w[0],U=j.index,R=j.volume,D=j.duration,L=j.delay;if($.fastPlay){var B=$.getFastPlayAnimationInfo(D);L=B.delay,D=B.duration}re.tweenToWithSound({volume:R,duration:D,delay:L,channel:U});break;case"animateMusic":var F=w[0],W=F.volume,N=F.duration,z=F.delay;if($.fastPlay){var H=$.getFastPlayAnimationInfo(N);z=H.delay,N=H.duration}re.tweenToWithMusic({volume:W,duration:N,delay:z});break;case"addImage":n.state=P()(n.state,{images:x({},w[0].index,{$set:{command:g}})}),n.renderImage(w[0]);break;case"animateImage":n.state=P()(n.state,{images:x({},w[0].index,{$apply:function(e){return e?S({},e,{animate:g}):e}})}),n.animateImage(w[0]);break;case"delImage":n.state=P()(n.state,{images:x({},w[0],{$set:void 0})}),n.removeImage(w[0]);break;case"addView":case"delView":n.state=P()(n.state,{views:{$apply:function(e){return"delView"===y?e.filter(function(e){return e.args[0].instanceUuid!==w[0]}):[].concat(Object(b.a)(e),[g])}}});break;case"showGlobalView":case"hideGlobalView":n.state=P()(n.state,{hideGlobalViews:{$apply:function(e){return e=e.filter(function(e){return e!==w[0]}),"showGlobalView"===y?e:[].concat(Object(b.a)(e),[w[0]])}}})}f(t,r)}};return new Promise(function(e,t){n.setControlPlay(e,function(r){n.options.removeAll(!0),n.handleClearContinue(),l=r,c=n.timeline,f(e,t)}),p(e,t)})}},{key:"clear",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.proceed(),this.tweens.forEach(function(e){return e.cancel&&e.cancel()}),this.tweens.length=0,this.state={playStack:[],images:[],dialog:{},weather:null,autotext:null,disableSaveOrLoad:null,animateScene:null,views:[],hideGlobalViews:[],bubbleMode:[]},this.dialogView&&this.dialogView.clear(),t)for(;this.bubbleBorderVector.length>0;)this.bubbleBorderVector.pop().clear(!0);else this.bubbleBorderVector.forEach(function(e){return e.clear()});for(;this.optionsTimeoutHandles.length>0;){this.optionsTimeoutHandles.pop()()}this.handleClearContinue(),xn.forEach(function(n){var r=e[n];("bubbles"!==n||t)&&r.removeAll(!0),r.y=r.x=0})}}]),e}(),Pn=(n(165),function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Cn(0,e)}},{key:"showTip",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return new Cn(1,0,e)}}]),e}()),Cn=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;Object(o.a)(this,e);try{return new Promise(function(e,a){var o=0,i=document.createElement("div");i.classList.add("shareModalContainer"),document.body.appendChild(i);var c=document.createElement("div");c.classList.add("shareModalPortal"),i.appendChild(c);var s=function(){o>0&&clearInterval(o),document.body.removeChild(i)},l=function(){return s(),a("close")},d=function(){return s(),a("cancle")},h=function(){return s(),e("close")};0===t?(c.innerHTML='<div class="friend_share_bg" id="modalPortal">\n                      <div class="share_close"><a title="关闭"></a></div>\n                      <div class="share_cont">\n                        <img src="./img/share/sword_pic.png">\n                        <p>分享可领取<span class="content">6闪币</span></p>\n                      </div>\n                      <div>\n                        <input class="cancle_btn" type="button" name="">\n                        <input class="sure_btn" type="button" name="">\n                      </div>\n                    </div>\n                    <div class="friend_shadow"></div>',c.getElementsByClassName("share_close")[0].onclick=l,c.getElementsByClassName("cancle_btn")[0].onclick=d,c.getElementsByClassName("sure_btn")[0].onclick=h,c.getElementsByClassName("content")[0].innerText="".concat(n,"闪币")):1===t&&(c.innerHTML='<div class="tip_share_bg" id="modalPortal">\n                      <div class="tip_close"><a title="关闭"></a></div>\n                      <div class="tip_cont">\n                        <p>分享太过频繁，距离下次分享还需</p>\n                        <div class="time_bg">\n                            <span class="tip_time">00:00:00</span>\n                        </div>\n                      </div>\n                      <div>\n                        <input class="cancle_btn" type="button" name="">\n                        <input class="sure_btn" type="button" name="">\n                      </div>\n                    </div>\n                    <div class="tip_shadow"></div>',c.getElementsByClassName("tip_close")[0].onclick=l,c.getElementsByClassName("cancle_btn")[0].onclick=d,c.getElementsByClassName("sure_btn")[0].onclick=h,c.getElementsByClassName("tip_time")[0].innerText=u.c.convert(r,2),o=setInterval(function(){if(--r<0)return s(),e("timeout");c.getElementsByClassName("tip_time")[0].innerText=u.c.convert(r,2)},1e3));var f=document.getElementById("modalPortal");document.body.clientWidth<=document.body.clientHeight&&(f.style.transform="rotate(90deg)");var p=function(){var e=document.documentElement.clientWidth;e>960&&(e=960);var t=Parameter.vertical,n=document.body.clientWidth<=document.body.clientHeight?5:9.6;document.documentElement.style.fontSize=e/n+"px",document.body.clientWidth<=document.body.clientHeight?f.style.transform=t?"rotate(0)":"rotate(90deg)":f.style.transform=t?"rotate(90deg)":"rotate(0)"};p(),window.onresize=function(){p()}})}catch(e){return Promise.reject("error")}},Sn=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"show",value:function(e,t,n){return new On(e=null==e?0:e,t,n)}}]),e}(),On=function e(t,n,r){Object(o.a)(this,e);try{return new Promise(function(e,a){var o=document.createElement("div");o.classList.add("intivemodalContainer"),document.body.appendChild(o);var i=document.createElement("div");i.classList.add("intivemodalPortal"),o.appendChild(i);var u=function(){document.body.removeChild(o)},c=function(e){if("getbtn get1"===e.target.className){i.getElementsByClassName("prize")[e.target.id].children[2].innerHTML='<a class="getbtn get2">已领奖励</a>';var t=0===e.target.id?5:1===e.target.id?10:2===e.target.id?20:40;r(e.target.id,t),e.stopPropagation()}};i.innerHTML='<div class="task_bg" id="modalPortal">\n                    <div class="task_close"><a title="关闭"></a></div>\n                    <div class="task_cont">\n                        <div class="banner">\n                            <img src="./img/share/banner.png">\n                        </div>\n                        <div class="task_list">\n                            <ul>\n                                <li>\n                                    <p>邀请<span>3位</span>好友获得额外奖励</p>\n                                    <div class="progress">\n                                        <i style="width:50%"></i>\n                                        <em>1 / 3</em>\n                                    </div>\n                                    <div class="prize">\n                                        <img src="./img/share/jl_coin.png" alt="">x<span>5</span>\n                                        <a class="getbtn get0">尚未达成</a>\n                                    </div>\n                                </li>\n                                <li>\n                                    <p>邀请<span>10位</span>好友获得额外奖励</p>\n                                    <div class="progress">\n                                        <i style="width:100%"></i>\n                                        <em>4/10</em>\n                                    </div>\n                                    <div class="prize">\n                                        <img src="./img/share/jl_coin.png" alt="">x<span>10</span>\n                                        <a class="getbtn get0">尚未达成</a>\n                                    </div>\n                                </li>\n                                <li>\n                                    <p>邀请<span>50位</span>好友获得额外奖励</p>\n                                    <div class="progress">\n                                        <i style="width:50%"></i>\n                                        <em>4/10</em>\n                                    </div>\n                                    <div class="prize">\n                                        <img src="./img/share/jl_coin.png" alt="">x<span>20</span>\n                                        <a class="getbtn get0">尚未达成</a>\n                                    </div>\n                                </li>\n                                <li>\n                                    <p>邀请<span>100位</span>好友得额外奖励</p>\n                                    <div class="progress">\n                                        <i style="width:50%"></i>\n                                        <em>4/50</em>\n                                    </div>\n                                    <div class="prize">\n                                        <img src="./img/share/jl_coin.png" alt="">x<span>40</span>\n                                        <a class="getbtn get0">尚未达成</a>\n                                    </div>\n                                </li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div>\n                        <input class="invate_btn" type="button" name="">\n                    </div>\n                </div>\n                <div class="friend_shadow"></div>';var s=document.getElementById("modalPortal");document.body.clientWidth<=document.body.clientHeight&&(s.style.transform="rotate(90deg)");var l=function(){var e=document.documentElement.clientWidth,t=C.a.vertical;e>960&&(e=960);var n=document.body.clientWidth<=document.body.clientHeight?5:9.6;document.documentElement.style.fontSize=e/n+"px",document.body.clientWidth<=document.body.clientHeight?s.style.transform=t?"rotate(0)":"rotate(90deg)":s.style.transform=t?"rotate(90deg)":"rotate(0)"};l(),window.onresize=function(){l()};var d=t/3>=1?100:t/3*100,h=t/10>=1?100:t/10*100,f=t/50>=1?100:t/50*100,p=t/100>=1?100:t/100*100;!function(){for(var e=0;e<4;e++){var r=i.getElementsByClassName("progress")[e];r.children[0].style.width="".concat(0===e?d:1===e?h:2===e?f:p,"%"),r.children[1].innerText="".concat(t,"/").concat(0===e?3:1===e?10:2===e?50:100),i.getElementsByClassName("prize")[e].children[2].innerHTML="1"===n[e]?'<a class="getbtn get2">已领奖励</a>':100===d?'<a class="getbtn get1" id="'.concat(e,'">领取奖励</a>'):'<a class="getbtn get0">尚未达成</a>'}}(),i.getElementsByClassName("task_close")[0].onclick=function(){return u(),a("close")},i.getElementsByClassName("invate_btn")[0].onclick=function(){return u(),e("intive")};var v=function(e){return i.getElementsByClassName("getbtn get1")[e]};v(0)&&(v(0).onclick=c),v(1)&&(v(1).onclick=c),v(2)&&(v(2).onclick=c),v(3)&&(v(3).onclick=c)})}catch(e){return Promise.reject("error")}},En=function e(){Object(o.a)(this,e)};x(En,"show",function(){return new Promise(function(e,t){var n=C.a.vertical,r=C.a.client,a=C.a.single;if("wap"===r||a)return Promise.resolve();U.switchAppBack(!1);var o=document.createElement("div");o.style.position="absolute",o.style.top=0,o.style.left=0,o.style.bottom=0,o.style.right=0,o.style.overflow="hidden";var i=document.createElement("div");o.appendChild(i),u.c.setElemetStyle(i,"transformOrigin","center");var c=top.location!==self.location,s=function(){return window.innerWidth||window.documentElement.clientWidth||window.document.body.clientWidth},l=function(){return window.innerHeight||window.documentElement.clientHeight||window.document.body.clientHeight},d=s(),h=l();if(c&&game.device.iOS&&void 0!==window.orientation){var f=90===window.orientation||-90===window.orientation;d=f?window.originalHeight:window.originalWidth,h=f?window.originalWidth:window.originalHeight}if(d<=h&&!n){var p=[d,h];h=p[0],d=p[1],i.style.transform="rotate(90deg)"}var v=function(){var e=s(),t=l(),r=function(){if(g){var r=e,a=t;e<=t&&(r=n?e:t,a=n?t:e),g.setAttribute("width",r),g.setAttribute("height",a)}i.style.transform=e<=t?n?"rotate(0)":"rotate(90deg)":n?"rotate(90deg)":"rotate(0)"};c&&game.device.iOS&&void 0!==window.orientation?u.c.timeout(50).then(function(){var n=90===window.orientation||-90===window.orientation;e=n?window.originalHeight:window.originalWidth,t=n?window.originalWidth:window.originalHeight,r()}):r()};window.addEventListener("resize",v,!0);var m,g=document.createElement("iframe");g.src=(m=C.a.gid,"".concat(Se.showGameNotice).concat(m)),g.setAttribute("scrolling","no"),g.setAttribute("width",d),g.setAttribute("height",h),g.setAttribute("frameborder",0),g.setAttribute("allowtransparency","true"),i.appendChild(g),document.body.appendChild(o),window.addEventListener("message",function(t){var n=t.data;try{(n=JSON.parse(n)).isHide&&"none"===n.isHide&&(window.removeEventListener("resize",v,!0),document.body.removeChild(o),U.switchAppBack(!0),game.gameResumed(),e())}catch(e){}},!1)})});var In={logo:"logo",cover:"cover",scene:"scene",mainMenu:"mainMenu",settings:"settings",loadRecord:"loadRecord",saveRecord:"saveRecord",playback:"playback",diyMainMenu:"diyMainMenu"},Mn=["plotViews","calledViews","globalViews","globalCalledViews","menus","space","menuViews","menuCalledViews"],An=0,Vn=[],Tn=0,jn=0,Un=0,Rn=0,Dn=!1,Ln=!1,Bn=function(){function e(t,n,r){var a=this;Object(o.a)(this,e),x(this,"findGivenView",function(e){var t=a.json.viewMap;for(var n in t){var r=t[n];if(r&&r.name==e)return r}return null}),x(this,"handleShareBack",function(e,t){if(!e)return Et({type:Ot,text:"分享失败!"}),Promise.reject(t);Et({type:St,text:"分享成功!"}),An=u.a.passSeconds;var n=C.a.qz_sharecount,r=C.a.qz_pindex;if(n<10){var a=r||134;t=P()(t,{playContext:{payValues:x({},a,{value:{$apply:function(e){return e+1}}})}}),Ut.uploadPayValues(t.playContext,[],!0)}return Rt.runSpecialEvents(Vn,t)}),x(this,"handleShare",function(e){var t=e.isInvite,n=void 0!==t&&t,r=e.force,o=void 0!==r&&r,i=e.context,c=function(e){return new Promise(function(e,t){return M.b.addEventsSharePanelQzone(function(t){return e(t)})}).then(function(t){return a.handleShareBack(t,e)},function(){return e})};if(0==An||u.a.passSeconds-An>=60){if(o){if(n){var s=C.a.qz_receivecount,l=C.a.qz_invitecount,d=qz_pindex||134,h=0,f=-1;l>=3&&l<10?"1"!==s[0]&&(h=5,f=0):l>=10&&l<50?"1"!==s[1]&&(h=10,f=1):l>=50&&l<100?"1"!==s[2]&&(h=20,f=2):l>100&&"1"!==s[3]&&(h=40,f=3),i=P()(i,{playContext:{payValues:x({},d,{value:{$apply:function(e){return e+h}}})}}),Ut.uploadPayValues(i.playContext,[],!0),-1!==f&&(C.a.qz_receivecount[f]="1"),M.b.postGetPrizeQzone()}return M.b.openShareMessageQzone(n).then(function(){return c(i)},function(){return i})}return n?M.b.getIntiveInfoQzone().then(function(e){if(!e)return Et({type:Ot,text:"邀请人数信息获取失败,稍后重试！"}),Promise.reject(i);var t=C.a.qz_invitecount,r=C.a.qz_receivecount,u=qz_pindex||134;return Sn.show(t,r,function(e,t){i=P()(i,{playContext:{payValues:x({},u,{value:{$apply:function(e){return e+t}}})}}),Ut.uploadPayValues(i.playContext,[],!0),C.a.qz_receivecount[e]="1",M.b.postGetPrizeQzone()}).then(function(){return M.b.openShareMessageQzone(!0)},function(e){return"error"===e?a.handleShare({isInvite:n,force:o,context:i}):i})}).then(function(){return c(i)},function(){return i}):Pn.show(1).then(function(){return M.b.openShareMessageQzone().then(function(){return c(i)},function(){return i})},function(e){return"error"===e&&a.handleShare({isInvite:n,force:!0,context:i}),i})}return o?(Et({type:Ot,text:"分享太过频繁，距离下次分享还需".concat(u.c.convert(60-u.a.passSeconds-An,2))}),Promise.reject(i)):Pn.showTip(60-u.a.passSeconds-An).then(function(e){return"timeout"===e?a.handleShare({isInvite:n,force:o,context:i}):i},function(){return i})}),x(this,"handleLogin",function(){var e=game.world,t=bt.fullScreenTip({text:"更新用户数据",alpha:.5});e.add(t);var n=C.a.uuid,r=a.getSavedRecords(!0),o=r.records,i=r.owner;a.records.owner!==i&&""!==a.records.owner&&U.localStorageSetItem("".concat(n).concat(a.records.owner),JSON.stringify(a.records.local)),o.some(function(e){return e})?a.records.local=o:U.localStorageSetItem("".concat(n).concat(i),JSON.stringify(a.records.local)),a.records.cloud=new Array(12).fill(null),a.records.owner=i,Ut.updateUserAccInfo(a.playContext,!0).then(function(n){a.playContext=n,e.remove(t,!0)})}),x(this,"handleLogout",function(){var e=game.world,t=bt.fullScreenTip({text:"更新用户数据",alpha:.5});e.add(t);var n=C.a.uuid,r=a.getSavedRecords(),o=r.records,i=r.owner;a.records.owner!==i?U.localStorageSetItem("".concat(n).concat(a.records.owner),JSON.stringify(a.records.local)):o=a.records.local,a.records={local:o,owner:i,cloud:new Array(12).fill(null)},a.playContext=P()(a.playContext,{systemValues:x({},0,{value:{$set:0}})}),Ut.updateUserAccInfo(a.playContext).then(function(n){a.playContext=n,e.remove(t,!0)})}),x(this,"handleMenuClick",function(){if(!a.state.loading){var e=a.json,t=a.playContext,n=a.handleShare,r=a.inputs.views,o=a.game.world,i=o.width,c=o.height,s=e.default_settings.mainMenu,l=function(e){return a.menus.visible=e};if(l(!1),s&&s.ref){Mn.slice(5).forEach(function(e){return a[e].visible=!0}),a.state.plotSnap=u.c.getSnap(),a.targetScene&&a.targetScene.pause(),r.forEach(function(e){return e.show(!1)}),a.playContext.openPages.unshift(In.diyMainMenu);var d=ft.rectMask({rect:{width:i,height:c},alpha:0});d.inputEnabled=!0,a.space.add(d);var h=Rt.instanceView(s,e,t),f=P()(a.viewContext,{menuViews:{$set:[h]},menuCalledViews:{$set:[]}});Rt.runOnLoadEventInView([0,["menuViews",null]],{playContext:t,viewContext:f,game:e,handleShare:n}).then(function(e){return a.handleChangeContext(e)})}else a.showSystemUI(In.mainMenu,function(){return l(!0)})}}),x(this,"handleHoldFastPlay",function(e){var t=a.playContext.openPages,n=void 0===t?[]:t,r=a.inputs,o=r.diyMainMenu,i=r.views,u=a.targetScene,c=a.noShowingViews,s=a.state,l=s.loading,d=s.inputing,h=u&&u.options&&u.options.children.length>0;if(!e||n[0]!==In.scene||h||l||d||!c())return a.holdFastPlayTip&&a.holdFastPlayTip.destroy(),a.holdFastPlayTip=null,n[0]!==In.scene?(i.forEach(function(e){return e.show(!1)}),o.forEach(function(e){return e.show(n.some(function(e){return e===In.diyMainMenu}))})):[].concat(Object(b.a)(i),Object(b.a)(o)).forEach(function(e){return e.show(!0)}),void($.fastPlay=!1);if($.fastPlay=!0,[].concat(Object(b.a)(o),Object(b.a)(i)).forEach(function(e){return e.show(!1)}),!a.holdFastPlayTip){var f=a.game.world,p=f.centerX,v=f.centerY,m=ft.group(),g=ft.image("app_button_speed",{x:p,y:v,centre:!0});m.add(g),p-=g.width/2,v-=g.height/2;var y=ft.image("app_icon_speed",{x:p+90,y:v+25});m.add(y),m.add(ft.text({x:p+80,y:v+y.height+40},{fontSize:25,forceFontFamily:"宋体",color:"#333333",text:"快进中..."})),m.add(ft.text({x:p+40,y:v+y.height+75},{fontSize:20,forceFontFamily:"宋体",color:"#aaadb3",text:"松开手指恢复播放"})),f.add(m),a.holdFastPlayTip=m}}),x(this,"handleKeyDown",function(e){if(!a.state.inputing){var t=a.targetScene,n=a.noShowingViews,r=a.state,o=r.loading,i=r.inputing,u=t&&t.options&&t.options.children.length>0;e.keyCode!==Phaser.Keyboard.Z||u||o||i||!n()||($.fastPlay=!0)}}),x(this,"handleKeyUp",function(e){if(!a.state.inputing){var t=a.playContext,n=a.viewContext,r=a.json;if(e.keyCode!==Phaser.Keyboard.Z){var o=[In.scene,In.diyMainMenu],i=t.openPages,u=void 0===i?[]:i;if(o.some(function(e){return e===u[0]})){var c=Rt.fixContext({game:r,playContext:t,viewContext:n}),s=Promise.resolve(c),l=u[0]===In.diyMainMenu;a.keyUpListeners.forEach(function(t){s=l?t.isDiyMenuView?s.then(function(n){return t.handle(e.keyCode,n)}):s:s.then(function(n){return t.handle(e.keyCode,n)})}),s.then(function(e){return c!==e&&a.handleChangeContext(e)})}}else $.fastPlay=!1}}),x(this,"resetPlayCount",function(){Rn>=300&&(jn=0),Rn=0}),x(this,"handleTimer",function(){var e=[In.scene,In.diyMainMenu],t=a.playContext,n=a.viewContext,r=a.json,o=t.openPages,i=void 0===o?[]:o;if(e.some(function(e){return e===i[0]})){var c=Rt.fixContext({game:r,playContext:t,viewContext:n}),s=Promise.resolve(c),l=i[0]===In.diyMainMenu;a.timerListeners.forEach(function(e){s=l?e.isDiyMenuView?s.then(function(t){return e.handle(t,10)}):s:s.then(function(t){return e.handle(t,10)})}),s.then(function(e){return c!==e&&a.handleChangeContext(e)})}Un!==u.a.passSeconds&&!1!==Dn&&(Un=u.a.passSeconds,Rn++,++jn>=60&&Rn<300&&(Ge(jn),jn=0)),u.c.timeout(10).then(function(){return a.handleTimer()})}),x(this,"handleViewMount",function(e,t,n){var r=a.viewContext,o=a.playContext,i=t.events,u=t.view,c=u.events,s=u.type,l=u.content,d=l.step,h=l.count,f=l.value;e.viewData=t,e.pathInfos=Rt.getViewPathInfos(n,r);var p=e.destroy;e.destroy=function(){a.handleViewUnmount(e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];p.apply(e,n)};var v=_t.stringify(n).includes("menu"),m=i.some(function(e){return"onKeyUp"===e.type})||c.some(function(e){return"onKeyUp"===e.type}),g=i.some(function(e){return"onClick"===e.type})||c.some(function(e){return"onClick"===e.type});if(m){var y={type:"keyup",isDiyMenuView:v,viewPathInfos:Rt.getViewPathInfos(n,r),handle:function(e,t){y.viewPathInfos=Rt.updateViewPathInfos(y.viewPathInfos,t.viewContext);var n=y.viewPathInfos[y.viewPathInfos.length-1].path;if(_t.get(t.viewContext,n))return Rt.runEventInView("onKeyUp",n,t,e);var r=a.keyUpListeners.indexOf(y);return~r&&a.keyUpListeners.splice(r,1),Promise.resolve(t)}};a.keyUpListeners.push(y)}if("timer"!==s){if("input"===s){var w=f.arg1,b=-1,_={type:s,index:b};-1!==(b=o.values.findIndex(function(e){return e.uuid===w}))?(e.isNumber=!0,_={index:b,type:"values"}):-1!==(b=o.savedValues.findIndex(function(e){return e.uuid===w}))?(e.isNumber=!0,_={index:b,type:"savedValues"}):-1!==(b=o.stringValues.findIndex(function(e){return e.uuid===w}))?_={index:b,type:"stringValues"}:-1!==(b=o.payValues.findIndex(function(e){return e.uuid===w}))&&(e.isNumber=!0,_={index:b,type:"payValues"});-1===b&&(e.text="[未知数值]"),e.setInputCallback(function(e,t){return function(n){if(a.state.inputing=!n,n){var r=t.text,o=t.isNumber,i=e.index,u=e.type,c=a.playContext;if(o&&(r=parseFloat(r)),-1!==i){a.playContext=P()(c,x({},u,x({},i,{value:{$set:r}})));var s=t.pathInfos;if(!t.parent)return;var l=s[s.length-1].path,d=a.viewContext;if(_t.get(d,l)){var h=_t.createQuery(l,{view:{content:{value:{value:{$set:r}}}}});a.viewContext=P()(d,h)}}else t.text="[未知数值]"}}}(_,e)),v?a.inputs.diyMainMenu.push(e):a.inputs.views.push(e),$.fastPlay&&a.holdFastPlayTip&&e.show(!1)}if("text"===s){if(!g){var k=e.input;return void(k?(e.inputEnabled=!1,k.removedFromGroup()):e.ignoreChildInput=!0)}e instanceof Phaser.Group&&e.children.forEach(function(e){e.inputEnabled=!0,e.input&&(e.input.useHandCursor=!0)})}e.inputEnabled=!0;var C=function(t,n){if(!n||n.pointerMode!==Phaser.PointerMode.CURSOR||0===n.button){var r=a.viewContext,o=a.playContext,i=e.pathInfos=Rt.updateViewPathInfos(e.pathInfos,r),u=i[i.length-1].path,c=Rt.fixContext({game:a.json,playContext:o,viewContext:r});Rt.runEventInView("onClick",u,c).then(function(e){return e!==c&&a.handleChangeContext(e)})}};e instanceof Phaser.Group?e.onChildInputUp.add(C):e.events.onInputUp.add(C)}else{var S={type:"timer",isDiyMenuView:v,viewPathInfos:Rt.getViewPathInfos(n,r),step:d.value,count:h.value,current:t.currentCount*d.value||0,stop:!1,handle:function(e,t){S.current+=t,S.viewPathInfos=Rt.updateViewPathInfos(S.viewPathInfos,e.viewContext);var n=S.viewPathInfos[S.viewPathInfos.length-1].path,r=_t.get(e.viewContext,n);if(r&&"timer"===r.view.type){var o=S.current/S.step;if(!(S.current%S.step)){if(r.currentCount=o,!S.count||S.count>=o)return Rt.runEventInView("onStep",n,e);S.count<o&&(S.stop=!0)}}if(!r||"timer"!==r.view.type||S.stop){var i=a.timerListeners.indexOf(S);~i&&a.timerListeners.splice(i,1)}return Promise.resolve(e)}};a.timerListeners.push(S)}}),x(this,"handleViewUpdate",function(e,t,n){var r=a.viewContext;e.viewData=t,e.pathInfos=Rt.getViewPathInfos(n,r);for(var o=a.timerListeners,i=0,u=o.length;i<u;i++){var c=o[i];c.viewPathInfos=Rt.updateViewPathInfos(c.viewPathInfos,r);var s=c.viewPathInfos[c.viewPathInfos.length-1].path;_t.isSame(n,s)&&(t.currentCount=o[i].current=0)}}),x(this,"handleViewUnmount",function(e){var t=e.viewData.view.type,n=a.inputs,r=n.diyMainMenu,o=n.views,i=a.viewContext;if("input"===t){var u=r.findIndex(function(t){return t===e});~u?r.splice(u,1):~(u=o.findIndex(function(t){return t===e}))&&o.splice(u,1)}e.viewData=null,e.pathInfos=null;var c=function(e){for(var t=0;t<e.length;t++){var n=e[t].viewPathInfos,r=Rt.updateViewPathInfos(n,i),a=r[r.length-1].path;_t.get(i,a)||(e.splice(t,1),t--)}};c(a.keyUpListeners),c(a.timerListeners)}),x(this,"showPlotViews",function(){a.plotViews.visible=!0,a.calledViews.visible=!0,!a.noShowingViews()&&a.game.input.onUp.dispatch()}),x(this,"existPlotViews",function(e){var t=e.ref,n=e.instanceUuid;return-1!==a.viewContext.plotViews.findIndex(function(e){return e.ref==t&&e.instanceUuid==n})}),x(this,"noShowingViews",function(){var e=a.viewContext,t=e.plotViews,n=void 0===t?[]:t,r=e.calledViews,o=void 0===r?[]:r;return!(n.length||o.length)}),x(this,"addViews",function(e){var t=a.playContext,n=a.handleShare,r=a.json,o=(e=e.map(function(e){return Rt.instanceView(e,r,t)})).map(function(e){return e.instanceUuid});return function e(t,n){var r=o[n];if(!r)return Promise.resolve(t);for(var a,i=t.viewContext.plotViews;r&&!i.some(function(e){return e.instanceUuid===r});)r=o[++n];return r?(a=i.findIndex(function(e){return e.instanceUuid===r}),Rt.runOnLoadEventInView([a,["plotViews",null]],t).then(function(t){return e(t,n+1)})):Promise.resolve(t)}({viewContext:P()(a.viewContext,{plotViews:{$push:e}}),game:r,playContext:t,handleShare:n},0).then(function(e){return a.handleChangeContext(e)})}),x(this,"delView",function(e){var t=P()(a.viewContext,{plotViews:{$apply:function(t){var n=t.findIndex(function(t){return t.instanceUuid===e});return~n?t.filter(function(e,t){return t!==n}):t}}});a.handleChangeViewContext(t)}),x(this,"pushPlayback",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=a.playContext,r=e[t?"content":"speaking"].data,o=e[t?"role":"dialogtitle"].data,i=e[t?"role":"dialogtitle"].hidden,u="";o=_e.parseValue(o,n),!i&&o.length&&(u=o+":"),r=_e.parseValue(r,n),Array.isArray(r)?r.forEach(function(e){return u+=e.data}):u+=r,u&&n.playback.push(u)}),x(this,"runCommandAfter",function(e,t){if(!e)return Promise.resolve();Ze.resetComandAfter(e),Ze.resetCommandOption(e);var n=t?function(e){var t=e.commands,n=e.cmdIndex,r=Ze.getCommand(t[n]),o=Ze.getUsing(),i=[];[].concat(Object(b.a)(r),Object(b.a)(o)).forEach(function(e){var t=e.type,n=e.url,r=i.findIndex(function(e){return e.url===n});~r?i[r].count++:i.push({type:t,url:n,count:1})});var u=i.map(function(e){var t=e.type,n=e.url,r=e.count;return Ze.inCache(t,n)?Ze.isSafeRef(t,n,r)?null:(Ze.addRefTo(t,n,"play",r),null):{type:t,url:n}}).filter(function(e){return e});return u.length?a.loadAssets(u,!0):Promise.resolve()}(t):Promise.resolve(),r=a.json.default_settings.autoSaveOrLoad,o=e.type,i=e.args;switch(o){case"addView":a.game.input.onUp.dispatch(),n=n.then(function(){return a.addViews(i)});break;case"delView":a.delView(i[0]);break;case"showGlobalView":case"hideGlobalView":a.handleChangeViewContext(P()(a.viewContext,{globalViews:{$apply:function(e){var t=e.findIndex(function(e){return e.instanceUuid===i[0]});return~t?P()(e,x({},t,{visible:{$set:"showGlobalView"===o}})):e}}}));break;case"setValues":n=n.then(function(){return Ut.updatePayValues(a.playContext,i).then(function(e){return a.updatePlayContext(_e.setContextByValueHandles(e,i)),Ut.uploadPayValues(a.playContext,i)})});break;case"autoSaveOrLoad":if(t&&t.load)break;if(r&&1===i[0].type)n=n.then(function(){return a.autoLoadRecord().then(null,function(){return I.a.warn("Sorry~读不到存档内容，即将返回封面").then(function(){return a.start(),Promise.reject()},function(){return a.start(),Promise.reject()})})});else if(r&&0===i[0].type){var c=a.context,s=c.commands,l=c.cmdIndex,d=s&&s[l];d&&d.uuid===e.uuid&&(n=n.then(function(){return u.c.timeoutByPhaser(1)})),n=n.then(function(){return a.autoSaveRecord()})}break;case"systemUI":var h=i[0];switch(h){case"settings":h=In.settings;break;case"playback":h=In.playback;break;case"save-record":h=In.saveRecord;break;case"load-record":h=In.loadRecord;break;default:h=null}h&&(n=n.then(function(){return new Promise(function(e,t){return a.showSystemUI(h,function(){return e()})})}))}return n}),x(this,"getSavedRecords",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=C.a.uuid,n=C.a.uid,r=U.localStorageGetItem("".concat(t).concat(n))||"";e&&""==r&&(r=U.localStorageGetItem("".concat(t))||"",U.localStorageRemoveItem("".concat(t)));try{r=(r=r.replace(/\r/g,"\\r").replace(/\n/g,"\\n"))?JSON.parse(r):new Array(12).fill(null)}catch(e){r=new Array(12).fill(null)}return void 0!==(r=r.map(function(e){if(!e||!Object.keys(e).length)return null;var t=e.plotSnap;return S({},e,{thumb:e.thumb||t})})).find(function(e){return null!==e})&&U.localStorageSetItem("".concat(t).concat(n),JSON.stringify(r)),{records:r,owner:n}}),x(this,"getLocalRecords",function(){var e=C.a.alpha,t=C.a.client;return C.a.uid!==a.records.owner&&a.clearRecords(),Tn=0,e?ze().then(function(n){if(!n&&e&&t){var r=function(){return window.location.href="lzj3000://quit"};return I.a.warn("内测作品，请登录内测账号试玩！").then(r,r),Promise.reject()}return Promise.resolve(a.records.local)}):Promise.resolve(a.records.local)}),x(this,"getCloudRecords",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=C.a.alpha,n=C.a.uid,r=C.a.client,o=C.a.gid;n!==a.records.owner&&a.clearRecords();var i=Promise.resolve();return t&&(i=ze().then(function(e){if(!e){var t=function(){return window.location.href="lzj3000://quit"};return I.a.warn("内测作品，请登录内测账号试玩！").then(t,t),Promise.reject()}})),i.then(function(){return Be(99).then(function(e){return("pc"===r?Ue():Promise.resolve()).then(function(){e=e?JSON.parse(e):new Array(12).fill(null);var t=[];return a.records.cloud=e.map(function(e,n){if(e&&Object.keys(e).length){var r="",a=e.time_stamp,i=e.plot_snap,u=void 0===i?"":i,c=e.plotUuid;if(!u||!a||!c){if(!c||u||""===Ce.cover_url||!a)return null;r="".concat(Ce.cover_url).concat(o,"-").concat(C.a.uid,"-").concat(n,".jpg?coverran=").concat(1e5*Math.random()),C.a.offline&&r.indexOf("file://")>-1&&(r=r.replace(/file:\/\//,"https://")),t.push({type:"image",url:r})}return u&&(r=u.startsWith("data:image/jpeg;base64,")?u:"data:image/jpeg;base64,".concat(u)),{timestamp:(a+"").length>10?a:1e3*a,thumb:r}}return null}),Tn=1,a.loadAssets(t,!0).then(function(){return a.records.cloud})})},function(t){if(!e)return Promise.reject();Tn=0;var n=t.status,r=t.msg;return!U.isAppClient()&&a.game.scale.stopFullScreen(),$.full=!1,999==n?(I.a.error("网络异常，请检查您的网络！"),Promise.reject()):(I.a.error(r),Promise.reject())})})}),x(this,"checkRecordIsCloud",function(){return 1==Tn?De().then(function(){return!0},function(){return Promise.resolve(!1)}):Promise.resolve(!1)}),x(this,"autoLoadRecord",function(){return a.checkRecordIsCloud().then(function(e){return a.loadRecord(0,!e,!0)})}),x(this,"autoSaveRecord",function(){return u.c.timeout(0).then(function(){return a.state.plotSnap=u.c.getSnap(),a.checkRecordIsCloud().then(function(e){return a.saveRecord(0,!e,!0)})})}),x(this,"handleclickRecord",function(e,t,n){if("save"===e){var r=C.a.client,o=C.a.wap,i=Promise.resolve();return P.a||("pc"===r?i=Ue().then(function(){return!0},function(){return!1}):"wap"===r&&"wx"!==o&&(i=je())),i.then(function(){return a.saveRecord(t,n)})}return a.loadRecord(t,n)}),x(this,"getlockRecord",function(){var e=$.records.filter(function(e){return 0!==e.price});if(0==e.length)return Promise.resolve([]);var t=function(e,t){for(var n=[],r=function(r){var a=t[r];n.push(e.filter(function(e){return e.uuid==a}))},a=0;a<t.length;a++)r(a);return e.concat.apply(e,n).filter(function(e,t,n){return n.indexOf(e)===n.lastIndexOf(e)})};return 1==C.a.type?Promise.resolve(t(e,u.c.typeUnlockRecords)):Ke().then(function(n){return t(e,n)},function(t){return Promise.resolve(e)})}),x(this,"hideBackground",function(){return a.background&&(a.background.visible=!1)}),x(this,"setBackground",function(e){var t=a.background&&a.background.info||{},n=e.url,r=void 0===n?"":n,o=e.flex,i=void 0===o?1:o,u=e.opacity,c=void 0===u?1:u;if("inherit"===r){var s=t.url;r=void 0===s?"":s;var l=t.flex;i=void 0===l?1:l;var d=t.opacity;c=void 0===d?1:d}var h=a.game.world,f=h.width,p=h.height,v=(a.background||{}).visible,m=void 0!==v&&v;a.background&&(a.background.key=""),h.remove(a.background,!0,!0),a.background=null,r?(a.background=ft.image(),a.background.scale=new PIXI.Point(1,1),a.background.loadTexture(r)):a.background=ft.rectMask({rect:{width:f,height:p}}),a.background.visible=m,a.background.alpha=c,a.background.inputEnabled=!0,a.background.y=a.background.x=0,a.background.info={url:r,flex:i,opacity:c},r&&bt.flex(i,a.background,{width:f,height:p}),h.add(a.background,!0,0),r&&Ze.addRef("image",r,"using"),t.url&&Ze.subRef("image",t.url,"using")}),x(this,"start",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];a.resetPlayCount(),a.targetScene&&a.targetScene.clear(e),e&&a.commandScene&&a.targetScene!==a.commandScene&&a.commandScene.clear(!0),Ze.clearPreload();var t=C.a.uuid,n=C.a.uid,r=C.a.gid,o=C.a.client,i=a.game.world,u=a.json,c=a.playContext,s=u.cover,l=u.views;a.handleChangeViewContext({plotViews:[],calledViews:[],globalViews:[],globalCalledViews:[],menuViews:[],menuCalledViews:[]}),a.menus.visible=!1;var d=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return P()(e,{value:{$set:_e.safeInitValue(e)}})})};c=P()(c,{stack:{$set:[]},playback:{$set:[]},openPages:{$set:[In.cover]},values:{$set:d(u.values)},stringValues:{$set:d(u.stringValues)},indexValues:{$set:d(u.indexValues)}});var h=U.localStorageGetItem("".concat(t,"savedValues").concat(n));if(h){var f=c.savedValues;h=JSON.parse(h);for(var p=function(e){var t=h[e],n=t.uuid,r=t.value,a=f.findIndex(function(e){return e.uuid===n});~a&&(c=P()(c,{savedValues:x({},a,{value:{$set:r}})}))},v=0;v<h.length;v++)p(v)}if(a.playContext=c,"ios"===o||"android"===o||"wap"===o){var m="".concat(t).concat(r,"GameNotice"),g=U.localStorageGetItem(m)||"";He().then(function(e){e>g&&(U.localStorageSetItem(m,e),En.show())})}var y=function(){var e=a.playContext,t=a.viewContext,n=a.handleShare;Ln||(U.notifyGameStarted(),Dn=!0,Ln=!0),e.openPages=[];var r=l.map(function(t){return Rt.instanceView(t,u,e)});Rt.runOnLoadEvent(["globalViews",null],{playContext:e,viewContext:S({},t,{globalViews:r}),game:u,handleShare:n}).then(function(e){a.menus.visible=!0,a.handleChangeContext(e),a.playContext.openPages.push(In.scene);var t=e.controlPlay,n=a.firstChapter;return t&&"jump"===t.type&&(n=pe.getChapterByUUID(u,t.uuid)),a.getChapterData(n).then(function(e){var t={stack:a.stack,chapter:e,plots:e.plots,plotIndex:0};return Ze.getPreload(t).then(function(e){return a.loadAssets(e)}).then(function(){return a.play(t)},function(e){return console.warn(e)})})})};if(!s||s.hidden)return a.setBackground({}),y();var w=s.background,b=s.music;a.setBackground(w),a.background.visible=!0,b&&b.url?re.playMusic(b):re.stopMusic(),re.stopAllSound(),a.coverView=Nt({gameJson:u,callbacks:{start:function(){return y()},load:function(){return a.showSystemUI(In.loadRecord)},settings:function(){return a.showSystemUI(In.settings)}}}),i.add(a.coverView.container)}),this.audioMap={sounds:new Array(10).fill(null),music:null};var i=t.add,c=t.cache,s=t.device.desktop,l=t.input,d=l.keyboard,h=l.onHold,f=l.onUp,p=l.onDown,v=t.onPause,m=n.template.json.sound;c.checkSoundKey(m.url)&&($.buttonOverSound=i.sound(m.url,m.volume)),this.state={inputing:!1,loading:!1},this.game=t,this.json=n,this.firstChapter=pe.getFirstChapter(n);var g=function(){return a.playContext},y=this.setBackground,w=this.showPlotViews,_=this.hideBackground,k=this.noShowingViews,O=this.autoSaveRecord,E=this.addViews,A=this.pushPlayback,V=this.existPlotViews,T=this.resetPlayCount,j={game:t,json:n,getPlayContext:g,getInheritBackground:function(){return a.background&&a.background.info||{url:"",flex:1,opacity:1}},setBackground:y,showPlotViews:w,hideBackground:_,noShowingViews:k,autoSaveRecord:O,addViews:E,pushPlayback:A,existPlotViews:V,resetPlayCount:T};this.scene=new bn(j),this.commandScene=new kn(j),this.groups=ft.group();var R=function(e){var t=a.json,n=a.playContext,r=a.viewContext,o=Rt.fixContext({game:t,playContext:n,viewContext:r});a.handleShare({isInvite:e,context:o}).then(function(e){return a.handleChangeContext(e)})};Mn.forEach(function(e){var t="menus"===e?hn({template:n.template,callbacks:{menu:a.handleMenuClick,share:R}}):ft.group(e);a[e]=a.groups.add(t)}),this.playContext=S({bubbleMode:[],bubbleCount:[],stack:[],playback:[],openPages:[]},r),this.viewContext={plotViews:[],calledViews:[],globalViews:[],globalCalledViews:[],menuViews:[],menuCalledViews:[]},at.playContext=g(),u.c.preUid=C.a.uid,Tn=""===C.a.uid?0:1;var D=this.getSavedRecords(!0),L=D.records,B=D.owner;this.records={local:L,owner:B,cloud:new Array(12).fill(null)},this.keyUpListeners=[],this.timerListeners=[],this.inputs={views:[],diyMainMenu:[]},U.setCallback("updatevolume",function(e){re.externalProhibitVolume=0==e,re.updateMusicVolume(e,!0),re.updateSoundsVolume(e,!0)}),this.handleTimer(),d.addCallbacks(this,this.handleKeyDown,this.handleKeyUp),s||(h.add(function(){return a.handleHoldFastPlay(!0)}),f.add(function(){return a.handleHoldFastPlay(!1)})),p.add(function(){t.gameResumed();var e=a.inputs,n=e.diyMainMenu,r=e.views;[].concat(Object(b.a)(r),Object(b.a)(n)).forEach(function(e){var t=e.element;t&&t.blur()}),!Ln&&a.targetScene&&(U.notifyGameStarted(),Ln=!0,Dn=!0)}),v.add(function(){return f.dispatch()}),U.setCallback("login",this.handleLogin),U.setCallback("logout",this.handleLogout),U.setCallback("restart",function(e){var n=a.inputs,r=n.diyMainMenu,o=n.views,i=a.holdFastPlayTip,c=a.playContext,s=a.state,l=a.space;i&&i.destroy(),[].concat(Object(b.a)(r),Object(b.a)(o)).forEach(function(e){return e.show(!1)}),c.openPages.unshift(In.diyMainMenu),s.plotSnap=null,l.removeAll(!0),t.onRestart.dispatch(),u.c.timeout(50).then(function(){return a.start(e)})}),U.setCallback("showSave",function(){a.holdFastPlayTip&&a.holdFastPlayTip.destroy(),a.showSystemUI(In.saveRecord),t.gameResumed()}),"pc"===C.a.client&&($.musicVolume=.5,$.soundVolume=.5,U.gameReady());var F=C.a.wap,W=C.a.single;if("qzone"===F){var N=C.a.qz_vindex,z=C.a.shareViewName,H=C.a.shareViewName1,q=C.a.inviteViewName,G=C.a.refreshViewName,K=N||177;this.playContext=P()(this.playContext,{values:x({},K,{value:{$set:1}})}),M.b.addEventsSharePanelQzone(function(e){var t=a.json,n=a.playContext,r=a.viewContext,o=Rt.fixContext({game:t,playContext:n,viewContext:r});a.handleShareBack(e,o).then(function(e){return a.handleChangeContext(e)})});var J=this.findGivenView(z),Q=this.findGivenView(H),Y=this.findGivenView(q),Z=this.findGivenView(G);J&&J.events.unshift({type:"onClick",name:J.name,expression:{type:"literal",value:"1"},events:[{type:"share",handle:{uuid:J.name}}]}),Q&&Q.events.unshift({type:"onClick",name:Q.name,expression:{type:"literal",value:"1"},events:[{type:"share",handle:{uuid:Q.name}}]}),Y&&Y.events.unshift({type:"onClick",name:Y.name,expression:{type:"literal",value:"1"},events:[{type:"share",handle:{uuid:Y.name}}]}),Z&&(Vn=Object(b.a)(Z.events))}if(W){var X=this.findGivenView("g6Hsa9WoK8"),ee=this.findGivenView("UGTmkxnxi"),te=this.findGivenView("SHANexit"),ne=this.findGivenView("SHANcharge");X&&X.events.unshift({type:"onClick",name:X.name,expression:{type:"literal",value:"1"},events:[{type:"playad",handle:{uuid:X.name}}]}),te&&te.events.unshift({type:"onClick",name:te.name,expression:{type:"literal",value:"1"},events:[{type:"loginout",handle:{uuid:te.name}}]}),ne&&ne.events.unshift({type:"onClick",name:ne.name,expression:{type:"literal",value:"1"},events:[{type:"recharge",handle:{uuid:ne.name}}]}),ee&&(Vn=Object(b.a)(ee.events)),U.setCallback("rechargeback",function(e){1==e&&Ut.updateAccinfo(a.playContext).then(function(e){return a.playContext=e})})}this.showLogo().then(function(){U.toOpenNotice(),a.start()})}return Object(i.a)(e,[{key:"loadAssets",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.game,a=r.load,o=r.world,i=bt.fullScreenTip({text:"加载中...",alpha:.5}),u=i.getByName("text");return n&&(i.alpha=0),new Promise(function(n,r){var c={};e.forEach(function(e){var t=e.type,n=e.url;Ze.inCache(t,n)||(c[n]=!1,a.cancelForceRemoveFile(t,n),Ze.load(t,n,!0,!0))});var s=Object.keys(c).length;if(!s)return i.destroy(!0),Ze.startLoadThread(),n();o.add(i),t.state.loading=!0;var l=Object.create(null),d=0,h=function(){d===s&&(a.onSoundExtendLoad.removeAll(l),a.onSoundExtendLoadError.removeAll(l),a.onFileComplete.removeAll(l),o.remove(i,!0),t.state.loading=!1,Ze.startLoadThread(),n())},f=function(e){c[e]||void 0===c[e]||(c[e]=!0,d++,u.text="加载中...".concat(parseInt(100*d/s),"%")),h()};a.onSoundExtendLoad.add(function(e){return f(e)},l),a.onSoundExtendLoadError.add(function(e){return f(e)},l),a.onFileComplete.add(function(e,t,n,r,a){return f(t)},l,0),a.onLoadComplete.addOnce(function(){return h()},l,0),a.start()})}},{key:"unlockChapterForWapOther",value:function(e){var t=e.uuid,n=e.charge,r=e.md5,a=e.handleProgress,o=C.a.uuid,i=C.a.wap,c=function(){return Ne(t,r,a)},s=0,l=function e(t){return s>=5&&Promise.reject(),s++,"success"===t?c().then(null,function(){return e("error")}):I.a.custom("Info","未查询到你的付费信息哦，请确认已支付再点击刷新。如未购买请退出或重新购买~","提示","重试","退出",!1,3,0).then(function(){return c().then(null,function(){return e("error")})},function(){return Promise.reject()})};return Fe(o,t,null,"app").then(function(e){var t=e.charge;return u.c.timeout(100).then(function(){return t})}).then(function(e){return I.a.custom("Info","当前为收费章节，需支付".concat(e,"元解锁观看"),"章节收费提示","支付","取消",!1)}).then(function(){return"qh"===i?M.b.qhpay(n,t,u.c.generateUUID(),t,null,0).then(l):Promise.reject()}).then(null,function(){return I.a.custom("Error","仍未查询到您的支付信息哦，请确认已经支付~ 如有疑问请添加闪艺客服QQ：819786897 ~","提示","复制QQ","取消",!1).then(function(){return wt()("819786897",{debug:!1,message:"复制成功"})}),Promise.reject()})}},{key:"unlockChapter",value:function(e){var t=e.uuid,n=e.charge,r=e.md5,a=e.handleProgress,o=e.name,i=void 0===o?"":o,c=C.a.uuid,s=C.a.client,l=(C.a.gid,C.a.wap),d=-1,h=-1,f=-1,p=-1,v="",m="",g=u.a.getCurDate();return Fe(c,t,null,"app").then(function(e){return d="pc"===s?e.charge:e.special_price,h=e.charge_app,f=e.charge_pc,!0}).then(function(){return"pc"!==s&&(C.a.uid=C.a.uid||u.c.getUidByCookie())}).then(function(){if("wap"===s){if("wx"===l)return I.a.custom("Info","请在应用商店下载闪艺app，阅读完整版作品","提示","知道了","取消",!1),Promise.reject();if(!C.a.uid)return je().then(function(){if(!C.a.uid)return I.a.info("该章节为付费章节，需登录后查看~").then(function(){return U.login(),Promise.reject()},function(){return Promise.reject()})})}else"pc"===s&&(p=-1!==f?f:n,v=me.a.hash(c+t+p+g+"4shan3yi9xia9men"),m=me.a.hash(c+t+100*n+g+"4shan3yi9xia9men"));return Promise.resolve()}).then(function(){return U.unlockChapter({uuid:t,md5:r,charge:n,discounts:d,charge_app:h,charge_pc:f,chaptername:i,time:g,token:v,starToken:m})}).then(function(e){return!e&&"pc"!==s||"pc"===s&&0==e?Promise.reject():Ne(t,r,a).then(null,function(){return"wap"===s?U.login():"pc"!==s&&I.a.error("获取付费章节信息失败"),Promise.reject()})})}},{key:"getChapterData",value:function(e){var t=this,n=e.downloadUuid,r=e.uuid,a=e.plots,o=void 0===a?[]:a,i=e.md5,c=e.charge,s=e.name,l=void 0===s?"":s,d=n||r,h=C.a.isWapOther,f=C.a.gid,p=C.a.client,v=C.a.wap,m=C.a.type;C.a.single;if(o.length&&!U.isFinishedPreferentialChapter(d))return Promise.resolve(e);if(!i&&!o.length)return Promise.resolve(e);var g=!!o.length;o.length=0,this.state.loading=!0;var y=game.world,w=bt.fullScreenTip({text:"章节信息获取中...",alpha:.5,fontSize:16}),_=w.getByName("text");y.add(w);var x=function(e){var t=e.loaded;return _.text="章节信息获取中...".concat(t)},k=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return"ios"!==p&&"android"!==p||!e?Ne(d,i,x).then(P):Promise.reject()},P=function(){var n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.state.loading=!1,(n=e.plots).push.apply(n,Object(b.a)(r)),y.remove(w,!0),e},S=function(e){return U.removeFinishedPreferentialChapter(d),P(e)},O=function(){return t.state.loading=!1,y.remove(w,!0),Promise.reject()};if(c&&("ios"===p||"android"===p||"wap"===p||"pc"===p||1==m)){if(1==m){var E=u.c.typeUnlockChapters.findIndex(function(e){return e==d})>-1;return u.c.typeUnlockChapters[0]&&"all"==u.c.typeUnlockChapters[0]&&(E=!0),E?k():I.a.info("此处为收费章节，需要收取".concat(c,"闪币")).then(k,O)}return ze().then(function(e){return e?(I.a.info("作品内测期间，暂不支持购买付费章节。"),Promise.reject()):k(!0).then(null,function(){return U.isFinishedPreferentialChapter(d)&&g?I.a.custom("Info","作品限免已结束，需要付费才能继续观看哦","限免提示","取消","去支付",!0).then(function(){return O()},function(e){return"cancel"===e?t.unlockChapter({uuid:d,charge:c,md5:i,handleProgress:x,name:l}).then(S,O):O()}):t.unlockChapter({uuid:d,charge:c,md5:i,handleProgress:x,name:l}).then(S,O)})})}return k().then(null,function(e){var n=e.code,r=e.message;return 87==n?O():999==n?(I.a.info(r),O()):h?t.unlockChapterForWapOther({uuid:d,charge:c,md5:i,handleProgress:x}).then(S,O):"zxwwap"===v?(I.a.info("当前为收费章节，是否前往闪艺抢先体验？").then(function(){return window.location.href="https://wap.3000.com/?m=detail&op=index&ac=index&id=".concat(f)}),O()):(I.a.info("当前为收费章节，请前往闪艺app或电脑端进行购买"),O())})}},{key:"hidePlotViews",value:function(){this.plotViews.visible=!1,this.calledViews.visible=!1}},{key:"clearPlotViews",value:function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.length?[]:e};this.handleChangeViewContext(P()(this.viewContext,{plotViews:{$apply:e},calledViews:{$apply:e}}))}},{key:"showGlobalViews",value:function(){var e=P()(this.viewContext,{globalViews:{$apply:function(e){return e.map(function(e){return P()(e,{visible:{$set:!0}})})}}});this.handleChangeViewContext(e)}},{key:"hideGlobalViews",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=P()(this.viewContext,{globalViews:{$apply:function(t){return t.map(function(t){return P()(t,{visible:{$set:!e.find(function(e){return t.instanceUuid===e})}})})}}});this.handleChangeViewContext(t)}},{key:"updatePlayContext",value:function(e){if(e.savedValues!==this.playContext.savedValues){var t=C.a.uuid,n=C.a.uid;U.localStorageSetItem("".concat(t,"savedValues").concat(n),JSON.stringify(e.savedValues))}this.playContext=e}},{key:"loadAssetsByContext",value:function(e){var t=this,n=e.commands,r=e.cmdIndex,a=e.plots,o=e.plotIndex,i=e.commandState,u=[];i&&u.push.apply(u,Object(b.a)(Ze.getCommandState(i)));var c=n?Ze.needLoadByCommands(n.slice(r,r+20)):Ze.needLoadByPlot(a[o]),s=Ze.getUsing(),l=[];return[].concat(u,Object(b.a)(c),Object(b.a)(s)).forEach(function(e){var t=e.type,n=e.url,r=l.findIndex(function(e){return e.url===n});~r?l[r].count++:l.push({type:t,url:n,count:1})}),l.every(function(e){var t=e.type,n=e.url,r=e.count;return Ze.inCache(t,n)&&Ze.isSafeRef(t,n,r)})?Promise.resolve():Ze.getPreload(S({},e,{stack:this.playContext.stack})).then(function(e){return t.loadAssets(e)})}},{key:"play",value:function(e,t,n){var r=this;this.resetPlayCount();var a=function(e){var t=e.commands,n=e.plots,r=e.plotIndex;return!t&&n[r]&&n[r].commands?P()(e,{commands:{$set:n[r].commands},cmdIndex:{$set:0}}):e},o=function(e){var t=e||{},n=t.chapter,r=t.plots,a=t.plotIndex;return!(!n.md5||n.plots!==r||0!==a)||e&&r&&r[a]},i=e=a(e),u=i.commands,c=i.plots,s=i.plotIndex,l=i.chapter,d=i.commandState;this.context=e;var h=!!u,f=this.scene,p=Promise.resolve();if(this.targetScene&&this.targetScene.clear(),this.hideBackground(),h){if(f=this.commandScene,this.clearPlotViews(),this.showGlobalViews(),d){var v=d.plotViews,m=void 0===v?[]:v,g=d.calledViews,y=void 0===g?[]:g,w=d.hideGlobalViews,_=void 0===w?[]:w;this.handleChangeViewContext(P()(this.viewContext,{plotViews:{$set:m},calledViews:{$set:y},globalViews:{$apply:function(e){return e.map(function(e){return P()(e,{visible:{$set:!_.find(function(t){return t===e.instanceUuid})}})})}}})),p=f.setState(d,t)}}else{var k=c[s],C=k.hideGlobalViews,O=void 0===C?[]:C,E=k.values,M=void 0===E?[]:E,A=k.views,V=void 0===A?[]:A,T=k.animations,j=void 0===T?[]:T,U=k.autoSaveOrLoad;if(j.some(function(e){var t=e.type;return"fadein"===t||"coverblack"===t})&&this.background&&(this.background.visible=!0),this.hidePlotViews(),f.renderBackground(k),!t){if(this.json.default_settings.autoSaveOrLoad&&U&&1===U.type)return this.autoLoadRecord().then(null,function(){return I.a.warn("Sorry~读不到存档内容，即将返回封面；点击确定后返回封面，点击取消后留在当前剧情。").then(function(){return r.start()})});this.clearPlotViews(),this.hideGlobalViews(O),p=Ut.updatePayValues(this.playContext,M).then(function(e){return r.updatePlayContext(_e.setContextByValueHandles(e,M)),r.pushPlayback(k),Ut.uploadPayValues(r.playContext,M).then(function(){if(V.length){var e=r.playContext,t=r.json,n=r.handleShare,a=r.viewContext,o=V.map(function(n){return Rt.instanceView(n,t,e)}),i={playContext:e,viewContext:S({},a,{plotViews:o,calledViews:[]}),game:t,handleShare:n};return Rt.runOnLoadEvent(["plotViews",null],i).then(function(e){return r.handleChangeContext(e)})}})})}}var R=this.game.world;this.targetScene?R.replace(this.targetScene.container,f.container):R.add(f.container),this.targetScene=f,R.add(this.groups),this.playContext.openPages[0]!==In.scene&&this.targetScene.pause(),p.then(function(){return f.play(S({},e,{load:t,restore:n}),r.runCommandAfter)}).then(function(t){var n,i=t.type,u=t.control,d=r.commandScene.getBubbleState(),f=d.bubbleMode,p=d.bubbleCount;r.playContext=P()(r.playContext,{bubbleMode:{$set:f},bubbleCount:{$set:p}});var v=c[s];Ze.resetPlotAfter(v);var m=function(){return r.playContext=P()(r.playContext,{stack:{$set:[]}})},g=function(e){return r.playContext=P()(r.playContext,{stack:{$set:[e].concat(Object(b.a)(r.playContext.stack))}})};switch(i){case"back":e=null,m();break;case"jump":var y=pe.getChapterByUUID(r.json,u.uuid);e=y?{chapter:y,plots:y.plots,plotIndex:0}:null,m();break;case"jumpOption":case"backOption":var w=parseInt(u.value)>0?u.value:0,_=r.playContext.stack.takeWhile(function(e){return"condition_option"===e.type||"option"===e.type}).length;w>0&&_&&(_>w?(e=r.playContext.stack[w-1],r.playContext=P()(r.playContext,{stack:{$splice:[[0,w]]}})):(e=r.playContext.stack[_-1],r.playContext=P()(r.playContext,{stack:{$splice:[[0,_]]}})),e.loop&&(e=e.loop.breakNext),"backOption"===i&&(e=P()(e,{plotIndex:{$apply:function(e){return e-1}},commands:{$set:null}})));break;case"option":case"condition_option":Ze.resetPlotOption(v,"".concat(i,"s"),u.index);var k=v["".concat(i,"s")][u.index];if(e=S({},e,{plotIndex:s+1,commands:null}),k&&k.plots&&k.plots.length)if("loop"===k.type||"countLoop"===k.type){var C={chapter:l,plots:k.plots,plotIndex:0};g(S({},C,{loop:{count:1,countExpr:k.count,condition:k.expression,breakNext:e},type:i})),e=C}else g(S({},e,{type:i})),e={chapter:l,plots:k.plots,plotIndex:0};break;case"insert":case"insertPlot":i="insertPlot";var O=u.from,E=void 0===O?"view":O;if(v.back&&(e=null,m()),v.insert){var I=pe.getChapterByUUID(r.json,v.insert);I?(e&&g(S({},e,{type:i})),e={chapter:I,plots:I.plots,plotIndex:0}):e=null}if("view"===E){var M=pe.getChapterByUUID(r.json,u.uuid);if(M){if(h){var A=r.viewContext,V=A.plotViews,T=A.calledViews,j=r.targetScene.getState();e=S({},e=r.targetScene.context,{cmdIndex:e.cmdIndex+1,commandState:S({plotViews:V,calledViews:T},j)})}e&&g(S({},e,{type:i})),e={chapter:M,plots:M.plots,plotIndex:0}}else e=null}break;default:x(n={plots:c,plotIndex:s,chapter:l},"plotIndex",s+1),x(n,"commands",null),e=n}if(!e)return r.start();o(e)||(e=r.getContextInStack()),e&&o(e)?(e&&l.uuid!==e.chapter.uuid&&Ze.resetInsertAfter(l,e.chapter),r.getChapterData(e.chapter).then(function(){"insertPlot"===i&&Ze.resetInsert(e.chapter),"jump"===i&&Ze.resetJump(e.chapter),("condition_option"!==i||"option"!==i)&&Ze.resetPlotOption(v),e=a(e),r.loadAssetsByContext(e).then(function(){r.handleChangeViewContext(P()(r.viewContext,{menuViews:{$set:[]},menuCalledViews:{$set:[]}})),r.play(e)},function(e){return console.warn(e)})},function(){if(h){var t=r.viewContext,n=t.plotViews,o=t.calledViews,c=r.targetScene.getState();e=S({},e=r.targetScene.context,{commandState:S({plotViews:n,calledViews:o},c)})}else e=r.context;if("insertPlot"===i){var s=function(){return r.playContext=P()(r.playContext,{stack:{$set:r.playContext.stack.slice(1)}})},l=function(e,t){var n=r.playContext.stack;return n[0]&&n[0].type===e&&n[0].chapter.uuid===t},d=u.from;"view"===(void 0===d?"view":d)&&l("insertPlot",u.uuid)&&s(),v.insert&&l("insertPlot",v.insert)&&s(),v.jump&&l("jump",v.jump)&&s()}e=a(e),r.loadAssetsByContext(e).then(function(){r.handleChangeViewContext(P()(r.viewContext,{menuViews:{$set:[]},menuCalledViews:{$set:[]}})),r.play(e,!0,!0)},function(e){return console.warn(e)})})):r.handleOver()},function(e){return console.warn(e)})}},{key:"getContextInStack",value:function(){for(var e=this,t=function(t){return e.playContext=P()(e.playContext,{stack:{$set:[t].concat(Object(b.a)(e.playContext.stack))}})};this.playContext&&this.playContext.stack&&0<this.playContext.stack.length;){var n=this.playContext.stack[0],r=n.chapter,a=n.plotIndex,o=n.plots,i=n.type,u=n.loop;if(u){var c=u.condition,s=u.countExpr,l=u.count,d=u.breakNext;if(_e.safeEval(c,this.playContext)){if(!s)return{chapter:r,plotIndex:a,plots:o};this.playContext=P()(this.playContext,{stack:{0:{loop:{count:{$set:l+1}}}}});var h=parseInt(_e.safeEval(s,this.playContext),10);if(l<(h=h>=1?h:1))return{chapter:r,plotIndex:a,plots:o}}r=d.chapter,a=d.plotIndex,o=d.plots}else if("insertPlot"===i){var f=n.commands,p=n.cmdIndex,v=n.commandState;if(v){var m=v.bubbleMode;if(m.length>0)for(var g=function(e){var t=m[e],n=[];t.bubble.forEach(function(e){e.args&&n.push(S({},e.args[0]))}),t.bubble=n},y=0;y<m.length;y++)g(y)}if(this.playContext=P()(this.playContext,{stack:{$set:this.playContext.stack.slice(1)}}),f)return{chapter:r,plotIndex:a,plots:o,commands:f,cmdIndex:p,commandState:v};var w=o[a],_=(w&&w.condition_options||[]).findIndex(function(t){return _e.safeEval(t.expression,e.playContext)});if(_>=0){var x=w.condition_options[_],k={chapter:r,plots:o,plotIndex:a+1};if(x&&x.plots&&x.plots.length)if("loop"===x.type||"countLoop"===x.type){var C={chapter:r,plots:x.plots,plotIndex:0};t(S({},C,{loop:{count:1,countExpr:x.count,condition:x.expression,breakNext:k},type:"condition_option"})),k=C}else t(S({},k,{type:"condition_option"})),k={chapter:r,plots:x.plots,plotIndex:0};return k}if(w.jump){var O=pe.getChapterByUUID(this.json,w.jump);if(O)return this.playContext=P()(this.playContext,{stack:{$set:[]}}),{chapter:O,plots:O.plots,plotIndex:0}}if(o[a+1])return{chapter:r,plots:o,plotIndex:a+1};continue}if(this.playContext=P()(this.playContext,{stack:{$set:this.playContext.stack.slice(1)}}),"jump"===i||o[a])return{chapter:r,plotIndex:a,plots:o}}return null}},{key:"handleOver",value:function(){var e=this;this.holdFastPlayTip&&this.holdFastPlayTip.destroy();var t=this.inputs,n=t.diyMainMenu,r=t.views,a=this.holdFastPlayTip;a&&a.destroy(),[].concat(Object(b.a)(n),Object(b.a)(r)).forEach(function(e){return e.show(!1)}),this.playContext.openPages.unshift(In.diyMainMenu),u.c.timeout(50).then(function(){e.state.plotSnap=u.c.getSnap();var t=e.game.world,n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(sn?sn.update(e):sn=new ln(e)).container}({callbacks:{back:function(){e.state.plotSnap=null,e.start(!0)},load:function(){return r(In.loadRecord)},save:function(){return r(In.saveRecord)}}}),r=function(r){n.visible=!1,t.remove(n,!1),e.showSystemUI(r,function(){return n.visible=t.add(n)})};t.add(n)})}},{key:"clearRecords",value:function(){var e=C.a.uid,t=this.records,n=this.json.default_settings.autoSaveOrLoad;if(t.owner!==e){""!==e&&""!=t.owner&&u.c.preUid!=t.owner&&u.c.preUid!=e&&(u.c.preUid=t.owner);var r=this.getSavedRecords(!0),a=r.records,o=r.owner;this.records={local:a,owner:o,cloud:new Array(12).fill(null)},n&&(this.records.local[0]=t.local[0])}}},{key:"saveRecord",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var a=C.a.uuid,o=C.a.uid;if("pc"===C.a.client&&""!=u.c.preUid&&o!=u.c.preUid&&(""!==this.records.owner&&(this.records.owner!=o||this.records.owner!=u.c.preUid)||""==this.records.owner&&this.records.owner!=u.c.preUid))return I.a.error("无法存读档，请登录正确的帐号后重新尝试！").then(function(){return""===o?U.login():null},function(){}),Promise.reject();o!==this.records.owner&&this.clearRecords();var i=this.playContext,c=this.context,s=this.json,l=this.viewContext;if(0===e&&s.default_settings.autoSaveOrLoad&&!r)return Promise.resolve();var d=this.targetScene===this.commandScene,h=l.plotViews,f=l.calledViews,p=Ce.to({context:d?this.commandScene.context:c,playContext:i,viewContext:l,game:s,background:this.background&&this.background.info||{},plotSnap:this.state.plotSnap,commandState:d?S({plotViews:h,calledViews:f},this.commandScene.getState()):null});return t?(this.records.local[e]=p,a&&U.localStorageSetItem("".concat(a).concat(o),JSON.stringify(this.records.local)),Promise.resolve()):function(e,t){Re={time:null,requestPromise:null};var n=C.a.client,r=C.a.u,a=C.a.v,o=C.a.token,i=C.a.app_name,c=C.a.device_name,s=C.a.deviceOsVer,l=C.a.gid,d=C.a.app_version,h=function(e,t){return Object(we.c)({url:e,data:t}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.resolve({code:we.a.ERROR,message:"Get saveRecord failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.msg;return 0===r?void 0:Promise.reject("".concat(a,"- status:").concat(r))})},f=r&&o?1:0,p="";t.hasOwnProperty("thumb")&&(p=JSON.parse(JSON.stringify(t.thumb)).split(",")[1],delete t.thumb);var v=u.c.encodeBase64(JSON.stringify(t)),m=u.a.getCurDate(),g=""===l?1:parseInt(l),y="",w=e+"";y=f?"app_name=".concat(i||"shanyi","&content=").concat(v,"&cover_content=").concat(p,"&device_name=").concat(c||"Google Nexus S","&device_system_version=").concat(s||"4.1.1")+"&gid=".concat(g,"&progress=1&time=").concat(m,"&token=").concat(o,"&type=").concat(w,"&u=").concat(r,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"):"content=".concat(v,"&cover_content=").concat(p,"&gid=").concat(g,"&progress=1&time=").concat(m,"&type=").concat(w,"&v_key=0GjRAtUUoK4BwJGUz73jBa2M");var b="content=".concat(Oe(v,f),"&gid=").concat(Oe(g,f),"&progress=").concat(Oe(1,f))+"&sign=".concat(Oe(me.a.hash(me.a.hash(y)),f),"&time=").concat(Oe(m,f),"&type=").concat(Oe(w,f),"&cover_content=").concat(Oe(p,f));return r&&o?h("".concat(Se.appSaveRecord,"&client=").concat(n,"&v=").concat(a,"&app_version=").concat(d),"".concat(b,"&").concat(Le())):h(Se.wapSaveRecord,b)}(e,p).then(function(){return n.records.cloud[e]=p},function(e){return I.a.error("存档异常：".concat(e))})}catch(e){console.error(e)}}},{key:"loadRecord",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.playContext,o=this.viewContext,i=this.records.local,c=this.json,s=this.game.world,l=c.motionImgMap,d=a.openPages,h=bt.fullScreenTip({text:"加载存档中...",alpha:.5});s.add(h);return function n(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t||a?i[e]?Promise.resolve(i[e]):(s.remove(h,!0),Promise.reject()):Be(e).then(function(e){return(e=e?JSON.parse(e):null)||(r?n(!0):(s.remove(h,!0),I.a.error("存档信息获取错误"),Promise.reject()))},function(e){var t=e.msg;return 999==e.status?I.a.error("网络异常，请检查您的网络！"):I.a.error(t),s.remove(h,!0),Promise.reject()})}().then(function(e){return function(e){var t={},r=Ce.getChapterUuids(e);h.visible=!1;return function e(a,o){if(o>=r.length)return h.visible=!0,Promise.resolve();var i=pe.getChapterByUUID(c,a);return i?n.getChapterData(i).then(function(){return e(r[++o],o)},function(){return i.charge?t.chargeError=!0:t.loadError=!0,e(r[++o],o)}):(t.disappear=!0,e(r[++o],o))}(r[0],0).then(function(){return t.chargeError?(s.remove(h,!0),Promise.reject()):t.loadError?(s.remove(h,!0),I.a.error("存档章节加载错误"),Promise.reject()):t.disappear?(s.remove(h,!0),I.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),Promise.reject()):e})}(e)}).then(function(e){if("98865"==C.a.gid&&"d9892b31-c3a8-4d63-82b4-1b22d6223b4e"==e.chapterUuid&&"0e95a10d-5e45-47ee-9282-fa28f7098fc9"==e.plotUuid&&(e.plotUuid="03e37f5d-5487-41fb-8f9f-e92569eaab77"),!(e=Ce.format(e,c)))return s.remove(h,!0),Promise.reject();var t=e,r=t.speakings,i=t.musics,f=void 0===i?[]:i,p=t.sounds,v=t.backgroundObject,m=void 0===v?{}:v,g=t.commandUuid,y=e.values,w=y.values,_=y.savedValues,x=y.stringValues,k=y.indexValues,O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={};return t.forEach(function(e){return n[e.uuid]=void 0!==e.value?e.value:_e.safeInitValue(e)}),e.map(function(e){var t=e.uuid;return void 0!==n[t]?P()(e,{value:{$set:n[t]}}):e})};a=P()(a,{playback:{$set:r},values:{$apply:function(e){return O(e,w)}},savedValues:{$apply:function(e){return O(e,_)}},stringValues:{$apply:function(e){return O(e,x)}},indexValues:{$apply:function(e){return O(e,k)}}});var E=Ce.restore(e,c,a),I=E.stack,M=E.plotViews,A=E.globalViews,V=E.context;if(!V)return s.remove(h,!0),Promise.reject();var T=V.bubbleMode,j=void 0===T?[]:T,U=V.bubbleCount,R=void 0===U?[]:U;a=P()(a,{stack:{$set:I},openPages:{$set:[In.scene]},bubbleMode:{$set:j},bubbleCount:{$set:R}}),o=P()(o,{plotViews:{$set:M},calledViews:{$set:[]},globalViews:{$set:A},globalCalledViews:{$set:[]},menuViews:{$set:[]},menuCalledViews:{$set:[]}});var D=[],L=function(e,t){if(e&&u.c.isString(e)&&"inherit"!==e)D.push({type:t,url:e});else if(u.c.isObject(e)){if(!l||!e.uuid||!l[e.uuid])return;var n=l[e.uuid].images;(void 0===n?[]:n).forEach(function(e){var n=e.url;return D.push({type:t,url:n})})}};Ze.clearPreload(),Ze.getUsing().forEach(function(e){var t=e.type,n=e.url;return L(n,t)}),L(m.url,"image"),f[0]&&L(f[0].url,"audio"),p.forEach(function(e){return e&&L(e.url,"audio")});var B=Promise.resolve();return g?V.commandState&&D.push.apply(D,Object(b.a)(Ze.getCommandState(V.commandState))):(D.push.apply(D,Object(b.a)(Ze.getCommandState({bubbleMode:j}))),B=n.commandScene&&n.commandScene.setBubbleState(j,R)),s.remove(h,!0),u.c.preUid=n.records.owner,B.then(function(){return Ze.getPreload(S({},V,{stack:n.playContext.stack})).then(function(e){return n.loadAssets([].concat(D,Object(b.a)(e)))}).then(function(){setTimeout(function(){n.playContext=a,n.handleChangeViewContext(o),n.setBackground(m),n.menus.visible=!0,n.state.plotSnap=null,n.space.removeAll(!0),n.menuViews.removeAll(!0),n.menuCalledViews.removeAll(!0),n.commandScene&&n.commandScene.clear(!0),n.targetScene&&n.targetScene.proceed(),n.targetScene&&(n.targetScene.timeline={}),D.forEach(function(e){var t=e.type,n=e.url;return Ze.addRef(t,n)});var e=n.inputs,t=e.diyMainMenu,r=e.views;([].concat(Object(b.a)(t),Object(b.a)(r)).forEach(function(e){return e.show(!0)}),re.playMusic(f[0]||{}),re.stopAllSound(),p.forEach(function(e,t){return e&&e.url?re.playSound(S({},e,{channel:e.index||t})):re.stopSound(t)}),Ze.clearUselessRef(),d.some(function(e){return e===In.cover})&&n.coverView&&n.coverView.close(),V.commands)&&("systemUI"===(V.commands[V.cmdIndex]||{}).type&&V.cmdIndex++);Ut.updatePayValues(n.playContext,[],!0).then(function(e){n.playContext=P()(n.playContext,{payValues:{$set:e.payValues}}),n.play(V,!0)})},0)},function(e){return console.warn(e)})})})}},{key:"showSystemUI",value:function(e,t){var n=this,r=this.playContext,a=r.openPages,o=r.playback,i=[In.cover,In.scene,In.diyMainMenu];if(a.length&&i.some(function(e){return e===a[0]})){a[0]!==In.diyMainMenu&&(this.state.plotSnap=u.c.getSnap()),this.targetScene&&this.targetScene.pause();var c=this.inputs,s=c.diyMainMenu,l=c.views,d=this.json.template,h=this.game.world;[].concat(Object(b.a)(s),Object(b.a)(l)).forEach(function(e){return e.show(!1)});var f=function(){a.shift(),i.some(function(e){return e===a[0]})?(a[0]!==In.diyMainMenu?(n.targetScene&&n.targetScene.proceed(),[].concat(Object(b.a)(s),Object(b.a)(l)).forEach(function(e){return e.show(!0)})):s.forEach(function(e){return e.show(!0)}),t&&t()):v(a[0])},p=function(e){a.unshift(e),v(e)},v=function e(t){switch(t){case In.settings:return void h.add(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(zt?zt.update(e):zt=new Zt(e)).container}({template:d,callback:f}));case In.playback:return void h.add(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(tn?tn.update(e):tn=new nn(e)).container}({template:d,callback:f,records:o}));case In.loadRecord:case In.saveRecord:return n.canOpenRecord(In.loadRecord)?void h.add(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(un?un.update(e):un=new cn(e)).container}({mode:t===In.loadRecord?"load":"save",gameJson:n.json,callback:f,getLocal:n.getLocalRecords,getCloud:n.getCloudRecords,clickRecord:n.handleclickRecord,lockRecord:n.getlockRecord,getPlayContext:function(){return n.playContext}})):(f(),void Et({type:Ot,text:"抱歉，作者在此设置了禁用".concat(t===In.loadRecord?"读":"存","档")}));case In.mainMenu:var r=function(t){n.canOpenRecord(t)?p(t):(e(In.mainMenu),Et({type:Ot,text:"抱歉，作者在此设置了禁用".concat(t===In.loadRecord?"读":"存","档")}))};return void h.add(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(Xt?Xt.update(e):Xt=new en(e)).container}({template:d,callbacks:{load:function(){return r(In.loadRecord)},save:function(){return r(In.saveRecord)},playback:function(){return p(In.playback)},settings:function(){return p(In.settings)},autoplay:function(){n.targetScene&&n.targetScene.dispatchContinueClick(),f()},back:f}}))}};p(e)}}},{key:"handleChangeViewContext",value:function(e){var t=this;if(e!==this.viewContext){var n=this.viewContext;this.viewContext=e,Object.keys(n).forEach(function(r){if(e[r]!==n[r]){var a=t[r].children,o=e[r];Rt.updateViews({nodes:a,viewDatas:o,parent:t[r],path:[r,null],onMount:t.handleViewMount,onUpdate:t.handleViewUpdate})}})}}},{key:"canOpenRecord",value:function(e){var t=e===In.loadRecord?"load":"save",n=this.playContext.openPages,r=this.context;if(n[n.length-1]===In.cover)return!0;var a=r.commands,o=r.plots,i=r.plotIndex;if(a){var u=this.targetScene.getState().disableSaveOrLoad;if(u&&u.args[0][t])return!1}else{var c=o[i];if(c.disableSaveOrLoad&&c.disableSaveOrLoad[t])return!1}return!0}},{key:"handleChangeContext",value:function(e){var t=this,n=e.viewContext,r=e.openPages,a=void 0===r?[]:r,o=e.closePages,i=void 0===o?[]:o,u=e.controlAudio,c=void 0===u?{}:u,s=e.controlPlay,l=e.playContext;l!==this.playContext&&this.updatePlayContext(l);var d=this.playContext.openPages;(i&&i[0]===In.diyMainMenu&&(d[0]===In.diyMainMenu||d[0]!==In.diyMainMenu)||d[0]===In.diyMainMenu&&s)&&(this.inputs.views.forEach(function(e){return e.show(!0)}),this.menus.visible=!0,this.state.plotSnap=null,this.space.removeAll(!0),this.menuViews.removeAll(!0),this.menuCalledViews.removeAll(!0),d[0]===In.diyMainMenu&&this.playContext.openPages.shift(),n=P()(n,{menuViews:{$set:[]},menuCalledViews:{$set:[]}}),this.targetScene&&this.targetScene.proceed());if(a.length&&(a=a.map(function(e){switch(e){case"settings":return In.settings;case"playback":return In.playback;case"save-record":return In.saveRecord;case"load-record":return In.loadRecord}})).length){var h=a[0],f=!0;if(h!==In.loadRecord&&h!==In.saveRecord||!(f=this.canOpenRecord(h))&&Et({type:Ot,text:"抱歉，作者在此设置了禁用".concat(h===In.loadRecord?"读":"存","档")}),f){var p=function(e){return Mn.slice(5).forEach(function(n){return t[n].visible=e})};p(!1),this.showSystemUI(h,function(){return p(!0)})}}if(this.handleChangeViewContext(n),c.stopSound)for(var v=0;v<10;v++)re.stopSound(v);else c.updateSounds&&c.sounds.forEach(function(e,t){e&&"inherit"!==e.url?re.playSound(S({},e,{loop:!e.time,channel:t})):e||re.stopSound(t)});if(c.music?re.playMusic(c.music):c.stopMusic&&re.stopMusic(),s&&this.targetScene&&this.targetScene.controlPlay){var m=s.type;if(this.targetScene===this.commandScene)return void this.targetScene.controlPlay(s);if("jumpOption"===m||"backOption"===m)this.playContext.stack.takeWhile(function(e){return"condition_option"===e.type||"option"===e.type}).length&&this.targetScene.controlPlay(s);else this.targetScene.controlPlay(s)}}},{key:"showLogo",value:function(){var e=this.game,t=e.world,n=e.cache;if(C.a.single)return Promise.resolve();var r=this.json.logo,a=(void 0===r?{}:r).background;if(!a||a.hidden||!a.url||!n.checkImageKey(a.url))return Promise.resolve();var o=a.flex,i=a.opacity,c=a.url,s=a.x,l=void 0===s?0:s,d=a.y,h=void 0===d?0:d,f=ft.image(c,{x:l,y:h});return bt.flex(o,f,t),f.alpha=0,t.add(f),H.to({target:f,properties:{alpha:i},duration:1e3}).then(function(){return u.c.timeout(1e3)}).then(function(){return H.to({target:f,properties:{alpha:0},duration:1e3})}).then(function(){return t.remove(f,!0)})}}]),e}(),Fn=function(){var e=navigator.userAgent,t=e.match(/chrome\/((([0-9]*)+(\.))*)+([0-9]*)/gi);if(t)if("Chrome/50.0.2661.86"==t[0]||"Chrome/51.0.2704.81"==t[0]){if(-1===e.indexOf("Android 6.0.1; MI 4LTE")&&-1===e.indexOf("vivo Y67"))return Phaser.AUTO}else if("Chrome/46.0.2490.76"==t[0]&&-1!==e.indexOf("OPPO R9s"))return Phaser.AUTO;return Phaser.CANVAS},Wn=function(){function e(){var t=this;Object(o.a)(this,e),x(this,"init",function(){var e=C.a.wap,n=C.a.vertical,r=C.a.client,a=t.game,o=a.device,i=a.scale,u=a.stage,c=a.world,d=a.load,h=a.sound,f=a.cache,p=a.input,v=a.single;o.desktop&&"qh"!==e&&"pc"!==r&&!v||(i.scaleMode=Phaser.ScaleManager.SHOW_ALL),i.fullScreenTarget=document.body,i.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,i.pageAlignVertically=!0,i.pageAlignHorizontally=!0;var m=navigator.userAgent.indexOf("UCBrowser")>-1;(o.desktop||m&&o.iOS)&&(u.disableVisibilityChange=!0);var g=document.getElementById("game"),y=function(e){var t=e.size,n=e.angle,r=e.bound;i.setGameSize(t[0],t[1]),c.angle=n,c.setBounds(r[0],r[1],r[2],r[3]),i.refresh()},w=top.location!==self.location;i.setResizeCallback(function(){"wap"===r&&game.gameResumed();var e=window.innerWidth||window.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.documentElement.clientHeight||window.document.body.clientHeight;if(w&&o.iOS&&void 0!==window.orientation){var a=90===window.orientation||-90===window.orientation;e=a?window.originalHeight:window.originalWidth,t=a?window.originalWidth:window.originalHeight,i.parentIsWindow=!0}g.style.width=e+"px",g.style.height=t+"px","pc"===r&&n||(e>t?n&&90!==c.angle?y({size:[960,540],angle:90,bound:[-960,0,540,960]}):n||0===c.angle||y({size:[960,540],angle:0,bound:[0,0,960,540]}):n&&0!==c.angle?y({size:[540,960],angle:0,bound:[0,0,540,960]}):n||90===c.angle||y({size:[540,960],angle:90,bound:[-960,0,960,540]}))}),t.game.onRestart=new Phaser.Signal,d.maxParallelDownloads=2*d.maxParallelDownloads,d.loadImageTag=l.loadImageTag,d.onSoundExtendLoad=new Phaser.Signal,d.onSoundExtendLoadError=new Phaser.Signal,d.crossOrigin="anonymous",h.decode=l.soundDecode,h.onSoundDecodeError=new Phaser.Signal,U.init(),U.setCallback("showGameNotice",function(){return En.show().then(function(){return U.openShanyiMenu()})});var b=function(){h.touchLocked=!1,s.fill(),f.getKeys(Phaser.Cache.SOUND).forEach(function(e){var t=f.getSound(e);t&&!s.exist(t.data)&&f.reloadSound(e)})};o.iOS?o.iOSVersion>8?p.addTouchLockCallback(b,t.game,!0):p.addTouchLockCallback(b,t.game):o.android&&!U.isAppClient()?p.addTouchLockCallback(b,t.game,!0):b(),Ze.cache=f,Ze.loader=d,window.AssetManager=Ze,game.destroyComponent.add(function(e){return Ze.subRef("image",e,"play")})}),x(this,"create",function(){var e=t.game,n=e.canvas,r=e.width,a=e.height,o=e.world,i=e.input.onDown,c=(C.a.client,C.a.wap),s=C.a.singleoffline;n.oncontextmenu=function(e){return e.preventDefault()},o.add(ft.rectMask({color:6476757,rect:{width:r,height:a}})),i.add(function(){return t.game.gameResumed()});var l=null,d=null,h=null;Ie().then(function(e){return u.a.startlocal(e)});var f=function(){return qe().then(function(e){return h=e,t.loadAssets(e)}).then(function(){return t.loadGameJson()}).then(function(e){return(l=e)&&t.getGameAssets(e)}).then(function(){return t.handleOtherActions(l).then(function(e){return d=e})}).then(function(){return t.loadGameAssets(h)}).then(function(){return t.showGuide()}).then(function(){return t.clear()}).then(function(){return new Bn(t.game,l,d)}).catch(function(e){C.a.client?I.a.warn("".concat(e,"，关闭播放器吗？")).then(function(){return window.location.href="lzj3000://quit"}):I.a.warn("".concat(e,"，返回闪艺首页吗？")).then(function(){return window.location.href="http:\\\\www.3000.com"})})};c?"qh"==c?(M.b.sendQHData(),M.b.initQHSdk().then(function(e){0==e.code?f():I.a.warn("群黑平台游戏初始化失败，请刷新重试！").then(function(){return window.location.reload()},null)})):"qzone"==c?M.b.getUserIpInfo().then(function(){return M.b.postUserInfoQzone(1)}).then(function(){return M.b.getShareCountQzone()}).then(function(){return f()},function(e){return I.a.warn("游戏初始化失败，请刷新重试！").then(function(){return window.location.reload()})}):"wx"==c?M.b.initWx().then(function(e){return f()}):f():s&&"4399"==c?M.a.init4399Api().then(function(){return f()}):f()}),window.AudioContext=null,window.webkitAudioContext=null;var n=C.a.vertical?[540,960]:[960,540],r=Object(_.a)(n,2),a=r[0],i=r[1];window.game=this.game=new Phaser.Game({width:a,height:i,parent:"game",renderer:Fn(),state:{init:this.init,create:this.create},mspointer:!1,enableDebug:!1}),window.game.preserveDrawingBuffer=!0}return Object(i.a)(e,[{key:"loadAssets",value:function(e){var t=C.a.offline,n=C.a.vertical,r=C.a.client,a=C.a.wap,o=C.a.single,i=C.a.singleoffline,c=this.game,s=c.load,l=c.world,d=U.localStorageGetItem("shanyi3000guide")||"",h=""==d?null:JSON.parse(d);if(e){var f=e.pic_url;f&&s.image("adpicurl",f.replace("http://","//"))}if(s.image("icon_back","./img/icon_back.png"),s.image("icon_back_over_pressed","./img/icon_back_over_pressed.png"),s.image("icon_candy","./img/icon_candy.png"),s.image("icon_candy_over_pressed","./img/icon_candy_over_pressed.png"),s.image("icon_get","./img/icon_get.png"),s.image("icon_get_hover_pressed","./img/icon_get_hover_pressed.png"),s.image("icon_save","./img/icon_save.png"),s.image("icon_save_over_pressed","./img/icon_save_over_pressed.png"),s.image("cloud","./img/cloud.png"),s.image("cloud_hover","./img/cloud_hover.png"),s.image("local","./img/local.png"),s.image("local_hover","./img/local_hover.png"),s.image("icon_success","./img/icon_success.png"),s.image("icon_error","./img/icon_error.png"),s.image("light","./img/light.png"),s.image("toast_loading","./img/toast_loading.gif"),s.image("app_button_speed","./img/app_button_speed.png"),s.image("app_icon_speed","./img/app_icon_speed.png"),s.image("lock","./img/lock.png"),o?(s.image("singlebg",n?"./img/single/singlebg_1.png":"./img/single/singlebg.png"),s.image("continue","./img/single/continue.png"),s.image("menumore","./img/single/more.png"),s.image("menumore_hover","./img/single/more_hover.png"),h=null):(s.image("logo_preloader","./img/logo_preloader.png"),s.image("loading_gif","./img/loading_gif.gif")),("wap"===r||o)&&s.image("wapback","./img/wapback.png"),!n&&s.spritesheet("wind","./img/wind.png",960,540),"qzone"===a&&(s.image("help","./img/qzone/help.png"),s.image("invite","./img/qzone/invite.png"),s.image("share","./img/qzone/share.png")),s.image("packup","./img/pc/packup.png"),s.image("packup-hover","./img/pc/packup-hover.png"),s.image("packdown","./img/pc/packdown.png"),s.image("packdown-hover","./img/pc/packdown-hover.png"),!h&&s.image("Operation_tip",n?o&&!i?"./img/Operation_tip_1_single.jpg":"./img/Operation_tip_1.jpg":o&&!i?"./img/Operation_tip_single.png":"./img/Operation_tip.png"),(!h||h&&h.count<10)&&s.image("Cloud_record_tip",n?"./img/Cloud_record_tip_1.png":"./img/Cloud_record_tip.png"),t){var p=["rainy","snowy","defoliation","fallingPeach","fallingFlower","lightning"];n&&p.push("windy"),p.forEach(function(e){return u.c.getWeatherUrls(e).forEach(function(e){return s.image(e,e)})})}return new Promise(function(e,t){var a=l.height,i=l.width,u=null,c=null,d=ft.text({x:18,y:a-30},{fontSize:"pc"===r?n?22:14:16,forceFontFamily:"pc"===r?"微软雅黑":"宋体",color:"#fff"});s.onLoadStart.addOnce(function(){return l.add(d)}),s.onFileComplete.add(function(e,t,n,r,s){o?"singlebg"===t&&(c=ft.image(t,{x:i/2,y:a/2,centre:!0}),l.add(c)):"logo_preloader"===t&&(u=ft.image(t,{x:i/2,y:a/2,centre:!0}),l.add(u)),Ze.addRef("image",t,"global"),d.text="正在准备播放.. "+e+"%"}),s.onLoadComplete.addOnce(function(){s.onFileComplete.removeAll(),d.text="正在准备播放..【成功】",u&&(u.scale.setTo(.35,.35),u.x=i-u.width+25,u.y=a-u.height+12);var t=ft.image("loading_gif",{centre:!0,name:"loadingGif"});return t.x=i/2,t.y=n?a/2-t.height/2:a/2-80,l.add(t),e()}),s.start()})}},{key:"loadGameJson",value:function(){var e=this.game.world,t=e.width,n=e.height,r=C.a.type,a=C.a.isWapOther,o=C.a.client,i=C.a.vertical,c=C.a.uuid,s="pc"===o&&i,l=ft.text({x:18,y:n-(s?60:50)},{fontSize:"pc"===o?i?22:14:16,forceFontFamily:"pc"===o?"微软雅黑":"宋体",color:"#fff",text:"加载用户配置.."});e.add(l);var d=function(e){if(e.lengthComputable){var t=e.loaded/e.total;l.text="加载用户配置.. ".concat(~~t,"%")}else l.text="加载用户配置.. ".concat(e.loaded)},h=function(e){if(l.text="加载用户配置..【成功】",0===Object.keys(e).length)return Promise.reject("链接已过期");Ze.gameJson=rt.gameJson=at.gameJson=e;var t=e.default_settings.records,n=void 0===t?[]:t;return $.records=n,pe.fix(e)},f=37==c.length&&2==c.charAt(c.length-1);return f&&(C.a.uuid=c=c.substr(0,c.length-1)),1==r?new Promise(function(r,a){Te(c,"&test=".concat(!f,"&pwd="),d).then(function(e){return r(h(e))},function(){var a=ft.group(),i=ft.rectMask({alpha:.5,rect:{width:t,height:n}});i.inputEnabled=!0,a.add(i);var s=(t-200-60)/2,l=(n-120)/2,p=new kt({game:game,x:s,y:l,width:200,height:30,text:"",color:"#999999",fontSize:24,fontFamily:"宋体"}),v=p.element;v.className="preview-code-input",v.placeholder="请输入预览码",a.add(p);var m={x:s+200+10,y:l,width:60,height:30},g=ft.rectMask({alpha:1,color:1822168,rect:m});g.inputEnabled=!0;var y=function(e){v.className="preview-code-error-input",w.visible=!1,b.visible=!0,_.setText(e),"很抱歉，预览码已过期~"!==e&&"很抱歉，预览码输入错误，请重新输入"!==e&&"pc"===o&&U.urlExpire()};g.events.onInputUp.add(function(t,n){n&&n.pointerMode===Phaser.PointerMode.CURSOR&&0!==n.button||(v.value?Te(c,"&test=".concat(!f,"&pwd=").concat(v.value),d).then(function(t){U.localStorageSetItem("SYConformTime".concat(c),u.c.aesEncrypt(u.a.getCurDate(),1)),e.remove(a,!0),r(h(t))},function(e){return y(e)}):y("您还未输入预览码"))}),a.add(g),a.add(ft.text(m,{fontSize:20,forceFontFamily:"宋体",color:"#fff",text:"确定",boundsAlignH:"center",boundsAlignV:"middle",align:"center"})),l=m.y+30+5;var w=ft.textarea({x:s,y:l,width:270,height:60},{fontSize:14,forceFontFamily:"宋体",color:"#fff"});w.setTexts([{data:"作者还未正式发布，请填写作者提供的预览码进入作品"}]),a.add(w);var b=ft.group();b.add(ft.image("icon_error",{x:s,y:l}));var _=ft.text({x:s+20,y:l,width:250,height:60},{fontSize:14,forceFontFamily:"宋体",color:"#fff",text:""});b.add(_),b.visible=!1,a.add(b),e.add(a)})}):(a?Ve:1==r?Te:Ae)(c,d).then(h,function(e){return l.text="发生错误：".concat(e),Promise.reject(e)})}},{key:"getGameAssets",value:function(e){var t=this.game,n=t.world,r=t.cache,a=t.input,o=n.width,i=n.height,u=C.a.client,c=C.a.vertical,s=(C.a.single,C.a.singleoffline),l="pc"===u&&c,d=ft.text({x:18,y:i-(l?90:70)},{fontSize:"pc"===u?c?22:14:16,forceFontFamily:"pc"===u?"微软雅黑":"宋体",color:"#fff",text:"解析用户配置..."});return n.add(d),new Promise(function(t,n){var r=e.logo,a=void 0===r?{}:r,o=e.cover,i=void 0===o?{}:o,u=e.template,c=void 0===u?{}:u,s=e.font,l=e.valueImgs,d=e.dialogs,h=void 0===d?[]:d,f=(c.json||{}).cover,p=a.background,v=pe.getAssets(e);if(v.push.apply(v,Object(b.a)(pe.getViewAssets(e))),p&&p.url&&!p.hidden&&v.push({url:p.url,type:"image"}),h.length>0&&h.forEach(function(e){return v.push.apply(v,Object(b.a)(gt.getDialogAssets(e)))}),!i.hidden){var m=i.background;m&&m.url&&v.push({url:m.url,type:"image"}),f&&v.push.apply(v,Object(b.a)(gt.getCoverAssets(f)))}if(c.json){var g=c.json,y=g.dialog,w=g.menu,_=g.shanyiMenu,x=g.mainMenu,k=g.settings,P=g.option,C=g.playback,S=g.record;v.push.apply(v,Object(b.a)(gt.getSoundAssets(c.json))),v.push.apply(v,Object(b.a)(gt.getDialogAssets(y))),v.push.apply(v,Object(b.a)(gt.getMenuAssets(w))),v.push.apply(v,Object(b.a)(gt.getShanyiMenuAssets(_))),v.push.apply(v,Object(b.a)(gt.getOptionAssets(P))),v.push.apply(v,Object(b.a)(gt.getMainMenuAssets(x))),v.push.apply(v,Object(b.a)(gt.getSettingsAssets(k))),v.push.apply(v,Object(b.a)(gt.getRecordAssets(S))),v.push.apply(v,Object(b.a)(gt.getPlaybackAssets(C)))}l&&l.forEach(function(e){return e.url&&v.push({url:e.url,type:"image"})}),v.forEach(function(e){var t=e.url,n=e.type;return Ze.load(n,t)}),s&&E.init(s,e.default_settings.font_size),$.buttonSoundUrl=c.json&&c.json.sound&&c.json.sound.url||"",t()}).then(function(){return d.text="解析用户配置..【成功】",!s||!r.checkKey(Phaser.Cache.IMAGE,"continue")||new Promise(function(e,t){var r=ft.image("continue",{x:o/2,y:c?i/2:i-30,centre:!0});n.add(r),a.onDown.addOnce(function(t,a){n.remove(r,!0),e()})})},function(e){return d.text="用户配置解析错误:".concat(e),Promise.reject(e)})}},{key:"handleOtherActions",value:function(e){Object(we.c)({url:Se.sensitiveWord,data:"action=all"}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"getSensitiveWords failed, no response data"});var n=JSON.parse(t);return"100"==n.code?Array.isArray(n.result)?n.result:JSON.parse(u.c.aesDecrypt(n.result,4)):Promise.reject(n.message)}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return u.c.getSensitiveWords=function(){return e}}),function(){var e=C.a.client,t=C.a.uid,n=C.a.v;if("android"!==e&&"ios"!==e)return Promise.resolve();var r=u.c.getDeviceId(),a=u.a.getCurDate(),o=Oe(a,1),i=Oe(me.a.hash(me.a.hash("mac_name=".concat(r,"&time=").concat(a,"&uid=").concat(t,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"))),1),c="".concat(Se.statistics,"&v=").concat(n,"&client=").concat(e),s="mac_name=".concat(Oe(r,1),"&uid=").concat(Oe(t,1),"&sign=").concat(i,"&time=").concat(o);Object(we.c)({url:c,data:s})}();var t=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return P()(e,{value:{$set:_e.safeInitValue(e)}})})},n={values:t(e.values),savedValues:t(e.savedValues),stringValues:t(e.stringValues),payValues:t(e.payValues),indexValues:t(e.indexValues),systemValues:e.systemValues};return Ut.updateUserAccInfo(n)}},{key:"loadGameAssets",value:function(e){var t=this,n=this.game,r=n.load,a=n.world,o=r._totalFileCount+F.getLoadingCount();if(!o)return Promise.resolve();var i=C.a.vertical,u=C.a.client,c=C.a.single,s=a.width,l=a.height,d=Object.create(null),h=0,f=ft.text({x:0,y:l/2+(i?20:50),width:s,height:30},{fontSize:"pc"===u?i?28:24:28,forceFontFamily:"pc"===u?"微软雅黑":"宋体",color:"#fff",boundsAlignH:"center",boundsAlignV:"middle",align:"center"});a.add(f);var p=["收藏作品，更新会第一时间通知你","感觉作品很棒，和你的好友分享吧~","引战、刷屏、作品无关的评论会被删除哦","素材库为全站通用，可能发生人物走错片场的情况，请不要慌张","在当前作品的评论中对比其他作品容易给作者大大招黑哦~","制作辛苦，写下精彩长评支持喜欢的作者吧","长按屏幕可以快进剧情","手指右滑就可召唤退出按钮，退出作品时，记得存档哦","把作品下载到本地，随时随地任性玩"],v=p[Math.floor(Math.random()*("pc"===u?p.length-3:p.length))];i&&v.length>22&&(v="".concat(v.substr(0,19),"\n").concat(v.substr(19)));var m=ft.text({x:28,y:l/2+(i?100:120),width:s-25,height:18},{fontSize:"pc"===u?i?22:16:18,forceFontFamily:"pc"===u?"微软雅黑":"宋体",color:"#fff",boundsAlignH:"center",boundsAlignV:"middle",align:"center",wordWrap:!0,text:v});!c&&a.add(m);var g=ft.image("light",{x:(s-m.width-28)/2,y:l/2+(i?"pc"===u?100:102:"pc"===u?120:115)});!c&&a.add(g);var y,w=function(){return new Promise(function(e,t){var n=function(){h===o&&(r.onSoundExtendLoad.removeAll(d),r.onSoundExtendLoadError.removeAll(d),r.onFileComplete.removeAll(d),e())},a=function(){h++,f.text=parseInt(100*h/o)+"%",n()};r.onSoundExtendLoad.add(a,d),r.onSoundExtendLoadError.add(a,d),r.onFileComplete.add(function(){return a()},d,0),r.onLoadComplete.addOnce(function(){return n()},d,0),r.start()})};if(e){var b=e.duration,_=(e.open,e.pic_url,e.url);return Promise.all([w(),(y=a.getByName("loadingGif"),y&&(y.visible=!1),f&&(f.y+=70),m&&(m.y+=50),g&&(g.y+=50),t.showAd(b,"adpicurl",_).then(function(){var e=a.getByName("adView");return e&&a.remove(e,!0),y&&(y.visible=!0),f&&(f.y-=70),m&&(m.y-=50),g&&(g.y-=50),!0}))])}return w()}},{key:"showGuide",value:function(){var e=this,t=C.a.client;if("android"!==t&&"ios"!==t)return Promise.resolve();var n=U.localStorageGetItem("shanyi3000guide")||"";if(""==n?null:JSON.parse(n))return Promise.resolve();var r=this.game.world,a=r.width,o=r.height;return r.removeAll(!0,!1,!0),new Promise(function(t,n){var i=ft.image("Operation_tip",{x:a/2,y:o/2,centre:!0});i.inputEnabled=!0,r.add(i);i.events.onInputUp.add(function n(r,a){a&&a.pointerMode===Phaser.PointerMode.CURSOR&&0!==a.button||(H.to({target:i,properties:{alpha:0},duration:1e3}).then(function(){U.localStorageSetItem("shanyi3000guide",JSON.stringify({count:0})),t()}),i.events.onInputUp.remove(n,e))},e)})}},{key:"showAd",value:function(e,t,n){var r=this;return new Promise(function(a,o){var i=r.game,u=i.world,c=i.cache,s=u.width,l=u.height,d=C.a.vertical;if(!c.checkKey(Phaser.Cache.IMAGE,t))return a();var h=(s-527)/2,f=d?(l-307)/2-100:84,p=ft.group("adView");u.add(p),p.add(ft.rectMask({color:5000268,alpha:.5,rect:{x:h,y:f,width:527,height:307}}));var v=ft.image(t,{x:0,y:0,width:527,height:307});p.add(v),v.x=h,v.y=f,v.inputEnabled=!0,v.events.onInputDown.add(function(e,t){t&&t.pointerMode===Phaser.PointerMode.CURSOR&&0!==t.button||window.open(n)}),p.add(function(e,t,n){var r=n,o=ft.group("adtime"),i=ft.rectMask({color:5000268,rect:{x:0,y:0,width:32,height:32}}),u=ft.text({x:0,y:0,with:32,height:32},{forceFontFamily:"宋体",fontSize:20,color:12500670,text:r});o.add(i),o.add(u),o.x=e,o.y=t,u.x=(32-u.width)/2,u.y=(32-u.height)/2;var c=0;return c=setInterval(function(){if(r--,u.setText(r<0?0:r),u.x=(32-u.width)/2,r<=0)return clearInterval(c),a()},1e3),o}(h+527-32,f,e||0))})}},{key:"clear",value:function(){var e=this.game,t=e.world,n=e.cache;t.removeAll(!0,!1,!0),n.checkKey(Phaser.Cache.IMAGE,"loading_gif")&&n.removeImage("loading_gif"),n.checkKey(Phaser.Cache.IMAGE,"logo_preloader")&&n.removeImage("logo_preloader"),n.checkKey(Phaser.Cache.IMAGE,"light")&&n.removeImage("light"),n.checkKey(Phaser.Cache.IMAGE,"singlebg")&&n.removeImage("singlebg"),n.checkKey(Phaser.Cache.IMAGE,"continue")&&n.removeImage("continue"),n.checkKey(Phaser.Cache.IMAGE,"adpicurl")&&n.removeImage("adpicurl"),n.checkKey(Phaser.Cache.IMAGE,"Operation_tip")&&n.removeImage("Operation_tip")}}]),e}();document.addEventListener("DOMContentLoaded",function(){console.log("Initialized app, commit:",w);var e=window.innerWidth||window.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.documentElement.clientHeight||window.document.body.clientHeight;window.originalWidth=Math.min(e,t),window.originalHeight=Math.max(e,t),M.b.initQzone().then(function(e){return Promise.resolve(!1).then(function(e){return new Wn})},function(e){return Dialog.warn("游戏初始化失败，请刷新重试！").then(function(){return window.location.reload()})})})}]);