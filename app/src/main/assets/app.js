!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=182)}([function(e,t,n){"use strict";var r=n(15),a=(n(12),n(36),n(21),n(158),function(e){var t={},n=location.search,i=-1!=n.indexOf("?")?n.substr(1).split("&"):[];return i.length&&i.forEach(function(e){var n=e.split("="),a=Object(r.a)(n,2),i=a[0],o=void 0===i?"":i,u=a[1],s=void 0===u?"":u;t[o.toLowerCase()]=s}),(a=function(e){return t[e.toLowerCase()]||""})(e)}),i={};i.gid=a("gid")||a("gameId"),i.uuid=a("uuid"),i.type=a("type"),i.name=a("name"),i.u=a("u"),i.v=a("v"),i.token=a("token"),i.uid=a("uid"),i.client=a("client"),i.offline=1==a("offline"),i.app_name=a("app_name"),i.app_version=a("app_version"),i.device_name=a("device_name"),i.deviceOsVer=a("device_system_version"),i.wap=a("wap"),i.alpha=1==a("alpha"),i.quality=a("quality"),i.single=1==a("single")||2==a("single"),i.singleoffline=2==a("single"),i.ftfont=1==a("ftfont"),i.istest="true"==a("test"),i.pwd=a("pwd"),i.qh_username=a("username"),i.qh_serverid=a("serverid"),i.qh_time=a("time"),i.qh_isadult=a("isadult"),i.qh_flag=a("flag"),i.qh_uid=a("unid"),i.qh_qhchannel=a("qhchannel"),i.qh_qhchannelid=a("qhchannelid"),i.qh_qhgid=a("qhgid"),i.qh_key=a("key"),i.qh_nname=decodeURIComponent(a("nname")),i.vertical=1==a("vertical"),i.extend=decodeURIComponent(a("extend")),i.qz_appid="",i.qz_appkey="",i.qz_openid="",i.qz_openkey="",i.qz_userip="",i.qz_pf="",i.qz_invite="",i.qz_invitecount="",i.qz_receivecount=[],i.qz_appurl="",i.qz_vindex="",i.qz_pindex="",i.qz_sharecount=0,i.mk_access_token=a("access_token"),i.mk_uid="",i.mk_ios_cache=1==a("ios_cache"),i.online=1==a("online");var o=i.wap;i.client,i.app_version;i.isWapOther=o&&"3000"!==o&&"zxwwap"!==o&&"wx"!==o,document.title=i.name&&decodeURI(i.name)||"测试",i.assetsversion="v1.0.0",t.a=i},function(e,t,n){"use strict";n(65),n(66),n(13),n(64),n(82),n(148);var r=n(3),a=(n(83),n(14),n(18),n(12),n(33),n(21),n(48),n(49),n(53),n(54),n(9),n(56),n(36),n(111),n(4)),i=n(6),o=n(69),u=n(28),s=n.n(u),c=(n(10),n(0)),l=(n(160),window.Worker);function d(e,t){var r=!1,a=function(e){e.onmessage=e.onerror=null,e.terminate()},i=[document.createElement("canvas"),document.createElement("canvas")],o=i[0],u=i[1],s=o.getContext("2d"),l=u.getContext("2d"),d=null,h=-1,f=null,p=new Promise(function(i,p){var v="pc"===c.a.client?new n(161)():new n(162)(),m=v.filePath;/blob:/i.test(m)&&URL.revokeObjectURL(m),v.postMessage({type:"decompressGif",value:e},[e]),e=null;var g=[];v.onmessage=function(e){var n=e.data,c=n.index,p=n.hasNext,m=n.frame,y=n.loopCount,_=n.frameLength;if(m.patch=new Uint8ClampedArray(m.patch),!c){var w=m.dims,b=w.width,k=w.height;u.width=b,u.height=k,l.clearRect(0,0,b,k),s.clearRect(0,0,b,k)}(function(e,t){var n=t.dims;return d&&n.width==d.width&&n.height==d.height||(o.width=n.width,o.height=n.height,d=s.createImageData(n.width,n.height)),!e||2!==h&&3!==h||l.clearRect(f.left,f.top,f.width,f.height),h=t.disposalType||-1,d.data.set(t.patch),s.putImageData(d,0,0),l.drawImage(o,n.left,n.top),f=n,new Promise(function(e,t){var n=new Image,r=function(){n.onerror=n.onload=null};n.onerror=function(){r(),t()},n.onload=function(){r(),e(n)},n.src=u.toDataURL("image/png")})})(c,m).then(function(e){g[c]={image:e,delay:Math.max(m.delay,15)},c?t(g[c],p):i({frames:g,loopCount:y,parsed:p,frameLength:_}),r?a(v):p?v.postMessage({type:"getFrame",index:c+1}):a(v)})},v.onerror=function(e){console.warn(e),p("gif解析错误(GifWorker.js)"),a(v)}});return p.cancel=function(){return r=!0},p}l&&(window.Worker=function(e){var t=new l(e);return t.filePath=e,t});var h=n(101),f=n.n(h);n.d(t,"c",function(){return y}),n.d(t,"a",function(){return _}),n.d(t,"b",function(){return w});var p={rainy:{path:"/weather/rain?/xiayu_*.png",count:50},snowy:{path:"/weather/snow?/xuehua_*.png",count:120},windy:{path:"/weather/wind?/feng_*.png",count:20},defoliation:{path:"/weather/mapleLeaves?/fengye_*.png",count:90},fallingPeach:{path:"/weather/beachBlossom?/taohua_*.png",count:90},fallingFlower:{path:"/weather/blossom?/yinghua_*.png",count:90},lightning:{path:"/weather/lightning?/shandian_*.png",count:50}},v=["","ms","O","Moz","webkit"],m={index:0,count:0},g=[c.a.online?"synpic.3000test.com":"apppic.3000test.com","synpic.3000test.com"],y=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,null,[{key:"uncomPressZlib",value:function(e){return f.a.inflate(e,{to:"string"})}},{key:"comPressZlib",value:function(e){return f.a.deflate(e,{to:"string"})}},{key:"stringToArrayBuff",value:function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),a=0;a<t;a++)r[a]=e.charCodeAt(a);return n}},{key:"arrayBufferToBase64",value:function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,a=0;a<r;a++)t+=String.fromCharCode(n[a]);return o.Base64.btoa(t)}},{key:"base64ToArrayBuffer",value:function(e){for(var t=o.Base64.atob(e),n=t.length,r=new Uint8Array(n),a=0;a<n;a++)r[a]=t.charCodeAt(a);return r.buffer}},{key:"base64DatatoBlob",value:function(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),a=new ArrayBuffer(r.length),i=new Uint8Array(a),o=0;o<r.length;o++)i[o]=r.charCodeAt(o);return this.createBlob(i,{type:n})}},{key:"convert",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e=Math.ceil(e);var n,r,a,i,o,u;switch(n=Math.floor(e/3600),r=Math.floor(e/60-60*n),a=Math.floor(e%60),t){case 0:i="",o="",u=(a=a+60*r+3600*n)<=0?"00":a<10?"0"+a:a.toString();break;case 1:i="",o=(r+=60*n)<=0?"00":r<10?"0"+r:r.toString(),u=a<=0?"00":a<10?"0"+a:a.toString();break;case 2:i=n<=0?"00":n<10?"0"+n:n.toString(),o=r<=0?"00":r<10?"0"+r:r.toString(),u=a<=0?"00":a<10?"0"+a:a.toString()}return""===i?""===o?u:o+":"+u:i+":"+o+":"+u}},{key:"dc",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t="",n=0;n<e.length;n++)t+=String["".concat(String.fromCharCode(102)).concat(String.fromCharCode(114)).concat(String.fromCharCode(111)).concat(String.fromCharCode(109)).concat(String.fromCharCode(67)).concat(String.fromCharCode(104)).concat(String.fromCharCode(97)).concat(String.fromCharCode(114)).concat(String.fromCharCode(67)).concat(String.fromCharCode(111)).concat(String.fromCharCode(100)).concat(String.fromCharCode(101))](e[n]);return t}},{key:"switcLoadDomain",value:function(e){if(e.includes(g[0])){m.count>=4?(m.index=(m.index+1)%g.length,m.count=1):m.count++;var t=e.indexOf("coverran")>-1;e=e.replace(g[0],g[t?0:m.index])}return e}},{key:"setElemetStyle",value:function(e,t,n){v.forEach(function(r){return e.style[r?"".concat(r).concat(t[0].toUpperCase()).concat(t.substr(1)):t]=n})}},{key:"getSnap",value:function(){var e=c.a.vertical,t=c.a.client,n=game,r=n.world,a=r.width,i=r.height,o=n.canvas,u=n.device,s=top.location!==self.location,l=document.createElement("canvas");l.width=a/5,l.height=i/5,game.lockRender=!0;var d=l.getContext("2d"),h=function(){arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?(d.save(),d.translate(0,l.height),d.rotate(-90*Math.PI/180),s&&u.iOS?(d.drawImage(o,0,0,l.height,l.width),d.drawImage(o,0,0,a,i,0,0,l.width,l.height)):(d.drawImage(o,0,4*i/5,a,i,0,4*l.height/5,l.width,l.height),d.drawImage(o,0,0,a,i,0,0,l.width,l.height)),d.restore()):d.drawImage(o,0,0,a,i,0,0,l.width,l.height)};return h((window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)>(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)?!("pc"!==t||!e)||!e:e),game.lockRender=!1,l.toDataURL("image/jpeg",.5)}},{key:"fixVolume",value:function(e){return e=(e=e>1?1:e)<0?0:e}},{key:"getSensitiveWords",value:function(){return[]}},{key:"compareVersions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e=e.split(".").map(function(e){return+e}),t=t.split(".").map(function(e){return+e});for(var n=0,r=e.length,a=t.length;n<r&&n<a;){if(e[n]!==t[n])return e[n]-t[n];n++}return n<r?1:n<a?-1:void 0}},{key:"isString",value:function(e){return"[object String]"===Object.prototype.toString.apply(e)}},{key:"isObject",value:function(e){return"[object Object]"===Object.prototype.toString.apply(e)}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.apply(e)}},{key:"getWeatherUrls",value:function(t){var n=c.a.vertical,r=c.a.offline,a=p[t];if(!a)return[];var i=a.path,o=a.count;i=(i=i.replace("/weather",r?"./img":"/weather")).replace("?",n?"_1":"");for(var u=[],s=0;s<o;s++)u.push(i.replace("*",e.formatNum(s)));return u}},{key:"convertToFullUrl",value:function(e){if(!e)return"";if(e.indexOf("coverran")>-1)return e.indexOf("file://")>-1&&(e=e.replace(/file:\/\//,"https://")),e;if("medium"===c.a.quality&&-1==e.indexOf(".gif")&&-1==e.indexOf("weather")){var t=-1!==e.indexOf(".mp3");e+=t?"~q32":"~q60"}if("http://f1.img4399.com/ma~217_20160518155234_573c1f42bb260.jpeg"===e)return"//apppic.3000test.com/m~web/41/2017/02/08/09_j1sGyq.960x540.jpg?".concat(c.a.assetsversion);if("/"===e[0]&&(e=e.substring(1)),!/blob:/i.test(e)){var n,r=c.a.offline,a=c.a.gid,i=e.indexOf("://"),o=c.a.online?"//synpic.3000test.com/":"//apppic.3000test.com/";if(i>-1){var u=e.split("/");u.shift(),u.shift(),u.shift(),n="".concat(o).concat(u.join("/"),"?").concat(c.a.assetsversion)}else n="".concat(o).concat(e,"?").concat(c.a.assetsversion);return r&&(n.indexOf("?")>-1&&(n=n.substr(0,n.indexOf("?"))),n="game".concat(a,"/").concat(n.replace(o,""))),n}return e}},{key:"spliceGif",value:function(e,t){if(Worker)return d(e,t);var n=!1,a=new Promise(function(t,n){var a,i,o,u=0,s=document.createElement("canvas"),c=document.createElement("canvas"),l=null,d=null,h=null,f=null,p=null,v=1,m=[],g=function(e){return e.reduce(function(e,t){return 2*e+t},0)},y=function(e){for(var t=[],n=7;n>=0;n--)t.push(!!(e&1<<n));return t},_=function(){if(i){var e=s.toDataURL("image/png"),t=new Image;t.src=e,m.push({image:t,delay:10*Math.max(d,10)})}},w={hdr:function(e){var t,n;t=(a=e).width,n=a.height,s.width=t,s.height=n,s.style.width=t+"px",s.style.height=n+"px",s.getContext("2d").setTransform(1,0,0,1,0,0),c.width=t,c.height=t},gce:function(e){_(),l=null,d=null,o=h,h=null,i=null,l=e.transparencyGiven?e.transparencyIndex:null,d=e.delayTime,h=e.disposalMethod},com:function(){},app:{NETSCAPE:function(e){v=e.iterations}},img:function(e){i||(i=s.getContext("2d"));var t=m.length,n=e.lctFlag?e.lct:a.gct;t>0&&(3===o?null!==f?m[f].data&&i.putImageData(m[f].data,0,0):i.clearRect(p.leftPos,p.topPos,p.width,p.height):f=t-1,2===o&&i.clearRect(p.leftPos,p.topPos,p.width,p.height));for(var r=i.getImageData(e.leftPos,e.topPos,e.width,e.height),u=0;u<e.pixels.length;u++){var c=e.pixels[u];if(c!==l){var d=n[c],h=4*u;r.data[h]=d[0],r.data[h+1]=d[1],r.data[h+2]=d[2],r.data[h+3]=255}}i.putImageData(r,e.leftPos,e.topPos),p=e},eof:function(){_()}};try{var b=new function(e){e,u=0,this.readByte=function(){if(u>=e.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[u++]:255&e.charCodeAt(u++)},this.readBytes=function(e){for(var t=[],n=0;n<e;n++)t.push(this.readByte());return t},this.read=function(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}}(new Uint8Array(e));setTimeout(function(e,n){n||(n={});var a=function(t){for(var n=[],r=0;r<t;r++)n.push(e.readBytes(3));return n},i=function(){var t,n,r,a=0;n=new Uint8Array(8192);do{for(t=e.readByte();a+t>n.length;)r=void 0,(r=new Uint8Array(n.length+8192)).set(n),n=r;n.set(e.readBytes(t),a),a+=t}while(0!==t);return n.subarray(0,a)},o=function(t){t.leftPos=e.readUnsigned(),t.topPos=e.readUnsigned(),t.width=e.readUnsigned(),t.height=e.readUnsigned();var o=y(e.readByte());t.lctFlag=o.shift(),t.interlaced=o.shift(),t.sorted=o.shift(),t.reserved=o.splice(0,2),t.lctSize=g(o.splice(0,3)),t.lctFlag&&(t.lct=a(1<<t.lctSize+1)),t.lzwMinCodeSize=e.readByte();var u=i();t.pixels=function(e,t){var n,r,a,i,o,u=0,s=function(e){for(var n=0,r=0;r<e;r++)t[u>>3]&1<<(7&u)&&(n|=1<<r),u++;return n},c=1<<e,l=c+1,d=e+1,h=4096,f=4096,p=new Uint8Array(h),v=new Uint8Array(f),m=[],g=0,y=0,_=function(e,t){for(var n,r,a=m[t].byteLength+1;g+a>v.length;)n=void 0,r=void 0,n=v.length+f,(r=new Uint8Array(n)).set(v),v=r,f<<=1;var i=v.subarray(g,g+a);i.set(m[t]),i[a-1]=m[e][0],g+=a,m.push(i)};for(function(){for(var e=0;e<c;e++)m[e]=new Uint8Array(1),m[e][0]=e;m[c]=new Uint8Array(0),m[l]=null}();;)if(r=n,(n=s(d))!==c){if(n===l)break;if(n<m.length)r!==c&&_(n,r);else{if(n!==m.length)throw new Error("Invalid LZW code.");_(r,r)}for(var w=m[n].length;y+w>p.length;)a=void 0,i=void 0,a=p.length+h,(i=new Uint8Array(a)).set(p),p=i,h<<=1;p.set(m[n],y),y+=w,m.length===1<<d&&d<12&&d++}else o=void 0,o=c+2,m.splice(o,m.length-o),d=e+1,g=0;return p.subarray(0,y)}(t.lzwMinCodeSize,u),t.interlaced&&(t.pixels=function(e,t){for(var n=new Array(e.length),a=e.length/t,i=function(a,i){var o,u=e.slice(i*t,(i+1)*t);n.splice.apply(n,(o=[a*t,t]).concat.apply(o,Object(r.a)(u)))},o=[0,4,2,1],u=[8,8,4,2],s=0,c=0;c<4;c++)for(var l=o[c];l<a;l+=u[c])i(l,s),s++;return n}(t.pixels,t.width)),n.img&&n.img(t)},u=function r(){var a={};switch(a.sentinel=e.readByte(),String.fromCharCode(a.sentinel)){case"!":a.type="ext",function(t){switch(t.label=e.readByte(),t.label){case 249:t.extType="gce",function(t){e.readByte();var r=y(e.readByte());t.reserved=r.splice(0,3),t.disposalMethod=g(r.splice(0,3)),t.userInput=r.shift(),t.transparencyGiven=r.shift(),t.delayTime=e.readUnsigned(),t.transparencyIndex=e.readByte(),t.terminator=e.readByte(),n.gce&&n.gce(t)}(t);break;case 254:t.extType="com",function(e){e.comment=i(),n.com&&n.com(e)}(t);break;case 1:t.extType="pte",function(t){e.readByte(),t.ptHeader=e.readBytes(12),t.ptData=i(),n.pte&&n.pte(t)}(t);break;case 255:t.extType="app",function(t){switch(e.readByte(),t.identifier=e.read(8),t.authCode=e.read(3),t.identifier){case"NETSCAPE":!function(t){e.readByte(),t.unknown=e.readByte(),t.iterations=e.readUnsigned(),t.terminator=e.readByte(),n.app&&n.app.NETSCAPE&&n.app.NETSCAPE(t)}(t);break;default:!function(e){e.appData=i(),n.app&&n.app[e.identifier]&&n.app[e.identifier](e)}(t)}}(t);break;default:t.extType="unknown",function(e){e.data=i(),n.unknown&&n.unknown(e)}(t)}}(a);break;case",":a.type="img",o(a);break;case";":a.type="eof",n.eof&&n.eof(a);break;default:throw new Error("Unknown block: 0x"+a.sentinel.toString(16))}"eof"!==a.type?setTimeout(r,0):t({loopCount:v,frames:m})};!function(){var t={};if(t.sig=e.read(3),t.ver=e.read(3),"GIF"!==t.sig)throw new Error("Not a GIF file.");t.width=e.readUnsigned(),t.height=e.readUnsigned();var r=y(e.readByte());t.gctFlag=r.shift(),t.colorRes=g(r.splice(0,3)),t.sorted=r.shift(),t.gctSize=g(r.splice(0,3)),t.bgColor=e.readByte(),t.pixelAspectRatio=e.readByte(),t.gctFlag&&(t.gct=a(1<<t.gctSize+1)),n.hdr&&n.hdr(t)}(),setTimeout(u,0)}(b,w),0)}catch(e){n(e),console.error("parseGIF ERROR!!"+e)}}).then(function(e){var r=e.frames;e.frames=r.slice(0,1),e.frameLength=r.length,e.parsed=e.frames<=1;var a=function(e){var t=r[e].image;return t.complete?Promise.resolve():new Promise(function(e,n){var r=function(){return t.onerror=t.onload=null};t.onerror=function(){r(),n()},t.onload=function(){r(),e()}})};return a(0).then(function(){return function e(i){return i>=r.length||n?Promise.resolve():a(i).then(function(){return n?Promise.resolve():(t(r[i],i===r.length-1),e(i+1))})}(1),e})});return a.cancel=function(){return n=!0},a}},{key:"toColorValue",value:function(t){return parseInt(e.formatColor(t).slice(1),16)}},{key:"formatColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=function(e){return"#ffffff"===e.toLowerCase()?"#fefefe":e};if(Number.isInteger(e))return t("#"+Number(e).toString(16));var n=e.match(/rgb\([\s]*(\d+)[\s]*,[\s]*(\d+)[\s]*,[\s]*(\d+)[\s]*\)/i),r=function(e){var t=parseInt(e,10).toString(16);return 2!==t.length?"0"+t:t};return n?t("#"+r(n[1])+r(n[2])+r(n[3])):(e&&"#"!==e[0]&&(e="#"+e),isNaN(parseInt(e.slice(1),16))?"#fefefe":(4===e.length&&(e="#".concat(e[1]).concat(e[1]).concat(e[2]).concat(e[2]).concat(e[3]).concat(e[3])),t(e||"#fefefe")))}},{key:"timeout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=null,n=new Promise(function(n,r){return t=setTimeout(n,e)});return n.cancel=function(){return clearTimeout(t)},n}},{key:"toArrayForData",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=0,a=!1;do{if("\\"!=e[n+r]&&"&"!=e[n+r]||(a=!0),"\n"==e[n+r]){var i=e.substr(n,r);i&&t.push({data:i,placeholder:void 0}),t.push({lineBreak:!0,data:"\n"});break}if(n+r>e.length-1){t.push({data:e.substr(n),placeholder:void 0});break}if(a){var o=e.substr(n,r+1);if(/\\(\d+)\s$/.test(o)){var u=o.lastIndexOf("\\"),s=o.substring(0,u);s&&t.push({data:s,placeholder:void 0}),t.push({placeholder:!0,data:o.substr(u)});break}if(/&(s|v|sv|p|x|i|iv)\[(\d+)\]$/.test(o)){var c=o.lastIndexOf("&"),l=o.substring(0,c);l&&t.push({data:l,placeholder:void 0}),t.push({placeholder:!0,data:o.substr(c)});break}}}while(n+ ++r<=e.length);n+=r}return t}},{key:"timeoutByPhaser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.game).time.events;return new Promise(function(n,r){return t.add(e,n)})}},{key:"createBlob",value:function(e,t){var n,r;try{return new Blob([e],t)}catch(a){if(n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)return(r=new n).append(e),r.getBlob(t);throw new Error("Unable to create blob")}}},{key:"dataURLtoBlob",value:function(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),a=r.length,i=new Uint8Array(a);a--;)i[a]=r.charCodeAt(a);var o=null;try{o=new Blob([i],{type:n})}catch(e){console.error(e.name+"  "+e.message)}return o}},{key:"encodeBase64",value:function(e){return""===e?"":o.Base64.encode(e)}},{key:"decryptBase64",value:function(e){return""===e?"":o.Base64.decode(e)}},{key:"aesEncrypt",value:function(e,t){if(""===e)return"";var n="de3kt|jq|fdcgj_|",r="ff_|pf|#%@fw_j+q";1===t?(n="WDF#$H*#SJN*&G$&",r="JH&$GF$DR%*K@SC%"):2===t?(n="aDF#$HGF$DN*&G$e",r="bH&$GF$DcF#$HSCf"):3===t?(n="aDF#$HGF$DN*&G$e",r="bH&$GF$DcF#$HSCf"):4==t&&(n="cGq$#KHp$Fb*&e$T",r="Rg&$MN$VBy#$KJYg");var a=s.a.enc.Utf8.parse(n),i=s.a.enc.Utf8.parse(r);return s.a.AES.encrypt(e+"",a,{iv:i,mode:s.a.mode.CBC,padding:s.a.pad.ZeroPadding}).toString()}},{key:"aesDecrypt",value:function(e,t){if(""===e)return"";var n="de3kt|jq|fdcgj_|",r="ff_|pf|#%@fw_j+q";1===t?(n="WDF#$H*#SJN*&G$&",r="JH&$GF$DR%*K@SC%"):2===t?(n="aDF#$HGF$DN*&G$e",r="bH&$GF$DcF#$HSCf"):4===t&&(n="xiamenshanyi4399",r="");var a=s.a.enc.Utf8.parse(n),i=s.a.enc.Utf8.parse(r);return s.a.AES.decrypt(e,a,{iv:i,mode:4!==t?s.a.mode.CBC:s.a.mode.ECB,padding:s.a.pad.ZeroPadding}).toString(s.a.enc.Utf8)}},{key:"getCookie",value:function(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?decodeURI(t[2]):null}},{key:"getUidByCookie",value:function(){var e=this.getCookie("SYPauth");if(e){var t=e.indexOf("|");e=e.substring(0,t)}return e||""}},{key:"generateUUID",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}},{key:"getDeviceId",value:function(){if("android"===c.a.client){var e=navigator.userAgent.match(/[0-9A-Za-z]{8}-[0-9A-Za-z]{4}-[0-9A-Za-z]{4}-[0-9A-Za-z]{4}-[0-9A-Za-z]{12}/g);return e?e[0]:""}if("ios"===c.a.client){var t=navigator.userAgent.match(/[0-9A-Za-z]{40}/g);return t?t[0]:""}return""}},{key:"formatNum",value:function(e){return 0===e?"00000":e<10?"0000"+e:e<100?"000"+e:"00"+e}},{key:"txtLineSpace",value:function(e){return 12==e||14==e||16==e||18==e?e/2-4:e<19?e/2-5:e<28?e/2-6:32===e?6:e<37?e/2-7:e<46?e/2-9:e<56?e/2-10:-Math.ceil(e/5)+e/2}}]),e}();y.hasChangeUserFromePc=!1,y.midWayLoginFromePc=!1,y.preUid="",y.typeUnlockRecords=[],y.typePayCount=[],y.typeUnlockChapters=[];var _=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,null,[{key:"getDate",value:function(){return e.timeStamp+e.passSeconds}},{key:"format",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new Date(e),n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<10?"0".concat(e):e};return"".concat(t.getFullYear(),"-").concat(n(t.getMonth()+1),"-").concat(n(t.getDate())," ").concat(n(t.getHours()),":").concat(n(t.getMinutes()),":").concat(n(t.getSeconds()))}},{key:"getCurDate",value:function(){return e.timeOffset+e.getDate()}},{key:"startlocal",value:function(t){e.timeOffset=t-Math.floor(Date.now()/1e3),e.passSeconds=0}}]),e}();_.timeStamp=Math.floor(Date.now()/1e3),_.passSeconds=0,_.timeOffset=0,setInterval(function(){return _.passSeconds++},1e3);var w=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,null,[{key:"is",value:function(e){return"[object Number]"===Object.prototype.toString.apply(e)}},{key:"toN",value:function(e){var t=Number(e);return isNaN(t)?0:t}},{key:"toInt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=parseInt(e,t);return isNaN(n)?0:n}},{key:"roundToInt",value:function(e){return Number(e)+.5|0}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(175),a=Object.prototype.hasOwnProperty,i=Array.prototype.splice,o=Object.prototype.toString;function u(e){return o.call(e).slice(8,-1)}var s=Object.assign||function(e,t){return c(t).forEach(function(n){a.call(t,n)&&(e[n]=t[n])}),e},c="function"==typeof Object.getOwnPropertySymbols?function(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.keys(e)};function l(e){return Array.isArray(e)?s(e.constructor(e.length),e):"Map"===u(e)?new Map(e):"Set"===u(e)?new Set(e):e&&"object"==typeof e?s(Object.create(Object.getPrototypeOf(e)),e):e}var d=function(){function e(){this.commands=s({},h),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(e,t){return e===t},this.update.newContext=function(){return(new e).update}}return Object.defineProperty(e.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(e){this.update.isEquals=e},enumerable:!0,configurable:!0}),e.prototype.extend=function(e,t){this.commands[e]=t},e.prototype.update=function(e,t){var n=this,i="function"==typeof t?{$apply:t}:t;Array.isArray(e)&&Array.isArray(i)||r(!Array.isArray(i),"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."),r("object"==typeof i&&null!==i,"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the following commands: %s.",Object.keys(this.commands).join(", "));var o=e;return c(i).forEach(function(t){if(a.call(n.commands,t)){var r=e===o;o=n.commands[t](i[t],o,i,e),r&&n.isEquals(o,e)&&(o=e)}else{var s="Map"===u(e)?n.update(e.get(t),i[t]):n.update(e[t],i[t]),c="Map"===u(o)?o.get(t):o[t];n.isEquals(s,c)&&(void 0!==s||a.call(e,t))||(o===e&&(o=l(e)),"Map"===u(o)?o.set(t,s):o[t]=s)}}),o},e}();t.Context=d;var h={$push:function(e,t,n){return p(t,n,"$push"),e.length?t.concat(e):t},$unshift:function(e,t,n){return p(t,n,"$unshift"),e.length?e.concat(t):t},$splice:function(e,t,n,a){return function(e,t){r(Array.isArray(e),"Expected $splice target to be an array; got %s",e),m(t.$splice)}(t,n),e.forEach(function(e){m(e),t===a&&e.length&&(t=l(a)),i.apply(t,e)}),t},$set:function(e,t,n){return function(e){r(1===Object.keys(e).length,"Cannot have more than one key in an object with $set")}(n),e},$toggle:function(e,t){v(e,"$toggle");var n=e.length?l(t):t;return e.forEach(function(e){n[e]=!t[e]}),n},$unset:function(e,t,n,r){return v(e,"$unset"),e.forEach(function(e){Object.hasOwnProperty.call(t,e)&&(t===r&&(t=l(r)),delete t[e])}),t},$add:function(e,t,n,r){return g(t,"$add"),v(e,"$add"),"Map"===u(t)?e.forEach(function(e){var n=e[0],a=e[1];t===r&&t.get(n)!==a&&(t=l(r)),t.set(n,a)}):e.forEach(function(e){t!==r||t.has(e)||(t=l(r)),t.add(e)}),t},$remove:function(e,t,n,r){return g(t,"$remove"),v(e,"$remove"),e.forEach(function(e){t===r&&t.has(e)&&(t=l(r)),t.delete(e)}),t},$merge:function(e,t,n,a){var i,o;return i=t,r((o=e)&&"object"==typeof o,"update(): $merge expects a spec of type 'object'; got %s",o),r(i&&"object"==typeof i,"update(): $merge expects a target of type 'object'; got %s",i),c(e).forEach(function(n){e[n]!==t[n]&&(t===a&&(t=l(a)),t[n]=e[n])}),t},$apply:function(e,t){var n;return r("function"==typeof(n=e),"update(): expected spec of $apply to be a function; got %s.",n),e(t)}},f=new d;function p(e,t,n){r(Array.isArray(e),"update(): expected target of %s to be an array; got %s.",n,e),v(t[n],n)}function v(e,t){r(Array.isArray(e),"update(): expected spec of %s to be an array; got %s. Did you forget to wrap your parameter in an array?",t,e)}function m(e){r(Array.isArray(e),"update(): expected spec of $splice to be an array of arrays; got %s. Did you forget to wrap your parameters in an array?",e)}function g(e,t){var n=u(e);r("Map"===n||"Set"===n,"update(): %s expects a target of type Set or Map; got %s",t,n)}t.isEquals=f.update.isEquals,t.extend=f.extend,t.default=f.update,t.default.default=e.exports=s(t.default,t)},function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return o});n(14),n(9);var r=n(4),a=n(6),i=n(0),o=(n(178),function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,null,[{key:"showDialog",value:function(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;!this.isShow&&(this.isShow=!0);var c=this;return new Promise(function(l,d){var h=function(){document.body.removeChild(f),c.isShow=!1,d("cancel")},f=document.createElement("div");f.classList.add("ModalContainer");var p=document.createElement("div");if(p.classList.add("ModalPortal"),f.appendChild(p),document.body.appendChild(f),document.body.clientWidth<=document.body.clientHeight){var v=i.a.vertical,m=i.a.client;p.style.transform="pc"===m&&v?"rotate(0)":"rotate(90deg)"}var g=function(){document.documentElement.style.fontSize="";var e=i.a.vertical;"pc"===i.a.client&&e||(document.body.clientWidth<=document.body.clientHeight?p.style.transform=e?"rotate(0)":"rotate(90deg)":p.style.transform=e?"rotate(90deg)":"rotate(0)")};window.onresize=function(){g()};var y=document.createElement("div");y.classList.add("Title");var _=document.createElement("span");_.innerText=e;var w=document.createElement("span");w.classList.add("spaceSpan");var b=document.createElement("span");b.classList.add("Close"),b.innerText="×",b.onclick=o?function(){document.body.removeChild(f),c.isShow=!1,d("close")}:h,y.appendChild(_),y.appendChild(w),y.appendChild(b),p.appendChild(y);var k=document.createElement("div");k.classList.add("Content"),p.appendChild(k);var x=document.createElement("div");x.classList.add("ContentData"),n&&x.classList.add(n),r&&(x.align="center"),x.innerText=t,k.appendChild(x);var P=document.createElement("div");P.classList.add("Buttons"),k.appendChild(P);var C=document.createElement("button"),S=document.createElement("button");if(C.classList.add("ButtonOk"),S.classList.add("ButtonsCancel"),C.innerText=r||"确定",S.innerText=a||"取消",P.appendChild(C),P.appendChild(S),C.onclick=function(){document.body.removeChild(f),c.isShow=!1,l("ok")},S.onclick=h,u>0){var O=function e(t,n,r){n<=0?(t.removeAttribute("disabled"),t.style.background="#00bbb8",t.style.backgroundColor="#00bbb8",t.style.border="#00bbb8",t.style.color="#FFFFFF",t.innerText=r):(t.setAttribute("disabled",!0),t.style.background="#8c8c8c",t.style.backgroundColor="#8c8c8c",t.style.color="#FFFFFF",t.style.border="#8c8c8c",t.innerText=n,n--,setTimeout(function(){e(t,n,r)},1e3))};0===s?O(C,u,C.innerText):1===s?O(S,u,S.innerText):2===s&&(O(C,u,C.innerText),O(S,u,S.innerText))}g()})}},{key:"info",value:function(e){if(!this.isShow)return this.showDialog("提示",e,"Info")}},{key:"warn",value:function(e){if(!this.isShow)return this.showDialog("警告",e,"Warn")}},{key:"error",value:function(e){if(!this.isShow)return this.showDialog("错误",e,"Error")}},{key:"custom",value:function(e,t,n,r,a,i,o,u){return this.isShow?Promise.reject():this.showDialog(n,t,e,r,a,i,o,u)}}]),e}())},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",function(){return a})},function(e,t,n){"use strict";n.d(t,"c",function(){return s}),n.d(t,"b",function(){return c}),n.d(t,"a",function(){return l});n(36),n(14),n(21),n(20),n(17),n(9),n(22),n(18),n(65),n(57);var r=n(1),a=function(e){return"?".concat(i(Object.assign({_:Date.now()},e)))},i=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object.keys(e).map(function(n){var r=e[n];return t?"".concat(encodeURIComponent(n),"=").concat(r?encodeURIComponent(r):""):"".concat(n,"=").concat(r||"")}).join("&")},o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="?"===t[0],r=e.indexOf("?");if(~r){var a=r+1===e.length;return"".concat(e).concat(a?"":"&").concat(t)}return"".concat(e).concat(n?"":"?").concat(t)},u=function(e){var t=e.url,n=e.data,r=void 0===n?"":n,a=e.type,i=void 0===a?"GET":a,o=e.progress,u=void 0===o?null:o,s=e.timeout,c=void 0===s?0:s;return new Promise(function(e,n){var a=window.navigator.userAgent,o=(a.toLowerCase().indexOf("trident/")>-1||a.toLowerCase().indexOf("msie"),function(){var e=null;try{e=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Msxml12.XMLHTTP")}catch(e){console.warn("创建xhr失败！")}return e}());if(null==o)return Promise.reject("创建xhr失败！");o.ontimeout=function(){return c&&n({code:l.TIMEOUT,message:"TimeOut"})},o.onload=function(){var t=o.readyState,r=o.status;try{return 4===t&&r>=400&&r<=599?n({code:l.ERROR,message:"error readyState: ".concat(t,", status: ").concat(r)}):e(o)}catch(e){return n({code:l.ERROR,message:e})}},o.withCredentials=!0,o.onerror=o.onabort=function(e){var r=t.split("/");return n({code:l.ERROR,message:"load error：".concat(r[r.length-1])})},u&&(o.onprogress=u),c&&o.timeout&&(o.timeout=c),o.open(i,t,!0),"POST"===i&&o.setRequestHeader("CONTENT-TYPE","application/x-www-form-urlencoded"),o.send(r)})};function s(e){var t=e.url,n=e.data,a=e.progress,o=void 0===a?null:a,s=e.timeout,c=void 0===s?0:s;return r.c.isObject(n)&&(n=i(n,!1)),u({url:t,type:"POST",data:n,progress:o,timeout:c})}function c(e){var t=e.url,n=e.data,i=e.progress,s=void 0===i?null:i,c=e.timeout,l=void 0===c?0:c;return r.c.isObject(n)&&(n=a(n,!1)),n&&(t=o(t,n)),u({url:t,progress:s,timeout:l})}var l={ERROR:999,TIMEOUT:9999}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",function(){return QHApi}),__webpack_require__.d(__webpack_exports__,"d",function(){return QzoneWBApi}),__webpack_require__.d(__webpack_exports__,"e",function(){return WXApi}),__webpack_require__.d(__webpack_exports__,"b",function(){return MKApi}),__webpack_require__.d(__webpack_exports__,"a",function(){return H54399Api});var core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(20),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(22),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_array_for_each__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(12),core_js_modules_es6_array_for_each__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_array_for_each__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(36),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(66),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_array_index_of__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(21),core_js_modules_es6_array_index_of__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_array_index_of__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(13),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(53),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es6_date_to_string__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(54),core_js_modules_es6_date_to_string__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es6_date_to_string__WEBPACK_IMPORTED_MODULE_9__),_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(4),_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(6),core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(14),core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(9),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(33),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(56),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_15__),immutability_helper__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(2),immutability_helper__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(immutability_helper__WEBPACK_IMPORTED_MODULE_16__),spark_md5__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(10),spark_md5__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(spark_md5__WEBPACK_IMPORTED_MODULE_17__),_common_Utils__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(1),_components_Dialog__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(5),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(0),_common_RequestUtils__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(7),encode=function(e,t){return encodeURIComponent(_common_Utils__WEBPACK_IMPORTED_MODULE_18__.c.aesEncrypt(e,t))},onChangeUrlArg=function onChangeUrlArg(url,arg,val){var pattern=arg+"=([^&]*)",replaceText=arg+"="+val;return url.match(pattern)?url.replace(eval("/("+arg+"=)([^&]*)/gi"),replaceText):url.match("[?]")?url+"&"+replaceText:url+"?"+replaceText},QH_SDK="//port.2r3r.com/game/qhjssdk",QH_PLOGIN="//ptlogin.3000.com/?m=ptlogin&ac=qhlogin",QH_PAY="https://pay.3000.com/qunhei/paydata.php",WX_SDK="https://res.wx.qq.com/open/js/jweixin-1.3.2.js",USER_IP="https://pv.sohu.com/cityjson?ie=utf-8",QZONE_PLOGIN="//ptlogin.3000.com/?m=ptlogin&ac=wblogin",QZONE_GETSHARECOUNT="https://my.3000.com/index.php?m=WanBa&op=index&ac=userShareCount&api_v=1.0.0&api_from=webpc",QZONE_POSTSHARECOUNT="https://my.3000.com/index.php?m=WanBa&op=index&ac=userShareToOther&api_v=1.0.0&api_from=webpc",QZONE_GETINTIVE="https://my.3000.com/index.php?m=WanBa&op=index&ac=wanbaUserInfo&api_v=1.0.0&api_from=webpc",QZONE_POSTGETPRIZE="https://my.3000.com/index.php?m=WanBa&op=index&ac=upReceiveCount&api_v=1.0.0&api_from=webpc",QZONE_SHARETITLEBYINVITE=["来玩一场惊心动魄的警匪游戏吧！","我执行任务遇到困难了，请求场外援助！","这是什么神仙探案游戏啊，我为男主哭了！！"],QZONE_SHARETITLE=["我在扮演热血警探，来协助我探寻真相吧……","我是一名卧底，快来帮我摆脱困境吧！"],QZONE_SHAREDESC=["玩TVB大剧《铁探》同名游戏，体验纯正港式警匪剧情，智勇双全的警探，热血善良的卧底，因为一颗子弹命运交织携手抗争，他们需要你的帮助！","《铁探》超好玩！改编自TVB同名电视剧，双男主热血勇敢又帅气，却命途坎坷令人心疼，快来陪我一起哭吧QAQ"],QZONE_DOMAIN="api.urlshare.cn",MK_PLOGIN="//ptlogin.3000.com/?m=ptlogin&ac=mklogin",MK_UNLOCK_CHAPTER="//pay.3000.com/?m=mkConsume&op=chapter&api_from=api",MK_PAY="//pay.3000.com/?m=mkConsume&op=market&api_from=api",isinvite=!1,loadJS=function(e){return new Promise(function(t,n){var r=document.getElementsByTagName("head").item(0),a=document.createElement("script");a.type="text/javascript",a.src=e,r.appendChild(a),a.onload=function(){return t({code:0,msg:"LOAD JS ".concat(e," SUCCESS")})},a.onerror=function(){return t({code:-1,msg:"LOAD JS ".concat(e," SUCCESS")})}})},QHApi=function(){function e(){Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_10__.a)(this,e)}return Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_11__.a)(e,null,[{key:"initQHSdk",value:function(){return loadJS(QH_SDK).then(function(e){var t={username:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_username,gid:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_qhgid,qhchannel:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_qhchannel,qhchannelid:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_qhchannelid};return window.qhsdk.init(t),e})}},{key:"qhpay",value:function(e,t,n,r,a,i,o){var u=spark_md5__WEBPACK_IMPORTED_MODULE_17___default.a.hash(e.toString()+_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_username+n+_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_key),s={userId:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_username,gid:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_qhgid,goodsId:t,goodsName:e+"闪币",money:e,roleName:"3000闪艺",ext:n,serverId:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_serverid,sign:u},c=a.payValues,l=JSON.parse(JSON.stringify(c));1===i&&(l[0].name=encodeURI(l[0].name));var d={game_id:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.gid,uuid:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.uuid,chapter_uuid:r,amount:e,set_value:0===i?"":_common_Utils__WEBPACK_IMPORTED_MODULE_18__.c.encodeBase64(JSON.stringify(l)),payindex:i,ext:n,event_id:t,qh_username:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_username,qh_qhgid:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_qhgid};return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_21__.c)({url:QH_PAY,data:JSON.stringify(d),timeout:4e3}),window.qhsdk.pay(s,function(){return console.log("群黑充值返回")}),_common_Utils__WEBPACK_IMPORTED_MODULE_18__.c.timeout(200).then(function(){return 0===i?_components_Dialog__WEBPACK_IMPORTED_MODULE_19__.a.custom("Info","如果购买成功则点击继续观看作品，如果暂不购买则不能继续。","是否支付成功？","已支付成功","暂不购买",!1).then(function(){return"success"},function(){return"cancel"}):_components_Dialog__WEBPACK_IMPORTED_MODULE_19__.a.custom("Info","若已支付成功，作品将会刷新，可读取存档继续观看。若暂不购买，将返回商城。","是否支付成功？","已支付成功","暂不购买",!1).then(function(){return window.location.reload()},function(){})})}},{key:"sendQHData",value:function(){var e={qh_username:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_username,qh_serverid:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_serverid,qh_time:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_time,qh_isadult:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_isadult,qh_flag:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_flag,qh_uid:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_uid,qh_nname:_common_Utils__WEBPACK_IMPORTED_MODULE_18__.c.encodeBase64(_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_nname),qh_qhchannel:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_qhchannel,qh_qhchannelid:_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qh_qhchannelid,refresh_token:1};return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_21__.c)({url:QH_PLOGIN,data:JSON.stringify(e),timeout:4e3}).then(function(e){if(0===e.responseText.length)return Promise.reject("Get failed, no response data");var t=JSON.parse(e.responseText);return 0===t.status&&!0===t.success&&t.data?(_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.uid=t.data.uid,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.token=t.data.token,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.u=t.data.u,!0):void 0})}}]),e}(),QzoneWBApi=function(){function e(){Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_10__.a)(this,e)}return Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_11__.a)(e,null,[{key:"initQzone",value:function(){try{if(-1!==window.location.hostname.indexOf("urlshare.cn")){var t=function(e,t){var n=t.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return null==n||n.length<1?"":n[1]};e.registerQzone(),e.reportLoginQzone();var n=navigator.userAgent,r=n.indexOf("Android")>-1||n.indexOf("Adr")>-1,a=!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return _common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.wap="qzone",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.client=r?"android":a?"ios":"android",e.getLoginInfoQzone().then(function(){return _common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appurl=window.OPEN_DATA.appurl,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_vindex=t("valuesindex",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_pindex=t("payvaluesindex",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appid=t("qzone_appid",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appkey=t("qzone_appkey",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.gid=t("gid",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.uuid=t("uuid",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.type=t("type",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.name=t("name",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.vertical=1==t("vertical",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_appurl),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.v="1.0.0",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.app_version="1.0.0",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.isWapOther=!0,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.shareViewName="g6ShareWoK",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.shareViewName1="SHARmkxnxi",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.inviteViewName="INVImkxnxi",_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.refreshViewName="UGTmkxnxi",!0})}return Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}},{key:"getUserIpInfo",value:function(){return loadJS(USER_IP).then(function(){return returnCitySN?returnCitySN.cip:""})}},{key:"registerQzone",value:function(){try{window.reportRegister()}catch(e){console.warn("请在QQ空间玩吧平台注册")}}},{key:"reportLoginQzone",value:function(){try{window.reportLogin()}catch(e){console.warn("请在玩吧QQ空间玩吧平台登入")}}},{key:"getLoginInfoQzone",value:function(){return new Promise(function(e,t){try{var n=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.client;window.getOpenKey(function(t){window.OPEN_DATA.via.indexOf("SHARE");var r=window.OPEN_DATA.shareurl.match(new RegExp("[?&]invite=([^&]+)","i"));_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_openid=window.OPEN_DATA.openid+"_".concat(n),_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_openkey=window.OPEN_DATA.openkey,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_pf=window.OPEN_DATA.pf,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.invite=r?r[1]:"",e(t)})}catch(e){console.warn("请在QQ空间玩吧平台使用"),t()}})}},{key:"postUserInfoQzone",value:function(e){var t=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_openid,n=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.invite,r=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.client,a=spark_md5__WEBPACK_IMPORTED_MODULE_17___default.a.hash(spark_md5__WEBPACK_IMPORTED_MODULE_17___default.a.hash(_common_Utils__WEBPACK_IMPORTED_MODULE_18__.c.dc([100,102,36,37,36,35,53,68,70,115,100,100,102,100])));return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_21__.c)({url:QZONE_PLOGIN,data:{openid:t,token:a,invite_openid:n,refresh_token:e,source:r},timeout:4e3}).then(function(e){if(0===e.responseText.length)return!1;var t=JSON.parse(e.responseText).data,n=t.uid,r=t.token,a=t.u;return _common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.uid=n,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.token=r,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.u=a,!0})}},{key:"getShareCountQzone",value:function(){var e=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_openid;return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_21__.c)({url:QZONE_GETSHARECOUNT,data:{openid:e},timeout:4e3}).then(function(e){if(0===e.responseText.length)return!1;var t=JSON.parse(e.responseText).data.share_count;return _common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_sharecount=t||0,!0},function(e){return Promise.resolve(!0)})}},{key:"postShareCountQzone",value:function(){var e=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_openid;return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_21__.c)({url:QZONE_POSTSHARECOUNT,data:{openid:encode(e,0)},timeout:4e3}).then(function(e){if(0===e.responseText.length)return!1;var t=JSON.parse(e.responseText).data.share_count;return _common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_sharecount=t||0,!0},function(e){return Promise.resolve(!0)})}},{key:"getIntiveInfoQzone",value:function(){var e=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_openid;return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_21__.c)({url:QZONE_GETINTIVE,data:{openid:e},timeout:4e3}).then(function(e){if(0===e.responseText.length)return!1;JSON.parse(e.responseText);var t=JSON.parse(e.responseText),n=t.status,r=t.data;if(100===n){var a=r.invited_count,i=r.receive_count;return _common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_invitecount=a,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_receivecount=i.split(","),!0}return!1})}},{key:"postGetPrizeQzone",value:function(){var e="",t=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_openid;return _common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_receivecount.forEach(function(t){return e+=t+","}),e=e.substring(0,e.length-1),Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_21__.c)({url:QZONE_POSTGETPRIZE,data:{openid:encode(t,0),receive_record:encode(e,0)},timeout:4e3})}},{key:"appointShareMessageQzone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{mqq.ui.shareMessage({title:QZONE_SHARETITLE[Math.floor(Math.random()*QZONE_SHARETITLE.length)],desc:QZONE_SHAREDESC[Math.floor(Math.random()*QZONE_SHAREDESC.length)],share_type:e,share_url:window.OPEN_DATA.shareurl,image_url:window.OPEN_DATA.appicon,back:!0},function(){})}catch(e){}}},{key:"openShareMessageQzone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{isinvite=e;var t=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_openid,n=onChangeUrlArg(window.OPEN_DATA.shareurl,"invite",t);mqq.ui.showShareMenu({title:isinvite?QZONE_SHARETITLEBYINVITE[Math.floor(Math.random()*QZONE_SHARETITLEBYINVITE.length)]:QZONE_SHARETITLE[Math.floor(Math.random()*QZONE_SHARETITLE.length)],desc:QZONE_SHAREDESC[Math.floor(Math.random()*QZONE_SHAREDESC.length)],share_url:n,image_url:window.OPEN_DATA.appicon},function(e){return e&&1===e.retCode?Promise.reject():Promise.resolve()})}catch(e){return Promise.reject()}}},{key:"addEventsSharePanelQzone",value:function(t){var n=[],r=t,a=!1;try{var i=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.qz_openid,o=onChangeUrlArg(window.OPEN_DATA.shareurl,"invite",i),u=function(e){isinvite=!1,e=e&&0===e.retCode,0===n.length?r(e):(n.forEach(function(t){return t&&t(e)}),n.length=0)};mqq.ui.setOnShareHandler(function(e){var t={title:isinvite?QZONE_SHARETITLEBYINVITE[Math.floor(Math.random()*QZONE_SHARETITLEBYINVITE.length)]:QZONE_SHARETITLE[Math.floor(Math.random()*QZONE_SHARETITLE.length)],desc:QZONE_SHAREDESC[Math.floor(Math.random()*QZONE_SHAREDESC.length)],share_type:e,share_url:o,image_url:window.OPEN_DATA.appicon,back:!0};mqq.ui.shareMessage(t,u)})}catch(e){a=!0}return e.addEventsSharePanelQzone=function(e){a?e&&e(!1):e&&n.push(e)},e.addEventsSharePanelQzone(t)}}]),e}(),WXApi=function(){function e(){Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_10__.a)(this,e)}return Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_11__.a)(e,null,[{key:"initWx",value:function(){return loadJS(WX_SDK)}},{key:"openWxPage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pop",t=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.gid;wx.miniProgram.getEnv(function(n){"pop"===e?wx.miniProgram.redirectTo({url:"/pages/play/main?id=".concat(t,"&").concat(e,"=1")}):"back"===e&&wx.miniProgram.navigateBack({delta:1})})}}]),e}(),MKApi=function(){function e(){Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_10__.a)(this,e)}return Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_11__.a)(e,null,[{key:"initMkbySy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.mk_access_token,n=_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.client;return Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_21__.c)({url:MK_PLOGIN,data:{access_token:t,source:n,refresh_token:e},timeout:4e3}).then(function(e){if(0===e.responseText.length)return!1;var t=JSON.parse(e.responseText),n=t.status;if(_common_Utils__WEBPACK_IMPORTED_MODULE_18__.c.isObject(t.data)&&100==n){var r=t.data,a=r.uid,i=r.token,o=r.u,u=r.outreach_uid;return _common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.uid=a,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.token=i,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.u=o,_common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.mk_uid=u,!0}return!1},function(e){return Promise.resolve(!1)})}},{key:"mkPay",value:function(e){var t=2==(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)?MK_UNLOCK_CHAPTER:MK_PAY;return Object.keys(e).forEach(function(t){return e[t]=encode(e[t],4)}),Object(_common_RequestUtils__WEBPACK_IMPORTED_MODULE_21__.c)({url:t,data:e,timeout:4e3}).then(function(e){if(0===e.responseText.length)return!1;var t=JSON.parse(e.responseText),n=t.success,r=t.status;return 1==n&&100==r},function(e){return Promise.resolve(!0)})}},{key:"addEventMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Promise(function(n,r){try{window.addEventListener("message",function(a){a.data.sign==e&&"success"==a.data.status?1==t?"ok"==a.data.data?n():r():2==t?n(a.data.data):r():r()})}catch(e){r()}})}},{key:"mkPayPopup",value:function(e,t,n,r){var a=this;return new Promise(function(i,o){try{a.addEventMessage(r,1).then(function(){return i()},function(){return o()}),top.postMessage({type:"dialog_pay",title:e,content:t,price:n,sign:r},"http://manga.1kxun.mobi")}catch(e){o()}})}},{key:"mkLoginPopup",value:function(t){var n=this;return new Promise(function(r,a){try{n.addEventMessage(t,2).then(function(t){return _common_Parameter__WEBPACK_IMPORTED_MODULE_20__.a.mk_access_token=t||"",e.initMkbySy(1)},function(){return a()}),top.postMessage({type:"login",sign:t},"http://manga.1kxun.mobi")}catch(e){a()}})}}]),e}(),H54399Api=function(){function e(){Object(_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_10__.a)(this,e)}return Object(_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_11__.a)(e,null,[{key:"init4399Api",value:function(){return loadJS("//h.api.4399.com/h5mini-2.0/h5api-interface.php").then(function(e){return Promise.resolve(e)})}},{key:"playAd",value:function(){try{window.h5api.playAd(function(e){if(1e4!==e.code)return 10001===e.code?resolve(1):resolve(0)})}catch(e){return resolve(0)}}},{key:"canPlayAd",value:function(){return new Promise(function(e,t){try{window.h5api.canPlayAd(function(t){if(t){var n=t.canPlayAd,r=parseInt(t.remain);return e({canplay:n,remain:r})}return e({canplay:!1,remain:0})})}catch(t){return e({canplay:!1,remain:0})}})}}]),e}()},function(e,t,n){"use strict";var r=n(58),a={};a[n(16)("toStringTag")]="z",a+""!="[object z]"&&n(35)(Object.prototype,"toString",function(){return"[object "+r(this)+"]"},!0)},function(e,t,n){e.exports=n(50)(44)},function(e,t,n){var r=n(19),a=n(51),i=n(34),o=n(35),u=n(45),s=function(e,t,n){var c,l,d,h,f=e&s.F,p=e&s.G,v=e&s.S,m=e&s.P,g=e&s.B,y=p?r:v?r[t]||(r[t]={}):(r[t]||{}).prototype,_=p?a:a[t]||(a[t]={}),w=_.prototype||(_.prototype={});for(c in p&&(n=t),n)d=((l=!f&&y&&void 0!==y[c])?y:n)[c],h=g&&l?u(d,r):m&&"function"==typeof d?u(Function.call,d):d,y&&o(y,c,d,e&s.U),_[c]!=d&&i(_,c,h),m&&w[c]!=d&&(w[c]=d)};r.core=a,s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,e.exports=s},function(e,t,n){"use strict";var r=n(11),a=n(46)(0),i=n(47)([].forEach,!0);r(r.P+r.F*!i,"Array",{forEach:function(e){return a(this,e,arguments[1])}})},function(e,t,n){var r=n(30).f,a=Function.prototype,i=/^\s*function ([^ (]*)/;"name"in a||n(25)&&r(a,"name",{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(e){return""}}})},function(e,t,n){"use strict";var r,a,i,o,u=n(59),s=n(19),c=n(45),l=n(58),d=n(11),h=n(29),f=n(61),p=n(93),v=n(151),m=n(95),g=n(120).set,y=n(154)(),_=n(121),w=n(155),b=n(156),k=n(157),x=s.TypeError,P=s.process,C=P&&P.versions,S=C&&C.v8||"",O=s.Promise,E="process"==l(P),I=function(){},A=a=_.f,M=!!function(){try{var e=O.resolve(1),t=(e.constructor={})[n(16)("species")]=function(e){e(I,I)};return(E||"function"==typeof PromiseRejectionEvent)&&e.then(I)instanceof t&&0!==S.indexOf("6.6")&&-1===b.indexOf("Chrome/66")}catch(e){}}(),T=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},V=function(e,t){if(!e._n){e._n=!0;var n=e._c;y(function(){for(var r=e._v,a=1==e._s,i=0,o=function(t){var n,i,o,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,l=t.domain;try{u?(a||(2==e._h&&D(e),e._h=1),!0===u?n=r:(l&&l.enter(),n=u(r),l&&(l.exit(),o=!0)),n===t.promise?c(x("Promise-chain cycle")):(i=T(n))?i.call(n,s,c):s(n)):c(r)}catch(e){l&&!o&&l.exit(),c(e)}};n.length>i;)o(n[i++]);e._c=[],e._n=!1,t&&!e._h&&j(e)})}},j=function(e){g.call(s,function(){var t,n,r,a=e._v,i=U(e);if(i&&(t=w(function(){E?P.emit("unhandledRejection",a,e):(n=s.onunhandledrejection)?n({promise:e,reason:a}):(r=s.console)&&r.error&&r.error("Unhandled promise rejection",a)}),e._h=E||U(e)?2:1),e._a=void 0,i&&t.e)throw t.v})},U=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){g.call(s,function(){var t;E?P.emit("rejectionHandled",e):(t=s.onrejectionhandled)&&t({promise:e,reason:e._v})})},R=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),V(t,!0))},B=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw x("Promise can't be resolved itself");(t=T(e))?y(function(){var r={_w:n,_d:!1};try{t.call(e,c(B,r,1),c(R,r,1))}catch(e){R.call(r,e)}}):(n._v=e,n._s=1,V(n,!1))}catch(e){R.call({_w:n,_d:!1},e)}}};M||(O=function(e){p(this,O,"Promise","_h"),f(e),r.call(this);try{e(c(B,this,1),c(R,this,1))}catch(e){R.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(92)(O.prototype,{then:function(e,t){var n=A(m(this,O));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=E?P.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&V(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new r;this.promise=e,this.resolve=c(B,e,1),this.reject=c(R,e,1)},_.f=A=function(e){return e===O||e===o?new i(e):a(e)}),d(d.G+d.W+d.F*!M,{Promise:O}),n(80)(O,"Promise"),n(96)("Promise"),o=n(51).Promise,d(d.S+d.F*!M,"Promise",{reject:function(e){var t=A(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(u||!M),"Promise",{resolve:function(e){return k(u&&this===o?O:this,e)}}),d(d.S+d.F*!(M&&n(117)(function(e){O.all(e).catch(I)})),"Promise",{all:function(e){var t=this,n=A(t),r=n.resolve,a=n.reject,i=w(function(){var n=[],i=0,o=1;v(e,!1,function(e){var u=i++,s=!1;n.push(void 0),o++,t.resolve(e).then(function(e){s||(s=!0,n[u]=e,--o||r(n))},a)}),--o||r(n)});return i.e&&a(i.v),n.promise},race:function(e){var t=this,n=A(t),r=n.reject,a=w(function(){v(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return a.e&&r(a.v),n.promise}})},function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(t,"a",function(){return r})},function(e,t,n){var r=n(86)("wks"),a=n(60),i=n(19).Symbol,o="function"==typeof i;(e.exports=function(e){return r[e]||(r[e]=o&&i[e]||(o?i:a)("Symbol."+e))}).store=r},function(e,t,n){"use strict";var r=n(62),a=n(136),i=n(52),o=n(63);e.exports=n(104)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(e,t,n){"use strict";var r=n(11),a=n(46)(1);r(r.P+r.F*!n(47)([].map,!0),"Array",{map:function(e){return a(this,e,arguments[1])}})},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){for(var r=n(17),a=n(77),i=n(35),o=n(19),u=n(34),s=n(52),c=n(16),l=c("iterator"),d=c("toStringTag"),h=s.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=a(f),v=0;v<p.length;v++){var m,g=p[v],y=f[g],_=o[g],w=_&&_.prototype;if(w&&(w[l]||u(w,l,h),w[d]||u(w,d,g),s[g]=h,y))for(m in r)w[m]||i(w,m,r[m],!0)}},function(e,t,n){"use strict";var r=n(11),a=n(78)(!1),i=[].indexOf,o=!!i&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(o||!n(47)(i)),"Array",{indexOf:function(e){return o?i.apply(this,arguments)||0:a(this,e,arguments[1])}})},function(e,t,n){var r=n(37),a=n(77);n(139)("keys",function(){return function(e){return a(r(e))}})},function(e,t,n){var r=n(29);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(38),a=Math.min;e.exports=function(e){return e>0?a(r(e),9007199254740991):0}},function(e,t,n){e.exports=!n(26)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(11);r(r.S,"Array",{isArray:n(108)})},function(e,t,n){e.exports=n(50)(14)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(23),a=n(103),i=n(73),o=Object.defineProperty;t.f=n(25)?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),a)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){"use strict";var r=n(11),a=n(46)(3);r(r.P+r.F*!n(47)([].some,!0),"Array",{some:function(e){return a(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(11),a=n(46)(6),i="findIndex",o=!0;i in[]&&Array(1)[i](function(){o=!1}),r(r.P+r.F*o,"Array",{findIndex:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),n(62)(i)},function(e,t,n){"use strict";var r=n(23),a=n(37),i=n(24),o=n(38),u=n(85),s=n(70),c=Math.max,l=Math.min,d=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,f=/\$([$&`']|\d\d?)/g;n(71)("replace",2,function(e,t,n,p){return[function(r,a){var i=e(this),o=null==r?void 0:r[t];return void 0!==o?o.call(r,i,a):n.call(String(i),r,a)},function(e,t){var a=p(n,e,this,t);if(a.done)return a.value;var d=r(e),h=String(this),f="function"==typeof t;f||(t=String(t));var m=d.global;if(m){var g=d.unicode;d.lastIndex=0}for(var y=[];;){var _=s(d,h);if(null===_)break;if(y.push(_),!m)break;""===String(_[0])&&(d.lastIndex=u(h,i(d.lastIndex),g))}for(var w,b="",k=0,x=0;x<y.length;x++){_=y[x];for(var P=String(_[0]),C=c(l(o(_.index),h.length),0),S=[],O=1;O<_.length;O++)S.push(void 0===(w=_[O])?w:String(w));var E=_.groups;if(f){var I=[P].concat(S,C,h);void 0!==E&&I.push(E);var A=String(t.apply(void 0,I))}else A=v(P,h,C,S,E,t);C>=k&&(b+=h.slice(k,C)+A,k=C+P.length)}return b+h.slice(k)}];function v(e,t,r,i,o,u){var s=r+e.length,c=i.length,l=f;return void 0!==o&&(o=a(o),l=h),n.call(u,l,function(n,a){var u;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(s);case"<":u=o[a.slice(1,-1)];break;default:var l=+a;if(0===l)return n;if(l>c){var h=d(l/10);return 0===h?n:h<=c?void 0===i[h-1]?a.charAt(1):i[h-1]+a.charAt(1):n}u=i[l-1]}return void 0===u?"":u})}})},function(e,t,n){var r=n(30),a=n(74);e.exports=n(25)?function(e,t,n){return r.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(19),a=n(34),i=n(44),o=n(60)("src"),u=n(135),s=(""+u).split("toString");n(51).inspectSource=function(e){return u.call(e)},(e.exports=function(e,t,n,u){var c="function"==typeof n;c&&(i(n,"name")||a(n,"name",t)),e[t]!==n&&(c&&(i(n,o)||a(n,o,e[t]?""+e[t]:s.join(String(t)))),e===r?e[t]=n:u?e[t]?e[t]=n:a(e,t,n):(delete e[t],a(e,t,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[o]||u.call(this)})},function(e,t,n){"use strict";var r=n(91),a=n(23),i=n(95),o=n(85),u=n(24),s=n(70),c=n(87),l=n(26),d=Math.min,h=[].push,f=!l(function(){RegExp(4294967295,"y")});n(71)("split",2,function(e,t,n,l){var p;return p="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,t){var a=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(a,e,t);for(var i,o,u,s=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),d=0,f=void 0===t?4294967295:t>>>0,p=new RegExp(e.source,l+"g");(i=c.call(p,a))&&!((o=p.lastIndex)>d&&(s.push(a.slice(d,i.index)),i.length>1&&i.index<a.length&&h.apply(s,i.slice(1)),u=i[0].length,d=o,s.length>=f));)p.lastIndex===i.index&&p.lastIndex++;return d===a.length?!u&&p.test("")||s.push(""):s.push(a.slice(d)),s.length>f?s.slice(0,f):s}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var a=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,a,r):p.call(String(a),n,r)},function(e,t){var r=l(p,e,this,t,p!==n);if(r.done)return r.value;var c=a(e),h=String(this),v=i(c,RegExp),m=c.unicode,g=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(f?"y":"g"),y=new v(f?c:"^(?:"+c.source+")",g),_=void 0===t?4294967295:t>>>0;if(0===_)return[];if(0===h.length)return null===s(y,h)?[h]:[];for(var w=0,b=0,k=[];b<h.length;){y.lastIndex=f?b:0;var x,P=s(y,f?h:h.slice(b));if(null===P||(x=d(u(y.lastIndex+(f?0:b)),h.length))===w)b=o(h,b,m);else{if(k.push(h.slice(w,b)),k.length===_)return k;for(var C=1;C<=P.length-1;C++)if(k.push(P[C]),k.length===_)return k;b=w=x}}return k.push(h.slice(w)),k}]})},function(e,t,n){var r=n(40);e.exports=function(e){return Object(r(e))}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){"use strict";var r=n(11),a=n(46)(5),i=!0;"find"in[]&&Array(1).find(function(){i=!1}),r(r.P+r.F*i,"Array",{find:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),n(62)("find")},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)a(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,a){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),a);else for(var i=0;i<r;i++)e[a+i]=t[n+i]},flattenChunks:function(e){var t,n,r,a,i,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),a=0,t=0,n=e.length;t<n;t++)i=e[t],o.set(i,a),a+=i.length;return o}},o={arraySet:function(e,t,n,r,a){for(var i=0;i<r;i++)e[a+i]=t[n+i]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(r)},function(e,t,n){"use strict";var r=n(11),a=n(46)(2);r(r.P+r.F*!n(47)([].filter,!0),"Array",{filter:function(e){return a(this,e,arguments[1])}})},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(61);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(45),a=n(75),i=n(37),o=n(24),u=n(140);e.exports=function(e,t){var n=1==e,s=2==e,c=3==e,l=4==e,d=6==e,h=5==e||d,f=t||u;return function(t,u,p){for(var v,m,g=i(t),y=a(g),_=r(u,p,3),w=o(y.length),b=0,k=n?f(t,w):s?f(t,0):void 0;w>b;b++)if((h||b in y)&&(m=_(v=y[b],b,g),e))if(n)k[b]=m;else if(m)switch(e){case 3:return!0;case 5:return v;case 6:return b;case 2:k.push(v)}else if(l)return!1;return d?-1:c||l?l:k}}},function(e,t,n){"use strict";var r=n(26);e.exports=function(e,t){return!!e&&r(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,n){"use strict";var r=n(11),a=n(78)(!0);r(r.P,"Array",{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),n(62)("includes")},function(e,t,n){"use strict";var r=n(11),a=n(109);r(r.P+r.F*n(110)("includes"),"String",{includes:function(e){return!!~a(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t){e.exports=vendors_library},function(e,t){var n=e.exports={version:"2.6.5"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports={}},function(e,t,n){"use strict";n(142);var r=n(23),a=n(72),i=n(25),o=/./.toString,u=function(e){n(35)(RegExp.prototype,"toString",e,!0)};n(26)(function(){return"/a/b"!=o.call({source:"a",flags:"b"})})?u(function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!i&&e instanceof RegExp?a.call(e):void 0)}):"toString"!=o.name&&u(function(){return o.call(this)})},function(e,t,n){var r=Date.prototype,a=r.toString,i=r.getTime;new Date(NaN)+""!="Invalid Date"&&n(35)(r,"toString",function(){var e=i.call(this);return e==e?a.call(this):"Invalid Date"})},function(e,t,n){var r=n(11);r(r.P,"Array",{fill:n(94)}),n(62)("fill")},function(e,t,n){"use strict";var r=n(23),a=n(24),i=n(85),o=n(70);n(71)("match",1,function(e,t,n,u){return[function(n){var r=e(this),a=null==n?void 0:n[t];return void 0!==a?a.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=u(n,e,this);if(t.done)return t.value;var s=r(e),c=String(this);if(!s.global)return o(s,c);var l=s.unicode;s.lastIndex=0;for(var d,h=[],f=0;null!==(d=o(s,c));){var p=String(d[0]);h[f]=p,""===p&&(s.lastIndex=i(c,a(s.lastIndex),l)),f++}return 0===f?null:h}]})},function(e,t,n){var r=n(11);r(r.S+r.F,"Object",{assign:n(176)})},function(e,t,n){var r=n(43),a=n(16)("toStringTag"),i="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?n:i?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t){e.exports=!1},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(16)("unscopables"),a=Array.prototype;null==a[r]&&n(34)(a,r,{}),e.exports=function(e){a[r][e]=!0}},function(e,t,n){var r=n(75),a=n(40);e.exports=function(e){return r(a(e))}},function(e,t,n){"use strict";var r=n(11),a=n(63),i=n(38),o=n(24),u=[].lastIndexOf,s=!!u&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(s||!n(47)(u)),"Array",{lastIndexOf:function(e){if(s)return u.apply(this,arguments)||0;var t=a(this),n=o(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,i(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},function(e,t,n){var r=n(11);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,n){var r=n(19),a=n(119),i=n(30).f,o=n(81).f,u=n(91),s=n(72),c=r.RegExp,l=c,d=c.prototype,h=/a/g,f=/a/g,p=new c(h)!==h;if(n(25)&&(!p||n(26)(function(){return f[n(16)("match")]=!1,c(h)!=h||c(f)==f||"/a/i"!=c(h,"i")}))){c=function(e,t){var n=this instanceof c,r=u(e),i=void 0===t;return!n&&r&&e.constructor===c&&i?e:a(p?new l(r&&!i?e.source:e,t):l((r=e instanceof c)?e.source:e,r&&i?s.call(e):t),n?this:d,c)};for(var v=function(e){e in c||i(c,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},m=o(l),g=0;m.length>g;)v(m[g++]);d.constructor=c,c.prototype=d,n(35)(r,"RegExp",c)}n(96)("RegExp")},function(e,t,n){"use strict";var r=n(102)(!0);n(104)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){"use strict";n(100)("bold",function(e){return function(){return e(this,"b","","")}})},function(e,t,n){e.exports=n(50)(38)},function(e,t,n){"use strict";var r=n(58),a=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var i=n.call(e,t);if("object"!=typeof i)throw new TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return a.call(e,t)}},function(e,t,n){"use strict";n(134);var r=n(35),a=n(34),i=n(26),o=n(40),u=n(16),s=n(87),c=u("species"),l=!i(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),d=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var h=u(e),f=!i(function(){var t={};return t[h]=function(){return 7},7!=""[e](t)}),p=f?!i(function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[c]=function(){return n}),n[h](""),!t}):void 0;if(!f||!p||"replace"===e&&!l||"split"===e&&!d){var v=/./[h],m=n(o,h,""[e],function(e,t,n,r,a){return t.exec===s?f&&!a?{done:!0,value:v.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),g=m[0],y=m[1];r(String.prototype,e,g),a(RegExp.prototype,h,2==t?function(e,t){return y.call(e,this,t)}:function(e){return y.call(e,this)})}}},function(e,t,n){"use strict";var r=n(23);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){var r=n(29);e.exports=function(e,t){if(!r(e))return e;var n,a;if(t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;if("function"==typeof(n=e.valueOf)&&!r(a=n.call(e)))return a;if(!t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(43);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(23),a=n(138),i=n(90),o=n(89)("IE_PROTO"),u=function(){},s=function(){var e,t=n(88)("iframe"),r=i.length;for(t.style.display="none",n(106).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),s=e.F;r--;)delete s.prototype[i[r]];return s()};e.exports=Object.create||function(e,t){var n;return null!==e?(u.prototype=r(e),n=new u,u.prototype=null,n[o]=e):n=s(),void 0===t?n:a(n,t)}},function(e,t,n){var r=n(105),a=n(90);e.exports=Object.keys||function(e){return r(e,a)}},function(e,t,n){var r=n(63),a=n(24),i=n(79);e.exports=function(e){return function(t,n,o){var u,s=r(t),c=a(s.length),l=i(o,c);if(e&&n!=n){for(;c>l;)if((u=s[l++])!=u)return!0}else for(;c>l;l++)if((e||l in s)&&s[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var r=n(38),a=Math.max,i=Math.min;e.exports=function(e,t){return(e=r(e))<0?a(e+t,0):i(e,t)}},function(e,t,n){var r=n(30).f,a=n(44),i=n(16)("toStringTag");e.exports=function(e,t,n){e&&!a(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},function(e,t,n){var r=n(105),a=n(90).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,a)}},function(e,t,n){"use strict";var r=n(19),a=n(44),i=n(43),o=n(119),u=n(73),s=n(26),c=n(81).f,l=n(97).f,d=n(30).f,h=n(146).trim,f=r.Number,p=f,v=f.prototype,m="Number"==i(n(76)(v)),g="trim"in String.prototype,y=function(e){var t=u(e,!1);if("string"==typeof t&&t.length>2){var n,r,a,i=(t=g?t.trim():h(t,3)).charCodeAt(0);if(43===i||45===i){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===i){switch(t.charCodeAt(1)){case 66:case 98:r=2,a=49;break;case 79:case 111:r=8,a=55;break;default:return+t}for(var o,s=t.slice(2),c=0,l=s.length;c<l;c++)if((o=s.charCodeAt(c))<48||o>a)return NaN;return parseInt(s,r)}}return+t};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof f&&(m?s(function(){v.valueOf.call(n)}):"Number"!=i(n))?o(new p(y(t)),n,f):y(t)};for(var _,w=n(25)?c(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),b=0;w.length>b;b++)a(p,_=w[b])&&!a(f,_)&&d(f,_,l(p,_));f.prototype=v,v.constructor=f,n(35)(r,"Number",f)}},function(e,t,n){"use strict";var r=n(11),a=n(150);r(r.P+r.F*!n(47)([].reduce,!0),"Array",{reduce:function(e){return a(this,e,arguments.length,arguments[1],!1)}})},function(e,t,n){"use strict";var r=n(11),a=n(24),i=n(109),o="".startsWith;r(r.P+r.F*n(110)("startsWith"),"String",{startsWith:function(e){var t=i(this,e,"startsWith"),n=a(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return o?o.call(t,r,n):t.slice(n,n+r.length)===r}})},function(e,t,n){"use strict";var r=n(102)(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},function(e,t,n){var r=n(51),a=n(19),i=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(59)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){"use strict";var r,a,i=n(72),o=RegExp.prototype.exec,u=String.prototype.replace,s=o,c=(r=/a/,a=/b*/g,o.call(r,"a"),o.call(a,"a"),0!==r.lastIndex||0!==a.lastIndex),l=void 0!==/()??/.exec("")[1];(c||l)&&(s=function(e){var t,n,r,a,s=this;return l&&(n=new RegExp("^"+s.source+"$(?!\\s)",i.call(s))),c&&(t=s.lastIndex),r=o.call(s,e),c&&r&&(s.lastIndex=s.global?r.index+r[0].length:t),l&&r&&r.length>1&&u.call(r[0],n,function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(r[a]=void 0)}),r}),e.exports=s},function(e,t,n){var r=n(29),a=n(19).document,i=r(a)&&r(a.createElement);e.exports=function(e){return i?a.createElement(e):{}}},function(e,t,n){var r=n(86)("keys"),a=n(60);e.exports=function(e){return r[e]||(r[e]=a(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(29),a=n(43),i=n(16)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[i])?!!t:"RegExp"==a(e))}},function(e,t,n){var r=n(35);e.exports=function(e,t,n){for(var a in t)r(e,a,t[a],n);return e}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){"use strict";var r=n(37),a=n(79),i=n(24);e.exports=function(e){for(var t=r(this),n=i(t.length),o=arguments.length,u=a(o>1?arguments[1]:void 0,n),s=o>2?arguments[2]:void 0,c=void 0===s?n:a(s,n);c>u;)t[u++]=e;return t}},function(e,t,n){var r=n(23),a=n(61),i=n(16)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||null==(n=r(o)[i])?t:a(n)}},function(e,t,n){"use strict";var r=n(19),a=n(30),i=n(25),o=n(16)("species");e.exports=function(e){var t=r[e];i&&t&&!t[o]&&a.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(118),a=n(74),i=n(63),o=n(73),u=n(44),s=n(103),c=Object.getOwnPropertyDescriptor;t.f=n(25)?c:function(e,t){if(e=i(e),t=o(t,!0),s)try{return c(e,t)}catch(e){}if(u(e,t))return a(!r.f.call(e,t),e[t])}},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){var r=n(11);r(r.S,"Object",{create:n(76)})},function(e,t,n){var r=n(11),a=n(26),i=n(40),o=/"/g,u=function(e,t,n,r){var a=String(i(e)),u="<"+t;return""!==n&&(u+=" "+n+'="'+String(r).replace(o,"&quot;")+'"'),u+">"+a+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(u),r(r.P+r.F*a(function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}),"String",n)}},function(e,t,n){"use strict";var r={};(0,n(41).assign)(r,n(164),n(167),n(126)),e.exports=r},function(e,t,n){var r=n(38),a=n(40);e.exports=function(e){return function(t,n){var i,o,u=String(a(t)),s=r(n),c=u.length;return s<0||s>=c?e?"":void 0:(i=u.charCodeAt(s))<55296||i>56319||s+1===c||(o=u.charCodeAt(s+1))<56320||o>57343?e?u.charAt(s):i:e?u.slice(s,s+2):o-56320+(i-55296<<10)+65536}}},function(e,t,n){e.exports=!n(25)&&!n(26)(function(){return 7!=Object.defineProperty(n(88)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){"use strict";var r=n(59),a=n(11),i=n(35),o=n(34),u=n(52),s=n(137),c=n(80),l=n(107),d=n(16)("iterator"),h=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,p,v,m,g){s(n,t,p);var y,_,w,b=function(e){if(!h&&e in C)return C[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},k=t+" Iterator",x="values"==v,P=!1,C=e.prototype,S=C[d]||C["@@iterator"]||v&&C[v],O=S||b(v),E=v?x?b("entries"):O:void 0,I="Array"==t&&C.entries||S;if(I&&(w=l(I.call(new e)))!==Object.prototype&&w.next&&(c(w,k,!0),r||"function"==typeof w[d]||o(w,d,f)),x&&S&&"values"!==S.name&&(P=!0,O=function(){return S.call(this)}),r&&!g||!h&&!P&&C[d]||o(C,d,O),u[t]=O,u[k]=f,v)if(y={values:x?O:b("values"),keys:m?O:b("keys"),entries:E},g)for(_ in y)_ in C||i(C,_,y[_]);else a(a.P+a.F*(h||P),t,y);return y}},function(e,t,n){var r=n(44),a=n(63),i=n(78)(!1),o=n(89)("IE_PROTO");e.exports=function(e,t){var n,u=a(e),s=0,c=[];for(n in u)n!=o&&r(u,n)&&c.push(n);for(;t.length>s;)r(u,n=t[s++])&&(~i(c,n)||c.push(n));return c}},function(e,t,n){var r=n(19).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(44),a=n(37),i=n(89)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){var r=n(43);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(91),a=n(40);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(a(e))}},function(e,t,n){var r=n(16)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,n){n(112)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){"use strict";if(n(25)){var r=n(59),a=n(19),i=n(26),o=n(11),u=n(113),s=n(143),c=n(45),l=n(93),d=n(74),h=n(34),f=n(92),p=n(38),v=n(24),m=n(114),g=n(79),y=n(73),_=n(44),w=n(58),b=n(29),k=n(37),x=n(115),P=n(76),C=n(107),S=n(81).f,O=n(116),E=n(60),I=n(16),A=n(46),M=n(78),T=n(95),V=n(17),j=n(52),U=n(117),D=n(96),R=n(94),B=n(144),L=n(30),F=n(97),z=L.f,W=F.f,N=a.RangeError,$=a.TypeError,H=a.Uint8Array,q=Array.prototype,K=s.ArrayBuffer,G=s.DataView,J=A(0),Q=A(2),Z=A(3),Y=A(4),X=A(5),ee=A(6),te=M(!0),ne=M(!1),re=V.values,ae=V.keys,ie=V.entries,oe=q.lastIndexOf,ue=q.reduce,se=q.reduceRight,ce=q.join,le=q.sort,de=q.slice,he=q.toString,fe=q.toLocaleString,pe=I("iterator"),ve=I("toStringTag"),me=E("typed_constructor"),ge=E("def_constructor"),ye=u.CONSTR,_e=u.TYPED,we=u.VIEW,be=A(1,function(e,t){return Se(T(e,e[ge]),t)}),ke=i(function(){return 1===new H(new Uint16Array([1]).buffer)[0]}),xe=!!H&&!!H.prototype.set&&i(function(){new H(1).set({})}),Pe=function(e,t){var n=p(e);if(n<0||n%t)throw N("Wrong offset!");return n},Ce=function(e){if(b(e)&&_e in e)return e;throw $(e+" is not a typed array!")},Se=function(e,t){if(!(b(e)&&me in e))throw $("It is not a typed array constructor!");return new e(t)},Oe=function(e,t){return Ee(T(e,e[ge]),t)},Ee=function(e,t){for(var n=0,r=t.length,a=Se(e,r);r>n;)a[n]=t[n++];return a},Ie=function(e,t,n){z(e,t,{get:function(){return this._d[n]}})},Ae=function(e){var t,n,r,a,i,o,u=k(e),s=arguments.length,l=s>1?arguments[1]:void 0,d=void 0!==l,h=O(u);if(null!=h&&!x(h)){for(o=h.call(u),r=[],t=0;!(i=o.next()).done;t++)r.push(i.value);u=r}for(d&&s>2&&(l=c(l,arguments[2],2)),t=0,n=v(u.length),a=Se(this,n);n>t;t++)a[t]=d?l(u[t],t):u[t];return a},Me=function(){for(var e=0,t=arguments.length,n=Se(this,t);t>e;)n[e]=arguments[e++];return n},Te=!!H&&i(function(){fe.call(new H(1))}),Ve=function(){return fe.apply(Te?de.call(Ce(this)):Ce(this),arguments)},je={copyWithin:function(e,t){return B.call(Ce(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return Y(Ce(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return R.apply(Ce(this),arguments)},filter:function(e){return Oe(this,Q(Ce(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return X(Ce(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Ce(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){J(Ce(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ne(Ce(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Ce(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ce.apply(Ce(this),arguments)},lastIndexOf:function(e){return oe.apply(Ce(this),arguments)},map:function(e){return be(Ce(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return ue.apply(Ce(this),arguments)},reduceRight:function(e){return se.apply(Ce(this),arguments)},reverse:function(){for(var e,t=Ce(this).length,n=Math.floor(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return Z(Ce(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return le.call(Ce(this),e)},subarray:function(e,t){var n=Ce(this),r=n.length,a=g(e,r);return new(T(n,n[ge]))(n.buffer,n.byteOffset+a*n.BYTES_PER_ELEMENT,v((void 0===t?r:g(t,r))-a))}},Ue=function(e,t){return Oe(this,de.call(Ce(this),e,t))},De=function(e){Ce(this);var t=Pe(arguments[1],1),n=this.length,r=k(e),a=v(r.length),i=0;if(a+t>n)throw N("Wrong length!");for(;i<a;)this[t+i]=r[i++]},Re={entries:function(){return ie.call(Ce(this))},keys:function(){return ae.call(Ce(this))},values:function(){return re.call(Ce(this))}},Be=function(e,t){return b(e)&&e[_e]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Le=function(e,t){return Be(e,t=y(t,!0))?d(2,e[t]):W(e,t)},Fe=function(e,t,n){return!(Be(e,t=y(t,!0))&&b(n)&&_(n,"value"))||_(n,"get")||_(n,"set")||n.configurable||_(n,"writable")&&!n.writable||_(n,"enumerable")&&!n.enumerable?z(e,t,n):(e[t]=n.value,e)};ye||(F.f=Le,L.f=Fe),o(o.S+o.F*!ye,"Object",{getOwnPropertyDescriptor:Le,defineProperty:Fe}),i(function(){he.call({})})&&(he=fe=function(){return ce.call(this)});var ze=f({},je);f(ze,Re),h(ze,pe,Re.values),f(ze,{slice:Ue,set:De,constructor:function(){},toString:he,toLocaleString:Ve}),Ie(ze,"buffer","b"),Ie(ze,"byteOffset","o"),Ie(ze,"byteLength","l"),Ie(ze,"length","e"),z(ze,ve,{get:function(){return this[_e]}}),e.exports=function(e,t,n,s){var c=e+((s=!!s)?"Clamped":"")+"Array",d="get"+e,f="set"+e,p=a[c],g=p||{},y=p&&C(p),_=!p||!u.ABV,k={},x=p&&p.prototype,O=function(e,n){z(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[d](n*t+r.o,ke)}(this,n)},set:function(e){return function(e,n,r){var a=e._d;s&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),a.v[f](n*t+a.o,r,ke)}(this,n,e)},enumerable:!0})};_?(p=n(function(e,n,r,a){l(e,p,c,"_d");var i,o,u,s,d=0,f=0;if(b(n)){if(!(n instanceof K||"ArrayBuffer"==(s=w(n))||"SharedArrayBuffer"==s))return _e in n?Ee(p,n):Ae.call(p,n);i=n,f=Pe(r,t);var g=n.byteLength;if(void 0===a){if(g%t)throw N("Wrong length!");if((o=g-f)<0)throw N("Wrong length!")}else if((o=v(a)*t)+f>g)throw N("Wrong length!");u=o/t}else u=m(n),i=new K(o=u*t);for(h(e,"_d",{b:i,o:f,l:o,e:u,v:new G(i)});d<u;)O(e,d++)}),x=p.prototype=P(ze),h(x,"constructor",p)):i(function(){p(1)})&&i(function(){new p(-1)})&&U(function(e){new p,new p(null),new p(1.5),new p(e)},!0)||(p=n(function(e,n,r,a){var i;return l(e,p,c),b(n)?n instanceof K||"ArrayBuffer"==(i=w(n))||"SharedArrayBuffer"==i?void 0!==a?new g(n,Pe(r,t),a):void 0!==r?new g(n,Pe(r,t)):new g(n):_e in n?Ee(p,n):Ae.call(p,n):new g(m(n))}),J(y!==Function.prototype?S(g).concat(S(y)):S(g),function(e){e in p||h(p,e,g[e])}),p.prototype=x,r||(x.constructor=p));var E=x[pe],I=!!E&&("values"==E.name||null==E.name),A=Re.values;h(p,me,!0),h(x,_e,c),h(x,we,!0),h(x,ge,p),(s?new p(1)[ve]==c:ve in x)||z(x,ve,{get:function(){return c}}),k[c]=p,o(o.G+o.W+o.F*(p!=g),k),o(o.S,c,{BYTES_PER_ELEMENT:t}),o(o.S+o.F*i(function(){g.of.call(p,1)}),c,{from:Ae,of:Me}),"BYTES_PER_ELEMENT"in x||h(x,"BYTES_PER_ELEMENT",t),o(o.P,c,je),D(c),o(o.P+o.F*xe,c,{set:De}),o(o.P+o.F*!I,c,Re),r||x.toString==he||(x.toString=he),o(o.P+o.F*i(function(){new p(1).slice()}),c,{slice:Ue}),o(o.P+o.F*(i(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!i(function(){x.toLocaleString.call([1,2])})),c,{toLocaleString:Ve}),j[c]=I?E:A,r||I||h(x,pe,A)}}else e.exports=function(){}},function(e,t,n){for(var r,a=n(19),i=n(34),o=n(60),u=o("typed_array"),s=o("view"),c=!(!a.ArrayBuffer||!a.DataView),l=c,d=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");d<9;)(r=a[h[d++]])?(i(r.prototype,u,!0),i(r.prototype,s,!0)):l=!1;e.exports={ABV:c,CONSTR:l,TYPED:u,VIEW:s}},function(e,t,n){var r=n(38),a=n(24);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=a(t);if(t!==n)throw RangeError("Wrong length!");return n}},function(e,t,n){var r=n(52),a=n(16)("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||i[a]===e)}},function(e,t,n){var r=n(58),a=n(16)("iterator"),i=n(52);e.exports=n(51).getIteratorMethod=function(e){if(null!=e)return e[a]||e["@@iterator"]||i[r(e)]}},function(e,t,n){var r=n(16)("iterator"),a=!1;try{var i=[7][r]();i.return=function(){a=!0},Array.from(i,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!a)return!1;var n=!1;try{var i=[7],o=i[r]();o.next=function(){return{done:n=!0}},i[r]=function(){return o},e(i)}catch(e){}return n}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(29),a=n(145).set;e.exports=function(e,t,n){var i,o=t.constructor;return o!==n&&"function"==typeof o&&(i=o.prototype)!==n.prototype&&r(i)&&a&&a(e,i),e}},function(e,t,n){var r,a,i,o=n(45),u=n(153),s=n(106),c=n(88),l=n(19),d=l.process,h=l.setImmediate,f=l.clearImmediate,p=l.MessageChannel,v=l.Dispatch,m=0,g={},y=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},_=function(e){y.call(e.data)};h&&f||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return g[++m]=function(){u("function"==typeof e?e:Function(e),t)},r(m),m},f=function(e){delete g[e]},"process"==n(43)(d)?r=function(e){d.nextTick(o(y,e,1))}:v&&v.now?r=function(e){v.now(o(y,e,1))}:p?(i=(a=new p).port2,a.port1.onmessage=_,r=o(i.postMessage,i,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",_,!1)):r="onreadystatechange"in c("script")?function(e){s.appendChild(c("script")).onreadystatechange=function(){s.removeChild(this),y.call(e)}}:function(e){setTimeout(o(y,e,1),0)}),e.exports={set:h,clear:f}},function(e,t,n){"use strict";var r=n(61);function a(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new a(e)}},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var a=65535&e|0,i=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{i=i+(a=a+t[r++]|0)|0}while(--o);a%=65521,i%=65521}return a|i<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,a){var i=r,o=a+n;e^=-1;for(var u=a;u<o;u++)e=e>>>8^i[255&(e^t[u])];return-1^e}},function(e,t,n){"use strict";var r=n(41),a=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){i=!1}for(var o=new r.Buf8(256),u=0;u<256;u++)o[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;function s(e,t){if(t<65534&&(e.subarray&&i||!e.subarray&&a))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,t.string2buf=function(e){var t,n,a,i,o,u=e.length,s=0;for(i=0;i<u;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<u&&56320==(64512&(a=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(a-56320),i++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(s),o=0,i=0;o<s;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<u&&56320==(64512&(a=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(a-56320),i++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},t.buf2binstring=function(e){return s(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,a=t.length;n<a;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,a,i,u=t||e.length,c=new Array(2*u);for(r=0,n=0;n<u;)if((a=e[n++])<128)c[r++]=a;else if((i=o[a])>4)c[r++]=65533,n+=i-1;else{for(a&=2===i?31:3===i?15:7;i>1&&n<u;)a=a<<6|63&e[n++],i--;i>1?c[r++]=65533:a<65536?c[r++]=a:(a-=65536,c[r++]=55296|a>>10&1023,c[r++]=56320|1023&a)}return s(c,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+o[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";n(100)("anchor",function(e){return function(t){return e(this,"a","name",t)}})},function(e,t,n){var r=n(11);r(r.S+r.F*!n(25),"Object",{defineProperty:n(30).f})},function(e,t,n){var r=n(11);r(r.P,"String",{repeat:n(179)})},function(e,t,n){"use strict";n(100)("sub",function(e){return function(){return e(this,"sub","","")}})},function(e,t,n){e.exports=n(50)(40)},function(e,t,n){e.exports=n(50)(12)},function(e,t){},function(e,t,n){"use strict";var r=n(87);n(11)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(e,t,n){e.exports=n(86)("native-function-to-string",Function.toString)},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";var r=n(76),a=n(74),i=n(80),o={};n(34)(o,n(16)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(o,{next:a(1,n)}),i(e,t+" Iterator")}},function(e,t,n){var r=n(30),a=n(23),i=n(77);e.exports=n(25)?Object.defineProperties:function(e,t){a(e);for(var n,o=i(t),u=o.length,s=0;u>s;)r.f(e,n=o[s++],t[n]);return e}},function(e,t,n){var r=n(11),a=n(51),i=n(26);e.exports=function(e,t){var n=(a.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*i(function(){n(1)}),"Object",o)}},function(e,t,n){var r=n(141);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(29),a=n(108),i=n(16)("species");e.exports=function(e){var t;return a(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!a(t.prototype)||(t=void 0),r(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){n(25)&&"g"!=/./g.flags&&n(30).f(RegExp.prototype,"flags",{configurable:!0,get:n(72)})},function(e,t,n){"use strict";var r=n(19),a=n(25),i=n(59),o=n(113),u=n(34),s=n(92),c=n(26),l=n(93),d=n(38),h=n(24),f=n(114),p=n(81).f,v=n(30).f,m=n(94),g=n(80),y="prototype",_="Wrong index!",w=r.ArrayBuffer,b=r.DataView,k=r.Math,x=r.RangeError,P=r.Infinity,C=w,S=k.abs,O=k.pow,E=k.floor,I=k.log,A=k.LN2,M=a?"_b":"buffer",T=a?"_l":"byteLength",V=a?"_o":"byteOffset";function j(e,t,n){var r,a,i,o=new Array(n),u=8*n-t-1,s=(1<<u)-1,c=s>>1,l=23===t?O(2,-24)-O(2,-77):0,d=0,h=e<0||0===e&&1/e<0?1:0;for((e=S(e))!=e||e===P?(a=e!=e?1:0,r=s):(r=E(I(e)/A),e*(i=O(2,-r))<1&&(r--,i*=2),(e+=r+c>=1?l/i:l*O(2,1-c))*i>=2&&(r++,i/=2),r+c>=s?(a=0,r=s):r+c>=1?(a=(e*i-1)*O(2,t),r+=c):(a=e*O(2,c-1)*O(2,t),r=0));t>=8;o[d++]=255&a,a/=256,t-=8);for(r=r<<t|a,u+=t;u>0;o[d++]=255&r,r/=256,u-=8);return o[--d]|=128*h,o}function U(e,t,n){var r,a=8*n-t-1,i=(1<<a)-1,o=i>>1,u=a-7,s=n-1,c=e[s--],l=127&c;for(c>>=7;u>0;l=256*l+e[s],s--,u-=8);for(r=l&(1<<-u)-1,l>>=-u,u+=t;u>0;r=256*r+e[s],s--,u-=8);if(0===l)l=1-o;else{if(l===i)return r?NaN:c?-P:P;r+=O(2,t),l-=o}return(c?-1:1)*r*O(2,l-t)}function D(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function R(e){return[255&e]}function B(e){return[255&e,e>>8&255]}function L(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function F(e){return j(e,52,8)}function z(e){return j(e,23,4)}function W(e,t,n){v(e[y],t,{get:function(){return this[n]}})}function N(e,t,n,r){var a=f(+n);if(a+t>e[T])throw x(_);var i=e[M]._b,o=a+e[V],u=i.slice(o,o+t);return r?u:u.reverse()}function $(e,t,n,r,a,i){var o=f(+n);if(o+t>e[T])throw x(_);for(var u=e[M]._b,s=o+e[V],c=r(+a),l=0;l<t;l++)u[s+l]=c[i?l:t-l-1]}if(o.ABV){if(!c(function(){w(1)})||!c(function(){new w(-1)})||c(function(){return new w,new w(1.5),new w(NaN),"ArrayBuffer"!=w.name})){for(var H,q=(w=function(e){return l(this,w),new C(f(e))})[y]=C[y],K=p(C),G=0;K.length>G;)(H=K[G++])in w||u(w,H,C[H]);i||(q.constructor=w)}var J=new b(new w(2)),Q=b[y].setInt8;J.setInt8(0,2147483648),J.setInt8(1,2147483649),!J.getInt8(0)&&J.getInt8(1)||s(b[y],{setInt8:function(e,t){Q.call(this,e,t<<24>>24)},setUint8:function(e,t){Q.call(this,e,t<<24>>24)}},!0)}else w=function(e){l(this,w,"ArrayBuffer");var t=f(e);this._b=m.call(new Array(t),0),this[T]=t},b=function(e,t,n){l(this,b,"DataView"),l(e,w,"DataView");var r=e[T],a=d(t);if(a<0||a>r)throw x("Wrong offset!");if(a+(n=void 0===n?r-a:h(n))>r)throw x("Wrong length!");this[M]=e,this[V]=a,this[T]=n},a&&(W(w,"byteLength","_l"),W(b,"buffer","_b"),W(b,"byteLength","_l"),W(b,"byteOffset","_o")),s(b[y],{getInt8:function(e){return N(this,1,e)[0]<<24>>24},getUint8:function(e){return N(this,1,e)[0]},getInt16:function(e){var t=N(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=N(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return D(N(this,4,e,arguments[1]))},getUint32:function(e){return D(N(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return U(N(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return U(N(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){$(this,1,e,R,t)},setUint8:function(e,t){$(this,1,e,R,t)},setInt16:function(e,t){$(this,2,e,B,t,arguments[2])},setUint16:function(e,t){$(this,2,e,B,t,arguments[2])},setInt32:function(e,t){$(this,4,e,L,t,arguments[2])},setUint32:function(e,t){$(this,4,e,L,t,arguments[2])},setFloat32:function(e,t){$(this,4,e,z,t,arguments[2])},setFloat64:function(e,t){$(this,8,e,F,t,arguments[2])}});g(w,"ArrayBuffer"),g(b,"DataView"),u(b[y],o.VIEW,!0),t.ArrayBuffer=w,t.DataView=b},function(e,t,n){"use strict";var r=n(37),a=n(79),i=n(24);e.exports=[].copyWithin||function(e,t){var n=r(this),o=i(n.length),u=a(e,o),s=a(t,o),c=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===c?o:a(c,o))-s,o-u),d=1;for(s<u&&u<s+l&&(d=-1,s+=l-1,u+=l-1);l-- >0;)s in n?n[u]=n[s]:delete n[u],u+=d,s+=d;return n}},function(e,t,n){var r=n(29),a=n(23),i=function(e,t){if(a(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(45)(Function.call,n(97).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return i(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:i}},function(e,t,n){var r=n(11),a=n(40),i=n(26),o=n(147),u="["+o+"]",s=RegExp("^"+u+u+"*"),c=RegExp(u+u+"*$"),l=function(e,t,n){var a={},u=i(function(){return!!o[e]()||"​"!="​"[e]()}),s=a[e]=u?t(d):o[e];n&&(a[n]=s),r(r.P+r.F*u,"String",a)},d=l.trim=function(e,t){return e=String(a(e)),1&t&&(e=e.replace(s,"")),2&t&&(e=e.replace(c,"")),e};e.exports=l},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,n){var r=n(11);r(r.S,"Number",{isInteger:n(149)})},function(e,t,n){var r=n(29),a=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&a(e)===e}},function(e,t,n){var r=n(61),a=n(37),i=n(75),o=n(24);e.exports=function(e,t,n,u,s){r(t);var c=a(e),l=i(c),d=o(c.length),h=s?d-1:0,f=s?-1:1;if(n<2)for(;;){if(h in l){u=l[h],h+=f;break}if(h+=f,s?h<0:d<=h)throw TypeError("Reduce of empty array with no initial value")}for(;s?h>=0:d>h;h+=f)h in l&&(u=t(u,l[h],h,c));return u}},function(e,t,n){var r=n(45),a=n(152),i=n(115),o=n(23),u=n(24),s=n(116),c={},l={};(t=e.exports=function(e,t,n,d,h){var f,p,v,m,g=h?function(){return e}:s(e),y=r(n,d,t?2:1),_=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(i(g)){for(f=u(e.length);f>_;_++)if((m=t?y(o(p=e[_])[0],p[1]):y(e[_]))===c||m===l)return m}else for(v=g.call(e);!(p=v.next()).done;)if((m=a(v,y,p.value,t))===c||m===l)return m}).BREAK=c,t.RETURN=l},function(e,t,n){var r=n(23);e.exports=function(e,t,n,a){try{return a?t(r(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&r(i.call(e)),t}}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(19),a=n(120).set,i=r.MutationObserver||r.WebKitMutationObserver,o=r.process,u=r.Promise,s="process"==n(43)(o);e.exports=function(){var e,t,n,c=function(){var r,a;for(s&&(r=o.domain)&&r.exit();e;){a=e.fn,e=e.next;try{a()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(s)n=function(){o.nextTick(c)};else if(!i||r.navigator&&r.navigator.standalone)if(u&&u.resolve){var l=u.resolve(void 0);n=function(){l.then(c)}}else n=function(){a.call(r,c)};else{var d=!0,h=document.createTextNode("");new i(c).observe(h,{characterData:!0}),n=function(){h.data=d=!d}}return function(r){var a={fn:r,next:void 0};t&&(t.next=a),e||(e=a,n()),t=a}}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(19).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){var r=n(23),a=n(29),i=n(121);e.exports=function(e,t){if(r(e),a(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(23),a=n(159),i=n(70);n(71)("search",1,function(e,t,n,o){return[function(n){var r=e(this),a=null==n?void 0:n[t];return void 0!==a?a.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=o(n,e,this);if(t.done)return t.value;var u=r(e),s=String(this),c=u.lastIndex;a(c,0)||(u.lastIndex=0);var l=i(u,s);return a(u.lastIndex,c)||(u.lastIndex=c),null===l?-1:l.index}]})},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){n(112)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}},!0)},function(e,t,n){e.exports=function(){return new Worker(n.p+"a4f7e10426df3f769131.worker.js")}},function(e,t,n){e.exports=function(){return n(163)('!function(t){var r={};function n(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=r,n.d=function(t,r,e){n.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,r){if(1&r&&(t=n(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)n.d(e,o,function(r){return t[r]}.bind(null,o));return e},n.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(r,"a",r),r},n.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},n.p="",n(n.s=46)}([function(t,r,n){var e=n(22)("wks"),o=n(10),i=n(1).Symbol,u="function"==typeof i;(t.exports=function(t){return e[t]||(e[t]=u&&i[t]||(u?i:o)("Symbol."+t))}).store=e},function(t,r){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,r,n){t.exports=!n(9)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,r,n){var e=n(5),o=n(16);t.exports=n(2)?function(t,r,n){return e.f(t,r,o(1,n))}:function(t,r,n){return t[r]=n,t}},function(t,r,n){var e=n(11),o=Math.min;t.exports=function(t){return t>0?o(e(t),9007199254740991):0}},function(t,r,n){var e=n(15),o=n(31),i=n(20),u=Object.defineProperty;r.f=n(2)?Object.defineProperty:function(t,r,n){if(e(t),r=i(r,!0),e(n),o)try{return u(t,r,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[r]=n.value),t}},function(t,r){var n={}.hasOwnProperty;t.exports=function(t,r){return n.call(t,r)}},function(t,r,n){var e=n(33);t.exports=function(t){return Object(e(t))}},function(t,r){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,r){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,r){var n=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+e).toString(36))}},function(t,r){var n=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:n)(t)}},function(t,r){t.exports={}},function(t,r,n){var e=n(1),o=n(14),i=n(3),u=n(21),a=n(23),s=function(t,r,n){var c,f,l,p,h=t&s.F,v=t&s.G,d=t&s.S,y=t&s.P,g=t&s.B,b=v?e:d?e[r]||(e[r]={}):(e[r]||{}).prototype,w=v?o:o[r]||(o[r]={}),x=w.prototype||(w.prototype={});for(c in v&&(n=r),n)l=((f=!h&&b&&void 0!==b[c])?b:n)[c],p=g&&f?a(l,e):y&&"function"==typeof l?a(Function.call,l):l,b&&u(b,c,l,t&s.U),w[c]!=l&&i(w,c,p),y&&x[c]!=l&&(x[c]=l)};e.core=o,s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,t.exports=s},function(t,r){var n=t.exports={version:"2.6.5"};"number"==typeof __e&&(__e=n)},function(t,r,n){var e=n(8);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,r){t.exports=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}}},function(t,r){t.exports=!1},function(t,r,n){var e=n(26),o=n(33);t.exports=function(t){return e(o(t))}},function(t,r,n){var e=n(11),o=Math.max,i=Math.min;t.exports=function(t,r){return(t=e(t))<0?o(t+r,0):i(t,r)}},function(t,r,n){var e=n(8);t.exports=function(t,r){if(!e(t))return t;var n,o;if(r&&"function"==typeof(n=t.toString)&&!e(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!e(o=n.call(t)))return o;if(!r&&"function"==typeof(n=t.toString)&&!e(o=n.call(t)))return o;throw TypeError("Can\'t convert object to primitive value")}},function(t,r,n){var e=n(1),o=n(3),i=n(6),u=n(10)("src"),a=n(48),s=(""+a).split("toString");n(14).inspectSource=function(t){return a.call(t)},(t.exports=function(t,r,n,a){var c="function"==typeof n;c&&(i(n,"name")||o(n,"name",r)),t[r]!==n&&(c&&(i(n,u)||o(n,u,t[r]?""+t[r]:s.join(String(r)))),t===e?t[r]=n:a?t[r]?t[r]=n:o(t,r,n):(delete t[r],o(t,r,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[u]||a.call(this)})},function(t,r,n){var e=n(14),o=n(1),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(t.exports=function(t,r){return i[t]||(i[t]=void 0!==r?r:{})})("versions",[]).push({version:e.version,mode:n(17)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,r,n){var e=n(24);t.exports=function(t,r,n){if(e(t),void 0===r)return t;switch(n){case 1:return function(n){return t.call(r,n)};case 2:return function(n,e){return t.call(r,n,e)};case 3:return function(n,e,o){return t.call(r,n,e,o)}}return function(){return t.apply(r,arguments)}}},function(t,r){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,r,n){var e=n(18),o=n(4),i=n(19);t.exports=function(t){return function(r,n,u){var a,s=e(r),c=o(s.length),f=i(u,c);if(t&&n!=n){for(;c>f;)if((a=s[f++])!=a)return!0}else for(;c>f;f++)if((t||f in s)&&s[f]===n)return t||f||0;return!t&&-1}}},function(t,r,n){var e=n(27);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,r){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,r,n){var e=n(22)("keys"),o=n(10);t.exports=function(t){return e[t]||(e[t]=o(t))}},function(t,r){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,r,n){var e=n(5).f,o=n(6),i=n(0)("toStringTag");t.exports=function(t,r,n){t&&!o(t=n?t:t.prototype,i)&&e(t,i,{configurable:!0,value:r})}},function(t,r,n){t.exports=!n(2)&&!n(9)(function(){return 7!=Object.defineProperty(n(32)("div"),"a",{get:function(){return 7}}).a})},function(t,r,n){var e=n(8),o=n(1).document,i=e(o)&&e(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,r){t.exports=function(t){if(null==t)throw TypeError("Can\'t call method on  "+t);return t}},function(t,r,n){"use strict";var e=n(9);t.exports=function(t,r){return!!t&&e(function(){r?t.call(null,function(){},1):t.call(null)})}},function(t,r,n){"use strict";if(n(2)){var e=n(17),o=n(1),i=n(9),u=n(13),a=n(36),s=n(50),c=n(23),f=n(38),l=n(16),p=n(3),h=n(37),v=n(11),d=n(4),y=n(39),g=n(19),b=n(20),w=n(6),x=n(43),m=n(8),A=n(7),_=n(51),S=n(44),O=n(45),E=n(40).f,k=n(55),P=n(10),B=n(0),I=n(56),j=n(25),T=n(60),F=n(61),M=n(12),C=n(66),U=n(67),L=n(42),N=n(68),R=n(5),W=n(69),z=R.f,D=W.f,V=o.RangeError,q=o.TypeError,G=o.Uint8Array,Y=Array.prototype,H=s.ArrayBuffer,J=s.DataView,K=I(0),Q=I(2),X=I(3),Z=I(4),$=I(5),tt=I(6),rt=j(!0),nt=j(!1),et=F.values,ot=F.keys,it=F.entries,ut=Y.lastIndexOf,at=Y.reduce,st=Y.reduceRight,ct=Y.join,ft=Y.sort,lt=Y.slice,pt=Y.toString,ht=Y.toLocaleString,vt=B("iterator"),dt=B("toStringTag"),yt=P("typed_constructor"),gt=P("def_constructor"),bt=a.CONSTR,wt=a.TYPED,xt=a.VIEW,mt=I(1,function(t,r){return Et(T(t,t[gt]),r)}),At=i(function(){return 1===new G(new Uint16Array([1]).buffer)[0]}),_t=!!G&&!!G.prototype.set&&i(function(){new G(1).set({})}),St=function(t,r){var n=v(t);if(n<0||n%r)throw V("Wrong offset!");return n},Ot=function(t){if(m(t)&&wt in t)return t;throw q(t+" is not a typed array!")},Et=function(t,r){if(!(m(t)&&yt in t))throw q("It is not a typed array constructor!");return new t(r)},kt=function(t,r){return Pt(T(t,t[gt]),r)},Pt=function(t,r){for(var n=0,e=r.length,o=Et(t,e);e>n;)o[n]=r[n++];return o},Bt=function(t,r,n){z(t,r,{get:function(){return this._d[n]}})},It=function(t){var r,n,e,o,i,u,a=A(t),s=arguments.length,f=s>1?arguments[1]:void 0,l=void 0!==f,p=k(a);if(null!=p&&!_(p)){for(u=p.call(a),e=[],r=0;!(i=u.next()).done;r++)e.push(i.value);a=e}for(l&&s>2&&(f=c(f,arguments[2],2)),r=0,n=d(a.length),o=Et(this,n);n>r;r++)o[r]=l?f(a[r],r):a[r];return o},jt=function(){for(var t=0,r=arguments.length,n=Et(this,r);r>t;)n[t]=arguments[t++];return n},Tt=!!G&&i(function(){ht.call(new G(1))}),Ft=function(){return ht.apply(Tt?lt.call(Ot(this)):Ot(this),arguments)},Mt={copyWithin:function(t,r){return N.call(Ot(this),t,r,arguments.length>2?arguments[2]:void 0)},every:function(t){return Z(Ot(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return L.apply(Ot(this),arguments)},filter:function(t){return kt(this,Q(Ot(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return $(Ot(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return tt(Ot(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){K(Ot(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return nt(Ot(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return rt(Ot(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ct.apply(Ot(this),arguments)},lastIndexOf:function(t){return ut.apply(Ot(this),arguments)},map:function(t){return mt(Ot(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return at.apply(Ot(this),arguments)},reduceRight:function(t){return st.apply(Ot(this),arguments)},reverse:function(){for(var t,r=Ot(this).length,n=Math.floor(r/2),e=0;e<n;)t=this[e],this[e++]=this[--r],this[r]=t;return this},some:function(t){return X(Ot(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return ft.call(Ot(this),t)},subarray:function(t,r){var n=Ot(this),e=n.length,o=g(t,e);return new(T(n,n[gt]))(n.buffer,n.byteOffset+o*n.BYTES_PER_ELEMENT,d((void 0===r?e:g(r,e))-o))}},Ct=function(t,r){return kt(this,lt.call(Ot(this),t,r))},Ut=function(t){Ot(this);var r=St(arguments[1],1),n=this.length,e=A(t),o=d(e.length),i=0;if(o+r>n)throw V("Wrong length!");for(;i<o;)this[r+i]=e[i++]},Lt={entries:function(){return it.call(Ot(this))},keys:function(){return ot.call(Ot(this))},values:function(){return et.call(Ot(this))}},Nt=function(t,r){return m(t)&&t[wt]&&"symbol"!=typeof r&&r in t&&String(+r)==String(r)},Rt=function(t,r){return Nt(t,r=b(r,!0))?l(2,t[r]):D(t,r)},Wt=function(t,r,n){return!(Nt(t,r=b(r,!0))&&m(n)&&w(n,"value"))||w(n,"get")||w(n,"set")||n.configurable||w(n,"writable")&&!n.writable||w(n,"enumerable")&&!n.enumerable?z(t,r,n):(t[r]=n.value,t)};bt||(W.f=Rt,R.f=Wt),u(u.S+u.F*!bt,"Object",{getOwnPropertyDescriptor:Rt,defineProperty:Wt}),i(function(){pt.call({})})&&(pt=ht=function(){return ct.call(this)});var zt=h({},Mt);h(zt,Lt),p(zt,vt,Lt.values),h(zt,{slice:Ct,set:Ut,constructor:function(){},toString:pt,toLocaleString:Ft}),Bt(zt,"buffer","b"),Bt(zt,"byteOffset","o"),Bt(zt,"byteLength","l"),Bt(zt,"length","e"),z(zt,dt,{get:function(){return this[wt]}}),t.exports=function(t,r,n,s){var c=t+((s=!!s)?"Clamped":"")+"Array",l="get"+t,h="set"+t,v=o[c],g=v||{},b=v&&O(v),w=!v||!a.ABV,A={},_=v&&v.prototype,k=function(t,n){z(t,n,{get:function(){return function(t,n){var e=t._d;return e.v[l](n*r+e.o,At)}(this,n)},set:function(t){return function(t,n,e){var o=t._d;s&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),o.v[h](n*r+o.o,e,At)}(this,n,t)},enumerable:!0})};w?(v=n(function(t,n,e,o){f(t,v,c,"_d");var i,u,a,s,l=0,h=0;if(m(n)){if(!(n instanceof H||"ArrayBuffer"==(s=x(n))||"SharedArrayBuffer"==s))return wt in n?Pt(v,n):It.call(v,n);i=n,h=St(e,r);var g=n.byteLength;if(void 0===o){if(g%r)throw V("Wrong length!");if((u=g-h)<0)throw V("Wrong length!")}else if((u=d(o)*r)+h>g)throw V("Wrong length!");a=u/r}else a=y(n),i=new H(u=a*r);for(p(t,"_d",{b:i,o:h,l:u,e:a,v:new J(i)});l<a;)k(t,l++)}),_=v.prototype=S(zt),p(_,"constructor",v)):i(function(){v(1)})&&i(function(){new v(-1)})&&C(function(t){new v,new v(null),new v(1.5),new v(t)},!0)||(v=n(function(t,n,e,o){var i;return f(t,v,c),m(n)?n instanceof H||"ArrayBuffer"==(i=x(n))||"SharedArrayBuffer"==i?void 0!==o?new g(n,St(e,r),o):void 0!==e?new g(n,St(e,r)):new g(n):wt in n?Pt(v,n):It.call(v,n):new g(y(n))}),K(b!==Function.prototype?E(g).concat(E(b)):E(g),function(t){t in v||p(v,t,g[t])}),v.prototype=_,e||(_.constructor=v));var P=_[vt],B=!!P&&("values"==P.name||null==P.name),I=Lt.values;p(v,yt,!0),p(_,wt,c),p(_,xt,!0),p(_,gt,v),(s?new v(1)[dt]==c:dt in _)||z(_,dt,{get:function(){return c}}),A[c]=v,u(u.G+u.W+u.F*(v!=g),A),u(u.S,c,{BYTES_PER_ELEMENT:r}),u(u.S+u.F*i(function(){g.of.call(v,1)}),c,{from:It,of:jt}),"BYTES_PER_ELEMENT"in _||p(_,"BYTES_PER_ELEMENT",r),u(u.P,c,Mt),U(c),u(u.P+u.F*_t,c,{set:Ut}),u(u.P+u.F*!B,c,Lt),e||_.toString==pt||(_.toString=pt),u(u.P+u.F*i(function(){new v(1).slice()}),c,{slice:Ct}),u(u.P+u.F*(i(function(){return[1,2].toLocaleString()!=new v([1,2]).toLocaleString()})||!i(function(){_.toLocaleString.call([1,2])})),c,{toLocaleString:Ft}),M[c]=B?P:I,e||B||p(_,vt,I)}}else t.exports=function(){}},function(t,r,n){for(var e,o=n(1),i=n(3),u=n(10),a=u("typed_array"),s=u("view"),c=!(!o.ArrayBuffer||!o.DataView),f=c,l=0,p="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=o[p[l++]])?(i(e.prototype,a,!0),i(e.prototype,s,!0)):f=!1;t.exports={ABV:c,CONSTR:f,TYPED:a,VIEW:s}},function(t,r,n){var e=n(21);t.exports=function(t,r,n){for(var o in r)e(t,o,r[o],n);return t}},function(t,r){t.exports=function(t,r,n,e){if(!(t instanceof r)||void 0!==e&&e in t)throw TypeError(n+": incorrect invocation!");return t}},function(t,r,n){var e=n(11),o=n(4);t.exports=function(t){if(void 0===t)return 0;var r=e(t),n=o(r);if(r!==n)throw RangeError("Wrong length!");return n}},function(t,r,n){var e=n(41),o=n(29).concat("length","prototype");r.f=Object.getOwnPropertyNames||function(t){return e(t,o)}},function(t,r,n){var e=n(6),o=n(18),i=n(25)(!1),u=n(28)("IE_PROTO");t.exports=function(t,r){var n,a=o(t),s=0,c=[];for(n in a)n!=u&&e(a,n)&&c.push(n);for(;r.length>s;)e(a,n=r[s++])&&(~i(c,n)||c.push(n));return c}},function(t,r,n){"use strict";var e=n(7),o=n(19),i=n(4);t.exports=function(t){for(var r=e(this),n=i(r.length),u=arguments.length,a=o(u>1?arguments[1]:void 0,n),s=u>2?arguments[2]:void 0,c=void 0===s?n:o(s,n);c>a;)r[a++]=t;return r}},function(t,r,n){var e=n(27),o=n(0)("toStringTag"),i="Arguments"==e(function(){return arguments}());t.exports=function(t){var r,n,u;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,r){try{return t[r]}catch(t){}}(r=Object(t),o))?n:i?e(r):"Object"==(u=e(r))&&"function"==typeof r.callee?"Arguments":u}},function(t,r,n){var e=n(15),o=n(52),i=n(29),u=n(28)("IE_PROTO"),a=function(){},s=function(){var t,r=n(32)("iframe"),e=i.length;for(r.style.display="none",n(54).appendChild(r),r.src="javascript:",(t=r.contentWindow.document).open(),t.write("<script>document.F=Object<\\/script>"),t.close(),s=t.F;e--;)delete s.prototype[i[e]];return s()};t.exports=Object.create||function(t,r){var n;return null!==t?(a.prototype=e(t),n=new a,a.prototype=null,n[u]=t):n=s(),void 0===r?n:o(n,r)}},function(t,r,n){var e=n(6),o=n(7),i=n(28)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),e(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,r,n){"use strict";n.r(r);n(47),n(49),n(71),n(72),n(74);function e(t){this.data=t,this.pos=0}function o(t){this.stream=new e(t),this.output={loopCount:1}}e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.peekByte=function(){return this.data[this.pos]},e.prototype.readBytes=function(t){var r=this.data.subarray(this.pos,this.pos+t);return this.pos+=t,r},e.prototype.peekBytes=function(t){return this.data.subarray(this.pos,this.pos+t)},e.prototype.readString=function(t){for(var r="",n=0;n<t;n++)r+=String.fromCharCode(this.readByte());return r},e.prototype.readBitArray=function(){for(var t=[],r=this.readByte(),n=7;n>=0;n--)t.push(!!(r&1<<n));return t},e.prototype.readUnsigned=function(t){var r=this.readBytes(2);return t?(r[1]<<8)+r[0]:(r[0]<<8)+r[1]},o.prototype.parse=function(t){return this.parseParts(this.output,t),this.output},o.prototype.parseParts=function(t,r){for(var n=0;n<r.length;n++){var e=r[n];this.parsePart(t,e)}},o.prototype.parsePart=function(t,r){var n,e=r.label;if(!r.requires||r.requires(this.stream,this.output,t))if(r.loop){for(var o=[];r.loop(this.stream);){var i={};this.parseParts(i,r.parts),o.push(i)}t[e]=o}else r.parts?(n={},this.parseParts(n,r.parts),t[e]=n):r.parser?(n=r.parser(this.stream,this.output,t),r.skip||(t[e]=n)):r.bits&&(t[e]=this.parseBits(r.bits))},o.prototype.parseBits=function(t){var r={},n=this.stream.readBitArray();for(var e in t){var o=t[e];o.length?r[e]=n.slice(o.index,o.index+o.length).reduce(function(t,r){return 2*t+r},0):r[e]=n[o.index]}return r};var i=function(){return function(t){return t.readByte()}},u=function(t){return function(r){return r.readBytes(t)}},a=function(t){return function(r){return r.readString(t)}},s=function(t){return function(r){return r.readUnsigned(t)}},c=function(t,r){return function(n,e,o){for(var i=r(n,e,o),u=new Array(i),a=0;a<i;a++)u[a]=n.readBytes(t);return u}};function f(t){var r=new o(new Uint8Array(t));this.raw=r.parse(y),this.raw.hasImages=!1;for(var n=0;n<this.raw.frames.length;n++)if(this.raw.frames[n].image){this.raw.hasImages=!0;break}}f.prototype.decompressFrame=function(t,r){if(t>=this.raw.frames.length)return null;var n=this.raw.frames[t];if(n.image){var e=n.image.descriptor.width*n.image.descriptor.height,o=function(t,r,n){var e,o,i,u,a,s,c,f,l,p,h,v,d,y,g,b,w=n,x=new Array(n),m=new Array(4096),A=new Array(4096),_=new Array(4097);for(a=1+(o=1<<(v=t)),e=o+2,c=-1,i=(1<<(u=v+1))-1,l=0;l<o;l++)m[l]=0,A[l]=l;for(h=f=d=y=b=g=0,p=0;p<w;){if(0===y){if(f<u){h+=r[g]<<f,f+=8,g++;continue}if(l=h&i,h>>=u,f-=u,l>e||l==a)break;if(l==o){i=(1<<(u=v+1))-1,e=o+2,c=-1;continue}if(-1==c){_[y++]=A[l],c=l,d=l;continue}for(s=l,l==e&&(_[y++]=d,l=c);l>o;)_[y++]=A[l],l=m[l];d=255&A[l],_[y++]=d,e<4096&&(m[e]=c,A[e]=d,0==(++e&i)&&e<4096&&(u++,i+=e)),c=s}y--,x[b++]=_[y],p++}for(p=b;p<w;p++)x[p]=0;return x}(n.image.data.minCodeSize,n.image.data.blocks,e);n.image.descriptor.lct.interlaced&&(o=function(t,r){for(var n=new Array(t.length),e=t.length/r,o=function(e,o){var i=t.slice(o*r,(o+1)*r);n.splice.apply(n,[e*r,r].concat(i))},i=[0,4,2,1],u=[8,8,4,2],a=0,s=0;s<4;s++)for(var c=i[s];c<e;c+=u[s])o(c,a),a++;return n}(o,n.image.descriptor.width));var i={pixels:o,dims:{top:n.image.descriptor.top,left:n.image.descriptor.left,width:n.image.descriptor.width,height:n.image.descriptor.height}};return n.image.descriptor.lct&&n.image.descriptor.lct.exists?i.colorTable=n.image.lct:i.colorTable=this.raw.gct,n.gce&&(i.delay=10*(n.gce.delay||10),i.disposalType=n.gce.extras.disposal,n.gce.extras.transparentColorGiven&&(i.transparentIndex=n.gce.transparentColorIndex)),r&&(i.patch=function(t){for(var r=t.pixels.length,n=new Uint8ClampedArray(4*r),e=0;e<r;e++){var o=4*e,i=t.pixels[e],u=t.colorTable[i];n[o]=u[0],n[o+1]=u[1],n[o+2]=u[2],n[o+3]=i!==t.transparentIndex?255:0}return n}(i)),i}return null},f.prototype.decompressFrames=function(t){for(var r=[],n=0;n<this.raw.frames.length;n++){this.raw.frames[n].image&&r.push(this.decompressFrame(n,t))}return r};var l={label:"blocks",parser:function(t){var r,n=0,e=0,o=new Uint8Array(8192);do{for(n=t.readByte();e+n>o.length;)r=void 0,(r=new Uint8Array(o.length+8192)).set(o),o=r;o.set(t.readBytes(n),e),e+=n}while(0!==n);return o.subarray(0,e)}},p={label:"gce",requires:function(t){var r=t.peekBytes(2);return 33===r[0]&&249===r[1]},parts:[{label:"codes",parser:u(2),skip:!0},{label:"byteSize",parser:i()},{label:"extras",bits:{future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}}},{label:"delay",parser:s(!0)},{label:"transparentColorIndex",parser:i()},{label:"terminator",parser:i(),skip:!0}]},h={label:"image",requires:function(t){return 44===t.peekByte()},parts:[{label:"code",parser:i(),skip:!0},{label:"descriptor",parts:[{label:"left",parser:s(!0)},{label:"top",parser:s(!0)},{label:"width",parser:s(!0)},{label:"height",parser:s(!0)},{label:"lct",bits:{exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}}}]},{label:"lct",requires:function(t,r,n){return n.descriptor.lct.exists},parser:c(3,function(t,r,n){return Math.pow(2,n.descriptor.lct.size+1)})},{label:"data",parts:[{label:"minCodeSize",parser:i()},l]}]},v={label:"text",requires:function(t){var r=t.peekBytes(2);return 33===r[0]&&1===r[1]},parts:[{label:"codes",parser:u(2),skip:!0},{label:"blockSize",parser:i()},{label:"preData",parser:function(t,r,n){return t.readBytes(n.text.blockSize)}},l]},d={label:"frames",parts:[p,{label:"application",requires:function(t,r,n){var e=t.peekBytes(2);return 33===e[0]&&255===e[1]},parts:[{label:"codes",parser:u(2),skip:!0},{label:"blockSize",parser:i()},{label:"id",parser:function(t,r,n){return t.readString(n.blockSize)}},{label:"loopCount",parser:function(t,r,n){if(~n.id.indexOf("NETSCAPE")){var e=t.peekBytes(4);r.loopCount=(e[3]<<8)+e[2]}return null},skip:!0},l]},{label:"comment",requires:function(t,r,n){var e=t.peekBytes(2);return 33===e[0]&&254===e[1]},parts:[{label:"codes",parser:u(2),skip:!0},l]},h,v],loop:function(t){var r=t.peekByte();return 33===r||44===r}},y=[{label:"header",parts:[{label:"signature",parser:a(3)},{label:"version",parser:a(3)}]},{label:"lsd",parts:[{label:"width",parser:s(!0)},{label:"height",parser:s(!0)},{label:"gct",bits:{exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}}},{label:"backgroundColorIndex",parser:i()},{label:"pixelAspectRatio",parser:i()}]},{label:"gct",requires:function(t,r){return r.lsd.gct.exists},parser:c(3,function(t,r){return Math.pow(2,r.lsd.gct.size+1)})},d];function g(t,r){for(var n=-1,e=0;e<t.raw.frames.length;e++){if((o=t.raw.frames[e]).image&&n++,n===r)break;t.raw.frames[e]={image:!!o.image}}var o=t.decompressFrame(e,!0),i={};return i.delay=o.delay,i.dims=o.dims,i.disposalType=o.disposalType,i.patch=o.patch.buffer,i}var b=null,w=0;onmessage=function(t){var r=t.data.type,n=t.data.value,e=t.data.index||0,o=null,i=null;switch(r){case"decompressGif":i=n.slice(0),b=new f(i),w=0;for(var u=0;u<b.raw.frames.length;u++)b.raw.frames[u].image&&w++;o=g(b,e),postMessage({frame:o,index:e,loopCount:b.raw.loopCount,hasNext:w>e+1,frameLength:w},[o.patch]);break;case"getFrame":o=g(b,e),postMessage({frame:o,index:e,loopCount:b.raw.loopCount,hasNext:w>e+1,frameLength:w},[o.patch]),w<=e+1&&(b=null);break;default:console.error("unknown type",t.data.type)}}},function(t,r,n){"use strict";var e=n(13),o=n(25)(!1),i=[].indexOf,u=!!i&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!n(34)(i)),"Array",{indexOf:function(t){return u?i.apply(this,arguments)||0:o(this,t,arguments[1])}})},function(t,r,n){t.exports=n(22)("native-function-to-string",Function.toString)},function(t,r,n){n(35)("Uint8",1,function(t){return function(r,n,e){return t(this,r,n,e)}},!0)},function(t,r,n){"use strict";var e=n(1),o=n(2),i=n(17),u=n(36),a=n(3),s=n(37),c=n(9),f=n(38),l=n(11),p=n(4),h=n(39),v=n(40).f,d=n(5).f,y=n(42),g=n(30),b="prototype",w="Wrong index!",x=e.ArrayBuffer,m=e.DataView,A=e.Math,_=e.RangeError,S=e.Infinity,O=x,E=A.abs,k=A.pow,P=A.floor,B=A.log,I=A.LN2,j=o?"_b":"buffer",T=o?"_l":"byteLength",F=o?"_o":"byteOffset";function M(t,r,n){var e,o,i,u=new Array(n),a=8*n-r-1,s=(1<<a)-1,c=s>>1,f=23===r?k(2,-24)-k(2,-77):0,l=0,p=t<0||0===t&&1/t<0?1:0;for((t=E(t))!=t||t===S?(o=t!=t?1:0,e=s):(e=P(B(t)/I),t*(i=k(2,-e))<1&&(e--,i*=2),(t+=e+c>=1?f/i:f*k(2,1-c))*i>=2&&(e++,i/=2),e+c>=s?(o=0,e=s):e+c>=1?(o=(t*i-1)*k(2,r),e+=c):(o=t*k(2,c-1)*k(2,r),e=0));r>=8;u[l++]=255&o,o/=256,r-=8);for(e=e<<r|o,a+=r;a>0;u[l++]=255&e,e/=256,a-=8);return u[--l]|=128*p,u}function C(t,r,n){var e,o=8*n-r-1,i=(1<<o)-1,u=i>>1,a=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;a>0;f=256*f+t[s],s--,a-=8);for(e=f&(1<<-a)-1,f>>=-a,a+=r;a>0;e=256*e+t[s],s--,a-=8);if(0===f)f=1-u;else{if(f===i)return e?NaN:c?-S:S;e+=k(2,r),f-=u}return(c?-1:1)*e*k(2,f-r)}function U(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function L(t){return[255&t]}function N(t){return[255&t,t>>8&255]}function R(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function W(t){return M(t,52,8)}function z(t){return M(t,23,4)}function D(t,r,n){d(t[b],r,{get:function(){return this[n]}})}function V(t,r,n,e){var o=h(+n);if(o+r>t[T])throw _(w);var i=t[j]._b,u=o+t[F],a=i.slice(u,u+r);return e?a:a.reverse()}function q(t,r,n,e,o,i){var u=h(+n);if(u+r>t[T])throw _(w);for(var a=t[j]._b,s=u+t[F],c=e(+o),f=0;f<r;f++)a[s+f]=c[i?f:r-f-1]}if(u.ABV){if(!c(function(){x(1)})||!c(function(){new x(-1)})||c(function(){return new x,new x(1.5),new x(NaN),"ArrayBuffer"!=x.name})){for(var G,Y=(x=function(t){return f(this,x),new O(h(t))})[b]=O[b],H=v(O),J=0;H.length>J;)(G=H[J++])in x||a(x,G,O[G]);i||(Y.constructor=x)}var K=new m(new x(2)),Q=m[b].setInt8;K.setInt8(0,2147483648),K.setInt8(1,2147483649),!K.getInt8(0)&&K.getInt8(1)||s(m[b],{setInt8:function(t,r){Q.call(this,t,r<<24>>24)},setUint8:function(t,r){Q.call(this,t,r<<24>>24)}},!0)}else x=function(t){f(this,x,"ArrayBuffer");var r=h(t);this._b=y.call(new Array(r),0),this[T]=r},m=function(t,r,n){f(this,m,"DataView"),f(t,x,"DataView");var e=t[T],o=l(r);if(o<0||o>e)throw _("Wrong offset!");if(o+(n=void 0===n?e-o:p(n))>e)throw _("Wrong length!");this[j]=t,this[F]=o,this[T]=n},o&&(D(x,"byteLength","_l"),D(m,"buffer","_b"),D(m,"byteLength","_l"),D(m,"byteOffset","_o")),s(m[b],{getInt8:function(t){return V(this,1,t)[0]<<24>>24},getUint8:function(t){return V(this,1,t)[0]},getInt16:function(t){var r=V(this,2,t,arguments[1]);return(r[1]<<8|r[0])<<16>>16},getUint16:function(t){var r=V(this,2,t,arguments[1]);return r[1]<<8|r[0]},getInt32:function(t){return U(V(this,4,t,arguments[1]))},getUint32:function(t){return U(V(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return C(V(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return C(V(this,8,t,arguments[1]),52,8)},setInt8:function(t,r){q(this,1,t,L,r)},setUint8:function(t,r){q(this,1,t,L,r)},setInt16:function(t,r){q(this,2,t,N,r,arguments[2])},setUint16:function(t,r){q(this,2,t,N,r,arguments[2])},setInt32:function(t,r){q(this,4,t,R,r,arguments[2])},setUint32:function(t,r){q(this,4,t,R,r,arguments[2])},setFloat32:function(t,r){q(this,4,t,z,r,arguments[2])},setFloat64:function(t,r){q(this,8,t,W,r,arguments[2])}});g(x,"ArrayBuffer"),g(m,"DataView"),a(m[b],u.VIEW,!0),r.ArrayBuffer=x,r.DataView=m},function(t,r,n){var e=n(12),o=n(0)("iterator"),i=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||i[o]===t)}},function(t,r,n){var e=n(5),o=n(15),i=n(53);t.exports=n(2)?Object.defineProperties:function(t,r){o(t);for(var n,u=i(r),a=u.length,s=0;a>s;)e.f(t,n=u[s++],r[n]);return t}},function(t,r,n){var e=n(41),o=n(29);t.exports=Object.keys||function(t){return e(t,o)}},function(t,r,n){var e=n(1).document;t.exports=e&&e.documentElement},function(t,r,n){var e=n(43),o=n(0)("iterator"),i=n(12);t.exports=n(14).getIteratorMethod=function(t){if(null!=t)return t[o]||t["@@iterator"]||i[e(t)]}},function(t,r,n){var e=n(23),o=n(26),i=n(7),u=n(4),a=n(57);t.exports=function(t,r){var n=1==t,s=2==t,c=3==t,f=4==t,l=6==t,p=5==t||l,h=r||a;return function(r,a,v){for(var d,y,g=i(r),b=o(g),w=e(a,v,3),x=u(b.length),m=0,A=n?h(r,x):s?h(r,0):void 0;x>m;m++)if((p||m in b)&&(y=w(d=b[m],m,g),t))if(n)A[m]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return m;case 2:A.push(d)}else if(f)return!1;return l?-1:c||f?f:A}}},function(t,r,n){var e=n(58);t.exports=function(t,r){return new(e(t))(r)}},function(t,r,n){var e=n(8),o=n(59),i=n(0)("species");t.exports=function(t){var r;return o(t)&&("function"!=typeof(r=t.constructor)||r!==Array&&!o(r.prototype)||(r=void 0),e(r)&&null===(r=r[i])&&(r=void 0)),void 0===r?Array:r}},function(t,r,n){var e=n(27);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,r,n){var e=n(15),o=n(24),i=n(0)("species");t.exports=function(t,r){var n,u=e(t).constructor;return void 0===u||null==(n=e(u)[i])?r:o(n)}},function(t,r,n){"use strict";var e=n(62),o=n(63),i=n(12),u=n(18);t.exports=n(64)(Array,"Array",function(t,r){this._t=u(t),this._i=0,this._k=r},function(){var t=this._t,r=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,o(1)):o(0,"keys"==r?n:"values"==r?t[n]:[n,t[n]])},"values"),i.Arguments=i.Array,e("keys"),e("values"),e("entries")},function(t,r,n){var e=n(0)("unscopables"),o=Array.prototype;null==o[e]&&n(3)(o,e,{}),t.exports=function(t){o[e][t]=!0}},function(t,r){t.exports=function(t,r){return{value:r,done:!!t}}},function(t,r,n){"use strict";var e=n(17),o=n(13),i=n(21),u=n(3),a=n(12),s=n(65),c=n(30),f=n(45),l=n(0)("iterator"),p=!([].keys&&"next"in[].keys()),h=function(){return this};t.exports=function(t,r,n,v,d,y,g){s(n,r,v);var b,w,x,m=function(t){if(!p&&t in O)return O[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},A=r+" Iterator",_="values"==d,S=!1,O=t.prototype,E=O[l]||O["@@iterator"]||d&&O[d],k=E||m(d),P=d?_?m("entries"):k:void 0,B="Array"==r&&O.entries||E;if(B&&(x=f(B.call(new t)))!==Object.prototype&&x.next&&(c(x,A,!0),e||"function"==typeof x[l]||u(x,l,h)),_&&E&&"values"!==E.name&&(S=!0,k=function(){return E.call(this)}),e&&!g||!p&&!S&&O[l]||u(O,l,k),a[r]=k,a[A]=h,d)if(b={values:_?k:m("values"),keys:y?k:m("keys"),entries:P},g)for(w in b)w in O||i(O,w,b[w]);else o(o.P+o.F*(p||S),r,b);return b}},function(t,r,n){"use strict";var e=n(44),o=n(16),i=n(30),u={};n(3)(u,n(0)("iterator"),function(){return this}),t.exports=function(t,r,n){t.prototype=e(u,{next:o(1,n)}),i(t,r+" Iterator")}},function(t,r,n){var e=n(0)("iterator"),o=!1;try{var i=[7][e]();i.return=function(){o=!0},Array.from(i,function(){throw 2})}catch(t){}t.exports=function(t,r){if(!r&&!o)return!1;var n=!1;try{var i=[7],u=i[e]();u.next=function(){return{done:n=!0}},i[e]=function(){return u},t(i)}catch(t){}return n}},function(t,r,n){"use strict";var e=n(1),o=n(5),i=n(2),u=n(0)("species");t.exports=function(t){var r=e[t];i&&r&&!r[u]&&o.f(r,u,{configurable:!0,get:function(){return this}})}},function(t,r,n){"use strict";var e=n(7),o=n(19),i=n(4);t.exports=[].copyWithin||function(t,r){var n=e(this),u=i(n.length),a=o(t,u),s=o(r,u),c=arguments.length>2?arguments[2]:void 0,f=Math.min((void 0===c?u:o(c,u))-s,u-a),l=1;for(s<a&&a<s+f&&(l=-1,s+=f-1,a+=f-1);f-- >0;)s in n?n[a]=n[s]:delete n[a],a+=l,s+=l;return n}},function(t,r,n){var e=n(70),o=n(16),i=n(18),u=n(20),a=n(6),s=n(31),c=Object.getOwnPropertyDescriptor;r.f=n(2)?c:function(t,r){if(t=i(t),r=u(r,!0),s)try{return c(t,r)}catch(t){}if(a(t,r))return o(!e.f.call(t,r),t[r])}},function(t,r){r.f={}.propertyIsEnumerable},function(t,r,n){n(35)("Uint8",1,function(t){return function(r,n,e){return t(this,r,n,e)}})},function(t,r,n){"use strict";var e=n(13),o=n(73);e(e.P+e.F*!n(34)([].reduce,!0),"Array",{reduce:function(t){return o(this,t,arguments.length,arguments[1],!1)}})},function(t,r,n){var e=n(24),o=n(7),i=n(26),u=n(4);t.exports=function(t,r,n,a,s){e(r);var c=o(t),f=i(c),l=u(c.length),p=s?l-1:0,h=s?-1:1;if(n<2)for(;;){if(p in f){a=f[p],p+=h;break}if(p+=h,s?p<0:l<=p)throw TypeError("Reduce of empty array with no initial value")}for(;s?p>=0:l>p;p+=h)p in f&&(a=r(a,f[p],p,c));return a}},function(t,r,n){var e=n(5).f,o=Function.prototype,i=/^\\s*function ([^ (]*)/;"name"in o||n(2)&&e(o,"name",{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(t){return""}}})}]);',n.p+"a4f7e10426df3f769131.worker.js")}},function(e,t,n){"use strict";var r=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var n;try{(n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),n=n.getBlob()}catch(t){n=new Blob([e])}return new Worker(r.createObjectURL(n))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,n){"use strict";var r=n(165),a=n(41),i=n(124),o=n(98),u=n(125),s=Object.prototype.toString,c=0,l=-1,d=0,h=8;function f(e){if(!(this instanceof f))return new f(e);this.options=a.assign({level:l,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==c)throw new Error(o[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var p;if(p="string"==typeof t.dictionary?i.string2buf(t.dictionary):"[object ArrayBuffer]"===s.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=r.deflateSetDictionary(this.strm,p))!==c)throw new Error(o[n]);this._dict_set=!0}}function p(e,t){var n=new f(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}f.prototype.push=function(e,t){var n,o,u=this.strm,l=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?u.input=i.string2buf(e):"[object ArrayBuffer]"===s.call(e)?u.input=new Uint8Array(e):u.input=e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new a.Buf8(l),u.next_out=0,u.avail_out=l),1!==(n=r.deflate(u,o))&&n!==c)return this.onEnd(n),this.ended=!0,!1;0!==u.avail_out&&(0!==u.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(i.buf2binstring(a.shrinkBuf(u.output,u.next_out))):this.onData(a.shrinkBuf(u.output,u.next_out)))}while((u.avail_in>0||0===u.avail_out)&&1!==n);return 4===o?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c):2!==o||(this.onEnd(c),u.avail_out=0,!0)},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=f,t.deflate=p,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,p(e,t)}},function(e,t,n){"use strict";var r,a=n(41),i=n(166),o=n(122),u=n(123),s=n(98),c=0,l=1,d=3,h=4,f=5,p=0,v=1,m=-2,g=-3,y=-5,_=-1,w=1,b=2,k=3,x=4,P=0,C=2,S=8,O=9,E=15,I=8,A=286,M=30,T=19,V=2*A+1,j=15,U=3,D=258,R=D+U+1,B=32,L=42,F=69,z=73,W=91,N=103,$=113,H=666,q=1,K=2,G=3,J=4,Q=3;function Z(e,t){return e.msg=s[t],t}function Y(e){return(e<<1)-(e>4?9:0)}function X(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(a.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){i._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function re(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ae(e,t){var n,r,a=e.max_chain_length,i=e.strstart,o=e.prev_length,u=e.nice_match,s=e.strstart>e.w_size-R?e.strstart-(e.w_size-R):0,c=e.window,l=e.w_mask,d=e.prev,h=e.strstart+D,f=c[i+o-1],p=c[i+o];e.prev_length>=e.good_match&&(a>>=2),u>e.lookahead&&(u=e.lookahead);do{if(c[(n=t)+o]===p&&c[n+o-1]===f&&c[n]===c[i]&&c[++n]===c[i+1]){i+=2,n++;do{}while(c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&i<h);if(r=D-(h-i),i=h-D,r>o){if(e.match_start=t,o=r,r>=u)break;f=c[i+o-1],p=c[i+o]}}}while((t=d[t&l])>s&&0!=--a);return o<=e.lookahead?o:e.lookahead}function ie(e){var t,n,r,i,s,c,l,d,h,f,p=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-R)){a.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=p?r-p:0}while(--n);t=n=p;do{r=e.prev[--t],e.prev[t]=r>=p?r-p:0}while(--n);i+=p}if(0===e.strm.avail_in)break;if(c=e.strm,l=e.window,d=e.strstart+e.lookahead,h=i,f=void 0,(f=c.avail_in)>h&&(f=h),n=0===f?0:(c.avail_in-=f,a.arraySet(l,c.input,c.next_in,f,d),1===c.state.wrap?c.adler=o(c.adler,l,f,d):2===c.state.wrap&&(c.adler=u(c.adler,l,f,d)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=U)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+U-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<U)););}while(e.lookahead<R&&0!==e.strm.avail_in)}function oe(e,t){for(var n,r;;){if(e.lookahead<R){if(ie(e),e.lookahead<R&&t===c)return q;if(0===e.lookahead)break}if(n=0,e.lookahead>=U&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+U-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-R&&(e.match_length=ae(e,n)),e.match_length>=U)if(r=i._tr_tally(e,e.strstart-e.match_start,e.match_length-U),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=U){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+U-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=e.strstart<U-1?e.strstart:U-1,t===h?(te(e,!0),0===e.strm.avail_out?G:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:K}function ue(e,t){for(var n,r,a;;){if(e.lookahead<R){if(ie(e),e.lookahead<R&&t===c)return q;if(0===e.lookahead)break}if(n=0,e.lookahead>=U&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+U-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=U-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-R&&(e.match_length=ae(e,n),e.match_length<=5&&(e.strategy===w||e.match_length===U&&e.strstart-e.match_start>4096)&&(e.match_length=U-1)),e.prev_length>=U&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-U,r=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-U),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+U-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=U-1,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return q}else if(e.match_available){if((r=i._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return q}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<U-1?e.strstart:U-1,t===h?(te(e,!0),0===e.strm.avail_out?G:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:K}function se(e,t,n,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=a}function ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*V),this.dyn_dtree=new a.Buf16(2*(2*M+1)),this.bl_tree=new a.Buf16(2*(2*T+1)),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(j+1),this.heap=new a.Buf16(2*A+1),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*A+1),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function le(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=C,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?L:$,e.adler=2===t.wrap?0:1,t.last_flush=c,i._tr_init(t),p):Z(e,m)}function de(e){var t,n=le(e);return n===p&&((t=e.state).window_size=2*t.w_size,X(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=U-1,t.match_available=0,t.ins_h=0),n}function he(e,t,n,r,i,o){if(!e)return m;var u=1;if(t===_&&(t=6),r<0?(u=0,r=-r):r>15&&(u=2,r-=16),i<1||i>O||n!==S||r<8||r>15||t<0||t>9||o<0||o>x)return Z(e,m);8===r&&(r=9);var s=new ce;return e.state=s,s.strm=e,s.wrap=u,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+U-1)/U),s.window=new a.Buf8(2*s.w_size),s.head=new a.Buf16(s.hash_size),s.prev=new a.Buf16(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new a.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=n,de(e)}r=[new se(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ie(e),0===e.lookahead&&t===c)return q;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,te(e,!1),0===e.strm.avail_out))return q;if(e.strstart-e.block_start>=e.w_size-R&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===h?(te(e,!0),0===e.strm.avail_out?G:J):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),q)}),new se(4,4,8,4,oe),new se(4,5,16,8,oe),new se(4,6,32,32,oe),new se(4,4,16,16,ue),new se(8,16,32,32,ue),new se(8,16,128,128,ue),new se(8,32,128,256,ue),new se(32,128,258,1024,ue),new se(32,258,258,4096,ue)],t.deflateInit=function(e,t){return he(e,t,S,E,I,P)},t.deflateInit2=he,t.deflateReset=de,t.deflateResetKeep=le,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?m:(e.state.gzhead=t,p):m},t.deflate=function(e,t){var n,a,o,s;if(!e||!e.state||t>f||t<0)return e?Z(e,m):m;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||a.status===H&&t!==h)return Z(e,0===e.avail_out?y:m);if(a.strm=e,n=a.last_flush,a.last_flush=t,a.status===L)if(2===a.wrap)e.adler=0,ne(a,31),ne(a,139),ne(a,8),a.gzhead?(ne(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),ne(a,255&a.gzhead.time),ne(a,a.gzhead.time>>8&255),ne(a,a.gzhead.time>>16&255),ne(a,a.gzhead.time>>24&255),ne(a,9===a.level?2:a.strategy>=b||a.level<2?4:0),ne(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(ne(a,255&a.gzhead.extra.length),ne(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=u(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=F):(ne(a,0),ne(a,0),ne(a,0),ne(a,0),ne(a,0),ne(a,9===a.level?2:a.strategy>=b||a.level<2?4:0),ne(a,Q),a.status=$);else{var g=S+(a.w_bits-8<<4)<<8;g|=(a.strategy>=b||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(g|=B),g+=31-g%31,a.status=$,re(a,g),0!==a.strstart&&(re(a,e.adler>>>16),re(a,65535&e.adler)),e.adler=1}if(a.status===F)if(a.gzhead.extra){for(o=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>o&&(e.adler=u(e.adler,a.pending_buf,a.pending-o,o)),ee(e),o=a.pending,a.pending!==a.pending_buf_size));)ne(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>o&&(e.adler=u(e.adler,a.pending_buf,a.pending-o,o)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=z)}else a.status=z;if(a.status===z)if(a.gzhead.name){o=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>o&&(e.adler=u(e.adler,a.pending_buf,a.pending-o,o)),ee(e),o=a.pending,a.pending===a.pending_buf_size)){s=1;break}s=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,ne(a,s)}while(0!==s);a.gzhead.hcrc&&a.pending>o&&(e.adler=u(e.adler,a.pending_buf,a.pending-o,o)),0===s&&(a.gzindex=0,a.status=W)}else a.status=W;if(a.status===W)if(a.gzhead.comment){o=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>o&&(e.adler=u(e.adler,a.pending_buf,a.pending-o,o)),ee(e),o=a.pending,a.pending===a.pending_buf_size)){s=1;break}s=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,ne(a,s)}while(0!==s);a.gzhead.hcrc&&a.pending>o&&(e.adler=u(e.adler,a.pending_buf,a.pending-o,o)),0===s&&(a.status=N)}else a.status=N;if(a.status===N&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&ee(e),a.pending+2<=a.pending_buf_size&&(ne(a,255&e.adler),ne(a,e.adler>>8&255),e.adler=0,a.status=$)):a.status=$),0!==a.pending){if(ee(e),0===e.avail_out)return a.last_flush=-1,p}else if(0===e.avail_in&&Y(t)<=Y(n)&&t!==h)return Z(e,y);if(a.status===H&&0!==e.avail_in)return Z(e,y);if(0!==e.avail_in||0!==a.lookahead||t!==c&&a.status!==H){var _=a.strategy===b?function(e,t){for(var n;;){if(0===e.lookahead&&(ie(e),0===e.lookahead)){if(t===c)return q;break}if(e.match_length=0,n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===h?(te(e,!0),0===e.strm.avail_out?G:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:K}(a,t):a.strategy===k?function(e,t){for(var n,r,a,o,u=e.window;;){if(e.lookahead<=D){if(ie(e),e.lookahead<=D&&t===c)return q;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=U&&e.strstart>0&&(r=u[a=e.strstart-1])===u[++a]&&r===u[++a]&&r===u[++a]){o=e.strstart+D;do{}while(r===u[++a]&&r===u[++a]&&r===u[++a]&&r===u[++a]&&r===u[++a]&&r===u[++a]&&r===u[++a]&&r===u[++a]&&a<o);e.match_length=D-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=U?(n=i._tr_tally(e,1,e.match_length-U),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===h?(te(e,!0),0===e.strm.avail_out?G:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:K}(a,t):r[a.level].func(a,t);if(_!==G&&_!==J||(a.status=H),_===q||_===G)return 0===e.avail_out&&(a.last_flush=-1),p;if(_===K&&(t===l?i._tr_align(a):t!==f&&(i._tr_stored_block(a,0,0,!1),t===d&&(X(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),ee(e),0===e.avail_out))return a.last_flush=-1,p}return t!==h?p:a.wrap<=0?v:(2===a.wrap?(ne(a,255&e.adler),ne(a,e.adler>>8&255),ne(a,e.adler>>16&255),ne(a,e.adler>>24&255),ne(a,255&e.total_in),ne(a,e.total_in>>8&255),ne(a,e.total_in>>16&255),ne(a,e.total_in>>24&255)):(re(a,e.adler>>>16),re(a,65535&e.adler)),ee(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?p:v)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==L&&t!==F&&t!==z&&t!==W&&t!==N&&t!==$&&t!==H?Z(e,m):(e.state=null,t===$?Z(e,g):p):m},t.deflateSetDictionary=function(e,t){var n,r,i,u,s,c,l,d,h=t.length;if(!e||!e.state)return m;if(2===(u=(n=e.state).wrap)||1===u&&n.status!==L||n.lookahead)return m;for(1===u&&(e.adler=o(e.adler,t,h,0)),n.wrap=0,h>=n.w_size&&(0===u&&(X(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new a.Buf8(n.w_size),a.arraySet(d,t,h-n.w_size,n.w_size,0),t=d,h=n.w_size),s=e.avail_in,c=e.next_in,l=e.input,e.avail_in=h,e.next_in=0,e.input=t,ie(n);n.lookahead>=U;){r=n.strstart,i=n.lookahead-(U-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+U-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--i);n.strstart=r,n.lookahead=U-1,ie(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=U-1,n.match_available=0,e.next_in=c,e.input=l,e.avail_in=s,n.wrap=u,p},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var r=n(41),a=4,i=0,o=1,u=2;function s(e){for(var t=e.length;--t>=0;)e[t]=0}var c=0,l=1,d=2,h=29,f=256,p=f+1+h,v=30,m=19,g=2*p+1,y=15,_=16,w=7,b=256,k=16,x=17,P=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],S=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=new Array(2*(p+2));s(I);var A=new Array(2*v);s(A);var M=new Array(512);s(M);var T=new Array(256);s(T);var V=new Array(h);s(V);var j,U,D,R=new Array(v);function B(e,t,n,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}function L(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function F(e){return e<256?M[e]:M[256+(e>>>7)]}function z(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function W(e,t,n){e.bi_valid>_-n?(e.bi_buf|=t<<e.bi_valid&65535,z(e,e.bi_buf),e.bi_buf=t>>_-e.bi_valid,e.bi_valid+=n-_):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function N(e,t,n){W(e,n[2*t],n[2*t+1])}function $(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function H(e,t,n){var r,a,i=new Array(y+1),o=0;for(r=1;r<=y;r++)i[r]=o=o+n[r-1]<<1;for(a=0;a<=t;a++){var u=e[2*a+1];0!==u&&(e[2*a]=$(i[u]++,u))}}function q(e){var t;for(t=0;t<p;t++)e.dyn_ltree[2*t]=0;for(t=0;t<v;t++)e.dyn_dtree[2*t]=0;for(t=0;t<m;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*b]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function K(e){e.bi_valid>8?z(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function G(e,t,n,r){var a=2*t,i=2*n;return e[a]<e[i]||e[a]===e[i]&&r[t]<=r[n]}function J(e,t,n){for(var r=e.heap[n],a=n<<1;a<=e.heap_len&&(a<e.heap_len&&G(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!G(t,r,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=r}function Q(e,t,n){var r,a,i,o,u=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],a=e.pending_buf[e.l_buf+u],u++,0===r?N(e,a,t):(N(e,(i=T[a])+f+1,t),0!==(o=C[i])&&W(e,a-=V[i],o),N(e,i=F(--r),n),0!==(o=S[i])&&W(e,r-=R[i],o))}while(u<e.last_lit);N(e,b,t)}function Z(e,t){var n,r,a,i=t.dyn_tree,o=t.stat_desc.static_tree,u=t.stat_desc.has_stree,s=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=g,n=0;n<s;n++)0!==i[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(a=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[a]=0,e.opt_len--,u&&(e.static_len-=o[2*a+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)J(e,i,n);a=s;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],J(e,i,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,i[2*a]=i[2*n]+i[2*r],e.depth[a]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,i[2*n+1]=i[2*r+1]=a,e.heap[1]=a++,J(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,a,i,o,u,s=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,v=0;for(i=0;i<=y;i++)e.bl_count[i]=0;for(s[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<g;n++)(i=s[2*s[2*(r=e.heap[n])+1]+1]+1)>p&&(i=p,v++),s[2*r+1]=i,r>c||(e.bl_count[i]++,o=0,r>=f&&(o=h[r-f]),u=s[2*r],e.opt_len+=u*(i+o),d&&(e.static_len+=u*(l[2*r+1]+o)));if(0!==v){do{for(i=p-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[p]--,v-=2}while(v>0);for(i=p;0!==i;i--)for(r=e.bl_count[i];0!==r;)(a=e.heap[--n])>c||(s[2*a+1]!==i&&(e.opt_len+=(i-s[2*a+1])*s[2*a],s[2*a+1]=i),r--)}}(e,t),H(i,c,e.bl_count)}function Y(e,t,n){var r,a,i=-1,o=t[1],u=0,s=7,c=4;for(0===o&&(s=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)a=o,o=t[2*(r+1)+1],++u<s&&a===o||(u<c?e.bl_tree[2*a]+=u:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[2*k]++):u<=10?e.bl_tree[2*x]++:e.bl_tree[2*P]++,u=0,i=a,0===o?(s=138,c=3):a===o?(s=6,c=3):(s=7,c=4))}function X(e,t,n){var r,a,i=-1,o=t[1],u=0,s=7,c=4;for(0===o&&(s=138,c=3),r=0;r<=n;r++)if(a=o,o=t[2*(r+1)+1],!(++u<s&&a===o)){if(u<c)do{N(e,a,e.bl_tree)}while(0!=--u);else 0!==a?(a!==i&&(N(e,a,e.bl_tree),u--),N(e,k,e.bl_tree),W(e,u-3,2)):u<=10?(N(e,x,e.bl_tree),W(e,u-3,3)):(N(e,P,e.bl_tree),W(e,u-11,7));u=0,i=a,0===o?(s=138,c=3):a===o?(s=6,c=3):(s=7,c=4)}}s(R);var ee=!1;function te(e,t,n,a){W(e,(c<<1)+(a?1:0),3),function(e,t,n,a){K(e),a&&(z(e,n),z(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){ee||(function(){var e,t,n,r,a,i=new Array(y+1);for(n=0,r=0;r<h-1;r++)for(V[r]=n,e=0;e<1<<C[r];e++)T[n++]=r;for(T[n-1]=r,a=0,r=0;r<16;r++)for(R[r]=a,e=0;e<1<<S[r];e++)M[a++]=r;for(a>>=7;r<v;r++)for(R[r]=a<<7,e=0;e<1<<S[r]-7;e++)M[256+a++]=r;for(t=0;t<=y;t++)i[t]=0;for(e=0;e<=143;)I[2*e+1]=8,e++,i[8]++;for(;e<=255;)I[2*e+1]=9,e++,i[9]++;for(;e<=279;)I[2*e+1]=7,e++,i[7]++;for(;e<=287;)I[2*e+1]=8,e++,i[8]++;for(H(I,p+1,i),e=0;e<v;e++)A[2*e+1]=5,A[2*e]=$(e,5);j=new B(I,C,f+1,p,y),U=new B(A,S,0,v,y),D=new B(new Array(0),O,0,m,w)}(),ee=!0),e.l_desc=new L(e.dyn_ltree,j),e.d_desc=new L(e.dyn_dtree,U),e.bl_desc=new L(e.bl_tree,D),e.bi_buf=0,e.bi_valid=0,q(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,n,r){var s,c,h=0;e.level>0?(e.strm.data_type===u&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return i;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<f;t++)if(0!==e.dyn_ltree[2*t])return o;return i}(e)),Z(e,e.l_desc),Z(e,e.d_desc),h=function(e){var t;for(Y(e,e.dyn_ltree,e.l_desc.max_code),Y(e,e.dyn_dtree,e.d_desc.max_code),Z(e,e.bl_desc),t=m-1;t>=3&&0===e.bl_tree[2*E[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(c=e.static_len+3+7>>>3)<=s&&(s=c)):s=c=n+5,n+4<=s&&-1!==t?te(e,t,n,r):e.strategy===a||c===s?(W(e,(l<<1)+(r?1:0),3),Q(e,I,A)):(W(e,(d<<1)+(r?1:0),3),function(e,t,n,r){var a;for(W(e,t-257,5),W(e,n-1,5),W(e,r-4,4),a=0;a<r;a++)W(e,e.bl_tree[2*E[a]+1],3);X(e,e.dyn_ltree,t-1),X(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),Q(e,e.dyn_ltree,e.dyn_dtree)),q(e),r&&K(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(T[n]+f+1)]++,e.dyn_dtree[2*F(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){W(e,l<<1,3),N(e,b,I),function(e){16===e.bi_valid?(z(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r=n(168),a=n(41),i=n(124),o=n(126),u=n(98),s=n(125),c=n(171),l=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(u[n]);if(this.header=new c,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=i.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(u[n])}function h(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||u[n.err];return n.result}d.prototype.push=function(e,t){var n,u,s,c,d,h=this.strm,f=this.options.chunkSize,p=this.options.dictionary,v=!1;if(this.ended)return!1;u=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?h.input=i.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(f),h.next_out=0,h.avail_out=f),(n=r.inflate(h,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===o.Z_BUF_ERROR&&!0===v&&(n=o.Z_OK,v=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&n!==o.Z_STREAM_END&&(0!==h.avail_in||u!==o.Z_FINISH&&u!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(s=i.utf8border(h.output,h.next_out),c=h.next_out-s,d=i.buf2string(h.output,s),h.next_out=c,h.avail_out=f-c,c&&a.arraySet(h.output,h.output,s,c,0),this.onData(d)):this.onData(a.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(v=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(u=o.Z_FINISH),u===o.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):u!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),h.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=d,t.inflate=h,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},t.ungzip=h},function(e,t,n){"use strict";var r=n(41),a=n(122),i=n(123),o=n(169),u=n(170),s=0,c=1,l=2,d=4,h=5,f=6,p=0,v=1,m=2,g=-2,y=-3,_=-4,w=-5,b=8,k=1,x=2,P=3,C=4,S=5,O=6,E=7,I=8,A=9,M=10,T=11,V=12,j=13,U=14,D=15,R=16,B=17,L=18,F=19,z=20,W=21,N=22,$=23,H=24,q=25,K=26,G=27,J=28,Q=29,Z=30,Y=31,X=32,ee=852,te=592,ne=15;function re(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ae(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ie(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=k,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(ee),t.distcode=t.distdyn=new r.Buf32(te),t.sane=1,t.back=-1,p):g}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ie(e)):g}function ue(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?g:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,oe(e))):g}function se(e,t){var n,r;return e?(r=new ae,e.state=r,r.window=null,(n=ue(e,t))!==p&&(e.state=null),n):g}var ce,le,de=!0;function he(e){if(de){var t;for(ce=new r.Buf32(512),le=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(u(c,e.lens,0,288,ce,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;u(l,e.lens,0,32,le,0,e.work,{bits:5}),de=!1}e.lencode=ce,e.lenbits=9,e.distcode=le,e.distbits=5}function fe(e,t,n,a){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),a>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>a&&(i=a),r.arraySet(o.window,t,n-a,i,o.wnext),(a-=i)?(r.arraySet(o.window,t,n-a,a,0),o.wnext=a,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}t.inflateReset=oe,t.inflateReset2=ue,t.inflateResetKeep=ie,t.inflateInit=function(e){return se(e,ne)},t.inflateInit2=se,t.inflate=function(e,t){var n,ee,te,ne,ae,ie,oe,ue,se,ce,le,de,pe,ve,me,ge,ye,_e,we,be,ke,xe,Pe,Ce,Se=0,Oe=new r.Buf8(4),Ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return g;(n=e.state).mode===V&&(n.mode=j),ae=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,ie=e.avail_in,ue=n.hold,se=n.bits,ce=ie,le=oe,xe=p;e:for(;;)switch(n.mode){case k:if(0===n.wrap){n.mode=j;break}for(;se<16;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}if(2&n.wrap&&35615===ue){n.check=0,Oe[0]=255&ue,Oe[1]=ue>>>8&255,n.check=i(n.check,Oe,2,0),ue=0,se=0,n.mode=x;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&ue)<<8)+(ue>>8))%31){e.msg="incorrect header check",n.mode=Z;break}if((15&ue)!==b){e.msg="unknown compression method",n.mode=Z;break}if(se-=4,ke=8+(15&(ue>>>=4)),0===n.wbits)n.wbits=ke;else if(ke>n.wbits){e.msg="invalid window size",n.mode=Z;break}n.dmax=1<<ke,e.adler=n.check=1,n.mode=512&ue?M:V,ue=0,se=0;break;case x:for(;se<16;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}if(n.flags=ue,(255&n.flags)!==b){e.msg="unknown compression method",n.mode=Z;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Z;break}n.head&&(n.head.text=ue>>8&1),512&n.flags&&(Oe[0]=255&ue,Oe[1]=ue>>>8&255,n.check=i(n.check,Oe,2,0)),ue=0,se=0,n.mode=P;case P:for(;se<32;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}n.head&&(n.head.time=ue),512&n.flags&&(Oe[0]=255&ue,Oe[1]=ue>>>8&255,Oe[2]=ue>>>16&255,Oe[3]=ue>>>24&255,n.check=i(n.check,Oe,4,0)),ue=0,se=0,n.mode=C;case C:for(;se<16;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}n.head&&(n.head.xflags=255&ue,n.head.os=ue>>8),512&n.flags&&(Oe[0]=255&ue,Oe[1]=ue>>>8&255,n.check=i(n.check,Oe,2,0)),ue=0,se=0,n.mode=S;case S:if(1024&n.flags){for(;se<16;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}n.length=ue,n.head&&(n.head.extra_len=ue),512&n.flags&&(Oe[0]=255&ue,Oe[1]=ue>>>8&255,n.check=i(n.check,Oe,2,0)),ue=0,se=0}else n.head&&(n.head.extra=null);n.mode=O;case O:if(1024&n.flags&&((de=n.length)>ie&&(de=ie),de&&(n.head&&(ke=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,ee,ne,de,ke)),512&n.flags&&(n.check=i(n.check,ee,de,ne)),ie-=de,ne+=de,n.length-=de),n.length))break e;n.length=0,n.mode=E;case E:if(2048&n.flags){if(0===ie)break e;de=0;do{ke=ee[ne+de++],n.head&&ke&&n.length<65536&&(n.head.name+=String.fromCharCode(ke))}while(ke&&de<ie);if(512&n.flags&&(n.check=i(n.check,ee,de,ne)),ie-=de,ne+=de,ke)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=I;case I:if(4096&n.flags){if(0===ie)break e;de=0;do{ke=ee[ne+de++],n.head&&ke&&n.length<65536&&(n.head.comment+=String.fromCharCode(ke))}while(ke&&de<ie);if(512&n.flags&&(n.check=i(n.check,ee,de,ne)),ie-=de,ne+=de,ke)break e}else n.head&&(n.head.comment=null);n.mode=A;case A:if(512&n.flags){for(;se<16;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}if(ue!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Z;break}ue=0,se=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=V;break;case M:for(;se<32;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}e.adler=n.check=re(ue),ue=0,se=0,n.mode=T;case T:if(0===n.havedict)return e.next_out=ae,e.avail_out=oe,e.next_in=ne,e.avail_in=ie,n.hold=ue,n.bits=se,m;e.adler=n.check=1,n.mode=V;case V:if(t===h||t===f)break e;case j:if(n.last){ue>>>=7&se,se-=7&se,n.mode=G;break}for(;se<3;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}switch(n.last=1&ue,se-=1,3&(ue>>>=1)){case 0:n.mode=U;break;case 1:if(he(n),n.mode=z,t===f){ue>>>=2,se-=2;break e}break;case 2:n.mode=B;break;case 3:e.msg="invalid block type",n.mode=Z}ue>>>=2,se-=2;break;case U:for(ue>>>=7&se,se-=7&se;se<32;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}if((65535&ue)!=(ue>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Z;break}if(n.length=65535&ue,ue=0,se=0,n.mode=D,t===f)break e;case D:n.mode=R;case R:if(de=n.length){if(de>ie&&(de=ie),de>oe&&(de=oe),0===de)break e;r.arraySet(te,ee,ne,de,ae),ie-=de,ne+=de,oe-=de,ae+=de,n.length-=de;break}n.mode=V;break;case B:for(;se<14;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}if(n.nlen=257+(31&ue),ue>>>=5,se-=5,n.ndist=1+(31&ue),ue>>>=5,se-=5,n.ncode=4+(15&ue),ue>>>=4,se-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Z;break}n.have=0,n.mode=L;case L:for(;n.have<n.ncode;){for(;se<3;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}n.lens[Ee[n.have++]]=7&ue,ue>>>=3,se-=3}for(;n.have<19;)n.lens[Ee[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Pe={bits:n.lenbits},xe=u(s,n.lens,0,19,n.lencode,0,n.work,Pe),n.lenbits=Pe.bits,xe){e.msg="invalid code lengths set",n.mode=Z;break}n.have=0,n.mode=F;case F:for(;n.have<n.nlen+n.ndist;){for(;ge=(Se=n.lencode[ue&(1<<n.lenbits)-1])>>>16&255,ye=65535&Se,!((me=Se>>>24)<=se);){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}if(ye<16)ue>>>=me,se-=me,n.lens[n.have++]=ye;else{if(16===ye){for(Ce=me+2;se<Ce;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}if(ue>>>=me,se-=me,0===n.have){e.msg="invalid bit length repeat",n.mode=Z;break}ke=n.lens[n.have-1],de=3+(3&ue),ue>>>=2,se-=2}else if(17===ye){for(Ce=me+3;se<Ce;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}se-=me,ke=0,de=3+(7&(ue>>>=me)),ue>>>=3,se-=3}else{for(Ce=me+7;se<Ce;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}se-=me,ke=0,de=11+(127&(ue>>>=me)),ue>>>=7,se-=7}if(n.have+de>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Z;break}for(;de--;)n.lens[n.have++]=ke}}if(n.mode===Z)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Z;break}if(n.lenbits=9,Pe={bits:n.lenbits},xe=u(c,n.lens,0,n.nlen,n.lencode,0,n.work,Pe),n.lenbits=Pe.bits,xe){e.msg="invalid literal/lengths set",n.mode=Z;break}if(n.distbits=6,n.distcode=n.distdyn,Pe={bits:n.distbits},xe=u(l,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Pe),n.distbits=Pe.bits,xe){e.msg="invalid distances set",n.mode=Z;break}if(n.mode=z,t===f)break e;case z:n.mode=W;case W:if(ie>=6&&oe>=258){e.next_out=ae,e.avail_out=oe,e.next_in=ne,e.avail_in=ie,n.hold=ue,n.bits=se,o(e,le),ae=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,ie=e.avail_in,ue=n.hold,se=n.bits,n.mode===V&&(n.back=-1);break}for(n.back=0;ge=(Se=n.lencode[ue&(1<<n.lenbits)-1])>>>16&255,ye=65535&Se,!((me=Se>>>24)<=se);){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}if(ge&&0==(240&ge)){for(_e=me,we=ge,be=ye;ge=(Se=n.lencode[be+((ue&(1<<_e+we)-1)>>_e)])>>>16&255,ye=65535&Se,!(_e+(me=Se>>>24)<=se);){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}ue>>>=_e,se-=_e,n.back+=_e}if(ue>>>=me,se-=me,n.back+=me,n.length=ye,0===ge){n.mode=K;break}if(32&ge){n.back=-1,n.mode=V;break}if(64&ge){e.msg="invalid literal/length code",n.mode=Z;break}n.extra=15&ge,n.mode=N;case N:if(n.extra){for(Ce=n.extra;se<Ce;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}n.length+=ue&(1<<n.extra)-1,ue>>>=n.extra,se-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=$;case $:for(;ge=(Se=n.distcode[ue&(1<<n.distbits)-1])>>>16&255,ye=65535&Se,!((me=Se>>>24)<=se);){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}if(0==(240&ge)){for(_e=me,we=ge,be=ye;ge=(Se=n.distcode[be+((ue&(1<<_e+we)-1)>>_e)])>>>16&255,ye=65535&Se,!(_e+(me=Se>>>24)<=se);){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}ue>>>=_e,se-=_e,n.back+=_e}if(ue>>>=me,se-=me,n.back+=me,64&ge){e.msg="invalid distance code",n.mode=Z;break}n.offset=ye,n.extra=15&ge,n.mode=H;case H:if(n.extra){for(Ce=n.extra;se<Ce;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}n.offset+=ue&(1<<n.extra)-1,ue>>>=n.extra,se-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Z;break}n.mode=q;case q:if(0===oe)break e;if(de=le-oe,n.offset>de){if((de=n.offset-de)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Z;break}de>n.wnext?(de-=n.wnext,pe=n.wsize-de):pe=n.wnext-de,de>n.length&&(de=n.length),ve=n.window}else ve=te,pe=ae-n.offset,de=n.length;de>oe&&(de=oe),oe-=de,n.length-=de;do{te[ae++]=ve[pe++]}while(--de);0===n.length&&(n.mode=W);break;case K:if(0===oe)break e;te[ae++]=n.length,oe--,n.mode=W;break;case G:if(n.wrap){for(;se<32;){if(0===ie)break e;ie--,ue|=ee[ne++]<<se,se+=8}if(le-=oe,e.total_out+=le,n.total+=le,le&&(e.adler=n.check=n.flags?i(n.check,te,le,ae-le):a(n.check,te,le,ae-le)),le=oe,(n.flags?ue:re(ue))!==n.check){e.msg="incorrect data check",n.mode=Z;break}ue=0,se=0}n.mode=J;case J:if(n.wrap&&n.flags){for(;se<32;){if(0===ie)break e;ie--,ue+=ee[ne++]<<se,se+=8}if(ue!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Z;break}ue=0,se=0}n.mode=Q;case Q:xe=v;break e;case Z:xe=y;break e;case Y:return _;case X:default:return g}return e.next_out=ae,e.avail_out=oe,e.next_in=ne,e.avail_in=ie,n.hold=ue,n.bits=se,(n.wsize||le!==e.avail_out&&n.mode<Z&&(n.mode<G||t!==d))&&fe(e,e.output,e.next_out,le-e.avail_out)?(n.mode=Y,_):(ce-=e.avail_in,le-=e.avail_out,e.total_in+=ce,e.total_out+=le,n.total+=le,n.wrap&&le&&(e.adler=n.check=n.flags?i(n.check,te,le,e.next_out-le):a(n.check,te,le,e.next_out-le)),e.data_type=n.bits+(n.last?64:0)+(n.mode===V?128:0)+(n.mode===z||n.mode===D?256:0),(0===ce&&0===le||t===d)&&xe===p&&(xe=w),xe)},t.inflateEnd=function(e){if(!e||!e.state)return g;var t=e.state;return t.window&&(t.window=null),e.state=null,p},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?g:(n.head=t,t.done=!1,p):g},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==T?g:n.mode===T&&a(1,t,r,0)!==n.check?y:fe(e,t,r,r)?(n.mode=Y,_):(n.havedict=1,p):g},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,a,i,o,u,s,c,l,d,h,f,p,v,m,g,y,_,w,b,k,x,P,C,S;n=e.state,r=e.next_in,C=e.input,a=r+(e.avail_in-5),i=e.next_out,S=e.output,o=i-(t-e.avail_out),u=i+(e.avail_out-257),s=n.dmax,c=n.wsize,l=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,v=n.lencode,m=n.distcode,g=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=C[r++]<<p,p+=8,f+=C[r++]<<p,p+=8),_=v[f&g];t:for(;;){if(f>>>=w=_>>>24,p-=w,0===(w=_>>>16&255))S[i++]=65535&_;else{if(!(16&w)){if(0==(64&w)){_=v[(65535&_)+(f&(1<<w)-1)];continue t}if(32&w){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}b=65535&_,(w&=15)&&(p<w&&(f+=C[r++]<<p,p+=8),b+=f&(1<<w)-1,f>>>=w,p-=w),p<15&&(f+=C[r++]<<p,p+=8,f+=C[r++]<<p,p+=8),_=m[f&y];n:for(;;){if(f>>>=w=_>>>24,p-=w,!(16&(w=_>>>16&255))){if(0==(64&w)){_=m[(65535&_)+(f&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(k=65535&_,p<(w&=15)&&(f+=C[r++]<<p,(p+=8)<w&&(f+=C[r++]<<p,p+=8)),(k+=f&(1<<w)-1)>s){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=w,p-=w,k>(w=i-o)){if((w=k-w)>l&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(x=0,P=h,0===d){if(x+=c-w,w<b){b-=w;do{S[i++]=h[x++]}while(--w);x=i-k,P=S}}else if(d<w){if(x+=c+d-w,(w-=d)<b){b-=w;do{S[i++]=h[x++]}while(--w);if(x=0,d<b){b-=w=d;do{S[i++]=h[x++]}while(--w);x=i-k,P=S}}}else if(x+=d-w,w<b){b-=w;do{S[i++]=h[x++]}while(--w);x=i-k,P=S}for(;b>2;)S[i++]=P[x++],S[i++]=P[x++],S[i++]=P[x++],b-=3;b&&(S[i++]=P[x++],b>1&&(S[i++]=P[x++]))}else{x=i-k;do{S[i++]=S[x++],S[i++]=S[x++],S[i++]=S[x++],b-=3}while(b>2);b&&(S[i++]=S[x++],b>1&&(S[i++]=S[x++]))}break}}break}}while(r<a&&i<u);r-=b=p>>3,f&=(1<<(p-=b<<3))-1,e.next_in=r,e.next_out=i,e.avail_in=r<a?a-r+5:5-(r-a),e.avail_out=i<u?u-i+257:257-(i-u),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var r=n(41),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,s,c,l,d,h){var f,p,v,m,g,y,_,w,b,k=h.bits,x=0,P=0,C=0,S=0,O=0,E=0,I=0,A=0,M=0,T=0,V=null,j=0,U=new r.Buf16(16),D=new r.Buf16(16),R=null,B=0;for(x=0;x<=15;x++)U[x]=0;for(P=0;P<s;P++)U[t[n+P]]++;for(O=k,S=15;S>=1&&0===U[S];S--);if(O>S&&(O=S),0===S)return c[l++]=20971520,c[l++]=20971520,h.bits=1,0;for(C=1;C<S&&0===U[C];C++);for(O<C&&(O=C),A=1,x=1;x<=15;x++)if(A<<=1,(A-=U[x])<0)return-1;if(A>0&&(0===e||1!==S))return-1;for(D[1]=0,x=1;x<15;x++)D[x+1]=D[x]+U[x];for(P=0;P<s;P++)0!==t[n+P]&&(d[D[t[n+P]]++]=P);if(0===e?(V=R=d,y=19):1===e?(V=a,j-=257,R=i,B-=257,y=256):(V=o,R=u,y=-1),T=0,P=0,x=C,g=l,E=O,I=0,v=-1,m=(M=1<<O)-1,1===e&&M>852||2===e&&M>592)return 1;for(;;){_=x-I,d[P]<y?(w=0,b=d[P]):d[P]>y?(w=R[B+d[P]],b=V[j+d[P]]):(w=96,b=0),f=1<<x-I,C=p=1<<E;do{c[g+(T>>I)+(p-=f)]=_<<24|w<<16|b|0}while(0!==p);for(f=1<<x-1;T&f;)f>>=1;if(0!==f?(T&=f-1,T+=f):T=0,P++,0==--U[x]){if(x===S)break;x=t[n+d[P]]}if(x>O&&(T&m)!==v){for(0===I&&(I=O),g+=C,A=1<<(E=x-I);E+I<S&&!((A-=U[E+I])<=0);)E++,A<<=1;if(M+=1<<E,1===e&&M>852||2===e&&M>592)return 1;c[v=T&m]=O<<24|E<<16|g-l|0}}return 0!==T&&(c[g+T]=x-I<<24|64<<16|0),h.bits=O,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){e.exports=n(50)(45)},function(e,t,n){e.exports=n(50)(46)},function(e,t){Array.prototype.takeWhile||(Array.prototype.takeWhile=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],a=arguments.length>=2?arguments[1]:void 0,i=0;i<n;++i)if(i in t){var o=t[i];if(!e.call(a,o,i,t))break;r.push(o)}return r})},function(e,t,n){"use strict";e.exports=function(e,t,n,r,a,i,o,u){if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,a,i,o,u],l=0;(s=new Error(t.replace(/%s/g,function(){return c[l++]}))).name="Invariant Violation"}throw s.framesToPop=1,s}}},function(e,t,n){"use strict";var r=n(77),a=n(177),i=n(118),o=n(37),u=n(75),s=Object.assign;e.exports=!s||n(26)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=s({},e)[n]||Object.keys(s({},t)).join("")!=r})?function(e,t){for(var n=o(e),s=arguments.length,c=1,l=a.f,d=i.f;s>c;)for(var h,f=u(arguments[c++]),p=l?r(f).concat(l(f)):r(f),v=p.length,m=0;v>m;)d.call(f,h=p[m++])&&(n[h]=f[h]);return n}:s},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t){},function(e,t,n){"use strict";var r=n(38),a=n(40);e.exports=function(e){var t=String(a(this)),n="",i=r(e);if(i<0||i==1/0)throw RangeError("Count can't be negative");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(n+=t);return n}},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);n(133),n(33);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){return(a="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)})(e)}n(13),n(20),n(17),n(9),n(22),n(12),n(53),n(54),n(64),n(21),n(48),n(49),n(18),n(111),n(55),n(27),n(36);var i=n(4),o=n(6),u=n(1),s=(n(83),n(31),n(39),[]),c=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"get",value:function(){var e=s.find(function(e){return e.free});return e?(e.pause(),e.free=!1):((e=document.createElement("audio")).free=!1,e.loop=!1,e.play(),s.push(e)),e}},{key:"exist",value:function(e){return s.some(function(t){return t===e})}},{key:"free",value:function(t){e.exist(t)&&(t.free=!0)}},{key:"fill",value:function(){var e=function(e){for(var t=0;t<e;t++){var n=document.createElement("audio");n.free=!0,n.loop=!1,n.play(),s.push(n)}};s.length?s.reduce(function(e,t){return e+(t&&t.free?1:0)},0)<10&&e(50):e(100)}}]),e}(),l=n(0),d=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"updateText",value:function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var e=this.text;this.characterLimitSize>-1&&this.characterLimitSize<e.length&&(e=this.text.substring(0,this.characterLimitSize)+this.characterLimitSuffix),this.style.wordWrap&&(e=this.runWordWrap(this.text));var t=e.split(this.splitRegExp),n=this.style.tabs,r=[],a=0,i=this.determineFontProperties(this.style.font),o=t.length;this.style.maxLines>0&&this.style.maxLines<t.length&&(o=this.style.maxLines),this._charCount=0;for(var u=0;u<o;u++){if(0===n){var s=this.style.strokeThickness+this.padding.x;this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?s+=this.measureLine(t[u]):s+=this.context.measureText(t[u]).width}else{var c=t[u].split(/(?:\t)/);s=this.padding.x+this.style.strokeThickness;if(Array.isArray(n))for(var l=0,d=0;d<c.length;d++){var h=0;h=this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.measureLine(c[d]):Math.ceil(this.context.measureText(c[d]).width),d>0&&(l+=n[d-1]),s=l+h}else for(d=0;d<c.length;d++){this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?s+=this.measureLine(c[d]):s+=Math.ceil(this.context.measureText(c[d]).width),s+=this.game.math.snapToCeil(s,n)-s}}r[u]=Math.ceil(s),a=Math.max(a,r[u])}this.canvas.width=a*this._res;var f,p,v=i.fontSize+this.style.strokeThickness+this.padding.y,m=v*o,g=this.lineHeight?this.lineHeight-v:this._lineSpacing;for(g<0&&Math.abs(g)>v&&(g=-v),0!==g&&(m+=g>0?g*t.length:g*(t.length-1)),this.canvas.height=m*this._res,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="middle",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round",this._charCount=0,u=0;u<o;u++)f=this.style.strokeThickness/2,p=this.style.strokeThickness/2+u*v+i.ascent,u>0?p+=g*u+(this.lineHeight?g/2:0):this.lineHeight&&(p+=g/2),"right"===this.style.align?f+=a-r[u]:"center"===this.style.align&&(f+=(a-r[u])/2),this.autoRound&&(f=Math.round(f),p=Math.round(p)),this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.updateLine(t[u],f,p):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===n?this.context.strokeText(t[u],f,p):this.renderTabLine(t[u],f,p,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===n?this.context.fillText(t[u],f,p):this.renderTabLine(t[u],f,p,!0)));this.updateTexture(),this.dirty=!1}},{key:"advancedWordWrap",value:function(e){for(var t=this.context,n=this.style.wordWrapWidth,r="",a=e.split(this.splitRegExp),i=0;i<a.length;i++){var o=a[i];if(t.measureText(o).width<n)r+=o+"\n";else{for(var u="",s=n,c=0;c<o.length;c++){var l=o[c],d=t.measureText(l).width;if(d>s){var h=o.slice(c);a.splice(i+1,0,h);break}u+=l,s-=d}r+=u+"\n"}}return r=r.replace(/[\s|\n]*$/gi,"")}},{key:"loadImageTag",value:function(e){var t=this;e.url=u.c.switcLoadDomain(this.transformUrl(e.url,e)||"");e.url.toLowerCase().includes(".gif")?this.xhrLoad(e,e.url,"arraybuffer",function(n){var r,a=n.requestObject.response;a instanceof ArrayBuffer&&(r=new Uint8Array(a));var i=!1;r[0]!=="G".charCodeAt()||r[1]!=="I".charCodeAt()||r[2]!=="F".charCodeAt()||r[3]!=="8".charCodeAt()||r[4]!=="9".charCodeAt()&&!"7".charCodeAt()||r[5]!=="a".charCodeAt()||(i=!0),e.data=new Image,e.data.name=e.key,t.crossOrigin&&(e.data.crossOrigin=t.crossOrigin);if(e.data.onload=function(){URL.revokeObjectURL(e.url),e.data.onload&&(e.data.onload=null,e.data.onerror=null,t.fileComplete(e))},e.data.onerror=function(){URL.revokeObjectURL(e.url),e.data.onload&&(e.data.onload=null,e.data.onerror=null,t.fileError(e))},i)var o=e.key,s=t.game.cache,c=u.c.spliceGif(a,function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s.checkImageKey(o)?(t.image=new PIXI.Texture(new PIXI.BaseTexture(t.image)),e.data.frames.push(t),e.data.parsed=n):c&&c.cancel&&c.cancel()}).then(function(n){var r=n.frames,a=n.parsed,i=n.frameLength,o=n.loopCount;e.data=r[0].image,e.data.frameLength=i,e.data.parsed=a,e.data.name=e.key,e.data.frames=r.map(function(e){return e.image=new PIXI.Texture(new PIXI.BaseTexture(e.image)),e}),e.data.loopCount=o,t.fileComplete(e)},function(){return t.fileError(e)});else e.url=URL.createObjectURL(u.c.createBlob(a,"")),e.data.src=e.url;e.data.complete&&e.data.width&&e.data.height&&(e.data.onload=null,e.data.onerror=null,t.fileComplete(e))}):Phaser.Loader.prototype.loadImageTag.call(this,e)}},{key:"soundStop",value:function(){var e=this;if(this.isPlaying&&this._sound)if(this.usingWebAudio){if(this.externalNode){var t=this._sound.onended;this._sound.onended=function(){e._sound.disconnect(e.externalNode),t&&t()}}else if(this.gainNode){var n=this._sound.onended;this._sound.onended=function(){e._sound.disconnect(e.gainNode),n&&n()}}if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(e){alert(e)}}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(this.pendingPlayback=!1,this.isPlaying=!1,!this.paused){var r=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",null!==this.fadeTween&&this.fadeTween.stop(),this.onStop.dispatch(this,r)}}},{key:"soundDecode",value:function(e,t){var n=this;t=t||null;var r=this.game.cache.getSoundData(e);if(r&&!1===this.game.cache.isSoundDecoded(e)){this.game.cache.updateSound(e,"isDecoding",!0);var a=this,i=function(){n.onSoundDecodeError.dispatch(e),console.warn("Unable to encode audio "+e)};try{this.context.decodeAudioData(r,function(n){n&&(a.game.cache.decodedSound(e,n),a.onSoundDecode.dispatch(e,t))}).catch(i)}catch(e){i()}}}},{key:"loadAudioTag",value:function(e){var t=this,n=e.url;n.indexOf("?")>=0&&(n=n.substr(0,n.indexOf("?")));var r="dat"===n.substr((Math.max(0,n.lastIndexOf("."))||1/0)+1).toLowerCase();e.url=u.c.switcLoadDomain(e.url);var a=function(e){if(t.game.sound.touchLocked)e.data=c.get(),e.data.name=e.key,e.data.src=t.transformUrl(e.url,e),t.fileComplete(e);else{var n,r=c.get();if(e.data=r,e.data.name=e.key,!c.exist(r))return t.game.sound.touchLocked=!0,e.data.src=t.transformUrl(e.url,e),void t.fileComplete(e);var a=function r(){n&&clearTimeout(n),e.data.removeEventListener("canplaythrough",r,!1),e.data.onerror=null,t.fileComplete(e)};e.data.onerror=function(r){console.error("".concat(e.url," load error")),n&&clearTimeout(n),e.data.removeEventListener("canplaythrough",a,!1),e.data.onerror=null,t.fileComplete(e)},e.data.src=t.transformUrl(e.url,e),e.data.addEventListener("canplaythrough",a,!1);var i=navigator.userAgent.toLowerCase();(i.indexOf("firefox")>-1||i.indexOf("baidu")>-1||"wap"==l.a.client&&game.device.android||l.a.isWapOther&&game.device.iOS&&"mk"==l.a.wap)&&(e.data.preload="auto",n=setTimeout(function(){n&&clearTimeout(n),t.fileComplete(e)},3e3));try{e.data.load()}catch(r){n&&clearTimeout(n),t.fileComplete(e)}}};r?function(e){t.game.device.android?a(e):t.xhrLoad(e,t.transformUrl(e.url,e),"arraybuffer",function(e,t){e.url=URL.createObjectURL(new Blob([t.response],{type:"audio/mp3"})),e.isDatFile=!0,a(e)})}(e):a(e)}},{key:"tintWithMultiply",value:function(e,t,n){var r=n.getContext("2d"),a=e.crop,i=a.width,o=a.height;e.rotated&&(i=o,o=a.width),n.width===i&&n.height===o||(n.width=i,n.height=o),r.clearRect(0,0,i,o),r.drawImage(e.baseTexture.source,a.x,a.y,i,o,0,0,i,o),r.globalCompositeOperation="source-atop",r.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),r.fillRect(0,0,i,o),r.globalCompositeOperation="source-over"}}]),e}();window.PIXI=n(172),window.Phaser=n(173),PIXI.CanvasTinter.tintWithMultiply=d.tintWithMultiply,Phaser.Text.prototype.updateText=d.updateText,Phaser.Game.prototype.destroyComponent=new Phaser.Signal;var h=PIXI.Sprite.prototype.destroy;PIXI.Sprite.prototype.destroy=function(){var e=this.game;h.apply(this,arguments),e&&e.destroyComponent&&e.destroyComponent.dispatch(this.key||null),Phaser.CanvasPool.remove(this)};var f=Phaser.Sprite.prototype._renderCanvas;Phaser.Sprite.prototype._renderCanvas=function(){try{f.apply(this,arguments)}catch(e){console.log(this.key)}};var p=PIXI.Sprite.prototype._renderCanvas;PIXI.Sprite.prototype._renderCanvas=function(){try{p.apply(this,arguments)}catch(e){}};var v=Phaser.Image.prototype.destroy;Phaser.Image.prototype.destroy=function(){var e=this.game;v.apply(this,arguments),e&&e.destroyComponent&&e.destroyComponent.dispatch(this.key||null),Phaser.CanvasPool.remove(this)};var m=Phaser.Button.prototype.destroy;Phaser.Button.prototype.destroy=function(){var e=this;Object.keys(this).forEach(function(t){e.hasOwnProperty(t)&&e[t]instanceof Phaser.Sound&&e[t].destroy()}),m.apply(this,arguments)};var g={};Phaser.Loader.prototype.forceRemoveFile=function(e,t,n){var r=this,a=this.getAsset(e,t);if(a){var i=a.file;if(i.loaded||i.loading){var o=function(){g[t]&&("audio"===e&&r.cache.checkSoundKey(t)&&n&&n(t),"image"===e&&r.cache.checkImageKey(t)&&n&&n(t),g[t]=null)},u=function e(n,a,i,u,s){a==t&&(o(),r.onFileComplete.remove(e))};g[t]&&this.onFileComplete.remove(g[t]),g[t]=u,a.loaded&&o(),a.loading&&this.onFileComplete.add(u)}else i.loaded=i.error=!0}},Phaser.Loader.prototype.cancelForceRemoveFile=function(e,t){g[t]&&(this.onFileComplete.remove(g[t]),g[t]=null)},Phaser.Loader.prototype.loadImageTag=function(e){var t=this;e.data=new Image,e.data.name=e.key,this.crossOrigin&&(e.data.crossOrigin=this.crossOrigin),e.data.onload=function(){e.data.onload&&(e.data.onload=null,e.data.onerror=null,t.fileComplete(e))},e.data.onerror=function(){e.data.onload&&(e.data.onload=null,e.data.onerror=null,t.fileError(e))},e.data.complete&&e.data.width&&e.data.height&&(e.data.onload=null,e.data.onerror=null,this.fileComplete(e)),e.data.src=this.transformUrl(e.url,e)},Phaser.Loader.prototype.audio=function(e,t,n,r){return this.game.sound.noAudio?this:("string"==typeof t&&(t=[t]),this.addToFileList("audio",e,t,{buffer:null,autoDecode:!1},n,void 0,r))},Phaser.Loader.prototype.image=function(e,t,n,r){return"object"===a(t)?this.texture(e,t,n):this.addToFileList("image",e,t,void 0,n,".png",r)},Phaser.Loader.prototype.addToFileList=function(e,t,n,r,a,i,o){if(void 0===a&&(a=!1),void 0===t||""===t)return console.warn("Phaser.Loader: Invalid or no key given of type "+e),this;if(null==n){if(!i)return console.warn("Phaser.Loader: No URL given for file type: "+e+" key: "+t),this;n=t+i}var u={type:e,key:t,path:this.path,url:n,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1};if(r)for(var s in r)u[s]=r[s];var c=this.getAssetIndex(e,t);if(a&&c>-1){var l=this._fileList[c];l.error||l.loaded?(o?this._fileList.splice(this._processingHead,0,u):this._fileList.push(u),this._totalFileCount++):this._fileList[c]=u}else-1===c&&(o?this._fileList.splice(this._processingHead,0,u):this._fileList.push(u),this._totalFileCount++);return this},Phaser.Loader.prototype.loadAudioTag=d.loadAudioTag;var y=Phaser.Sound.prototype.destroy;Phaser.Sound.prototype.destroy=function(){if(y.apply(this,arguments),this.usingWebAudio){this.game.sound.context&&!this.game.sound.scratchBuffer&&(this.game.sound.scratchBuffer=this.game.sound.context.createBuffer(1,1,22050));try{this._sound.buffer=this.game.sound.scratchBuffer}catch(e){}}this._sound=null},Phaser.Cache.prototype.reloadSound=function(e){var t=this,n=this.getSound(e);if(n&&!c.exist(n.data)){var r=c.get();if(!c.exist(r))return;n.data=r,n.data.src=n.url,n.data.addEventListener("canplaythrough",function(){return t.reloadSoundComplete(e)},!1),n.data.load()}},Phaser.Cache.prototype.removeImage=function(e,t){void 0===t&&(t=!0);var n=this.getImage(e,!0);n.data.frames&&(n.data.frames=null),t&&n.base&&n.base.destroy(),delete this._cache.image[e]},Phaser.Device.canPlayAudio=function(e){return!("mp3"!==(e=e.replace(/\~.*/g,""))||!this.mp3)||(!("ogg"!==e||!this.ogg&&!this.opus)||(!("m4a"!==e||!this.m4a)||(!("opus"!==e||!this.opus)||(!("wav"!==e||!this.wav)||(!("webm"!==e||!this.webm)||(!("mp4"!==e||!this.dolby)||"dat"===e))))))},Phaser.SoundManager.prototype.setMute=function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this.game.device.iOS&&this._sounds[e].pause(),this._sounds[e].mute=!0);this.onMute.dispatch()}},Phaser.SoundManager.prototype.unsetMute=function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this.game.device.iOS&&this._sounds[e].resume(),this._sounds[e].mute=!1);this.onUnMute.dispatch()}};var _=Phaser.RetroFont.prototype;Phaser.RetroFont=function(e,t,n,r,a,i,o,u,s,c){var l=e.cache;if(!l.checkImageKey(t))return!1;var d=l.getImage(t,!0),h=d.data,f=d.grabData,p=void 0===f?[]:f,v=d.frameData;null==i&&(i=h.width/n),this.characterWidth=n,this.characterHeight=r,this.characterSpacingX=o||0,this.characterSpacingY=u||0,this.characterPerRow=i,this.offsetX=s||0,this.offsetY=c||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=h,this._text="",this.grabData=p,this.frameData=v,this.stamp=new Phaser.Image(e,0,0,t,0),Phaser.RenderTexture.call(this,e,100,100,"",Phaser.scaleModes.NEAREST),this.type=Phaser.RETROFONT},Phaser.RetroFont.prototype=_,Phaser.RetroFont.prototype.constructor=Phaser.RetroFont;var w=Phaser.RetroFont.prototype.destroy;Phaser.RetroFont.prototype.destroy=function(){w.call(this,!0),Phaser.CanvasPool.remove(this.stamp)},Phaser.MSPointer.prototype.onPointerOut=function(e){if(this.event=e,this.capture&&e.preventDefault(),"mouse"===e.pointerType||4===e.pointerType)this.input.mousePointer.withinGame=!1,this.input.mousePointer.leave(e);else{var t=this.input.getPointerFromIdentifier(e.identifier);t&&(t.withinGame=!1)}this.input.mouse.mouseOutCallback&&this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,e),this.input.enabled&&this.enabled&&this.input.mouse.stopOnGameOut&&(e.identifier=0,t?t.stop(e):this.input.mousePointer.stop(e))},PIXI.CanvasTinter.getTintedTexture=function(e,t){var n=e.tintedTexture||Phaser.CanvasPool.create(e);return PIXI.CanvasTinter.tintMethod(e.texture,t,n),n},Phaser.Text.prototype.updateTexture=function(){var e=this.texture.baseTexture,t=this.texture.crop,n=this.texture.frame,r=this.canvas.width,a=this.canvas.height;if(e.width=r,e.height=a,t.width=r,t.height=a,n.width=r,n.height=a,this.texture.width=r,this.texture.height=a,this._width=r,this._height=a,this.textBounds){var i=this.textBounds.x,o=this.textBounds.y;"right"===this.style.boundsAlignH?i+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(i+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?o+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(o+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=0|-(i+.5),this.pivot.y=0|-(o+.5)}this.renderable=0!==r&&0!==a,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()};n(174);var b="9ce71fa96894bf9d67f69cffb7c10230850012cd",k=(n(67),n(99),n(3)),x=(n(14),n(15));function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(56);var C=n(2),S=n.n(C);n(32),n(127),n(128);function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){P(e,t,n[t])})}return e}n(57);var E=function(e,t){var n="趣国囊巍囍WMQybdfgjpqy",r=document.createElement("span");r.style.fontSize=t+"px",r.innerHTML=n[0],r.style.fontFamily=e,r.style.position="absolute",r.style.top="0px",r.style.zIndex=-1,document.body.appendChild(r);for(var a=0,i=r.offsetHeight,o=0;o<n.length;o++)r.innerHTML=n[o],a=a>r.offsetWidth?a:r.offsetWidth;return document.body.removeChild(r),{width:a,height:i}},I=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"init",value:function(t,n){if(t){if(e.options=t,t.size?t.size.target.width?(e.charWidth=t.size.target.width,e.charHeight=t.size.target.height):(e.charWidth=t.size.target,e.charHeight=t.size.target):(e.charWidth=n,e.charHeight=n,e.options=Object.assign({size:{target:n,source:n}},e.options)),e.fontFamily=t.fontFamily,function(e){var t=["Microsoft YaHei","Helvetica","sans-serif","serif"],n=document.createElement("span");n.style.fontSize="72px",n.innerHTML="qwertyuiopasdfghjklzxcvbnm";var r={},a={};return t.forEach(function(e){n.style.fontFamily=e,document.body.appendChild(n),r[e]=n.offsetWidth,a[e]=n.offsetHeight,document.body.removeChild(n)}),t.some(function(t){n.style.fontFamily=e+","+t,document.body.appendChild(n);var i=n.offsetWidth!=r[t]||n.offsetHeight!=a[t];return document.body.removeChild(n),i})}(t.fontFamily)&&!l.a.ftfont){var r=t.size?t.size.source:n,a=E(t.fontFamily,r),i=a.width,o=a.height;return e.charWidth=i,void(e.charHeight=o)}var s=e.charWidth,c=e.charHeight,d=e.fontFamily,h=t.images.map(function(e){var t=e.ftUrl,n=e.url,r=e.chars;return{url:u.c.convertToFullUrl(l.a.ftfont&&t?t:n),chars:r}}),f=document.createElement("canvas"),p=f.getContext("2d"),v=h.length;f.width=40*s,f.height=20*c;var m=game.cache.addImage(d,d,f),g=new Phaser.FrameData,y={};!function t(n,r){if(n<v){var a=h[n],i=a.url,o=a.chars,l=new Image;l.crossOrigin="anonymous",l.src=i,l.onerror=function(){return console.error(new Error("".concat(i," load error")))},l.onload=function(){p.clearRect(0,0,f.width,f.height),p.drawImage(l,0,0),function(t,n){for(var r=0,a=0,i=0,o=function(o,u){var l=e.getRealImageCharWidth(t[o]),d=g.addFrame(new Phaser.Frame(n+o,0,0,l,c)),h=~~(r+(s-l)/2),f=~~a;setTimeout(function(){return y[t.charCodeAt(o)]={index:d.index,imageData:p.getImageData(h,f,l,c)}},0),40==++i?(i=0,r=0,a+=c):r+=s},l=0,d=t.length;l<d;l++)o(l);return u.c.timeout(10)}(o,r).then(function(){return t(n+1,r+o.length)})}}else m.frameData=g,m.grabData=y,f.width=s,f.height=c,p.clearRect(0,0,s,c),e.fontImage=f}(0,0)}}},{key:"getRealImageCharWidth",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=e.charWidth,a=0,i=Math.floor(r/4);return/[MWwm]/.test(t)?a=2*(i-4):/[@&]/.test(t)?a=2*(i-3):/[A-Z<>%]/.test(t)?a=2*(i-2):/[iI,.|']/g.test(t)?a=3*i:/[\+=\/\\\+=?~#$:"{}\-*^!`\[\]()]|[a-z]/g.test(t)?a=Math.floor(5*r/8):/[0-9]/.test(t)&&(a=2*i),n*(r-a)}},{key:"getRealImageCharOffset",value:function(t,n){var r=0,a=e.options.size,i=a.target,o=a.source,u=i.width||i;if(/^\u3000|\u2003$/.test(t))r=u*n/o-n;else if(/^\x20|\xA0|\u2002$/.test(t))r=u*n/o-n/2;else if(!/[\+=\/\\——\+=?~#$:"{}\-*^!`\[\]()]|[0-9a-z]/g.test(t)){var s=i.width||i;r=(r=Math.round(n*(s/o-1)))&&r%2==1?r-1:r}return r}},{key:"getSizeScale",value:function(t,n){return n=parseFloat(n),e.fontFamily!==t?1:n/e.options.size.source}},{key:"toRealSize",value:function(t,n){if(n=parseFloat(n),e.fontFamily!==t)return E(t,n);var r=e.options.size,a=r.target,i=r.source;return{height:n*(a&&a.height?a.height:a)/i,width:n*(a&&a.width?a.width:a)/i}}},{key:"lineSpacing",value:function(t,n){return 1.5*n-e.toRealSize(t,n).height}},{key:"getCharWidth",value:function(e,t){return/[a-zA-Z0-9]/.test(e)?14*t/25:"("===e||")"===e?8*t/25:"-"===e?11*t/25:"."===e||":"===e?7:32===e.charCodeAt(0)||160===e.charCodeAt(0)||" "===e?t>>1:t}},{key:"getLeftMargin",value:function(e,t){return/[a-zA-Z0-9\.\)]/.test(e)?0:"("===e||":"===e?-4*t/25:"-"===e?-t/25:6*t/25}},{key:"useFontImage",get:function(){return!!e.fontImage}}]),e}();I.fontImage=void 0,I.fontFamily="",I.charWidth=25,I.charHeight=25;n(66);var A=n(5),M=n(8),T=[],V={resumeAudio:null,pauseAudio:null,unlockChapter:null,mallPay:null,showSave:null,audioCanPlay:null,audioError:null,shanyiMenuBack:null,shanyiMenuExit:null,login:null,logout:null,restart:null,showGameNotice:null,updatevolume:null,setAttribute:null,unlockpayrecord:null,playadBack:null,rechargeback:null,finishedPreferential:function(e){return T.push(e.uuid?e.uuid:e)}},j=function(e,t){return V[e]&&V[e](t)},U=null,D=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"isAppClient",value:function(){var e=l.a.client,t=l.a.offline;return"android"===e?window.app&&window.app.unlock:"ios"===e&&(t||!t&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.unlock)}},{key:"init",value:function(){var t=l.a.app_version,n=l.a.client,r=l.a.single;l.a.useExternalAudioLoader="ios"===n&&(u.c.compareVersions(t,"1.5.0")||r)>=0,l.a.useExternalAudioLoader||(e.loadAudio=!1,e.playAudio=null,e.stopAudio=null,e.removeAudio=null,e.setAudioVolume=null)}},{key:"isFinishedPreferentialChapter",value:function(e){return T.some(function(t){return t===e})}},{key:"removeFinishedPreferentialChapter",value:function(e){var t=T.findIndex(function(t){return t===e});~t&&T.splice(t,1)}},{key:"unlockChapter",value:function(t){var n=function(){return Promise.reject("ExternalShanyiApi unlockChapter is error")},r=l.a.gid,a=l.a.client,i=l.a.offline,o=l.a.uuid,s=l.a.app_version,c=l.a.uid,d=l.a.isWapOther,h=l.a.wap;if(u.c.compareVersions(s,"1.2.0")<0&&e.isAppClient())return e.unlockChapter=function(){return A.a.info("该章节为付费章节，当前版本过低，不支持该功能")},e.unlockChapter(t);if(d){if("mk"==h){var f=t.product_name,p=t.amount;e.unlockChapter=function(e){return M.b.mkPayPopup("付费章节购买",f,p,"symkunlockpay").then(function(){return M.b.mkPay(e,2)},n)}}return e.unlockChapter(t)}return e.unlockChapter="ios"===a?i?function(t){return unlock?new Promise(function(n,a){var i=t.charge,o=t.uuid,u=t.md5,s=t.discounts;e.setCallback("unlockChapter",n),unlock(JSON.stringify({gid:r,uuid:o,charge:i,md5:u,special_price:s}))}):n}:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.unlock?function(t){return new Promise(function(n,a){var i=t.charge,o=t.uuid,u=t.md5,s=t.discounts;e.setCallback("unlockChapter",n),window.webkit.messageHandlers.unlock.postMessage(JSON.stringify({gid:r,uuid:o,charge:i,md5:u,special_price:s}))})}:n:"android"===a?window.app&&window.app.unlock?function(t){return new Promise(function(n,a){var i=t.charge,o=t.uuid,u=t.md5;e.setCallback("unlockChapter",n),window.app.unlock(r,o,i,u)})}:n:"wap"===a?window.parent&&window.parent.get_account_info?function(t){return new Promise(function(n,a){var i=t.charge,u=t.uuid,s=t.md5,l=t.discounts;e.setCallback("unlockChapter",function(e){game.gameResumed(),n(e)}),window.parent.get_account_info(JSON.stringify({gid:r,md5:s,charge:i,uuid:o,special_price:l,chapter_uuid:u,author_id:c,consume_falg:"chapter"}))})}:n:"pc"===a&&window.parent&&window.parent.H5payFlash?function(t){return new Promise(function(n,r){try{e.setCallback("unlockChapter",function(e){game.gameResumed(),n(e)});var a=t.uuid,i=(t.md5,t.charge),u=(t.discounts,t.charge_app),s=t.charge_pc,c=t.chaptername,l=t.time,d=t.token,h=t.starToken;window.parent.H5payFlash(o,a,c,i,l,d,h,s,u,"unlockChapterFinished")}catch(e){r()}})}:n,e.unlockChapter(t)}},{key:"pay",value:function(t){var n=l.a.client,r=l.a.offline,a=l.a.uuid,i=l.a.app_version,o=l.a.wap,s=l.a.isWapOther,c=function(){return Promise.resolve(-1)};if(u.c.compareVersions(i,"1.2.0")<0&&("ios"===n||"android"===n)&&!s)return A.a.info("版本过低不支该改功能，请先更新版本~").then(function(){return-1},function(){return-1});if(s){if("mk"==o){var d=t.product_name,h=t.amount;e.pay=function(e){return M.b.mkPayPopup("商品购买",d,h,"symkpay").then(function(){return M.b.mkPay(e,1)},function(){return nop})}}return e.pay(t)}return e.pay="ios"===n?r?worksmall?function(t){return new Promise(function(n,r){try{e.setCallback("mallPay",n),worksmall(JSON.stringify(t))}catch(e){n(-1)}})}:c:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.worksmall?function(t){return new Promise(function(n,r){try{e.setCallback("mallPay",n),window.webkit.messageHandlers.worksmall.postMessage(JSON.stringify(t))}catch(e){n(-1)}})}:c:"android"===n?window.app&&window.app.worksmall?function(t){return new Promise(function(n,r){try{e.setCallback("mallPay",n),window.app.worksmall(JSON.stringify(t))}catch(e){n(-1)}})}:c:"wap"===n?"wx"===o?function(){return M.e.openWxPage(),Promise.resolve(-1)}:window.parent&&window.parent.get_account_info?function(t){return new Promise(function(n,r){try{e.setCallback("mallPay",function(e){game.gameResumed(),n(e)}),window.parent.get_account_info(JSON.stringify(O({},t,{uuid:a,consume_falg:"mall"})))}catch(e){n(-1)}})}:c:"pc"===n&&window.parent&&window.parent.H5payEvent?function(t){return new Promise(function(n,r){try{e.setCallback("mallPay",function(e){game.gameResumed(),n(e)});var a=t.uuid,i=t.eid,o=t.charge,u=t.charge_pc,s=t.charge_app,c=t.time,l=t.token,d=t.payValues,h=t.name,f=t.starToken,p=t.indentId;window.parent.H5payEvent(a,i,o,c,l,p,d,h,"mallPay",f,u,s)}catch(e){n(-1)}})}:c,e.pay(t)}},{key:"notifyGameStarted",value:function(){var t=function(){},n=l.a.client,r=l.a.offline,a=l.a.app_version,i=l.a.wap;l.a.single||u.c.compareVersions(a,"1.3.0")<0&&e.isAppClient()?e.notifyGameStarted=t:"ios"===n?r?gameStart&&gameStart("1"):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.gameStart&&window.webkit.messageHandlers.gameStart.postMessage("1"):"android"===n?window.app&&window.app.gameStart&&window.app.gameStart("1"):"pc"===n?window.parent&&window.parent.clickFlash&&window.parent.clickFlash():(!i||i&&"3000"===i)&&U&&U(),e.notifyGameStarted=t}},{key:"localStorageSetItem",value:function(t,n){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var r=function(e,t){return window.localStorage.setItem(e,t)},a=l.a.client,i=l.a.offline,o=l.a.app_version,s=l.a.wap,c=l.a.mk_ios_cache,d=game.device;if(u.c.compareVersions(o,"1.2.0")<0&&e.isAppClient())e.localStorageSetItem=r;else if("ios"===a)e.localStorageSetItem=i?localStorage_setItem?function(e,t){return localStorage_setItem(JSON.stringify({key:e,value:t}))}:r:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.localStorage_setItem?function(e,t){window.webkit.messageHandlers.localStorage_setItem.postMessage(JSON.stringify({key:e,value:t})),window.localStorage.setItem(e,t)}:r;else if("android"===a)s&&"mk"==s&&c&&d.iOS?e.localStorageSetItem=window.prompt?function(e,t){return window.prompt("MGSYCacheOperationSet-".concat(e),t)}:r:e.localStorageSetItem=window.app&&window.app.localStorage_setItem?function(e,t){return window.app.localStorage_setItem(e,t)}:r;else if("wap"===a&&"wx"===s)try{e.localStorageSetItem=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=new Date(1e3*(u.a.getCurDate+24*n*60*60));document.cookie="".concat(e,"=").concat(escape(t),";expires=").concat(r.toGMTString())}}catch(t){e.localStorageSetItem=r}else e.localStorageSetItem=r;return e.localStorageSetItem(t,n)}},{key:"localStorageGetItem",value:function(t){var n=function(e){return window.localStorage.getItem(e)||null},r=l.a.client,a=l.a.offline,i=l.a.app_version,o=l.a.wap,s=(l.a.single,l.a.mk_ios_cache),c=game.device;return u.c.compareVersions(i,"1.2.0")<0&&e.isAppClient()?e.localStorageGetItem=n:"ios"===r?e.localStorageGetItem=a&&localStorage_getItem?function(e){return localStorage_getItem(e)||null}:n:"android"===r?o&&"mk"==o&&s&&c.iOS?e.localStorageGetItem=window.prompt?function(e){var t=window.prompt("MGSYCacheOperationGet-".concat(e));return"MGSYCacheResultSuccess-MGSYCacheNull"==t?null:"MGSYCacheResultSuccess-"===t.substr(0,23)?t.substr(23):null}:n:e.localStorageGetItem=window.app&&window.app.localStorage_getItem?function(e){return window.app.localStorage_getItem(e)||null}:n:e.localStorageGetItem="wap"===r&&"wx"===o?function(e){try{var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=document.cookie.match(t);return n?unescape(n[2]):""}catch(e){return""}}:n,e.localStorageGetItem(t)}},{key:"localStorageRemoveItem",value:function(t){var n=function(e){return window.localStorage.removeItem(e)},r=l.a.client,a=l.a.offline,i=l.a.app_version,o=l.a.wap,s=(l.a.single,l.a.mk_ios_cache),c=game.device;if(u.c.compareVersions(i,"1.2.0")<0&&e.isAppClient())e.localStorageRemoveItem=n;else if("ios"===r)e.localStorageRemoveItem=a?removeLocalStorage?function(e){return removeLocalStorage(e)}:n:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.localStorage_setItem?function(e){return window.webkit.messageHandlers.removeLocalStorage.postMessage(e)}:n;else if("android"===r)o&&"mk"==o&&s&&c.iOS?e.localStorageRemoveItem=window.prompt?function(e){return window.prompt("MGSYCacheOperationRemove-".concat(e))}:n:e.localStorageRemoveItem=window.app&&window.app.removeLocalStorage?function(e){return window.app.removeLocalStorage(e)}:n;else if("wap"===r&&"wx"===o)try{e.localStorageRemoveItem=function(t){e.localStorageSetItem(t,"",-1)}}catch(t){e.localStorageRemoveItem=n}else e.localStorageRemoveItem=n;return e.localStorageRemoveItem(t)}},{key:"setCallback",value:function(e,t){void 0!==V[e]?"function"==typeof t?V[e]=t:console.warn("callback not function"):console.warn("callback key is error")}},{key:"loadAudio",value:function(t){var n=l.a.client,r=l.a.offline,a=l.a.app_version;l.a.single;return u.c.compareVersions(a,"1.5.0")<0||"ios"!==n?e.loadAudio=null:e.loadAudio=r?loadAudioUrl?function(e){return loadAudioUrl(JSON.stringify(e))}:null:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.loadAudioUrl?function(e){return window.webkit.messageHandlers.loadAudioUrl.postMessage(JSON.stringify(e))}:null,e.loadAudio&&e.loadAudio(t)}},{key:"playAudio",value:function(t){var n=l.a.client,r=l.a.offline,a=l.a.app_version;return u.c.compareVersions(a,"1.5.0")<0||"ios"!==n?e.playAudio=null:e.playAudio=r?playAudioUrl?function(e){return playAudioUrl(JSON.stringify(e))}:null:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.playAudioUrl?function(e){return window.webkit.messageHandlers.playAudioUrl.postMessage(JSON.stringify(e))}:null,e.playAudio&&e.playAudio(t)}},{key:"stopAudio",value:function(t){var n=l.a.client,r=l.a.offline,a=l.a.app_version;return u.c.compareVersions(a,"1.5.0")<0||"ios"!==n?e.playAudio=null:e.stopAudio=r?stopAudioUrl?function(e){return stopAudioUrl(JSON.stringify(e))}:null:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.stopAudioUrl?function(e){return window.webkit.messageHandlers.stopAudioUrl.postMessage(JSON.stringify(e))}:null,e.stopAudio&&e.stopAudio(t)}},{key:"setAudioVolume",value:function(t){var n=l.a.client,r=l.a.offline,a=l.a.app_version;return u.c.compareVersions(a,"1.5.0")<0||"ios"!==n?e.setAudioVolume=null:e.setAudioVolume=r?setAudioUrlVolume?function(e){return setAudioUrlVolume(JSON.stringify(e))}:null:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.setAudioUrlVolume?function(e){return window.webkit.messageHandlers.setAudioUrlVolume.postMessage(JSON.stringify(e))}:null,e.setAudioVolume&&e.setAudioVolume(t)}},{key:"removeAudio",value:function(t){var n=l.a.client,r=l.a.offline,a=l.a.app_version;return u.c.compareVersions(a,"1.5.0")<0||"ios"!==n?e.removeAudio=null:e.removeAudio=r?removeAudioUrl?function(e){return removeAudioUrl(JSON.stringify(e))}:null:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.removeAudioUrl?function(e){return window.webkit.messageHandlers.removeAudioUrl.postMessage(JSON.stringify(e))}:null,e.removeAudio&&e.removeAudio(t)}},{key:"switchAppBack",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=l.a.app_version,r=l.a.client,a=l.a.offline,i=function(){};return u.c.compareVersions(n,"1.8.1")>=0?e.switchAppBack="ios"===r?a?setVolumeState?function(e){return setVolumeState(JSON.stringify({state:!e}))}:i:window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.setVolumeState?function(e){return window.webkit.messageHandlers.setVolumeState.postMessage(JSON.stringify({state:!e}))}:i:"android"===r&&window.app&&window.app.setVolumeState?function(e){return window.app.setVolumeState(e?"false":"true")}:i:e.switchAppBack=i,e.switchAppBack(t)}},{key:"login",value:function(){var t=function(){},n=l.a.client,r=l.a.single,a=l.a.wap;if(r)e.login="ios"===n&&appLogin?function(){return appLogin()}:t;else{if(a)return"mk"==a&&(e.login=function(){return M.b.mkLoginPopup("symklogin").then(function(){return M.b.initMkbySy(1)},function(){return t})}),e.login();e.login="android"===n||"ios"===n?function(){return window.location.href="lzj3000://login"}:"wap"===n?window.parent&&window.parent.playLogin?function(){return window.parent.playLogin()}:t:"pc"===n&&window.parent&&window.parent.playerIslogin?function(){return window.parent.playerIslogin()}:t}return e.login()}},{key:"logout",value:function(){var t=function(){},n=l.a.app_version,r=l.a.client;return l.a.single?e.logout="ios"===r&&appLogout?function(){return appLogout()}:t:("android"===r||"ios"===r)&&u.c.compareVersions(n,"1.2.0")>=0?e.logout=function(){return window.location.href="lzj3000://logout"}:e.logout=t,e.logout()}},{key:"openShanyiMenu",value:function(){var t=l.a.client,n=l.a.app_version;return u.c.compareVersions(n,"1.2.0")<0&&e.isAppClient()?A.a.info("版本过低，不支持该功能"):e.openShanyiMenu="pc"===t?window.parent&&window.parent.infoFlash?function(){window.parent.infoFlash()}:function(){}:function(){return window.location.href="lzj3000://menu"},e.openShanyiMenu()}},{key:"refreshApp",value:function(){var t=function(){},n=l.a.app_version,r=l.a.client,a=l.a.offline;return u.c.compareVersions(n,"1.11.0")<0?A.a.info("版本过低，不支持刷新功能"):"android"===r?e.refreshApp=window.app&&window.app.refresh?function(){return window.app.refresh()}:t:"ios"===r&&(a?refresh:e.refreshApp=window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.refresh?function(){return window.webkit.messageHandlers.refresh.postMessage()}:t),e.refreshApp()}},{key:"toOpenNotice",value:function(){var t=l.a.client;return e.toOpenNotice="pc"===t&&window.parent&&window.parent.toOpenNotice?function(){window.parent.toOpenNotice()}:function(){},e.toOpenNotice()}},{key:"gameReady",value:function(){"pc"===l.a.client&&window.parent&&window.parent.game_ready&&window.parent.game_ready()}},{key:"urlExpire",value:function(){var t=l.a.client;return e.urlExpire="pc"===t&&window.parent&&window.parent.urlExpire?function(){window.parent.urlExpire()}:function(){},e.urlExpire()}},{key:"gameQuit",value:function(){var t=l.a.client,n=l.a.single,r=function(){};return"ios"===t&&n?e.gameQuit=appQuit?function(){return appQuit()}:r:"pc"===t&&(e.gameQuit=window.parent&&window.parent.game_quit?function(){window.parent.game_quit()}:r),e.gameQuit()}},{key:"fullScreenFromPc",value:function(){var t=l.a.client;return e.fullScreenFromPc="pc"===t&&window.parent&&window.parent.gameFlashFullScreen&&window.parent.gameFlashFullScreen.fullFunc?function(){window.parent.gameFlashFullScreen.fullFunc("h5")}:function(){},e.fullScreenFromPc()}},{key:"exitFullScreenFromPc",value:function(){var t=l.a.client;return e.exitFullScreenFromPc="pc"===t&&window.parent&&window.parent.gameFlashFullScreen&&window.parent.gameFlashFullScreen.outFullFunc?function(){window.parent.gameFlashFullScreen.outFullFunc()}:function(){},e.exitFullScreenFromPc()}},{key:"singlePlayAd",value:function(){var t=l.a.client,n=l.a.wap,r=l.a.singleoffline,a=function(){return Promise.reject()};return r||(e.singlePlayAd=a),r&&("android"==t?e.singlePlayAd=window.app&&window.app.playAdVideo?function(){return new Promise(function(t,n){e.setCallback("playadBack",t),window.app.playAdVideo()})}:a:"4399"==n&&(e.singlePlayAd=function(){return new Promise(function(e,t){M.a.playAd(function(t){return e(t)})})})),e.singlePlayAd()}},{key:"singleSaveValue",value:function(t,n){var r=l.a.client,a=function(t,n){return e.localStorageSetItem(t,n)};return e.singleSaveValue="android"==r&&window.app&&window.app.saveGameValue?function(e,t){return window.app.saveGameValue(e,t)}:a,e.singleSaveValue(t,n)}},{key:"singleGetValue",value:function(t){var n=l.a.client,r=function(t){return e.localStorageGetItem(t)};return e.singleGetValue="android"==n&&window.app&&window.app.readGameValue?function(e){return window.app.readGameValue(e)}:r,e.singleGetValue(t)}},{key:"singleRecharge",value:function(){var t=l.a.client,n=l.a.single,r=function(){return Promise.reject()};return e.singleRecharge=n&&"ios"==t&&appRecharge?function(){return new Promise(function(e,t){appRecharge()})}:r,e.singleRecharge()}},{key:"gameStartedApi",set:function(e){U=e}}]),e}();window.resumeAudio=function(){return j("resumeAudio")},window.pauseAudio=function(){return j("pauseAudio")},window.setLoginInfo=function(e){"wap"===e.client?e.uid&&(l.a.uid=e.uid):(e.token&&(l.a.token=e.token),e.u&&(l.a.u=e.u),e.uid&&(l.a.uid=e.uid)),j("login")},window.logoutAccount=function(){"wap"===l.a.client?l.a.uid="":(l.a.token="",l.a.u="",l.a.uid=""),j("logout")},window.unlockChapterFinished=function(e){return j("unlockChapter",e)},window.mallPay=function(e){return j("mallPay",e)},window.preferentialFinished=function(e){return j("finishedPreferential",e)},window.showSave=function(){return j("showSave")},window.audioCanPlayCallBack=function(e){return j("audioCanPlay",e)},window.audioErrorCallBack=function(e){return j("audioError",e)},window.localStorage_getItem=function(e){return""},window.localStorage_setItem=function(e,t){},window.removeLocalStorage=function(e){},window.syMenuBack=function(){return j("shanyiMenuBack")},window.syMenuExit=function(e){return j("shanyiMenuExit",e)},window.restart=function(e){return j("restart",!0)},window.showGameNotice=function(){return j("showGameNotice",!0)},window.volume=function(e){return j("updatevolume",e)},window.setAttribute=function(e){return j("setAttribute",e)},window.unlockpayrecord=function(e){return j("unlockpayrecord",e)},window.playadBack=function(e){return j("playadBack",e)},window.rechargeback=function(e){return j("rechargeback",e)};for(var R={},B={},L={},F={},z=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"getLoadingCount",value:function(){return Object.keys(R).length}},{key:"load",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;e.inCache(t)||(r||n.includes("https")||n.includes("http")||(n="https:".concat(n)),R[t]=!0,L[t]=!1,D.loadAudio&&D.loadAudio({url:n,key:t,local:r}))}},{key:"play",value:function(t){var n=t.key,r=t.volume,a=void 0===r?1:r,i=t.loop,o=void 0===i||i,u=t.channel;F[u]&&e.stop(u),n&&B[n]&&D.playAudio&&(D.playAudio({volume:a,channel:u,key:n,loop:o?1:0}),F[u]={channel:u,key:n,volume:a,loop:o})}},{key:"stop",value:function(e){F[e]&&(F[e].tween&&F[e].tween.cancel(!0),F[e].tween=null,F[e].key&&D.stopAudio&&D.stopAudio({channel:e})),delete F[e]}},{key:"setVolume",value:function(e){var t=e.channel,n=e.volume,r=void 0===n?1:n,a=e.tweening,i=void 0!==a&&a;D.setAudioVolume&&D.setAudioVolume({channel:t,volume:r}),F[t]&&(F[t].volume=r,i||(F[t].tween&&F[t].tween.cancel(!0),F[t].tween=null))}},{key:"free",value:function(e){delete B[e],D.removeAudio&&D.removeAudio({key:e})}},{key:"tweenFrom",value:function(e){var t=e.channel,n=e.volume,r=void 0===n?1:n,a=e.duration,i=void 0===a?10:a,o=e.delay;return W({channel:t,volume:r,duration:i,delay:void 0===o?0:o,type:"from"})}},{key:"tweenTo",value:function(e){var t=e.channel,n=e.volume,r=void 0===n?1:n,a=e.duration,i=void 0===a?10:a,o=e.delay;return W({channel:t,volume:r,duration:i,delay:void 0===o?0:o,type:"to"})}},{key:"inCache",value:function(e){return!!B[e]||!!L[e]}},{key:"isLoading",value:function(e){return!!L[e]}},{key:"loadedCallBack",value:function(e){delete R[e],delete L[e],B[e]=!0;var t=game.load.onSoundExtendLoad;t&&t.dispatch(e)}},{key:"faultCallBack",value:function(e){delete R[e],delete B[e],L[e]=!0;var t=game.load.onSoundExtendLoadError;t&&t.dispatch(e)}}]),e}(),W=function(e){var t=e.channel,n=e.volume,r=void 0===n?1:n,a=e.duration,i=void 0===a?10:a,o=e.delay,s=void 0===o?0:o,c=e.type,l=void 0===c?"to":c,d=!1,h=F[t];if(!h)return Promise.resolve();h.tween&&h.tween.cancel();var f=Math.ceil(i/20),p=("from"===l?h.volume-r:r-h.volume)/f,v="from"===l?h.volume:r,m="from"===l?r:h.volume,g=new Promise(function(e,n){if(i<=20)return z.setVolume({channel:t,volume:r,tweening:!0}),e();u.c.timeout(s).then(function(){return function n(){return d?e():v>m&&p>0||v<m&&p<0?(m+=p,m=u.c.fixVolume(m),z.setVolume({channel:t,volume:m,tweening:!0}),void u.c.timeout(20).then(function(){return n()})):(z.setVolume({channel:t,volume:v,tweening:!0}),e())}()})});return g.cancel=function(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&z.setVolume({channel:t,volume:v}),d=!0},h.tween=g,g},N={buttonSoundUrl:"",autoPlay:!1,fastPlay:!1,soundVolume:1,musicVolume:1,full:!1,records:[]},$=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"getFastPlayAnimationInfo",value:function(e){return{delay:0,duration:Math.min(e,100)}}},{key:"buttonSoundUrl",set:function(e){N.buttonSoundUrl=e},get:function(){return N.buttonSoundUrl}},{key:"autoPlay",set:function(e){N.autoPlay=e},get:function(){return N.autoPlay}},{key:"fastPlay",set:function(e){N.fastPlay=e},get:function(){return N.fastPlay}},{key:"soundVolume",set:function(e){N.soundVolume=u.c.fixVolume(e)},get:function(){return N.soundVolume}},{key:"musicVolume",set:function(e){N.musicVolume=u.c.fixVolume(e)},get:function(){return N.musicVolume}},{key:"full",set:function(e){N.full=e},get:function(){return N.full}},{key:"records",set:function(e){N.records=e},get:function(){return N.records}}]),e}(),H=(n(129),function(e){var t=e.color,n=void 0===t?0:t,r=e.alpha,a=void 0===r?1:r,i=e.x,o=void 0===i?0:i,s=e.y,c=void 0===s?0:s,l=e.rect,d=l.x,h=void 0===d?0:d,f=l.y,p=void 0===f?0:f,v=l.width,m=l.height,g=game.make.graphics(o,c);return g.beginFill(u.c.toColorValue(n),a),g.drawRect(h,p,v,m),g.endFill(),g}),q=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"to",value:function(e){var t=e.target,n=void 0===t?{}:t,r=e.properties,a=e.duration,i=void 0===a?0:a,o=e.ease,u=e.autoStart,s=void 0===u||u,c=e.delay,l=e.repeat,d=e.yoyo,h=e.game,f=void 0===h?window.game:h;if(!i){Object.keys(r).forEach(function(e){return n[e]=r[e]});var p=Promise.resolve();return p.cancel=function(){return Object.keys(r).forEach(function(e){return n[e]=r[e]})},p}var v=null,m=new Promise(function(e,t){(v=f.add.tween(n).to(r,i,o,s,c,l,d)).onComplete.add(e)});return m.cancel=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];v.stop(),e&&Object.keys(r).forEach(function(e){return n[e]=r[e]})},m}},{key:"from",value:function(e){var t=e.target,n=void 0===t?{}:t,r=e.properties,a=e.duration,i=void 0===a?0:a,o=e.ease,u=e.autoStart,s=void 0===u||u,c=e.delay,l=e.repeat,d=e.yoyo,h=e.game,f=void 0===h?window.game:h,p={};if(Object.keys(r).forEach(function(e){return p[e]=n[e]}),!i){var v=Promise.resolve();return v.cancel=function(){return Object.keys(r).forEach(function(e){return n[e]=p[e]})},v}i=Math.max(i,1);var m=null,g=new Promise(function(e,t){(m=f.add.tween(n).from(r,i,o,s,c,l,d)).onComplete.add(e)});return g.cancel=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];m.stop(),e&&Object.keys(r).forEach(function(e){return n[e]=p[e]})},g}},{key:"shake",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.offSet,i=t.duration,o=t.delay,u=t.repeat,s=void 0===u?0:u;s=0!=s?s:Math.ceil(i/100*.6);var c={x:-a,y:-a},l=e.from({target:r,properties:c,delay:o,repeat:s,yoyo:!0,duration:50}),d=l.cancel;return l.cancel=function(){d&&d(),r.y=r.x=0},l}},{key:"twinkle",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.duration,i=t.delay,o=t.color,u=game.world,s=u.width,c=u.height,l=H({color:o,rect:{width:s,height:c}});r.add(l);var d=e.to({target:l,properties:{alpha:0},delay:i,duration:a}),h=function(){return r.remove(l,!0)};d.then(h);var f=d.cancel;return d.cancel=function(){h(),f()},d}},{key:"curtain",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.duration,i=t.delay,o=game.world,u=o.width,s=o.height,c=H({rect:{width:u/2,height:s}}),l=H({rect:{width:u/2,height:s},x:u/2});r.add(c),r.add(l);var d=e.to({target:c,properties:{x:-u/2},delay:i,duration:a}),h=e.to({target:l,properties:{x:u},delay:i,duration:a}),f=function(){d.cancel(),h.cancel(),r.remove(c,!0),r.remove(l,!0)},p=Promise.all([d,h]);return p.cancel=f,p.then(f),p}},{key:"interlacing",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.duration,i=t.delay,o=game.world,u=o.width,s=o.height,c=s/6,l=function(){var e=H({alpha:0,rect:{width:u,height:s}});return e.addChild(H({rect:{width:u,height:c},y:0})),e.addChild(H({rect:{width:u,height:c},y:2*c})),e.addChild(H({rect:{width:u,height:c},y:4*c})),e},d=l(),h=l();h.y=c,r.add(d),r.add(h);var f=e.to({target:d,properties:{x:-u},delay:i,duration:a}),p=e.to({target:h,properties:{x:u},delay:i,duration:a}),v=function(){f.cancel(),p.cancel(),r.remove(d,!0),r.remove(h,!0)},m=Promise.all([f,p]);return m.cancel=v,m.then(v),m}},{key:"coverblack",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.duration,i=t.delay,o=game.world,u=o.width,s=o.height,c=H({rect:{width:u,height:s},x:-u});r.add(c);var l=e.to({target:c,properties:{x:u},delay:i,duration:a}),d=function(){return r.remove(c,!0)};l.then(d);var h=l.cancel;return l.cancel=function(){d(),h()},l}},{key:"spread",value:function(t){var n=t.target,r=void 0===n?{}:n,a=t.duration,i=t.delay,o=game.world,u=o.centerX,s=o.centerY,c=e.from({target:r,properties:{x:u,y:s},delay:i,duration:a}),l=e.from({target:r.scale,properties:{x:0,y:0},delay:i,duration:a}),d=Promise.all([c,l]);return d.cancel=function(){c.cancel(),l.cancel(),r.x=r.y=0},d}}]),e}(),K={url:"",volume:1},G=[],J=0;J<10;J++)G.push({url:"",volume:1,loop:!1});var Q={url:"",volume:1,loop:!1},Z=[],Y=function(e){if(l.a.useExternalAudioLoader)Y=function(e){var t=e.url,n=e.volume,r=void 0===n?1:n,a=e.channel,i=e.loop,o=void 0!==i&&i,s=e.target,c=e.percent,l=void 0===c?1:c;try{"inherit"===r&&(r=s.volume||1),r=u.c.fixVolume(r),z.play({key:t,volume:r*l,loop:o,channel:a}),s.url=t,s.volume=r,s.loop=o}catch(e){console.error(e)}};else{var t=game.add;Y=function(e){var n=e.url,r=e.volume,a=void 0===r?1:r,i=e.loop,o=void 0!==i&&i,s=e.target,c=e.percent,l=void 0===c?1:c;try{"inherit"===a&&(a=s.volume||1),a=u.c.fixVolume(a);var d=t.sound(n,a*l,o);d.play(),s.url=n,s.volume=a,s.audio=d,s.loop=o,ae.externalProhibitVolume&&(ae.updateMusicVolume(0,!0),ae.updateSoundsVolume(0,!0))}catch(e){console.error(e)}}}Y(e)},X=function(e){var t=l.a.useExternalAudioLoader;(X=t?function(e){var t=e.channel,n=e.target;z.stop(t),n.url=""}:function(e){var t=e.target,n=t.audio;n&&n.destroy(),t.audio=null,t.url=""})(e)},ee=function(e){var t=l.a.useExternalAudioLoader;(ee=t?function(e){var t=e.channel,n=e.target,r=e.volume,a=void 0===r?1:r,i=e.percent,o=void 0===i?1:i;a=u.c.fixVolume(a),z.setVolume({channel:t,volume:a*o}),n.volume=a}:function(e){var t=e.target,n=e.volume,r=void 0===n?1:n,a=e.percent,i=void 0===a?1:a;r=u.c.fixVolume(r);var o=t.audio;o&&(o.volume=r*i),t.volume=r})(e)},te=function(e){if(l.a.useExternalAudioLoader)te=function(e){return z.free(e)};else{var t=game.cache;te=function(e){if(t.checkSoundKey(e)){/blob:/i.test(e)&&URL.revokeObjectURL(e);var n=t.getSound(e);c.free(n.data),t.removeSound(e)}}}te(e)},ne=function(e){var t=l.a.useExternalAudioLoader;return(ne=t?function(e){var t=e.volume,n=void 0===t?1:t,r=e.channel,a=e.target,i=e.percent,o=void 0===i?1:i,s=e.duration,c=void 0===s?10:s,l=e.delay,d=void 0===l?0:l;return ae.externalProhibitVolume?Promise.resolve():(n=u.c.fixVolume(n),a.volume=n,z.tweenTo({volume:n*o,channel:r,duration:c,delay:d}))}:function(e){var t=e.volume,n=void 0===t?1:t,r=e.target,a=e.percent,i=void 0===a?1:a,o=e.duration,s=void 0===o?10:o,c=e.delay,l=void 0===c?0:c;if(ae.externalProhibitVolume)return Promise.resolve();n=u.c.fixVolume(n);var d=r.audio;return r.volume=n,q.to({target:d||{volume:0},properties:{volume:n*i},duration:s,delay:l})})(e)},re=function(e){var t=l.a.useExternalAudioLoader;return(re=t?function(e){var t=e.volume,n=void 0===t?1:t,r=e.channel,a=e.percent,i=void 0===a?1:a,o=e.duration,s=void 0===o?10:o,c=e.delay,l=void 0===c?0:c;return ae.externalProhibitVolume?Promise.resolve():(n=u.c.fixVolume(n),z.tweenFrom({volume:n*i,channel:r,duration:s,delay:l}))}:function(e){var t=e.volume,n=void 0===t?1:t,r=e.target,a=e.percent,i=void 0===a?1:a,o=e.duration,s=void 0===o?10:o,c=e.delay,l=void 0===c?0:c;if(ae.externalProhibitVolume)return Promise.resolve();n=u.c.fixVolume(n);var d=r.audio;return q.from({target:d||{volume:0},properties:{volume:n*i},duration:s,delay:l})})(e)},ae=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"inCache",value:function(t){if(l.a.useExternalAudioLoader)e.inCache=function(e){return z.inCache(e)};else{var n=game.cache;e.inCache=function(e){return n.checkSoundKey(e)}}return e.inCache(t)}},{key:"isLoading",value:function(t){if(l.a.useExternalAudioLoader)e.isLoading=function(e){return!!z.isLoading(e)};else{var n=game.load;e.isLoading=function(e){var t=(n.getAsset("audio",e)||{}).file;return t&&t.loading&&!t.loaded&&!t.error}}return e.isLoading(t)}},{key:"load",value:function(t,n,r){var a=l.a.useExternalAudioLoader,i=l.a.offline;if(a)e.load=function(e,t,n){return z.load(e,t,i)};else{var o=game.load;e.load=function(e,t,n){return o.audio(e,t,!0,n)}}e.load(t,n,r)}},{key:"playMusic",value:function(e){var t=e.url,n=void 0===t?"":t,r=e.volume,a=void 0===r?1:r;"inherit"!==n?(K.url&&X({channel:"music",target:K}),Y({url:n,volume:a,percent:$.musicVolume,channel:"music",target:K,loop:!0})):this.setMusicVolume(a)}},{key:"stopMusic",value:function(){X({channel:"music",target:K})}},{key:"setMusicVolume",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e.externalProhibitVolume||ee({channel:"music",target:K,volume:t,percent:$.musicVolume})}},{key:"updateMusicVolume",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])ee({channel:"music",target:K,volume:t,percent:$.musicVolume});else{if($.musicVolume=t,!1!==e.externalProhibitVolume)return;ee({channel:"music",target:K,volume:K.volume,percent:$.musicVolume})}}},{key:"tweenToWithMusic",value:function(e){var t=e.volume,n=void 0===t?1:t,r=e.duration,a=void 0===r?10:r,i=e.delay;return ne({volume:n,channel:"music",target:K,duration:a,delay:void 0===i?0:i,percent:$.musicVolume})}},{key:"tweenFromWithMusic",value:function(e){var t=e.volume,n=void 0===t?1:t,r=e.duration,a=void 0===r?10:r,i=e.delay;return re({volume:n,channel:"music",target:K,duration:a,delay:void 0===i?0:i,percent:$.musicVolume})}},{key:"playSound",value:function(e){var t=e.url,n=void 0===t?"":t,r=e.volume,a=void 0===r?1:r,i=e.channel,o=void 0===i?0:i,u=e.loop;"inherit"!==n?(G[o].url&&X({channel:"sound".concat(o),target:G[o]}),Y({url:n,volume:a,percent:$.soundVolume,channel:"sound".concat(o),target:G[o],loop:u})):this.setSoundVolume({volume:a,channel:o})}},{key:"stopSound",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;G[e]&&X({channel:"sound".concat(e),target:G[e]})}},{key:"stopAllSound",value:function(){for(var e=0;e<G.length;e++)X({channel:"sound".concat(e),target:G[e]})}},{key:"setSoundVolume",value:function(t){var n=t.volume,r=void 0===n?1:n,a=t.channel,i=void 0===a?0:a;e.externalProhibitVolume||ee({channel:"sound".concat(i),target:G[i],volume:r,percent:$.soundVolume})}},{key:"updateSoundsVolume",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])G.forEach(function(e,n){return e.url&&ee({channel:"sound".concat(n),target:e,volume:t,percent:$.soundVolume})});else{if($.soundVolume=t,!1!==e.externalProhibitVolume)return;G.forEach(function(e,t){return e.url&&ee({channel:"sound".concat(t),target:e,volume:e.volume,percent:$.soundVolume})})}}},{key:"tweenToWithSound",value:function(t){var n=t.volume,r=void 0===n?1:n,a=t.duration,i=void 0===a?10:a,o=t.delay,u=void 0===o?0:o,s=t.channel,c=void 0===s?0:s;if(!e.externalProhibitVolume)return ne({volume:r,channel:"sound".concat(c),target:G[c],duration:i,delay:u,percent:$.soundVolume})}},{key:"tweenFromWithSound",value:function(t){var n=t.volume,r=void 0===n?1:n,a=t.duration,i=void 0===a?10:a,o=t.delay,u=void 0===o?0:o,s=t.channel,c=void 0===s?0:s;if(!e.externalProhibitVolume)return re({volume:r,channel:"sound".concat(c),target:G[c],duration:i,delay:u,percent:$.soundVolume})}},{key:"playButtonSound",value:function(){var e=Q.audio,t=Q.volume,n=$.buttonSoundUrl,r=$.soundVolume;e?e.play():n&&Y({url:n,channel:"button-sound",target:Q,volume:t,percent:r})}},{key:"play",value:function(t){var n,r=t.url,a=t.volume,i=void 0===a?1:a,o=t.loop,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s={url:r,volume:i};~(n=Z.findIndex(function(e){return e.url===r&&e.volume===i}))?s=Z[n]:Z.push(s),Y({url:r,volume:e.externalProhibitVolume&&u?0:i,percent:$.soundVolume,channel:"temp-sound",target:s,loop:o})}},{key:"stop",value:function(e){var t,n=e.url,r=e.volume,a=void 0===r?1:r,i=null;~(t=Z.findIndex(function(e){return e.url===n&&e.volume===a}))&&(i=Z[t],Z.splice(t,1),X({channel:"temp-sound",target:i}))}},{key:"free",value:function(e){te(e);for(var t=0;Z.length>t;){var n=Z[t];n.url!==e?t++:(n.audio&&n.audio.destroy(),n.audio=null,Z.splice(t,1))}}},{key:"getUsingUrls",value:function(){var e=[];return K.url&&e.push(K.url),Q.url&&e.push(Q.url),G.forEach(function(t){var n=t.url;return n&&e.push(n)}),Z.forEach(function(t){var n=t.url;return n&&e.push(n)}),e}},{key:"music",get:function(){return{url:K.url,volume:K.volume}}},{key:"sounds",get:function(){return G.map(function(e,t){return{url:e.url,volume:e.volume,loop:e.loop,index:t}})}}]),e}(),ie=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=K.audio;t&&(e?t.play():t.pause()),G.forEach(function(t){var n=t.audio;n&&(e?n.resume():n.pause())})};function oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ue(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?oe(e):t}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ce(e,t,n){return(ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=se(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function de(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&le(e,t)}D.setCallback("resumeAudio",function(){return ie(!0)}),D.setCallback("pauseAudio",function(){return ie()}),D.setCallback("audioCanPlay",function(e){return z.loadedCallBack(e)}),D.setCallback("audioError",function(e){return z.faultCallBack(e)}),ae.externalProhibitVolume=!1;n(65),n(84),n(42),n(130);var he=function(){function e(){}return e.generate=function(){var t=e._getRandomInt,n=e._hexAligner;return n(t(32),8)+"-"+n(t(16),4)+"-"+n(16384|t(12),4)+"-"+n(32768|t(14),4)+"-"+n(t(48),12)},e._getRandomInt=function(e){if(e<0||e>53)return NaN;var t=0|1073741824*Math.random();return e>30?t+1073741824*(0|Math.random()*(1<<e-30)):t>>>30-e},e._hexAligner=function(e,t){for(var n=e.toString(16),r=t-n.length,a="0";r>0;r>>>=1,a+=a)1&r&&(n=a+n);return n},e.generate}(),fe=function(e,t,n,r){e&&!r[e]&&(n.push({url:e,type:t}),r[e]=t)},pe=[{uuid:he(),key:"coinTotal",init:{type:"system",value:0}},{uuid:he(),key:"starTotal",init:{type:"system",value:0}},{uuid:he(),key:"timestamp",init:{type:"system",value:-1}},{uuid:he(),key:"year",init:{type:"system",value:-1}},{uuid:he(),key:"month",init:{type:"system",value:-1}},{uuid:he(),key:"day",init:{type:"system",value:-1}},{uuid:he(),key:"hour",init:{type:"system",value:-1}},{uuid:he(),key:"minute",init:{type:"system",value:-1}},{uuid:he(),key:"second",init:{type:"system",value:-1}},{uuid:he(),key:"contribution",init:{type:"system",value:0}},{uuid:he(),key:"week",init:{type:"system",value:-1}}],ve=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"getAssets",value:function(e){var t={},n=[],r=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return fe(e,r,n,t)},a=e.cover||{},i=a.music,o=a.background;return i&&r(i.url,"audio"),o&&r(o.url),n}},{key:"getViewAssets",value:function(e){var t={},n=[],r=e.motionImgMap,a=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";if(u.c.isObject(e)){if(!r||!e.uuid||!r[e.uuid])return;r[e.uuid].images.forEach(function(e){var r=e.url;return fe(r,a,n,t)})}else e&&u.c.isString(e)&&"inherit"!==e&&fe(e,a,n,t)},i=e.viewMap,o=e.views,s=function(e){Array.isArray(e)&&e.forEach(function(e){return e.events.forEach(function(e){if(e){var t=e.type,n=e.handle;"playMusic"===t&&n.music?a(n.music.url,"audio"):"playSound"===t&&n.sounds&&n.sounds.forEach(function(e){return e&&"inherit"!=e.url&&a(e.url,"audio")})}})})},c=function(e){var t=e.type,n=e.events,r=e.content,i=void 0===r?{}:r,o=e.children,u=void 0===o?[]:o;if(s(n),u.forEach(function(e){var t=e.events;return s(t)}),"timer"!==t){var c=i.background,l=i.sound;c&&(a(c.url),c.normal&&a(c.normal.url),c.active&&a(c.active.url),c.progress&&a(c.progress.url),l&&a(l.url,"audio"))}};return Object.keys(i).forEach(function(e){return c(i[e])}),o.forEach(function(e){return c(e)}),n}},{key:"getFirstChapter",value:function(e){return function e(t){for(var n=t.length,r=0;r<n;r++){var a=t[r],i=a.plots,o=void 0===i?[]:i,u=a.md5;if(o.length||u)return a;if(a.subchapters.length){var s=e(a.subchapters);if(s)return s}}}(e.chapters)}},{key:"getChapterByUUID",value:function(t,n){var r={};return t.chapters.forEach(function e(t){r[t.uuid]=t,(t.subchapters||[]).forEach(e)}),e.getChapterByUUID=function(e,t){return r[t]},e.getChapterByUUID(t,n)}},{key:"fix",value:function(e){return e.systemValues=e.systemValues||[],e.systemValues=pe.map(function(t,n){return e.systemValues[n]?Object.assign({},t,e.systemValues[n]):t}),e.indexValues=e.indexValues||[],e}},{key:"getJumpAndInsertChapterUuids",value:function(e){var t={},n=function e(n){for(var r=0,a=n.length;r<a;r++){var i=n[r],o=i.type,u=i.args;if("insert"===o||"jump"===o)t[u[0]]=o;else if("options"===o||"conditionOptions"===o)for(var s=0,c=u.length;s<c;s++)e(u[s].commands)}};return function e(r){for(var a=0,i=r.length;a<i;a++){var o=r[a],u=o.jump,s=o.insert,c=o.commands,l=o.options,d=void 0===l?[]:l,h=o.condition_options,f=void 0===h?[]:h;if(c)n(c);else{u&&(t[u]="jump"),s&&(t[s]="insert");for(var p=0,v=d.length;p<v;p++)e(d[p].plots);for(var m=0,g=f.length;m<g;m++)e(f[m].plots)}}}(e.plots),Object.keys(t)}}]),e}(),me=n(10),ge=n.n(me),ye=n(131),_e=n.n(ye),we=n(7),be=(n(82),function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"strip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return+parseFloat(e.toPrecision(t))}},{key:"digitLength",value:function(e){var t=e.toString().split(/[eE]/),n=(t[0].split(".")[1]||"").length-+(t[1]||0);return n>0?n:0}},{key:"float2Fixed",value:function(t){if(-1===t.toString().indexOf("e"))return Number(t.toString().replace(".",""));var n=e.digitLength(t);return n>0?e.strip(t*Math.pow(10,n)):t}},{key:"limitRange",value:function(e){return e>99999999999999?99999999999999:e<-99999999999999?-99999999999999:e}},{key:"mul",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(a.length>0)return mul.apply(void 0,[mul(t,n),a[0]].concat(Object(k.a)(a.slice(1))));var o=e.float2Fixed(t),u=e.float2Fixed(n),s=e.digitLength(t)+e.digitLength(n),c=o*u/Math.pow(10,s);return e.limitRange(c)})},{key:"add",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(a.length>0)return add.apply(void 0,[add(t,n),a[0]].concat(Object(k.a)(a.slice(1))));var o=Math.pow(10,Math.max(e.digitLength(t),e.digitLength(n))),u=(e.mul(t,o)+e.mul(n,o))/o;return e.limitRange(u)})},{key:"sub",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(a.length>0)return sub.apply(void 0,[sub(t,n),a[0]].concat(Object(k.a)(a.slice(1))));var o=Math.pow(10,Math.max(e.digitLength(t),e.digitLength(n))),u=(e.mul(t,o)-e.mul(n,o))/o;return e.limitRange(u)})},{key:"div",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(a.length>0)return div.apply(void 0,[div(t,n),a[0]].concat(Object(k.a)(a.slice(1))));var o=e.float2Fixed(t),u=e.float2Fixed(n),s=e.mul(o/u,Math.pow(10,e.digitLength(n)-e.digitLength(t)));return e.limitRange(s)})},{key:"mod",value:function(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=e.float2Fixed(r),o=e.float2Fixed(a);t=e.digitLength(r),n=e.digitLength(a);var u=Math.pow(10,Math.abs(t-n));return t>n&&(o*=u),t<n&&(i*=u),i%o/Math.pow(10,Math.max(t,n))}},{key:"round",value:function(t,n){var r=Math.pow(10,n);return e.div(Math.round(e.mul(t,r)),r)}},{key:"toFixed",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=0,a=e.float2Fixed(t);r=e.digitLength(t);var i=a.toString();return r>n&&n>=0&&(i=i.slice(0,n-r),r=n,i=""===i||"-"===i?"0":i),parseInt(i)/Math.pow(10,r)}}]),e}()),ke=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"safeEval",value:function(t,n){function r(t,n){var r=n.find(function(e){return e.uuid===t.arg1})||{value:0};return void 0!==r.value?u.b.toN(r.value):e.safeInitValue(r)}try{return function t(n,a){var i,o,s;switch(n.type){case"arg1":return t(n.arg1,a);case"+":return i=t(n.arg1,a),o=t(n.arg2,a),u.b.is(i)&&u.b.is(o)?be.toFixed(be.add(i,o)):("#"+i+o).slice(1);case"-":return i=t(n.arg1,a),o=t(n.arg2,a),u.b.is(i)&&u.b.is(o)?be.toFixed(be.sub(i,o)):(i+"").split(o+"").join("");case"*":return be.toFixed(be.mul(t(n.arg1,a),t(n.arg2,a)));case"/":return 0===o?(A.a.error("求余除数不能为 0"),0):be.toFixed(be.div(t(n.arg1,a),t(n.arg2,a)));case"%":return i=parseInt(t(n.arg1,a)),0===(o=parseInt(t(n.arg2,a)))?(A.a.error("求余除数不能为 0"),0):be.toFixed(be.mod(i,o));case"==":return t(n.arg1,a)===t(n.arg2,a);case"!=":return t(n.arg1,a)!==t(n.arg2,a);case">":return t(n.arg1,a)>t(n.arg2,a);case"<":return t(n.arg1,a)<t(n.arg2,a);case">=":return t(n.arg1,a)>=t(n.arg2,a);case"<=":return t(n.arg1,a)<=t(n.arg2,a);case"min":return Math.min.apply(null,n.args.map(function(e){return t(e,a)}));case"max":return Math.max.apply(null,n.args.map(function(e){return t(e,a)}));case"all":return n.args.map(function(e){return t(e,a)}).every(function(e){return e});case"any":return n.args.map(function(e){return t(e,a)}).some(function(e){return e});case"literal":return u.b.toN(n.value);case"int":return u.b.toInt(t(n.arg1,a));case"random":var c=u.c.isObject(n.range[0])?t(n.range[0],a):u.b.toInt(n.range[0]),l=u.c.isObject(n.range[1])?t(n.range[1],a):u.b.toInt(n.range[1]);return c=Math.min(c,l),l=Math.max(c,l),parseInt(Math.random()*(l-c+1)+c);case"value":case"payValue":case"savedValue":case"indexValue":case"systemValue":return r(n,a["".concat(n.type,"s")]);case"reference":var d=(void 0!==(s=a.indexValues.find(function(e){return e.uuid===n.arg1})).value?u.b.toN(s.value):e.safeInitValue(s))-1,h=s.init.type+"s";return void 0===a[h][d]?(A.a.info("出现未知数值操作，请联系作者检查修改"),"[未知数值]"):"stringValues"===h?void 0!==a[h][d].value?a[h][d].value+"":e.safeInitValue(a[h][d]):be.toFixed(r({arg1:a[h][d].uuid},a[h]),2);case"string":return n.value+"";case"stringValue":return void 0!==(s=a.stringValues.find(function(e){return e.uuid===n.arg1})).value?s.value+"":e.safeInitValue(s);case"contain":return i=t(n.arg1,a),o=t(n.arg2,a),(i+"").indexOf(o+"")>-1;case"stringLength":return(i=t(n.arg1,a))?i.length:0;case"average":if(0===n.args.length)return A.a.error("除数不能为 0"),0;var f=0;return n.args.map(function(e){return f+=t(e,a)}),be.toFixed(be.div(f,n.args.length));default:throw new Error("expr type  is  error")}}(t,n)}catch(e){return console.error(e),NaN}}},{key:"safeInitValue",value:function(e){try{return function(e){if(e.init||console.log(1),"const"===e.init.type)return e.init.value;if("system"===e.init.type)return function(e){var t,n=new Date(1e3*u.a.getDate()+Date.now()%1e3);switch(e.key){case"coinTotal":case"starTotal":return u.b.toInt(e.init.value);case"timestamp":return null!==n?u.b.toInt(n.getTime()/1e3):e.init.value;case"year":return null!==n?n.getFullYear():e.init.value;case"month":return null!==n?n.getMonth()+1:e.init.value;case"day":return null!==n?n.getDate():e.init.value;case"hour":return null!==n?n.getHours():e.init.value;case"minute":return null!==n?n.getMinutes():e.init.value;case"second":return null!==n?n.getSeconds():e.init.value;case"week":return null!==n?0===(t=n.getDay())?7:t:e.init.value;case"contribution":default:return e.init.value}}(e);if("random"===e.init.type){var t=Number(e.init.range[0]),n=Number(e.init.range[1]);return parseInt(Math.random()*(n-t+1)+t)}return"string"===e.init.type?e.init.value+"":["value","savedValue","stringValue","payValue"].includes(e.init.type)?e.init.value:(console.error("unknown init type"),0)}(e)}catch(e){return console.error(e),0}}},{key:"parseValue",value:function(t,n){var r=/([\s\S]*)&(s|v|sv|p|x|i|iv)\[(\d+)\]([\s\S]*)/,a=function(t){return void 0===t.value?e.safeInitValue(t):t.value},i=function(e){for(var t=r.exec(e),i=e;t;){var o=t[2],u=parseInt(t[3]),s="[未知数值]";if("s"===o&&n.savedValues[u])s=be.toFixed(a(n.savedValues[u]));else if("v"===o&&n.values[u])s=be.toFixed(a(n.values[u]));else if("sv"===o&&n.stringValues[u])s=a(n.stringValues[u])+"";else if("p"===o&&n.payValues[u])s=be.toFixed(a(n.payValues[u]));else if("x"===o&&n.systemValues[u])s=be.toFixed(a(n.systemValues[u]));else if("i"===o&&n.indexValues[u])s=a(n.indexValues[u]);else if("iv"===o&&n.indexValues[u]){var c=a(n.indexValues[u]),l=n.indexValues[u].init.type,d=n[l+"s"][c-1];void 0!==d&&(s="stringValue"!==l?be.toFixed(a(d)):a(d))}i=t[1]+s+t[4],t=r.exec(i)}return i};return Array.isArray(t)?S()(t,{$apply:function(e){return e.map(function(e){return S()(e,{data:{$set:i(e.data)}})})}}):i(t)}},{key:"parseWaitTime",value:function(e){for(var t=/([\s\S]*)\\(\d+)\s([\s\S]*)/,n=t.exec(e);n;)e=n[1]+n[3],n=t.exec(e);return e}},{key:"setContextByValueHandles",value:function(t,n){return n.forEach(function(n){var r,a=e.safeEval(n.expression,t),i=n.uuid,o=n.reference;if(-1!==(r=t.values.findIndex(function(e){return e.uuid===i})))t=S()(t,{values:P({},r,{value:{$set:a}})});else if(-1!==(r=t.savedValues.findIndex(function(e){return e.uuid===i})))t=S()(t,{savedValues:P({},r,{value:{$set:a}})});else if(-1!==(r=t.payValues.findIndex(function(e){return e.uuid===i})))t=S()(t,{payValues:P({},r,{value:{$set:a}})});else if(-1!==(r=t.stringValues.findIndex(function(e){return e.uuid===i}))){var s=u.b.is(a)?be.toFixed(a):a;t=S()(t,{stringValues:P({},r,{value:{$set:s}})})}else if(-1!==(r=t.indexValues.findIndex(function(e){return e.uuid===i}))){var c=t.indexValues[r].init.type+"s",l=(o?t.indexValues[r].value:a)-1,d=!1;void 0===t[c][l]&&(d=!0,A.a.info("出现未知数值操作，请联系作者检查修改")),o?!d&&(t=S()(t,P({},c,P({},l,{value:{$set:a}})))):t=S()(t,{indexValues:P({},r,{value:{$set:a}})})}else console.error("Cannot find value/savedValue with uuid = ",i)}),t}}]),e}(),xe=/([\s\S]*)\\(\d+)\s([\s\S]*)/,Pe=function e(t,n,r){var a=n.viewMap;return t.map(function(t){return function(t){var i=t.ref,o=t.instanceUuid,s=t.scale,c=t.x,l=t.y,d=t.children,h=t.values,f=void 0===h?{}:h,p=t.currentCount,v=a[i];if(!v)return null;var m=v,g=m.content,y=m.type;(d=e(d,n,r)).forEach(function(e){var t=v.children.findIndex(function(t){return t.instanceUuid===e.instanceUuid});~t&&(e.events=v.children[t].events)});var _=function(e){var t=e.type,n=e.arg1,a=e.value;return"literal"!==t?void 0!==f[n]?f[n]:ke.safeEval({type:t,arg1:n},r):a},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u.c.isObject(e)?void 0===e.value?S()(c,{value:{$set:_(e)}}):e:{type:"literal",value:e}};if("text"===y){var b=g,k=b.value,x=b.color;Array.isArray(k)||(k=u.c.toArrayForData(k).map(function(e){return O({},e,{color:x})}));for(var C=0;C<k.length;C++){var E=k[C],I=E.data;E.placeholder&&!xe.test(I)&&(k=S()(k,P({},C,{data:{$set:void 0!==f[I]?f[I]:ke.parseValue(I,r)}})))}g=S()(g,{value:{$set:k}})}else if("bar"===y){var A=g.value,M=A.normal,T=A.progress;g=S()(g,{value:{normal:{width:{value:{$set:_(M.width)}},height:{value:{$set:_(M.height)}}},progress:{width:{value:{$set:_(T.width)}},height:{value:{$set:_(T.height)}}}}})}else"input"===y&&(g=S()(g,{value:{value:{$set:_(g.value)}}}));return v=S()(v,{content:{$set:g},children:{$set:d}}),c=w(c),l=w(l),{ref:i,instanceUuid:o||"lv_".concat(he()),scale:s,x:c,y:l,calledViews:[],events:[],view:v,currentCount:p}}(t)}).filter(function(e){return e})},Ce=function e(t,n){return t.map(function(t){var r=t.ref,a=t.instanceUuid,i=t.scale,o=t.x,s=t.y,c=t.view,l=t.calledViews,d=t.currentCount,h=n.viewMap[r].content,f=h.value,p=h.color,v=c.children,m=c.type,g=c.content,y=g.value,_={},w=function(e){return"literal"!==e.type?_[e.arg1]=e.value:void 0};if(w(o),w(s),"text"===m){Array.isArray(f)||(f=u.c.toArrayForData(f).map(function(e){return O({},e,{color:p})}));for(var b=0;b<f.length;b++){var x=f[b],P=x.data;x.placeholder&&!xe.test(P)&&(_[P]=y[b].data)}}else if("bar"===c.type){var C=g.value,S=C.normal,E=C.progress;w(S.width),w(S.height),w(E.width),w(E.height)}else"input"===c.type&&w(g.value);return{ref:r,instanceUuid:a,scale:i,x:o,y:s,children:v=e([].concat(Object(k.a)(v),Object(k.a)(l)),n),values:_,currentCount:d}})},Se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return u.c.arrayBufferToBase64(u.c.stringToArrayBuff(u.c.comPressZlib(e)))},Oe=function(e){return u.c.isObject(e)||null==e?e:JSON.parse(u.c.uncomPressZlib(u.c.base64ToArrayBuffer(e)))},Ee=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"totransDatabyBubble",value:function(e){var t=[];return e.forEach(function(e){var n=e.bubble,r={bubble:[],currentCount:e.currentCount,index:e.index,show:e.show,uuid:e.uuid,remove:e.remove,rect:e.rect,scale:e.scale};n&&n.forEach(function(e){var t=e.avatar,n=e.content,a=e.role,i=e.type,o=e.position,u=[];if("image"==i)u=[n.url,n.view,n.viewMode];else if("text"==i){var s="center"==o?"#dadada":"right"==o?"#98e165":"#ffffff";u=[n.data,n.background?n.background:{color:s},n.font_size]}r.bubble.push([i,o,[t.rect.x,t.rect.y,t.rect.width,t.rect.height,t.url,t.hidden,t.view],[a.rect.x,a.rect.y,a.rect.width,a.rect.height,a.data,a.font_size,a.color,a.hidden],[n.rect.x,n.rect.y,n.rect.width,n.rect.height,n.opacity||1].concat(u)])}),t.push(r)}),t}},{key:"recoveryDatabyBubble",value:function(e){var t=[];return e.length>0&&void 0!==e.find(function(e){return e.bubble.find(function(e){return void 0!==e.type})})?e:(e&&e.forEach(function(e){var n=e.bubble,r={bubble:[],currentCount:e.currentCount,index:e.index,show:e.show,uuid:e.uuid,remove:e.remove,rect:e.rect,scale:e.scale};n&&n.forEach(function(e){var t={};t.type=e[0],t.position=e[1],t.avatar={rect:{x:e[2][0],y:e[2][1],width:e[2][2],height:e[2][3]},url:e[2][4],hidden:e[2][5]||!1,view:e[2][6]},t.role={rect:{x:e[3][0],y:e[3][1],width:e[3][2],height:e[3][3]},data:e[3][4],font_size:e[3][5],color:e[3][6],hidden:e[3][7]||!1},t.content={rect:{x:e[4][0],y:e[4][1],width:e[4][2],height:e[4][3]},opacity:e[4][4]||1},"image"==e[0]?(t.content.url=e[4][5],t.content.view=e[4][6],t.content.viewMode=e[4][7]):"text"==e[0]&&(t.content.data=e[4][5],t.content.background=e[4][6],t.content.font_size=e[4][7]),r.bubble.push(t)}),t.push(r)}),t)}},{key:"getChapterUuids",value:function(e){var t=[],n=e.historyCommand,r=e.context,a=e.chapterUuid,i=e.inserts;return t.push(a),n?i.forEach(function(e){var n=e.chapterUuid;return t.push(n)}):r?(r.stack||[]).forEach(function(e){return"insert"===e.type&&t.push(e.chapterUuid)}):i.forEach(function(e){var n=e.chapterUuid;return t.push(n)}),t}},{key:"to",value:function(t){var n=t.context,r=t.playContext,a=t.viewContext,i=t.plotSnap,o=t.background,u=t.game,s=t.commandState,c=r.playback,l=r.values,d=r.savedValues,h=r.stringValues,f=r.indexValues,p=r.stack,v=n.commands,m=n.plots,g=n.plotIndex,y=n.chapter,_=n.cmdIndex,w=function(e){var t=e.uuid,n=e.value;return[t,void 0===n?ke.safeInitValue(e):n]},b=[],x={},P=function(t){var n=function(e){return e?e.uuid?e.uuid:e:void 0},r=t.images,a=t.dialog,i=t.weather,o=t.autotext,s=t.disableSaveOrLoad,c=t.animateScene,l=t.views,d=t.hideGlobalViews,h=t.plotViews,f=t.calledViews,p=t.bubbleMode,v=void 0===p?[]:p,m=t.bubbleCount,g=void 0===m?[]:m;return{images:r.map(function(e,t){if(e){var r=e.command,a=e.animate;return{commandUuid:n(r),animateUuid:n(a)}}}).filter(function(e){return e}),dialog:{commandUuid:n(a.command),animateUuid:n(a.animate)},weather:n(i),autotext:n(o),disableSaveOrLoad:n(s),animateScene:{shake:n(c)},views:l.map(function(e){return{commandUuid:e.uuid,instanceUuid:e.args[0].instanceUuid}}),hideGlobalViews:d||[],viewsData:Se(JSON.stringify(Ce([].concat(Object(k.a)(h),Object(k.a)(f)),u))),bubbleMode:e.totransDatabyBubble(v).concat(),bubbleCount:g.concat()}},C=function(){var t=r.bubbleMode,n=r.bubbleCount;return{bubbleMode:e.totransDatabyBubble(t).concat(),bubbleCount:n.concat()}};!function e(t){for(var n=t.length-1;n>=0;n--){var r=t[n],a=r.commands,i=r.plots,o=r.plotIndex,u=r.chapter,s=r.cmdIndex,c=r.type,l=r.loop,d=r.commandState;if(l){var h=l.breakNext,f=h.commands,p=h.plots,v=h.plotIndex,m=h.cmdIndex,g=l.count,y=f?f[m-1].uuid:p[v-1].uuid;x["cl_".concat(y)]={value:g}}else if("insertPlot"===c){var _={chapterUuid:u.uuid,plotUuid:i[o].uuid};a?(_.commandUuid=a[s-1].uuid,_.historyCommand=P(d),e(d.playStack)):_.historyCommand=C(),b.push(_)}}}(p);var S=c.length,E={values:l.map(w),savedValues:d.map(w),stringValues:h.map(w),indexValues:f.map(w)};return{inserts:b,countLoop:x,chapterUuid:y.uuid,plotUuid:m[g].uuid,commandUuid:v&&v[_]?v[_].uuid:void 0,speakings:Se(JSON.stringify(Object(k.a)(c.slice(S-100,S)))),thumb:i,values:Se(JSON.stringify(E)),viewsData:Se(JSON.stringify(Ce([].concat(Object(k.a)(a.plotViews),Object(k.a)(a.calledViews)),u))),globalViewsData:Se(JSON.stringify(Ce([].concat(Object(k.a)(a.globalViews),Object(k.a)(a.globalCalledViews)),u))),historyCommand:Se(JSON.stringify(s?P(s):C())),musics:[ae.music],sounds:ae.sounds.map(function(e,t){return e&&e.url?O({},e,{index:t}):null}).filter(function(e){return e}),backgroundObject:O({},o),timestamp:Date.now(),type:"h5"}}},{key:"restore",value:function(t,n,r){for(var i,o=t.countLoop,s=t.inserts,c=[],l=[],d=[],h=function e(t){for(var n=t.chapter,r=t.plots,a=t.plotIndex,i=t.commands,u=t.plotUuid,s=t.commandUuid,c=t.commandMap,l=t.playStack,d=0,h=i.length;d<h;d++){var f=i[d],p=f.type,v=f.uuid,m=f.args;if(v===s)return l.unshift({chapter:n,plots:r,plotIndex:a,commands:i,cmdIndex:d}),!0;if(null===c[v]&&(c[v]=i[d]),"options"===p)for(var g=0,y=m.length;g<y;g++){var _=m[g];if(_.commands.length){if(l.unshift({chapter:n,plots:r,plotIndex:a,commands:i,cmdIndex:d+1,type:"option"}),e({chapter:n,plots:r,plotIndex:a,plotUuid:u,commands:_.commands,commandUuid:s,commandMap:c,playStack:l}))return!0;l.shift()}}else if("conditionOptions"===p)for(var w=0,b=m.length;w<b;w++){var k=m[w];if(k.commands.length){var x={chapter:n,plots:r,plotIndex:a,commands:i,cmdIndex:d+1};if("loop"===k.type||"countLoop"===k.type){var P={count:o["cl_".concat(v)]?o["cl_".concat(v)].value:1,countExpr:k.count,condition:k.expression,breakNext:x};x={chapter:n,plots:r,plotIndex:a,commands:k.commands,cmdIndex:0,loop:P}}if(l.unshift(O({},x,{type:"condition_option"})),e({chapter:n,plots:r,plotIndex:a,plotUuid:u,commands:k.commands,commandUuid:s,commandMap:c,playStack:l}))return!0;l.shift()}}}},f=function(e,t){var n=t.findIndex(function(t){return t.instanceUuid===e.instanceUuid});~n&&(e.events=t[n].events)},p=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.filter(function(e){if(!e.instanceUuid)return!0;var r=e.instanceUuid.indexOf("lv_");return(~r||-1==r)&&t[e.instanceUuid]||~r||-1==r&&!n})},v=[].concat(Object(k.a)(s),[t]),m=function(a){var s=v[a],m={},g=s.chapterUuid,y=s.plotUuid,_=s.commandUuid;s.historyCommand&&s.historyCommand.viewsData&&u.c.isString(s.historyCommand.viewsData)&&(s.historyCommand.viewsData=Oe(s.historyCommand.viewsData));var w=Oe(s.historyCommand)||{},b=w.images,k=void 0===b?[]:b,x=w.dialog,P=void 0===x?{}:x,C=w.views,S=void 0===C?[]:C,E=w.weather,I=w.autotext,M=w.disableSaveOrLoad,T=w.animateScene,V=void 0===T?{}:T,j=w.viewsData,U=void 0===j?[]:j,D=w.hideGlobalViews,R=void 0===D?[]:D,B=w.bubbleMode,L=void 0===B?[]:B,F=w.bubbleCount,z=void 0===F?[]:F;k.forEach(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.commandUuid,n=e.animateUuid;return m[t]=m[n]=null}),S.forEach(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).commandUuid;return m[e]=null});var W=P||{},N=W.commandUuid,$=W.animateUuid;N&&(m[N]=null),$&&(m[$]=null);var H=V.shake;H&&(m[H]=null),[E,I,M].forEach(function(e){return e&&(m[e]=null)});var q=ve.getChapterByUUID(n,g);if(!q)return{v:void 0};if(!function e(t){for(var n=t.chapter,r=t.plots,a=t.plotUuid,i=t.commandUuid,u=t.commandMap,s=0,l=r.length;s<l;s++){var d=r[s];if(d.uuid===a){if(d.commands&&i){var f=[],p=h({chapter:n,plots:r,plotIndex:s,commands:d.commands,plotUuid:a,commandUuid:i,commandMap:u,playStack:f});if(p){var v=f.shift();v.commandState={playStack:f},c.unshift(v)}return p}return c.unshift({chapter:n,plots:r,plotIndex:s}),!0}if(d.options&&d.options.length)for(var m=d.options,g=0,y=m.length;g<y;g++)if(m[g].plots.length){if(c.unshift({chapter:n,plots:r,plotIndex:s+1,type:"option"}),e({chapter:n,plots:m[g].plots,plotUuid:a,commandUuid:i,commandMap:u}))return!0;c.shift()}if(d.condition_options&&d.condition_options.length)for(var _=d.condition_options,w=d.uuid,b=0,k=_.length;b<k;b++){var x=_[b];if(x.plots.length){var P={chapter:n,plots:r,plotIndex:s+1};if("loop"===x.type||"countLoop"===x.type){var C={count:o["cl_".concat(w)]?o["cl_".concat(w)].value:1,countExpr:x.count,condition:x.expression,breakNext:P};P={chapter:n,plots:x.plots,plotIndex:0,loop:C}}if(c.unshift(O({},P,{type:"condition_option"})),e({chapter:n,plots:_[b].plots,plotUuid:a,commandUuid:i,commandMap:u}))return!0;c.shift()}}}return!1}({chapter:q,plots:q.plots,plotUuid:y,commandUuid:_,commandMap:m}))return A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),{v:{stack:c,plotViews:l,globalViews:d,context:i}};if(_){var K=c[0].commandState,G=function(e){return u.c.isObject(e)?e:e&&m[e]?m[e]:null},J=[];k.forEach(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.commandUuid,n=e.animateUuid,r=e.command;r=r||G(t);var a=G(n);r&&(J[r.args[0].index]={command:r,animate:a})}),K.images=J;var Q={};K.views=S.map(function(e){var t=e.commandUuid,n=e.instanceUuid,r=G(t);return n&&(Q[n]=!0),r||null}).filter(function(e){return e}),U=p(U,Q,!0),K.dialog={command:P&&P.command||G(N),animate:G($)},K.animateScene=G(H),K.weather=G(E),K.autotext=G(I),K.disableSaveOrLoad=G(M),K.hideGlobalViews=R,K.calledViews=[],K.plotViews=Pe(U,n,r),K.bubbleMode=e.recoveryDatabyBubble(L).concat(),K.bubbleCount=z.concat();var Z=K.views.map(function(e){return e.args[0]});K.plotViews.forEach(function(e){return f(e,Z)})}if(s!==t)return c[0].type="insertPlot",c[0].cmdIndex++,"continue";i=c.shift(),l=Pe(s.viewsData,n,r);var Y={};if(_){var X=i.commandState;S=X.views,R=X.hideGlobalViews,S=S.map(function(e){return e.args[0]})}else{var ee=i,te=ee.plots[ee.plotIndex],ne=te.views;S=void 0===ne?[]:ne;var re=te.hideGlobalViews;R=void 0===re?[]:re}S.forEach(function(e){return Y[e.instanceUuid]=!0}),(l=p(l,Y)).forEach(function(e){return f(e,S)}),_&&(i.commandState.plotViews=l),!_&&(i.bubbleMode=e.recoveryDatabyBubble(L).concat(),i.bubbleCount=z.concat());var ae={};n.views.forEach(function(e){return ae[e.instanceUuid]=!0}),(d=Pe(p(s.globalViewsData,ae),n,r)).forEach(function(e){f(e,n.views),~R.findIndex(function(t){return t===e.instanceUuid})&&(e.visible=!1)})},g=0;g<v.length;g++){var y=m(g);switch(y){case"continue":continue;default:if("object"===a(y))return y.v}}return{stack:c,plotViews:l,globalViews:d,context:i}}},{key:"format",value:function(e,t){var n=function e(t){for(var n=t.commands,r=t.commandUuid,a=t.playStack,i=t.plots,o=t.plotIndex,u=0,s=n.length;u<s;u++){var c=n[u],l=c.type,d=c.uuid,h=c.args;if(d===r)return!0;if("options"===l)for(var f=0,p=h.length;f<p;f++){var v=h[f];if(v.commands.length){if(a.unshift({commands:n,cmdIndex:u+1,plots:i,plotIndex:o}),e({commands:v.commands,commandUuid:r,playStack:a,plots:i,plotIndex:o}))return!0;a.shift()}}else if("conditionOptions"===l)for(var m=0,g=h.length;m<g;m++){var y=h[m];if(y.commands.length){var _={commands:n,cmdIndex:u+1,plots:i,plotIndex:o};if("loop"!==y.type&&"countLoop"!==y.type||(_={commands:y.commands,cmdIndex:0,loop:{breakNext:_},type:"condition_option"}),a.unshift(_),e({commands:y.commands,commandUuid:r,playStack:a,plots:i,plotIndex:o}))return!0;a.shift()}}}},r=function e(t){for(var r=t.plots,a=t.plotUuid,i=t.commandUuid,o=t.playStack,u=0,s=r.length;u<s;u++){var c=r[u];if(c.uuid===a)return i&&c.commands&&n({commands:c.commands,commandUuid:i,playStack:o,plots:r,plotIndex:u}),!0;if(c.options&&c.options.length)for(var l=c.options,d=0,h=l.length;d<h;d++){if(l[d].plots.length){if(o.unshift({plots:r,plotIndex:u+1}),e({plots:l[d].plots,plotUuid:a,commandUuid:i,playStack:o}))return!0;o.shift()}}if(c.condition_options&&c.condition_options.length)for(var f=c.condition_options,p=0,v=f.length;p<v;p++){var m=f[p];if(m.plots.length){var g={plots:r,plotIndex:u+1};if("loop"!==m.type&&"countLoop"!==m.type||(g={plots:m.plots,plotIndex:0,loop:{breakNext:g},type:"condition_option"}),o.unshift(g),e({plots:f[p].plots,plotUuid:a,commandUuid:i,playStack:o}))return!0;o.shift()}}}return!1},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.speakings,r=e.values,a=e.viewsData,i=e.globalViewsData,o=e.historyCommand;t&&(o=e.commandObj&&e.commandObj.historyCommand||null);return u.c.isString(n)&&(e.speakings=Oe(n)),u.c.isString(r)&&(e.values=Oe(r),Object.keys(e.values).forEach(function(t){return e.values[t]=e.values[t].map(function(e){return{uuid:e[0],value:e[1]}})})),u.c.isString(a)&&(e.viewsData=Oe(a)),u.c.isString(i)&&(e.globalViewsData=Oe(i)),u.c.isString(o)&&(t?(e.commandObj.historyCommand=Oe(o),u.c.isString(e.commandObj.historyCommand.viewsData)&&(e.commandObj.historyCommand.viewsData=Oe(e.commandObj.historyCommand.viewsData))):(e.historyCommand=Oe(o),u.c.isString(e.historyCommand.viewsData)&&(e.historyCommand.viewsData=Oe(e.historyCommand.viewsData)))),u.c.isArray(o)&&0==o.length&&(e.historyCommand={bubbleCount:[],bubbleMode:[]}),e};return e&&void 0===e.historyCommand?e.context?function(e){var n=function(e,t){var n=[],r=[];return{viewsData:e.map(function e(a){var i=a.name,o=a.x,u=(a.y,a.scale),s=a.instanceUuid,c=a.currentCount,l=a.generateType,d=a.children,h=a.xInfo,f=a.yInfo,p=a.visible;if(l&&"plotInfo"!==l&&n.push({commandUuid:l,instanceUuid:s}),void 0!==p&&!p&&r.push(s),void 0===h.value){var v=ke.safeEval(h,t);h=S()(h,{value:{$set:isNaN(v)?o||0:v}})}if(void 0===f.value){var m=ke.safeEval(f,t);f=S()(f,{value:{$set:isNaN(m)?o||0:m}})}return{x:h,y:f,scale:u.x,ref:i,instanceUuid:s||"lv_".concat(he()),currentCount:c,children:d.map(e)}}),cmdViews:n}},a=function(e){var t=[];return e.forEach(function(e){var n=e.bubbleMode,r=e.bubble,a=e.curbubble,i=e.ishide,o=(e.iscurrent,!i),u=n.args,s=(n.type,n.uuid),c=u[0],l=c.index,d=c.rect,h=(c.url,c.remove),f=c.scale,p=void 0===f?1:f,v=a.length||0,m={bubble:r.map(function(e){return e.args?e.args[0]:e})||[],currentCount:v,index:l,show:o,uuid:s,remove:h,rect:d,scale:p};t.push(m)}),t},i=function(e){var t=e.bubble,n=void 0===t?[]:t,r=e.bubbleCount,i=void 0===r?[]:r,o=e.cmdUuid,u=e.bk,s=e.bkFlex,c=e.bCmdAutoText,l=e.weatherType,d=e.animateScene,h=e.dialogInfo,f=e.charsAndProps,p={bubbleMode:a(n).concat(),bubbleCount:i.concat(),viewsData:[]};if(o){var v=u?{args:[{index:1,url:u.url,opacity:u.opacity,flex:s}]}:void 0;p.autotext={args:[c]},p.weather={args:[l]},p.animateScene={shake:d&&d.shake&&d.shake.uuid||void 0},p.views=y,p.hideGlobalViews=_,p.dialog={command:h&&h.length?{args:[h[0]]}:void 0};var m=f.map(function(e){if(!e)return e;var t=e.x,n=e.width,r=e.y,a=e.height,i=e.mirrorH,o=e.mirrorV,u=e.index,s=e.opacity,c=e.rotate;return{command:{args:[{url:e.url,x:t-=(n=Math.abs(n))/2,width:n,y:r-=(a=Math.abs(a))/2,height:a,mirrorH:i,mirrorV:o,index:u,opacity:s,rotate:c}]}}});p.images=[void 0,{command:v}].concat(Object(k.a)(m))}return p},o=e.plotUuid,u=e.chapterUuid,s=e.cmdUuid,c=e.bkKey,l=e.bkOpacity,d=e.bkFlex,h=e.playbackData,f=e.plotSnap,p=e.context,v={plotUuid:o,chapterUuid:u,commandUuid:s,backgroundObject:{url:c,flex:d,opacity:l},speakings:h,thumb:f},m=n(e.plotViews,e.context),g=m.viewsData,y=m.cmdViews,_=m.hideViews,w=p.values,b=p.savedValues,x=p.stringValues,P=p.indexValues,C=p.stack,E=p.cmdStack,I=void 0===E?[]:E,M=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return void 0===e.value?S()(e,{value:{$set:ke.safeInitValue(e)}}):e})};v.viewsData=g;var T=n(e.globalViews,e.context);g=T.viewsData,_=T.hideViews,v.globalViewsData=g,v.musics=[e.music],v.sounds=e.sounds.map(function(e){return e?O({},e,{loop:0===e.time}):e}),v.values={values:M(w),savedValues:M(b),stringValues:M(x),indexValues:M(P)},v.historyCommand=i(e),v.inserts=[],v.countLoop={},I=Object(k.a)(I),C=Object(k.a)(C);var V=ve.getChapterByUUID(t,u);if(V){var j=[];if(r({plots:V.plots,plotUuid:o,commandUuid:s,playStack:j})){var U=function e(n){for(var a=n.pop();a;){var o=a,u=o.type,s=o.chapterUuid,c=o.pPlotUuid,l=o.loopCount,d=o.isCommand,h=o.cmdInfo,f=o.cmdIndex,p=o.cmdScreenSnap;if(o.loopCondition){var m=j[0];if(!m||"condition_option"!==m.type){j.shift(),a=n.pop();continue}var g=m.loop.breakNext,y=g.plots,_=g.plotIndex,w=g.commands,b=g.cmdIndex,k=w?w[b-1].uuid:y[_-1].uuid;v.countLoop["cl_".concat(k)]={value:l}}else if("insert"===u){if(n===I)break;var x=ve.getChapterByUUID(t,s);if(!x)return A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),void(v=null);j=[];var P=h&&h.commands[f]&&h.commands[f].uuid;if(!r({plots:x.plots,plotUuid:c,commandUuid:d?P:void 0,playStack:j}))return A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),void(v=null);var C={chapterUuid:s,plotUuid:c,historyCommand:{}};if(d){C.commandUuid=P;var S=Object.assign({},p);S.cmdUuid=P,S.lstDialogInfo=p.dialogInfo,S.animateScene=p.animateScene||{},C.historyCommand=i(S),e(I)}if(v.inserts.push(C),!(a=n.pop()))break;if("insert"===a.type){var O=a,E=O.chapterUuid,M=O.pPlotUuid,T=ve.getChapterByUUID(t,E);if(!T)return A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),void(v=null);if(j=[],!r({plots:T.plots,plotUuid:M,playStack:j}))return A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),void(v=null)}continue}j.shift(),a=n.pop()}};return U(C),v&&U(I),v}A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~")}else A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~")}(e):function(e){var n=e.thumb,a=e.plotUuid,i=e.chapterUuid,o=e.commandObj,u=e.backgroundObject,s=void 0===u?{}:u,c=e.values,l=void 0===c?[]:c,d=e.musics,h=void 0===d?[]:d,f=e.sounds,p=void 0===f?[]:f,v=e.speakings,m=void 0===v?[]:v,g=e.inserts,y=void 0===g?[]:g,_=e.commandInserts,w=void 0===_?[]:_,b=e.viewsData,x=void 0===b?[]:b,P=e.globalViewsData,C=void 0===P?[]:P,O=e.cmdStack,E=void 0===O?[]:O,I=e.stack,M=void 0===I?[]:I,T={},V={},j={plotUuid:a,chapterUuid:i,backgroundObject:s,speakings:m,thumb:n,values:l=function(e){var n=[],r=[],a=[],i=[],o=function(e,t,n){var r=n.length;return t.forEach(function(t){return t.uuid===e.key?n.push(S()(t,{value:{$set:e.value}})):void 0}),n.length>r},u=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return void 0===e.value?S()(e,{value:{$set:ke.safeInitValue(e)}}):e})};return e.forEach(function(e,u){(e.key||"").startsWith("cl_")&&(T[e.key]=e.value),o(e,t.values,n)||o(e,t.savedValues,r)||o(e,t.stringValues,a)||o(e,t.indexValues,i)}),{values:u(n),savedValues:u(r),stringValues:u(a),indexValues:u(i)}}(l),musics:h,inserts:y,viewsData:x,globalViewsData:C,historyCommand:V,countLoop:T};if(j.sounds=Array(10).fill(null),p.forEach(function(e,t){return e&&(j.sounds[null!=e.index?e.index:t]=e)}),o){j.commandUuid=o.commandUuid;var U=o.historyCommand,D=U.images,R=void 0===D?[]:D,B=U.dialog,L=U.autotext,F=U.weather,z=U.animateScene,W=U.views,N=void 0===W?[]:W,$=U.hideGlobalViews,H=void 0===$?[]:$,q=U.viewsData,K=void 0===q?[]:q,G=U.bubbleMode,J=void 0===G?[]:G,Q=U.bubbleCount,Z=void 0===Q?[]:Q;V.autotext=L&&L.uuid,V.weather=F&&F.uuid,V.animateScene={shake:z&&z.shake&&z.shake.uuid||void 0},V.views=N.map(function(e){return{instanceUuid:e[0],commandUuid:e[1]}}),V.hideGlobalViews=H,V.dialog={command:B&&B.command},V.viewsData=K,V.images=R.map(function(e){return{command:{args:[e]}}}),V.bubbleMode=function(e){var t=[];return e.length>0&&!e[0].args?e:(e.forEach(function(e){var n=e.args,r=(e.type,e.uuid),a=e.show,i=e.bubble,o=e.currentCount,u=n[0],s=u.index,c=u.rect,l=(u.url,u.remove),d=u.scale,h=void 0===d?1:d,f={bubble:i.map(function(e){return e.args?e.args[0]:e})||[],currentCount:o,index:s,show:a,uuid:r,remove:l,rect:c,scale:h};t.push(f)}),t)}(J).concat(),V.bubbleCount=Z.concat()}y=y?Object(k.a)(y):[],w=w?Object(k.a)(w):[],E=E?Object(k.a)(E):[],M=M?Object(k.a)(M):[];var Y=ve.getChapterByUUID(t,i);if(Y){var X=[];if(r({plots:Y.plots,plotUuid:a,commandUuid:o&&o.commandUuid,playStack:X}))return function(e){for(var n=e.pop();n;){var a=n,i=a.chapterUuid,o=a.plotUuid,u=!1,s=void 0,c=null,l=w.length-1;if(w[l]&&o===w[l].uuid){u=!0;var d=w.pop().data,h=void 0===d?{}:d;s=h.commandUuid,c=h.historyCommand}var f=ve.getChapterByUUID(t,i);if(!f)return void A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~");if(X=[],!r({plots:f.plots,plotUuid:o,commandUuid:s,playStack:X}))return void A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~");var p={chapterUuid:i,plotUuid:o,historyCommand:{}};if(u){p.commandUuid=s;var v=p.historyCommand,m=c,g=m.images,y=void 0===g?[]:g,_=m.dialog,b=m.autotext,k=m.weather,x=m.animateScene,P=m.views,C=void 0===P?[]:P,S=m.hideGlobalViews,O=void 0===S?[]:S,E=m.viewsData,I=void 0===E?[]:E;v.autotext=b&&b.uuid,v.weather=k&&k.uuid,v.animateScene={shake:x&&x.shake&&x.shake.uuid||void 0},v.views=C.map(function(e){return{instanceUuid:e[0],commandUuid:e[1]}}),v.hideGlobalViews=O,v.dialog={command:_&&_.command},v.images=y.map(function(e){return{command:{args:[e]}}}),v.viewsData=I}j.inserts.push(p),n=e.pop()}}(y),j;A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~")}else A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~")}(a(e,!0)):a(e)}}]),e}();Ee.cover_url="";var Ie={game:"//mapi.3000api.com/apis/soft/v1.0/game-info.html",testGame:"//mapi.3000api.com/apis/soft/v1.0/game-test.html",otherGame:"//mapi.3000api.com/apis/soft/v1.0/game-external.html",serverTime:"//my.3000.com/?m=timestamp&op=index&ac=get&api_v=1.0.0&api_from=webpc",sensitiveWord:"//mapi.3000api.com/apis/soft/v1.0/game-GetSensitiveStr.html",statistics:"//app.3000.com/?m=statistics&op=start&ac=h5",appCheckPay:"//app.3000.com/?m=consume&op=index&ac=market_order_status",wapChackPay:"//pay.3000.com/?m=consume&op=h5_flash_request",userInfoFromWap:"//ptlogin.3000.com/?m=ptlogin&ac=cookieuid",userInfoFromPc:"//www.3000.com/apis/client/v1.0/user-login.html",appUserInfo:"//app.3000.com/?m=user&op=index&ac=my_account",wapUserInfo:"//pay.3000.com/?m=player&op=h5_get_account_info",appGetRecord:"//app.3000.com/?m=cloud_save&op=index&ac=info",wapGetRecord:"//my.3000.com/?m=cloud_save&op=index&ac=info&client_type=1&api_v=1.0.0&api_from=webpc",appSaveRecord:"//app.3000.com/?m=cloud_save&op=index&ac=save",wapSaveRecord:"//my.3000.com/?m=cloud_save&op=index&ac=save&client_type=1&api_v=1.0.0&api_from=webpc",checkUserAlpha:"//app.3000.com/?m=game_info&op=index&ac=alpha_status",getFansInfo:"//pay.3000.com/?m=payinterface&op=player_one_opus_fans",optionClick:"//www.3000.com/apis/client/v1.0/trace-optionClick.html",gameStarted:"//www.3000.com/apis/client/v1.0/trace-play.html",wapGetPlayValues:"//my.3000.com/?m=pay_value&op=index&ac=info&api_v=1.0.0&api_from=webpc",appGetPlayValues:"//app.3000.com/?m=pay_value&op=index&ac=info",getAuthorGameNotice:"//my.3000.com/index.php?m=message&op=authorNotice&ac=getAuthorGameNotice&api_v=1.0.0&api_from=webpc",showGameNotice:"//my.3000.com/?m=rim&op=notice&ac=notice&gid=",wapSavePlayValues:"//my.3000.com/?m=pay_value&op=index&ac=save&api_v=1.0.0&api_from=webpc",appSavePlayValues:"//app.3000.com/?m=pay_value&op=index&ac=save",wapGetGoodInfo:"//pay.3000.com/?m=player&op=h5_purchase_market_count",appGetGoodInfo:"https://app.3000.com/?m=consume&op=index&ac=h5_purchase_market_count",getChapter:"//mapi.3000api.com/apis/soft/v1.0/chapter-chapterInfo.html",getChapterDiscounts:"https://mapi.3000api.com/apis/soft/v1.0/game-getCharge.html",getFlashAdv:"//www.3000.com/apis/client/v1.0/client-flashAdv.html",sendPlayTime:"//my.3000.com/?m=user_info&op=index&ac=add_user_play_time&api_v=1.0.0&api_from=webpc",getAppUnlockRecord:"//app.3000.com/?m=cloud_save&op=index&ac=get_archive_record",getWapUnlockRecord:"//my.3000.com/?m=cloud_save&op=index&ac=getArchiveRecord&api_v=1.0.0&api_from=webpc",singleConfig:"./config.json",logError:"//mapi.3000api.com/upload/index-clientLog.html",getPackActualPrice:"//app.3000.com/?m=consume&op=index&ac=market_package_price"};l.a.offline&&D.isAppClient()&&Object.keys(Ie).forEach(function(e){return-1===Ie[e].indexOf("https")&&(Ie[e]="https:".concat(Ie[e]))}),D.gameStartedApi=function(){var e=l.a.gid;Object(we.b)({url:Ie.gameStarted,data:"id=".concat(e,"&from=wap")})};var Ae=function(e,t){return encodeURIComponent(u.c.aesEncrypt(e,t))},Me=function(e,t){var n=l.a.offline,r=JSON.parse(e.response);if("100"==r.code){if(!u.c.isObject(r.result)&&(r.result.indexOf("http")>-1||r.result.indexOf("https")>-1)){var a=window.location.href.split("://")[0],i="".concat(a,"://")+r.result.replace(/(http|https):\/\//,"");return Object(we.b)({url:i,onProgress:t}).then(function(e){return JSON.parse(e.response)})}return Promise.resolve(r)}return n?Promise.resolve(r):Promise.reject(r.message)},Te=function(){return Object(we.b)({url:Ie.serverTime}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"getServerTime failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.data,i=n.msg;return 0==r?a.timestamp:Promise.reject(i+": "+r)})},Ve=function(e,t){var n,r,a=l.a.singleoffline,i=l.a.gid;if(a){var o=(n="uuid",null==(r=e.match(new RegExp("[?&]"+n+"=([^&]+)","i")))||r.length<1?"":r[1]);e="game".concat(i,"/json/").concat(o,".json")}return Object(we.b)({url:e,onProgress:t}).then(function(e){var n=l.a.offline;return Me(e,t).then(function(e){return"100"==e.code?e.result:n?e:Promise.reject(e.message)})})},je=function(e,t){return Ve("".concat(Ie.game,"?uuid=").concat(e),t)},Ue=function(e,t){return Ve("".concat(Ie.otherGame,"?uuid=").concat(e),t)},De=function(e,t,n){var r="SYConformTime".concat(e),a=l.a.uid||u.c.getUidByCookie(),i=D.localStorageGetItem(r);return i&&(i=u.c.aesDecrypt(i,1)),Object(we.c)({url:"".concat(Ie.testGame,"?uuid=").concat(e).concat(t),progress:n,data:{uid:a,time:i}}).then(function(e){var t=l.a.offline;return Me(e,n).then(function(e){var n=e.code,a=e.message,i=e.result;if(t)return e;switch(parseInt(n)){case 90:return D.localStorageRemoveItem(r),Promise.reject("很抱歉，预览码已过期~");case 91:return Promise.reject("很抱歉，预览码输入错误，请重新输入");case 101:return Promise.reject("作品含有敏感词，暂时没有办法查看哦~");case 100:return i;default:return Promise.reject(a)}})})},Re=function(){return new Promise(function(e,t){return _e()(Ie.userInfoFromWap,{},function(t,n){if(t)return l.a.uid="",e(!1);if(n){var r=n.data;return 0==n.success?(l.a.uid="",e(!1)):(l.a.uid=r.uid,e(!0))}return e(!1)})})},Be=function(){return new Promise(function(e,t){return Object(we.b)({url:Ie.userInfoFromPc,data:"t=".concat(1e6*Math.random())}).then(function(n){var r=n.responseText;if(0===r.length)return t({status:-2,msg:"用户信息获取失败！"});var a=JSON.parse(r).result.uid;return a?(!0!==u.c.hasChangeUserFromePc&&""!==u.c.preUid&&u.c.preUid!=a&&(u.c.hasChangeUserFromePc=!0),u.c.preUid!==a&&(u.c.midWayLoginFromePc=!0),""!=a&&""==u.c.preUid&&(u.c.preUid=a),l.a.uid=a,e()):(l.a.uid="",t({status:-1,msg:"您还没有登录！"}))},function(){return l.a.uid="",t({status:999,msg:"当前网络不稳定"})})})},Le={time:null,requestPromise:null},Fe=function(){var e=l.a.client,t=l.a.wap;if("pc"===e)return Be().then(function(){return!0},function(e){return Promise.reject(e)});if("wap"===e)return"wx"===t?Promise.resolve():Re().then(function(e){return 0==e?Promise.reject({status:-1,msg:"您还没有登录！"}):Promise.resolve()});var n=Le,r=n.time,a=n.requestPromise;return r&&u.a.getDate()-r<=5?a:(Le.time=u.a.getDate(),Le.requestPromise=We(99),Le.requestPromise)},ze=function(){var e=l.a.u,t=l.a.token,n=l.a.app_name,r=l.a.device_name,a=l.a.deviceOsVer;return"u=".concat(Ae(e,1),"&token=").concat(Ae(t,1),"&app_name=").concat(Ae(n||"shanyi",1),"&device_name=").concat(Ae(r||"Google Nexus S",1),"&device_system_version=").concat(Ae(a||"4.1.1",1))},We=function(e){var t=l.a.client,n=l.a.u,r=l.a.v,a=l.a.token,i=l.a.app_name,o=l.a.device_name,s=l.a.deviceOsVer,c=l.a.gid,d=l.a.app_version,h=function(e,t){return Object(we.c)({url:e,data:t}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"Get loadSaveRecord failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.data,i=n.msg;if(0===r){if(a.cover_url){var o=window.location.href.split("://")[0];Ee.cover_url="".concat(o,"://")+a.cover_url.replace(/(http|https):\/\//,"")||""}else Ee.cover_url="";var s=u.c.decryptBase64(a.content||"");return s&&"{}"!==s?s:null}return Promise.reject({status:r,msg:i})},function(e){return Promise.reject({status:999,msg:e})})},f=n&&a?1:0,p=u.a.getCurDate(),v=""===c?1:parseInt(c),m="",g=e+"";m=f?"app_name=".concat(i||"shanyi","&device_name=").concat(o||"Google Nexus S","&device_system_version=").concat(s||"4.1.1")+"&gid=".concat(v,"&time=").concat(p,"&token=").concat(a,"&type=").concat(g,"&u=").concat(n,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"):"gid=".concat(v,"&time=").concat(p,"&type=").concat(g,"&v_key=0GjRAtUUoK4BwJGUz73jBa2M");var y="gid=".concat(Ae(v,f),"&sign=").concat(Ae(ge.a.hash(ge.a.hash(m)),f),"&time=").concat(Ae(p,f),"&type=").concat(Ae(g,f));return""!==n&&""!==a?h("".concat(Ie.appGetRecord,"&client=").concat(t,"&v=").concat(r,"&app_version=").concat(d),"".concat(y,"&").concat(ze())):h(Ie.wapGetRecord,y)},Ne=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"app",a=l.a.isWapOther;r="pc"===l.a.client?"all":r;var i="uuid=".concat(e,"&").concat(t?"chapter_uuid=".concat(t):"product_id=".concat(n),"&platform=").concat(r).concat(a?"&key=external":"");return Object(we.b)({url:Ie.getChapterDiscounts,data:i}).then(function(e){var t=e.responseText;return 0===t.length?Promise.reject({code:we.a.ERROR,message:"Get Discounts failed, no response data"}):JSON.parse(t).result})},$e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return Promise.resolve();var t=l.a.uuid;return Object(we.b)({url:Ie.optionClick,data:"from=h5&uuid=".concat(t,"&optionid=").concat(JSON.stringify(e))})},He=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=l.a.client,i=l.a.offline,o=(l.a.token,l.a.isWapOther),s=(l.a.u,l.a.wap),c=(l.a.single,l.a.gid),d=l.a.singleoffline,h=l.a.type,f=l.a.uuid,p=function(e,t){return Object(we.c)({url:e,data:t,progress:n}).then(function(e){return 0===e.responseText.length?Promise.reject({code:we.a.ERROR,message:"Get chapterInfo failed, no response data"}):Me(e,n).then(function(e){var t=e.code,n=e.result,r=e.message,a=e.plots;return 100==t?n.plots:i?a:Promise.reject({code:t,message:r})})},function(e){return Promise.reject({code:999,message:"当前网络不稳定，请检查你的网络！"})})};if(d){var v="game".concat(c,"/json/").concat(e,".json");return p(v,"")}"ios"!==a&&"android"!==a&&"wap"!==a&&"pc"!==a&&(l.a.uid=u.c.getUidByCookie());var m="uuid=".concat(1==h&&36==f.length&&r?f+="2":f,"&uid=").concat(l.a.uid,"&chapter_uuid=").concat(e,"&md5=").concat(t,"&platform=").concat(a?"app":"pc").concat(o?"&key=external":"").concat(1==h&&r?"&action=test":""),g="".concat(Ie.getChapter,"?").concat(m);return"wap"===a?l.a.uid&&"wx"!==s?Re().then(function(){return p(g,m)}):p(g,m):"pc"===a?Be().then(function(){return p(g,m)},function(){return p(g,m)}):p(g,m)},qe={time:null,requestPromise:null},Ke=function(){var e=l.a.u,t=l.a.v,n=l.a.client,r=l.a.app_version,a=l.a.token,i=l.a.gid,o=l.a.alpha,s=l.a.single;if(!o||s)return Promise.resolve(!1);if("wap"===n)return Promise.resolve(!1);if("pc"===n)return Promise.resolve(o);var c=qe.time,d=qe.requestPromise;if(c&&u.a.getDate()-c<=5)return d;qe.time=u.a.getDate();var h="u=".concat(Ae(e,1),"&token=").concat(Ae(a,1),"&game_id=").concat(Ae(i,1)),f="".concat(Ie.checkUserAlpha,"&client=").concat(n,"&v=").concat(t,"&app_version=").concat(r);return qe.requestPromise=Object(we.c)({url:f,data:h}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"checkUserAlpha failed, no response data"});var n=JSON.parse(t),r=n.success,a=n.status,i=n.data;return 0===a&&r&&i&&1==i.status}),qe.requestPromise},Ge=function(){var e=l.a.gid;return e?Object(we.c)({url:Ie.getAuthorGameNotice,data:"game_id=".concat(e)}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"Get chapterInfo failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.data,i=void 0===a?{}:a;return 100==r&&1==i.status?Promise.resolve(i.pass_time):Promise.reject()}):Promise.reject()},Je=function(){var e=l.a.uuid;return"pc"!==l.a.client?Promise.resolve():Object(we.b)({url:Ie.getFlashAdv,data:"?uuid=".concat(e,"&dynamic=").concat(1e17*Math.random())}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.resolve();var n=JSON.parse(t),r=n.code,a=(n.message,n.result);return 100==r?a:Promise.resolve()},function(){return Promise.resolve()})},Qe=function(e){var t=l.a.gid;if("pc"===l.a.client){var n=u.a.getCurDate();Object(we.c)({url:Ie.sendPlayTime+"&gid=".concat(t,"&t=").concat(n),data:"gid=".concat(t,"&minute=").concat(Math.round(e/60))})}},Ze=function(){var e=l.a.client,t=l.a.v,n=l.a.u,r=l.a.token,a=l.a.app_name,i=l.a.device_name,o=l.a.deviceOsVer,s=l.a.gid,c=l.a.app_version,d=function(e,t){return Object(we.c)({url:e,data:t}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"Get loadSaveRecord failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.data,i=n.msg;return 100===r?a||[]:Promise.reject({status:r,msg:i})})},h=n&&r?1:0,f=""===s?1:parseInt(s),p=u.a.getCurDate(),v="";v=h?"app_name=".concat(a||"shanyi","&device_name=").concat(i||"Google Nexus S","&device_system_version=").concat(o||"4.1.1")+"&gid=".concat(f,"&time=").concat(p,"&token=").concat(r,"&u=").concat(n,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"):"gid=".concat(f,"&time=").concat(p,"&v_key=0GjRAtUUoK4BwJGUz73jBa2M");var m="gid=".concat(Ae(f,h),"&sign=").concat(Ae(ge.a.hash(ge.a.hash(v)),h),"&time=").concat(Ae(p,h));return""!==n&&""!==r?d("".concat(Ie.getAppUnlockRecord,"&client=").concat(e,"&v=").concat(t,"&app_version=").concat(c),"".concat(m,"&").concat(ze())):d(Ie.getWapUnlockRecord,m)},Ye=(O({},we.a),null),Xe=null,et=["jump","insert","back"].concat(["options","conditionOptions","addImage","showDialog","playMusic","playSound","weather"]),tt=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"subRef",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"play";rt.sub(e,t,n)}},{key:"addRef",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"play";rt.add(e,t,n),"image"===e&&at.pop(t)}},{key:"addRefTo",value:function(e,t,n,r){var a=rt.count(e,t,n);a<r&&rt.add(e,t,n,r-a)}},{key:"isSafeRef",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"play",a=rt.count(e,t),i=rt.count(e,t,r);return a-i>0||i>=n}},{key:"inCache",value:function(e,t){return"image"===e?Xe.checkImageKey(t):ae.inCache(t)}},{key:"isLoading",value:function(e,t){return"image"===e?Ye.getAsset("image",t):ae.inCache(t)}},{key:"load",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=n;if(e.inCache(t,i))return!1;if(!(n=u.c.convertToFullUrl(n)))return!1;var o=!0;if("image"===t){var s=(Ye.getAsset("image",i)||{}).file;o=!(s&&s.loading&&!s.loaded&&!s.error)}else o=!ae.isLoading(i);return"image"===t?(o&&Ye.image(i,n,!0,a),!r&&rt.add("image",i,"global")):"audio"===t&&(o&&ae.load(i,n,a),!r&&rt.add("audio",i,"global")),o}},{key:"removeCache",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!rt.absent(t,n)&&!rt.count(t,n)){var a=function(){if(!rt.count(t,n)){var r=e.getUsing().filter(function(e){return e.url===n});if(r.length)rt.add(t,n,"play",r.length);else{var a=Xe.getImage(n,!0);if(a){var i=a.data.frames;i&&i.forEach(function(e){return e.image=null}),/blob:/i.test(a.url)&&URL.revokeObjectURL(a.url),Xe.removeImage(n)}}}};if("audio"===t)ae.free(n),nt.state.size+=e.getSize(n,t);else if("image"===t){if(!r)return at.push(n),void nt.start();Xe.checkImageKey(n)?a():Ye.forceRemoveFile("image",n,function(){return a()}),nt.state.size+=e.getSize(n,t)}delete rt[t][n],nt.start()}}},{key:"startLoadThread",value:function(){nt.start()}},{key:"getCommandsPreloadType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=[];return t.forEach(function(t){var r=t.type,a=t.args,i=t.uuid;if("options"===r||"conditionOptions"===r)for(var o=0,u=a.length;o<u;o++)"options"===r?n.push("$".concat(i,"o").concat(o,"-")):(n.push("$".concat(i,"c").concat(o,"-")),n.push("$".concat(i,"l").concat(o,"-"))),n.push.apply(n,Object(k.a)(e.getCommandsPreloadType(a[o].commands)))}),n}},{key:"getPlotPreloadType",value:function(t){var n=[],r=t.uuid,a=t.commands,i=t.options,o=void 0===i?[]:i,u=t.condition_options,s=void 0===u?[]:u;a&&n.push.apply(n,Object(k.a)(e.getCommandsPreloadType(a)));for(var c=0,l=o.length;c<l;c++)n.push("$".concat(r,"o").concat(c,"-")),n.push.apply(n,Object(k.a)(e.getPlotsPreloadType(o[c].plots)));for(var d=0,h=s.length;d<h;d++)n.push("$".concat(r,"c").concat(d,"-")),n.push("$".concat(r,"l").concat(d,"-")),n.push.apply(n,Object(k.a)(e.getPlotsPreloadType(s[d].plots)));return n}},{key:"getPlotsPreloadType",value:function(t){var n=[];return t.forEach(function(t){return n.push.apply(n,Object(k.a)(e.getPlotPreloadType(t)))}),n}},{key:"resetInsertAfter",value:function(t,n){nt.state.loadingChapterMap[t.uuid]=!1,e.getPlotsPreloadType(t.plots).forEach(function(e){rt.transfer(e,!1),nt.kill(e)});var r={};ve.getJumpAndInsertChapterUuids(n).map(function(e){return r[e]=!0}),ve.getJumpAndInsertChapterUuids(t).map(function(e){return r[e]?null:"$".concat(e)}).filter(function(e){return e}).forEach(function(e){return nt.kill(e)})}},{key:"resetInsert",value:function(e){var t="$".concat(e.uuid);nt.state.loadingChapterMap[e.uuid]=!0,rt.transfer(t),nt.update(t,!0),nt.start()}},{key:"resetJump",value:function(t){var n="$".concat(t.uuid),r=ve.getJumpAndInsertChapterUuids(t).map(function(e){return"$".concat(e)});nt.state.loadingChapterMap[t.uuid]=!0,rt.clear([n].concat(Object(k.a)(r))),rt.transfer(n);var a={};e.getUsing().forEach(function(e){var t=e.url;return a[t]=(a[t]||0)+1}),rt.forEach(function(t,n,r){a[n]?rt.add(t,n,"play",a[n]):0===r&&e.removeCache(t,n)}),nt.update(n,!1,r),nt.start()}},{key:"resetCommandOption",value:function(e,t){var n=e.type,r=e.args,a=e.uuid;if("options"===n||"conditionOptions"===n){var i="options"===n?"o":"c",o="$".concat(a).concat(i).concat(t,"-");rt.transfer(o),r.forEach(function(e,n){if(n!==t){var r="$".concat(a).concat(i).concat(n,"-");rt.transfer(r,!1),nt.kill(r)}}),nt.update(o),nt.start()}}},{key:"resetComandAfter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};nt.start();var t=e.uuid,n=e.type,r=e.args;n&&et.some(function(e){return e===n})&&nt.state.loaded--,"conditionOptions"===n&&r.forEach(function(e,n){return rt.transfer("$".concat(t,"l").concat(n,"-"),!1)})}},{key:"resetPlotOption",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=e.uuid,a=e.options,i=void 0===a?[]:a,o=e.condition_options,u=void 0===o?[]:o;if(i.length||u.length){var s="$".concat(r).concat(t).concat(n,"-");rt.transfer(s),i.forEach(function(e,t){if(t!==n){var a="$".concat(r,"o").concat(t,"-");rt.transfer(a,!1),nt.kill(a)}}),u.forEach(function(e,t){if(t!==n){var a="$".concat(r,"c").concat(t,"-");rt.transfer(a,!1),nt.kill(a)}}),nt.update(s,!0),nt.start()}}},{key:"resetPlotAfter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};nt.start(),nt.state.loaded--;var n=t.uuid,r=t.commands,a=void 0===r?[]:r,i=t.condition_options;i&&i.length?i.forEach(function(e,t){return rt.transfer("$".concat(n,"l").concat(t,"-"),!1)}):e.getCommandsPreloadType(a).forEach(function(e){rt.transfer(e,!1),nt.kill(e)})}},{key:"getUsing",value:function(){for(var e=[],t=function t(n){return n.children.forEach(function(n){if("MotionImage"===n.name){var r=n.motionImageData;r&&r.images.forEach(function(t){var n=t.url;return e.push({url:n,type:"image"})})}else n.key&&u.c.isString(n.key)&&e.push({url:n.key,type:"image"});t(n)})},n=game.world.children,r=0,a=n.length;r<a;r++)"scene"===n[r].name&&t(n[r]);return ae.getUsingUrls().forEach(function(t){return e.push({url:t,type:"audio"})}),e.filter(function(e){return e.url&&"__default"!==e.url&&"__missing"!==e.url})}},{key:"needLoadByPlot",value:function(t){return t.commands?e.needLoadByCommands(t.commands):e.getPlot(t)}},{key:"needLoadByCommands",value:function(t){var n=[],r=0;return function t(a){for(var i=0;i<a.length&&r<20;i++){var o=a[i],u=e.getCommand(o);if(u.length&&(n.push.apply(n,Object(k.a)(u)),r++),"options"===o.type||"conditionOptions"===o.type)for(var s=0;s<o.args.length&&r<20;s++)t(o.args[s].commands)}}(t),n}},{key:"getCommandState",value:function(t){var n=[],r=e.gameJson.motionImgMap,a=function(e,t){if(u.c.isObject(e)){if(!r||!e.uuid||!r[e.uuid])return;r[e.uuid].images.forEach(function(e){var t=e.url;return n.push({type:"image",url:t})})}else e&&u.c.isString(e)&&"inherit"!==e&&n.push({type:t,url:e})},i=t.weather,o=t.images,s=t.bubbleMode;return i&&e.getWeather(i.args[0]).forEach(function(e){var t=e.url,n=e.type;return a(t,n)}),o&&o.forEach(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).command;return e&&a(e.args[0].url,"image")}),s&&s.length>0&&s.forEach(function(e){return e&&e.bubble.forEach(function(e){if(e){var t=e.avatar,n=e.content;t.url&&"inherit"!==t.url&&a(t.url,"image"),n.url&&"inherit"!==n.url&&a(n.url,"image"),n.background&&n.background.url&&a(n.background.url,"image")}})}),n}},{key:"getWeather",value:function(e){return u.c.getWeatherUrls(e).map(function(e){return{type:"image",url:e}})}},{key:"getCommand",value:function(t){var n=[],r=t.args,a=t.type,i=e.gameJson.motionImgMap,o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(u.c.isObject(e)){if(!i||!e.uuid||!i[e.uuid])return;i[e.uuid].images.forEach(function(e){var t=e.url;return n.push({type:"image",url:t})})}else e&&u.c.isString(e)&&"inherit"!==e&&n.push({type:"image",url:e})};switch(a){case"addView":r.forEach(function(e){return e.events.forEach(function(e){return e.events.forEach(function(e){var t=e.type,r=e.handle;"playMusic"===t&&r.music?r.music.url&&n.push({url:r.music.url,type:"audio"}):"playSound"===t&&r.sounds&&r.sounds.forEach(function(e){return e&&e.url&&"inherit"!=e.url&&n.push({url:e.url,type:"audio"})})})})});case"addImage":o(r[0].url);break;case"showDialog":o(r[0].avatar.url);break;case"playMusic":case"playSound":r[0].url&&"inherit"!==r[0].url&&n.push({type:"audio",url:r[0].url});break;case"options":for(var s=0,c=r.length;s<c;s++){var d=r[s],h=d.background,f=d.sound;if(h){var p=h.normal,v=h.active,m=h.disable;p&&p.url&&o(p.url),v&&v.url&&o(v.url),m&&m.url&&o(m.url)}f&&f.url&&n.push({type:"audio",url:f.url})}break;case"weather":l.a.offline||n.push.apply(n,Object(k.a)(e.getWeather(t.args[0])));break;case"showBubble":o(r[0].url);break;case"emitBubble":var g=r[0],y=g.avatar,_=g.content,w=_.background;o(y.url),o(_.url),w&&o(w.url)}return n}},{key:"getPlot",value:function(t){var n=t.plot_sound,r=t.background,a=t.avatar,i=t.music,o=t.characters,s=t.props,c=t.options,d=t.weather,h=t.views,f=[],p=e.gameJson.motionImgMap,v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(u.c.isObject(e)){if(!p||!e.uuid||!p[e.uuid])return;p[e.uuid].images.forEach(function(e){var t=e.url;return f.push({type:"image",url:t})})}else e&&u.c.isString(e)&&"inherit"!==e&&f.push({type:"image",url:e})};if(Array.isArray(n))for(var m=0,g=n.length;m<g;m++){var y=n[m];y&&y.url&&"inherit"!==y.url&&f.push({url:y.url,type:"audio"})}else n.url&&"inherit"!==n.url&&f.push({url:n.url,type:"audio"});r.url&&"inherit"!==r.url&&v(r.url),a.url&&v(a.url),i.url&&"inherit"!==i.url&&f.push({url:i.url,type:"audio"});for(var _=0,w=o.length;_<w;_++)o[_].url&&v(o[_].url);for(var b=0,x=s.length;b<x;b++)s[b].url&&v(s[b].url);for(var P=0,C=c.length;P<C;P++){var S=c[P],O=S.background,E=S.sound;if(O){var I=O.normal,A=O.active,M=O.disable;I&&I.url&&v(I.url),A&&A.url&&v(A.url),M&&M.url&&v(M.url)}E&&E.url&&f.push({type:"audio",url:E.url})}return h.forEach(function(e){return e.events.forEach(function(e){return e.events.forEach(function(e){var t=e.type,n=e.handle;"playMusic"===t&&n.music?n.music.url&&f.push({url:n.music.url,type:"audio"}):"playSound"===t&&n.sounds&&n.sounds.forEach(function(e){return e&&e.url&&"inherit"!=e.url&&f.push({url:e.url,type:"audio"})})})})}),d.value&&(l.a.offline||f.push.apply(f,Object(k.a)(e.getWeather(t.weather.value)))),f}},{key:"countOptionAssets",value:function(t){var n={},r=0,a=function(e){var t=e.url;n[t]||(r++,n[t]=!0)},i=function(t){for(var n=t.plots,r=0,i=n.length;r<i;r++){var u=n[r],c=[];u.commands?c=u.commands.map(function(t){var n=t.args,r=t.type;return"options"!==r&&"conditionOptions"!==r||s(n),e.getCommand(t)}).reduce(function(e,t){return[].concat(Object(k.a)(t),[e])},[]):(u.options.length&&o(u.options),u.condition_options.length&&o(u.condition_options),c=e.getPlot(u)),c.forEach(function(e){return a(e)})}},o=function(e){return e.forEach(function(e){return i(e)})},u=function(t){for(var n=t.commands,r=0,i=n.length;r<i;r++){var o=n[r];e.getCommand(o).forEach(function(e){return a(e)}),"options"!==o.type&&"conditionOptions"!==o.type||s(o.args)}},s=function(e){return e.forEach(function(e){return u(e)})};return t.plots?i(t):u(t),r}},{key:"clearPreload",value:function(){nt.queue.length=[],nt.state.loadingChapterMap={},nt.state.loaded=0,rt.clear(),e.getUsing().forEach(function(t){var n=t.url,r=t.type;return e.addRef(r,n)})}},{key:"clearUselessRef",value:function(){rt.forEach(function(t,n,r){return r<=0&&e.removeCache(t,n)})}},{key:"getPreload",value:function(t){var n=t.stack,r=void 0===n?[]:n,a=t.chapter,i=t.plots,o=t.plotIndex,s=void 0===o?0:o,c=t.commands,l=t.cmdIndex,d=void 0===l?0:l,h=t.commandState;e.clearPreload();var f={data:[],size:0};r=Object(k.a)(r);var p=e.gameJson.motionImgMap,v=function(t,n,r){if(t){var a=function(t,n,r){if(rt.add(t,n,r),!f.data.some(function(e){return e.url===n})){var a=e.getSize(n,t);f.data.push({url:n,type:t,size:a}),f.size+=a}};if(t&&u.c.isString(t)&&"inherit"!==t)a(n,t,r);else if(u.c.isObject(t)){if(!p||!t.uuid||!p[t.uuid])return;var i=p[t.uuid].images;(void 0===i?[]:i).forEach(function(e){var t=e.url;return a(n,t,r)})}}};if(h&&e.getCommandState(h).forEach(function(e){var t=e.type,n=e.url;return v(n,t,"play")}),c&&!c[d]||i&&!i[s])return Promise.resolve(f.data);var m=function(){return f.size>2e7||f.data.length>30},g=function(t,n,r){var a=t.loadType,i=ve.getChapterByUUID(e.gameJson,r);if(i)return a="$".concat(i.uuid),nt.fixTask({stack:[],chapter:i,plots:i.plots,plotIndex:0,commands:null,cmdIndex:0,loadType:a})},y=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t.stack,a=t.commands,i=t.plotIndex,o=t.cmdIndex,u=a[o]||{},s=u.type,c=u.args;if("jump"===s)return nt.pushTasks([g(t,0,c[0])]),Promise.resolve();if("insert"===s)return nt.pushTasks([g(t,0,c[0])]),_(O({},t,{cmdIndex:o+1}));if("back"===s)return Promise.resolve();if("options"===s||"conditionOptions"===s)return function t(n){for(var r=n.commands,a=n.cmdIndex,i=n.loadType,o=r[a],u=o.type,s=o.args,c=o.uuid,l=[],d=[],h=function(e){return O({},n,{stack:[]},e)},f=function(n,r){for(var a=s[n],o="options"===u?"o":"branch"!==a.type&&e.countOptionAssets(a)<=50?"l":"c",f="".concat("play"===i?"":i,"$").concat(c).concat(o).concat(n,"-"),p=Promise.resolve(),y=a.commands,_=function(n){var r=a.commands[n],i=r.type,o=r.args;if(p=p.then(function(){if(m())return Promise.reject(n);var a=h({commands:y,cmdIndex:n,loadType:f});return e.getCommand(r).forEach(function(e){var t=e.url,n=e.type;return v(t,n,f)}),"options"===i||"conditionOptions"===i?t(a):"jump"===i?(nt.pushTasks([g(a,0,o[0])]),Promise.reject(-1)):"insert"===i?(nt.pushTasks([g(a,0,o[0])]),Promise.reject(n+1)):"back"===i?Promise.reject(-1):Promise.resolve()}),"options"===i||"conditionOptions"===i)return n+1<a.commands.length&&(p=p.then(function(){return Promise.reject(n)})),"break"},w=0;w<a.commands.length&&w<10&&"break"!==_(w);w++);p=p.then(function(){a.commands.length>10&&d.push(h({commands:y,cmdIndex:10,loadType:f}))},function(e){e>=0&&a.commands.length>e&&d.push(h({commands:y,cmdIndex:e,loadType:f}))}),l.push(p)},p=0,y=s.length;p<y;p++)f(p);return Promise.all(l).then(function(){return d.length&&nt.pushTasks(d),Promise.resolve()})}(t).then(function(){return _(O({},t,{cmdIndex:o+1}),n)});if(a.length>o+1)return _(O({},t,{cmdIndex:o+1}),n);if(n&&r.length){var l=r[0];if(r=r.slice(1),l.commands)return _(O({},l,{stack:r,loadType:"play"}),n);var d=r,h=d.condition,f=d.breakNext;return w(O({},h?f:l,{stack:r,loadType:"play"}))}return n?w(O({},t,{plotIndex:i+1,commands:null})):Promise.resolve()},_=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t.commands,a=t.cmdIndex,i=t.loadType;return a>=r.length?y(t,n):m()?(nt.pushTasks([nt.cloneTask(t)]),Promise.resolve()):(e.getCommand(r[a]).forEach(function(e){var t=e.url,n=e.type;return v(t,n,i)}),y(t,n))},w=function(t){var n=t.plots,r=t.plotIndex,a=t.loadType,i=n[r];if(!i||i.commands&&!i.commands.length)return Promise.resolve();if(i.commands)return _(O({},t,{commands:i.commands,cmdIndex:0}));return m()?(nt.pushTasks([nt.cloneTask(t)]),Promise.resolve()):(e.getPlot(i).forEach(function(e){var t=e.url,n=e.type;return v(t,n,a)}),function t(n){var r=n.plotIndex,a=n.plots,i=n.loadType,o=a[r],u=o.uuid,s=o.options,c=o.condition_options,l=function(e){return O({},n,{stack:[]},e)},d=function(n,r){for(var a=[],o=[],s=function(s,c){for(var d=n[s],h="options"===r?"o":"branch"!==d.type&&e.countOptionAssets(d)<=50?"l":"c",f="".concat("play"===i?"":i,"$").concat(u).concat(h).concat(s,"-"),p=Promise.resolve(),y=d.plots,w=function(n){var r=y[n];p=p.then(function(){return m()?Promise.reject(n):r.commands?_(l({loadType:f,commands:r.commands,cmdIndex:0,plots:y,plotIndex:n})):void e.getPlot(r).forEach(function(e){var t=e.url,n=e.type;return v(t,n,f)})}).then(function(){var e=l({loadType:f,plots:y,plotIndex:n,commands:null});return function(e){for(var t=e.options,n=e.condition_options,r=0,a=0,i=t.length;a<i;a++)r+=t[a].plots.length;for(var o=0,u=n.length;o<u;o++)r+=n[o].plots.length;return r}(r)?t(e):r.jump?(nt.pushTasks([g(e,0,r.jump)]),Promise.reject(-1)):r.insert?(nt.pushTasks([g(e,0,r.insert)]),Promise.reject(n+1)):r.back?Promise.reject(-1):Promise.resolve()})},b=0;b<y.length&&b<5;b++)w(b);p=p.then(function(){y.length>5&&o.push(l({loadType:f,plots:y,plotIndex:5,commands:null}))},function(e){return e>=0&&d.plots.length>e&&!d.plots[e].commands&&o.push(l({loadType:f,plots:y,plotIndex:e,commands:null})),Promise.resolve()}),a.push(p)},c=0,d=n.length;c<d;c++)s(c);return Promise.all(a).then(function(){return o.length&&nt.pushTasks(o)})};return Promise.all([d(s,"options"),d(c,"condition_options")])}(t).then(function(){return b(t)}))},b=function(e){var t=e.stack,n=e.plots,r=e.plotIndex,a=n[r];if(a.back)return Promise.resolve();if(a.jump)return nt.pushTasks([g(e,0,a.jump)]),Promise.resolve();if(a.insert)return nt.pushTasks([g(e,0,a.insert)]),w(O({},e,{plotIndex:r+1}));if(n.length>r+1)return w(O({},e,{plotIndex:r+1}));if(t.length){var i=t[0];if(t=t.slice(1),i.commands)return _(O({},i,{stack:t,loadType:"play"}));var o=t,u=o.condition,s=o.breakNext;return w(O({},u?s:i,{stack:t,loadType:"play"}))}return Promise.resolve()},x=function(){return f.size<1e8&&(nt.state.size=1e8-f.size),nt.state.loadingChapterMap[a.uuid]=!0,f.data},P={stack:r,chapter:a,plots:i,plotIndex:s,commands:c,cmdIndex:d,loadType:"play"};return c?_(P).then(function(){return x()}):w(P).then(function(){return x()})}},{key:"getSize",value:function(e,t){return"image"===t?"gif"===e.substr((Math.max(0,e.lastIndexOf("."))||1/0)+1).toLowerCase()?1e6:2e5:"audio"===t?2e6:void 0}},{key:"loader",set:function(e){Ye=e}},{key:"cache",set:function(e){Xe=e}}]),e}();tt.gameJson=null;var nt=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"start",value:function(){var t=e.state;if(!(t.loading||t.size<0)){t.loading=!0;setTimeout(function n(){var r=[],a=e.queue,i=15;t.loaded>50&&t.loaded<80?i+=2:t.loaded>=80&&(i+=4*Math.floor(t.loaded/40));for(var o=function(n){for(var o=[],s=a[n],c=function(r){var a=s[r];if(a.lock)return o.push(Promise.resolve()),"continue";var c=u.c.timeout(0).then(function(){return e.queue[n]&&e.queue[n][r]&&a===e.queue[n][r]?e.getChapter(a):Promise.reject()}).then(function(t){return e.getAssets(t)}).then(function(e){return e.map(function(e){return O({},e,{needLoad:tt.load(e.type,e.url,!0)})})}).then(function(e){var n=e.filter(function(e){return e.needLoad}),r=n.reduce(function(e,t){return e+t.size},0);t.size-=r,n.length&&Ye.start()}).then(function(){return u.c.timeout(i)});o.push(c)},l=0;l<s.length;l++)c(l);r.push(Promise.all(o).then(null,function(e){return e&&console.warn(e)}))},s=0;s<a.length&&t.loaded<200;s++)o(s);var c=function(){e.updateQueue(),t.loaded++,t.size<=0||!e.queue.length||t.loaded>=200?t.loading=!1:setTimeout(n,0)};r.length?Promise.all(r).then(c,c):t.loading=!1},0)}}},{key:"update",value:function(t){for(var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=e.queue,i=0;i<a.length;i++){for(var o=function(e){var o=a[i][e],s=o.loadType;if(s.startsWith(t))s=s.substring(t.length),o.loadType=s||"play";else if(!n){if(r.some(function(e){return s.startsWith(e)}))return u=e,"continue";a[i].splice(e--,1)}u=e},u=0;u<a[i].length;u++)o(u);a[i].length||a.splice(i--,1)}}},{key:"kill",value:function(t){for(var n=e.queue,r=0;r<n.length;r++){for(var a=0;a<n[r].length;a++){n[r][a].loadType.startsWith(t)&&n[r].splice(a--,1)}n[r].length||n.splice(r--,1)}}},{key:"getAssets",value:function(e){var t=e.commands,n=e.plots,r=e.plotIndex,a=void 0===r?0:r,i=e.cmdIndex,o=void 0===i?0:i,u=e.loadType,s=void 0===u?"play":u,c=[],l=function(e){var t=e.url,n=e.type;rt.add(n,t,s),c.some(function(e){return e.url===t})||c.push({url:t,type:n,size:tt.getSize(t,n)})};if(t){var d=t[o];(d?tt.getCommand(d):[]).forEach(function(e){return l(e)})}else{(n[a]?tt.getPlot(n[a]):[]).forEach(function(e){return l(e)})}return c}},{key:"getTaskPriority",value:function(e){for(var t=e.loadType,n=(void 0===t?"play":t).split("$").slice(1).map(function(e){var t=e.slice(36);return/o\d-$/.test(t)?"option":/(c|l)\d-$/.test(t)?"condOption":"chapter"}),r=0,a=0;a<n.length;a++)switch(n[a]){case"chapter":case"option":r+=2;break;case"condOption":r+=1}return r}},{key:"cloneTask",value:function(e){return O({},e,{stack:Object(k.a)(e.stack||[])})}},{key:"createTask",value:function(t){var n=t.task,r=t.type,a=t.chapter,i=n=e.cloneTask(n),o=i.stack,u=(i.loadType,null);switch(r){case"pop":u=o.pop(),Object.assign(n,u,{loadType:"play",stack:o}),u&&"insert"===u.type&&(u=o.pop(),Object.assign(n,u,{loadType:u.loadType||"play",stack:o}));break;case"jump":case"insert":n.stack=[],n.chapter=a,n.plots=a.plots,n.commands=null,n.plotIndex=0,n.cmdIndex=0,n.loadType="$".concat(a.uuid),e.state.loadingChapterMap[a.uuid]=!0}return e.fixTask(n)}},{key:"fixTask",value:function(e){var t=e.plots,n=e.commands,r=e.plotIndex,a=void 0===r?0:r;if(!n&&t&&t[a]){var i=t[a];if(i.commands)return O({},e,{commands:i.commands,cmdIndex:0})}return e}},{key:"createTasksByPlotOption",value:function(t){for(var n=t.task,r=t.plot,a=t.optionType,i=n.loadType,o=[],u=r[a],s=0;s<u.length;s++){var c=u[s];if(c.plots.length){var l=tt.countOptionAssets(c);if(!(l<1)){var d=O({},n,{stack:[],plots:c.plots,plotIndex:0,commands:null}),h="options"===a?"o":"branch"!==c.type&&l<=50?"l":"c";d.loadType="".concat("play"===i?"":i,"$").concat(r.uuid).concat(h).concat(s,"-"),o.push(e.fixTask(d))}}}return o}},{key:"createTasksByCommandOption",value:function(e){for(var t=e.task,n=e.command,r=t.loadType,a=[],i=n.args,o=0;o<i.length;o++){var u=i[o];if(u.commands.length){var s=O({},t,{stack:[],commands:u.commands,cmdIndex:0}),c="options"===n.type?"o":"branch"!==u.type&&tt.countOptionAssets(u)?"l":"c";s.loadType="".concat("play"===r?"":r,"$").concat(n.uuid).concat(c).concat(o,"-"),a.push(s)}}return a}},{key:"updateQueue",value:function(){for(var t=e.queue,n=0,r=t.length;n<r;n++)for(var a=t[n],i=function(n){var r=a[n],i=r.stack,s=r.plots,c=r.plotIndex,l=void 0===c?0:c,d=r.commands,h=r.cmdIndex,f=void 0===h?0:h;if(r.lock)return r.lockTotal--,r.lockTotal||(r.lock=!1,r.loaded=0),o=n,"continue";var p=e.getTaskPriority(r);if(p){var v=0;if(d){var m=d[f]||{},g=m.type,y=m.args;v="options"===g||"conditionOptions"===g?y.length:0}else{var _=s[l]||{},w=_.options,b=void 0===w?[]:w,k=_.condition_options,x=void 0===k?[]:k;v=Math.max(b.length,x.length)}if(r.loaded=r.loaded||0,r.loaded>40||2===p&&r.loaded>10||p>=3||v>5)return r.lock=!0,r.lockTotal=10,o=n,"continue";r.loaded++}if(d)if(d.length<=f){if(s.length>l+1&&d===s[l].commands)return r.plotIndex+=1,r.commands=s[r.plotIndex].commands||null,r.cmdIndex=0,o=n,"continue";a.splice(n--,1),i.length&&t.push([e.createTask({task:r,type:"pop"})])}else{var P=d[f],C=P.type;if("options"===C||"conditionOptions"===C){var S=e.createTasksByCommandOption({command:P,task:r});S.length&&t.push(S),r.cmdIndex++}else if("back"===C||"jump"===C||"insert"===C){"insert"!==C&&a.splice(n--,1);var O=P.args[0];if("back"!==C&&!e.state.loadingChapterMap[O]){var E=ve.getChapterByUUID(tt.gameJson,P.args[0]);E&&t.push([e.createTask({task:r,type:C,chapter:E})])}r.cmdIndex++}else!function(){for(var n=(d[++r.cmdIndex]||{}).type;n&&!et.some(function(e){return e===n});){var a=d[++r.cmdIndex]||{};n=a.type}d[r.cmdIndex]?tt.getCommand(d[r.cmdIndex]).forEach(function(e){var t=e.url;t&&u.c.isString(t)&&t.toLowerCase().includes(".gif")&&(r.loaded=(r.loaded||0)+10)}):i.length&&t.push([e.createTask({task:r,type:"pop"})])}()}else if(s.length<=l)a.splice(n--,1),i.length&&t.push([e.createTask({task:r,type:"pop"})]);else{var I=s[l],A=I.options,M=void 0===A?[]:A,T=I.condition_options,V=void 0===T?[]:T;if(M.length||V.length){var j=e.createTasksByPlotOption({plot:I,optionType:"options",task:r}),U=e.createTasksByPlotOption({plot:I,optionType:"condition_options",task:r});j.length&&t.push(j),U.length&&t.push(U)}else if(I.back||I.jump||I.insert){if(I.insert||a.splice(n--,1),I.jump){var D=I.jump;if(!e.state.loadingChapterMap[D]){var R=ve.getChapterByUUID(tt.gameJson,D);R&&t.push([e.createTask({task:r,type:"jump",chapter:R})])}}if(I.insert){var B=I.insert;if(!e.state.loadingChapterMap[B]){var L=ve.getChapterByUUID(tt.gameJson,B);L&&t.push([e.createTask({task:r,type:"insert",chapter:L})])}}}r.plotIndex++,a[n]=e.fixTask(r)}o=n},o=0;o<a.length;o++)i(o);for(var s=0;s<t.length;s++)t[s]&&!t[s].length&&t.splice(s--,1)}},{key:"getChapter",value:function(t){var n=t.chapter,r=n.md5,a=n.downloadUuid,i=n.uuid,o=n.plots,u=n.charge,s=l.a.client,c=l.a.type;if(r&&!o.length){var d=a||i,h=function(){var r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];a.length&&!n.plots.length&&((r=n.plots).push.apply(r,Object(k.a)(a)),t.plots=n.plots);return delete e.loadingChapterMap[d],Object.assign(t,e.fixTask(t))};if(e.loadingChapterMap[d])return e.loadingChapterMap[d].then(h);var f="ios"!==s&&"android"!==s&&1!=c&&"pc"!==s||!u?He(d,r).then(null,function(){return[]}):Promise.reject([]);return e.loadingChapterMap[d]=f,f.then(h)}return Promise.resolve(t)}},{key:"pushTasks",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(t=t.map(function(t){if(!t)return null;var n=t.chapter,r=t.plots,a=t.plotIndex,i=t.commands,o=t.cmdIndex;if(r===n.plots&&0===a&&r.length){var u=r[0];if(e.state.loadingChapterMap[n.uuid])return null;(!u.commands||u.commands&&i===u.commands&&0===o)&&(e.state.loadingChapterMap[n.uuid]=!0)}return e.fixTask(t)}).filter(function(e){return e})).length&&e.queue.push(t)}}]),e}();nt.state={size:0,loading:!1,loaded:0,loadingChapterMap:{}},nt.loadingChapterMap={},nt.queue=[],window.LoadThread=nt;var rt=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"absent",value:function(t,n){return!e[t][n]}},{key:"count",value:function(t,n,r){return e[t][n]?r?e[t][n][r]||0:Object.keys(e[t][n]).reduce(function(r,a){return r+e[t][n][a]},0):0}},{key:"add",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"play",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;game.load.cancelForceRemoveFile(t,n),e[t][n]=e[t][n]||{},e[t][n][r]=(e[t][n][r]||0)+a}},{key:"sub",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"play",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=e[t][n]||{};i[r]=(i[r]||0)-a,i[r]=i[r]<0?0:i[r],0===e.count(t,n)&&tt.removeCache(t,n)}},{key:"del",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"play";e[t][n][r]=0}},{key:"forEach",value:function(t){[e.image,e.audio].forEach(function(n,r){return Object.keys(n).forEach(function(n){t&&t(r?"audio":"image",n,e.count(r?"audio":"image",n))})})}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];[e.image,e.audio].forEach(function(e,n){return Object.keys(e).forEach(function(n){var r=e[n],a=r.global,i=void 0===a?0:a,o=r.cache,u=void 0===o?0:o,s=r.using,c={global:i,cache:u,using:void 0===s?0:s},l=Object.keys(e[n]);t.forEach(function(e){return l.forEach(function(t){return~t.indexOf(e)?c[t]=r[t]:void 0})}),e[n]=c})})}},{key:"move",value:function(t,n){[e.image,e.audio].forEach(function(e){Object.keys(e).forEach(function(r){var a=e[r];a[n]=(a[n]||0)+(a[t]||0),delete a[t]})})}},{key:"transfer",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];[e.image,e.audio].forEach(function(e,r){Object.keys(e).forEach(function(a){e.hasOwnProperty(a)&&Object.keys(e[a]).forEach(function(i){if(i.startsWith(t)){var o=i.indexOf(t),u=i.slice(o+t.length)||"play",s=e[a][i]||0;delete e[a][i],n?e[a][u]=(e[a][u]||0)+s:tt.removeCache(r?"audio":"image",a)}})})})}}]),e}();rt.image={},rt.audio={},window.RefManager=rt;var at=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"push",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=e.gifs,r=e.images,a="gif"===t.substr((Math.max(0,t.lastIndexOf("."))||1/0)+1).toLowerCase(),i=a?n:r,o=function(){var e=i.findIndex(function(e){var t=e.url;return 1===rt.count("image",t)});if(~e){var t=i[e].url;i.splice(e,1),rt.del("image",t,"cache"),tt.removeCache("image",t,!0)}},u=i.findIndex(function(e){return e.url===t});if(~u){var s=i[u];s.timestamp=Date.now(),i.splice(u,1),i.push(s)}else i.push({url:t,timestamp:Date.now()}),rt.add("image",t,"cache");a&&n.length>10&&o(),!a&&r.length>50&&o()}},{key:"pop",value:function(t){var n=e.gifs,r=e.images,a="gif"===t.substr((Math.max(0,t.lastIndexOf("."))||1/0)+1).toLowerCase()?n:r,i=a.findIndex(function(e){return e.url===t});~i&&(a.splice(i,1),rt.sub("image",t,"cache"))}}]),e}();at.gifs=[],at.images=[],window.DelayRemoveUtils=at;var it=83,ot=function(e){function t(e,n,r,a,o){var u;Object(i.a)(this,t),(u=ue(this,se(t).call(this,a,e,n))).name="MotionImage";var s=t.gameJson.motionImgMap;if(!(s&&r&&r.uuid&&s[r.uuid]))return ue(u);var c=t.gameJson.motionImgMap[r.uuid],l=c.width,d=c.height,h=c.timelines,f=c.frames,p=c.loop,v=c.images;u.motionImageData=c;var m=new PIXI.BaseTexture;m.width=l,m.height=d,m._glTextures=[],m.resolution=1,m.scaleMode=Phaser.scaleModes.DEFAULT,m.hasLoaded=!0,u.texture=new PIXI.Texture(m,new Phaser.Rectangle(0,0,l,d));var g=o.rectMask({alpha:0,rect:{width:l,height:d}});u.addChild(g);for(var y=[],_=function(e,t){var n=e.rotate,r=void 0===n?0:n;r=parseInt(r);var a=o.image(v[e.image].url,e);a.anchor.setTo(.5,.5),a.x+=a.width/2,a.y+=a.height/2,a.angle=180===r?179.9:r,a.frameData=e,a.key=null,t.add(a)},w=0,b=h.length;w<b;w++){var x=o.group(),P=h[w][0];P&&!P.frame&&_(P,x),x.mask=g,y.push(x),u.addChild(x)}var C=0,S=0;return u.timeoutID=setTimeout(function e(){if(++C>=f){if(S++,p&&S>=p)return;C=0}y.forEach(function(e,t){!C&&e.removeAll(!0);for(var n=e.children,r=0,a=(n=Object(k.a)(n)).length;r<a;r++){var i=n[r].frameData,o=i.frame;(o+i.during<=C||o>C)&&n[r].destroy()}h[t].forEach(function(t){t.frame===C&&_(t,e)})}),u.timeoutID=setTimeout(e,it)},it),u}return de(t,Phaser.Image),Object(o.a)(t,[{key:"destroy",value:function(e,n){var r=this.motionImageData;r&&r.images&&r.images.forEach(function(e){var t=e.url;return tt.subRef("image",t,"play")}),clearTimeout(this.timeoutID),ce(se(t.prototype),"destroy",this).call(this,e,n)}}]),t}(),ut=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"findImage",value:function(t){var n=e.gameJson.valueImgs,r=void 0===n?[]:n,a=ke.safeEval(t,e.playContext);return~a&&a>0?r[a-1]:(console.warn("未再图片库中找到对应内容".concat(JSON.stringify(t))),null)}}]),e}();ut.playContext=null,ut.gameJson=null;var st={boundsAlignH:"center",boundsAlignV:"middle",align:"center"},ct=function(e){var t=e.forceFontFamily,n=e.fontWeight,r=e.fontSize,a=void 0===r?12:r,i=e.color,o=void 0===i?"#000000":i,s=e.stroke,c=e.boundsAlignH,l=void 0===c?"left":c,d=e.boundsAlignV,h=void 0===d?"top":d,f=e.align;a=parseInt(a);var p=t||I.fontFamily||e.fontFamily||"宋体";return{font:"".concat(n||"normal"," ").concat(a?a+"px":""," ").concat(p),stroke:s,strokeThickness:s?2:0,fill:u.c.formatColor(o||"#000000"),boundsAlignH:l,boundsAlignV:h,align:f,fontSize:a,fontFamily:p}},lt=function(e,t){var n=t.width,r=t.height,a=Math.min(n/e.width,r/e.height);e.scale.setTo(a,a),e.x=(n-e.width)/2,e.y=(r-e.height)/2},dt=function(e){return function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.game.world.angle,o=this.characterWidth,s=this.characterHeight,c=this.stamp;c.angle=-i;for(var l=0;l<t.length;l++){var d=I.getRealImageCharOffset(t[l],e);if(vt.test(t[l]))n+=o-d+a;else{var h=I.getRealImageCharWidth(t[l])*c.scale.x-d;if(this.grabData[t.charCodeAt(l)]){var f=this.grabData[t.charCodeAt(l)],p=f.index,v=f.imageData;c.frame=p;var m=c.texture.baseTexture.source.getContext("2d");m.clearRect(0,0,o,s);var g=c.scale.x,y=v,_=y.width,w=y.height,b=y.data;if(g>1.3&&this.game.device.desktop){for(var k=m.createImageData(_,w),x=k.data,P=0;P<w;P++)for(var C=0;C<_;C++){var S=4*(P*_+C),O=Math.floor(1.5*b[S+3]);O=O>255?255:O,x.set([b[S],b[S+1],b[S+2],O],S)}v=k}m.putImageData(v,0,0),this.renderXY(this.stamp,n,r,!1)}else{for(var E=1;void 0===this.grabData[t.charCodeAt(l+E)]&&l+E<=t.length;)h+=I.getRealImageCharWidth(t[l+E])*c.scale.x-d,E++;var A=mt.text({width:h,height:s},{fontSize:e,forceFontFamily:"宋体",text:t.substr(l,E),color:u.c.formatColor(c.tint)});this.renderXY(A,n,r,!1),l+=E-1}if((n+=h+a)>this.width)break}}}},ht=function(e){var t=e.fontFamily,n=e.fontSize,r=Phaser.Text.fontPropertiesCache,a="".concat(n,"px '").concat(t,"'");if(!r[a]){var i=I.toRealSize(t,n).height;r[a]={fontSize:i,ascent:i/2,descent:0}}},ft=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=0,a=I.getSizeScale(t,n),i=0;i<e.length;i++)r+=Math.round(I.getRealImageCharWidth(e[i])*a-I.getRealImageCharOffset(e[i],n));return r},pt=/(?:\r\n|\r|\n)/,vt=/^[\s\x20\xA0\u2002\u2003\u3000]+$/,mt=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"group",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=game.make.group(void 0,e);if(t){var r=t.x,a=t.y,i=t.width,o=t.height;n.x=r,n.y=a,n.width=i,n.height=o}return n}},{key:"textarea",value:function(t,n){var r=t.x,a=void 0===r?0:r,i=t.y,o=void 0===i?0:i,s=t.width,c=void 0===s?0:s,h=(t.height,n.forceFontFamily),f=n.color,p=void 0===f?"#fefefe":f,v=n.fontSize,m=void 0===v?12:v,g=n.name,y=void 0===g?"":g;o=u.b.roundToInt(o),p=u.c.formatColor(p||"#000000");var _=game,w=_.make,b=_.add;if((h||!I.useFontImage)&&!l.a.ftfont){ht(ct(n));var k=w.text(a,o);return y&&(k.name=y),k.fill=p,k.useAdvancedWrap=!0,k.advancedWordWrap=d.advancedWordWrap,k.lineHeight=1.5*parseInt(m),k.setStyle=function(e){e=ct(e),ht(e),k.lineHeight=1.5*parseInt(e.fontSize),Phaser.Text.prototype.setStyle.call(k,O({},e,{wordWrap:!0,wordWrapWidth:c}),!0)},k.setTexts=function(e){k.clearColors();for(var t=0,n="",r=0;r<e.length;r++){var a=e[r],i=a.data,o=void 0===i?"":i,s=a.lineBreak,c=a.color,l=void 0===c?p:c;n+=o,l=l?u.c.formatColor(l):p,k.addColor(l,t),t+=s?0:o.length}k.setText(n,!0)},k.getLines=function(){return k.advancedWordWrap(k.text).split(pt)},k.getCharsWidth=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return k.context.measureText(e).width},k.setStyle(n),k}var x=I.fontFamily,P=I.charWidth,C=I.charHeight,S=e.group("textarea");S.x=a,S.y=o,S.texts=[];return S.setStyle=function(e){p=e.color||p,m=parseFloat(e.fontSize)},S.setTexts=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];S.removeAll(!0,!1,!0);for(var t=1.5*m,n=[""],r=0,a=0,i=0,o=(t-I.toRealSize(x,m).height)/2-.5|0,s=e[0]&&e[0].color||p,l="",d=function(e){l&&(!function(e){var t=e.text,n=e.color,r=e.x,a=e.y,i=b.retroFont(x,P,C),o=I.getSizeScale(x,m);i.characterWidth=P*o,i.characterHeight=C*o,i.stamp.scale.setTo(o,o),i.stamp.tint=u.c.toColorValue(n),i.pasteLine=dt(m),i.setFixedWidth(ft(t,x,m)),i.setText(t,!1,0,0,"left",!0);var s=b.image(r,a,i);s.destroy=function(){return Phaser.Image.prototype.destroy.call(s,!0,!0)},S.add(s)}({text:l,color:s,x:i,y:u.b.roundToInt(o)}),i+=ft(l,x,m)),l="",s=e},h=0;h<e.length;h++){var f=e[h],v=f.data,g=f.lineBreak,y=f.color,_=void 0===y?p:y;if(s!==_&&l&&d(_),g)!vt.test(l)&&d(e[h+1]&&e[h+1].color||p),i=a=0,o+=t,l=n[++r]="";else for(var w=0;w<v.length;w++){var k=ft(v[w],x,m);a+k>c?(d(_),i=0,a=k,o+=t,l=n[++r]=v[w]):(a+=k,n[r]+=v[w],l+=v[w])}}for(!vt.test(l)&&d(s);n.length&&(vt.test(n[n.length-1])||!n[n.length-1]);)n.splice(n.length-1,1);S.lines=n},S.getLines=function(){return S.lines},S.getCharsWidth=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return ft(e,x,m)},S.setStyle(n),S}},{key:"text",value:function(e,t){var n=this,r=e.x,a=void 0===r?0:r,i=e.y,o=void 0===i?0:i,s=e.width,c=void 0===s?0:s,l=e.height,d=void 0===l?0:l,h=t.forceFontFamily,f=t.hidden,p=t.text,v=void 0===p?"":p,m=t.name,g=void 0===m?"":m;if(f)return null;var y=game,_=y.make,w=y.add;if(h||!I.useFontImage){o=u.b.roundToInt(o),ht(ct(t));var b=_.text(0,0);return b.setTextBounds(a,o,c,d),g&&(b.name=g),b.setStyle=function(e){e=ct(e),ht(e),Phaser.Text.prototype.setStyle.call(b,e,!0)},b.setText=function(e){Phaser.Text.prototype.setText.call(b,e,!0);var t=b.width-c,n=b.style,r=n.align,i=n.boundsAlignH;"center"===r&&"center"===i&&t>0?b.setTextBounds(a-t/2,o,b.width,d):b.setTextBounds(a,o,c,d)},b.setStyle(t),b.setText(v),b}var k=I.fontFamily,x=I.charWidth,P=I.charHeight,C=w.retroFont(k,x,P),S=w.image(0,0,C);return g&&(S.name=g),S.setStyle=function(e){var t=ct(e),r=t.fill,a=t.boundsAlignH,i=t.boundsAlignV,o=t.align,s=void 0===o?"left":o,c=t.fontSize,l=I.getSizeScale(k,c);C.characterWidth=x*l,C.characterHeight=P*l,C.stamp.scale.setTo(l,l),C.stamp.tint=u.c.toColorValue(r),C.pasteLine=dt(c),C.setFixedWidth(ft(v,k,c)),C.setText=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Phaser.RetroFont.prototype.setText.apply(C,t),t[0]===C._text&&(C.removeUnsupportedCharacters(n.multiLine),C.buildRetroFontText())},C.align=s,S.fontStyle={boundsAlignH:a,boundsAlignV:i,fontSize:c}},S.setText=function(e){C.setText(e||" ",!1,0,0,"left",!0);for(var t=S.fontStyle,n=t.boundsAlignH,r=t.boundsAlignV,i=t.fontSize,s=0,l=I.getSizeScale(k,i),h=0;h<e.length;h++)s+=I.getRealImageCharWidth(e[h])*l-I.getRealImageCharOffset(e[h],i);var f=0;"center"===n?f=(c-s)/2:"right"===n&&(f=c-s),S.x=u.b.roundToInt(a+f);var p=0;"middle"===r?p=(d-C.height)/2:"bottom"===r&&(p=d-C.height),S.y=u.b.roundToInt(o+p)},S.setStyle(t),S.setText(v),Object.defineProperty(S,"text",{get:function(){return C.text},set:function(e){C.setText(e)}}),S.destroy=function(){return Phaser.Image.prototype.destroy.call(S,!0,!0)},S}},{key:"image",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=u.c.isObject(t),i=a&&t.type,o=r.x,s=void 0===o?0:o,c=r.y,l=void 0===c?0:c,d=r.centre,h=void 0!==d&&d,f=r.width,p=r.height,v=r.name,m=void 0===v?"":v,g=r.opacity,y=void 0===g?1:g,_=game,w=_.make,b=_.cache,k=_.time.events,x=null;if(a)if(i){var P=ut.findImage(t),C=P&&P.url?P.url:"";t=b.checkImageKey(C)?C:null,x=w.image(s,l,t,null)}else x=new ot(s,l,t,game,e);else t=b.checkImageKey(t)?t:null,x=w.image(s,l,t,null);if(x.alpha=y,m&&(x.name=m),h&&x.anchor.setTo(.5,.5),void 0!==f&&(x.width=f),void 0!==p&&(x.height=p),t&&(!a||i)){var S=b.getImage(t,!0).data,O=S.frameLength,E=S.loopCount,I=S.frames;if(I&&O>1){var A=0,M=0,T=0,V=function(e){I[e]&&(x.parent||x.game)&&x.setTexture(I[e].image)};!function e(){if(x.parent||x.game)if(I[A]){var t=k._now;k.add(I[A].delay,function(){var n=A;for(M+=k._now-t;I[A]&&M>=I[A].delay;)M-=I[A].delay,A+1>=O?(A=0,T++):A++;I[A]?E&&T>=E||!x.parent&&!x.game?n!=O-1&&V(O-1):(e(),n!==A&&V(A)):e()},n)}else setTimeout(e,10)}()}}return x}},{key:"button",value:function(t,n){var r=game,a=r.cache,i=r.make,o=t.x,u=t.y,s=t.width,c=t.height,l=n.normalUrl,d=n.activeUrl,h=n.disableUrl,f=n.audio,p=n.onClick,v=n.name,m=void 0===v?"":v,g=n.textOptions,y=void 0===g?{}:g,_=y.normal,w=y.active,b=y.disable,k=y.center,x=void 0===k||k,P=e.group(m,t);P.x=o,P.y=u;var C=[l,d,h],S=[e.image(l),e.image(d),e.image(h)];S.forEach(function(e,n){e.visible=!n,lt(e,t),P.add(e)});var E=i.button(0,0,null,p,this);E.width=s,E.height=c,P.add(E);var I=null;if(_){var A=x?O({},t,{x:0,y:0}):y.rect;(I=e.text(A,O({},_,st)))&&P.add(I)}var M=function(e,t){I&&t&&I.setStyle(t);var n=C.findIndex(function(t){return t===e});S.forEach(function(e){return e.visible=!1}),S[n].visible=!0},T=function(){E.inputEnabled&&M(d,O({},w||{},st)),f&&a.checkSoundKey(f.url)&&ae.play(f,!0)},V=function(){E.inputEnabled&&M(l,O({},_||{},st)),f&&a.checkSoundKey(f.url)&&ae.stop(f)};E.onInputOver.add(T),E.onInputDown.add(T),E.onInputOut.add(V),E.onInputUp.add(V),P.disable=function(){E.inputEnabled=!1,M(h,O({},b||{},st))},P.enable=function(){E.inputEnabled=!0,E.input.useHandCursor=!0,M(l,O({},_||{},st))},P.setText=function(e){return I&&I.setText(e,!0)},P.showText=function(e){return I.visible=!!e};var j=P.destroy;return P.destroy=function(){p=null,P.setText=null,P.disable=null,P.enable=null,E.input.mouseOut=null;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];j.apply(P,t)},P}},{key:"checkbox",value:function(t,n){var r=game.make,a=t.x,i=t.y,o=t.width,u=t.height,s=n.uncheckedUrl,c=n.checkedUrl,l=n.onClick,d=n.name,h=void 0===d?"":d,f=n.textOptions,p=void 0===f?{}:f,v=p.unchecked,m=p.checked,g=e.group(h,t);g.x=a,g.y=i;var y=[s,c],_=[e.image(s),e.image(c)];_.forEach(function(e,n){e.visible=!n,lt(e,t),g.add(e)});var w=r.button(0,0,null,l,this);w.width=o,w.height=u,g.add(w);var b=null;v&&(b=e.text(O({},t,{x:0,y:0}),O({},v,st)))&&g.add(b);var k=function(e,t){b&&t&&b.setStyle(t);var n=y.findIndex(function(t){return t===e});_.forEach(function(e){return e.visible=!1}),_[n].visible=!0};g.check=function(e){return e?k(c,O({},m||{},st)):k(s,O({},v||{},st))};var x=g.destroy;return g.destroy=function(){w.check=null;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];x.apply(g,t)},g}},{key:"sprite",value:function(e){var t=game.make,n=e.x,r=void 0===n?0:n,a=e.y,i=void 0===a?0:a;return t.sprite(r,i)}},{key:"rectMask",value:function(e){var t=e.color,n=void 0===t?0:t,r=e.alpha,a=void 0===r?1:r,i=e.x,o=void 0===i?0:i,s=e.y,c=void 0===s?0:s,l=e.rect,d=l.x,h=void 0===d?0:d,f=l.y,p=void 0===f?0:f,v=l.width,m=l.height,g=game.make.graphics(o,c);return g.beginFill(u.c.toColorValue(n),a),g.drawRect(h,p,v,m),g.endFill(),g}},{key:"tileSprite",value:function(e){var t=e.x,n=e.y,r=e.width,a=e.height,i=e.url;return game.make.tileSprite(t,n,r,a,i)}}]),e}(),gt=function(e,t,n,r){e&&!r[e]&&(n.push({url:e,type:t}),r[e]=t)},yt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=[],r=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return gt(e,r,n,t)},a=e.normal,i=e.active;return a&&a.background&&r(a.background.url),i&&i.background&&r(i.background.url),n},_t=function(e,t,n){return t.forEach(function(t){var r=e[t];r.normal&&r.normal.background&&n(r.normal.background.url),r.active&&r.active.background&&n(r.active.background.url)})},wt=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"getCoverAssets",value:function(e){var t=e.titleContainer,n={},r=[],a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return gt(e,t,r,n)};return t&&t.background&&a(t.background.url),_t(e,["startMenu","loadMenu","settingsMenu","overMenu"],a),r}},{key:"getDialogAssets",value:function(e){var t=e.background,n=e.avatarContainer,r=e.titleContainer,a={},i=[],o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return gt(e,t,i,a)};return t&&o(t.url),n&&n.background&&o(n.background.url),r&&r.background&&o(r.background.url),i}},{key:"getMainMenuAssets",value:function(e){var t=e.background,n=e.header,r={},a=[],i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return gt(e,t,a,r)};return t&&i(t.url),n&&n.background&&i(n.background.url),_t(e,["save","load","playback","autoplay","settings","back"],i),a}},{key:"getSettingsAssets",value:function(e){var t=e.background,n=e.header,r={},a=[],i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return gt(e,t,a,r)};return t&&i(t.url),n&&n.background&&i(n.background.url),_t(e,["back"],i),["musicVolume","soundVolume"].forEach(function(t){var n=e[t];n&&n.normal&&n.normal.background&&i(n.normal.background.url),n&&n.progress&&n.progress.background&&i(n.progress.background.url)}),["fullMode","windowMode","autoOn","autoOff"].forEach(function(t){var n=e[t];n&&n.checked&&n.checked.background&&i(n.checked.background.url),n&&n.unchecked&&n.unchecked.background&&i(n.unchecked.background.url)}),["header","displayHeader","textHeader","displayCaption","textCaption","soundCaption","musicCaption","volumeHeader"].forEach(function(t){var n=e[t];n&&n.background&&i(n.background.url)}),a}},{key:"getPlaybackAssets",value:function(e){var t={},n=[],r=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return gt(e,r,n,t)},a=e.background,i=e.scrollBox,o=(i||{}).item,u=(o||{}).content;return a&&r(a.url),i&&i.background&&r(i.background.url),o&&o.background&&r(o.background.url),u&&u.background&&r(u.background.url),_t(e,["back"],r),n}},{key:"getRecordAssets",value:function(e){var t={},n=[],r=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image";return gt(e,r,n,t)},a=e.background,i=e.scrollBox,o=(i||{}).item,u=(o||{}).content;return a&&r(a.url),i&&i.background&&r(i.background.url),o&&o.background&&r(o.background.url),u&&u.background&&r(u.background.url),_t(e,["back"],r),n}},{key:"getSoundAssets",value:function(e){var t=[],n=e.sound;return n&&n.url&&t.push({url:n.url,type:"audio"}),t}}]),e}();P(wt,"getMenuAssets",function(e){return yt(e)}),P(wt,"getShanyiMenuAssets",function(e){return yt(e)}),P(wt,"getOptionAssets",function(e){return yt(e)});var bt=n(132),kt=n.n(bt),xt=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"flex",value:function(e,t,n){var r=n.width,a=n.height,i=5;if(e===3){var o=t.width/t.height<r/a?r/t.width:a/t.height;t.width*=o,t.height*=o,t.x=-(t.width-r)/2,t.y=-(t.height-a)/2}else if(e===i){var u=0;t.width/t.height>r/a?(u=r/t.width,t.width*=u,t.height*=u,t.y=(a-t.height)/2):(u=a/t.height,t.width*=u,t.height*=u,t.x=(r-t.width)/2)}else t.width=r,t.height=a}},{key:"fullScreenTip",value:function(e){var t=e.text,n=void 0===t?"":t,r=e.alpha,a=void 0===r?1:r,i=e.fontSize,o=void 0===i?24:i,u=game.world,s=u.width,c=u.height,l=mt.group(),d=mt.rectMask({alpha:a,rect:{width:s,height:c}});return d.inputEnabled=!0,l.add(d),l.add(mt.text({width:s,height:c},{text:n,name:"text",fontSize:o,forceFontFamily:"宋体",color:"#fff",boundsAlignH:"center",boundsAlignV:"middle"})),l}}]),e}(),Pt=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"get",value:function(t,n){if(n&&2===n.length){var r=e.get(t,n[1]);return void 0!==r&&r.hasOwnProperty(n[0])?r[n[0]]:void 0}return t}},{key:"toArray",value:function(t){if(t&&2===t.length){var n=e.toArray(t[1]);return n.push(t[0]),n}return[]}},{key:"fromArray",value:function(e){var t=null;return e.forEach(function(e){t=[e,t]}),t}},{key:"stringify",value:function(e){for(var t="";e&&e.length>0;)t="/"+e[0]+t,e=e[1];return t&&(t+="/"),t}},{key:"isSame",value:function(t,n){return e.stringify(t)===e.stringify(n)}},{key:"merge",value:function(t,n){return n&&2===n.length?[n[0],e.merge(t,n[1])]:t}},{key:"createQuery",value:function(t,n){return t&&2===t.length?e.createQuery(t[1],P({},t[0],n)):n}},{key:"mergeQuerys",value:function(e){var t=["$push","$set","$unshift","$splice","$merge","$apply"],n={};return e.forEach(function(e){return n=function e(n,r){return"object"!==a(n)||null===n?r:"object"!==a(r)||null===r?n:(Object.keys(r).forEach(function(a){var i=null;i=t.some(function(e){return a===e})?n.hasOwnProperty(a)?n[a]:r[a]:e(n[a],r[a]),n=update(n,P({},a,{$set:i}))}),n)}(n,e)}),n}},{key:"compare",value:function(t,n){if(e.isSame(t,n))return 0;for(var r=[],a=[];t&&t.length;)r.unshift(t[0]),t=t[1];for(;n&&n.length;)a.unshift(n[0]),n=n[1];var i=(r.length>a.length?r.map(function(e,t){return t>=a.length?1:e===a[t]?0:e>a[t]?1:-1}):a.map(function(e,t){return t>=r.length?-1:e===r[t]?0:e>r[t]?-1:1})).find(function(e){return 0!==e});return void 0===i?0:i}},{key:"getTopPaths",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter(function(n){return!t.some(function(t){return e.stringify(n).startsWith(e.stringify(t))&&!e.isSame(t,n)})})}}]),e}(),Ct=(n(68),function(e){for(var t=e.x,n=e.y,r=e.width,a=e.height,i=e.view,o=game,u=o.canvas,s=o.world,c=u.getBoundingClientRect(),d=s.width,h=s.height,f=l.a.vertical,p=[],v=i.parent;v!==s;)p.unshift(v),v=v.parent;for(var m=0,g=0,y=1,_=1,w=0;w<p.length;w++){var b=p[w],k=b.scale,x=b.x,P=b.y;m+=x*y,g+=P*_,y*=k.x,_*=k.y}var C=1,S=1;t=t*y+m,n=n*_+g;var O=function(){r*=y,a*=_};if(c.width>c.height){C=(f?c.height:c.width)/d,S=(f?c.width:c.height)/h,O();var E=t,I=n;t=f?c.left+c.width-I*S:c.left+E*C,n=f?c.top+E*C:c.top+I*S}else{C=(f?c.width:c.height)/d,S=(f?c.height:c.width)/h,O();var A=t,M=n;t=f?c.left+A*C:c.left+c.width-M*S,n=f?c.top+M*S:c.top+A*C}return{x:t,y:n+=c.top<0?-c.top:0,width:r,height:a,scale:_*S*i.scale.y}});function St(e){var t=this,n=e.game,r=e.x,a=e.y,i=e.width,o=e.height,s=e.text,c=e.color,l=e.fontSize,d=e.fontFamily,h=e.bold;Phaser.Group.call(this,n,null),this.game=n,this.name="input";var f=document.createElement("input");f.style.position="absolute",f.style.margin="0",f.style.border="0",f.style.padding="0",f.style.left=r+"px",f.style.top=a+"px",f.style.width=i+"px",f.style.height=l+6+"px",f.style.color=c,f.style.backgroundColor="transparent",f.style.borderColor="transparent transparent transparent transparent",f.style.outline="none",f.style.fontSize=l+"px",f.style.fontFamily=d,f.style.fontWeight=h?"bold":"normal",f.style.visibility="hidden",u.c.setElemetStyle(f,"transformOrigin","left top"),document.body.appendChild(f),this.element=f,this._x=r,this._y=a,this._width=i,this._height=o,this._fontSize=l,this.text=s,this.isNumber=!1,this.onDestroy.add(function(){return document.body.removeChild(t.element)},this)}St.prototype=Object.create(Phaser.Group.prototype),St.prototype.constructor=St,St.prototype.update=function(){var e=this.game.canvas,t=l.a.vertical,n=e.getBoundingClientRect();if(!this.oldRect||this.oldRect.width!=n.width||this.oldRect.height!=n.height||this.oldRect.left!=n.left||this.oldRect.top!=n.top){this.oldRect={left:n.left,top:n.top,width:n.width,height:n.height},this.visible&&this.parent&&"visible"!==this.element.style.visibility&&this.show(!0);var r,a=this._x,i=this._y,o=this._width,s=this._height,c=this.scale,d=Ct({x:a,y:i,width:o,height:s,view:this});a=d.x,i=d.y,o=d.width,s=d.height,r=d.scale,n.width>n.height?u.c.setElemetStyle(this.element,"transform","".concat(t?"rotate(90deg)":"rotate(0deg)"," scale(").concat(r,")")):u.c.setElemetStyle(this.element,"transform","".concat(t?"rotate(0deg)":"rotate(90deg)"," scale(").concat(r,")")),this.setLeft(a),this.setTop(i),this.setWidth(o)}},St.prototype.destroy=function(){game.gameResumed(),document.body.removeChild(this.element)},St.prototype.show=function(e){this.visible=e,this.element.style.visibility=e?"visible":"hidden"},St.prototype.setInputCallback=function(e){var t=this,n=function(){var n=t.element.value;t.element.focus(),t._text=n,u.c.getSensitiveWords().forEach(function(e){if(0!==e.length&&-1!==t._text.indexOf(e)){var n="*".repeat(e.length);t.element.value=t._text=t._text.replace(new RegExp(e,"gi"),n)}}),t.isNumber&&(/^(\-|\+)?\d*(\.)?(\d)*?$/.test(n)||(n=parseFloat(n)||0),t.element.value=t._text=be.limitRange(n)),e(!1)};if("ios"===l.a.client||navigator.userAgent.indexOf("iPhone")>-1){var r=navigator.userAgent.match(/CPU\siPhone\sOS\s((([0-9]*)+(_))*)+([0-9]*)/gi);r&&(r[0]>="CPU iPhone OS 10_3_1"||"CPU iPhone OS 10_0_2"===r[0])?this.element.addEventListener("input",n,!1):this.element.addEventListener("compositionend",function(){t.element.removeEventListener("input",n,!1),t.element.addEventListener("input",n,!1)},!1)}else this.element.addEventListener("input",n,!1);this.element.addEventListener("mousedown",function(){return e(!1)},!1),this.element.addEventListener("touchstart",function(){return e(!1)},!1),this.element.onblur=function(){if(game.gameResumed(),t.isNumber){var n=parseFloat(t._text);t.text=be.toFixed(n||0,2)}e(!0);var r=t.game,a=r.device.iOS,i=r.scale;a&&setTimeout(function(){game.gameResumed(),i.updateLayout(),i.signalSizeChange(),(t.oldRect={})&&t.parent&&t.update()},20)}},St.prototype.setClickCallback=function(e){var t=this;this.element.addEventListener("click",function(){return e(t)},!1)},St.prototype.setLeft=function(e){this.element.style.left=e+"px"},St.prototype.setTop=function(e){this.element.style.top=e+"px"},St.prototype.setWidth=function(e){this.element.style.width=e+"px"},St.prototype.setFontSize=function(e){e=e<10?10:e,this.element.style.fontSize=e+"px",this.element.style.height=e+6+"px"},St.prototype.setEnable=function(e){this.element.readOnly=(!!e).toString()},Object.defineProperty(St.prototype,"x",{get:function(){return this._x},set:function(e){var t=Ct({x:e,view:this}).x;this.setLeft(t),this._x=e}}),Object.defineProperty(St.prototype,"y",{get:function(){return this._y},set:function(e){var t=Ct({y:e,view:this}).y;this.setTop(t),this._y=e}}),Object.defineProperty(St.prototype,"width",{get:function(){return this._width},set:function(e){var t=Ct({width:e,view:this}).width;this.setWidth(t),this._width=e}}),Object.defineProperty(St.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e}}),Object.defineProperty(St.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this.setFontSize(fontSize),this._fontSize=e}}),Object.defineProperty(St.prototype,"style",{get:function(){return this._style},set:function(e){for(var t in e)this.element.style[t]=e[t];this._style=e}}),Object.defineProperty(St.prototype,"text",{get:function(){return this._text},set:function(e){this.element.value=e,this._text=e,"[未知数值]"===e&&this.setEnable(!1)}}),Object.defineProperty(St.prototype,"readOnly",{get:function(){return this.readOnly},set:function(e){this.setEnable(e),this.element.readOnly=(!!e).toString()}});var Ot=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"container",value:function(t){var n=t.data,r=t.path,a=t.onMount,i=n.x.value,o=n.y.value,u=n.view,s=n.calledViews,c=n.scale,l=void 0===c?1:c,d=u.width,h=u.height,f=u.content.background,p=u.children,v=mt.group("",{x:i,y:o}),m=mt.image(f.url,{name:"background"});m.key?xt.flex(5,m,{width:d,height:h}):(m.width=d,m.height=h),m.inputEnabled=!0,m.input.useHandCursor=!0,v.add(m);for(var g=["children",["view",r]],y=0,_=p.length;y<_;y++){e[x=p[y].view.type]&&v.add(e[x]({data:p[y],path:[y,g],onMount:a}))}var w=mt.group("calledViews");g=["calledViews",r];for(var b=0,k=s.length;b<k;b++){var x;e[x=s[b].view.type]&&w.add(e[x]({data:s[b],path:[b,g],onMount:a}))}return v.add(w),v.scale.setTo(l,l),a(v,n,r),v}},{key:"button",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,i=t.y.value,o=t.view,u=t.scale,s=void 0===u?1:u,c=o.width,l=o.height,d=o.content,h=d.background,f=d.sound,p=mt.button({x:a,y:i,width:c,height:l},{normalUrl:h.normal.url,activeUrl:h.active.url,audio:f});return p.scale.setTo(s,s),r(p,t,n),p}},{key:"text",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,i=t.y.value,o=t.view,s=t.scale,c=void 0===s?1:s,l=o.width,d=o.height,h=o.content,f=h.color,p=h.bold,v=h.font_size,m=h.value,g=mt.group("",{x:a,y:i});g.add(mt.rectMask({alpha:0,rect:{width:l,height:d}}));var y=mt.textarea({width:l,height:d},{fontSize:v,color:f,fontWeight:p?"bold":"normal"});y.inputEnabled=!0,y.input&&(y.input.useHandCursor=!0);var _=m;return Array.isArray(_)||(_=u.c.toArrayForData(_).map(function(e){return O({},e,{color:f})})),y.setTexts(_),g.add(y),g.scale.setTo(c,c),g.setTexts=function(){return y.setTexts.apply(y,arguments)},r(g,t,n),g}},{key:"input",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,i=t.y.value,o=t.view,u=t.scale,s=void 0===u?1:u,c=o.width,l=o.height,d=o.content,h=d.color,f=d.font_size,p=d.bold,v=d.value.value,m=d.fontFamily,g=new St({game:game,x:a,y:i,width:c,height:l,text:v,color:h,bold:p,fontSize:f,fontFamily:m||I.fontFamily});return g.scale.setTo(s,s),r(g,t,n),g}},{key:"image",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,i=t.y.value,o=t.view,u=t.scale,s=void 0===u?1:u,c=o.width,l=o.height,d=o.content.background,h=mt.image(d.url,{width:c,height:l}),f=mt.group("",{x:a,y:i});return h.inputEnabled=!0,h.input.useHandCursor=!0,f.add(h),f.scale.setTo(s,s),r(f,t,n),f}},{key:"bar",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,i=t.y.value,o=t.view,u=t.scale,s=void 0===u?1:u,c=o.width,l=o.height,d=o.content,h=d.background,f=d.value,p=f.normal,v=f.progress,m=d.basePoint,g=d.style,y=mt.group(),_=mt.image(h.normal.url,{width:c,height:l}),w=mt.image(h.progress.url,{width:c,height:l});_.inputEnabled=!0,_.input.useHandCursor=!0,_.key||(_.width=c,_.height=l),y.add(_),y.add(w);var b,k,x=p.width.value,P=p.height.value,C=v.width.value,S=v.height.value;b=(x<=0||C<0?0:C>x?1:1*C/x)*c,k=(P<=0||S<0?0:S>P?1:1*S/P)*l;var O=m.x>0?m.x==c?m.x-b:m.x-b/2:m.x,E=m.y>0?m.y==l?m.y-k:m.y-k/2:m.y;if("clip"===g){var I=mt.rectMask({color:16777215,rect:{x:O,y:E,width:b,height:k}});y.add(I),w.mask=I}else w.x=O,w.y=E,w.width=b,w.height=k;return y.x=a,y.y=i,y.scale.setTo(s,s),r(y,t,n),y}},{key:"timer",value:function(e){var t=e.data,n=e.path,r=e.onMount,a=t.x.value,i=t.y.value,o=mt.image(null,{x:a,y:i});return r(o,t,n),o}}]),e}(),Et=null,It=1,At=0,Mt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(Et?Et.update(e):Et=new Tt(e)).show()},Tt=function(){function e(t){var n=t.type,r=t.text;Object(i.a)(this,e),this.container=mt.group(),this.render(),this.update({type:n,text:r})}return Object(o.a)(e,[{key:"show",value:function(){var e=l.a.vertical,t=game.world,n=this.animating,r=this.container;r.x=(t.width-this.text.width)/2,r.y=e?100:252;var a=r.parent;a&&a.remove(r),t.add(r),a=t,n&&n.cancel&&n.cancel(),r.alpha=1,this.animating=q.to({target:r,properties:{alpha:0},duration:2500}),this.animating.then(function(){a.remove(r),r.visible=!1})}},{key:"update",value:function(e){var t=e.type,n=e.text,r=void 0===n?"":n,a=this.icon,i=this.background,o=this.text,u=this.container;try{u.visible=!0,game.cache.checkKey(Phaser.Cache.IMAGE,t===It?"icon_success":"icon_error")&&a.loadTexture(t===It?"icon_success":"icon_error"),o.setText(r),i.clear(),i.beginFill(4048076),i.drawRect(0,0,o.width+40,32),i.endFill()}catch(e){var s=u.parent;s&&s.remove(u),u.visible=!1}return this}},{key:"render",value:function(){this.background=game.make.graphics(),this.container.add(this.background),this.icon=mt.image("icon_success",{x:10,y:8}),this.container.add(this.icon),this.text=mt.text({x:30,y:8},{fontSize:16,forceFontFamily:"宋体",color:"#ffffff"}),this.container.add(this.text)}}]),e}(),Vt="".concat(l.a.uuid,"payInfo").concat(l.a.uid),jt=!1,Ut=-2,Dt=""!==l.a.u&&""!==l.a.token&&""!==l.a.uid,Rt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||0==t.length)return!1;for(var r=function(r){var a=t[r],i=-1;return-1!==e.payValues.findIndex(function(e){return e.uuid===a.uuid})?(n&&(jt=!0),{v:!0}):e.indexValues&&-1!==(i=e.indexValues.findIndex(function(e){return e.uuid===a.uuid}))&&"payValue"===e.indexValues[i].init.type&&a.reference?(n&&(jt=!0),{v:!0}):void 0},i=0;i<t.length;i++){var o=r(i);if("object"===a(o))return o.v}return!1},Bt=function e(){Object(i.a)(this,e)};P(Bt,"updateFansInfo",function(e){return l.a.singleoffline?Promise.resolve(e):function(){var e=l.a.client,t=l.a.gid,n=l.a.wap;if("wap"===e&&"wx"===n)return Promise.resolve(0);"ios"!==e&&"android"!==e&&"wap"!==e&&"pc"!==e&&(l.a.uid=u.c.getUidByCookie());var r=function(){return Object(we.b)({url:Ie.getFansInfo,data:"opus_id=".concat(t,"&uid=").concat(l.a.uid)}).then(function(e){var t=e.responseText;return 0===t.length?Promise.resolve("Get getFansInfo failed, no response data"):JSON.parse(t).data.fans_total||0})};return"wap"===e?Re().then(function(){return l.a.uid?r():Promise.resolve(0)}):"pc"===e?Be().then(function(){return r()},function(){return Promise.resolve(0)}):l.a.uid?r():Promise.resolve(0)}().then(function(t){return u.c.isString(t)?e:S()(e,{systemValues:P({},9,{value:{$set:t}})})},function(){return Promise.resolve(e)})}),P(Bt,"updateAccinfo",function(e,t){var n=l.a.singleoffline,r=l.a.uuid;if(n){var a=D.singleGetValue("".concat(r,"usersysteminfo"));return a?Promise.resolve(S()(e,{systemValues:{$set:JSON.parse(u.c.decryptBase64(a))}})):Promise.resolve(e)}return function(){var e=l.a.client,t=l.a.u,n=l.a.v,r=l.a.app_version,a=l.a.token,i=l.a.gid,o=l.a.wap;if("wap"===e&&"wx"===o)return Promise.reject();var u=function(e,t){return Object(we.c)({url:e,data:t,timeout:4e3}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"Get AccountInfo failed, no response data"});var n={};try{n=JSON.parse(t)}catch(e){return Promise.reject({code:we.a.ERROR,message:"Get AccountInfo failed, no response data"})}var r=n,a=r.status,i=r.data;return 0===a?{coinTotal:i.payment_available||0,starTotal:i.game_coin_available||0,usedStarCount:i.single_game_star_use||0,gameStarLimit:i.single_game_star||0}:Promise.reject(n)},function(e){return Promise.reject({status:100,msg:e})})};if("ios"===e||"android"===e){var s="".concat(Ie.appUserInfo,"&client=").concat(e,"&v=").concat(n,"&app_version='").concat(r),c="u=".concat(Ae(t,1),"&token=").concat(Ae(a,1),"&game_id=").concat(Ae(i,1));return u(s,c)}return"wap"===e?Re().then(function(){return u(Ie.wapUserInfo,"gid=".concat(i))}):"pc"===e?Be().then(function(){return u(Ie.wapUserInfo,"gid=".concat(i))}):Fe().then(function(){return u(Ie.wapUserInfo,"gid=".concat(i))})}().then(function(n){var r;return t&&t(n),S()(e,{systemValues:(r={},P(r,0,{value:{$set:n.coinTotal||0}}),P(r,1,{value:{$set:n.starTotal||0}}),r)})},function(){return Promise.resolve(e)})}),P(Bt,"saveAccinfo",function(e){var t=l.a.uuid;l.a.singleoffline&&D.singleSaveValue("".concat(t,"usersysteminfo"),u.c.encodeBase64(JSON.stringify(e)))}),P(Bt,"updatePayValues",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=l.a.offline,o=l.a.app_version,s=l.a.client,c=l.a.wap,d=l.a.singleoffline,h=l.a.type,f=l.a.single,p=!(u.c.compareVersions(o,"1.11.0")<0);if(1==h)return Promise.resolve(e);var v=function(){a?A.a.info("pc"===s?"商城操作失败，请登录正确的账号后重新尝试":"当前网络信号差，商城".concat(f?"":"、成就等账号","功能无法正常使用，请检查网络设置后，重新打开作品")).then(function(){},function(){}):1==focus&&0==t.length&&A.a.custom("Info",r?"登录账号后值与本地不一致，继续会造成数值错误，建议刷新作品！":"当前网络不稳定，继续可能造成数据丢失，建议刷新作品！","警告",p?"刷新":"确定","取消",!1).then(function(){return p?D.refreshApp():{}},function(){}),Bt.uploadPayValues=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Promise.resolve(!1)},Bt.updatePayValues=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4]);return(Rt(e,t)||n)&&(r?A.a.info("pc"===s?"商城操作失败，请登录正确的账号后重新尝试":"当前网络信号差，商城".concat(f?"":"、成就等账号","功能无法正常使用，请检查网络设置后，重新打开作品")).then(function(){},function(){}):A.a.custom("Info","当前网络不稳定，请刷新作品重新获取数据，继续会造成数据错误！","警告",p?"刷新":"确定","取消",!1).then(function(){return p?D.refreshApp():{}},function(){})),Bt.fristUpdateSuccess=!1,Bt.updatePayValueError=!0,Promise.resolve(e)},Bt.fristUpdateSuccess=!1,Bt.updatePayValueError=!0},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(""===e)return Promise.resolve(t);var n=JSON.parse(u.c.decryptBase64(e));return function e(r){if(r>=n.length)return Promise.resolve(t);var a=n[r],i=a.value,o=a.uuid,u=t.payValues.findIndex(function(e){return e.uuid==o});return~u&&(t=S()(t,{payValues:P({},u,{value:{$set:void 0===i?ke.safeInitValue(n[r]):i}})})),e(++r)}(0)},g=function(){A.a.info("当前网络不稳定，继续玩可能会造成数据丢失，请在网络良好的情况下重新打开作品！").then(function(){},function(){}),Bt.uploadPayValues=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Promise.resolve(!1)},Bt.updatePayValues=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(Rt(e,t)||n)&&A.a.info("当前网络不稳定，继续玩可能会造成数据丢失，请在网络良好的情况下重新打开作品！").then(function(){},function(){}),Bt.fristUpdateSuccess=!1,Bt.updatePayValueError=!0,Promise.resolve(e)},Bt.fristUpdateSuccess=!1,Bt.updatePayValueError=!0};if(n||Rt(e,t)){var y="";if(d){var _=D.singleGetValue("".concat(l.a.uuid,"payInfo"));return m(y=null===_?"":_,e).then(function(e){return e})}if("wap"===s&&"wx"===c){var w=D.localStorageGetItem("".concat(l.a.uuid,"payInfo").concat(l.a.uid));return m(y=null===w?"":w,e).then(function(e){return e})}return!1!==Bt.updatePayValueError?(i?g():v(),Promise.resolve(e)):("pc"===s?Be().then(function(){return!0},function(){return!0}):Promise.resolve()).then(function(){return function(){var e=l.a.client,t=l.a.v,n=l.a.u,r=l.a.token,a=l.a.app_name,i=l.a.device_name,o=l.a.deviceOsVer,s=l.a.gid,c=l.a.app_version,d=function(e,t){return Object(we.c)({url:e,data:t,timeout:4e3}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"Get AccountInfo failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.data,i=n.msg;if(a){var o=a.content;if(-1==r||0==r)return-1==r?Promise.resolve({code:-1,data:null}):0!=r||a&&o&&""!=o?Promise.resolve({code:1,data:o}):Promise.resolve({code:0,data:null});if(-2==r)return Promise.resolve({code:-2,data:null});if(r>0&&r<9)return Promise.resolve({code:-3,data:null});if(-12==r||100==r)return Promise.resolve({code:-1,data:null})}return Promise.reject("获取用户信息失败("+i+":"+r+")")},function(e){return Promise.reject("获取用户信息权限错误(".concat(e,")"))})},h=n&&r?1:0,f=u.a.getCurDate(),p=""===s?1:parseInt(s),v="";v=h?"app_name=".concat(a||"shanyi","&device_name=").concat(i||"Google Nexus S","&device_system_version=").concat(o||"4.1.1")+"&gid=".concat(p,"&time=").concat(f,"&token=").concat(r,"&u=").concat(n,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"):"gid=".concat(p,"&time=").concat(f,"&v_key=0GjRAtUUoK4BwJGUz73jBa2M");var m="gid=".concat(Ae(p,h),"&sign=").concat(Ae(ge.a.hash(ge.a.hash(v)),h),"&time=").concat(Ae(f,h));try{return n&&r?d("".concat(Ie.appGetPlayValues,"&client=").concat(e,"&v=").concat(t,"&app_version=").concat(c),"".concat(m,"&").concat(ze())):d(Ie.wapGetPlayValues,m)}catch(e){return console.error("update payvalue error ",e),Promise.reject("获取用户信息失败!")}}()}).then(function(t){if("pc"==s&&(r=u.c.midWayLoginFromePc),-2==t.code)return Bt.uploadPayValues=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Promise.resolve(!1)},Bt.updatePayValues=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Promise.resolve(e)},e;if("pc"===s&&!1!==u.c.hasChangeUserFromePc&&jt)return v(),e;if(i){if(!(-2!==Ut||jt||Dt&&-3!==t.code||(Ut=0,r))){var n=D.localStorageGetItem("offline".concat(l.a.uuid,"payInfo"));return m(y=null==n?"":n,e).then(function(e){return e})}if(-1===Ut){if((Dt||r)&&jt)return g(),Promise.resolve(e);if(!Dt&&!r)return Promise.resolve(e)}else if(0===Ut){if(!r)return Promise.resolve(e);if(jt)return g(),Promise.resolve(e)}}if(Ut=1,0==t.code){var a=D.localStorageGetItem(Vt);D.localStorageRemoveItem(Vt),null==a&&(a=D.localStorageGetItem("".concat(l.a.uuid,"payInfo")),D.localStorageRemoveItem("".concat(l.a.uuid,"payInfo"))),y=null==a?"":a}else if(-1==t.code||-3==t.code){var o=D.localStorageGetItem(Vt);if(y=null==o?"":o,jt&&Bt.fristUpdateSuccess)return v(),e}else if(1==t.code&&(y=null==t.data?"":t.data,r&&jt))return u.c.midWayLoginFromePc=!1,v(),m(y,e).then(function(e){return e});return-1==t.code&&""!==l.a.uid?(v(),e):""!==y?m(y,e).then(function(e){return 0==t.code?Bt.uploadPayValues(e,[],!0).then(function(t){return!1===t&&v(),Bt.fristUpdateSuccess=t,e}):(1==t.code&&(Bt.fristUpdateSuccess=!0),e)}):-1===t.code?e:Bt.uploadPayValues(e,[],!0).then(function(t){return!1===t&&v(),e})},function(t){if(Bt.fristUpdateSuccess=!1,i){if(!jt){var n=D.localStorageGetItem("offline".concat(l.a.uuid,"payInfo"));return Ut=-1,m(y=null==n?"":n,e).then(function(e){return e})}(0===Ut&&Dt||1===Ut)&&g()}else v();return Promise.resolve(e)}).catch(function(){return Promise.resolve(e)})}return Promise.resolve(e)}),P(Bt,"uploadPayValues",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=l.a.offline,a=l.a.client,i=l.a.wap,o=l.a.uuid,s=l.a.uid,c=l.a.singleoffline;if(1==l.a.type)return Promise.resolve(!0);if(Rt(e,t,!0)||n){if(c)return D.singleSaveValue("".concat(o,"payInfo"),u.c.encodeBase64(JSON.stringify(e.payValues))),Promise.resolve(!0);if("wap"===a&&"wx"===i){var d=u.c.encodeBase64(JSON.stringify(e.payValues));return D.localStorageSetItem("".concat(o,"payInfo").concat(s),d,365),Promise.resolve(!0)}return function(e){var t=l.a.uuid,n=l.a.uid,r=l.a.client,a=l.a.u,i=l.a.v,o=l.a.token,s=l.a.app_name,c=l.a.device_name,d=l.a.deviceOsVer,h=l.a.gid,f=l.a.app_version,p=l.a.offline,v=u.c.encodeBase64(JSON.stringify(e)),m=function(e,r){return Object(we.c)({url:e,data:r,timeout:4e3}).then(function(e){var r=e.responseText;if(0===r.length)return Promise.reject({error:"用户数据无法保存，请在网络恢复后重新操作"});var a=JSON.parse(r).status;return 0===a?{succee:!0,msg:"用户数据保存成功！"}:-1===a?(p?D.localStorageSetItem("offline".concat(t,"payInfo"),v):D.localStorageSetItem("".concat(t,"payInfo").concat(n),v),Promise.reject({error:"温馨提醒：登录后才可以同步用户数据哦～",status:a})):2===a?Promise.reject({error:"用户数据保存失败，账号已在其他设备登录",status:a}):Promise.reject({error:"用户数据无法保存，请在网络恢复后重新操作",status:a})},function(e){return p?D.localStorageSetItem("offline".concat(t,"payInfo"),v):D.localStorageSetItem("".concat(t,"payInfo"),v),Promise.reject({error:"用户数据无法保存，请在网络恢复后重新操作",status:999})})},g=a&&o?1:0,y=u.a.getCurDate(),_=""===h?1:parseInt(h),w="";w=g?"app_name=".concat(s||"shanyi","&content=").concat(v,"&device_name=").concat(c||"Google Nexus S","&device_system_version=").concat(d||"4.1.1")+"&gid=".concat(_,"&progress=1&time=").concat(y,"&token=").concat(o,"&u=").concat(a,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"):"content=".concat(v,"&gid=").concat(_,"&progress=1&time=").concat(y,"&v_key=0GjRAtUUoK4BwJGUz73jBa2M");var b="content=".concat(Ae(v,g),"&gid=").concat(Ae(_,g),"&progress=").concat(Ae(1,g),"&sign=").concat(Ae(ge.a.hash(ge.a.hash(w)),g),"&time=").concat(Ae(y,g));try{return a&&o?m("".concat(Ie.appSavePlayValues,"&client=").concat(r,"&v=").concat(i,"&app_version=").concat(f),"".concat(b,"&").concat(ze())):m(Ie.wapSavePlayValues,b)}catch(e){return console.error("upload payvalue error ",e),Promise.reject({error:"用户数据保存失败！",status:999})}}(e.payValues).then(function(e){return!0},function(e){var t=e.status,n=e.error;return!r||999!==t&&-1!==t||!0,Mt({type:At,text:n}),!0!==Bt.updatePayValueError&&-1!==t&&(r?1===Ut&&(Bt.updatePayValueError=!0):Bt.updatePayValueError=!0),Promise.resolve(!1)})}return Promise.resolve(!1)}),P(Bt,"updateUserAccInfo",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Bt.updatePayValues(e,[],!0,t).then(function(e){return Bt.updateAccinfo(e)}).then(function(e){return Bt.updateFansInfo(e)}).then(function(e){return Bt.fristUpdateSuccess?Bt.uploadPayValues(e,[],!0).then(function(t){return Bt.fristUpdateSuccess=!1,e}):e})}),Bt.updatePayValueError=!1,Bt.fristUpdateSuccess=!1;var Lt=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"updateViews",value:function(t){var n=t.nodes,r=t.viewDatas,a=t.parent,i=t.path,o=t.onMount,u=t.onUpdate;n=Object(k.a)(n);for(var s=0;s<n.length;){var c=n[s],l=c.viewData,d=void 0===l?{}:l,h=r[s]||{};h.instanceUuid===d.instanceUuid?(h!==d&&e.updateView({node:c,viewData:h,path:[s,i],onMount:o,onUpdate:u}),s++):(c.parent.remove(c,!0),n.splice(s,1))}for(;s<r.length;){var f=r[s],p=f.view.type,v=f.visible,m=void 0===v||v;if(Ot[p]){var g=Ot[p]({data:r[s],path:[s,i],onMount:o,onUpdate:u});a.add(g),g.visible=m,"input"===p&&g.update(),g.updateTransform()}s++}}},{key:"updateView",value:function(t){var n=t.node,r=t.viewData,a=t.path,i=t.onMount,o=t.onUpdate,s=n.viewData,c=r.x.value,l=r.y.value,d=r.view,h=r.calledViews,f=r.visible,p=void 0===f||f,v=d.type,m=d.width,g=d.height,y=d.content,_=d.children;switch(n.x=c,n.y=l,v){case"container":var w=n.children.find(function(e){return"calledViews"===e.name});if(s.calledViews!==h){var b=["calledViews",a],k=w.children;e.updateViews({nodes:k,viewDatas:h,parent:w,path:b,onMount:i,onUpdate:o})}if(s.view.children!==_){var x=n.children.filter(function(e){return"calledViews"!==e.name&&"background"!==e.name}),P=["children",["view",a]];e.updateViews({nodes:x,viewDatas:_,parent:n,path:P,onMount:i,onUpdate:o})}n.bringToTop(w);break;case"text":if(s.view.content!==y){var C=y.value,S=y.color;Array.isArray(C)||(C=u.c.toArrayForData(C).map(function(e){return O({},e,{color:S})})),n.setTexts(C)}break;case"input":s.view.content!==y&&(n.text=y.value.value);break;case"bar":if(s.view.content!==y){var E,I,A=y.value,M=A.normal,T=A.progress,V=y.basePoint,j=y.style,U=n.children[1],D=M.width.value,R=M.height.value,B=T.width.value,L=T.height.value;E=(D<=0||B<0?0:B>D?1:1*B/D)*m,I=(R<=0||L<0?0:L>R?1:1*L/R)*g;var F=V.x>0?V.x==m?V.x-E:V.x-E/2:V.x,z=V.y>0?V.y==g?V.y-I:V.y-I/2:V.y,W="clip"===j?U.mask.graphicsData[0].shape:U;W.x=F,W.y=z,W.width=E,W.height=I}}n.visible=p,o(n,r,a)}},{key:"getViewPathInfos",value:function(e,t){for(var n=Pt.toArray(e),r=[],a=[null,null],i=t;n.length;){var o=n.shift();a[0]=o,i[o].instanceUuid&&r.push({instanceUuid:i[o].instanceUuid,path:a}),i=i[o],a=[null,a]}return r}},{key:"updateViewPathInfos",value:function(e,t){for(var n=!1,r=function(r){if(n)e[r].path[0]=-1;else{var a=e[r].path,i=(Pt.get(t,a[1])||[]).findIndex(function(t){return t.instanceUuid===e[r].instanceUuid});-1===i&&(n=!0),e[r].path[0]=i}},a=0;a<e.length;a++)r(a);return e}},{key:"instanceView",value:function(t,n,r){var a=t.ref,i=n.viewMap,o=n.default_settings.color,u=Object.assign({},i[a]),s=O({instanceUuid:"lv_".concat(he())},t,{view:u,calledViews:[],visible:!0}),c=u.content;if("text"===u.type){var l=c.value;c=S()(c,{value:{$set:ke.parseValue(l,r)},color:{$apply:function(e){return e||o}}})}else if("bar"===u.type){var d=c.value,h=d.normal,f=d.progress;c=S()(c,{value:{normal:{width:{value:{$set:ke.safeEval(h.width,r)}},height:{value:{$set:ke.safeEval(h.height,r)}}},progress:{width:{value:{$set:ke.safeEval(f.width,r)}},height:{value:{$set:ke.safeEval(f.height,r)}}}}})}else if("input"===u.type){var p=c.value;c=S()(c,{value:{value:{$set:ke.safeEval(p,r)}}})}return S()(s,{x:{value:{$set:ke.safeEval(t.x,r)}},y:{value:{$set:ke.safeEval(t.y,r)}},view:{children:{$apply:function(t){return t.map(function(t){return e.instanceView(t,n,r)})}},content:{$set:c}}})}},{key:"fixInstanceView",value:function(t,n,r,a){var i=r.viewMap,o=n.x,u=n.y,s=n.events,c=n.ref,l=Object.assign({},i[c]),d=t.view.children,h=S()(l,{children:{$apply:function(t){return t.map(function(t){var n=d.find(function(e){return e.ref===t.ref});return n?e.fixInstanceView(n,t,r,a):e.instanceView(t,r,a)})}}});return S()(t,{x:{$set:o},y:{$set:u},events:{$set:s},view:{$set:h}})}},{key:"runEventInView",value:function(t,n,r,a){r=e.fixContext(r);var i=e.getViewPathInfos(n,r.viewContext),o=Pt.get(r.viewContext,n),u=o.events,s=void 0===u?[]:u,c=o.view.events,l=void 0===c?[]:c,d=["back","jump","nextPlot","jumpOption","backOption","insertPlot"],h=function(t){return(i=e.updateViewPathInfos(i,t.viewContext))[i.length-1].path},f=function e(n,r,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=n[r];return n.length<=r?Promise.resolve(i):("onKeyUp"===t&&u.keyCode===a||"onKeyUp"!==t)&&u.type===t&&ke.safeEval(u.expression,i.playContext)?function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!n)return Promise.resolve(e);return function e(a,i){var o=n[i];return a.openPages.length||a.closePages.length||a.controlPlay?Promise.reject(a):n.length<=i?Promise.resolve(a):d.some(function(e){return e===o.type})?"onLoad"===t?e(a,i+1):$t({event:o,path:h(a),isInnerEvent:r,context:a,events:n,index:i}).then(function(e){return Promise.reject(e)}):$t({event:o,path:h(a),isInnerEvent:r,context:a,events:n,index:i}).then(function(t){return e(t,i+1)})}(e,0)}(i,u.events,o).then(function(t){return e(n,r+1,t,o)}):e(n,r+1,i,o)};return f(s,0,r).then(function(e){return f(l,0,e,!0)}).then(function(e){return e},function(e){return e}).then(function(n){switch(t){case"onLoad":var r=h(n),a=["children",["view",r]],i=Pt.get(n.viewContext,a);if(r&&i&&i.length)return e.runOnLoadEventInViews(a,n);break;default:return e.runOnLoadEventInCalledUI(n)}return n})}},{key:"runOnLoadEventInViews",value:function(t,n){return function n(r,i){var o=[i,t],u=Pt.get(r.viewContext,t)||[];if(u.length<=i)return Promise.resolve(r);if(Pt.get(r.viewContext,o)){var s=e.getViewPathInfos(o,r.viewContext);return e.runEventInView("onLoad",o,r).then(function(r){var o=(s=e.updateViewPathInfos(s,r.viewContext))[s.length-1].path;if(t=o[1],~o[0])return n(r,o[0]+1);for(var c=Pt.get(r.viewContext,t)||[],l=-1,d=function(e){if(-1!==(l=c.findIndex(function(t){return t.instanceUuid===u[e].instanceUuid})))return{v:n(r,l)}},h=i+1;h<u.length;h++){var f=d(h);if("object"===a(f))return f.v}return n(r,c.length)})}return n(r,i+1)}(n=e.fixContext(n),0)}},{key:"runOnLoadEvent",value:function(t,n){return function n(r,i){var o=[i,t],u=Pt.get(r.viewContext,t);if(u.length<=i)return Promise.resolve(r);if(Pt.get(r.viewContext,o)){var s=e.getViewPathInfos(o,r.viewContext);return e.runOnLoadEventInView(o,r).then(function(r){var o=(s=e.updateViewPathInfos(s,r.viewContext))[s.length-1].path;if(t=o[1],~o[0])return n(r,o[0]+1);for(var c=Pt.get(r.viewContext,t)||[],l=-1,d=function(e){if(-1!==(l=c.findIndex(function(t){return t.instanceUuid===u[e].instanceUuid})))return{v:n(r,l)}},h=i+1;h<u.length;h++){var f=d(h);if("object"===a(f))return f.v}return n(r,c.length)})}return n(r,i+1)}(n=e.fixContext(n),0)}},{key:"runOnLoadEventInView",value:function(t,n){return n=e.fixContext(n),Pt.get(n.viewContext,t)?(n=S()(n,{callUIRecordQueue:{$set:[]}}),e.runEventInView("onLoad",t,n).then(function(t){return e.runOnLoadEventInCalledUI(t)})):Promise.resolve(n)}},{key:"runOnLoadEventInCalledUI",value:function(t){var n=(t=e.fixContext(t)).callUIRecordQueue;return function t(r,a){if(n.length<=a)return r.callUIRecordQueue=[],Promise.resolve(r);var i=function(e,t){var n=null,r=function(t,n){var r=null;return t.instanceUuid===e.instanceUuid?n:(t.calledViews.length&&(r=a(t.calledViews,["calledViews",n])),!r&&t.view.children.length&&(r=a(t.view.children,["children",["view",n]])),r)},a=function(e,t){for(var n=null,a=0;a<e.length&&!n;a++)n=r(e[a],[a,t]);return n};return Object.keys(t).forEach(function(e){n||(n=a(t[e],[e,null]))}),n}(n[a].view,r.viewContext);return i?e.runEventInView("onLoad",i,r).then(function(e){return n.length!==e.callUIRecordQueue.length&&(n=n.concat(e.callUIRecordQueue.slice(n.length))),t(e,a+1)}):t(r,a+1)}(t,0)}},{key:"fixContext",value:function(e){return S()(e,{controlPlay:{$apply:function(e){return e||null}},openPages:{$apply:function(e){return e||[]}},closePages:{$apply:function(e){return e||[]}},controlAudio:{$apply:function(e){return e||{updateSounds:!1,sounds:new Array(10).fill({url:"inherit"}),stopMusic:!1,stopSound:!1}}},callUIRecordQueue:{$apply:function(e){return e||[]}}})}},{key:"runSpecialEvents",value:function(e,t){return function t(n,r){var a=e[r];return e.length<=r?Promise.resolve(n):$t({event:a,path:[],isInnerEvent:!1,context:n,events:e,index:r}).then(function(e){return t(e,r+1)})}(t,0)}}]),e}(),Ft=!1,zt=!1,Wt=!1,Nt=!1,$t=function(e){var t,n,r,a,i,o,s,c=e.event,d=e.path,h=e.isInnerEvent,f=void 0!==h&&h,p=e.context,v=e.events,m=e.index,g=c.type,y=c.handle,_=p.viewContext,w=p.playContext,b=p.controlAudio,x=p.controlPlay,C=p.game,E=p.openPages,I=p.callUIRecordQueue,T=p.closePages,V=p.handleShare,j=function(){var e=window.game.world,t=e.width,n=e.height,r=mt.rectMask({rect:{width:t,height:n},alpha:0});r.name="paymask",r.inputEnabled=!0,e.addChild(r)},U=function(){var e=window.game.world,t=e.getByName("paymask");t&&e.remove(t,!0)};switch(g){case"callUI":!function(){var e=C.viewMap,t=y.uuid,n=y.type,r=y.position,a=y.count,i=y.id;if("system"===n&&i)E=S()(E,{$push:[i]});else{var o=ke.safeEval(a,w);if(o=o<0?0:o>10?10:o,!((o=u.b.toInt(o))<=0)){for(var s=[],c=0;c<o;c++)if(e[t]){var l={ref:t,instanceUuid:"lv_".concat(he()),x:r.x,y:r.y,scale:1,events:[]},h=Lt.instanceView(l,C,w);s.push(h)}if(null===d[1][1]){var f=Pt.stringify(d);_=f.indexOf("global")>=0?S()(_,{globalCalledViews:{$push:s}}):f.indexOf("menu")>=0?S()(_,{menuCalledViews:{$push:s}}):S()(_,{calledViews:{$push:s}})}else if("number"==typeof d[0]&&("children"===d[1][0]||"calledViews"===d[1][0])){var p="children"===d[1][0]?d[1][1][1]:d[1][1];if(!Pt.get(_,p))return;var v=Pt.createQuery(p,{calledViews:{$push:s}});_=S()(_,v)}I=S()(I,{$push:s.reduce(function(e,t){return[].concat(Object(k.a)(e),[{view:t}])},[])})}}}();break;case"reload":return function(){var e=[];["menuCalledViews","menuViews","calledViews","plotViews","globalCalledViews","globalViews"].forEach(function(t){!function t(n,r){return n.forEach(function(n,a){var i=[a,r],o=n.ref,u=n.view,s=n.calledViews,c=void 0===s?[]:s;if(o===y.uuid){var l=Lt.getViewPathInfos(i,_);e.push(l)}else"container"===u.type&&(t(u.children,["children",["view",i]]),t(c,["calledViews",i]))})}(p.viewContext[t],[t,null])});return function t(n,r){if(e.length<=r)return Promise.resolve(n);var a=n.callUIRecordQueue,i=n.playContext,o=n.viewContext,u=Lt.updateViewPathInfos(e[r],o),s=u[u.length-1].path;if(~s[0]){var c=Pt.get(o,s),l=S()(o,Pt.createQuery(s,{$set:Lt.instanceView(c,C,i)}));return Lt.runOnLoadEventInView(s,S()(n,{viewContext:{$set:l}})).then(function(e){return t(S()(e,{callUIRecordQueue:{$set:a}}),r+1)})}return t(n,r+1)}(p,0)}();case"refreshUI":i=C.viewMap,o=function e(t){for(var n=function(t){var n=t.ref,r=t.x,a=t.y,o=i[n],s=o.type,c=o.content,l={calledViews:{$apply:e},view:{children:{$apply:e}}};if(n!==y.uuid)return S()(t,l);if("text"===s){var d=c,h=d.value,f=d.color;Array.isArray(h)||(h=u.c.toArrayForData(h).map(function(e){return O({},e,{color:f})})),c=S()(c,{value:{$set:ke.parseValue(h,w)}})}else if("bar"===s){var p=c.value,v=p.normal,m=p.progress;c=S()(c,{value:{normal:{width:{value:{$set:ke.safeEval(v.width,w)}},height:{value:{$set:ke.safeEval(v.height,w)}}},progress:{width:{value:{$set:ke.safeEval(m.width,w)}},height:{value:{$set:ke.safeEval(m.height,w)}}}}})}else if("input"===s){var g=c.value;c=S()(c,{value:{value:{$set:ke.safeEval(g,w)}}})}return l=Object.assign(l,{view:{content:{$set:c}},x:{value:{$set:ke.safeEval(r,w)}},y:{value:{$set:ke.safeEval(a,w)}}}),S()(t,l)},r=0,a=t.length;r<a;r++)t=S()(t,P({},r,{$apply:n}));return t},s={globalViews:{$apply:o},plotViews:{$apply:o},calledViews:{$apply:o},globalCalledViews:{$apply:o},menuViews:{$apply:o},menuCalledViews:{$apply:o}},_=S()(_,s);break;case"closeUI":!function(){var e=y.type,t=y.id;if("system"===e&&t)T=S()(T,{$push:[t]});else{var n=null;if(y&&y.uuid){var r=function e(t){return t.map(function(t){return t.ref===y.uuid?null:S()(t,{calledViews:{$apply:e},view:{children:{$apply:e}}})}).filter(function(e){return null!==e})};_=S()(_,{globalViews:{$apply:r},plotViews:{$apply:r},calledViews:{$apply:r},globalCalledViews:{$apply:r},menuViews:{$apply:r},menuCalledViews:{$apply:r}})}else f?n=Pt.createQuery(d[1],{$splice:[[d[0],1]]}):"number"==typeof d[0]&&"children"===d[1][0]&&(n=Pt.createQuery(d[1][1][1][1],{$splice:[[d[1][1][1][0],1]]})),n&&Pt.get(_,f?d:d[1][1][1])&&(_=S()(_,n))}}();break;case"setValue":return function(){if(!1!==Nt)return Promise.reject(p);Nt=!0;var e=Promise.resolve(w);return Ft&&!zt||(e=Bt.updatePayValues(w,y.values)),e.then(function(e){return w=ke.setContextByValueHandles(e,y.values),Bt.uploadPayValues(w,y.values,Ft).then(function(e){return Ft&&!1===e&&(Bt.updatePayValueError=!0),Ft=!1,Nt=!1,S()(p,{playContext:{$set:w}})})})}();case"playMusic":b=S()(b,{music:{$set:y.music},stopMusic:{$set:!1}});break;case"stopMusic":b=S()(b,{stopMusic:{$set:!0}});break;case"playSound":b=S()(b,{updateSounds:{$set:!0},stopSound:{$set:!1}}),y.sounds&&y.sounds.forEach(function(e,t){return b=S()(b,{sounds:P({},t,{$apply:function(t){return e&&"inherit"===e.url?t:e}})})});break;case"stopSound":b=S()(b,{stopSound:{$set:!0}});break;case"back":case"jump":case"jumpOption":case"backOption":case"nextPlot":case"insertPlot":r=y.uuid,a=y.value,"jumpOption"!==g&&"backOption"!==g||(a=ke.safeEval(a,w)),x={type:g,control:{uuid:r,value:a}};break;case"openUrl":y.urlId;break;case"pay":return function(){if(Wt)return Promise.reject(p);Wt=!0;var e=l.a.gid,t=l.a.uuid,n=l.a.client,r=l.a.wap,a=l.a.isWapOther,i=l.a.qz_pindex,o=l.a.type,s=l.a.single,c=y.hasOwnProperty("values");if("zxwwap"===r)return A.a.info("商城功能尚未开启，是否前往闪艺抢先体验？").then(function(){window.location.href="https://wap.3000.com/?m=detail&op=index&ac=index&id=".concat(e)},function(){}),Wt=!1,Ft=!1,Promise.reject(p);if(1==o){var d=y.price,h=y.count,f=y.values;Wt=!1,Ft=!1;var g=u.c.typePayCount.findIndex(function(e){return e.uuid==y.uuid&&e.count>0})>-1;return-1!==h&&g?A.a.info("该商品只可购买一次！").then(function(){return Promise.reject(p)},function(){return Promise.reject(p)}):A.a.info("购买操作执行成功（闪币-".concat(ke.safeEval(d,w),"）,测试阶段不会扣除账户余额")).then(function(){var e,t,n=y.chapters,r=y.records;return n&&(e=u.c.typeUnlockChapters).push.apply(e,Object(k.a)(n)),r&&(t=u.c.typeUnlockRecords).push.apply(t,Object(k.a)(r)),f&&(w=ke.setContextByValueHandles(w,f)),-1!==h&&u.c.typePayCount.push({uuid:y.uuid,count:1}),c?S()(p,{playContext:{$set:w}}):p},function(){return Promise.reject(p)})}if("ios"!==n&&"android"!==n&&"wap"!==n&&"pc"!==n)return Wt=!1,Ft=!1,A.a.info("请前往APP或电脑端购买~").then(function(){return Promise.reject(p)},function(){return Promise.reject(p)});if("wap"===n&&"wx"===r)return A.a.custom("Info","请在应用商店下载闪艺app，阅读完整版作品","提示","知道了","取消",!1),Wt=!1,Ft=!1,Promise.reject(p);var _=y.hasOwnProperty("records")||y.hasOwnProperty("chapters"),b=y.hasOwnProperty("values"),x=y.uuid,C=y.price,O=y.count,E=void 0===O?-1:O,I=y.name,T=0,V=0,R=ke.safeEval(C,w),B=u.c.generateUUID(),L=n+B;Ft=!1;var F=function(){return U(),Wt=!1,Ft=!1,Promise.reject(p)},z=function(e){return"ios"!==n&&"android"!==n&&"wap"!==n&&"pc"!==n?Promise.resolve(!0):(t=e,Fe().then(function(){var e=l.a.client,n=l.a.v,r=l.a.u,a=l.a.token,i=l.a.gid,o=l.a.app_version,u=function(e,t){return Object(we.c)({url:e,data:t,timeout:4e3}).then(function(e){var t=e.responseText;if(0===t.length)return{status:"error",msg:"获取商品支付信息失败",count:0};var n=JSON.parse(t),r=n.status,a=n.success,i=n.data,o=n.msg;return 0===r&&a&&i?{status:"success",msg:o,count:i.count}:{status:"fail",msg:o,count:0}},function(e){return{status:"error",msg:"获取商品支付信息失败",count:0}})};return"ios"===e||"android"===e?u("".concat(Ie.appGetGoodInfo,"&client=").concat(e,"&v=").concat(n,"&app_version=").concat(o),"u=".concat(Ae(r,1),"&token=").concat(Ae(a,1),"&event_id=").concat(Ae(t,1),"&game_id=").concat(Ae(i,1))):u(Ie.wapGetGoodInfo,"event_id=".concat(Ae(t,3),"&game_id=").concat(Ae(i,3)))})).then(function(e){if(e&&"success"===e.status)return-1===E||1===E&&0===e.count||Promise.reject()},function(e){return Promise.resolve()});var t},W=function(e){return"pc"===n?Promise.resolve(e):Bt.updateAccinfo(e,function(e){T=e.usedStarCount,V=e.gameStarLimit}).then(function(e){return e})},N=function(e,t,n){return U(),0==e||void 0===e||-1===e?F():Promise.resolve(!0).then(function(r){if(Wt=!1,zt=!1,void 0!==r&&!1!==r){Ft=!0;var a=Promise.resolve(!0);return b&&(t=n,a=Bt.uploadPayValues(t,[],!0),zt=!0),W(t).then(function(e){return a.then(function(t){return!1===t&&(Bt.updatePayValueError=!0),Promise.resolve(S()(p,{playContext:{$set:e}}))})},function(){return 2==parseInt(e)?t=S()(t,{systemValues:P({},1,{value:{$apply:function(e){return e-100*R}}})}):1==parseInt(e)&&(t=S()(t,{systemValues:P({},0,{value:{$apply:function(e){return e-R}}})})),a.then(function(e){return!1===e&&(Bt.updatePayValueError=!0),S()(p,{playContext:{$set:t}})})})}return Promise.reject()}).then(function(e){return e},F)};if(j(),"qzone"===r){var $=i||134;return(w.payValues[$].value||w.payValues[$].init.value)>=R?(w=S()(w,{systemValues:P({},$,{value:{$apply:function(e){return e-R}}})}),Promise.resolve(S()(p,{playContext:{$set:w}}))):(A.a.custom("Warn","闪币余额不足，快去分享获得闪币","温馨提示","分享","取消",!0).then(function(){return M.d.openShareMessageQzone()}),Promise.reject(p))}return Ke().then(function(e){return!e||(A.a.info("内测作品，暂不支持购买~我们将在内测结束后清空数值。").then(function(){},function(){}),F())},function(){return Promise.resolve(!0)}).then(function(){return Fe().then(function(e){return!0},function(e){if(e){var t=e.msg,n=e.status;l.a.alpha?A.a.warn("内测作品，请登录内测账号试玩！").then(function(){return D.login()},function(e){return D.login()}):999===n?A.a.error("当前网络信号差，商城".concat(s?"":"、成就等账号","功能无法正常使用，请检查网络设置后，重新打开作品")).then(function(e){},function(e){}):A.a.error(t).then(function(){return D.login()},function(e){})}return F()}).then(function(e){return W(w)})}).then(function(e){return function(e){return Bt.updatePayValues(e,[],!0,!1,!0).then(function(e){return!0!==Bt.updatePayValueError?e:F()})}(e)}).then(function(e){return z(x).then(function(t){return!0!==t?(A.a.error("网络不稳定，请重试~").then(function(e){},function(e){}),F()):e},function(e){return window.game.gameResumed&&window.game.gameResumed(),A.a.info("该商品只可购买一次！").then(F,F)})}).then(function(e){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"app";return Ne(e,t,n,r).then(function(e){return{charge:e.charge,special_price:e.special_price||e.charge_pc,charge_app:e.charge_app}},function(e){return Promise.resolve({charge:C,special_price:-1,charge_app:-1})})}(t,null,x,"app").then(function(t){return function(e){var t=e;if(b){var n=y.values;t=ke.setContextByValueHandles(t,n)}else v.filter(function(e,t){return"setValue"===e.type&&t>m}).forEach(function(e){t=ke.setContextByValueHandles(t,e.handle.values)});return Promise.resolve(t)}(e).then(function(n){return{playContext:e,newplayContext:n,disCounts:t}})})}).then(function(i){var o="4shan3yi9xia9men",s=u.a.getCurDate(),c=i.newplayContext,d=i.disCounts,h=i.playContext,f=c.payValues,p=c.systemValues,v=_&&"pc"!==n?function(e,t){var n=l.a.client,r=l.a.gid,a=l.a.app_version,i=l.a.v,o=l.a.u,u=l.a.token;return"android"==n||"ios"==n?function(e,n){return Object(we.c)({url:e,data:n,timeout:4e3}).then(function(e){var n=e.responseText;if(0===n.length)return{status:"error",msg:"获取商品实际价格失败",current_amount:t};var r=JSON.parse(n),a=r.status,i=(r.success,r.data),o=r.msg;return 0==a?{status:"success",msg:o,count:i.current_amount}:{status:"fail",msg:o,count:t}},function(e){return Promise.resolve({status:"error",msg:"获取商品实际价格失败",count:t})})}("".concat(Ie.getPackActualPrice,"&client=").concat(n,"&v=").concat(i,"&app_version=").concat(a),"u=".concat(Ae(o,1),"&token=").concat(Ae(u,1),"&event_id=").concat(Ae(e,1),"&amount=").concat(Ae(t,1),"&game_id=").concat(Ae(r,1))):Promise.resolve(t)}(x,-1!==d.special_price?d.special_price:R):Promise.resolve(null),m={gid:e,eid:x,charge:R,special_price:d.special_price,balance:p[0].value,starsNeed:100*R,stars:p[1].value,starsUsed:T,starsLimited:V,payValues:u.c.encodeBase64(JSON.stringify(f)),indentId:L,actualprice:-1!==d.special_price?d.special_price:R,ispackpay:_};if(a)return"qh"===r?u.c.timeout(100).then(function(){return A.a.custom("Info","支付过程将导致作品重启。请确保您已存档。选择已存档将继续支付，未存档将前往存档界面","作品存档提示","已存档","未存档",!0).then(function(){return M.c.qhpay(R,x,B,"",c,1).then(function(){return N(0,h,c)})},function(e){return"cancel"===e&&window.showSave(),F()})}):"mk"==r?(m={client:4,amount:200*R,uuid:t,event_id:x,time:s,set_value:u.c.encodeBase64(JSON.stringify(f)),token:ge.a.hash(t+200*R+s+o),outreach_uid:l.a.mk_uid,access_token:l.a.mk_access_token,product_name:I,indentId:L},D.pay(m).then(function(e){return N(e,h,c)})):N(0,h,c);if("pc"===n){var g=R;-1!==d.special_price&&(g=d.special_price);var y=ge.a.hash(t+g+s+o),w=ge.a.hash(t+100*R+s+o);m={uuid:t,eid:x,charge:R,charge_pc:d.special_price,charge_app:d.charge_app,time:s,token:y,payValues:u.c.encodeBase64(JSON.stringify(f)),name:I,callback:"mallPay",starToken:w,indentId:L}}return v.then(function(e){return"pc"!==n&&e&&(m.actualprice=e.count),D.pay(m).then(function(e){return N(e,h,c)})})}).catch(function(e){return F()})}();case"share":return t=c.handle.uuid,n=l.a.inviteViewName,V?u.c.timeout(100).then(function(){return V({isInvite:t===n,context:p})}):Promise.reject(p);case"playad":return function(){j();l.a.single,l.a.client,l.a.wap;var e=l.a.singleoffline;return D.singlePlayAd().then(function(t){return U(),1==t?e&&(w=S()(w,{systemValues:P({},0,{value:{$apply:function(e){return e+1}}})})):A.a.info("广告播放失败！"),S()(p,{playContext:{$set:w}})})}();case"loginout":A.a.info("确定退出当前账号么？").then(function(){return D.logout()},function(){});break;case"recharge":D.singleRecharge();break;default:console.error("error event type",c)}return Promise.resolve(S()(p,{playContext:{$set:w},viewContext:{$set:_},controlAudio:{$set:b},openPages:{$set:E},closePages:{$set:T},controlPlay:{$set:x},callUIRecordQueue:{$set:I}}))},Ht=null,qt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ht?Ht.update(e):Ht=new Kt(e)},Kt=function(){function e(t){var n=this,r=t.callbacks,a=t.gameJson;Object(i.a)(this,e),P(this,"handleButtonClick",function(e,t){if(t.pointerMode!==Phaser.PointerMode.CURSOR||0===t.button){n.container;"cover_button_start"===e.parent.name?(n.callbacks&&n.callbacks.start&&n.callbacks.start(),n.close()):"cover_button_load"===e.parent.name?n.callbacks&&n.callbacks.load&&n.callbacks.load():"cover_button_settings"===e.parent.name?n.callbacks&&n.callbacks.settings&&n.callbacks.settings():"cover_button_over"===e.parent.name&&(n.callbacks&&n.callbacks.over&&n.callbacks.over(),D.gameQuit())}}),this.callbacks=r,this.container=mt.group(),this.render(a),game.onRestart.add(function(){return n.close()})}return Object(o.a)(e,[{key:"update",value:function(e){var t=e.callbacks;return this.callbacks=t,this.container.visible=!0,this}},{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"render",value:function(e){var t=this,n=e.template,r=e.cover,a=e.default_settings,i=n.json.cover,o=i.titleContainer,u=i.startMenu,s=i.loadMenu,c=i.settingsMenu,l=i.overMenu,d=function(e,n,r){var a=e.rect,i=e.normal,o=e.active;if(!e.hidden){var u={name:n,normalUrl:i.background.url,activeUrl:o.background.url,onClick:t.handleButtonClick,textOptions:{normal:O({},i.text,{text:r}),active:O({},o.text,{text:r})},audio:{url:$.buttonSoundUrl,volume:1}};t.container.add(mt.button(a,u))}},h=r.title,f=h.data,p=h.font_size,v=h.color,m=h.bold,g=h.fontFamily,y=void 0===g?a.fontFamily:g;if(!h.hidden||!f){var _=o.title,w=_.rect,b=_.text,k=b.color,x=b.fontSize,P=o.rect;this.container.add(mt.text(O({},w,{x:w.x+P.x,y:w.y+P.y}),{text:f,color:v||k,fontWeight:m?"bold":"normal",fontSize:p||x,fontFamily:y,boundsAlignH:"center",boundsAlignV:"bottom"}))}d(u,"cover_button_start","开始"),d(s,"cover_button_load","读档"),d(c,"cover_button_settings","设置"),d(l,"cover_button_over","结束")}}]),e}(),Gt=null,Jt=0,Qt=0,Zt=["settings_button_fullMode","settings_button_windowMode"],Yt=["settings_button_autoOn","settings_button_autoOff"],Xt=navigator.userAgent,en=/MicroMessenger/gi.test(Xt),tn=/QQ/gi.test(Xt),nn=function(){function e(t){var n=this,r=t.callback,a=t.template;Object(i.a)(this,e),P(this,"handleClick",function(e,t){if(t.pointerMode!==Phaser.PointerMode.CURSOR||0===t.button){var r=n.container,a=l.a.client,i=l.a.isWapOther,o=function(e,t){return t.forEach(function(t){return r.getByName(t).check(e===t)})};e.parent.name===Zt[0]?(o(Zt[0],Zt),D.isAppClient()||en||tn||"pc"===a||i||game.scale.startFullScreen(!0),"pc"===a&&!0!==$.full&&D.fullScreenFromPc(),$.full=!0):e.parent.name===Zt[1]?(o(Zt[1],Zt),D.isAppClient()||en||tn||"pc"===a||i||game.scale.stopFullScreen(),"pc"===a&&!1!==$.full&&D.exitFullScreenFromPc(),$.full=!1):e.parent.name===Yt[0]?(o(Yt[0],Yt),$.autoPlay=!0):e.parent.name===Yt[1]?(o(Yt[1],Yt),$.autoPlay=!1):"settings_button_back"===e.parent.name&&(n.hasProgress&&D.switchAppBack(!0),n.close(),n.backCallback&&n.backCallback())}});l.a.vertical;var o=l.a.client;if(this.container=mt.group(),"pc"===o){var s=window.innerWidth||window.documentElement.clientWidth||window.document.body.clientWidth,c=window.innerHeight||window.documentElement.clientHeight||window.document.body.clientHeight,d=Math.min(s,c),h=Math.max(s,c);$.full=d>window.originalWidth||h>window.originalHeight}this.render(a.json.settings),this.update({callback:r}),D.setCallback("setAttribute",function(e){var t=e.width,r=e.height;Jt==t&&Qt==r||(Jt=t,Qt=r,u.c.timeout(50).then(function(){var e=window.innerWidth||window.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.documentElement.clientHeight||window.document.body.clientHeight,r=Math.min(e,t),a=Math.max(e,t);$.full=r>window.originalWidth||a>window.originalHeight;var i,o=n.container;i=Zt[$.full?0:1],Zt.forEach(function(e){return o.getByName(e).check(i===e)})}))}),game.onRestart.add(function(){return n.close()})}return Object(o.a)(e,[{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"update",value:function(e){var t=e.callback;this.hasProgress&&D.switchAppBack(!1),this.container.visible=!0,this.backCallback=t;var n=this.container.getByName(Zt[0]),r=this.container.getByName(Zt[1]),a=this.container.getByName(Yt[0]),i=this.container.getByName(Yt[1]),o=this.container.getByName("music_progress"),u=this.container.getByName("sound_progress"),s=$.musicVolume,c=$.soundVolume,l=$.full,d=$.autoPlay;return n&&n.check(l),r&&r.check(!l),a&&a.check(d),i&&i.check(!d),o&&(o.mask.width=s<=0?.01:s*o.width),u&&(u.mask.width=c<=0?.01:c*u.width),this}},{key:"addProgressEventHandle",value:function(e,t,n){var r=this,a=game,i=a.input,o=a.world,u=t.x,s=t.width,c=function(e){return e<0&&(e=0),e>1&&(e=1),e},l=function(t){var r=(t=c(t))<=0?.01:t*s;n.graphicsData[0].shape.width=r,"music_progress"===e.name?ae.updateMusicVolume(t):ae.updateSoundsVolume(t)},d=function(e){return l(((o.angle?e.y:e.x)-u)/s)};e.events.onInputDown.add(function(e,t){var n=Math.abs(o.angle?t.y:t.x);l((n-u)/s),i.addMoveCallback(d,r)},this),e.events.onInputUp.add(function(e,t){var n=Math.abs(o.angle?t.y:t.x);l(c((n-u)/s)),i.deleteMoveCallback(d,r)},this)}},{key:"renderProgress",value:function(e,t,n,r){var a=game.load.cache;t=a.checkImageKey(t)?t:"",n=a.checkImageKey(n)?n:"",this.container.add(mt.image(t,r));var i=mt.image(n,r);i.name="".concat(e,"_progress"),i.inputEnabled=!0,this.container.add(i);var o=mt.rectMask({color:16773120,alpha:.5,rect:O({},r)});return this.container.add(o),i.mask=o,this.addProgressEventHandle(i,r,o),i}},{key:"render",value:function(e){var t=this,n=e.background,r=e.header,a=e.displayHeader,i=e.textHeader,o=e.displayCaption,u=e.textCaption,s=e.fullMode,c=e.windowMode,l=e.autoOn,d=e.autoOff,h=e.back,f=e.musicCaption,p=e.musicVolume,v=e.soundCaption,m=e.soundVolume,g=e.volumeHeader,y=game.world,_=y.width,w=y.height,b=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=e.rect,a=e.background.url,i=e.title,o=mt.group();if(a&&o.add(mt.image(a,O({},r,{x:0,y:0}))),i&&!i.text.hidden){var u=i.rect,s=u.x,c=u.y,l=u.width,d=u.height;o.add(mt.text({x:s+r.x,y:c+r.y,width:l,height:d},O({},i.text,{text:n,boundsAlignH:"center",boundsAlignV:"middle"})))}e.text&&!e.text.hidden&&o.add(mt.text(O({},r,{x:0,y:0}),O({},e.text,{text:n,boundsAlignH:"center",boundsAlignV:"middle"})));var h=mt.rectMask({alpha:0,rect:O({},r,{x:0,y:0})});o.mask=h,o.add(h),o.x=r.x,o.y=r.y,t.container.add(o)},k=function(e,n,r){var a=e.rect,i=e.checked,o=e.unchecked,u=e.hidden;if(!(void 0!==u&&u)){var s={name:n,checkedUrl:i.background.url,uncheckedUrl:o.background.url,onClick:t.handleClick,textOptions:{checked:O({},i.text,{text:r}),unchecked:O({},i.text,{text:r})}};t.container.add(mt.checkbox(a,s))}},x=mt.image(n.url,{x:0,y:0,width:_,height:w});if(x.inputEnabled=!0,this.container.add(x),b(r,"设置"),!a.hidden&&b(a,"显示设定"),!i.hidden&&b(i,"文字设定"),b(o,"画面模式"),b(u,"自动进行"),k(s,Zt[0],"全屏模式"),k(c,Zt[1],"窗口模式"),k(l,Yt[0],"开"),k(d,Yt[1],"关"),function(e,n,r){var a=e.rect,i=e.normal,o=e.active;if(!e.hidden){var u={name:n,normalUrl:i.background.url,activeUrl:o.background.url,onClick:t.handleClick,textOptions:{normal:O({},i.text,{text:r}),active:O({},o.text,{text:r})},audio:{url:$.buttonSoundUrl,volume:1}};t.container.add(mt.button(a,u))}}(h,"settings_button_back","返回"),f&&b(f,"音乐音量"),p){this.hasProgress=!0;var P=p.normal,C=p.progress,S=p.rect;this.renderProgress("music",P.background.url,C.background.url,S)}if(v&&b(v,"音效音量"),m){this.hasProgress=!0;var E=m.normal,I=m.progress,A=m.rect;this.renderProgress("sound",E.background.url,I.background.url,A)}g&&b(g,"音量设置")}}]),e}(),rn=null,an=function(){function e(t){var n=this,r=t.callbacks,a=t.template;Object(i.a)(this,e),P(this,"handleClick",function(e,t){if(t.pointerMode!==Phaser.PointerMode.CURSOR||0===t.button){var r=function(e){n.close(),n.callbacks&&n.callbacks[e]&&n.callbacks[e]()};"mainMenu_button_save"===e.parent.name?r("save"):"mainMenu_button_load"===e.parent.name?r("load"):"mainMenu_button_playback"===e.parent.name?r("playback"):"mainMenu_button_autoplay"===e.parent.name?($.autoPlay=!$.autoPlay,r("autoplay")):"mainMenu_button_settings"===e.parent.name?r("settings"):"mainMenu_button_back"===e.parent.name&&r("back")}}),this.callbacks=r,this.container=mt.group(),this.render(a.json.mainMenu),game.onRestart.add(function(){return n.close()})}return Object(o.a)(e,[{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"update",value:function(e){var t=e.callbacks;return this.autoPlay&&this.autoPlay.setText($.autoPlay?"手动播放":"自动播放"),this.callbacks=t,this.container.visible=!0,this}},{key:"render",value:function(e){var t,n,r,a=this,i=e.background,o=e.header,u=e.save,s=e.load,c=e.playback,l=e.settings,d=e.autoplay,h=e.back,f=game.world,p=f.width,v=f.height,m=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e||!e&&n){var r=mt.image(e,t);r.inputEnabled=n,a.container.add(r)}},g=function(e,t,n){var r=e.rect,i=e.normal,o=e.active;if(!e.hidden){var u={name:t,normalUrl:i.background.url,activeUrl:o.background.url,onClick:a.handleClick,textOptions:{normal:O({},i.text,{text:n}),active:O({},o.text,{text:n})},audio:{url:$.buttonSoundUrl,volume:1}},s=mt.button(r,u);return a.container.add(s),s}};m(i.url,{x:0,y:0,width:p,height:v},!0),m(o.background.url,o.rect),t=o.title.rect,n=O({},o.title.text,{text:"菜单"}),(r=mt.text(t,O({},n,{boundsAlignH:"center",boundsAlignV:"middle"})))&&a.container.add(r),g(u,"mainMenu_button_save","保存进度"),g(s,"mainMenu_button_load","读取进度"),g(c,"mainMenu_button_playback","剧情回放"),this.autoPlay=g(d,"mainMenu_button_autoplay","自动播放"),g(l,"mainMenu_button_settings","设置"),g(h,"mainMenu_button_back","返回")}}]),e}(),on=null,un=function(){function e(t){var n=this,r=t.callback,a=t.template,o=t.records,u=void 0===o?[]:o,s=t.isload,c=void 0!==s&&s;Object(i.a)(this,e),P(this,"handleClick",function(e,t){t.pointerMode===Phaser.PointerMode.CURSOR&&0!==t.button||"playback_button_back"===e.parent.name&&(n.close(),n.backCallback&&n.backCallback())}),this.records=u,this.backCallback=r,this.container=mt.group(),this.totalHeight=0,this.items=[],this.render(a.json.playback),this.update({callback:r,records:u,template:a,isload:c}),game.onRestart.add(function(){return n.close()})}return Object(o.a)(e,[{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"update",value:function(e){var t=e.callback,n=e.records,r=e.template;return 1==e.isload&&this.clear(r.json.playback),this.records=n,this.backCallback=t,this.container.visible=!0,this.updateItems(),this.scrollPane.scrollY(-this.totalHeight),this}},{key:"clear",value:function(e){for(;this.items.length>0;){var t=this.items.pop();t.box&&this.scrollPane.contains(t.box)&&this.scrollPane.removeChild(t.box)}var n=e.scrollBox.rect.y;this.scrollPane.y=n,this.items=[],this.totalHeight=0}},{key:"updateItems",value:function(){var e=this,t=0,n=[];this.records.length-this.items.length>0&&(n=this.records.slice(this.items.length),t=this.totalHeight),n.forEach(function(n,r){var a=e.renderItems(e.itemData);a.y=e.totalHeight;var i=a.getByName("text"),o=n||"";Array.isArray(o)||(o=u.c.toArrayForData(o).map(function(e){return O({},e)}));var s=/([\s\S]*)\\(\d+)\s([\s\S]*)/;i.setTexts(o.map(function(e){for(var t=e.data,n=void 0===t?"":t,r=s.exec(n);r;)n=r[1]+r[3],r=s.exec(n);return O({},e,{data:n})})),t=i.height+30,e.totalHeight+=t,e.items.push({box:a,height:t})})}},{key:"renderItems",value:function(e){var t=e.rect,n=e.content,r=e.background,a=n.text,i=function(){var e=t.x+n.rect.x,i=t.y+n.rect.y,o=mt.group();o.add(mt.image(r.url,O({},t,{x:0,y:0})));var s=mt.textarea({x:e,y:i,width:Math.min(n.rect.width,t.width)-e-u.c.txtLineSpace(parseInt(a.fontSize)),height:Math.min(n.rect.height,t.height)},O({},a,{forceFontFamily:"宋体",boundsAlignH:"left",boundsAlignV:"top"}));return s.name="text",o.add(s),o}();return i.x=t.x,i.y=t.y+t.height,this.scrollPane.addChild(i),i}},{key:"renderScrollBox",value:function(e){var t=this,n=l.a.vertical,r=e.rect,a=e.item,i=mt.sprite(r);this.container.add(i);var o=r.x,u=r.y,s=r.width,c=r.height;i.scrollY=function(e){t.totalHeight<=c||((e=e+.5|0)>u?i.y=u:e-u<=-(t.totalHeight-c)?i.y=-(t.totalHeight-u-c):i.y=e)};var d=function(e){var t,r,a=e.worldX,i=e.worldY,l=game.world.angle;if(n&&90===l||!n&&0===l){var d=n?[i,-a]:[a,i],h=Object(x.a)(d,2);t=h[0],r=h[1]}else{var f=n?[a,i]:[i,-a],p=Object(x.a)(f,2);t=p[0],r=p[1]}return r<u||r>u+c||t<o||t>o+s?null:{x:t,y:r}};i.inputEnabled=!0;var h=i.input,f=i.events;h.enableDrag(),h.allowHorizontalDrag=!1,f.onDragUpdate.add(function(e,t,n,r,a,o){return i.scrollY(r)},this),f.onInputDown.add(function(e,n,r,a){return!d(n)||t.totalHeight<=c?e.input.disableDrag():e.input.enableDrag()});var p=!1,v=function(e){var t=e.wheelDelta?e.wheelDelta/120:-e.detail/3;i.scrollY(i.y+100*t)};game.input.addMoveCallback(function(e,t,n){var r=d(e),a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";!r&&p?(document.removeEventListener(a,v),p=!1):r&&!p&&(document.addEventListener(a,v),p=!0)},this);var m=mt.rectMask({color:16777215,rect:r});m.x-=1.5,this.container.add(m),i.mask=m,this.scrollPane=i,this.itemData=a}},{key:"render",value:function(e){var t=this,n=e.scrollBox,r=e.back,a=e.background,i=game.world,o=i.width,u=i.height,s=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e||!e&&r){var a=mt.image(e,n);a.inputEnabled=r,t.container.add(a)}};s(a.url,{x:0,y:0,width:o,height:u},!0),s(n.background.url,n.rect),this.renderScrollBox(n),function(e,n,r){var a=e.rect,i=e.normal,o=e.active;if(!e.hidden){var u={name:n,normalUrl:i.background.url,activeUrl:o.background.url,onClick:t.handleClick,textOptions:{normal:O({},i.text,{text:r}),active:O({},o.text,{text:r})},audio:{url:$.buttonSoundUrl,volume:1}};t.container.add(mt.button(a,u))}}(r,"playback_button_back","返回")}}]),e}(),sn=["record_check_local","record_ckeck_cloud"],cn=l.a.isWapOther||"zxwwap"===l.a.wap||1==l.a.type||"wx"===l.a.wap&&"wap"===l.a.client,ln=0,dn=!1,hn=null,fn=function(){function e(t){var n=this,r=t.mode,a=void 0===r?"load":r,o=t.callback,s=t.gameJson,c=t.getLocal,d=t.getCloud,h=t.clickRecord,f=t.lockRecord,p=t.getPlayContext;Object(i.a)(this,e),P(this,"handleClick",function(e,t){if(t.pointerMode!==Phaser.PointerMode.CURSOR||0===t.button){var r=n.container,a=function(e,t){n.checked=t,sn.forEach(function(e){return r.getByName(e)&&r.getByName(e).check(t===e)}),i(),n.updateRecords(e)},i=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.loadingTipText.setText("加载存档中..."),n.loadingTip.visible=n.state.getting=e};if("record_button_back"===e.parent.name)n.close(),n.backCallback&&n.backCallback();else if(e.parent.name!==sn[0]||n.state.getting){if(e.parent.name===sn[1]&&!n.state.getting){if(!n.clickInterval(1))return void Mt({type:At,text:"操作太频繁，稍后重试~"});ln=u.a.passSeconds,i(!0),n.getCloud(!0).then(function(e){u.c.timeout(200).then(function(){n.lockVector=[],n.getlock().then(function(t){var r;(r=n.lockVector).push.apply(r,Object(k.a)(t)),a(e,sn[1])})})},function(){return i()})}}else{if(!n.clickInterval(1))return void Mt({type:At,text:"操作太频繁，稍后重试~"});ln=u.a.passSeconds,n.checkUserAlpha("内测期间，暂不支持本地存储").then(function(){i(!0),n.getLocal().then(function(e){return a(e,sn[0])},function(){return i()})})}}}),P(this,"clickInterval",function(e){return 0==ln?(ln=u.a.passSeconds,!0):u.a.passSeconds-ln>=e}),P(this,"checkUserAlpha",function(e){return Ke().then(function(t){return!t||(A.a.info(e).then(function(){},function(){}),Promise.reject())},function(){return Promise.resolve(!0)})}),this.container=mt.group(),this.autoSaveOrLoad=s.default_settings.autoSaveOrLoad,this.backCallback=o,this.getLocal=c,this.getCloud=d,this.clickRecord=h,this.getlock=f,this.getPlayContext=p,this.checked=null,this.owner=l.a.uid,this.lockVector=[],this.testLockVector=[],this.state={mode:a,getting:!1},this.records=[];var v=l.a.vertical,m=s.template.json.record.scrollBox.column;this.row=v?12:void 0!==m?12/m:3,this.column=v?1:void 0!==m?m:4,this.render(s),this.getRecords(),game.onRestart.add(function(){return n.close()})}return Object(o.a)(e,[{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"getRecords",value:function(){var e=this;this.loadingTipText.setText("加载存档中..."),this.loadingTip.visible=this.state.getting=!0;var t=function(t,n){e.loadingTip.visible=!1,e.checked=n,sn.forEach(function(t){return e.container.getByName(t)&&e.container.getByName(t).check(n===t)}),e.state.getting=!1,e.updateRecords(t)};this.getlock().then(function(n){var r;(r=e.lockVector).push.apply(r,Object(k.a)(n));var a=function(){return e.getLocal().then(function(e){return t(e,sn[0])})};!cn&&e.showGuide(),cn||e.checked!==sn[1]&&null!==e.checked?a():e.getCloud().then(function(e){return t(e,sn[1])},a)})}},{key:"update",value:function(e){var t=this,n=e.mode,r=void 0===n?"load":n,a=e.callback,i=e.getLocal,o=e.getCloud,u=e.clickRecord,s=e.lockRecord,c=e.getPlayContext,d=l.a.client,h=l.a.wap,f=Promise.resolve();return"wap"===d?"wx"!==h&&(f=Re()):"pc"===d&&(f=Be().then(function(){return!0},function(){return!1})),f.then(function(e){var n=l.a.uid,d=t.owner!=n;t.records=[],1==e&&d&&(t.checked=null),t.state={mode:r,getting:!1},t.owner=n,t.backCallback=a,t.getLocal=i,t.getCloud=o,t.clickRecord=u,t.getlock=s,t.getPlayContext=c,t.lockVector=[],t.container.visible=!0,t.getRecords()}),this}},{key:"showGuide",value:function(){var e=this,t=game,n=t.world,r=t.cache,a=D.localStorageGetItem("shanyi3000guide")||"",i=""==a?null:JSON.parse(a),o=function(){return r.checkKey(Phaser.Cache.IMAGE,"Cloud_record_tip")&&r.removeImage("Cloud_record_tip"),e.showGuide=function(){return Promise.resolve()},e.showGuide()};if(i&&i.count>10)return o();D.localStorageSetItem("shanyi3000guide",JSON.stringify({count:(i&&i.count||0)+1}));var u=n.width,s=n.height;return new Promise(function(t,n){var r=mt.image("Cloud_record_tip",{x:u/2,y:s/2,centre:!0});r.inputEnabled=!0,e.container.add(r);r.events.onInputUp.add(function n(a,i){i&&i.pointerMode===Phaser.PointerMode.CURSOR&&0!==i.button||(q.to({target:r,properties:{alpha:0},duration:1e3}).then(function(){e.container.remove(r,!0),o().then(function(){return t()})}),r.events.onInputUp.remove(n,e))},e)})}},{key:"handleRecordClick",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.state.mode,a=n*this.column+t,i=this.checked===sn[0];if(!(this.autoSaveOrLoad&&"save"===r&&!a||this.state.getting)){var o=this.getRecordItem(a),s=(this.container,function(t){return c(),e.updateRecords(t)}),c=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.loadingTipText.setText("load"===r?"加载存档中...":"保存档案中..."),e.loadingTip.visible=e.state.getting=t};("load"===r?Promise.resolve():new Promise(function(e,t){o&&1==o.lock?t():e()})).then(function(){if("load"===r&&e.records[a]&&Object.keys(e.records[a]).length)e.clickRecord(r,a,i).then(function(){return e.close()});else if("save"===r){if(!e.clickInterval(2)||1==dn)return void(!dn&&Mt({type:At,text:"存档操作太频繁，稍后重试~"}));dn=!0;var t=!1;ln=u.a.passSeconds,c(!0),e.clickRecord(r,a,i).then(function(){return i?e.getLocal():u.c.timeout(700).then(function(){return e.getCloud()})},function(){return t=!0}).then(function(e){return s(e)},function(){return s()}).then(function(e){!t&&Mt({type:It,text:"存档成功，下次可以从这里读档继续哦~"}),dn=!1},function(e){t||Mt(i?{type:At,text:"存档失败，".concat(e)}:{type:At,text:"存档失败，请检查您的网络哦~"}),dn=!1})}},function(){var t=l.a.client,n=l.a.wap,r=l.a.gid,i=l.a.uuid,s=l.a.type,c=0,d=0,h=e.getPlayContext(),f=u.c.generateUUID(),p=t+f,v=o.price,m=function(e,t){for(var n=[],r=function(r){var a=t[r];n.push(e.filter(function(e){return e.uuid==a}))},a=0;a<t.length;a++)r(a);return e.concat.apply(e,n).filter(function(e,t,n){return n.indexOf(e)===n.lastIndexOf(e)})};if(1!=s)if("zxwwap"!==n)if("ios"===t||"android"===t||"wap"===t||"pc"===t)if("wap"!==t||"wx"!==n){var g=function(){var e=window.game.world,t=e.getByName("paymask");t&&e.remove(t,!0)};e.checkUserAlpha("内测作品，暂不支持购买~我们将在内测结束后清空数值。").then(function(){return Fe().then(function(e){return!0},function(e){if(e){var t=e.msg,n=e.status;l.a.alpha?A.a.warn("内测作品，请登录内测账号试玩！").then(function(){return D.login()},function(e){return D.login()}):999===n?A.a.error("当前网络信号差，商城、成就等账号功能无法正常使用，请检查网络设置后，重新打开作品").then(function(e){},function(e){}):A.a.error(t).then(function(){return D.login()},function(e){})}return Promise.reject()}).then(function(){var n,s,l,f;n=window.game.world,s=n.width,l=n.height,(f=mt.rectMask({rect:{width:s,height:l},alpha:0})).name="paymask",f.inputEnabled=!0,n.addChild(f),function(e){return"pc"===t?Promise.resolve(e):Bt.updateAccinfo(e,function(e){c=e.usedStarCount,d=e.gameStarLimit}).then(function(e){return e})}(h).then(function(e){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"app";return Ne(e,t,n,r).then(function(e){return{charge:e.charge,special_price:e.special_price||e.charge_pc,charge_app:e.charge_app}},function(e){return Promise.resolve({charge:v,special_price:-1,charge_app:-1})})}(i,null,o.uuid,"app").then(function(t){return{playContext:e,disCounts:t}})}).then(function(n){var s=n.disCounts,l=n.playContext.systemValues,h={};if("pc"===t){var f=u.a.getCurDate(),y=v;-1!==s.special_price&&(y=s.special_price);var _=ge.a.hash(i+y+f+"4shan3yi9xia9men"),w=ge.a.hash(i+100*v+f+"4shan3yi9xia9men");h={uuid:i,eid:o.uuid,charge:v,charge_pc:s.special_price,charge_app:s.charge_app,time:f,token:_,payValues:"",name:"档位",callback:"mallPay",starToken:w,indentId:p}}else"ios"!==t&&"android"!==t&&"wap"!==t||(h={gid:r,eid:o.uuid,charge:v,special_price:s.special_price,balance:l[0].value,starsNeed:100*v,stars:l[1].value,starsUsed:c,starsLimited:d,payValues:"",indentId:p,actualprice:v,ispackpay:!1});D.pay(h).then(function(t){1!=t&&2!=t||(e.renderLock(e.getRecordItem(a)),e.lockVector=m(e.lockVector,[o.uuid])),g()})}).catch(function(e){return g()})},function(){return g()})}).catch(function(e){return g()})}else A.a.custom("Info","请在应用商店下载闪艺app，阅读完整版作品","提示","知道了","取消",!1);else A.a.info("请前往APP或电脑端购买~").then(function(){},function(){});else A.a.info("商城功能尚未开启，是否前往闪艺抢先体验？").then(function(){window.location.href="https://wap.3000.com/?m=detail&op=index&ac=index&id=".concat(r)},function(){});else A.a.info("购买存档操作（闪币-".concat(v,"）,测试阶段不会扣除账户余额")).then(function(){e.renderLock(e.getRecordItem(a)),u.c.typeUnlockRecords.push(o.uuid),e.lockVector=m(e.lockVector,[o.uuid])})})}}},{key:"updateRecords",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=game.cache,r=this.state.mode;return this.records=t,function a(i){if(i>=t.length)return Promise.resolve();var o=t[i],s=Math.floor(i/e.column),c=Math.floor(i%e.column),l=e.items[s][c];"save"!==r||(0==s&&0==c||!e.autoSaveOrLoad)&&e.autoSaveOrLoad||(e.lockVector.some(function(e){return e.uuid==l.uuid})?e.renderLock(l,l.rect):e.renderLock(l)),"load"===r&&e.renderLock(l);var d=l.getByName("content"),h=l.getByName("time"),f=d.width,p=d.height,v=function(e){d.loadTexture(e),d.width=f,d.height=p};if(!o)return h.setText(""),v(e.defaultItemUrl),a(i+1);var m=o.thumb,g=o.timestamp,y=m.indexOf("coverran")>-1,_=ge.a.hash(m);if(n.checkImageKey(_))v(_);else{var w=new Image;y&&w.setAttribute("crossOrigin","anonymous"),w.src=m,w.onload=function(e){n.checkImageKey(_)||n.addImage(_,m,e.target),v(_)}}return h.setText(u.a.format(g)),a(i+1)}(0)}},{key:"renderRecords",value:function(e,t){var n=t.itemSpaceX,r=void 0===n?20:n,a=t.itemSpaceY,i=void 0===a?12:a,o=e.rect,u=e.background,s=e.content,c=e.hint,l=o.x,d=o.y,h=o.height,f=o.width,p=this.row,v=this.column;this.items=[],this.defaultItemUrl=s.background.url;for(var m=0,g=0;g<p;g++){this.items[g]=[];for(var y=0;y<v;y++){var _=mt.group();_.x=y*(f+r)+l,_.y=g*(h+i)+d,_.id=m,m++,_.rect={x:_.x,y:_.y,width:f,height:h};var w=$.records[_.id];_.uuid=w?w.uuid:"",_.price=w?w.price:0,_.lock=!1,_.add(mt.image(u.url,{height:h,width:f}));var b=mt.image(s.background.url,O({},s.rect,{name:"content"}));_.add(b);var k=mt.text(c.rect,O({},c.text,{name:"time",boundsAlignH:"center",boundsAlignV:"middle"}));k&&_.add(k);var x=mt.rectMask({rect:{height:h,width:f}});if(_.addChild(x),_.mask=x,this.autoSaveOrLoad&&!g&&!y){var P=mt.rectMask({rect:{height:h,width:f},alpha:.4});_.addChild(P),_.addChild(mt.text({x:0,y:0,height:h,width:f},{fontSize:16,color:"white",fontFamily:"Microsoft YaHei",text:"自动存档",boundsAlignH:"center",boundsAlignV:"middle"}))}this.scrollPane.addChild(_),this.items[g][y]=_}}}},{key:"renderLock",value:function(e,t){if(e){var n=!t,r=e.getByName("lockmask"),a=e.getByName("locktext"),i=e.getByName("locakimg");if(n)i&&e.remove(i,!0),r&&e.remove(r,!0),a&&e.remove(a,!0),e.lock=!1;else{var o=t.width,u=t.height;r||((r=mt.rectMask({rect:{height:u,width:o},alpha:.8})).name="lockmask",e.addChild(r)),i||((i=mt.image("lock",{x:o/2,y:u/2-30,centre:!0})).name="locakimg",e.addChild(i)),a||((a=mt.text({x:0,y:20,height:u,width:o},{fontSize:16,color:"white",forceFontFamily:"Microsoft YaHei",text:"".concat(e.price,"闪币解锁"),boundsAlignH:"center",boundsAlignV:"middle"})).name="locktext",e.addChild(a)),e.lock=!0}}}},{key:"getRecordItem",value:function(e){var t,n=0;for(t=0;t<this.items.length;t++)for(n=0;n<this.items[t].length;n++){var r=this.items[t][n];if(r.id==e)return r}return null}},{key:"renderScrollBox",value:function(e){var t=this,n=l.a.vertical,r=e.rect,a=e.item,i=e.itemsOffsetX,o=void 0===i?0:i,u=e.itemsOffsetY,s=void 0===u?0:u,c=e.itemSpaceX,d=void 0===c?20:c,h=e.itemSpaceY,f=void 0===h?12:h,p=r.x,v=r.y,m=r.width,g=r.height,y=a.rect,_=y.height,w=y.width,b=p+o,k=v+s,P=mt.sprite({x:b,y:k});this.container.add(P);var C=_*this.row+f*(this.row-1),S=!1;P.scrollY=function(e){e=e+.5|0,null!=A&&Math.abs(P.y-A)>5&&(S=!0),P.y=e>k||C<=g?k:e+C<v+g?v+g-C:e};var O=function(e){var t,r,a=e.worldX,i=e.worldY,o=game.world.angle;if(n&&90===o||!n&&0===o){var u=n?[i,-a]:[a,i],s=Object(x.a)(u,2);t=s[0],r=s[1]}else{var c=n?[a,i]:[i,-a],l=Object(x.a)(c,2);t=l[0],r=l[1]}return r<k||r>k+g||t<b||t>b+m?null:{x:t,y:r}};P.inputEnabled=!0;var E=P.input,I=P.events;E.enableDrag(),E.allowHorizontalDrag=!1;var A=null;I.onDragUpdate.add(function(e,t,n,r,a,i){return P.scrollY(r)},this),I.onDragStart.add(function(e,t,n,r,a,i){return A=P.y},this),I.onDragStop.add(function(e,t,n,r,a,i){return A=P.y},this),I.onInputDown.add(function(e,t,n,r){S=!1,O(t)?e.input.enableDrag():e.input.disableDrag()}),I.onInputUp.add(function(e,n){var r=O(n);if(!S&&r&&(n.pointerMode!==Phaser.PointerMode.CURSOR||0===n.button)){var a=r.x-P.x,i=r.y-P.y,o=w+d,u=_+f;a%o<w&&i%u<_&&a<=V&&t.handleRecordClick(Math.floor(a/o),Math.floor(i/u))}},this);var M=!1,T=function(e){var t=e.wheelDelta?e.wheelDelta/120:-e.detail/3;P.scrollY(P.y+100*t)};game.input.addMoveCallback(function(e,t,n){var r=O(e),a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";!r&&M?(document.removeEventListener(a,T),M=!1):r&&!M&&(document.addEventListener(a,T),M=!0)},this);var V=m-o,j=g-s,U=mt.rectMask({rect:{x:b,y:k,width:V,height:j}});this.container.add(U),P.mask=U,this.scrollPane=P,this.renderRecords(a,e);var D=mt.group("",{x:b,y:k}),R=mt.rectMask({rect:{width:V,height:j},alpha:.5});R.inputEnabled=!0,D.add(R),this.loadingTipText=mt.text({width:V,height:j},{fontSize:16,forceFontFamily:"宋体",color:"#fff",boundsAlignH:"center",boundsAlignV:"middle"}),D.add(this.loadingTipText),this.loadingTip=D,this.container.add(D)}},{key:"render",value:function(e){var t=this,n=e.template.json.record,r=n.scrollBox,a=n.back,i=n.background,o=game.world,u=o.width,s=o.height,c=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e||!e&&r){var a=mt.image(e,n);a.inputEnabled=r,t.container.add(a)}};c(i.url,{x:0,y:0,width:u,height:s},!0),c(r.background.url,r.rect),this.renderScrollBox(r),function(e,n,r){var a=e.rect,i=e.normal,o=e.active;if(!e.hidden){var u={name:n,normalUrl:i.background.url,activeUrl:o.background.url,onClick:t.handleClick,textOptions:{normal:O({},i.text,{text:r}),active:O({},o.text,{text:r})},audio:{url:$.buttonSoundUrl,volume:1}};t.container.add(mt.button(a,u))}}(a,"record_button_back","返回");var l={x:u-74,y:25,width:68,height:68},d={name:sn[0],onClick:this.handleClick,checkedUrl:"local_hover",uncheckedUrl:"local",textOptions:{checked:O({},a.active.text),unchecked:O({},a.normal.text)}};this.container.add(mt.checkbox(l,d)),cn||(d.name=sn[1],l.y=107,d.uncheckedUrl="cloud",d.checkedUrl="cloud_hover",this.container.add(mt.checkbox(l,d)))}}]),e}(),pn=null,vn=function(){function e(t){var n=this,r=t.callbacks;Object(i.a)(this,e),P(this,"handleButtonClick",function(e,t){t.pointerMode===Phaser.PointerMode.CURSOR&&0!==t.button||("end_button_back"===e.parent.name?(n.close(),n.callbacks&&n.callbacks.back&&n.callbacks.back()):"end_button_load"===e.parent.name?n.callbacks&&n.callbacks.load&&n.callbacks.load():"end_button_save"===e.parent.name&&n.callbacks&&n.callbacks.save&&n.callbacks.save())}),this.callbacks=r,this.container=mt.group(),this.render(),game.onRestart.add(function(){return n.close()})}return Object(o.a)(e,[{key:"close",value:function(){var e=this.container;e.parent&&e.parent.remove(e),e.visible=!1}},{key:"update",value:function(e){var t=e.callbacks;return this.callbacks=t,this.container.visible=!0,this}},{key:"render",value:function(){var e=this,t=l.a.vertical,n=game.world,r=n.width,a=n.height,i=mt.rectMask({rect:{width:r,height:a},alpha:.8});i.inputEnabled=!0,this.container.add(i);var o=function(t,n,r){var a=t.rect,i=t.normal,o=t.active,u={name:n,normalUrl:i.url,activeUrl:o.url,onClick:e.handleButtonClick,textOptions:{center:!1,normal:O({},i.text,{text:r}),active:O({},o.text,{text:r}),rect:{width:96,height:30,x:0,y:100}},audio:{url:$.buttonSoundUrl,volume:1}};e.container.add(mt.button(a,u))},u={width:96,height:96},s={text:{forceFontFamily:"宋体",fontSize:14,color:"#ffffff"}},c={text:{forceFontFamily:"宋体",fontSize:14,color:"#ef7297"}},d=t?[55,427]:[168,100],h=Object(x.a)(d,2);u.x=h[0],u.y=h[1];var f=["icon_get","icon_get_hover_pressed"];s.url=f[0],c.url=f[1],o({rect:u,normal:s,active:c},"end_button_load","读取进度");var p=t?[216,427]:[432,100],v=Object(x.a)(p,2);u.x=v[0],u.y=v[1];var m=["icon_back","icon_back_over_pressed"];s.url=m[0],c.url=m[1],o({rect:u,normal:s,active:c},"end_button_back","返回封面");var g=t?[377,427]:[696,100],y=Object(x.a)(g,2);u.x=y[0],u.y=y[1];var _=["icon_save","icon_save_over_pressed"];s.url=_[0],c.url=_[1],o({rect:u,normal:s,active:c},"end_button_save","存个档，下次玩")}}]),e}(),mn=(n(180),null),gn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(mn?mn.update(e):mn=new _n(e)).container};function yn(){return new Promise(function(e,t){var n=l.a.uuid,r=l.a.vertical,a=l.a.wap;D.setCallback("shanyiMenuBack",function(){document.body.removeChild(i),e()}),D.setCallback("shanyiMenuExit",function(t){"string"!=typeof t||-1===t.indexOf("http")?(document.body.removeChild(i),e()):window.location.href=t});var i=document.createElement("div");i.classList.add("syModalContainer");var o=document.createElement("div");o.classList.add("syModalPortal"),document.body.clientWidth<=document.body.clientHeight&&(o.style.transform=r?"rotate(0)":"rotate(90deg)"),window.onresize=function(){document.body.clientWidth<=document.body.clientHeight?o.style.transform=r?"rotate(0)":"rotate(90deg)":o.style.transform=r?"rotate(90deg)":"rotate(0)"},i.appendChild(o);var u=document.createElement("div");u.classList.add("syContent"),o.appendChild(u),r&&(u.style.width="320px",u.style.height="510px");var s=document.createElement("iframe");s.src="https://www.3000.com/popup.html?uuid="+n+"&wap="+a+"&vertical="+(r?1:0),s.scrolling="no",s.width="100%",s.height="100%",s.frameBorder="0",u.appendChild(s),document.body.appendChild(i)})}var _n=function(){function e(t){var n=this,r=t.callbacks,a=t.template;Object(i.a)(this,e),P(this,"handleClick",function(e,t){if(t.pointerMode!==Phaser.PointerMode.CURSOR||0===t.button){var r=l.a.client,a=l.a.isWapOther,i=l.a.type,o=l.a.wap,u=l.a.single,s=l.a.singleoffline;if("qzone"!==o)if("menu_button"===e.parent.name)n.callbacks&&n.callbacks.menu&&n.callbacks.menu();else if("shanyiMenu_button"===e.parent.name){if(1==i)return void A.a.info("作品发布上线后才可以召唤闪艺菜单哦~~");var c=function(){$.full&&(!D.isAppClient()&&game.scale.stopFullScreen(),$.full=!1)};if(u)return c(),void(s?window.app&&window.app.moreWorks():D.gameQuit());if("wap"===r)return c(),void("wx"===o?M.e.openWxPage("back"):window.parent&&window.parent.closGame());"ios"===r||"android"===r?a?(c(),yn()):D.openShanyiMenu():"pc"===r?(c(),D.openShanyiMenu()):(c(),yn())}else"packdown_button"===e.parent.name?(n.packdown.visible=!1,n.packup.visible=!0,n.showList.forEach(function(e){return e.visible=!0})):"packup_button"===e.parent.name&&(n.packdown.visible=!0,n.packup.visible=!1,n.showList.forEach(function(e){return e.visible=!1}));else switch(e.parent.name){case"invite_button":n.callbacks&&n.callbacks.share&&n.callbacks.share(!0);break;case"share_button":n.callbacks&&n.callbacks.share&&n.callbacks.share();break;case"help_button":n.callbacks&&n.callbacks.menu&&n.callbacks.menu()}}}),this.callbacks=r,this.container=mt.group(),this.packup=null,this.packdown=null,this.showList=[],this.render(a.json)}return Object(o.a)(e,[{key:"update",value:function(e){var t=e.callbacks;return this.callbacks=t,this.container.visible=!0,this}},{key:"render",value:function(e){var t=this,n=l.a.client,r=l.a.vertical,a=l.a.wap,i=l.a.single,o=l.a.singleoffline,u=l.a.isWapOther,s=e.menu,c=e.shanyiMenu,d=function(e,n){var r=e.rect,a=e.normal,i=e.active,o={name:n,normalUrl:a.background.url,activeUrl:i.background.url,onClick:t.handleClick,audio:{url:$.buttonSoundUrl,volume:1}},u=mt.button(r,o);return t.container.add(u),u};if("qzone"===a){var h=r?442:886,f={rect:{x:h,y:100,width:44,height:69},normal:{background:{url:"share"}},active:{background:{url:"share"}}},p={rect:{x:h,y:180,width:44,height:69},normal:{background:{url:"help"}},active:{background:{url:"help"}}};d({rect:{x:h,y:20,width:44,height:69},normal:{background:{url:"invite"}},active:{background:{url:"invite"}}},"invite_button"),d(f,"share_button"),d(p,"help_button")}else{if(u){var v=r?[442,30]:[886,26],m=Object(x.a)(v,2),g=m[0],y=m[1];s.rect.x=g,s.rect.y=y}if(this.showList.push(d(s,"menu_button")),!u)if(c){if("wap"!==n&&!i){var _={rect:{x:s.rect.x+5,y:0,width:61,height:26},normal:{background:{url:"packup"}},active:{background:{url:"packup-hover"}}};this.packup=d(_,"packup_button");var w={rect:{x:s.rect.x+5,y:0,width:61,height:26},normal:{background:{url:"packdown"}},active:{background:{url:"packdown-hover"}}};this.packdown=d(w,"packdown_button"),this.packdown.visible=!1}var b=c,k=b.rect,P=b.normal,C=b.active,S={rect:k,normal:{background:{url:i?o?"menumore":"wapback":"wap"===n?"wapback":P.background.url}},active:{background:{url:i?o?"menumore_hover":"wapback":"wap"===n?"wapback":C.background.url}}};this.showList.push(d(S,"shanyiMenu_button"))}else if("wap"===n){var O=r?[442,30]:[886,26],E=Object(x.a)(O,2);c={rect:{x:E[0],y:E[1],width:68,height:68},normal:{background:{url:"wapback"}},active:{background:{url:"wapback"}}},this.showList.push(d(c,"shanyiMenu_button"))}}}}]),e}(),wn=null,bn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return wn?wn.update(e):wn=new xn(e)},kn=/([\s\S]*)\\(\d+)\s([\s\S]*)/,xn=function(){function e(t){var n=this,r=t.gameJson,a=t.settings;Object(i.a)(this,e),this.gameJson=r,this.container=mt.group(),this.containerVector=[];var o=this.gameJson,u=o.template.json.dialog,s=o.dialogs;this.containerVector.push(this.render(u,0)),s&&s.forEach(function(e){n.containerVector.push(n.render(e,e.id))}),this.paused=!1,this.changeline=!1,this.showpageing=!1,this.update({settings:a})}return Object(o.a)(e,[{key:"clear",value:function(){var e=this.container,t=e.parent;t&&t.remove(e,!1),this.animating&&this.animating.cancel&&this.animating.cancel()}},{key:"pause",value:function(){this.paused=!0}},{key:"proceed",value:function(){this.paused=!1}},{key:"update",value:function(e){var t,n,r,a,i=e.settings,o=i.dialogid,u=this.gameJson,s=(u.dialogs,u.default_settings.color),c=this.container.children[0]||null;this.container.alpha=1,this.container.visible=!0;var l=null;c?o!==c.id?(l=this.containerVector.find(function(e){return e.id==o})||this.containerVector[0],this.container.replace(c,l)):l=c:(l=this.containerVector[o]||this.containerVector[0],this.container.add(l)),t=l.json.content.rect.width,n=l.json.content.rect.height,r=l.json.titleContainer.title,a=l.json.avatarContainer,s=l.json.content.text.color||s,this.background=l.background,this.titleContainer=l.titleContainer,this.titleText=l.titleText,this.avatarContainer=l.avatarContainer,this.avatar=l.avatar,this.textarea=l.textarea;var d={width:t,height:n,title:r,avatarContainer:a,color:s};return this.setting(i,d),this}},{key:"setting",value:function(e,t){var n=t.width,r=t.height,a=t.title,i=t.avatarContainer,o=t.color,s=i.avatar,c=i.rect,l=e.speaking,d=l.fontFamily,h=l.font_size,f=void 0===h?12:h,p=l.data,v=l.immediate,m=l.hidden,g=l.speed,y=e.avatar,_=e.dialogtitle;if(this.avatarContainer.visible=!y.hidden,!y.hidden){var w=s.x,b=s.y,k=s.width,x=s.height;w+=c.x,b+=c.y,this.avatar.loadTexture(y.url||"");var P=this.avatar.texture,C=Math.min(k/P.width,x/P.height);k=P.width*C,x=P.height*C,this.avatar.x=w+(s.width-k)/2,this.avatar.y=b+(s.height-x)/2,this.avatar.width=k,this.avatar.height=x}this.background.visible=!m,this.titleContainer.visible=!_.hidden,this.titleText.setStyle({align:"center",boundsAlignH:"center",boundsAlignV:"middle",fontFamily:d,color:_.color||a.text.color,fontSize:Number(_.font_size||a.text.fontSize)}),this.titleText.setText(_.data);var S=m?game.world.height:r;this.textarea.setStyle({fontFamily:d,fontSize:f}),Array.isArray(p)||(p=u.c.toArrayForData(p).map(function(t){return O({},t,{color:e.speaking.color||o})})),this.state={data:p,immediate:v,speed:parseInt(g,10),lineHeight:1.5*f,maxHeight:S,hidden:m},this.textarea.setTexts(p.map(function(e){for(var t=e.data,n=void 0===t?"":t,r=kn.exec(n);r;)n=r[1]+r[3],r=kn.exec(n);return O({},e,{data:n})})),this.textarea.y=0,v||(S=0);var E=this.textarea.mask;E.clear(),E.beginFill();var I=new Phaser.Polygon;I.setTo([new Phaser.Point(0,0),new Phaser.Point(n,0),new Phaser.Point(n,S),new Phaser.Point(0,S)]),E.drawPolygon(I.points),E.endFill()}},{key:"animate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.changeline=!1,this.showpageing=!1,this.paused=!1;var r=this.state,a=r.data,i=r.speed,o=r.lineHeight,s=r.maxHeight,c=r.hidden,l=o/3,d=!1,h=0,f=0,p=0,v=0,m=0,g=[];a.forEach(function(e){return g.push(e.data.length)});var y=0,_=1,w=!1,b=[],k=this.textarea.getLines();k.forEach(function(e){return b.push(e.length)});var x=k.length,P=this.container.children[0],C=P?P.json.content.rect.width:this.gameJson.template.json.dialog.content.rect.width,S=P?P.json.content.rect.height:this.gameJson.template.json.dialog.content.rect.height,O=Math.floor((S+l)/o),E=this.textarea.mask,I=function(e){var n=e.lineIndex,r=e.lineCharIndex;n>=x&&(n=x?x-1:x,r=x?k[x-1].length:0);var a=s-(n+1)*o;t.textarea.y=a+l>0||!n?0:a,E.clear(),E.beginFill();var i=new Phaser.Polygon,u=(n+1)*o;u=u>s?s:u;var c=t.textarea.getCharsWidth((k[n]||"").slice(0,r));i.setTo([new Phaser.Point(0,0),new Phaser.Point(0,u),new Phaser.Point(c,u),new Phaser.Point(c,u-o),new Phaser.Point(C,u-o),new Phaser.Point(C,0)]),E.drawPolygon(i.points),E.endFill()},A=function(){I({lineIndex:x,lineCharIndex:0}),t.isClickChange=!1};return e||this.state.immediate?(A(),Promise.resolve()):(this.isClickChange=!c&&x*o>=S,this.animating&&this.animating.cancel&&this.animating.cancel(),this.animating=new Promise(function(e,r){!function r(s){var c=s.lineIndex,h=s.lineCharIndex,g=s.dataIndex,b=s.dataCharIndex;if(!d)if(t.paused){if(t.changeline&&!w){if(h=p,g=v,b=m,(c=f)>=x)return A(),void e("over");y=0}u.c.timeout(100).then(function(){return r({lineIndex:c,lineCharIndex:h,dataIndex:g,dataCharIndex:b})})}else{if(g>=a.length||c>=x)return A(),void e("over");_=Math.ceil((c+1)/O),t.changeline=!1,w=!1;var P=a[g],C=P.data,E=P.placeholder,M=i,T=null;do{if(E&&(T=kn.exec(C))){M=T[2],g++,b=0;break}if(b++,++h>=k[c].length&&(c++,h=0,y+=o,Math.abs(y-S)<=l&&t.isClickChange&&!$.fastPlay&&!$.autoPlay&&!n)){if(g>=a.length||c>=x)return A(),void e("over");w=!0,t.changeline=!0,t.paused=!0,y=0,I({lineIndex:c-1,lineCharIndex:k[c-1].length})}b>=C.length&&(g++,b=0)}while(0);!t.changeline&&I({lineIndex:c,lineCharIndex:h}),u.c.timeout($.fastPlay?0:M).then(function(){return r({lineIndex:c,lineCharIndex:h,dataIndex:g,dataCharIndex:b})})}}({lineIndex:0,lineCharIndex:0,dataIndex:0,dataCharIndex:0})}),this.animating.cancel=function(){d=!0,A()},this.animating.showpage=function(){if(!d){t.showpageing=!0,t.changeline=!0,t.paused=!0;var e,n;if(p=0,v=function(e){var t=0,n=0,r=0;for(t=0;t<e&&t<b.length;t++)n+=b[t];for(t=0;t<g.length;t++)if((r+=g[t])>=n)return t;return g.length-1}(f=O*_),m=function(e,t){var n=0,r=0,a=0;for(n=0;n<e&&n<b.length;n++)r+=b[n];for(n=0;n<t;n++)a+=g[n];return r-a}(f,v),!((h=f-1)>=x))e=h,n=k[h].length,I({lineIndex:e,lineCharIndex:n}),t.showpageing=!1}},this.animating)}},{key:"render",value:function(e,t){var n=mt.group();n.id=t,n.json=e;var r=game.make,a=this.gameJson.default_settings.color,i=e.background,o=e.rect,s=e.avatarContainer,c=e.titleContainer,l=e.content;n.background=mt.image(i.url,O({},o,{x:0,y:0})),n.add(n.background),n.titleContainer=mt.group(),c.background.url&&n.titleContainer.add(mt.image(c.background.url,c.rect));var d=c.rect.x+c.title.rect.x,h=c.rect.y+c.title.rect.y;n.titleText=mt.text(O({},c.title.rect,{x:d,y:h}),{}),n.titleContainer.add(n.titleText),n.add(n.titleContainer),n.avatarContainer=mt.group(),s.background.url&&n.avatarContainer.add(mt.image(s.background.url,s.rect)),d=s.rect.x+s.avatar.x,h=s.rect.y+s.avatar.y;var f=s.avatar,p=f.width,v=f.height,m=f.clip;n.avatar=mt.image("",{width:p,height:v,x:d,y:h});var g=r.graphics(0,0);switch(g.beginFill(),m){case"square":g.drawRect(d,h,p,v);break;case"hexagon":var y=new Phaser.Polygon;y.setTo([new Phaser.Point(p/2+d,h),new Phaser.Point(p/2+v/4*Math.pow(3,.5)+d,v/4+h),new Phaser.Point(p/2+v/4*Math.pow(3,.5)+d,v/4*3+h),new Phaser.Point(p/2+d,v+h),new Phaser.Point(p/2-v/4*Math.pow(3,.5)+d,v/4*3+h),new Phaser.Point(p/2-v/4*Math.pow(3,.5)+d,v/4+h)]),g.drawPolygon(y.points);break;case"heart":g.moveTo(p/2+d,p/4+h),g.bezierCurveTo(3*p/4+d,-p/4+h,3*p/2+d,p/4+h,p/2+d,p+h),g.bezierCurveTo(-p/2+d,p/4+h,p/4+d,-p/4+h,p/2+d,p/4+h);break;case"round":default:g.drawCircle(d+p/2,h+v/2,p)}g.endFill(),n.avatar.mask=g,n.avatarContainer.add(n.avatar),n.add(g),n.add(n.avatarContainer);var _=l.rect;d=_.x,h=_.y,p=_.width,v=_.height,d=u.b.roundToInt(d),h=u.b.roundToInt(h);var w=mt.group("textareaContainer",{x:d,y:h,width:p,height:v});n.add(w);var b=r.graphics(0,0);b.beginFill();var k=new Phaser.Polygon;return b.drawPolygon(k.points),b.endFill(),n.textarea=mt.textarea({width:p,height:v},{color:0!==t?l.text.color:a}),n.textarea.mask=b,w.add(b),w.add(n.textarea),n}}]),e}(),Pn=["background","bottomDialog","images","weather","topDialog","click2continue","options","animations"],Cn=function(){function e(t){var n=this,r=t.game,a=t.json,o=t.getPlayContext,u=t.setBackground,s=t.getInheritBackground,c=t.showPlotViews,l=t.hideBackground,d=t.noShowingViews,h=t.autoSaveRecord,f=t.resetPlayCount;Object(i.a)(this,e),this.game=r,this.json=a,this.props={getPlayContext:o,setBackground:u,getInheritBackground:s,showPlotViews:c,hideBackground:l,noShowingViews:d,autoSaveRecord:h,resetPlayCount:f};var p=mt.group("scene");this.container=p,Pn.forEach(function(e){return n[e]=p.add(mt.group(e))}),this.tweens=[],this.optionsTimeoutHandles=[]}return Object(o.a)(e,[{key:"renderBackground",value:function(e){var t=this.props.getInheritBackground,n=e.animations,r=e.background,a=r.flex,i=r.url,o=r.opacity,u=void 0===o?1:o,s=n.some(function(e){return"fadein"===e.type||"coverblack"===e.type})?0:u,c=this.game.world,l=c.width,d=c.height,h=null;if("inherit"===i){var f=t();a=f.flex,i=f.url;var p=f.opacity;u=void 0===p?1:p,s=n.some(function(e){return"fadein"===e.type||"coverblack"===e.type})?0:u}i?(h=mt.image(i),xt.flex(a,h,{width:l,height:d})):h=mt.rectMask({rect:{width:l,height:d}}),h.alpha=s,this.background.add(h)}},{key:"renderWeather",value:function(){var e=this,t=l.a.vertical,n=this.plot.weather.value,r=this.game,a=r.cache,i=r.time.events,o=r.world,s=o.width,c=o.height;if(!t&&"windy"===n){var d=mt.tileSprite({x:0,y:0,width:s,height:c,url:"wind"});return d.autoScroll(-360,0),void this.weather.add(d)}var h=u.c.getWeatherUrls(n),f=h.length;if(f&&a.checkImageKey(h[0])){var p=mt.image();this.weather.add(p);var v=0;!function t(){return i.add(40,function(){var e=h[v];p.parent&&a.checkImageKey(e)&&(p.loadTexture(e),v=++v%f,t())},e)}()}else this.weather.removeAll(!0)}},{key:"renderDialog",value:function(){var e=this.plot,t=e.speaking,n=e.dialogtitle,r=e.avatar,a=e.dialogid,i=void 0===a?0:a,o=t.coverage,s=t.x,c=t.y,l=t.opacity,d=void 0===l?1:l,h=t.animations,f=void 0===h?[]:h;if(this.dialogView=bn({gameJson:this.json,settings:{speaking:t,dialogtitle:n,avatar:r,dialogid:i}}),f.length){d=f.some(function(e){return"fadein"===e.type})?0:1;var p=f.find(function(e){return"moveFrom"===e.type});s=p?p.x:s,c=p?p.y:c}var v=this.dialogView.container;v.x=u.b.roundToInt(s),v.y=u.b.roundToInt(c),v.alpha=d,("bottom"===o?this.bottomDialog:this.topDialog).add(v)}},{key:"renderImages",value:function(){var e=this,t=this.plot,n=t.characters,r=t.props,a=t.animations,i=function(t){var n=t.url,r=t.width,a=t.height,i=t.rotate,o=void 0===i?0:i,s=t.mirrorH,c=t.mirrorV,l=t.animations,d=t.x,h=t.y,f=t.opacity,p=void 0===f?1:f;p=l.some(function(e){return"fadein"===e.type&&"animateIn"===e.trigger})?0:p;var v=l.find(function(e){return"moveFrom"===e.type&&"animateIn"===e.trigger});v&&(d=isNaN(parseFloat(v.x))?d:parseFloat(v.x),h=isNaN(parseFloat(v.y))?h:parseFloat(v.y));var m=u.c.isObject(n)&&n.type,g=e.props.getPlayContext;m&&(ut.playContext=g());var y=mt.image(n,{x:d,y:h}),_=m?Math.min(r/100,a/100):Math.min(r/y.width,a/y.height);return y.pivot.x=y.width/2,y.pivot.y=y.height/2,y.scale.setTo(_,_),y.sourceScale=_,y.x+=y.width/2,y.y+=y.height/2,y.alpha=p,y.angle=180===parseInt(o)?179.9:-180===parseInt(o)?-179.9:o,y.info=t,s&&(y.angle=-y.angle,y.scale.x=-y.scale.x),c&&(y.angle=-y.angle,y.scale.y=-y.scale.y),y};n.forEach(function(t){return e.images.add(i(t))}),r.forEach(function(t){return e.images.add(i(t))}),this.images.visible=!a.some(function(e){return"in"===e.trigger&&e.duration>0})}},{key:"renderOptions",value:function(e){var t=this;this.options.removeAll(!0);for(var n=this.props.getPlayContext,r=this.game.time.events,a=this.plot.options,i=this.json.template.json.option,o=i.rect,s=i.normal,c=i.active,l=[],d=[],h=n(),f=function(n,i){var f=a[n],p=f.font,v=f.timer,m=f.background,g=f.hideTimer,y=f.disable,_=void 0!==y&&y,w=f.name,b=f.condition,k=f.sound,x=f.uuid;if(w=ke.parseValue(w,h),b){var P=b.disable,C=b.enable,S=b.expression,O=ke.safeEval(S,h);if(_=O?"disable"===C.type:"disable"===P.type,O?"hidden"===C.type:"hidden"===P.type)return d.push(Promise.resolve(!1)),"continue"}var E=o.x,I=o.y,A=o.width,M=o.height,T=s.background.url,V=s.background.url,j=c.background.url;E=null!=f.x?f.x:E,I=null!=f.y?f.y:I,E=u.b.roundToInt(E),I=u.b.roundToInt(I),m&&(A=null!=f.width?f.width:A,M=null!=f.height?f.height:M,j=m.active.url,T=m.normal.url,V=m.disable?m.disable.url:T);var U={fontSize:p.normal.font_size,fontWeight:p.normal.bold,color:p.normal.color},D={fontSize:p.disable.font_size,fontWeight:p.disable.bold,color:p.disable.color},R=mt.button({x:E,y:I,width:A,height:M},{normalUrl:T,activeUrl:j,disableUrl:V,audio:k,onClick:function(t,r){r.pointerMode===Phaser.PointerMode.CURSOR&&0!==r.button||(l.forEach(function(e){return e()}),e({type:"option",control:{index:n}}),$e([x]))},textOptions:{disable:D,normal:U,active:U}});if(t.options.add(R),R.showText(!p.normal.hidden),_&&(R.disable(),R.showText(!p.disable.hidden)),R.setText(w),v){var B=ke.safeEval(v.time,h);!g&&R.setText("".concat(w,"(").concat(B,")")),d.push(new Promise(function(e,n){var a=r.loop(Phaser.Timer.SECOND,function(){t.paused||(B--,g||R.setText("".concat(w,"(").concat(B,")")),B<=0&&(r.remove(a),"disable"===v.type?(R.showText(!p.disable.hidden),R.disable(),e(!1)):(R.showText(!p.normal.hidden),R.enable(),e(!0)),R.setText(w)))});t.optionsTimeoutHandles.push(function(){r.remove(a)}),l.push(function(){r.remove(a),e(!0)})}))}else _&&d.push(Promise.resolve(!1))},p=0,v=a.length;p<v;p++)f(p);Promise.all(d).then(function(t){return t.length!==a.length||t.some(function(e){return e})?void 0:e()})}},{key:"doInTL",value:function(e){var t=this;return e!==this.timeline?Promise.reject("timeline changed"):this.paused?new Promise(function(n,r){!function a(){t.paused?t.setTimeoutId=setTimeout(a,50):e!==t.timeline?r("timeline changed"):n()}()}):Promise.resolve()}},{key:"pause",value:function(){this.paused=!0,this.dialogView&&this.dialogView.pause()}},{key:"proceed",value:function(){this.paused=!1,this.dialogView&&!this.dialogView.changeline&&this.dialogView.proceed()}},{key:"playMusic",value:function(){var e=this.plot.music,t=e.url,n=e.volume;t?"inherit"===t?ae.setMusicVolume(n):ae.playMusic({url:t,volume:n}):ae.stopMusic()}},{key:"playSounds",value:function(){var e=this.plot.plot_sound,t=function(e,t){var n=t||{},r=n.url,a=n.volume,i=n.time,o=void 0===i?1:i;r?ae.playSound({channel:e,url:r,volume:a,loop:1!==o}):ae.stopSound(e)};Array.isArray(e)?e.forEach(function(e,n){return t(n,e)}):t(0,e)}},{key:"fadeinMusic",value:function(e){var t=this,n=this.plot.music.animation;if(!n||!n.type.includes("fadein"))return Promise.resolve();var r=$.fastPlay||this.restore?10:1e3;return ae.tweenFromWithMusic({volume:0,duration:r}).then(function(){return t.doInTL(e)})}},{key:"fadeOutMusic",value:function(e){var t=this,n=this.plot.music.animation;if(!n||!n.type.includes("fadeout"))return Promise.resolve();var r=$.fastPlay?10:1e3;return ae.tweenToWithMusic({volume:0,duration:r}).then(function(){return t.doInTL(e)})}},{key:"transform",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"in",n=arguments.length>1?arguments[1]:void 0,r=this.plot,a=r.animations,i=r.background.opacity,o=void 0===i?1:i;return a=a.filter(function(e){return e.trigger===t}).map(function(t){var n=t.type,r=t.duration,a=t.delay,i=t.color,u=t.level;if($.fastPlay){var s=$.getFastPlayAnimationInfo(r);a=s.delay,r=s.duration}switch(e.restore&&(a=r=0),n){case"fadein":return q.to({target:e.background.children[0],properties:{alpha:o},duration:r,delay:a});case"twinkle":return q.twinkle({target:e.animations,duration:r,delay:a,color:i});case"shake":if(!r)return Promise.resolve();var c=u?5*u:0;return Promise.all(Pn.slice(0,3).map(function(t){return q.shake({target:e[t],duration:r,delay:a,offSet:c})}));case"curtain":return q.curtain({target:e.animations,duration:r,delay:a});case"interlacing":return q.interlacing({target:e.animations,duration:r,delay:a});case"coverblack":return Promise.all([q.coverblack({target:e.animations,duration:r,delay:a}),q.to({target:e.background.children[0],properties:{alpha:o},duration:1,delay:a+r/2})]);case"spread":var l=e.game.world,d=l.width,h=l.height,f=mt.rectMask({rect:{width:d,height:h}});return e.container.add(f,!0,0),Promise.all(Pn.slice(0,7).map(function(t){return q.spread({target:e[t],duration:r,delay:a})})).then(function(){return f.destroy()})}}),Promise.all(a).then(function(){return e.doInTL(n)})}},{key:"animateImages",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"animateIn",n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.images.visible=!0;var a=this.images.children,i=[];return a.forEach(function(n){var r=n.info,a=n.sourceScale,o=n.texture.frame,u=o.width,s=o.height,c=r.opacity,l=void 0===c?1:c,d=r.animations,h=void 0===d?[]:d,f=r.x,p=r.y;h.filter(function(e){return e.trigger===t}).forEach(function(t){var r=t.type,o=t.duration,c=t.delay,d=t.x,h=t.y;if($.fastPlay){var v=$.getFastPlayAnimationInfo(o);c=v.delay,o=v.duration}switch(e.restore&&(c=o=0),r){case"fadein":i.push(q.to({target:n,properties:{alpha:l},duration:o,delay:c}));break;case"fadeout":i.push(q.to({target:n,properties:{alpha:0},duration:o,delay:c}));break;case"moveFrom":d=f+a*u/2,h=p+a*s/2,i.push(q.to({target:n,properties:{x:d,y:h},duration:o,delay:c}));break;case"moveTo":d+=a*u/2,h+=a*s/2,i.push(q.to({target:n,properties:{x:d,y:h},duration:o,delay:c}))}})}),Promise.all(i).then(function(){return e.doInTL(n)}).then(function(){return r})}},{key:"animateDialog",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"animateIn",n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=this.plot.speaking,i=a.animations,o=void 0===i?[]:i,u=a.x,s=a.y,c=this.dialogView.container,l=o.filter(function(e){return e.trigger===t}).map(function(t){var n=t.type,r=t.duration,a=t.delay,i=t.x,o=t.y;if($.fastPlay){var l=$.getFastPlayAnimationInfo(r);a=l.delay,r=l.duration}switch(e.restore&&(a=r=0),n){case"fadein":return q.to({target:c,properties:{alpha:1},duration:r,delay:a});case"fadeout":return q.to({target:c,properties:{alpha:0},duration:r,delay:a});case"moveFrom":return q.to({target:c,properties:{x:u,y:s},duration:r,delay:a});case"moveTo":return q.to({target:c,properties:{x:i,y:o},duration:r,delay:a})}});return Promise.all(l).then(function(){return e.doInTL(n)}).then(function(){return r})}},{key:"animateSpeak",value:function(e){var t=this;if((0,this.props.setBackground)(this.plot.background),this.restore)return this.dialogView.animate(!0);var n=this.dialogView.animate(),r=new Promise(function(n,r){t.handleContinue(e).then(function(){return n()}),t.setControlPlay(n)});return function a(){return Promise.race([n,r]).then(function(i){return null!=i||!t.dialogView.isClickChange||$.autoPlay||t.plot.autotext?Promise.resolve():(t.handleClearContinue(),r=new Promise(function(n,r){t.handleContinue(e).then(function(){return n()}),t.setControlPlay(n)}),t.dialogView.showpageing?a():(t.dialogView.changeline?t.dialogView.proceed():n.showpage&&n.showpage(),a()))}).then(function(e){return n.cancel&&n.cancel(),e}).then(function(n){return t.doInTL(e).then(function(){return t.handleClearContinue()}).then(function(){return n})})}()}},{key:"waitTime",value:function(e,t){var n=this,r=this.plot.wait.value;return $.fastPlay&&(r=Math.min(r,10)),u.c.timeout(r).then(function(){return n.doInTL(e)}).then(function(){return t})}},{key:"setControlPlay",value:function(e){this.controlPlay=function(t){return e(t)}}},{key:"dispatchContinueClick",value:function(){var e=this.click2continue.children;e[0]&&($.fastPlay||$.autoPlay)&&e[0].events.onInputUp.dispatch()}},{key:"handleContinue",value:function(e){var t=this,n=this.props,r=n.noShowingViews,a=n.resetPlayCount,i=this.game,o=i.input,u=o.keyboard,s=o.onHold,c=i.device.desktop,l=new Promise(function(e,n){return!c&&r()&&s.addOnce(function(){return e()},t)}),d=new Promise(function(e,n){return r()&&u.addKey(Phaser.Keyboard.Z).onDown.add(function(){return e()},t)}),h=new Promise(function(e,n){return r()&&u.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(function(){return e()},t)}),f=new Promise(function(e,n){t.click2continue.removeAll(!0);var r=t.game.world,i=r.width,o=r.height,u=mt.rectMask({rect:{width:i,height:o},alpha:0});u.inputEnabled=!0;var s={};u.events.onInputDown.add(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s={x:t.x,y:t.y}}),u.events.onInputUp.add(function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r||r.pointerMode!==Phaser.PointerMode.CURSOR||0===r.button){var i=Math.abs(s.x-r.x),o=Math.abs(s.y-r.y);Math.max(i,o)>60&&D.isAppClient()||(a(),t.click2continue.removeAll(!0),e())}}),t.click2continue.add(u)});return Promise.race([f,d,h,l]).then(function(){return t.doInTL(e)}).then(function(){return t.handleClearContinue()})}},{key:"handleClearContinue",value:function(){var e=this.game.input,t=e.keyboard,n=e.onHold;this.click2continue.removeAll(!0),n.removeAll(this),t.addKey(Phaser.Keyboard.Z).onDown.removeAll(this),t.addKey(Phaser.Keyboard.SPACEBAR).onDown.removeAll(this)}},{key:"play",value:function(e){var t=this,n=this.props,r=n.getPlayContext,a=n.showPlotViews,i=n.hideBackground,o=n.noShowingViews,s=n.autoSaveRecord,c=e.plots,l=e.plotIndex,d=e.load,h=e.restore;this.restore=h;var f=r(),p=this.plot=S()(c[l],{speaking:{data:{$apply:function(e){return ke.parseValue(e,f)}}},dialogtitle:{data:{$apply:function(e){return ke.parseValue(e,f)}}}});this.renderWeather(),this.renderDialog(),this.renderImages(),this.playMusic(),this.playSounds();var v={};return this.timeline=v,this.transform("in",v).then(function(){return Promise.all([a(),i(),t.transform("animateIn",v),t.animateImages("animateIn",v),t.animateDialog("animateIn",v),t.fadeinMusic(v)])}).then(function(){return Promise.all([t.transform("animateInEnd",v),t.animateDialog("animateInEnd",v)])}).then(function(){return t.animateSpeak(v)}).then(function(e){0===(p.autoSaveOrLoad||{}).type&&!d&&!h&&s();var n=!!e;if(e&&"nextPlot"!==e.type)return Promise.resolve(e);e={};var a=$.fastPlay&&o(),i=p.autotext||$.autoPlay&&o();if(p.insert)e={type:"insertPlot",control:{uuid:p.insert,from:"scene"}};else if(p.back)e={type:"back"};else if(p.jump)e={type:"jump",control:{uuid:p.jump}};else if(!n){var c=r(),l=(p.condition_options||[]).findIndex(function(e){return ke.safeEval(e.expression,c)});if(l<0?null:p.condition_options[l]){var f=a||i?Promise.resolve():t.handleContinue(v);return new Promise(function(e,n){var r=function(){f.cancel&&f.cancel(),e({type:"condition_option",control:{index:l}})};t.setControlPlay(e);var o=function(){return f.then(r)};a?o():i?u.c.timeout(p.speaking.immediate?400:0).then(function(){return t.doInTL(v)}).then(function(){return o()}):o()})}if(p.options.length>0&&p.options.some(function(e){var t=e.condition;if(!t)return!0;var n=t.disable,r=t.enable,a=t.expression;return!(ke.safeEval(a,c)?"hidden"===r.type:"hidden"===n.type)}))return t.game.input.onUp.dispatch(),new Promise(function(e,n){t.renderOptions(e),t.setControlPlay(e)})}var m=n||a||i?Promise.resolve():t.handleContinue(v);return new Promise(function(n,r){t.setControlPlay(function(t){return n("nextPlot"===t.type?e:t)});var o=function(){return m.then(function(){return n(e)})};a?o():i?u.c.timeout(p.speaking.immediate?400:0).then(function(){return t.doInTL(v)}).then(function(){return o()}):o()})}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.options.removeAll(!0),t.handleClearContinue();var n=r(),a=(p.condition_options||[]).findIndex(function(e){return ke.safeEval(e.expression,n)}),i=a<0?null:p.condition_options[a];return e.type&&"nextPlot"!==e.type&&"condition_option"!==e.type||p.back||p.jump||p.insert?O({},e):i?{type:"condition_option",control:{index:a}}:{}}).then(function(e){return t.waitTime(v,e)}).then(function(e){return Promise.all([t.animateImages("animateOut",v,e),t.animateDialog("animateOut",v,e),t.fadeOutMusic(v)])}).then(function(e){return e[0]})}},{key:"clear",value:function(){var e=this;for(this.proceed(),this.dialogView&&this.dialogView.clear(),this.handleClearContinue();this.optionsTimeoutHandles.length>0;){this.optionsTimeoutHandles.pop()()}Pn.forEach(function(t){var n=e[t];n.removeAll(!0),n.y=n.x=0})}}]),e}(),Sn=function(e){function t(e,n,r,a){var o;Object(i.a)(this,t),(o=ue(this,se(t).call(this,a))).game=a;var u=n.args,s=n.uuid,c=l.a.vertical,d=u[0],h=d.index,f=d.rect,p=void 0===f?{x:0,y:0,width:c?540:960,height:c?960:540}:f,v=d.remove,m=void 0===v?0:v,g=d.scale,y=void 0===g?1:g,_=d.show,w=void 0===_||_,b=p.x,k=p.y,x=p.width,P=p.height;return o.x=b,o.y=k,o.width=x,o.height=P,e&&e.addChild(oe(o)),o.uuid=s,o.remove=m,o.index=parseInt(h),o.rect=p,o.bubbleHeight=0,o.saveVector=[],o.count=0,o.runNextCommand=r,o.scalenum=y,o.container=o.addContainer(p),o.scale.set(y,y),o.display(w),o}return de(t,Phaser.Group),Object(o.a)(t,[{key:"updateState",value:function(e,t){var n=e.args,r=e.uuid,a=n[0],i=a.rect,o=a.remove,u=a.scale,s=void 0===u?1:u;this.uuid=r,this.clear(),this.remove=o,this.count=0,this.resetSize(i,s,t)}},{key:"display",value:function(e){this.show=this.visible=e}},{key:"addContainer",value:function(e){var t=this,n=l.a.vertical,r=mt.sprite({x:0,y:0});r.name="scrollPane",this.add(r),r.inputEnabled=!0,r.input.enableDrag(),r.input.allowHorizontalDrag=!1;var a=mt.rectMask({alpha:0,rect:O({},e,{x:0,y:0})});r.addChildAt(a,0);var i=!1,o=0,u=0,s=0,c=0,d=!1,h=r.events;r.onUpdate=function(e,t){a.clear(),a.beginFill(0,0),a.drawRect(0,0,e,t),a.endFill()},this.onScorll=r.onScroll=function(n,a){a=a+.5|0,t.bubbleHeight<e.height?r.input.disableDrag():a>0?r.y=0:a<=-(t.bubbleHeight-e.height)?r.y=-(t.bubbleHeight-e.height):r.y=a};var f=function(r){var a,i,o=r.worldX,u=r.worldY,s=game.world.angle;if(n&&90===s||!n&&0===s){var c=n?[u,-o]:[o,u],l=Object(x.a)(c,2);a=l[0],i=l[1]}else{var d=n?[o,u]:[u,-o],h=Object(x.a)(d,2);a=h[0],i=h[1]}return i<e.y||i>e.y+t.bubbleHeight||a<e.x||a>e.x+e.width?null:{x:a,y:i}};h.onDragUpdate.add(function(e,t,n,a,i,o){return r.onScroll(n,a)},this),h.onInputUp.add(function(){!0===d&&(s=t.game.input.x,c=t.game.input.y,Math.abs(o-s)<=2&&Math.abs(u-c)<=2&&t.runNextCommand&&t.runNextCommand(),d=!1,o=u=s=c=0)}),h.onInputDown.add(function(e,n){d=!0,o=t.game.input.x,u=t.game.input.y,f(n)?e.input.enableDrag():e.input.disableDrag()},this);var p=function(e){var t=e.wheelDelta?e.wheelDelta/120:-e.detail/3;r.onScroll(0,r.y+100*t)},v=function(e,t,n){var r=f(e),a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";!r&&i?(document.removeEventListener(a,p),i=!1):r&&!i&&(document.addEventListener(a,p),i=!0)};this.clearMoveCallback=function(){var e=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.removeEventListener(e,p),t.game.input.deleteMoveCallback(v,t)},this.game.input.addMoveCallback(v,this);var m=mt.rectMask({alpha:0,rect:O({},e,{x:0,y:0})});return this.addChild(m),this.mask=m,r}},{key:"save",value:function(e){this.saveVector.push(e),this.count++}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(this.visible=!1;this.container.children.length>1;)this.container.removeChildAt(this.container.children.length-1).destroy();if(this.bubbleHeight=0,this.container.y=this.container.x=0,2==this.remove||1==e){for(;this.saveVector.length>0;)this.saveVector.pop();if(this.count=0,e&&this.parent){for(;this.container.children.length>0;)this.container.removeChildAt(0).destroy();this.runNextCommand=null,this.parent.remove(this),this.clearMoveCallback(),this.destroy()}}else if(1==this.remove){for(var t=0;t<this.count&&this.count>0;)this.saveVector.pop(),t++;this.count=0}}},{key:"resetSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,width:l.a.vertical?540:960,height:l.a.vertical?960:540},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=e.x,a=void 0===r?0:r,i=e.y,o=void 0===i?0:i,u=e.width,s=e.height;this.x=a,this.y=o,this.rect=e,this.scalenum=t,this.scale.set(t,t),this.container.onUpdate(u,s),this.runNextCommand=n,this.parent&&this.parent.bringToTop(this);var c=this.mask;c.clear(),c.beginFill(0,0),c.drawRect(0,0,u,s),c.endFill()}}]),t}(),On=["background","bottomDialog","images","weather","click2continue","bubbles","topDialog","options","animations"],En=function(){function e(t){var n=this,r=t.game,a=t.json,o=t.getPlayContext,u=t.setBackground,s=t.getInheritBackground,c=t.noShowingViews,l=t.addViews,d=t.pushPlayback,h=t.existPlotViews,f=t.resetPlayCount;Object(i.a)(this,e),this.game=r,this.json=a,this.props={getPlayContext:o,setBackground:u,getInheritBackground:s,noShowingViews:c,addViews:l,pushPlayback:d,existPlotViews:h,resetPlayCount:f};var p=mt.group("scene");this.container=p,On.forEach(function(e){return n[e]=p.add(mt.group(e))}),this.tweens=[],this.optionsTimeoutHandles=[],this.bubbleBorderVector=[],this.state={playStack:[],images:[],dialog:{},weather:null,autotext:null,disableSaveOrLoad:null,animateScene:null,views:[],hideGlobalViews:[],bubbleMode:[],bubbleCount:[]}}return Object(o.a)(e,[{key:"getContext",value:function(){return this.context}},{key:"getState",value:function(){return this.state}},{key:"recoverBubbleContent",value:function(e,t){var n=this;if(0===e.length)return Promise.resolve();return function r(a){var i,o=e[a],u=o.index,s=o.rect,c=o.remove,l=o.scale,d=o.show,h=o.uuid,f=o.bubble,p=void 0===f?[]:f,v={uuid:h,args:[{index:u,rect:s,remove:c,scale:l,show:d}]},m=n.bubbleBorderVector.findIndex(function(e){return e.index===parseInt(u)});return n.bubbleBorder=-1!==m?n.bubbleBorderVector[m]:n.renderBubbleBorder(v),-1!==m?(n.bubbleBorder.updateState(v),n.bubbleBorder.display(d)):n.bubbleBorderVector.push(n.bubbleBorder),p.length>0&&t&&(i=n.bubbleBorder.saveVector).push.apply(i,Object(k.a)(p)),function e(t){if(0==n.bubbleBorder.saveVector.length)return Promise.resolve(!0);var r=n.bubbleBorder.saveVector[t];return n.renderBubble(r,n.bubbleBorder,!0).then(function(r){return t++,n.bubbleBorder.count++,t>=n.bubbleBorder.saveVector.length||e(t)})}(0).then(function(){return++a>=e.length||r(a)})}(0)}},{key:"getBubbleState",value:function(){var e=this.state,t=e.bubbleMode,n=void 0===t?[]:t,r=e.bubbleCount;return{bubbleMode:n,bubbleCount:void 0===r?[]:r}}},{key:"setBubbleState",value:function(e,t){return this.state=S()(this.state,{bubbleMode:{$set:e},bubbleCount:{$set:t}}),this.recoverBubbleContent(e,!0)}},{key:"setState",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.playStack,a=void 0===r?[]:r,i=e.images,o=void 0===i?[]:i,u=e.dialog,s=void 0===u?{}:u,c=e.weather,l=void 0===c?null:c,d=e.autotext,h=void 0===d?null:d,f=e.disableSaveOrLoad,p=void 0===f?null:f,v=e.animateScene,m=void 0===v?null:v,g=e.views,y=void 0===g?[]:g,_=e.hideGlobalViews,w=void 0===_?[]:_,b=e.bubbleMode,k=void 0===b?[]:b,x=e.bubbleCount,P=void 0===x?[]:x,C=Promise.resolve();if(o.forEach(function(e){if(e){var n=e.command,r=e.animate;t.renderImage(r?O({},n.args[0],r.args[0]):n.args[0])}}),l&&this.renderWeather(l.args[0]),m&&this.animateScene(m.args[0]),s.command){var E=O({},s.command.args[0]);s.animate&&(E=S()(E,{speaking:{$apply:function(e){return O({},e,s.animate.args[0])}}})),this.renderDialog(E),this.dialogView.animate(!0)}return C=this.recoverBubbleContent(k,n),this.state={playStack:a,images:o,dialog:s,weather:l,autotext:h,disableSaveOrLoad:p,animateScene:m,views:y,hideGlobalViews:w,bubbleMode:k,bubbleCount:P},this.autoPlay=h&&h.args&&h.args[0],C}},{key:"renderBackground",value:function(e){var t=this.props,n=t.getInheritBackground,r=t.setBackground;this.background.removeAll(!0);var a=e.flex,i=e.url,o=e.opacity,u=void 0===o?1:o;if("inherit"===i){var s=n();a=s.flex,i=s.url;var c=s.opacity;u=void 0===c?1:c}else r(e);var l=this.game.world,d=l.width,h=l.height,f=mt.image(i);xt.flex(a,f,{width:d,height:h}),f.alpha=u,this.background.add(f)}},{key:"renderWeather",value:function(e){var t=this;this.weather.removeAll(!0);var n=l.a.vertical,r=this.game,a=r.cache,i=r.time.events,o=r.world,s=o.width,c=o.height;if(!n&&"windy"===e){var d=mt.tileSprite({x:0,y:0,width:s,height:c,url:"wind"});return d.autoScroll(-360,0),void this.weather.add(d)}var h=u.c.getWeatherUrls(e),f=h.length;if(f&&a.checkImageKey(h[0])){var p=mt.image();this.weather.add(p);var v=0;!function e(){return i.add(40,function(){var t=h[v];p.parent&&a.checkImageKey(t)&&(p.loadTexture(t),v=++v%f,e())},t)}()}else this.weather.removeAll(!0)}},{key:"renderDialog",value:function(e){var t=this.tweens,n=this.props,r=t.findIndex(function(e){return"animateDialog"===e.name});if(~r){var a=t[r];a.cancel&&a.cancel(),t.splice(r,1)}var i=e.speaking,o=e.dialogtitle,s=e.avatar,c=e.dialogid,l=void 0===c?0:c,d=n.getPlayContext,h=i.coverage,f=i.x,p=i.y,v=i.opacity,m=void 0===v?1:v,g=i.data;g=ke.parseValue(g,d());var y=ke.parseValue(o.data,d());this.dialogView=bn({gameJson:this.json,settings:{speaking:O({},i,{data:g}),dialogtitle:O({},o,{data:y}),avatar:s,dialogid:l}});var _=this.dialogView.container;_.x=u.b.roundToInt(f),_.y=u.b.roundToInt(p),_.alpha=m,("bottom"===h?this.bottomDialog:this.topDialog).add(_)}},{key:"renderImage",value:function(e){var t=e.url,n=e.width,r=e.height,a=e.rotate,i=void 0===a?0:a,o=e.mirrorH,s=e.mirrorV,c=e.x,l=e.y,d=e.opacity,h=void 0===d?1:d,f=e.index,p=e.scaleX,v=void 0===p?1:p,m=e.scaleY,g=void 0===m?1:m;if(1!==f){var y=u.c.isObject(t)&&t.type,_=this.props.getPlayContext;y&&(ut.playContext=_());var w=mt.image(t,{x:c,y:l}),b=w.texture.frame,k=y?Math.min(n/100,r/100):Math.min(n/w.width,r/w.height);w.pivot.x=w.width/2,w.pivot.y=w.height/2,w.sourceScale=k,w.width=Math.abs(v*k*b.width),w.height=Math.abs(g*k*b.height),w.x+=w.width/2,w.y+=w.height/2,w.alpha=h,w.angle=180===parseInt(i)?179.9:i,w.zIndex=f,w.tweenPromises=[];var x=w.destroy;w.destroy=function(){w.tweenPromises.forEach(function(e){return e.cancel&&e.cancel()}),w.tweenPromises=null;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];x.apply(w,t)},o&&(w.angle=-w.angle,w.scale.x=-w.scale.x,w.mirrorH=!0),s&&(w.angle=-w.angle,w.scale.y=-w.scale.y,w.mirrorV=!0);for(var P=this.images.children,C=0;C<P.length;C++){var S=P[C];if(S.zIndex===f){this.images.removeChildAt(C),S.destroy();break}if(S.zIndex>f)break}this.images.add(w,!1,C)}else this.renderBackground(e)}},{key:"removeImage",value:function(e){if(1===e)(0,this.props.setBackground)({}),this.background.removeAll(!0);else for(var t=this.images.children,n=0;n<t.length;n++){var r=t[n];if(r.zIndex===e){this.images.removeChildAt(n),r.destroy();break}}}},{key:"renderOptions",value:function(e,t){var n=this;this.options.removeAll(!0);for(var r=(0,this.props.getPlayContext)(),a=this.game.time.events,i=this.json.template.json.option,o=i.rect,s=i.normal,c=i.active,l=[],d=[],h=function(i,h){var f=e[i],p=f.font,v=f.timer,m=f.background,g=f.hideTimer,y=f.disable,_=void 0!==y&&y,w=f.name,b=f.condition,k=f.sound,x=f.uuid;if(w=ke.parseValue(w,r),b){var P=b.disable,C=b.enable,S=b.expression,O=ke.safeEval(S,r);if(_=O?"disable"===C.type:"disable"===P.type,O?"hidden"===C.type:"hidden"===P.type)return d.push(Promise.resolve(!1)),"continue"}var E=o.x,I=o.y,A=o.width,M=o.height,T=s.background.url,V=s.background.url,j=c.background.url;E=null!=f.x?f.x:E,I=null!=f.y?f.y:I,E=u.b.roundToInt(E),I=u.b.roundToInt(I),m&&(A=null!=f.width?f.width:A,M=null!=f.height?f.height:M,j=m.active.url,T=m.normal.url,V=m.disable?m.disable.url:T);var U={fontSize:p.normal.font_size,fontWeight:p.normal.bold,color:p.normal.color},D={fontSize:p.disable.font_size,fontWeight:p.disable.bold,color:p.disable.color},R=mt.button({x:E,y:I,width:A,height:M},{normalUrl:T,activeUrl:j,disableUrl:V,audio:k,onClick:function(e,n){n.pointerMode===Phaser.PointerMode.CURSOR&&0!==n.button||(l.forEach(function(e){return e()}),t({type:"options",index:i}),$e([x]))},textOptions:{disable:D,normal:U,active:U}});if(n.options.add(R),R.showText(!p.normal.hidden),_&&(R.disable(),R.showText(!p.disable.hidden)),R.setText(w),v){var B=ke.safeEval(v.time,r);!g&&R.setText("".concat(w,"(").concat(B,")")),d.push(new Promise(function(e,t){var r=a.loop(Phaser.Timer.SECOND,function(){n.paused||(B--,g||R.setText("".concat(w,"(").concat(B,")")),B<=0&&(a.remove(r),"disable"===v.type?(R.showText(!p.disable.hidden),R.disable(),e(!1)):(R.showText(!p.normal.hidden),R.enable(),e(!0)),R.setText(w)))});n.optionsTimeoutHandles.push(function(){a.remove(r)}),l.push(function(){a.remove(r),e(!0)})}))}else _&&d.push(Promise.resolve(!1))},f=0,p=e.length;f<p;f++)h(f);Promise.all(d).then(function(n){return n.length!==e.length||n.some(function(e){return e})?void 0:t()})}},{key:"renderBubbleBorder",value:function(e,t){return this.handleClearContinue(),new Sn(this.bubbles,e,t,this.game)}},{key:"renderBubble",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.game,i=a.cache,o=a.world,s=o.width,c=o.height,l=this.props,d=l.getPlayContext,h=l.addViews,f=l.existPlotViews,p=e.type,v=e.content,m=e.avatar,g=e.role,y=e.position,_=e.animation,w=t.container,b=t.bubbleHeight,k=t.rect,x=0,P=0,C=0,S=[],E=!1,I=function(){var e=0,t=0;switch(y){case"left":e=0,t=b;break;case"center":e=k.width/2,t=b;break;case"right":var n=[k.width,b];e=n[0],t=n[1]}return{x:e,y:t,width:0,height:0}}(),A=mt.group("bubblegroup",I);w.addChild(A);var M=function(e,t){if(r)return Promise.resolve();var n=[],a=[];u.c.isObject(t)?"fadein"==t.type&&n.push(t):(n=t.filter(function(e){return"fadein"===e.type}),a=t.filter(function(e){return"moveFrom"===e.type}));var i=0,o=0,s=$.fastPlay;if(s){var c=$.getFastPlayAnimationInfo(o);i=c.delay,o=c.duration}return Promise.all([n.length>0&&q.from({target:e,properties:{alpha:0},duration:s?o:n[0].duration,ease:null,autoStart:!0,delay:s?i:n[0].delay}),a.length>0&&q.from({target:e,properties:{x:a[0].x,y:a[0].y},duration:s?o:a[0].duration,ease:null,autoStart:!0,delay:s?i:a[0].delay})])};!function(){var e=m.url,n=m.rect,r=m.hidden,a=m.animations,o=m.view,u=n.x,s=n.y,c=n.width,l=n.height;if(i.checkImageKey(e)&&("center"!==y&&null==r||0==r)){var d=mt.image(e),p=Math.min(c/d.width,l/d.height);d.width*=p,d.height*=p,d.x=u+(c-d.width)/2,d.y=s+(l-d.height)/2,o&&(d.inputEnabled=!0,d.events.onInputDown.add(function(e,n){n&&n.pointerMode===Phaser.PointerMode.CURSOR&&0!==n.button||!0===t.show&&(f(o)||h&&h([o]))})),a&&S.push(M(d,a)),A.add(d),E=!1}else m.hidden=!0;P=s+l}(),function(){var e=g.rect,t=g.data,n=g.fontFamily,r=void 0===n?"黑体":n,a=g.font_size,i=g.color,o=g.hidden,u=g.animations,s=mt.group("rolegroup",e);if(A.add(s),void 0!==u&&0==o||"center"!==y&&!u&&0==o||"center"==y&&null==u&&void 0!==o&&0==o){var c=ke.parseValue(t,d()),l=mt.text({x:0,y:0,width:e.width,height:e.height},{fontSize:a,forceFontFamily:r,color:i||"#000000",text:c});u&&S.push(M(s,u)),s.add(l),E=!1}else g.hidden=!0;x=e.y+e.height}(),E=m.hidden&&g.hidden,function(){var e=v.url,r=v.rect,a=v.animations,o=v.viewMode,l=v.view,m=v.opacity,g=void 0===m?1:m,_=v.font_size,w=(v.fontFamily,v.background),b=v.data,k=r.x,x=r.y,P=r.width,I=r.height,T=mt.group("contentgroup",{x:k,y:E?0:x,width:P,height:I});if(A.addChild(T),"image"==p){var V=!1,j=n.json.motionImgMap,U=void 0===j?{}:j;if(u.c.isString(e)&&i.checkImageKey(e)?V=!0:u.c.isObject(e)&&e.uuid&&U[e.uuid]&&(V=U[e.uuid].images.map(function(e){return e.url}).every(function(e){return i.checkImageKey(e)})),V){var D=mt.image(e),R=Math.min(P/D.width,I/D.height);D.width*=R,D.height*=R,D.x+=(P-D.width)/2,D.y+=(I-D.height)/2,D.alpha=g,o&&0!==o&&(D.inputEnabled=!0,D.events.onInputDown.add(function(n,r){if((!r||r.pointerMode!==Phaser.PointerMode.CURSOR||0===r.button)&&!0===t.show)if(1==o){var a=mt.sprite({x:0,y:0,width:s,height:c});game.world.addChild(a),a.addChild(mt.rectMask({color:0,alpha:.5,x:0,y:0,rect:{x:0,y:0,width:s,height:c}}));var i=mt.image(e,{x:0,y:0});if(i.width>s||i.height>c){var u=Math.min(i.width/s,i.height/c);i.width*=u,i.height*=u}i.x=(s-i.width)/2,i.y=(c-i.height)/2,i.alpha=g,a.addChild(i),a.inputEnabled=!0,a.events.onInputDown.addOnce(function(){for(;a.children.length>0;)a.removeChildAt(0);game.world.remove(a),a=null})}else if(2==o){if(f(l))return;h&&h([l])}else console.warn("图片气泡未知点击类型模式！")},n)),T.add(D)}}else if("text"==p){var B="",L=1,F="center"==y?"#dadada":"right"==y?"#98e165":"#ffffff",z=!1;w&&(void 0!==w.url?(z=!0,B=w.url||"",L=w.flex||1):w.color&&(F=w.color));var W=mt.textarea({x:6,y:1,width:P+_/6-2,height:I},{color:"#000000",fontSize:_,name:"bubbledialog",forceFontFamily:"黑体"});b=ke.parseValue(b,d()),Array.isArray(b)||(b=u.c.toArrayForData(b).map(function(e){return O({},e,{color:F})}));var N=/([\s\S]*)\\(\d+)\s([\s\S]*)/;W.setTexts(b.map(function(e){for(var t=e.data,n=void 0===t?"":t,r=N.exec(n);r;)n=r[1]+r[3],r=N.exec(n);return O({},e,{data:n})}));var $=W.height>I?W.height:I;b&&b.length>0&&function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ffffff",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(""!==t){e=mt.image(t,{opacity:i});var o=a>I?a:I;o=o<35?35:o,xt.flex(r,e,{width:P,height:I});var s=mt.rectMask({rect:{width:P,height:I},alpha:0});T.addChild(s),T.mask=s}else if(!z&&((e=game.add.graphics()).beginFill(u.c.toColorValue(n),i),e.drawRoundedRect(0,0,P,a,6,6),e.endFill(),"center"!==y)){var c="left"===y?-8:8,l="left"===y?0:P,d=game.add.graphics();d.beginFill(u.c.toColorValue(n),i),d.moveTo(l,4.5),d.lineTo(l+c,12.5),d.lineTo(l,24.5),d.endFill(),T.addChildAt(d,0)}e&&T.addChildAt(e,0)}(B,F,L,$,g),W.alpha=g,I=$,T.addChild(W)}else console.warn("未知气泡内容类型！");a&&S.push(M(T,a)),C=(E?2:x)+I}();var T=E?C:Math.max(Math.max(P,x),C);return t.bubbleHeight+=T+20,t.bubbleHeight>t.rect.height&&t.onScorll(0,-(t.bubbleHeight-t.rect.height)),t.container.onUpdate(t.rect.width,t.bubbleHeight),!r&&t.save(e),Promise.all(S).then(function(){return Promise.all(void 0===_||r?[]:[M(A,_)])}).then(function(){return A})}},{key:"updateBubbleState",value:function(e){this.updateBubbleCount();var t=e.index,n=e.uuid,r=e.saveVector,a=e.show,i=e.remove,o=e.rect,u=e.scalenum,s=e.count,c=this.state.bubbleMode.findIndex(function(e){return e.index===parseInt(t)});this.state=~c?S()(this.state,{bubbleMode:P({},c,{uuid:{$set:n},index:{$set:t},show:{$set:a},currentCount:{$set:s},remove:{$set:i},rect:{$set:o},scale:{$set:u},bubble:{$set:r}})}):S()(this.state,{bubbleMode:{$push:[{bubble:r||[],uuid:n,index:t,show:a,currentCount:s,remove:i,rect:o,scale:u}]}})}},{key:"updateBubbleCount",value:function(){var e=this;this.state.bubbleCount=[];var t=0,n=0;for(this.bubbleBorderVector.forEach(function(t){var n=t.saveVector,r=t.index;n.forEach(function(t){return e.state=S()(e.state,{bubbleCount:{$push:[r]}})})});this.state.bubbleCount.length>1e3;)this.state.bubbleCount.shift(),t++;this.bubbleBorderVector.forEach(function(e){++n>=t||e.saveVector.shift()})}},{key:"doInTL",value:function(e){var t=this;return e!==this.timeline?Promise.reject("timeline changed"):this.paused?new Promise(function(n,r){!function a(){t.paused?t.setTimeoutId=setTimeout(a,50):e!==t.timeline?r("timeline changed"):n()}()}):Promise.resolve()}},{key:"pause",value:function(){this.paused=!0,this.dialogView&&this.dialogView.pause()}},{key:"proceed",value:function(){this.paused=!1,this.dialogView&&!this.dialogView.changeline&&this.dialogView.proceed()}},{key:"playMusic",value:function(e){var t=e.url,n=e.volume;t?"inherit"===t?ae.setMusicVolume(n):ae.playMusic({url:t,volume:n}):ae.stopMusic()}},{key:"playSound",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})||{},t=e.index,n=e.url,r=e.volume,a=e.time,i=void 0===a?1:a;n?ae.playSound({channel:t,url:n,volume:r,loop:1!==i}):ae.stopSound(t)}},{key:"animateScene",value:function(e){var t=this,n=this.tweens,r=e.type,a=e.duration,i=e.delay,o=e.color,u=e.level,s=e.loop,c=void 0!==s&&s;if($.fastPlay){var l=$.getFastPlayAnimationInfo(a);i=l.delay,a=l.duration}switch(this.tweens=n.filter(function(e){return e.type!==r||(e.cancel&&e.cancel(),!1)}),r){case"twinkle":var d=q.twinkle({target:this.animations,duration:a,delay:i,color:o});return d.type=r,this.tweens.push(d),d;case"shake":if(!a)return Promise.resolve();var h=u?5*u:0;return Promise.all(On.slice(0,3).map(function(e){var n=q.shake({target:t[e],duration:a,delay:i,offSet:h,repeat:c?1/0:0});n.type=r,t.tweens.push(n)}));case"spread":var f=this.game.world,p=f.width,v=f.height,m=mt.rectMask({rect:{width:p,height:v}});return this.container.add(m,!0,0),Promise.all(On.slice(0,7).map(function(e){var n=q.spread({target:t[e],duration:a,delay:i});n.type=r,t.tweens.push(n)})).then(function(){return m.destroy()})}}},{key:"animateImage",value:function(e){var t=this.props.getInheritBackground,n=e.index,r=e.duration,a=e.delay,i=e.x,o=e.y,u=e.opacity,s=void 0===u?1:u,c=e.scaleX,l=void 0===c?1:c,d=e.scaleY,h=void 0===d?1:d,f=e.rotate;if(1===n)return t().opacity=s,q.to({target:this.background.children[0],properties:{alpha:s},duration:r,delay:a});f=180===f?179.9:-180===f?-179.9:f;for(var p=this.images.children,v=null,m=0;m<p.length;m++){var g=p[m];if(g.zIndex===n){v=g;break}}if(v){v.tweenPromises.forEach(function(e){return e.cancel&&e.cancel()}),v.tweenPromises=[];var y=v,_=y.sourceScale,w=y.texture.frame;i+=l*_*w.width/2,o+=h*_*w.height/2,l*=_,h*=_,v.mirrorH&&(f=-f,l=-l),v.mirrorV&&(f=-f,h=-h);var b={alpha:s,angle:f,x:i,y:o,width:l*w.width,height:h*w.height},k=Object.keys(b);if($.fastPlay){var x=$.getFastPlayAnimationInfo(r);a=x.delay,r=x.duration}k.some(function(e){return v[e]!==b[e]})&&v.tweenPromises.push(q.to({target:v,properties:b,duration:r,delay:a}))}}},{key:"animateDialog",value:function(e){var t=this,n=e.duration,r=e.delay,a=e.opacity,i=void 0===a?1:a,o=e.rotate,u=e.x,s=e.y;if(this.dialogView){if($.fastPlay){var c=$.getFastPlayAnimationInfo(n);r=c.delay,n=c.duration}var l=this.dialogView.container,d=q.to({target:l,properties:{x:u,y:s,alpha:i,rotate:o},duration:n,delay:r});d.name="animateDialog",this.tweens.push(d),d.then(function(){var e=t.tweens.findIndex(function(e){return e===d});~e&&t.tweens.splice(e,1)})}}},{key:"animateSpeak",value:function(e){var t=this,n=this.dialogView.animate(void 0,this.autoPlay),r=this.handleContinue(e);return function a(){return Promise.race([n,r]).then(function(i){return null==i&&t.dialogView.isClickChange&&!$.autoPlay?(t.handleClearContinue(),r=t.handleContinue(e),t.dialogView.showpageing?a():(t.dialogView.changeline?t.dialogView.proceed():n.showpage&&n.showpage(),a())):Promise.resolve()}).then(function(){return n.cancel&&n.cancel()}).then(function(){return t.doInTL(e)}).then(function(){return t.handleClearContinue()})}()}},{key:"dispatchContinueClick",value:function(){var e=this.click2continue.children;e[0]&&($.fastPlay||$.autoPlay)&&e[0].events.onInputUp.dispatch()}},{key:"handleContinue",value:function(e){var t=this,n=this.props,r=n.noShowingViews,a=n.resetPlayCount,i=this.game,o=i.input,u=o.keyboard,s=o.onHold,c=i.device.desktop,l=new Promise(function(e,n){return!c&&r()&&s.addOnce(function(){return e()},t)}),d=new Promise(function(e,n){return r()&&u.addKey(Phaser.Keyboard.Z).onDown.add(function(){return e()},t)}),h=new Promise(function(e,n){return r()&&u.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(function(){return e()},t)}),f=new Promise(function(e,n){t.click2continue.removeAll(!0);var r=t.game.world,i=r.width,o=r.height,u=mt.rectMask({rect:{width:i,height:o},alpha:0});u.inputEnabled=!0;var s={};u.events.onInputDown.add(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s={x:t.x,y:t.y}}),u.events.onInputUp.add(function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r||r.pointerMode!==Phaser.PointerMode.CURSOR||0===r.button){var i=Math.abs(s.x-r.x),o=Math.abs(s.y-r.y);Math.max(i,o)>60&&D.isAppClient()||(a(),t.click2continue.removeAll(!0),e())}}),t.click2continue.add(u)});return Promise.race([f,d,h,l]).then(function(){return t.doInTL(e)}).then(function(){return t.handleClearContinue()})}},{key:"handleClearContinue",value:function(){var e=this.game.input,t=e.keyboard,n=e.onHold;this.click2continue.removeAll(!0),n.removeAll(this),t.addKey(Phaser.Keyboard.Z).onDown.removeAll(this),t.addKey(Phaser.Keyboard.SPACEBAR).onDown.removeAll(this)}},{key:"getNextContextInStack",value:function(){for(var e=(0,this.props.getPlayContext)(),t=this.state.playStack;t&&t.length;){var n=t[0],r=n.loop,a=n.chapter,i=n.plotIndex,o=n.plots,u=n.commands,s=n.cmdIndex;if(r){var c=r.countExpr,l=r.count,d=r.condition,h=r.breakNext;if(ke.safeEval(d,e)){if(!c)return{chapter:a,plotIndex:i,plots:o,commands:u,cmdIndex:s};this.state=S()(this.state,{playStack:{0:{loop:{count:{$set:l+1}}}}});var f=parseInt(ke.safeEval(c,e),10);if(l<(f=f>=1?f:1))return{chapter:a,plotIndex:i,plots:o,commands:u,cmdIndex:s}}a=h.chapter,i=h.plotIndex,o=h.plots,u=h.commands,s=h.cmdIndex}if(t=t.slice(1),this.state=S()(this.state,{playStack:{$set:t}}),u[s])return{chapter:a,plotIndex:i,plots:o,commands:u,cmdIndex:s}}return null}},{key:"setControlPlay",value:function(e,t){var n=this;this.controlPlay=function(r){var a=r.type,i=r.control;switch(a){case"nextPlot":n.timeline={},t(S()(n.context,{cmdIndex:{$apply:function(e){return e+1}}}));break;case"back":return n.timeline={},e({type:a});case"jump":case"insertPlot":return n.timeline={},e(r);case"jumpOption":case"backOption":var o=n.state.playStack,u=parseInt(i.value)>0?i.value:0,s=o.takeWhile(function(e){return"condition_option"===e.type||"option"===e.type}).length,c=null;u>0&&s&&(s>u?(c=o[u-1],n.state=S()(n.state,{playStack:{$splice:[[0,u]]}})):(c=o[s-1],n.state=S()(n.state,{playStack:{$splice:[[0,s]]}})),c.loop&&(c=c.loop.breakNext),"backOption"===a&&(c=S()(c,{cmdIndex:{$apply:function(e){return e-1}}}))),c&&(n.timeline={},t(c));break;default:console.warn("".concat(a," is error"))}}}},{key:"play",value:function(e,t){var n=this,r=this.props,a=r.getPlayContext,i=r.noShowingViews,o=r.pushPlayback;this.context=e;var s={},c=e.load;this.timeline=s,this.controlPlay=null,c||(this.autoPlay=!1);var l=null,d=!1;this.bubbleBorderVector.forEach(function(e){return n.updateBubbleState(e)});var h=function(e,t,r){if("loop"===t.type||"countLoop"===t.type){var a={count:1,countExpr:t.count,condition:t.expression,breakNext:r},i=O({},r,{commands:t.commands,cmdIndex:0,loop:a,type:e});n.state=S()(n.state,{playStack:{$set:[i].concat(Object(k.a)(n.state.playStack))}})}else n.state=S()(n.state,{playStack:{$set:[O({},r,{type:e})].concat(Object(k.a)(n.state.playStack))}})},f=function(e,r){var a=n.context,i=a.commands,o=a.cmdIndex,u=i[o]||{},d=u,h=d.type,f=d.args,v="autoSaveOrLoad"===h&&1===f[0].type,m=l;i=m.commands,o=m.cmdIndex;var g="setValues"==h;(g?t(u):Promise.resolve()).then(function(){u=g?null:u,i&&i[o]||(l=n.getNextContextInStack()||{});var a=l;if(i=a.commands,o=a.cmdIndex,n.timeline=s={},!i||!i[o])return t(u).then(function(){return v?null:e({})});t(u,O({},l,{load:c})).then(function(){c=!1,v||(n.context=l,p(e,r))})})},p=function e(t,r){if(s===n.timeline){if(n.paused)return n.setTimeoutId=setTimeout(function(){return e(t,r)},50);var p=n.context,v=p.commands,m=p.cmdIndex,g=v[m];if(l=O({},n.context,{cmdIndex:m+1}),!g)return f(t,r);d=!1;var y=g.type,_=g.args,w=s,b=function(){if(w===s){if(!d)return f(t,r);var e=n.click2continue.children[0];e&&e.events.onInputUp.dispatch()}};switch(n.bubbleBorderVector.forEach(function(e){return e.runNextCommand=b}),n.handleClearContinue(),y){case"animateScene":n.state=S()(n.state,{animateScene:{$set:"shake"===_[0].type&&_[0].loop?g:void 0}}),n.animateScene(_[0]);break;case"animateDialog":n.state=S()(n.state,{dialog:{animate:{$set:g}}}),n.animateDialog(_[0]);break;case"showDialog":return!c&&o(_[0]),n.renderDialog(_[0]),d=!0,n.animateSpeak(w).then(function(){var e=function(){return e=null,n.state=S()(n.state,{dialog:{$set:{command:g}}}),f(t,r)},a=function(){return e&&e()};return $.fastPlay&&i()?a():n.autoPlay||$.autoPlay&&i()?u.c.timeout(_[0].speaking.immediate?400:0).then(function(){return n.doInTL(w)}).then(function(){return a()}):n.handleContinue(w).then(a)});case"hideDialog":n.dialogView&&n.dialogView.clear(),n.dialogView=null,n.state=S()(n.state,{dialog:{$set:{}}});break;case"options":if(!_.length)break;if(!_.some(function(e){var t=e.condition;if(!t)return!0;var n=t.disable,r=t.enable,i=t.expression;return!(ke.safeEval(i,a())?"hidden"===r.type:"hidden"===n.type)}))break;return d=!0,n.game.input.onUp.dispatch(),new Promise(function(e,t){return n.renderOptions(_,e)}).then(function(e){if(n.options.removeAll(!0),e&&_[e.index].commands){var t=e.index;h("option",_[t],l),l=O({},l,{commands:_[t].commands,cmdIndex:0}),tt.resetCommandOption(g,t)}}).then(function(){return n.doInTL(w)}).then(function(){return f(t,r)});case"conditionOptions":if(_.length){var x=a(),C=_.findIndex(function(e){return ke.safeEval(e.expression,x)});C>-1&&_[C].commands.length&&(h("condition_option",_[C],l),l=O({},l,{commands:_[C].commands,cmdIndex:0}),tt.resetCommandOption(g,C))}break;case"autotext":n.autoPlay=_[0],n.state=S()(n.state,{autotext:{$set:g}});break;case"disableSaveOrLoad":n.state=S()(n.state,{disableSaveOrLoad:{$set:g}});break;case"wait":return d=!0,u.c.timeout(_[0].value&&$.fastPlay?10:_[0].value).then(function(){return n.doInTL(w)}).then(function(){return f(t,r)});case"hideMenu":case"showMenu":break;case"weather":n.state=S()(n.state,{weather:{$set:g}}),n.renderWeather(_[0]);break;case"back":return t({type:y});case"jump":case"insert":var E=function(){return t({type:y,control:{uuid:_[0]}})};return c?n.handleContinue(w).then(E):E();case"jumpOption":case"backOption":var I=n.state.playStack,A=parseInt(_[0].value)>0?_[0].value:0,M=I.takeWhile(function(e){return"condition_option"===e.type||"option"===e.type}).length;A>0&&M&&(M>A?(l=I[A-1],n.state=S()(n.state,{playStack:{$splice:[[0,A]]}})):(l=I[M-1],n.state=S()(n.state,{playStack:{$splice:[[0,M]]}})),l.loop&&(l=l.loop.breakNext),"backOption"===y&&(l=S()(l,{cmdIndex:{$apply:function(e){return e-1}}})));break;case"showBubble":var T=n.bubbleBorderVector.findIndex(function(e){return e.index===parseInt(_[0].index)});n.bubbleBorder=-1!==T?n.bubbleBorderVector[T]:n.renderBubbleBorder(g,b),-1==T&&n.bubbleBorderVector.push(n.bubbleBorder),-1!==T&&n.bubbleBorder.updateState(g,b),n.bubbleBorder.display(!0);return n.updateBubbleState(n.bubbleBorder),function e(t){if(0==n.bubbleBorder.saveVector.length)return Promise.resolve(!0);var r=n.bubbleBorder.saveVector[t];return n.renderBubble(r,n.bubbleBorder,!0).then(function(r){return++t>=n.bubbleBorder.saveVector.length||e(t)})}(0).then(function(){return f(t,r)});case"emitBubble":if(c)return n.handleContinue(w).then(function(){return f(t,r)});if(n.bubbleBorder){if(1!=n.bubbleBorder.show){if(n.bubbleBorder=function(){for(var e=n.bubbleBorderVector.length-1;e>=0;e--)if(1==n.bubbleBorderVector[e].show)return n.bubbleBorderVector[e];return null}(),null==n.bubbleBorder)return f(t,r)}return n.bubbleBorder.display(!0),n.renderBubble(_[0],n.bubbleBorder,!1).then(function(e){return n.updateBubbleState(n.bubbleBorder),"text"==_[0].type&&o(_[0],!0),$.fastPlay&&i()?f(t,r):n.autoPlay||$.autoPlay&&i()?u.c.timeout(400).then(function(){return n.doInTL(w)}).then(function(){return f(t,r)}):n.handleContinue(w).then(function(){return b()})})}break;case"hideBubble":var V=n.bubbleBorderVector.find(function(e){return e.index===parseInt(_[0])})||n.bubbleBorder;if(!V)break;V.clear(),V.display(!1),n.updateBubbleState(V);break;case"playSound":n.playSound(_[0]);break;case"stopSound":ae.stopSound(_[0]);break;case"playMusic":n.playMusic(_[0]);break;case"stopMusic":ae.stopMusic();break;case"animateSound":var j=_[0],U=j.index,D=j.volume,R=j.duration,B=j.delay;if($.fastPlay){var L=$.getFastPlayAnimationInfo(R);B=L.delay,R=L.duration}ae.tweenToWithSound({volume:D,duration:R,delay:B,channel:U});break;case"animateMusic":var F=_[0],z=F.volume,W=F.duration,N=F.delay;if($.fastPlay){var H=$.getFastPlayAnimationInfo(W);N=H.delay,W=H.duration}ae.tweenToWithMusic({volume:z,duration:W,delay:N});break;case"addImage":n.state=S()(n.state,{images:P({},_[0].index,{$set:{command:g}})}),n.renderImage(_[0]);break;case"animateImage":n.state=S()(n.state,{images:P({},_[0].index,{$apply:function(e){return e?O({},e,{animate:g}):e}})}),n.animateImage(_[0]);break;case"delImage":n.state=S()(n.state,{images:P({},_[0],{$set:void 0})}),n.removeImage(_[0]);break;case"addView":case"delView":n.state=S()(n.state,{views:{$apply:function(e){return"delView"===y?e.filter(function(e){return e.args[0].instanceUuid!==_[0]}):[].concat(Object(k.a)(e),[g])}}});break;case"showGlobalView":case"hideGlobalView":n.state=S()(n.state,{hideGlobalViews:{$apply:function(e){return e=e.filter(function(e){return e!==_[0]}),"showGlobalView"===y?e:[].concat(Object(k.a)(e),[_[0]])}}})}f(t,r)}};return new Promise(function(e,t){n.setControlPlay(e,function(r){n.options.removeAll(!0),n.handleClearContinue(),l=r,s=n.timeline,f(e,t)}),p(e,t)})}},{key:"clear",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.proceed(),this.tweens.forEach(function(e){return e.cancel&&e.cancel()}),this.tweens.length=0,this.state={playStack:[],images:[],dialog:{},weather:null,autotext:null,disableSaveOrLoad:null,animateScene:null,views:[],hideGlobalViews:[],bubbleMode:[]},this.dialogView&&this.dialogView.clear(),t)for(;this.bubbleBorderVector.length>0;)this.bubbleBorderVector.pop().clear(!0);else this.bubbleBorderVector.forEach(function(e){return e.clear()});for(;this.optionsTimeoutHandles.length>0;){this.optionsTimeoutHandles.pop()()}this.handleClearContinue(),On.forEach(function(n){var r=e[n];("bubbles"!==n||t)&&r.removeAll(!0),r.y=r.x=0})}}]),e}(),In=(n(181),function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new An(0,e)}},{key:"showTip",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return new An(1,0,e)}}]),e}()),An=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;Object(i.a)(this,e);try{return new Promise(function(e,a){var i=0,o=document.createElement("div");o.classList.add("shareModalContainer"),document.body.appendChild(o);var s=document.createElement("div");s.classList.add("shareModalPortal"),o.appendChild(s);var c=function(){i>0&&clearInterval(i),document.body.removeChild(o)},l=function(){return c(),a("close")},d=function(){return c(),a("cancle")},h=function(){return c(),e("close")};0===t?(s.innerHTML='<div class="friend_share_bg" id="modalPortal">\n                      <div class="share_close"><a title="关闭"></a></div>\n                      <div class="share_cont">\n                        <img src="./img/share/sword_pic.png">\n                        <p>分享可领取<span class="content">6闪币</span></p>\n                      </div>\n                      <div>\n                        <input class="cancle_btn" type="button" name="">\n                        <input class="sure_btn" type="button" name="">\n                      </div>\n                    </div>\n                    <div class="friend_shadow"></div>',s.getElementsByClassName("share_close")[0].onclick=l,s.getElementsByClassName("cancle_btn")[0].onclick=d,s.getElementsByClassName("sure_btn")[0].onclick=h,s.getElementsByClassName("content")[0].innerText="".concat(n,"闪币")):1===t&&(s.innerHTML='<div class="tip_share_bg" id="modalPortal">\n                      <div class="tip_close"><a title="关闭"></a></div>\n                      <div class="tip_cont">\n                        <p>分享太过频繁，距离下次分享还需</p>\n                        <div class="time_bg">\n                            <span class="tip_time">00:00:00</span>\n                        </div>\n                      </div>\n                      <div>\n                        <input class="cancle_btn" type="button" name="">\n                        <input class="sure_btn" type="button" name="">\n                      </div>\n                    </div>\n                    <div class="tip_shadow"></div>',s.getElementsByClassName("tip_close")[0].onclick=l,s.getElementsByClassName("cancle_btn")[0].onclick=d,s.getElementsByClassName("sure_btn")[0].onclick=h,s.getElementsByClassName("tip_time")[0].innerText=u.c.convert(r,2),i=setInterval(function(){if(--r<0)return c(),e("timeout");s.getElementsByClassName("tip_time")[0].innerText=u.c.convert(r,2)},1e3));var f=document.getElementById("modalPortal");document.body.clientWidth<=document.body.clientHeight&&(f.style.transform="rotate(90deg)");var p=function(){var e=document.documentElement.clientWidth;e>960&&(e=960);var t=Parameter.vertical,n=document.body.clientWidth<=document.body.clientHeight?5:9.6;document.documentElement.style.fontSize=e/n+"px",document.body.clientWidth<=document.body.clientHeight?f.style.transform=t?"rotate(0)":"rotate(90deg)":f.style.transform=t?"rotate(90deg)":"rotate(0)"};p(),window.onresize=function(){p()}})}catch(e){return Promise.reject("error")}},Mn=function(){function e(){Object(i.a)(this,e)}return Object(o.a)(e,null,[{key:"show",value:function(e,t,n){return new Tn(e=null==e?0:e,t,n)}}]),e}(),Tn=function e(t,n,r){Object(i.a)(this,e);try{return new Promise(function(e,a){var i=document.createElement("div");i.classList.add("intivemodalContainer"),document.body.appendChild(i);var o=document.createElement("div");o.classList.add("intivemodalPortal"),i.appendChild(o);var u=function(){document.body.removeChild(i)},s=function(e){if("getbtn get1"===e.target.className){o.getElementsByClassName("prize")[e.target.id].children[2].innerHTML='<a class="getbtn get2">已领奖励</a>';var t=0===e.target.id?5:1===e.target.id?10:2===e.target.id?20:40;r(e.target.id,t),e.stopPropagation()}};o.innerHTML='<div class="task_bg" id="modalPortal">\n                    <div class="task_close"><a title="关闭"></a></div>\n                    <div class="task_cont">\n                        <div class="banner">\n                            <img src="./img/share/banner.png">\n                        </div>\n                        <div class="task_list">\n                            <ul>\n                                <li>\n                                    <p>邀请<span>3位</span>好友获得额外奖励</p>\n                                    <div class="progress">\n                                        <i style="width:50%"></i>\n                                        <em>1 / 3</em>\n                                    </div>\n                                    <div class="prize">\n                                        <img src="./img/share/jl_coin.png" alt="">x<span>5</span>\n                                        <a class="getbtn get0">尚未达成</a>\n                                    </div>\n                                </li>\n                                <li>\n                                    <p>邀请<span>10位</span>好友获得额外奖励</p>\n                                    <div class="progress">\n                                        <i style="width:100%"></i>\n                                        <em>4/10</em>\n                                    </div>\n                                    <div class="prize">\n                                        <img src="./img/share/jl_coin.png" alt="">x<span>10</span>\n                                        <a class="getbtn get0">尚未达成</a>\n                                    </div>\n                                </li>\n                                <li>\n                                    <p>邀请<span>50位</span>好友获得额外奖励</p>\n                                    <div class="progress">\n                                        <i style="width:50%"></i>\n                                        <em>4/10</em>\n                                    </div>\n                                    <div class="prize">\n                                        <img src="./img/share/jl_coin.png" alt="">x<span>20</span>\n                                        <a class="getbtn get0">尚未达成</a>\n                                    </div>\n                                </li>\n                                <li>\n                                    <p>邀请<span>100位</span>好友得额外奖励</p>\n                                    <div class="progress">\n                                        <i style="width:50%"></i>\n                                        <em>4/50</em>\n                                    </div>\n                                    <div class="prize">\n                                        <img src="./img/share/jl_coin.png" alt="">x<span>40</span>\n                                        <a class="getbtn get0">尚未达成</a>\n                                    </div>\n                                </li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div>\n                        <input class="invate_btn" type="button" name="">\n                    </div>\n                </div>\n                <div class="friend_shadow"></div>';var c=document.getElementById("modalPortal");document.body.clientWidth<=document.body.clientHeight&&(c.style.transform="rotate(90deg)");var d=function(){var e=document.documentElement.clientWidth,t=l.a.vertical;e>960&&(e=960);var n=document.body.clientWidth<=document.body.clientHeight?5:9.6;document.documentElement.style.fontSize=e/n+"px",document.body.clientWidth<=document.body.clientHeight?c.style.transform=t?"rotate(0)":"rotate(90deg)":c.style.transform=t?"rotate(90deg)":"rotate(0)"};d(),window.onresize=function(){d()};var h=t/3>=1?100:t/3*100,f=t/10>=1?100:t/10*100,p=t/50>=1?100:t/50*100,v=t/100>=1?100:t/100*100;!function(){for(var e=0;e<4;e++){var r=o.getElementsByClassName("progress")[e];r.children[0].style.width="".concat(0===e?h:1===e?f:2===e?p:v,"%"),r.children[1].innerText="".concat(t,"/").concat(0===e?3:1===e?10:2===e?50:100),o.getElementsByClassName("prize")[e].children[2].innerHTML="1"===n[e]?'<a class="getbtn get2">已领奖励</a>':100===h?'<a class="getbtn get1" id="'.concat(e,'">领取奖励</a>'):'<a class="getbtn get0">尚未达成</a>'}}(),o.getElementsByClassName("task_close")[0].onclick=function(){return u(),a("close")},o.getElementsByClassName("invate_btn")[0].onclick=function(){return u(),e("intive")};var m=function(e){return o.getElementsByClassName("getbtn get1")[e]};m(0)&&(m(0).onclick=s),m(1)&&(m(1).onclick=s),m(2)&&(m(2).onclick=s),m(3)&&(m(3).onclick=s)})}catch(e){return Promise.reject("error")}},Vn=function e(){Object(i.a)(this,e)};P(Vn,"show",function(){return new Promise(function(e,t){var n=l.a.vertical,r=l.a.client,a=l.a.single,i=l.a.offline;if("wap"===r||a)return game.gameResumed(),e();var o=i?Promise.resolve():Object(we.b)({url:"//app.3000.com/?m=game_info&op=index&ac=alpha_status"}),s=function(){D.switchAppBack(!1);var t=document.createElement("div");t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.bottom=0,t.style.right=0,t.style.overflow="hidden";var r=document.createElement("div");t.appendChild(r),u.c.setElemetStyle(r,"transformOrigin","center");var a=top.location!==self.location,i=function(){return window.innerWidth||window.documentElement.clientWidth||window.document.body.clientWidth},o=function(){return window.innerHeight||window.documentElement.clientHeight||window.document.body.clientHeight},s=i(),c=o();if(a&&game.device.iOS&&void 0!==window.orientation){var d=90===window.orientation||-90===window.orientation;s=d?window.originalHeight:window.originalWidth,c=d?window.originalWidth:window.originalHeight}if(s<=c&&!n){var h=[s,c];c=h[0],s=h[1],r.style.transform="rotate(90deg)"}var f=function(){var e=i(),t=o(),s=function(){if(v){var a=e,i=t;e<=t&&(a=n?e:t,i=n?t:e),v.setAttribute("width",a),v.setAttribute("height",i)}r.style.transform=e<=t?n?"rotate(0)":"rotate(90deg)":n?"rotate(90deg)":"rotate(0)"};a&&game.device.iOS&&void 0!==window.orientation?u.c.timeout(50).then(function(){var n=90===window.orientation||-90===window.orientation;e=n?window.originalHeight:window.originalWidth,t=n?window.originalWidth:window.originalHeight,s()}):s()};window.addEventListener("resize",f,!0);var p,v=document.createElement("iframe");v.src=(p=l.a.gid,"".concat(Ie.showGameNotice).concat(p)),v.setAttribute("scrolling","no"),v.setAttribute("width",s),v.setAttribute("height",c),v.setAttribute("frameborder",0),v.setAttribute("allowtransparency","true"),r.appendChild(v),document.body.appendChild(t),window.addEventListener("message",function(n){var r=n.data;try{(r=JSON.parse(r)).isHide&&"none"===r.isHide&&(window.removeEventListener("resize",f,!0),document.body.removeChild(t),D.switchAppBack(!0),game.gameResumed(),e())}catch(t){D.switchAppBack(!0),game.gameResumed(),e()}},!1)};o.then(function(e){s()},function(t){return game.gameResumed(),e()})})});var jn={logo:"logo",cover:"cover",scene:"scene",mainMenu:"mainMenu",settings:"settings",loadRecord:"loadRecord",saveRecord:"saveRecord",playback:"playback",diyMainMenu:"diyMainMenu"},Un=["plotViews","calledViews","globalViews","globalCalledViews","menus","space","menuViews","menuCalledViews"],Dn=0,Rn=[],Bn=0,Ln=0,Fn=0,zn=0,Wn=!1,Nn=!1,$n=!1,Hn=function(){function e(t,n,r){var a=this;Object(i.a)(this,e),P(this,"findGivenView",function(e){var t=a.json.viewMap;for(var n in t){var r=t[n];if(r&&r.name==e)return r}return null}),P(this,"handleShareBack",function(e,t){if(!e)return Mt({type:At,text:"分享失败!"}),Promise.reject(t);Mt({type:It,text:"分享成功!"}),Dn=u.a.passSeconds;var n=l.a.qz_sharecount,r=l.a.qz_pindex;if(n<10){var a=r||134;t=S()(t,{playContext:{payValues:P({},a,{value:{$apply:function(e){return e+1}}})}}),Bt.uploadPayValues(t.playContext,[],!0)}return Lt.runSpecialEvents(Rn,t)}),P(this,"handleShare",function(e){var t=e.isInvite,n=void 0!==t&&t,r=e.force,i=void 0!==r&&r,o=e.context,s=function(e){return new Promise(function(e,t){return M.d.addEventsSharePanelQzone(function(t){return e(t)})}).then(function(t){return a.handleShareBack(t,e)},function(){return e})};if(0==Dn||u.a.passSeconds-Dn>=60){if(i){if(n){var c=l.a.qz_receivecount,d=l.a.qz_invitecount,h=qz_pindex||134,f=0,p=-1;d>=3&&d<10?"1"!==c[0]&&(f=5,p=0):d>=10&&d<50?"1"!==c[1]&&(f=10,p=1):d>=50&&d<100?"1"!==c[2]&&(f=20,p=2):d>100&&"1"!==c[3]&&(f=40,p=3),o=S()(o,{playContext:{payValues:P({},h,{value:{$apply:function(e){return e+f}}})}}),Bt.uploadPayValues(o.playContext,[],!0),-1!==p&&(l.a.qz_receivecount[p]="1"),M.d.postGetPrizeQzone()}return M.d.openShareMessageQzone(n).then(function(){return s(o)},function(){return o})}return n?M.d.getIntiveInfoQzone().then(function(e){if(!e)return Mt({type:At,text:"邀请人数信息获取失败,稍后重试！"}),Promise.reject(o);var t=l.a.qz_invitecount,r=l.a.qz_receivecount,u=qz_pindex||134;return Mn.show(t,r,function(e,t){o=S()(o,{playContext:{payValues:P({},u,{value:{$apply:function(e){return e+t}}})}}),Bt.uploadPayValues(o.playContext,[],!0),l.a.qz_receivecount[e]="1",M.d.postGetPrizeQzone()}).then(function(){return M.d.openShareMessageQzone(!0)},function(e){return"error"===e?a.handleShare({isInvite:n,force:i,context:o}):o})}).then(function(){return s(o)},function(){return o}):In.show(1).then(function(){return M.d.openShareMessageQzone().then(function(){return s(o)},function(){return o})},function(e){return"error"===e&&a.handleShare({isInvite:n,force:!0,context:o}),o})}return i?(Mt({type:At,text:"分享太过频繁，距离下次分享还需".concat(u.c.convert(60-u.a.passSeconds-Dn,2))}),Promise.reject(o)):In.showTip(60-u.a.passSeconds-Dn).then(function(e){return"timeout"===e?a.handleShare({isInvite:n,force:i,context:o}):o},function(){return o})}),P(this,"handleLogin",function(){var e=game.world,t=xt.fullScreenTip({text:"更新用户数据",alpha:.5});e.add(t);var n=l.a.uuid,r=a.getSavedRecords(!0),i=r.records,o=r.owner;a.records.owner!==o&&""!==a.records.owner&&D.localStorageSetItem("".concat(n).concat(a.records.owner),JSON.stringify(a.records.local)),i.some(function(e){return e})?a.records.local=i:D.localStorageSetItem("".concat(n).concat(o),JSON.stringify(a.records.local)),a.records.cloud=new Array(12).fill(null),a.records.owner=o,Bt.updateUserAccInfo(a.playContext,!0).then(function(n){a.playContext=n,e.remove(t,!0)})}),P(this,"handleLogout",function(){var e=game.world,t=xt.fullScreenTip({text:"更新用户数据",alpha:.5});e.add(t);var n=l.a.uuid,r=a.getSavedRecords(),i=r.records,o=r.owner;a.records.owner!==o?D.localStorageSetItem("".concat(n).concat(a.records.owner),JSON.stringify(a.records.local)):i=a.records.local,a.records={local:i,owner:o,cloud:new Array(12).fill(null)},a.playContext=S()(a.playContext,{systemValues:P({},0,{value:{$set:0}})}),Bt.updateUserAccInfo(a.playContext).then(function(n){a.playContext=n,e.remove(t,!0)})}),P(this,"handleMenuClick",function(){if(!a.state.loading){var e=a.json,t=a.playContext,n=a.handleShare,r=a.inputs.views,i=a.game.world,o=i.width,s=i.height,c=e.default_settings.mainMenu,l=function(e){return a.menus.visible=e};if(l(!1),c&&c.ref){Un.slice(5).forEach(function(e){return a[e].visible=!0}),a.state.plotSnap=u.c.getSnap(),a.targetScene&&a.targetScene.pause(),r.forEach(function(e){return e.show(!1)}),a.playContext.openPages.unshift(jn.diyMainMenu);var d=mt.rectMask({rect:{width:o,height:s},alpha:0});d.inputEnabled=!0,a.space.add(d);var h=Lt.instanceView(c,e,t),f=S()(a.viewContext,{menuViews:{$set:[h]},menuCalledViews:{$set:[]}});Lt.runOnLoadEventInView([0,["menuViews",null]],{playContext:t,viewContext:f,game:e,handleShare:n}).then(function(e){return a.handleChangeContext(e)})}else a.showSystemUI(jn.mainMenu,function(){return l(!0)})}}),P(this,"handleHoldFastPlay",function(e){var t=a.playContext.openPages,n=void 0===t?[]:t,r=a.inputs,i=r.diyMainMenu,o=r.views,u=a.targetScene,s=a.noShowingViews,c=a.state,l=c.loading,d=c.inputing,h=u&&u.options&&u.options.children.length>0;if(!e||n[0]!==jn.scene||h||l||d||!s())return a.holdFastPlayTip&&a.holdFastPlayTip.destroy(),a.holdFastPlayTip=null,n[0]!==jn.scene?(o.forEach(function(e){return e.show(!1)}),i.forEach(function(e){return e.show(n.some(function(e){return e===jn.diyMainMenu}))})):[].concat(Object(k.a)(o),Object(k.a)(i)).forEach(function(e){return e.show(!0)}),void($.fastPlay=!1);if($.fastPlay=!0,[].concat(Object(k.a)(i),Object(k.a)(o)).forEach(function(e){return e.show(!1)}),!a.holdFastPlayTip){var f=a.game.world,p=f.centerX,v=f.centerY,m=mt.group(),g=mt.image("app_button_speed",{x:p,y:v,centre:!0});m.add(g),p-=g.width/2,v-=g.height/2;var y=mt.image("app_icon_speed",{x:p+90,y:v+25});m.add(y),m.add(mt.text({x:p+80,y:v+y.height+40},{fontSize:25,forceFontFamily:"宋体",color:"#333333",text:"快进中..."})),m.add(mt.text({x:p+40,y:v+y.height+75},{fontSize:20,forceFontFamily:"宋体",color:"#aaadb3",text:"松开手指恢复播放"})),f.add(m),a.holdFastPlayTip=m}}),P(this,"handleKeyDown",function(e){if(!a.state.inputing){var t=a.targetScene,n=a.noShowingViews,r=a.state,i=r.loading,o=r.inputing,u=t&&t.options&&t.options.children.length>0;e.keyCode!==Phaser.Keyboard.Z||u||i||o||!n()||($.fastPlay=!0)}}),P(this,"handleKeyUp",function(e){if(!a.state.inputing){var t=a.playContext,n=a.viewContext,r=a.json;if(e.keyCode!==Phaser.Keyboard.Z){var i=[jn.scene,jn.diyMainMenu],o=t.openPages,u=void 0===o?[]:o;if(i.some(function(e){return e===u[0]})){var s=Lt.fixContext({game:r,playContext:t,viewContext:n}),c=Promise.resolve(s),l=u[0]===jn.diyMainMenu;a.keyUpListeners.forEach(function(t){c=l?t.isDiyMenuView?c.then(function(n){return t.handle(e.keyCode,n)}):c:c.then(function(n){return t.handle(e.keyCode,n)})}),c.then(function(e){return s!==e&&a.handleChangeContext(e)})}}else $.fastPlay=!1}}),P(this,"resetPlayCount",function(){zn>=300&&(Ln=0),zn=0}),P(this,"handleTimer",function(){var e=[jn.scene,jn.diyMainMenu],t=a.playContext,n=a.viewContext,r=a.json,i=t.openPages,o=void 0===i?[]:i;if(e.some(function(e){return e===o[0]})){var s=Lt.fixContext({game:r,playContext:t,viewContext:n}),c=Promise.resolve(s),l=o[0]===jn.diyMainMenu;a.timerListeners.forEach(function(e){c=l?e.isDiyMenuView?c.then(function(t){return e.handle(t,10)}):c:c.then(function(t){return e.handle(t,10)})}),c.then(function(e){return s!==e&&a.handleChangeContext(e)})}Fn!==u.a.passSeconds&&!1!==Wn&&(Fn=u.a.passSeconds,zn++,++Ln>=60&&zn<300&&(Qe(Ln),Ln=0)),u.c.timeout(10).then(function(){return a.handleTimer()})}),P(this,"handleViewMount",function(e,t,n){var r=a.viewContext,i=a.playContext,o=t.events,u=t.view,s=u.events,c=u.type,l=u.content,d=l.step,h=l.count,f=l.value;e.viewData=t,e.pathInfos=Lt.getViewPathInfos(n,r);var p=e.destroy;e.destroy=function(){a.handleViewUnmount(e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];p.apply(e,n)};var v=Pt.stringify(n).includes("menu"),m=o.some(function(e){return"onKeyUp"===e.type})||s.some(function(e){return"onKeyUp"===e.type}),g=o.some(function(e){return"onClick"===e.type})||s.some(function(e){return"onClick"===e.type});if(m){var y={type:"keyup",isDiyMenuView:v,viewPathInfos:Lt.getViewPathInfos(n,r),handle:function(e,t){y.viewPathInfos=Lt.updateViewPathInfos(y.viewPathInfos,t.viewContext);var n=y.viewPathInfos[y.viewPathInfos.length-1].path;if(Pt.get(t.viewContext,n))return Lt.runEventInView("onKeyUp",n,t,e);var r=a.keyUpListeners.indexOf(y);return~r&&a.keyUpListeners.splice(r,1),Promise.resolve(t)}};a.keyUpListeners.push(y)}if("timer"!==c){if("input"===c){var _=f.arg1,w=-1,b={type:c,index:w};-1!==(w=i.values.findIndex(function(e){return e.uuid===_}))?(e.isNumber=!0,b={index:w,type:"values"}):-1!==(w=i.savedValues.findIndex(function(e){return e.uuid===_}))?(e.isNumber=!0,b={index:w,type:"savedValues"}):-1!==(w=i.stringValues.findIndex(function(e){return e.uuid===_}))?b={index:w,type:"stringValues"}:-1!==(w=i.payValues.findIndex(function(e){return e.uuid===_}))&&(e.isNumber=!0,b={index:w,type:"payValues"});-1===w&&(e.text="[未知数值]"),e.setInputCallback(function(e,t){return function(n){if(a.state.inputing=!n,n){var r=t.text,i=t.isNumber,o=e.index,u=e.type,s=a.playContext;if(i&&(r=parseFloat(r)),-1!==o){a.playContext=S()(s,P({},u,P({},o,{value:{$set:r}})));var c=t.pathInfos;if(!t.parent)return;var l=c[c.length-1].path,d=a.viewContext;if(Pt.get(d,l)){var h=Pt.createQuery(l,{view:{content:{value:{value:{$set:r}}}}});a.viewContext=S()(d,h)}}else t.text="[未知数值]"}}}(b,e)),v?a.inputs.diyMainMenu.push(e):a.inputs.views.push(e),$.fastPlay&&a.holdFastPlayTip&&e.show(!1)}if("text"===c){if(!g){var k=e.input;return void(k?(e.inputEnabled=!1,k.removedFromGroup()):e.ignoreChildInput=!0)}e instanceof Phaser.Group&&e.children.forEach(function(e){e.inputEnabled=!0,e.input&&(e.input.useHandCursor=!0)})}e.inputEnabled=!0;var x=function(t,n){if(!n||n.pointerMode!==Phaser.PointerMode.CURSOR||0===n.button){var r=a.viewContext,i=a.playContext,o=e.pathInfos=Lt.updateViewPathInfos(e.pathInfos,r),u=o[o.length-1].path,s=Lt.fixContext({game:a.json,playContext:i,viewContext:r});Lt.runEventInView("onClick",u,s).then(function(e){return e!==s&&a.handleChangeContext(e)})}};e instanceof Phaser.Group?e.onChildInputUp.add(x):e.events.onInputUp.add(x)}else{var C={type:"timer",isDiyMenuView:v,viewPathInfos:Lt.getViewPathInfos(n,r),step:d.value,count:h.value,current:t.currentCount*d.value||0,stop:!1,handle:function(e,t){C.current+=t,C.viewPathInfos=Lt.updateViewPathInfos(C.viewPathInfos,e.viewContext);var n=C.viewPathInfos[C.viewPathInfos.length-1].path,r=Pt.get(e.viewContext,n);if(r&&"timer"===r.view.type){var i=C.current/C.step;if(!(C.current%C.step)){if(r.currentCount=i,!C.count||C.count>=i)return Lt.runEventInView("onStep",n,e);C.count<i&&(C.stop=!0)}}if(!r||"timer"!==r.view.type||C.stop){var o=a.timerListeners.indexOf(C);~o&&a.timerListeners.splice(o,1)}return Promise.resolve(e)}};a.timerListeners.push(C)}}),P(this,"handleViewUpdate",function(e,t,n){var r=a.viewContext;e.viewData=t,e.pathInfos=Lt.getViewPathInfos(n,r);for(var i=a.timerListeners,o=0,u=i.length;o<u;o++){var s=i[o];s.viewPathInfos=Lt.updateViewPathInfos(s.viewPathInfos,r);var c=s.viewPathInfos[s.viewPathInfos.length-1].path;Pt.isSame(n,c)&&(t.currentCount=i[o].current=0)}}),P(this,"handleViewUnmount",function(e){var t=e.viewData.view.type,n=a.inputs,r=n.diyMainMenu,i=n.views,o=a.viewContext;if("input"===t){var u=r.findIndex(function(t){return t===e});~u?r.splice(u,1):~(u=i.findIndex(function(t){return t===e}))&&i.splice(u,1)}e.viewData=null,e.pathInfos=null;var s=function(e){for(var t=0;t<e.length;t++){var n=e[t].viewPathInfos,r=Lt.updateViewPathInfos(n,o),a=r[r.length-1].path;Pt.get(o,a)||(e.splice(t,1),t--)}};s(a.keyUpListeners),s(a.timerListeners)}),P(this,"showPlotViews",function(){a.plotViews.visible=!0,a.calledViews.visible=!0,!a.noShowingViews()&&a.game.input.onUp.dispatch()}),P(this,"existPlotViews",function(e){var t=e.ref,n=e.instanceUuid;return-1!==a.viewContext.plotViews.findIndex(function(e){return e.ref==t&&e.instanceUuid==n})}),P(this,"noShowingViews",function(){var e=a.viewContext,t=e.plotViews,n=void 0===t?[]:t,r=e.calledViews,i=void 0===r?[]:r;return!(n.length||i.length)}),P(this,"addViews",function(e){var t=a.playContext,n=a.handleShare,r=a.json,i=(e=e.map(function(e){return Lt.instanceView(e,r,t)})).map(function(e){return e.instanceUuid});return function e(t,n){var r=i[n];if(!r)return Promise.resolve(t);for(var a,o=t.viewContext.plotViews;r&&!o.some(function(e){return e.instanceUuid===r});)r=i[++n];return r?(a=o.findIndex(function(e){return e.instanceUuid===r}),Lt.runOnLoadEventInView([a,["plotViews",null]],t).then(function(t){return e(t,n+1)})):Promise.resolve(t)}({viewContext:S()(a.viewContext,{plotViews:{$push:e}}),game:r,playContext:t,handleShare:n},0).then(function(e){return a.handleChangeContext(e)})}),P(this,"delView",function(e){var t=S()(a.viewContext,{plotViews:{$apply:function(t){var n=t.findIndex(function(t){return t.instanceUuid===e});return~n?t.filter(function(e,t){return t!==n}):t}}});a.handleChangeViewContext(t)}),P(this,"pushPlayback",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=a.playContext,r=e[t?"content":"speaking"].data,i=e[t?"role":"dialogtitle"].data,o=e[t?"role":"dialogtitle"].hidden,u="";i=ke.parseValue(i,n),!o&&i.length&&(u=i+":"),r=ke.parseValue(r,n),Array.isArray(r)?r.forEach(function(e){return u+=e.data}):u+=r,u&&n.playback.push(u)}),P(this,"runCommandAfter",function(e,t){if(!e)return Promise.resolve();tt.resetComandAfter(e),tt.resetCommandOption(e);var n=t?function(e){var t=e.commands,n=e.cmdIndex,r=tt.getCommand(t[n]),i=tt.getUsing(),o=[];[].concat(Object(k.a)(r),Object(k.a)(i)).forEach(function(e){var t=e.type,n=e.url,r=o.findIndex(function(e){return e.url===n});~r?o[r].count++:o.push({type:t,url:n,count:1})});var u=o.map(function(e){var t=e.type,n=e.url,r=e.count;return tt.inCache(t,n)?tt.isSafeRef(t,n,r)?null:(tt.addRefTo(t,n,"play",r),null):{type:t,url:n}}).filter(function(e){return e});return u.length?a.loadAssets(u,!0):Promise.resolve()}(t):Promise.resolve(),r=a.json.default_settings.autoSaveOrLoad,i=e.type,o=e.args;switch(i){case"addView":a.game.input.onUp.dispatch(),n=n.then(function(){return a.addViews(o)});break;case"delView":a.delView(o[0]);break;case"showGlobalView":case"hideGlobalView":a.handleChangeViewContext(S()(a.viewContext,{globalViews:{$apply:function(e){var t=e.findIndex(function(e){return e.instanceUuid===o[0]});return~t?S()(e,P({},t,{visible:{$set:"showGlobalView"===i}})):e}}}));break;case"setValues":n=n.then(function(){return Bt.updatePayValues(a.playContext,o).then(function(e){return a.updatePlayContext(ke.setContextByValueHandles(e,o)),Bt.uploadPayValues(a.playContext,o)})});break;case"autoSaveOrLoad":if(t&&t.load)break;if(r&&1===o[0].type)n=n.then(function(){return a.autoLoadRecord().then(null,function(){return A.a.warn("Sorry~读不到存档内容，即将返回封面").then(function(){return a.start(),Promise.reject()},function(){return a.start(),Promise.reject()})})});else if(r&&0===o[0].type){var s=a.context,c=s.commands,l=s.cmdIndex,d=c&&c[l];d&&d.uuid===e.uuid&&(n=n.then(function(){return u.c.timeoutByPhaser(1)})),n=n.then(function(){return a.autoSaveRecord()})}break;case"systemUI":var h=o[0];switch(h){case"settings":h=jn.settings;break;case"playback":h=jn.playback;break;case"save-record":h=jn.saveRecord;break;case"load-record":h=jn.loadRecord;break;default:h=null}h&&(n=n.then(function(){return new Promise(function(e,t){return a.showSystemUI(h,function(){return e()})})}))}return n}),P(this,"getSavedRecords",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=l.a.uuid,n=l.a.uid,r=l.a.isWapOther,i=l.a.wap,o=r&&"mk"==i&&a.game.device.iOS,u=D.localStorageGetItem(o?"".concat(t).concat(n,"record"):"".concat(t).concat(n))||"";e&&""==u&&(u=D.localStorageGetItem(o?"".concat(t,"record"):"".concat(t))||"",D.localStorageRemoveItem(o?"".concat(t,"record"):"".concat(t)));try{u=(u=u.replace(/\r/g,"\\r").replace(/\n/g,"\\n"))?JSON.parse(u):new Array(12).fill(null)}catch(e){u=new Array(12).fill(null)}return void 0!==(u=u.map(function(e){if(!e||!Object.keys(e).length)return null;var t=e.plotSnap;return O({},e,{thumb:e.thumb||t})})).find(function(e){return null!==e})&&D.localStorageSetItem(o?"".concat(t).concat(n,"record"):"".concat(t).concat(n),JSON.stringify(u)),{records:u,owner:n}}),P(this,"getLocalRecords",function(){var e=l.a.alpha,t=l.a.client;return l.a.uid!==a.records.owner&&a.clearRecords(),Bn=0,e?Ke().then(function(n){if(!n&&e&&t){var r=function(){return window.location.href="lzj3000://quit"};return A.a.warn("内测作品，请登录内测账号试玩！").then(r,r),Promise.reject()}return Promise.resolve(a.records.local)}):Promise.resolve(a.records.local)}),P(this,"getCloudRecords",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=l.a.alpha,n=l.a.uid,r=l.a.client,i=l.a.gid;n!==a.records.owner&&a.clearRecords();var o=Promise.resolve();return t&&(o=Ke().then(function(e){if(!e){var t=function(){return window.location.href="lzj3000://quit"};return A.a.warn("内测作品，请登录内测账号试玩！").then(t,t),Promise.reject()}})),o.then(function(){return We(99).then(function(e){return("pc"===r?Be():Promise.resolve()).then(function(){e=e?JSON.parse(e):new Array(12).fill(null);var t=[];return a.records.cloud=e.map(function(e,n){if(e&&Object.keys(e).length){var r="",a=e.time_stamp,o=e.plot_snap,u=void 0===o?"":o,s=e.plotUuid;if(!u||!a||!s){if(!s||u||""===Ee.cover_url||!a)return null;r="".concat(Ee.cover_url).concat(i,"-").concat(l.a.uid,"-").concat(n,".jpg?coverran=").concat(1e5*Math.random()),l.a.offline&&r.indexOf("file://")>-1&&(r=r.replace(/file:\/\//,"https://")),t.push({type:"image",url:r})}return u&&(r=u.startsWith("data:image/jpeg;base64,")?u:"data:image/jpeg;base64,".concat(u)),{timestamp:(a+"").length>10?a:1e3*a,thumb:r}}return null}),Bn=1,a.loadAssets(t,!0).then(function(){return a.records.cloud})})},function(t){if(!e)return Promise.reject();Bn=0;var n=t.status,r=t.msg;return!D.isAppClient()&&a.game.scale.stopFullScreen(),$.full=!1,999==n?(A.a.error("网络异常，请检查您的网络！"),Promise.reject()):-110==n?(A.a.error(r),Promise.reject()):(D.logout(),A.a.error(r).then(function(){return D.login()}),Promise.reject())})})}),P(this,"checkRecordIsCloud",function(){return 1==Bn?Fe().then(function(){return!0},function(){return Promise.resolve(!1)}):Promise.resolve(!1)}),P(this,"autoLoadRecord",function(){return a.checkRecordIsCloud().then(function(e){return a.loadRecord(0,!e,!0)})}),P(this,"autoSaveRecord",function(){return u.c.timeout(0).then(function(){return a.state.plotSnap=u.c.getSnap(),a.checkRecordIsCloud().then(function(e){return a.saveRecord(0,!e,!0)})})}),P(this,"handleclickRecord",function(e,t,n){if("save"===e){var r=l.a.client,i=l.a.wap,o=Promise.resolve();return S.a||("pc"===r?o=Be().then(function(){return!0},function(){return!1}):"wap"===r&&"wx"!==i&&(o=Re())),o.then(function(){return a.saveRecord(t,n)})}return a.loadRecord(t,n)}),P(this,"getlockRecord",function(){var e=$.records.filter(function(e){return 0!==e.price});if(0==e.length)return Promise.resolve([]);var t=function(e,t){for(var n=[],r=function(r){var a=t[r];n.push(e.filter(function(e){return e.uuid==a}))},a=0;a<t.length;a++)r(a);return e.concat.apply(e,n).filter(function(e,t,n){return n.indexOf(e)===n.lastIndexOf(e)})};return 1==l.a.type?Promise.resolve(t(e,u.c.typeUnlockRecords)):Ze().then(function(n){return t(e,n)},function(t){return Promise.resolve(e)})}),P(this,"hideBackground",function(){return a.background&&(a.background.visible=!1)}),P(this,"setBackground",function(e){var t=a.background&&a.background.info||{},n=e.url,r=void 0===n?"":n,i=e.flex,o=void 0===i?1:i,u=e.opacity,s=void 0===u?1:u;if("inherit"===r){var c=t.url;r=void 0===c?"":c;var l=t.flex;o=void 0===l?1:l;var d=t.opacity;s=void 0===d?1:d}var h=a.game.world,f=h.width,p=h.height,v=(a.background||{}).visible,m=void 0!==v&&v;a.background&&(a.background.key=""),h.remove(a.background,!0,!0),a.background=null,r?(a.background=mt.image(),a.background.scale=new PIXI.Point(1,1),a.background.loadTexture(r)):a.background=mt.rectMask({rect:{width:f,height:p}}),a.background.visible=m,a.background.alpha=s,a.background.inputEnabled=!0,a.background.y=a.background.x=0,a.background.info={url:r,flex:o,opacity:s},r&&xt.flex(o,a.background,{width:f,height:p}),h.add(a.background,!0,0),r&&tt.addRef("image",r,"using"),t.url&&tt.subRef("image",t.url,"using")}),P(this,"start",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];a.resetPlayCount(),a.targetScene&&a.targetScene.clear(e),e&&a.commandScene&&a.targetScene!==a.commandScene&&a.commandScene.clear(!0),tt.clearPreload();var t=l.a.uuid,n=l.a.uid,r=l.a.gid,i=l.a.client,o=a.game.world,u=a.json,s=a.playContext,c=u.cover,d=u.views;a.handleChangeViewContext({plotViews:[],calledViews:[],globalViews:[],globalCalledViews:[],menuViews:[],menuCalledViews:[]}),a.menus.visible=!1;var h=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return S()(e,{value:{$set:ke.safeInitValue(e)}})})};s=S()(s,{stack:{$set:[]},playback:{$set:[]},openPages:{$set:[jn.cover]},values:{$set:h(u.values)},stringValues:{$set:h(u.stringValues)},indexValues:{$set:h(u.indexValues)}});var f=D.localStorageGetItem("".concat(t,"savedValues").concat(n));if(f){var p=s.savedValues;f=JSON.parse(f);for(var v=function(e){var t=f[e],n=t.uuid,r=t.value,a=p.findIndex(function(e){return e.uuid===n});~a&&(s=S()(s,{savedValues:P({},a,{value:{$set:r}})}))},m=0;m<f.length;m++)v(m)}if(a.playContext=s,"ios"===i||"android"===i||"wap"===i){var g="".concat(t).concat(r,"GameNotice"),y=D.localStorageGetItem(g)||"";Ge().then(function(e){e>y&&(D.localStorageSetItem(g,e),Vn.show())})}var _=function(){var e=a.playContext,t=a.viewContext,n=a.handleShare;Nn||(D.notifyGameStarted(),Wn=!0,Nn=!0),e.openPages=[];var r=d.map(function(t){return Lt.instanceView(t,u,e)});Lt.runOnLoadEvent(["globalViews",null],{playContext:e,viewContext:O({},t,{globalViews:r}),game:u,handleShare:n}).then(function(e){a.menus.visible=!0,a.handleChangeContext(e),a.playContext.openPages.push(jn.scene);var t=e.controlPlay,n=a.firstChapter;return t&&"jump"===t.type&&(n=ve.getChapterByUUID(u,t.uuid)),a.getChapterData(n).then(function(e){var t={stack:a.stack,chapter:e,plots:e.plots,plotIndex:0};return tt.getPreload(t).then(function(e){return a.loadAssets(e)}).then(function(){return a.play(t)},function(e){return console.warn(e)})})})};if(!c||c.hidden)return a.setBackground({}),_();var w=c.background,b=c.music;a.setBackground(w),a.background.visible=!0,b&&b.url?ae.playMusic(b):ae.stopMusic(),ae.stopAllSound(),a.coverView=qt({gameJson:u,callbacks:{start:function(){return _()},load:function(){return a.showSystemUI(jn.loadRecord)},settings:function(){return a.showSystemUI(jn.settings)}}}),o.add(a.coverView.container)}),this.audioMap={sounds:new Array(10).fill(null),music:null};var o=t.add,s=t.cache,c=t.device.desktop,d=t.input,h=d.keyboard,f=d.onHold,p=d.onUp,v=d.onDown,m=t.onPause,g=n.template.json.sound;s.checkSoundKey(g.url)&&($.buttonOverSound=o.sound(g.url,g.volume)),this.state={inputing:!1,loading:!1},this.game=t,this.json=n,this.firstChapter=ve.getFirstChapter(n);var y=function(){return a.playContext},_=this.setBackground,w=this.showPlotViews,b=this.hideBackground,x=this.noShowingViews,C=this.autoSaveRecord,E=this.addViews,I=this.pushPlayback,T=this.existPlotViews,V=this.resetPlayCount,j={game:t,json:n,getPlayContext:y,getInheritBackground:function(){return a.background&&a.background.info||{url:"",flex:1,opacity:1}},setBackground:_,showPlotViews:w,hideBackground:b,noShowingViews:x,autoSaveRecord:C,addViews:E,pushPlayback:I,existPlotViews:T,resetPlayCount:V};this.scene=new Cn(j),this.commandScene=new En(j),this.groups=mt.group();var U=function(e){var t=a.json,n=a.playContext,r=a.viewContext,i=Lt.fixContext({game:t,playContext:n,viewContext:r});a.handleShare({isInvite:e,context:i}).then(function(e){return a.handleChangeContext(e)})};Un.forEach(function(e){var t="menus"===e?gn({template:n.template,callbacks:{menu:a.handleMenuClick,share:U}}):mt.group(e);a[e]=a.groups.add(t)}),this.playContext=O({bubbleMode:[],bubbleCount:[],stack:[],playback:[],openPages:[]},r),this.viewContext={plotViews:[],calledViews:[],globalViews:[],globalCalledViews:[],menuViews:[],menuCalledViews:[]},ut.playContext=y(),u.c.preUid=l.a.uid,Bn=""===l.a.uid?0:1,u.c.midWayLoginFromePc=!1;var R=this.getSavedRecords(!0),B=R.records,L=R.owner;this.records={local:B,owner:L,cloud:new Array(12).fill(null)},this.keyUpListeners=[],this.timerListeners=[],this.inputs={views:[],diyMainMenu:[]},D.setCallback("updatevolume",function(e){ae.externalProhibitVolume=0==e,ae.updateMusicVolume(e,!0),ae.updateSoundsVolume(e,!0)}),this.handleTimer(),h.addCallbacks(this,this.handleKeyDown,this.handleKeyUp),c||(f.add(function(){return a.handleHoldFastPlay(!0)}),p.add(function(){return a.handleHoldFastPlay(!1)})),v.add(function(){t.gameResumed();var e=a.inputs,n=e.diyMainMenu,r=e.views;[].concat(Object(k.a)(r),Object(k.a)(n)).forEach(function(e){var t=e.element;t&&t.blur()}),!Nn&&a.targetScene&&(D.notifyGameStarted(),Nn=!0,Wn=!0)}),m.add(function(){return p.dispatch()}),D.setCallback("login",this.handleLogin),D.setCallback("logout",this.handleLogout),D.setCallback("restart",function(e){var n=a.inputs,r=n.diyMainMenu,i=n.views,o=a.holdFastPlayTip,s=a.playContext,c=a.state,l=a.space;o&&o.destroy(),[].concat(Object(k.a)(r),Object(k.a)(i)).forEach(function(e){return e.show(!1)}),s.openPages.unshift(jn.diyMainMenu),c.plotSnap=null,l.removeAll(!0),t.onRestart.dispatch(),u.c.timeout(50).then(function(){return a.start(e)})}),D.setCallback("showSave",function(){a.holdFastPlayTip&&a.holdFastPlayTip.destroy(),a.showSystemUI(jn.saveRecord),t.gameResumed()}),"pc"===l.a.client&&($.musicVolume=.5,$.soundVolume=.5,D.gameReady());var F=l.a.wap,z=l.a.single;if("qzone"===F){var W=l.a.qz_vindex,N=l.a.shareViewName,H=l.a.shareViewName1,q=l.a.inviteViewName,K=l.a.refreshViewName,G=W||177;this.playContext=S()(this.playContext,{values:P({},G,{value:{$set:1}})}),M.d.addEventsSharePanelQzone(function(e){var t=a.json,n=a.playContext,r=a.viewContext,i=Lt.fixContext({game:t,playContext:n,viewContext:r});a.handleShareBack(e,i).then(function(e){return a.handleChangeContext(e)})});var J=this.findGivenView(N),Q=this.findGivenView(H),Z=this.findGivenView(q),Y=this.findGivenView(K);J&&J.events.unshift({type:"onClick",name:J.name,expression:{type:"literal",value:"1"},events:[{type:"share",handle:{uuid:J.name}}]}),Q&&Q.events.unshift({type:"onClick",name:Q.name,expression:{type:"literal",value:"1"},events:[{type:"share",handle:{uuid:Q.name}}]}),Z&&Z.events.unshift({type:"onClick",name:Z.name,expression:{type:"literal",value:"1"},events:[{type:"share",handle:{uuid:Z.name}}]}),Y&&(Rn=Object(k.a)(Y.events))}if(z){var X=this.findGivenView("g6Hsa9WoK8"),ee=this.findGivenView("UGTmkxnxi"),te=this.findGivenView("SHANexit"),ne=this.findGivenView("SHANcharge");X&&X.events.unshift({type:"onClick",name:X.name,expression:{type:"literal",value:"1"},events:[{type:"playad",handle:{uuid:X.name}}]}),te&&te.events.unshift({type:"onClick",name:te.name,expression:{type:"literal",value:"1"},events:[{type:"loginout",handle:{uuid:te.name}}]}),ne&&ne.events.unshift({type:"onClick",name:ne.name,expression:{type:"literal",value:"1"},events:[{type:"recharge",handle:{uuid:ne.name}}]}),ee&&(Rn=Object(k.a)(ee.events)),D.setCallback("rechargeback",function(e){1==e&&Bt.updateAccinfo(a.playContext).then(function(e){return a.playContext=e})})}this.showLogo().then(function(){D.toOpenNotice(),a.start()})}return Object(o.a)(e,[{key:"loadAssets",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.game,a=r.load,i=r.world,o=xt.fullScreenTip({text:"加载中...",alpha:.5}),u=o.getByName("text");return n&&(o.alpha=0),new Promise(function(n,r){var s={};e.forEach(function(e){var t=e.type,n=e.url;tt.inCache(t,n)||(s[n]=!1,a.cancelForceRemoveFile(t,n),tt.load(t,n,!0,!0))});var c=Object.keys(s).length;if(!c)return o.destroy(!0),tt.startLoadThread(),n();i.add(o),t.state.loading=!0;var l=Object.create(null),d=0,h=function(){d===c&&(a.onSoundExtendLoad.removeAll(l),a.onSoundExtendLoadError.removeAll(l),a.onFileComplete.removeAll(l),i.remove(o,!0),t.state.loading=!1,tt.startLoadThread(),n())},f=function(e){(!s[e]&&void 0!==s[e]||null!=s[e]||(e.replace(/\/\/(apppic|synpic).3000test.com\//,""),void 0!==s[e]))&&(s[e]=!0,d++,u.text="加载中...".concat(parseInt(100*d/c),"%")),h()};a.onSoundExtendLoad.add(function(e){return f(e)},l),a.onSoundExtendLoadError.add(function(e){return f(e)},l),a.onFileComplete.add(function(e,t,n,r,a){return f(t)},l,0),a.onLoadComplete.addOnce(function(){return h()},l,0),a.start()})}},{key:"unlockChapterForWapOther",value:function(e){var t=e.uuid,n=e.charge,r=e.md5,a=e.handleProgress,i=e.name,o=void 0===i?"":i,s=l.a.uuid,c=l.a.wap,d=l.a.gid,h=function(){return He(t,r,a)},f=0,p=function e(t){return f>=5&&Promise.reject(),f++,"success"===t?h().then(null,function(){return e("error")}):A.a.custom("Info","未查询到你的付费信息哦，请确认已支付再点击刷新。如未购买请退出或重新购买~","提示","重试","退出",!1,3,0).then(function(){return h().then(null,function(){return e("error")})},function(){return Promise.reject()})};return Ne(s,t,null,"app").then(function(e){var t=e.charge;return u.c.timeout(100).then(function(){return t})}).then(function(e){return A.a.custom("Info","当前为收费章节，需支付".concat("mk"==c?200*e+"米粒":e+"元","解锁观看"),"章节收费提示","支付","取消",!1)}).then(function(){if("qh"===c)return M.c.qhpay(n,t,u.c.generateUUID(),t,null,0).then(p);if("mk"==c){var e=l.a.mk_uid,r=l.a.mk_access_token;n*=200;var a=u.a.getCurDate(),i=ge.a.hash(s+t+n+a+"4shan3yi9xia9men"),h={client:4,amount:n,game_id:d,uuid:s,chapter_uuid:t,time:a,token:i,outreach_uid:e,access_token:r,product_name:o,indentId:u.c.generateUUID()};return D.unlockChapter(h).then(function(){return u.c.timeout(600).then(function(){return p("success")})},function(){return Promise.reject()})}return Promise.reject()}).then(null,function(){return A.a.custom("Error","仍未查询到您的支付信息哦，请确认已经支付~ 如有疑问请添加闪艺客服QQ：819786897 ~","提示","复制QQ","取消",!1).then(function(){return kt()("819786897",{debug:!1,message:"复制成功"})}),Promise.reject()})}},{key:"unlockChapter",value:function(e){var t=e.uuid,n=e.charge,r=e.md5,a=e.handleProgress,i=e.name,o=void 0===i?"":i,s=l.a.uuid,c=l.a.client,d=(l.a.gid,l.a.wap),h=-1,f=-1,p=-1,v=-1,m="",g="",y=u.a.getCurDate();return Ne(s,t,null,"app").then(function(e){return h="pc"===c?e.charge:e.special_price,f=e.charge_app,p=e.charge_pc,!0}).then(function(){return"pc"!==c&&(l.a.uid=l.a.uid||u.c.getUidByCookie())}).then(function(){if("wap"===c){if("wx"===d)return A.a.custom("Info","请在应用商店下载闪艺app，阅读完整版作品","提示","知道了","取消",!1),Promise.reject();if(!l.a.uid)return Re().then(function(){if(!l.a.uid)return A.a.info("该章节为付费章节，需登录后查看~").then(function(){return D.login(),Promise.reject()},function(){return Promise.reject()})})}else"pc"===c&&(v=-1!==p?p:n,m=ge.a.hash(s+t+v+y+"4shan3yi9xia9men"),g=ge.a.hash(s+t+100*n+y+"4shan3yi9xia9men"));return Promise.resolve()}).then(function(){return D.unlockChapter({uuid:t,md5:r,charge:n,discounts:h,charge_app:f,charge_pc:p,chaptername:o,time:y,token:m,starToken:g})}).then(function(e){return!e&&"pc"!==c||"pc"===c&&0==e?Promise.reject():He(t,r,a).then(null,function(){return"wap"===c?D.login():"pc"!==c&&A.a.error("获取付费章节信息失败"),Promise.reject()})})}},{key:"getChapterData",value:function(e){var t=this,n=e.downloadUuid,r=e.uuid,a=e.plots,i=void 0===a?[]:a,o=e.md5,s=e.charge,c=e.name,d=void 0===c?"":c,h=n||r,f=l.a.isWapOther,p=l.a.gid,v=l.a.client,m=l.a.wap,g=l.a.type;l.a.single;if(i.length&&!D.isFinishedPreferentialChapter(h))return Promise.resolve(e);if(!o&&!i.length)return Promise.resolve(e);var y=!!i.length;i.length=0,this.state.loading=!0;var _=game.world,w=xt.fullScreenTip({text:"章节信息获取中...",alpha:.5,fontSize:16}),b=w.getByName("text");_.add(w);var x=function(e){var t=e.loaded;return b.text="章节信息获取中...".concat(t)},P=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"ios"!==v&&"android"!==v||!e||f?He(h,o,x,t).then(C):Promise.reject()},C=function(){var n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.state.loading=!1,(n=e.plots).push.apply(n,Object(k.a)(r)),_.remove(w,!0),e},S=function(e){return D.removeFinishedPreferentialChapter(h),C(e)},O=function(){return t.state.loading=!1,_.remove(w,!0),Promise.reject()};if(s&&("ios"===v||"android"===v||"wap"===v||"pc"===v||1==g)&&!f){if(1==g){var E=function(e){var t=e.code,n=e.message;return 87==t?O():999==t?(A.a.info(n),O()):(A.a.info("此处为收费章节，您暂时无法查看。请于作品正式上架后，在闪艺作品站查看"),O())},I=u.c.typeUnlockChapters.findIndex(function(e){return e==h})>-1;return u.c.typeUnlockChapters[0]&&"all"==u.c.typeUnlockChapters[0]&&(I=!0),I?P(!1,!0).then(null,E):A.a.info("此处为收费章节，需要收取".concat(s,"闪币")).then(function(){return P(!1,!0).then(null,E)},O)}return Ke().then(function(e){return e?(A.a.info("作品内测期间，暂不支持购买付费章节。"),Promise.reject()):P(!0).then(null,function(){return D.isFinishedPreferentialChapter(h)&&y?A.a.custom("Info","作品限免已结束，需要付费才能继续观看哦","限免提示","取消","去支付",!0).then(function(){return O()},function(e){return"cancel"===e?t.unlockChapter({uuid:h,charge:s,md5:o,handleProgress:x,name:d}).then(S,O):O()}):t.unlockChapter({uuid:h,charge:s,md5:o,handleProgress:x,name:d}).then(S,O)})})}return P().then(null,function(e){var n=e.code,r=e.message;return 87==n?O():999==n?(A.a.info(r),O()):f?t.unlockChapterForWapOther({uuid:h,charge:s,md5:o,handleProgress:x,name:d}).then(S,O):"zxwwap"===m?(A.a.info("当前为收费章节，是否前往闪艺抢先体验？").then(function(){return window.location.href="https://wap.3000.com/?m=detail&op=index&ac=index&id=".concat(p)}),O()):(A.a.info(1==g?"此处为收费章节，您暂时无法查看。请于作品正式上架后，在闪艺作品站查看":"当前为收费章节，请前往闪艺app或电脑端进行购买"),O())})}},{key:"hidePlotViews",value:function(){this.plotViews.visible=!1,this.calledViews.visible=!1}},{key:"clearPlotViews",value:function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.length?[]:e};this.handleChangeViewContext(S()(this.viewContext,{plotViews:{$apply:e},calledViews:{$apply:e}}))}},{key:"showGlobalViews",value:function(){var e=S()(this.viewContext,{globalViews:{$apply:function(e){return e.map(function(e){return S()(e,{visible:{$set:!0}})})}}});this.handleChangeViewContext(e)}},{key:"hideGlobalViews",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=S()(this.viewContext,{globalViews:{$apply:function(t){return t.map(function(t){return S()(t,{visible:{$set:!e.find(function(e){return t.instanceUuid===e})}})})}}});this.handleChangeViewContext(t)}},{key:"updatePlayContext",value:function(e){if(e.savedValues!==this.playContext.savedValues){var t=l.a.uuid,n=l.a.uid;D.localStorageSetItem("".concat(t,"savedValues").concat(n),JSON.stringify(e.savedValues))}this.playContext=e}},{key:"loadAssetsByContext",value:function(e){var t=this,n=e.commands,r=e.cmdIndex,a=e.plots,i=e.plotIndex,o=e.commandState,u=[];o&&u.push.apply(u,Object(k.a)(tt.getCommandState(o)));var s=n?tt.needLoadByCommands(n.slice(r,r+20)):tt.needLoadByPlot(a[i]),c=tt.getUsing(),l=[];return[].concat(u,Object(k.a)(s),Object(k.a)(c)).forEach(function(e){var t=e.type,n=e.url,r=l.findIndex(function(e){return e.url===n});~r?l[r].count++:l.push({type:t,url:n,count:1})}),l.every(function(e){var t=e.type,n=e.url,r=e.count;return tt.inCache(t,n)&&tt.isSafeRef(t,n,r)})?Promise.resolve():tt.getPreload(O({},e,{stack:this.playContext.stack})).then(function(e){return t.loadAssets(e)})}},{key:"play",value:function(e,t,n){var r=this;this.resetPlayCount();var a=function(e){var t=e.commands,n=e.plots,r=e.plotIndex;return!t&&n[r]&&n[r].commands?S()(e,{commands:{$set:n[r].commands},cmdIndex:{$set:0}}):e},i=function(e){var t=e||{},n=t.chapter,r=t.plots,a=t.plotIndex;return!(!n.md5||n.plots!==r||0!==a)||e&&r&&r[a]},o=e=a(e),u=o.commands,s=o.plots,c=o.plotIndex,l=o.chapter,d=o.commandState;this.context=e;var h=!!u,f=this.scene,p=Promise.resolve();if(this.targetScene&&this.targetScene.clear(),this.hideBackground(),h){if(f=this.commandScene,this.clearPlotViews(),this.showGlobalViews(),d){var v=d.plotViews,m=void 0===v?[]:v,g=d.calledViews,y=void 0===g?[]:g,_=d.hideGlobalViews,w=void 0===_?[]:_;this.handleChangeViewContext(S()(this.viewContext,{plotViews:{$set:m},calledViews:{$set:y},globalViews:{$apply:function(e){return e.map(function(e){return S()(e,{visible:{$set:!w.find(function(t){return t===e.instanceUuid})}})})}}})),p=f.setState(d,t)}}else{var b=s[c],x=b.hideGlobalViews,C=void 0===x?[]:x,E=b.values,I=void 0===E?[]:E,M=b.views,T=void 0===M?[]:M,V=b.animations,j=void 0===V?[]:V,U=b.autoSaveOrLoad;if(j.some(function(e){var t=e.type;return"fadein"===t||"coverblack"===t})&&this.background&&(this.background.visible=!0),this.hidePlotViews(),f.renderBackground(b),!t){if(this.json.default_settings.autoSaveOrLoad&&U&&1===U.type)return this.autoLoadRecord().then(null,function(){return A.a.warn("Sorry~读不到存档内容，即将返回封面；点击确定后返回封面，点击取消后留在当前剧情。").then(function(){return r.start()})});this.clearPlotViews(),this.hideGlobalViews(C),p=Bt.updatePayValues(this.playContext,I).then(function(e){return r.updatePlayContext(ke.setContextByValueHandles(e,I)),r.pushPlayback(b),Bt.uploadPayValues(r.playContext,I).then(function(){if(T.length){var e=r.playContext,t=r.json,n=r.handleShare,a=r.viewContext,i=T.map(function(n){return Lt.instanceView(n,t,e)}),o={playContext:e,viewContext:O({},a,{plotViews:i,calledViews:[]}),game:t,handleShare:n};return Lt.runOnLoadEvent(["plotViews",null],o).then(function(e){return r.handleChangeContext(e)})}})})}}var D=this.game.world;this.targetScene?D.replace(this.targetScene.container,f.container):D.add(f.container),this.targetScene=f,D.add(this.groups),this.playContext.openPages[0]!==jn.scene&&this.targetScene.pause(),p.then(function(){return f.play(O({},e,{load:t,restore:n}),r.runCommandAfter)}).then(function(t){var n,o=t.type,u=t.control,d=r.commandScene.getBubbleState(),f=d.bubbleMode,p=d.bubbleCount;r.playContext=S()(r.playContext,{bubbleMode:{$set:f},bubbleCount:{$set:p}});var v=s[c];tt.resetPlotAfter(v);var m=function(){return r.playContext=S()(r.playContext,{stack:{$set:[]}})},g=function(e){return r.playContext=S()(r.playContext,{stack:{$set:[e].concat(Object(k.a)(r.playContext.stack))}})};switch(o){case"back":e=null,m();break;case"jump":var y=ve.getChapterByUUID(r.json,u.uuid);e=y?{chapter:y,plots:y.plots,plotIndex:0}:null,m();break;case"jumpOption":case"backOption":var _=parseInt(u.value)>0?u.value:0,w=r.playContext.stack.takeWhile(function(e){return"condition_option"===e.type||"option"===e.type}).length;_>0&&w&&(w>_?(e=r.playContext.stack[_-1],r.playContext=S()(r.playContext,{stack:{$splice:[[0,_]]}})):(e=r.playContext.stack[w-1],r.playContext=S()(r.playContext,{stack:{$splice:[[0,w]]}})),e.loop&&(e=e.loop.breakNext),"backOption"===o&&(e=S()(e,{plotIndex:{$apply:function(e){return e-1}},commands:{$set:null}})));break;case"option":case"condition_option":tt.resetPlotOption(v,"".concat(o,"s"),u.index);var b=v["".concat(o,"s")][u.index];if(e=O({},e,{plotIndex:c+1,commands:null}),b&&b.plots&&b.plots.length)if("loop"===b.type||"countLoop"===b.type){var x={chapter:l,plots:b.plots,plotIndex:0};g(O({},x,{loop:{count:1,countExpr:b.count,condition:b.expression,breakNext:e},type:o})),e=x}else g(O({},e,{type:o})),e={chapter:l,plots:b.plots,plotIndex:0};break;case"insert":case"insertPlot":o="insertPlot";var C=u.from,E=void 0===C?"view":C;if(v.back&&(e=null,m()),v.insert){var I=ve.getChapterByUUID(r.json,v.insert);I?(e&&g(O({},e,{type:o})),e={chapter:I,plots:I.plots,plotIndex:0}):e=null}if("view"===E){var A=ve.getChapterByUUID(r.json,u.uuid);if(A){if(h){var M=r.viewContext,T=M.plotViews,V=M.calledViews,j=r.targetScene.getState();e=O({},e=r.targetScene.context,{cmdIndex:e.cmdIndex+1,commandState:O({plotViews:T,calledViews:V},j)})}e&&g(O({},e,{type:o})),e={chapter:A,plots:A.plots,plotIndex:0}}else e=null}break;default:P(n={plots:s,plotIndex:c,chapter:l},"plotIndex",c+1),P(n,"commands",null),e=n}if(!e)return r.start(!0);i(e)||(e=r.getContextInStack()),e&&i(e)?(e&&l.uuid!==e.chapter.uuid&&tt.resetInsertAfter(l,e.chapter),r.getChapterData(e.chapter).then(function(){"insertPlot"===o&&tt.resetInsert(e.chapter),"jump"===o&&tt.resetJump(e.chapter),("condition_option"!==o||"option"!==o)&&tt.resetPlotOption(v),e=a(e),r.loadAssetsByContext(e).then(function(){r.handleChangeViewContext(S()(r.viewContext,{menuViews:{$set:[]},menuCalledViews:{$set:[]}})),r.play(e)},function(e){return console.warn(e)})},function(){if(h){var t=r.viewContext,n=t.plotViews,i=t.calledViews,s=r.targetScene.getState();e=O({},e=r.targetScene.context,{commandState:O({plotViews:n,calledViews:i},s)})}else e=r.context;if("insertPlot"===o){var c=function(){return r.playContext=S()(r.playContext,{stack:{$set:r.playContext.stack.slice(1)}})},l=function(e,t){var n=r.playContext.stack;return n[0]&&n[0].type===e&&n[0].chapter.uuid===t},d=u.from;"view"===(void 0===d?"view":d)&&l("insertPlot",u.uuid)&&c(),v.insert&&l("insertPlot",v.insert)&&c(),v.jump&&l("jump",v.jump)&&c()}e=a(e),r.loadAssetsByContext(e).then(function(){r.handleChangeViewContext(S()(r.viewContext,{menuViews:{$set:[]},menuCalledViews:{$set:[]}})),r.play(e,!0,!0)},function(e){return console.warn(e)})})):r.handleOver()},function(e){return console.warn(e)})}},{key:"getContextInStack",value:function(){for(var e=this,t=function(t){return e.playContext=S()(e.playContext,{stack:{$set:[t].concat(Object(k.a)(e.playContext.stack))}})};this.playContext&&this.playContext.stack&&0<this.playContext.stack.length;){var n=this.playContext.stack[0],r=n.chapter,a=n.plotIndex,i=n.plots,o=n.type,u=n.loop;if(u){var s=u.condition,c=u.countExpr,l=u.count,d=u.breakNext;if(ke.safeEval(s,this.playContext)){if(!c)return{chapter:r,plotIndex:a,plots:i};this.playContext=S()(this.playContext,{stack:{0:{loop:{count:{$set:l+1}}}}});var h=parseInt(ke.safeEval(c,this.playContext),10);if(l<(h=h>=1?h:1))return{chapter:r,plotIndex:a,plots:i}}r=d.chapter,a=d.plotIndex,i=d.plots}else if("insertPlot"===o){var f=n.commands,p=n.cmdIndex,v=n.commandState;if(v){var m=v.bubbleMode;if(m.length>0)for(var g=function(e){var t=m[e],n=[];t.bubble.forEach(function(e){e.args&&n.push(O({},e.args[0]))}),t.bubble=n},y=0;y<m.length;y++)g(y)}if(this.playContext=S()(this.playContext,{stack:{$set:this.playContext.stack.slice(1)}}),f)return{chapter:r,plotIndex:a,plots:i,commands:f,cmdIndex:p,commandState:v};var _=i[a],w=(_&&_.condition_options||[]).findIndex(function(t){return ke.safeEval(t.expression,e.playContext)});if(w>=0){var b=_.condition_options[w],x={chapter:r,plots:i,plotIndex:a+1};if(b&&b.plots&&b.plots.length)if("loop"===b.type||"countLoop"===b.type){var P={chapter:r,plots:b.plots,plotIndex:0};t(O({},P,{loop:{count:1,countExpr:b.count,condition:b.expression,breakNext:x},type:"condition_option"})),x=P}else t(O({},x,{type:"condition_option"})),x={chapter:r,plots:b.plots,plotIndex:0};return x}if(_.jump){var C=ve.getChapterByUUID(this.json,_.jump);if(C)return this.playContext=S()(this.playContext,{stack:{$set:[]}}),{chapter:C,plots:C.plots,plotIndex:0}}if(i[a+1])return{chapter:r,plots:i,plotIndex:a+1};continue}if(this.playContext=S()(this.playContext,{stack:{$set:this.playContext.stack.slice(1)}}),"jump"===o||i[a])return{chapter:r,plotIndex:a,plots:i}}return null}},{key:"handleOver",value:function(){var e=this;this.holdFastPlayTip&&this.holdFastPlayTip.destroy();var t=this.inputs,n=t.diyMainMenu,r=t.views,a=this.holdFastPlayTip;a&&a.destroy(),[].concat(Object(k.a)(n),Object(k.a)(r)).forEach(function(e){return e.show(!1)}),this.playContext.openPages.unshift(jn.diyMainMenu),u.c.timeout(50).then(function(){e.state.plotSnap=u.c.getSnap();var t=e.game.world,n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(pn?pn.update(e):pn=new vn(e)).container}({callbacks:{back:function(){e.state.plotSnap=null,e.start(!0)},load:function(){return r(jn.loadRecord)},save:function(){return r(jn.saveRecord)}}}),r=function(r){n.visible=!1,t.remove(n,!1),e.showSystemUI(r,function(){return n.visible=t.add(n)})};t.add(n)})}},{key:"clearRecords",value:function(){var e=l.a.uid,t=this.records,n=this.json.default_settings.autoSaveOrLoad;if(t.owner!==e){""!==e&&""!=t.owner&&u.c.preUid!=t.owner&&u.c.preUid!=e&&(u.c.preUid=t.owner);var r=this.getSavedRecords(!0),a=r.records,i=r.owner;this.records={local:a,owner:i,cloud:new Array(12).fill(null)},n&&(this.records.local[0]=t.local[0])}}},{key:"saveRecord",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var a=l.a.uuid,i=l.a.uid,o=l.a.client,s=l.a.isWapOther,c=l.a.wap,d=s&&"mk"==c&&this.game.device.iOS;if("pc"===o&&""!=u.c.preUid&&i!=u.c.preUid&&(""!==this.records.owner&&(this.records.owner!=i||this.records.owner!=u.c.preUid)||""==this.records.owner&&this.records.owner!=u.c.preUid))return A.a.error("无法存读档，请登录正确的帐号后重新尝试！").then(function(){return""===i?D.login():null},function(){}),Promise.reject();i!==this.records.owner&&this.clearRecords();var h=this.playContext,f=this.context,p=this.json,v=this.viewContext;if(0===e&&p.default_settings.autoSaveOrLoad&&!r)return Promise.resolve();var m=this.targetScene===this.commandScene,g=v.plotViews,y=v.calledViews,_=Ee.to({context:m?this.commandScene.context:f,playContext:h,viewContext:v,game:p,background:this.background&&this.background.info||{},plotSnap:this.state.plotSnap,commandState:m?O({plotViews:g,calledViews:y},this.commandScene.getState()):null});return t?(this.records.local[e]=_,a&&D.localStorageSetItem(d?"".concat(a).concat(i,"record"):"".concat(a).concat(i),JSON.stringify(this.records.local)),Promise.resolve()):function(e,t){Le={time:null,requestPromise:null};var n=l.a.client,r=l.a.u,a=l.a.v,i=l.a.token,o=l.a.app_name,s=l.a.device_name,c=l.a.deviceOsVer,d=l.a.gid,h=l.a.app_version,f=function(e,t){return Object(we.c)({url:e,data:t}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.resolve({code:we.a.ERROR,message:"Get saveRecord failed, no response data"});var n=JSON.parse(t),r=n.status,a=n.msg;return 0===r?void 0:Promise.reject("".concat(a,"- status:").concat(r))})},p=r&&i?1:0,v="";t.hasOwnProperty("thumb")&&(v=JSON.parse(JSON.stringify(t.thumb)).split(",")[1],delete t.thumb);var m=u.c.encodeBase64(JSON.stringify(t)),g=u.a.getCurDate(),y=""===d?1:parseInt(d),_="",w=e+"";_=p?"app_name=".concat(o||"shanyi","&content=").concat(m,"&cover_content=").concat(v,"&device_name=").concat(s||"Google Nexus S","&device_system_version=").concat(c||"4.1.1")+"&gid=".concat(y,"&progress=1&time=").concat(g,"&token=").concat(i,"&type=").concat(w,"&u=").concat(r,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"):"content=".concat(m,"&cover_content=").concat(v,"&gid=").concat(y,"&progress=1&time=").concat(g,"&type=").concat(w,"&v_key=0GjRAtUUoK4BwJGUz73jBa2M");var b="content=".concat(Ae(m,p),"&gid=").concat(Ae(y,p),"&progress=").concat(Ae(1,p))+"&sign=".concat(Ae(ge.a.hash(ge.a.hash(_)),p),"&time=").concat(Ae(g,p),"&type=").concat(Ae(w,p),"&cover_content=").concat(Ae(v,p));return r&&i?f("".concat(Ie.appSaveRecord,"&client=").concat(n,"&v=").concat(a,"&app_version=").concat(h),"".concat(b,"&").concat(ze())):f(Ie.wapSaveRecord,b)}(e,_).then(function(){return n.records.cloud[e]=_},function(e){return A.a.error("存档异常：".concat(e))})}catch(e){return console.error(e),Promise.reject()}}},{key:"loadRecord",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.playContext,i=this.viewContext,o=this.records.local,s=this.json,c=this.game.world,d=s.motionImgMap,h=a.openPages,f=xt.fullScreenTip({text:"加载存档中...",alpha:.5});c.add(f);return function n(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t||a?o[e]?Promise.resolve(JSON.parse(JSON.stringify(o[e]))):(c.remove(f,!0),Promise.reject()):We(e).then(function(e){return(e=e?JSON.parse(e):null)||(r?n(!0):(c.remove(f,!0),A.a.error("存档信息获取错误"),Promise.reject()))},function(e){var t=e.msg;return 999==e.status?A.a.error("网络异常，请检查您的网络！"):A.a.error(t),c.remove(f,!0),Promise.reject()})}().then(function(e){return function(e){var t={},r=Ee.getChapterUuids(e);f.visible=!1;return function e(a,i){if(i>=r.length)return f.visible=!0,Promise.resolve();var o=ve.getChapterByUUID(s,a);return o?n.getChapterData(o).then(function(){return e(r[++i],i)},function(){return o.charge?t.chargeError=!0:t.loadError=!0,e(r[++i],i)}):(t.disappear=!0,e(r[++i],i))}(r[0],0).then(function(){return t.chargeError?(c.remove(f,!0),Promise.reject()):t.loadError?(c.remove(f,!0),A.a.error("存档章节加载错误"),Promise.reject()):t.disappear?(c.remove(f,!0),A.a.error("该剧情已被作者删除啦！\r\n无法从该剧情继续哦~"),Promise.reject()):e})}(e)}).then(function(e){if("98865"==l.a.gid&&"d9892b31-c3a8-4d63-82b4-1b22d6223b4e"==e.chapterUuid&&"0e95a10d-5e45-47ee-9282-fa28f7098fc9"==e.plotUuid&&(e.plotUuid="03e37f5d-5487-41fb-8f9f-e92569eaab77"),!(e=Ee.format(e,s)))return c.remove(f,!0),Promise.reject();var t=e,r=t.speakings,o=t.musics,p=void 0===o?[]:o,v=t.sounds,m=t.backgroundObject,g=void 0===m?{}:m,y=t.commandUuid,_=e.values,w=_.values,b=_.savedValues,x=_.stringValues,P=_.indexValues,C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={};return t.forEach(function(e){return n[e.uuid]=void 0!==e.value?e.value:ke.safeInitValue(e)}),e.map(function(e){var t=e.uuid;return void 0!==n[t]?S()(e,{value:{$set:n[t]}}):e})};a=S()(a,{playback:{$set:r},values:{$apply:function(e){return C(e,w)}},savedValues:{$apply:function(e){return C(e,b)}},stringValues:{$apply:function(e){return C(e,x)}},indexValues:{$apply:function(e){return C(e,P)}}});var E=Ee.restore(e,s,a),I=E.stack,A=E.plotViews,M=E.globalViews,T=E.context;if(!T)return c.remove(f,!0),Promise.reject();var V=T.bubbleMode,j=void 0===V?[]:V,U=T.bubbleCount,D=void 0===U?[]:U;a=S()(a,{stack:{$set:I},openPages:{$set:[jn.scene]},bubbleMode:{$set:j},bubbleCount:{$set:D}}),i=S()(i,{plotViews:{$set:A},calledViews:{$set:[]},globalViews:{$set:M},globalCalledViews:{$set:[]},menuViews:{$set:[]},menuCalledViews:{$set:[]}});var R=[],B=function(e,t){if(e&&u.c.isString(e)&&"inherit"!==e)R.push({type:t,url:e});else if(u.c.isObject(e)){if(!d||!e.uuid||!d[e.uuid])return;var n=d[e.uuid].images;(void 0===n?[]:n).forEach(function(e){var n=e.url;return R.push({type:t,url:n})})}};tt.clearPreload(),tt.getUsing().forEach(function(e){var t=e.type,n=e.url;return B(n,t)}),B(g.url,"image"),p[0]&&B(p[0].url,"audio"),v.forEach(function(e){return e&&B(e.url,"audio")}),n.commandScene&&n.commandScene.clear(!0);var L=Promise.resolve();return y?T.commandState&&R.push.apply(R,Object(k.a)(tt.getCommandState(T.commandState))):(R.push.apply(R,Object(k.a)(tt.getCommandState({bubbleMode:j}))),L=n.commandScene&&n.commandScene.setBubbleState(j,D)),c.remove(f,!0),u.c.preUid=n.records.owner,L.then(function(){return tt.getPreload(O({},T,{stack:n.playContext.stack})).then(function(e){return n.loadAssets([].concat(R,Object(k.a)(e)))}).then(function(){setTimeout(function(){n.playContext=a,n.handleChangeViewContext(i),n.setBackground(g),$n=!0,n.menus.visible=!0,n.state.plotSnap=null,n.space.removeAll(!0),n.menuViews.removeAll(!0),n.menuCalledViews.removeAll(!0),n.targetScene&&n.targetScene.proceed(),n.targetScene&&(n.targetScene.timeline={}),R.forEach(function(e){var t=e.type,n=e.url;return tt.addRef(t,n)});var e=n.inputs,t=e.diyMainMenu,r=e.views;([].concat(Object(k.a)(t),Object(k.a)(r)).forEach(function(e){return e.show(!0)}),ae.playMusic(p[0]||{}),ae.stopAllSound(),v.forEach(function(e,t){return e&&e.url?ae.playSound(O({},e,{channel:e.index||t})):ae.stopSound(t)}),tt.clearUselessRef(),h.some(function(e){return e===jn.cover})&&n.coverView&&n.coverView.close(),T.commands)&&("systemUI"===(T.commands[T.cmdIndex]||{}).type&&T.cmdIndex++);Bt.updatePayValues(n.playContext,[],!0).then(function(e){n.playContext=S()(n.playContext,{payValues:{$set:e.payValues}}),n.play(T,!0)})},0)},function(e){return console.warn(e)})})})}},{key:"showSystemUI",value:function(e,t){var n=this,r=this.playContext,a=r.openPages,i=r.playback,o=[jn.cover,jn.scene,jn.diyMainMenu];if(a.length&&o.some(function(e){return e===a[0]})){a[0]!==jn.diyMainMenu&&(this.state.plotSnap=u.c.getSnap()),this.targetScene&&this.targetScene.pause();var s=this.inputs,c=s.diyMainMenu,l=s.views,d=this.json.template,h=this.game.world;[].concat(Object(k.a)(c),Object(k.a)(l)).forEach(function(e){return e.show(!1)});var f=function(){a.shift(),o.some(function(e){return e===a[0]})?(a[0]!==jn.diyMainMenu?(n.targetScene&&n.targetScene.proceed(),[].concat(Object(k.a)(c),Object(k.a)(l)).forEach(function(e){return e.show(!0)})):c.forEach(function(e){return e.show(!0)}),t&&t()):v(a[0])},p=function(e){a.unshift(e),v(e)},v=function e(t){switch(t){case jn.settings:return void h.add(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(Gt?Gt.update(e):Gt=new nn(e)).container}({template:d,callback:f}));case jn.playback:return h.add(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(on?on.update(e):on=new un(e)).container}({template:d,callback:f,records:i,isload:$n})),void($n=!1);case jn.loadRecord:case jn.saveRecord:return n.canOpenRecord(jn.loadRecord)?void h.add(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(hn?hn.update(e):hn=new fn(e)).container}({mode:t===jn.loadRecord?"load":"save",gameJson:n.json,callback:f,getLocal:n.getLocalRecords,getCloud:n.getCloudRecords,clickRecord:n.handleclickRecord,lockRecord:n.getlockRecord,getPlayContext:function(){return n.playContext}})):(f(),void Mt({type:At,text:"抱歉，作者在此设置了禁用".concat(t===jn.loadRecord?"读":"存","档")}));case jn.mainMenu:var r=function(t){n.canOpenRecord(t)?p(t):(e(jn.mainMenu),Mt({type:At,text:"抱歉，作者在此设置了禁用".concat(t===jn.loadRecord?"读":"存","档")}))};return void h.add(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(rn?rn.update(e):rn=new an(e)).container}({template:d,callbacks:{load:function(){return r(jn.loadRecord)},save:function(){return r(jn.saveRecord)},playback:function(){return p(jn.playback)},settings:function(){return p(jn.settings)},autoplay:function(){n.targetScene&&n.targetScene.dispatchContinueClick(),f()},back:f}}))}};p(e)}}},{key:"handleChangeViewContext",value:function(e){var t=this;if(e!==this.viewContext){var n=this.viewContext;this.viewContext=e,Object.keys(n).forEach(function(r){if(e[r]!==n[r]){var a=t[r].children,i=e[r];Lt.updateViews({nodes:a,viewDatas:i,parent:t[r],path:[r,null],onMount:t.handleViewMount,onUpdate:t.handleViewUpdate})}})}}},{key:"canOpenRecord",value:function(e){var t=e===jn.loadRecord?"load":"save",n=this.playContext.openPages,r=this.context;if(n[n.length-1]===jn.cover)return!0;var a=r.commands,i=r.plots,o=r.plotIndex;if(a){var u=this.targetScene.getState().disableSaveOrLoad;if(u&&u.args[0][t])return!1}else{var s=i[o];if(s.disableSaveOrLoad&&s.disableSaveOrLoad[t])return!1}return!0}},{key:"handleChangeContext",value:function(e){var t=this,n=e.viewContext,r=e.openPages,a=void 0===r?[]:r,i=e.closePages,o=void 0===i?[]:i,u=e.controlAudio,s=void 0===u?{}:u,c=e.controlPlay,l=e.playContext;l!==this.playContext&&this.updatePlayContext(l);var d=this.playContext.openPages;(o&&o[0]===jn.diyMainMenu&&(d[0]===jn.diyMainMenu||d[0]!==jn.diyMainMenu)||d[0]===jn.diyMainMenu&&c)&&(this.inputs.views.forEach(function(e){return e.show(!0)}),this.menus.visible=!0,this.state.plotSnap=null,this.space.removeAll(!0),this.menuViews.removeAll(!0),this.menuCalledViews.removeAll(!0),d[0]===jn.diyMainMenu&&this.playContext.openPages.shift(),n=S()(n,{menuViews:{$set:[]},menuCalledViews:{$set:[]}}),this.targetScene&&this.targetScene.proceed());if(a.length&&(a=a.map(function(e){switch(e){case"settings":return jn.settings;case"playback":return jn.playback;case"save-record":return jn.saveRecord;case"load-record":return jn.loadRecord}})).length){var h=a[0],f=!0;if(h!==jn.loadRecord&&h!==jn.saveRecord||!(f=this.canOpenRecord(h))&&Mt({type:At,text:"抱歉，作者在此设置了禁用".concat(h===jn.loadRecord?"读":"存","档")}),f){var p=function(e){return Un.slice(5).forEach(function(n){return t[n].visible=e})};p(!1),this.showSystemUI(h,function(){return p(!0)})}}if(this.handleChangeViewContext(n),s.stopSound)for(var v=0;v<10;v++)ae.stopSound(v);else s.updateSounds&&s.sounds.forEach(function(e,t){e&&"inherit"!==e.url?ae.playSound(O({},e,{loop:!e.time,channel:t})):e||ae.stopSound(t)});if(s.music?ae.playMusic(s.music):s.stopMusic&&ae.stopMusic(),c&&this.targetScene&&this.targetScene.controlPlay){var m=c.type;if(this.targetScene===this.commandScene)return void this.targetScene.controlPlay(c);if("jumpOption"===m||"backOption"===m)this.playContext.stack.takeWhile(function(e){return"condition_option"===e.type||"option"===e.type}).length&&this.targetScene.controlPlay(c);else this.targetScene.controlPlay(c)}}},{key:"showLogo",value:function(){var e=this.game,t=e.world,n=e.cache;if(l.a.single)return Promise.resolve();var r=this.json.logo,a=(void 0===r?{}:r).background;if(!a||a.hidden||!a.url||!n.checkImageKey(a.url))return Promise.resolve();var i=a.flex,o=a.opacity,s=a.url,c=a.x,d=void 0===c?0:c,h=a.y,f=void 0===h?0:h,p=mt.image(s,{x:d,y:f});return xt.flex(i,p,t),p.alpha=0,t.add(p),q.to({target:p,properties:{alpha:o},duration:1e3}).then(function(){return u.c.timeout(1e3)}).then(function(){return q.to({target:p,properties:{alpha:0},duration:1e3})}).then(function(){return t.remove(p,!0)})}}]),e}(),qn=function(){var e=navigator.userAgent,t=e.match(/chrome\/((([0-9]*)+(\.))*)+([0-9]*)/gi);if(t)if("Chrome/50.0.2661.86"==t[0]||"Chrome/51.0.2704.81"==t[0]){if(-1===e.indexOf("Android 6.0.1; MI 4LTE")&&-1===e.indexOf("vivo Y67"))return Phaser.AUTO}else if("Chrome/46.0.2490.76"==t[0]&&-1!==e.indexOf("OPPO R9s"))return Phaser.AUTO;return Phaser.CANVAS},Kn=function(){function e(){var t=this;Object(i.a)(this,e),P(this,"init",function(){var e=l.a.wap,n=l.a.vertical,r=l.a.client,a=l.a.istest,i=t.game,o=i.device,u=i.scale,s=i.stage,h=i.world,f=i.load,p=i.sound,v=i.cache,m=i.input,g=i.single;o.desktop&&"qh"!==e&&"pc"!==r&&!g||(u.scaleMode=Phaser.ScaleManager.SHOW_ALL),u.fullScreenTarget=document.body,u.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,a&&(u.scaleMode=Phaser.ScaleManager.SHOW_ALL),u.pageAlignVertically=!0,u.pageAlignHorizontally=!0;var y=navigator.userAgent.indexOf("UCBrowser")>-1;(o.desktop||y&&o.iOS)&&(s.disableVisibilityChange=!0);var _=document.getElementById("game"),w=function(e){var t=e.size,n=e.angle,r=e.bound;u.setGameSize(t[0],t[1]),h.angle=n,h.setBounds(r[0],r[1],r[2],r[3]),u.refresh()},b=top.location!==self.location;u.setResizeCallback(function(){"wap"===r&&game.gameResumed();var e=window.innerWidth||window.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.documentElement.clientHeight||window.document.body.clientHeight;if(b&&o.iOS&&void 0!==window.orientation){var a=90===window.orientation||-90===window.orientation;e=a?window.originalHeight:window.originalWidth,t=a?window.originalWidth:window.originalHeight,u.parentIsWindow=!0}_.style.width=e+"px",_.style.height=t+"px","pc"===r&&n||(e>t?n&&90!==h.angle?w({size:[960,540],angle:90,bound:[-960,0,540,960]}):n||0===h.angle||w({size:[960,540],angle:0,bound:[0,0,960,540]}):n&&0!==h.angle?w({size:[540,960],angle:0,bound:[0,0,540,960]}):n||90===h.angle||w({size:[540,960],angle:90,bound:[-960,0,960,540]}))}),t.game.onRestart=new Phaser.Signal,f.maxParallelDownloads=2*f.maxParallelDownloads,f.loadImageTag=d.loadImageTag,f.onSoundExtendLoad=new Phaser.Signal,f.onSoundExtendLoadError=new Phaser.Signal,f.crossOrigin="anonymous",p.decode=d.soundDecode,p.onSoundDecodeError=new Phaser.Signal,D.init(),D.setCallback("showGameNotice",function(){return Vn.show().then(function(){return D.openShanyiMenu()})});var k=function(){p.touchLocked=!1,c.fill(),v.getKeys(Phaser.Cache.SOUND).forEach(function(e){var t=v.getSound(e);t&&!c.exist(t.data)&&v.reloadSound(e)})};o.iOS?o.iOSVersion>8?m.addTouchLockCallback(k,t.game,!0):m.addTouchLockCallback(k,t.game):o.android&&!D.isAppClient()?m.addTouchLockCallback(k,t.game,!0):k(),tt.cache=v,tt.loader=f,window.AssetManager=tt,game.destroyComponent.add(function(e){return tt.subRef("image",e,"play")})}),P(this,"create",function(){var e=t.game,n=e.canvas,r=e.width,a=e.height,i=e.world,o=e.input.onDown,s=(l.a.client,l.a.wap),c=l.a.singleoffline;n.oncontextmenu=function(e){return e.preventDefault()},i.add(mt.rectMask({color:6476757,rect:{width:r,height:a}})),o.add(function(){return t.game.gameResumed()});var d=null,h=null,f=null;Te().then(function(e){return u.a.startlocal(e)});var p=function(){return Je().then(function(e){return f=e,t.loadAssets(e)}).then(function(){return t.loadGameJson()}).then(function(e){return(d=e)&&t.getGameAssets(e)}).then(function(){return t.handleOtherActions(d).then(function(e){return h=e})}).then(function(){return t.loadGameAssets(f)}).then(function(){return t.showGuide()}).then(function(){return t.clear()}).then(function(){return new Hn(t.game,d,h)}).catch(function(e){l.a.client?A.a.warn("".concat(e,"，关闭播放器吗？")).then(function(){return window.location.href="lzj3000://quit"}):A.a.warn("".concat(e,"，返回闪艺首页吗？")).then(function(){return window.location.href="http:\\\\www.3000.com"})})};s?"qh"==s?(M.c.sendQHData(),M.c.initQHSdk().then(function(e){0==e.code?p():A.a.warn("群黑平台游戏初始化失败，请刷新重试！").then(function(){return window.location.reload()},null)})):"qzone"==s?M.d.getUserIpInfo().then(function(){return M.d.postUserInfoQzone(1)}).then(function(){return M.d.getShareCountQzone()}).then(function(){return p()},function(e){return A.a.warn("游戏初始化失败，请刷新重试！").then(function(){return window.location.reload()})}):"wx"==s?M.e.initWx().then(function(e){return p()}):"mk"==s?M.b.initMkbySy(1).then(function(e){return p()}):p():c&&"4399"==s?M.a.init4399Api().then(function(){return p()}):p()}),window.AudioContext=null,window.webkitAudioContext=null;var n=l.a.vertical?[540,960]:[960,540],r=Object(x.a)(n,2),a=r[0],o=r[1];window.game=this.game=new Phaser.Game({width:a,height:o,parent:"game",renderer:qn(),state:{init:this.init,create:this.create},mspointer:!1,enableDebug:!1,mouseWheel:void 0!==window.onwheel}),window.game.preserveDrawingBuffer=!0}return Object(o.a)(e,[{key:"loadAssets",value:function(e){var t=l.a.offline,n=l.a.vertical,r=l.a.client,a=l.a.wap,i=l.a.single,o=l.a.singleoffline,s=this.game,c=s.load,d=s.world,h=D.localStorageGetItem("shanyi3000guide")||"",f=""==h?null:JSON.parse(h);if(e){var p=e.pic_url;p&&c.image("adpicurl",p.replace("http://","//"))}if(c.image("icon_back","./img/icon_back.png"),c.image("icon_back_over_pressed","./img/icon_back_over_pressed.png"),c.image("icon_candy","./img/icon_candy.png"),c.image("icon_candy_over_pressed","./img/icon_candy_over_pressed.png"),c.image("icon_get","./img/icon_get.png"),c.image("icon_get_hover_pressed","./img/icon_get_hover_pressed.png"),c.image("icon_save","./img/icon_save.png"),c.image("icon_save_over_pressed","./img/icon_save_over_pressed.png"),c.image("cloud","./img/cloud.png"),c.image("cloud_hover","./img/cloud_hover.png"),c.image("local","./img/local.png"),c.image("local_hover","./img/local_hover.png"),c.image("icon_success","./img/icon_success.png"),c.image("icon_error","./img/icon_error.png"),c.image("light","./img/light.png"),c.image("toast_loading","./img/toast_loading.gif"),c.image("app_button_speed","./img/app_button_speed.png"),c.image("app_icon_speed","./img/app_icon_speed.png"),c.image("lock","./img/lock.png"),i?(c.image("singlebg",n?"./img/single/singlebg_1.png":"./img/single/singlebg.png"),c.image("continue","./img/single/continue.png"),c.image("menumore","./img/single/more.png"),c.image("menumore_hover","./img/single/more_hover.png"),f=null):(c.image("serch",n?"./img/serch_1.png":"./img/serch.png"),c.image("slogan","./img/slogan.png"),c.image("logo_preloader","./img/logo_preloader.png"),c.image("loading_gif","./img/loading_gif.gif")),"pc"==r&&c.image("qrcode","./img/qrcode.png"),("wap"===r||i)&&c.image("wapback","./img/wapback.png"),!n&&c.spritesheet("wind","./img/wind.png",960,540),"qzone"===a&&(c.image("help","./img/qzone/help.png"),c.image("invite","./img/qzone/invite.png"),c.image("share","./img/qzone/share.png")),c.image("packup","./img/pc/packup.png"),c.image("packup-hover","./img/pc/packup-hover.png"),c.image("packdown","./img/pc/packdown.png"),c.image("packdown-hover","./img/pc/packdown-hover.png"),!f&&c.image("Operation_tip",n?i&&!o?"./img/Operation_tip_1_single.jpg":"./img/Operation_tip_1.jpg":i&&!o?"./img/Operation_tip_single.png":"./img/Operation_tip.png"),(!f||f&&f.count<10)&&c.image("Cloud_record_tip",n?"./img/Cloud_record_tip_1.png":"./img/Cloud_record_tip.png"),t){var v=["rainy","snowy","defoliation","fallingPeach","fallingFlower","lightning"];n&&v.push("windy"),v.forEach(function(e){return u.c.getWeatherUrls(e).forEach(function(e){return c.image(e,e)})})}return new Promise(function(e,t){var a=d.height,o=d.width,u=null,s=null,l="pc"===r&&n,h=mt.text({x:n?o/2:18,y:a-(l?280:n?102:30)},{fontSize:"pc"===r?n?22:14:16,forceFontFamily:"pc"===r?"微软雅黑":"宋体",color:"#fff",boundsAlignH:n?"center":""});c.onLoadStart.addOnce(function(){return d.add(h)}),c.onFileComplete.add(function(e,t,n,r,c){i?"singlebg"===t&&(s=mt.image(t,{x:o/2,y:a/2,centre:!0}),d.add(s)):"logo_preloader"===t&&(u=mt.image(t,{x:o/2,y:a/2,centre:!0}),d.add(u)),tt.addRef("image",t,"global"),h.text="正在准备播放.. "+e+"%"}),c.onLoadComplete.addOnce(function(){c.onFileComplete.removeAll(),h.text="正在准备播放..【成功】",u&&(u.x=n?30+u.width/2:o-u.width/2-50,u.y=n?26+u.height/2:a-u.height/2-52);var t=mt.image("serch",{centre:!0});t.x=o/2,t.y=n?150+t.height/2:t.height/2+28,d.add(t);var r=mt.image("loading_gif",{centre:!0,name:"loadingGif",width:n?188:190,height:n?188:190});r.x=o/2,r.y=t.y+t.height/2+r.height/2+(n?40:34),d.add(r);var i=mt.image("slogan",{centre:!0,name:"loadingSlogan"});if(i.x=o/2,i.y=r.y+r.height/2+10+i.height/2,d.add(i),l){var s=mt.rectMask({y:a-170,color:16777215,rect:{width:o,height:170}});d.add(s);var f=mt.image("qrcode",{centre:!0});f.x=150,f.y=a-150+f.height/2,d.add(f);var p=mt.text({x:150+f.width/2+16,y:f.y-30},{fontSize:22,text:"快来下载闪艺APP",forceFontFamily:"微软雅黑",color:"#333333"});d.add(p);var v=mt.text({x:150+f.width/2+16,y:f.y+7},{fontSize:22,text:"感受更好的竖版体验吧~",forceFontFamily:"微软雅黑",color:"#333333"});d.add(v)}return e()}),c.start()})}},{key:"loadGameJson",value:function(){var e=this.game.world,t=e.width,n=e.height,r=l.a.type,a=l.a.isWapOther,i=l.a.client,o=l.a.vertical,s=l.a.istest,c=l.a.pwd,d=l.a.uuid,h="pc"===i&&o,f=mt.text({x:o?t/2:18,y:n-(h?312:o?122:50)},{fontSize:"pc"===i?o?22:14:16,forceFontFamily:"pc"===i?"微软雅黑":"宋体",color:"#fff",text:"加载用户配置..",boundsAlignH:o?"center":""});e.add(f);var p=function(e){if(e.lengthComputable){var t=e.loaded/e.total;f.text="加载用户配置.. ".concat(~~t,"%")}else f.text="加载用户配置.. ".concat(e.loaded)},v=function(e){if(f.text="加载用户配置..【成功】",0===Object.keys(e).length)return Promise.reject("链接已过期");tt.gameJson=ot.gameJson=ut.gameJson=e;var t=e.default_settings.records,n=void 0===t?[]:t;return $.records=n,ve.fix(e)},m=37==d.length&&2==d.charAt(d.length-1);return m&&(l.a.uuid=d=d.substr(0,d.length-1)),1==r||s?(s&&(m=!0),new Promise(function(r,a){De(d,"&test=".concat(!m,"&pwd=").concat(c),p).then(function(e){return r(v(e))},function(){var a=mt.group(),o=mt.rectMask({alpha:.5,rect:{width:t,height:n}});o.inputEnabled=!0,a.add(o);var s=(t-200-60)/2,c=(n-120)/2,l=new St({game:game,x:s,y:c,width:200,height:30,text:"",color:"#999999",fontSize:24,fontFamily:"宋体"}),h=l.element;h.className="preview-code-input",h.placeholder="请输入预览码",a.add(l);var f={x:s+200+10,y:c,width:60,height:30},g=mt.rectMask({alpha:1,color:1822168,rect:f});g.inputEnabled=!0;var y=function(e){h.className="preview-code-error-input",_.visible=!1,w.visible=!0,b.setText(e),"很抱歉，预览码已过期~"!==e&&"很抱歉，预览码输入错误，请重新输入"!==e&&"pc"===i&&D.urlExpire()};g.events.onInputUp.add(function(t,n){n&&n.pointerMode===Phaser.PointerMode.CURSOR&&0!==n.button||(h.value?De(d,"&test=".concat(!m,"&pwd=").concat(h.value),p).then(function(t){D.localStorageSetItem("SYConformTime".concat(d),u.c.aesEncrypt(u.a.getCurDate(),1)),e.remove(a,!0),r(v(t))},function(e){return y(e)}):y("您还未输入预览码"))}),a.add(g),a.add(mt.text(f,{fontSize:20,forceFontFamily:"宋体",color:"#fff",text:"确定",boundsAlignH:"center",boundsAlignV:"middle",align:"center"})),c=f.y+30+5;var _=mt.textarea({x:s,y:c,width:270,height:60},{fontSize:14,forceFontFamily:"宋体",color:"#fff"});_.setTexts([{data:"作者还未正式发布，请填写作者提供的预览码进入作品"}]),a.add(_);var w=mt.group();w.add(mt.image("icon_error",{x:s,y:c}));var b=mt.text({x:s+20,y:c,width:250,height:60},{fontSize:14,forceFontFamily:"宋体",color:"#fff",text:""});w.add(b),w.visible=!1,a.add(w),e.add(a)})})):(a?Ue:1==r?De:je)(d,p).then(v,function(e){var t=e.message;return f.text="发生错误：".concat(t||"XMLHttpRequest Load onerror or onabort"),Promise.reject("作品资源加载错误")})}},{key:"getGameAssets",value:function(e){var t=this.game,n=t.world,r=t.cache,a=t.input,i=n.width,o=n.height,u=l.a.client,s=l.a.vertical,c=(l.a.single,l.a.singleoffline),d="pc"===u&&s,h=mt.text({x:s?i/2:18,y:o-(d?342:s?142:70)},{fontSize:"pc"===u?s?22:14:16,forceFontFamily:"pc"===u?"微软雅黑":"宋体",color:"#fff",text:"解析用户配置...",boundsAlignH:s?"center":""});return n.add(h),new Promise(function(t,n){var r=e.logo,a=void 0===r?{}:r,i=e.cover,o=void 0===i?{}:i,u=e.template,s=void 0===u?{}:u,c=e.font,l=e.valueImgs,d=e.dialogs,h=void 0===d?[]:d,f=(s.json||{}).cover,p=a.background,v=ve.getAssets(e);if(v.push.apply(v,Object(k.a)(ve.getViewAssets(e))),p&&p.url&&!p.hidden&&v.push({url:p.url,type:"image"}),h.length>0&&h.forEach(function(e){return v.push.apply(v,Object(k.a)(wt.getDialogAssets(e)))}),!o.hidden){var m=o.background;m&&m.url&&v.push({url:m.url,type:"image"}),f&&v.push.apply(v,Object(k.a)(wt.getCoverAssets(f)))}if(s.json){var g=s.json,y=g.dialog,_=g.menu,w=g.shanyiMenu,b=g.mainMenu,x=g.settings,P=g.option,C=g.playback,S=g.record;v.push.apply(v,Object(k.a)(wt.getSoundAssets(s.json))),v.push.apply(v,Object(k.a)(wt.getDialogAssets(y))),v.push.apply(v,Object(k.a)(wt.getMenuAssets(_))),v.push.apply(v,Object(k.a)(wt.getShanyiMenuAssets(w))),v.push.apply(v,Object(k.a)(wt.getOptionAssets(P))),v.push.apply(v,Object(k.a)(wt.getMainMenuAssets(b))),v.push.apply(v,Object(k.a)(wt.getSettingsAssets(x))),v.push.apply(v,Object(k.a)(wt.getRecordAssets(S))),v.push.apply(v,Object(k.a)(wt.getPlaybackAssets(C)))}l&&l.forEach(function(e){return e.url&&v.push({url:e.url,type:"image"})}),v.forEach(function(e){var t=e.url,n=e.type;return tt.load(n,t)}),c&&I.init(c,e.default_settings.font_size),$.buttonSoundUrl=s.json&&s.json.sound&&s.json.sound.url||"",t()}).then(function(){return h.text="解析用户配置..【成功】",!c||!r.checkKey(Phaser.Cache.IMAGE,"continue")||new Promise(function(e,t){var r=mt.image("continue",{x:i/2,y:s?o/2:o-30,centre:!0});n.add(r),a.onDown.addOnce(function(t,a){n.remove(r,!0),e()})})},function(e){return h.text="用户配置解析错误:".concat(e),Promise.reject(e)})}},{key:"handleOtherActions",value:function(e){Object(we.c)({url:Ie.sensitiveWord,data:"action=all"}).then(function(e){var t=e.responseText;if(0===t.length)return Promise.reject({code:we.a.ERROR,message:"getSensitiveWords failed, no response data"});var n=JSON.parse(t);return"100"==n.code?Array.isArray(n.result)?n.result:JSON.parse(u.c.aesDecrypt(n.result,4)):Promise.reject(n.message)}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return u.c.getSensitiveWords=function(){return e}}),function(){var e=l.a.client,t=l.a.uid,n=l.a.v;if("android"!==e&&"ios"!==e)return Promise.resolve();var r=u.c.getDeviceId(),a=u.a.getCurDate(),i=Ae(a,1),o=Ae(ge.a.hash(ge.a.hash("mac_name=".concat(r,"&time=").concat(a,"&uid=").concat(t,"&v_key=shanyi_WDF#$H*#SJN*&G$&**"))),1),s="".concat(Ie.statistics,"&v=").concat(n,"&client=").concat(e),c="mac_name=".concat(Ae(r,1),"&uid=").concat(Ae(t,1),"&sign=").concat(o,"&time=").concat(i);Object(we.c)({url:s,data:c})}();var t=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return S()(e,{value:{$set:ke.safeInitValue(e)}})})},n={values:t(e.values),savedValues:t(e.savedValues),stringValues:t(e.stringValues),payValues:t(e.payValues),indexValues:t(e.indexValues),systemValues:e.systemValues};return Bt.updateUserAccInfo(n)}},{key:"loadGameAssets",value:function(e){var t=this,n=this.game,r=n.load,a=n.world,i=r._totalFileCount+z.getLoadingCount();if(!i)return Promise.resolve();var o=l.a.vertical,u=l.a.client,s=l.a.single,c=a.width,d=a.height,h="pc"===u&&o,f=Object.create(null),p=0,v=mt.text({x:0,y:d/2+(o?70:130),width:c,height:30},{fontSize:"pc"===u?o?28:24:28,forceFontFamily:"pc"===u?"微软雅黑":"宋体",color:"#fff",boundsAlignH:"center",boundsAlignV:"middle",align:"center"});a.add(v);var m=["收藏作品，更新会第一时间通知你","感觉作品很棒，和你的好友分享吧~","引战、刷屏、作品无关的评论会被删除哦","把作品下载到本地，随时随地任性玩","制作辛苦，写下精彩长评支持喜欢的作者吧","长按屏幕可以快进剧情","素材库为全站通用，可能发生人物走错片场的情况，请不要慌张","在当前作品的评论中对比其他作品容易给作者大大招黑哦~","手指右滑就可召唤退出按钮，退出作品时，记得存档哦"],g=m[Math.floor(Math.random()*("pc"===u?m.length-3:m.length))];o&&g.length>22&&(g="".concat(g.substr(0,19),"\n").concat(g.substr(19)));var y=mt.text({x:28,y:d/2+(h?270:o?150:180),width:c-25,height:18},{fontSize:"pc"===u?o?22:16:18,forceFontFamily:"pc"===u?"微软雅黑":"宋体",color:"#fff",boundsAlignH:"center",boundsAlignV:"middle",align:"center",wordWrap:!0,text:g});!s&&a.add(y);var _=mt.image("light",{x:(c-y.width-28)/2,y:d/2+(h?270:o?150:180)});!s&&a.add(_);var w=function(){return new Promise(function(e,t){var n=function(){p===i&&(r.onSoundExtendLoad.removeAll(f),r.onSoundExtendLoadError.removeAll(f),r.onFileComplete.removeAll(f),e())},a=function(){p++,v.text=parseInt(100*p/i)+"%",n()};r.onSoundExtendLoad.add(a,f),r.onSoundExtendLoadError.add(a,f),r.onFileComplete.add(function(){return a()},f,0),r.onLoadComplete.addOnce(function(){return n()},f,0),r.start()})};if(e){var b=e.duration,k=(e.open,e.pic_url,e.url);return Promise.all([w(),function(){var e=a.getByName("loadingGif");e&&(e.visible=!1);var n=a.getByName("loadingSlogan");return n&&(n.visible=!1),t.showAd(b,"adpicurl",k).then(function(){var t=a.getByName("adView");return t&&a.remove(t,!0),e&&(e.visible=!0),n&&(n.visible=!0),!0})}()])}return w()}},{key:"showGuide",value:function(){var e=this,t=l.a.client;if("android"!==t&&"ios"!==t)return Promise.resolve();var n=D.localStorageGetItem("shanyi3000guide")||"";if(""==n?null:JSON.parse(n))return Promise.resolve();var r=this.game.world,a=r.width,i=r.height;return r.removeAll(!0,!1,!0),new Promise(function(t,n){var o=mt.image("Operation_tip",{x:a/2,y:i/2,centre:!0});o.inputEnabled=!0,r.add(o);o.events.onInputUp.add(function n(r,a){a&&a.pointerMode===Phaser.PointerMode.CURSOR&&0!==a.button||(q.to({target:o,properties:{alpha:0},duration:1e3}).then(function(){D.localStorageSetItem("shanyi3000guide",JSON.stringify({count:0})),t()}),o.events.onInputUp.remove(n,e))},e)})}},{key:"showAd",value:function(e,t,n){var r=this;return new Promise(function(a,i){var o=r.game,u=o.world,s=o.cache,c=u.width,d=u.height,h=l.a.vertical;if(!s.checkKey(Phaser.Cache.IMAGE,t))return a();var f=(c-527)/2,p=h?(d-307)/2-100:84,v=mt.group("adView");u.add(v),v.add(mt.rectMask({color:5000268,alpha:.5,rect:{x:f,y:p,width:527,height:307}}));var m=mt.image(t,{x:0,y:0,width:527,height:307});v.add(m),m.x=f,m.y=p,m.inputEnabled=!0,m.events.onInputDown.add(function(e,t){t&&t.pointerMode===Phaser.PointerMode.CURSOR&&0!==t.button||window.open(n)}),v.add(function(e,t,n){var r=n,i=mt.group("adtime"),o=mt.rectMask({color:5000268,rect:{x:0,y:0,width:32,height:32}}),u=mt.text({x:0,y:0,with:32,height:32},{forceFontFamily:"宋体",fontSize:20,color:12500670,text:r});i.add(o),i.add(u),i.x=e,i.y=t,u.x=(32-u.width)/2,u.y=(32-u.height)/2;var s=0;return s=setInterval(function(){if(r--,u.setText(r<0?0:r),u.x=(32-u.width)/2,r<=0)return clearInterval(s),a()},1e3),i}(f+527-32,p,e||0))})}},{key:"clear",value:function(){var e=this.game,t=e.world,n=e.cache;t.removeAll(!0,!1,!0),n.checkKey(Phaser.Cache.IMAGE,"loading_gif")&&n.removeImage("loading_gif"),n.checkKey(Phaser.Cache.IMAGE,"logo_preloader")&&n.removeImage("logo_preloader"),n.checkKey(Phaser.Cache.IMAGE,"light")&&n.removeImage("light"),n.checkKey(Phaser.Cache.IMAGE,"singlebg")&&n.removeImage("singlebg"),n.checkKey(Phaser.Cache.IMAGE,"continue")&&n.removeImage("continue"),n.checkKey(Phaser.Cache.IMAGE,"serch")&&n.removeImage("serch"),n.checkKey(Phaser.Cache.IMAGE,"slogan")&&n.removeImage("slogan"),n.checkKey(Phaser.Cache.IMAGE,"qrcode")&&n.removeImage("qrcode"),n.checkKey(Phaser.Cache.IMAGE,"adpicurl")&&n.removeImage("adpicurl"),n.checkKey(Phaser.Cache.IMAGE,"Operation_tip")&&n.removeImage("Operation_tip")}}]),e}();document.addEventListener("DOMContentLoaded",function(){console.log("Initialized app, commit:",b);var e=window.innerWidth||window.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.documentElement.clientHeight||window.document.body.clientHeight;window.originalWidth=Math.min(e,t),window.originalHeight=Math.max(e,t),M.d.initQzone().then(function(e){return Promise.resolve(!1).then(function(e){return new Kn})},function(e){return Dialog.warn("游戏初始化失败，请刷新重试！").then(function(){return window.location.reload()})})})}]);